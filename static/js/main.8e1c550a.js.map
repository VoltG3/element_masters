{"version":3,"file":"static/js/main.8e1c550a.js","mappings":"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","sources":["webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.(ogg%7Cmp3%7Cwav%7Cm4a)$i","webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/config.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/weather/LavaRain.js","webpack://element_masters/./src/Pixi/effects/weather/RadioactiveFog.js","webpack://element_masters/./src/Pixi/effects/weather/MeteorRain.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/BubbleFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/floatingTextManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/breakEffectManager.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/entityManager.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables/context.js","webpack://element_masters/./src/engine/gameplay/interactables/spawn.js","webpack://element_masters/./src/engine/gameplay/interactables/doors.js","webpack://element_masters/./src/engine/gameplay/interactables/teleport.js","webpack://element_masters/./src/engine/gameplay/interactables/effects.js","webpack://element_masters/./src/engine/gameplay/secrets/reveal.js","webpack://element_masters/./src/i18n/tutorialMessages.js","webpack://element_masters/./src/engine/gameplay/secrets/triggers.js","webpack://element_masters/./src/engine/gameplay/secrets/wolfSecret.js","webpack://element_masters/./src/engine/gameplay/secrets/crackBlock.js","webpack://element_masters/./src/engine/gameplay/interactables/checkInteractables.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/gameplay/meteorBreakEffects.js","webpack://element_masters/./src/engine/gameplay/biologicalBreakEffects.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/engine/gameplay/weatherDamage.js","webpack://element_masters/./src/engine/gameplay/weatherCover.js","webpack://element_masters/./src/engine/gameplay/entities.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/weatherEffects.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/engine/gameplay/breakEffects.js","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/sections/chapters/shared/MessageOverlay.jsx","webpack://element_masters/./src/constants/builtInMaps.js","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/mapOperations.js","webpack://element_masters/./src/sections/chapters/editor/viewport/ObjectLinks.jsx","webpack://element_masters/./src/sections/chapters/editor/viewport/EditorTile.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorToolsButton.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorElementsButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorTools/BuiltInMapsModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/EditorMapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WorldView.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/BackgroundPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/MusicPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WeatherPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorSceneButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/EditorScene.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/OperationsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/CollapsiblePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/PalettePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/StatisticsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/ObjectPropsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorElements.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorTools.jsx","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPlayMode.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorOperations.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/paintingTools.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPainting.js","webpack://element_masters/./src/sections/chapters/editor/Editor.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorMaps.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorRegistry.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorSelection.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js"],"sourcesContent":["var map = {\n\t\"./blocks/block_pack_01/block_pack_01.png\": 8473,\n\t\"./blocks/block_pack_01/ice_block_0001.png\": 9745,\n\t\"./blocks/brick_block_0001.png\": 3611,\n\t\"./blocks/desert_pack_01/desert_pack_0001.png\": 7741,\n\t\"./blocks/desert_pack_01/desert_pack_0002.png\": 182,\n\t\"./blocks/desert_pack_01/desert_pack_0003.png\": 1727,\n\t\"./blocks/desert_pack_01/desert_pack_0004.png\": 6352,\n\t\"./blocks/desert_pack_01/desert_pack_0005.png\": 2601,\n\t\"./blocks/desert_pack_01/desert_pack_0006.png\": 6018,\n\t\"./blocks/desert_pack_01/desert_pack_0007.png\": 6523,\n\t\"./blocks/desert_pack_01/desert_pack_0008.png\": 5132,\n\t\"./blocks/desert_pack_01/desert_pack_0009.png\": 1045,\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 9538,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./decorations/stone_pack_01/stone_pack_01_001.png\": 1978,\n\t\"./decorations/stone_pack_01/stone_pack_01_002.png\": 4526,\n\t\"./decorations/stone_pack_01/stone_pack_01_003.png\": 7928,\n\t\"./decorations/stone_pack_01/stone_pack_01_004.png\": 9447,\n\t\"./decorations/stone_pack_01/stone_pack_01_005.png\": 1134,\n\t\"./decorations/stone_pack_01/stone_pack_01_006.png\": 8485,\n\t\"./decorations/stone_pack_01/stone_pack_01_007.png\": 3036,\n\t\"./decorations/stone_pack_01/stone_pack_01_008.png\": 7195,\n\t\"./decorations/stone_pack_01/stone_pack_01_009.png\": 9330,\n\t\"./decorations/stone_pack_01/stone_pack_01_010.png\": 2952,\n\t\"./decorations/trees/01_umbrella_acacia_544x544.png\": 3353,\n\t\"./entities/animals/fish_01.png\": 6781,\n\t\"./entities/animals/fish_catfish.png\": 5756,\n\t\"./entities/animals/fish_clownfish.png\": 2287,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 1286,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./entities/tanks/tank_0000.png\": 2386,\n\t\"./entities/tanks/tank_0001.png\": 3563,\n\t\"./entities/tanks/tank_0002.png\": 5232,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./hazards/death_block_0001.png\": 3527,\n\t\"./interactables/arrows/arrow_down.png\": 7152,\n\t\"./interactables/arrows/arrow_left.png\": 8047,\n\t\"./interactables/arrows/arrow_right.png\": 592,\n\t\"./interactables/arrows/arrow_up.png\": 7263,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./interactables/doors/door_0001.png\": 175,\n\t\"./interactables/ends/end_0001.png\": 8597,\n\t\"./interactables/ledders/ledder_steel_01.png\": 5227,\n\t\"./interactables/ledders/ledder_wooden_01.png\": 3368,\n\t\"./interactables/platforms/platform_0001.png\": 9427,\n\t\"./interactables/portals/portal_01/portal_A_001.png\": 8518,\n\t\"./interactables/portals/portal_01/portal_A_002.png\": 3933,\n\t\"./interactables/portals/portal_01/portal_A_003.png\": 692,\n\t\"./interactables/portals/portal_01/portal_A_004.png\": 5499,\n\t\"./interactables/portals/portal_01/portal_A_005.png\": 3954,\n\t\"./interactables/portals/portal_01/portal_A_006.png\": 8489,\n\t\"./interactables/portals/portal_01/portal_A_007.png\": 4288,\n\t\"./interactables/portals/portal_01/portal_A_008.png\": 8519,\n\t\"./interactables/portals/portal_01/portal_A_009.png\": 2734,\n\t\"./interactables/portals/portal_01/portal_A_010.png\": 3124,\n\t\"./interactables/portals/portal_01/portal_A_011.png\": 4253,\n\t\"./interactables/portals/portal_01/portal_A_012.png\": 6838,\n\t\"./interactables/portals/portal_01/portal_A_013.png\": 5583,\n\t\"./interactables/portals/portal_01/portal_A_014.png\": 9712,\n\t\"./interactables/portals/portal_01/portal_A_015.png\": 5465,\n\t\"./interactables/portals/portal_01/portal_A_016.png\": 1458,\n\t\"./interactables/stone_0001.png\": 1020,\n\t\"./interactables/wooden_box_0001.png\": 1169,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205,\n\t\"./secrets/crack_block.png\": 2789,\n\t\"./signs/sign01.png\": 9784\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","var map = {\n\t\"./City.png\": 3676,\n\t\"./Forest.png\": 6370,\n\t\"./UndergroundCave.png\": 2445,\n\t\"./lv8kgjusouta1.png\": 3789,\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719,\n\t\"./seamless_07.png\": 6390\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 2201;","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./sfx/dammage/hit-flesh-03-266308.ogg\": 7808,\n\t\"./sfx/stones/rolling-24b-100544.ogg\": 1835,\n\t\"./sfx/water/in_fish-splashing-release-1-96870.ogg\": 3700,\n\t\"./sfx/water/out_splash-4-46870.ogg\": 5923,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/brick_block_0001.json\": 544,\n\t\"./blocks/desert_block_0001.json\": 6918,\n\t\"./blocks/desert_block_0002.json\": 8359,\n\t\"./blocks/desert_block_0003.json\": 324,\n\t\"./blocks/desert_block_0004.json\": 2149,\n\t\"./blocks/desert_block_0005.json\": 5418,\n\t\"./blocks/desert_block_0006.json\": 5531,\n\t\"./blocks/desert_block_0007.json\": 4136,\n\t\"./blocks/desert_block_0008.json\": 329,\n\t\"./blocks/desert_block_0009.json\": 9518,\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/dirt_block_0002.json\": 5655,\n\t\"./blocks/dirt_block_0003.json\": 4932,\n\t\"./blocks/dirt_block_0004.json\": 5653,\n\t\"./blocks/dirt_block_0005.json\": 8970,\n\t\"./blocks/dirt_block_0006.json\": 2251,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/hazard/death_block_0001.json\": 698,\n\t\"./blocks/liquids/lava_block.json\": 9649,\n\t\"./blocks/liquids/lava_waterfall_block.json\": 9104,\n\t\"./blocks/liquids/quicksand_block.json\": 1924,\n\t\"./blocks/liquids/radioactive_water_block.json\": 1408,\n\t\"./blocks/liquids/radioactive_waterfall_block.json\": 8317,\n\t\"./blocks/liquids/water_block.json\": 8606,\n\t\"./blocks/liquids/waterfall_block.json\": 119,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./decorations/stone_pack_01_001.json\": 5247,\n\t\"./decorations/stone_pack_01_002.json\": 5134,\n\t\"./decorations/stone_pack_01_003.json\": 9593,\n\t\"./decorations/stone_pack_01_004.json\": 9840,\n\t\"./decorations/stone_pack_01_005.json\": 2867,\n\t\"./decorations/stone_pack_01_006.json\": 7618,\n\t\"./decorations/stone_pack_01_007.json\": 9069,\n\t\"./decorations/stone_pack_01_008.json\": 9588,\n\t\"./decorations/stone_pack_01_009.json\": 3975,\n\t\"./decorations/trees/01_umbrella_acacia.json\": 5669,\n\t\"./entities/animals/fish_01.json\": 2174,\n\t\"./entities/animals/fish_catfish.json\": 6865,\n\t\"./entities/animals/fish_clownfish.json\": 2204,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./entities/tank_0000.json\": 9381,\n\t\"./entities/tank_0001.json\": 8938,\n\t\"./entities/tank_0002.json\": 9179,\n\t\"./interactables/arrows/arrow_down.json\": 3741,\n\t\"./interactables/arrows/arrow_left.json\": 4636,\n\t\"./interactables/arrows/arrow_right.json\": 9821,\n\t\"./interactables/arrows/arrow_up.json\": 7852,\n\t\"./interactables/blocks/ice_block_0001.json\": 5742,\n\t\"./interactables/doors/door_0001.json\": 6332,\n\t\"./interactables/ends/end_0001.json\": 9318,\n\t\"./interactables/harvestables/berry_bush_01.json\": 7562,\n\t\"./interactables/harvestables/berry_bush_01_used.json\": 3614,\n\t\"./interactables/ledders/ledder_0001.json\": 8668,\n\t\"./interactables/ledders/ledder_0002.json\": 3097,\n\t\"./interactables/physics/stone_0001.json\": 9095,\n\t\"./interactables/physics/wooden_box_0001.json\": 1116,\n\t\"./interactables/platforms/platform_0001.json\": 2008,\n\t\"./interactables/portals/portal_001.json\": 2190,\n\t\"./interactables/portals/portal_target.json\": 5206,\n\t\"./items/ammunition/fireball_ammo.json\": 7289,\n\t\"./items/health/hertz_item.json\": 3321,\n\t\"./messages/message_i18n_0001.json\": 5217,\n\t\"./messages/sign_0001.json\": 7046,\n\t\"./obstacles/hazards/bushes_001.json\": 6447,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/crack_block.json\": 6854,\n\t\"./secrets/fish_trigger.json\": 2475,\n\t\"./secrets/message_trigger.json\": 3746,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/room_area.json\": 4547,\n\t\"./secrets/secret_area_a.json\": 1866,\n\t\"./secrets/secret_area_b.json\": 3227,\n\t\"./secrets/secret_area_c.json\": 3880,\n\t\"./secrets/wolf_secret_down.json\": 7716,\n\t\"./secrets/wolf_secret_left.json\": 7157,\n\t\"./secrets/wolf_secret_right.json\": 9950,\n\t\"./secrets/wolf_secret_up.json\": 8577,\n\t\"./system/biological_break_effects.json\": 2346,\n\t\"./system/floating_text.json\": 7794,\n\t\"./system/meteor_break_effects.json\": 6643,\n\t\"./system/object_break_effects.json\": 3764,\n\t\"./system/weather_damage.json\": 6234,\n\t\"./weather/weather_clouds_off.json\": 8264,\n\t\"./weather/weather_clouds_on.json\": 9138,\n\t\"./weather/weather_clouds_value.json\": 6592,\n\t\"./weather/weather_fog_off.json\": 4870,\n\t\"./weather/weather_fog_on.json\": 9560,\n\t\"./weather/weather_fog_value.json\": 1374,\n\t\"./weather/weather_lava_rain_off.json\": 4159,\n\t\"./weather/weather_lava_rain_on.json\": 7795,\n\t\"./weather/weather_meteor_rain_off.json\": 8421,\n\t\"./weather/weather_meteor_rain_on.json\": 2097,\n\t\"./weather/weather_radioactive_fog_off.json\": 8304,\n\t\"./weather/weather_radioactive_fog_on.json\": 6298,\n\t\"./weather/weather_rain_off.json\": 8312,\n\t\"./weather/weather_rain_on.json\": 914,\n\t\"./weather/weather_rain_value.json\": 7664,\n\t\"./weather/weather_snow_off.json\": 8445,\n\t\"./weather/weather_snow_on.json\": 969,\n\t\"./weather/weather_snow_value.json\": 5409,\n\t\"./weather/weather_thunder_off.json\": 628,\n\t\"./weather/weather_thunder_on.json\": 1006,\n\t\"./weather/weather_thunder_value.json\": 6756\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8815;","/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  objectMetadata: {}, // Track metadata per object position { index: { health: 100, etc } }\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  projectMaps: {}, // For Project v2.0 (multi-map)\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n  activeRoomIds: [], // IDs of currently active rooms (overlays)\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      const { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.objectMetadata = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {}; // Load initial metadata from map\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.activeRoomIds = []; // Reset active rooms on new map load\n      state.isGameOver = false;\n\n      // If this is a project (v2.0) with multiple maps\n      if (mapData?.maps) {\n        state.projectMaps = mapData.maps;\n      }\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    updateObjectMetadata: (state, action) => {\n      const { index, metadata, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        state.objectMetadata[index] = {\n          ...(state.objectMetadata[index] || {}),\n          ...metadata\n        };\n        if (state.projectMaps[targetId]) {\n          if (!state.projectMaps[targetId].objectMetadata) {\n            state.projectMaps[targetId].objectMetadata = {};\n          }\n          state.projectMaps[targetId].objectMetadata[index] = {\n            ...(state.projectMaps[targetId].objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          state.objectMetadata[index] = {\n            ...(state.objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n        if (!state.projectMaps[mapId].objectMetadata) {\n          state.projectMaps[mapId].objectMetadata = {};\n        }\n        state.projectMaps[mapId].objectMetadata[index] = {\n          ...(state.projectMaps[mapId].objectMetadata[index] || {}),\n          ...metadata\n        };\n      }\n    },\n    removeObjectAtIndex: (state, action) => {\n      const { index, mapId } = typeof action.payload === 'object' ? action.payload : { index: action.payload, mapId: null };\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = null;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = null;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = null;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          // Make sure we are working with a fresh array if we want to trigger changes reliably\n          room.objectMapData = [...room.objectMapData];\n        }\n        \n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = null;\n        }\n      }\n    },\n    removeTileAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.tileMapData[index] !== undefined) {\n        state.tileMapData[index] = null;\n      }\n    },\n    moveTileInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.tileMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.tileMapData[fromIndex] === undefined) return;\n      state.tileMapData[toIndex] = state.tileMapData[fromIndex];\n      state.tileMapData[fromIndex] = null;\n    },\n    moveObjectInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.objectMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.objectMapData[fromIndex] === undefined) return;\n      state.objectMapData[toIndex] = state.objectMapData[fromIndex];\n      state.objectMapData[fromIndex] = null;\n      \n      // Move metadata as well\n      if (state.objectMetadata[fromIndex]) {\n        state.objectMetadata[toIndex] = state.objectMetadata[fromIndex];\n        delete state.objectMetadata[fromIndex];\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = newId;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = newId;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = newId;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          room.objectMapData = [...room.objectMapData];\n        }\n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = newId;\n        }\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    toggleRoom: (state, action) => {\n      const roomId = action.payload;\n      if (state.activeRoomIds.includes(roomId)) {\n        state.activeRoomIds = state.activeRoomIds.filter(id => id !== roomId);\n      } else {\n        state.activeRoomIds.push(roomId);\n      }\n    },\n    clearRooms: (state) => {\n      state.activeRoomIds = [];\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  updateObjectMetadata,\n  removeObjectAtIndex,\n  removeTileAtIndex,\n  moveTileInMap,\n  moveObjectInMap,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  toggleRoom,\n  clearRooms,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\nimport lv_tutorial_messages from \"./translations/lv/tutorial_messages.json\"\nimport no_tutorial_messages from \"./translations/no/tutorial_messages.json\"\nimport en_tutorial_messages from \"./translations/en/tutorial_messages.json\"\nimport ru_tutorial_messages from \"./translations/ru/tutorial_messages.json\"\nimport ja_tutorial_messages from \"./translations/ja/tutorial_messages.json\"\nimport en_game_map_selector from \"./translations/en/game_map_selector.json\"\nimport en_editor_elements from \"./translations/en/editor_elements.json\"\nimport en_editor_scene from \"./translations/en/editor_scene.json\"\nimport en_editor_tools from \"./translations/en/editor_tools.json\"\nimport lv_game_map_selector from \"./translations/lv/game_map_selector.json\"\nimport no_game_map_selector from \"./translations/no/game_map_selector.json\"\nimport ru_game_map_selector from \"./translations/ru/game_map_selector.json\"\nimport ja_game_map_selector from \"./translations/ja/game_map_selector.json\"\nimport lv_editor_elements from \"./translations/lv/editor_elements.json\"\nimport no_editor_elements from \"./translations/no/editor_elements.json\"\nimport ru_editor_elements from \"./translations/ru/editor_elements.json\"\nimport ja_editor_elements from \"./translations/ja/editor_elements.json\"\nimport lv_editor_scene from \"./translations/lv/editor_scene.json\"\nimport no_editor_scene from \"./translations/no/editor_scene.json\"\nimport ru_editor_scene from \"./translations/ru/editor_scene.json\"\nimport ja_editor_scene from \"./translations/ja/editor_scene.json\"\nimport lv_editor_tools from \"./translations/lv/editor_tools.json\"\nimport no_editor_tools from \"./translations/no/editor_tools.json\"\nimport ru_editor_tools from \"./translations/ru/editor_tools.json\"\nimport ja_editor_tools from \"./translations/ja/editor_tools.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"en\",\n        fallbackLng: \"en\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\", \"tutorial\", \"game\", \"editor_elements\", \"editor_scene\", \"editor_tools\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation,\n                tutorial: lv_tutorial_messages,\n                game: lv_game_map_selector,\n                editor_elements: lv_editor_elements,\n                editor_scene: lv_editor_scene,\n                editor_tools: lv_editor_tools\n            },\n            no: {\n                navigation: no_navigation,\n                tutorial: no_tutorial_messages,\n                game: no_game_map_selector,\n                editor_elements: no_editor_elements,\n                editor_scene: no_editor_scene,\n                editor_tools: no_editor_tools\n            },\n            en: {\n                navigation: en_navigation,\n                tutorial: en_tutorial_messages,\n                game: en_game_map_selector,\n                editor_elements: en_editor_elements,\n                editor_scene: en_editor_scene,\n                editor_tools: en_editor_tools\n            },\n            ru: {\n                navigation: ru_navigation,\n                tutorial: ru_tutorial_messages,\n                game: ru_game_map_selector,\n                editor_elements: ru_editor_elements,\n                editor_scene: ru_editor_scene,\n                editor_tools: ru_editor_tools\n            },\n            ja: {\n                navigation: ja_navigation,\n                tutorial: ja_tutorial_messages,\n                game: ja_game_map_selector,\n                editor_elements: ja_editor_elements,\n                editor_scene: ja_editor_scene,\n                editor_tools: ja_editor_tools\n            },\n        },\n    })\n\nexport default i18n\n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n\n        </nav>\n    )\n}\n\n/*\n<NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n* */","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\nimport { useState, useRef, useEffect } from \"react\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    height: 36px;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nconst SettingsButton = styled(NavButton)`\n    ${props => props.$soundOff ? `\n        animation: soundOffPulse 2s ease-in-out infinite;\n        @keyframes soundOffPulse {\n            0% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n            50% { box-shadow: 0 0 12px rgba(86, 255, 138, 0.5); border-color: rgba(86, 255, 138, 0.9); color: #e8fff2; }\n            100% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n        }\n    ` : ''}\n`;\n\nconst DropdownContainer = styled.div`\n    position: relative;\n    display: flex;\n`\n\nconst DropdownMenu = styled.div`\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background-color: #333;\n    border: 1px solid #444;\n    border-radius: 4px;\n    padding: 10px;\n    z-index: 2000;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n    min-width: 150px;\n    margin-top: 5px;\n`\n\nconst MenuItem = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px;\n    color: white;\n    font-size: 12px;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &:hover {\n        background-color: #444;\n    }\n`\n\nconst ToggleSwitch = styled.div`\n    width: 34px;\n    height: 18px;\n    background-color: ${props => props.$active ? '#f4c542' : '#666'};\n    border-radius: 9px;\n    position: relative;\n    transition: background-color 0.3s;\n\n    &::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        left: ${props => props.$active ? '18px' : '2px'};\n        width: 14px;\n        height: 14px;\n        background-color: white;\n        border-radius: 50%;\n        transition: left 0.3s;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const dropdownRef = useRef(null);\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    const currentLang = i18n.language || 'en'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    const toggleSound = () => {\n        const next = !soundEnabled;\n        setSoundEnabled(next);\n        try { localStorage.setItem('game_sound_enabled', next ? '1' : '0'); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n    };\n\n    useEffect(() => {\n        const handleClickOutside = (event) => {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n                setIsMenuOpen(false);\n            }\n        };\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n\n            <DropdownContainer ref={dropdownRef}>\n                <SettingsButton\n                    onClick={() => setIsMenuOpen(!isMenuOpen)}\n                    title=\"Settings\"\n                    $soundOff={!soundEnabled}\n                >\n                    \n                </SettingsButton>\n                {isMenuOpen && (\n                    <DropdownMenu>\n                        <MenuItem onClick={toggleSound}>\n                            <span>Sound Effects</span>\n                            <ToggleSwitch $active={soundEnabled} />\n                        </MenuItem>\n                        <div style={{ height: '1px', backgroundColor: '#444', margin: '5px 0' }} />\n                        <div style={{ padding: '5px 8px', fontSize: '10px', color: '#888' }}>\n                            GAME SETTINGS\n                        </div>\n                    </DropdownMenu>\n                )}\n            </DropdownContainer>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    text-transform: uppercase;\n    margin: 0;\n    line-height: 1.1;\n\n    .tagline {\n        font-size: 0.7rem;\n        letter-spacing: 0.04em;\n        text-transform: lowercase;\n        opacity: 0.7;\n    }\n`\n\nexport function SectionHeaderNavigationLogo() {\n    const tag = (process.env.APP_GIT_TAG || '').trim();\n\n    return (\n        <StyledLogo>\n            <span>Element Masters</span>\n            {tag ? <span className=\"tagline\">{tag.toLowerCase()}</span> : null}\n        </StyledLogo>\n    )\n}\n","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\nlet _registryMap = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        const resolveSoundsMap = (sounds) => {\n            if (!sounds || typeof sounds !== 'object') return sounds;\n            const out = Array.isArray(sounds) ? [] : {};\n            for (const [k, v] of Object.entries(sounds)) {\n                if (typeof v === 'string') {\n                    out[k] = resolveSound(v);\n                } else if (v && typeof v === 'object') {\n                    out[k] = resolveSoundsMap(v);\n                } else {\n                    out[k] = v;\n                }\n            }\n            return out;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null),\n                sounds: resolveSoundsMap(item.sounds)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        _registryMap = new Map();\n        _registry.forEach(item => {\n            if (item && item.id) _registryMap.set(item.id, item);\n        });\n        _registry.__byId = _registryMap;\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    if (!_registry) return null;\n    if (_registryMap) return _registryMap.get(id) || null;\n    return _registry.find(item => item.id === id);\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n\n        </div>\n      )\n    }\n\nexport default App\n/*\n <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n* */","import Logo1 from './assets/logo/Logo1.png';\nimport Logo2 from './assets/logo/Logo2.png';\nimport Logo3 from './assets/logo/Logo3.png';\nimport Logo4 from './assets/logo/Logo4.png';\nimport Logo5 from './assets/logo/Logo5.png';\n\nconst config = {\n    apiUrl: (typeof process !== 'undefined' && process.env?.REACT_APP_API_URL) || 'http://localhost:8000',\n\n    logo: {\n        URL_LOGO_01: Logo1,\n        URL_LOGO_02: Logo2,\n        URL_LOGO_03: Logo3,\n        URL_LOGO_04: Logo4,\n        URL_LOGO_05: Logo5,\n    },\n\n};\n\nexport default config\n","import React from 'react'\nimport styled from 'styled-components'\nimport config from '../../config'\n\nconst HomeContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    //background-color: darkred;\n    \n    .logoRow{\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        width: 100%;\n        height: auto;\n        margin: 10px;\n        //border: solid 1px red;\n        \n        & img {\n            width: 350px;\n        }\n    }\n`\n\nexport default function Home() {\n    const LOGO_01 = config.logo.URL_LOGO_01\n    const LOGO_02 = config.logo.URL_LOGO_02\n    const LOGO_03 = config.logo.URL_LOGO_03\n    const LOGO_04 = config.logo.URL_LOGO_04\n    const LOGO_05 = config.logo.URL_LOGO_05\n    console.log(LOGO_01, LOGO_02, LOGO_03, LOGO_04, LOGO_05)\n\n    return (\n        <HomeContainer>\n           <div className={\"logoRow\"}>\n               <img src={LOGO_01} alt=\"logo\" />\n               <img src={LOGO_02} alt=\"logo\" />\n               <img src={LOGO_03} alt=\"logo\" />\n               <img src={LOGO_04} alt=\"logo\" />\n\n           </div>\n        </HomeContainer>\n    )\n}\n","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on viewport area to keep FPS stable\n    this.maxParticles = 400; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(160, Math.floor(area / 2300));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.rect(0, 0, 1.3, 9);\n    g.fill({ color: 0x4aa3ff, alpha: 0.92 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus a small margin for slanted fall\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 100 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    this.seeded = false;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = 300; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxFlakes = Math.max(120, Math.floor(area / 3000));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(options = null) {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.circle(0, 0, r);\n    g.fill({ color: 0xffffff, alpha: 0.97 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus margin\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      const minY = options && Number.isFinite(options.minY) ? options.minY : (viewport.y - 10);\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : (viewport.y - 40);\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    } else {\n      x = Math.random() * this.width;\n      const minY = options && Number.isFinite(options.minY) ? options.minY : -10;\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : -40;\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    }\n\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    if (target === 0) {\n      this.seeded = false;\n    }\n\n    const deficit = target - this.flakes.length;\n    if (!this.seeded && target > 0) {\n      const viewportH = viewport ? viewport.height : this.height;\n      const viewportY = viewport ? viewport.y : 0;\n      const seedCount = Math.min(target, Math.max(24, Math.floor(this.maxFlakes * 0.35)));\n      for (let i = 0; i < seedCount; i++) {\n        this.spawnOne({\n          minY: viewportY - viewportH * 0.35,\n          maxY: viewportY + viewportH * 0.9\n        });\n      }\n      this.seeded = true;\n    }\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40 || (viewport && f.y > viewport.y + viewport.height + 100)) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n    this.windDirection = 1; // 1: from left to right, -1: from right to left\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(isInitial = false) {\n    const g = new Graphics();\n    const w = 140 + Math.random() * 300; // cloud size\n    const h = 80 + Math.random() * 160;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : this.width;\n\n    let x;\n    if (isInitial) {\n      // Initial scatter across the whole viewport (or map if no viewport)\n      const range = Math.max(vW, this.width) + 800;\n      const startX = viewport ? vX - 400 : -400;\n      x = startX + Math.random() * range;\n    } else if (viewport) {\n      // Dynamic spawn: place in or near viewport so the user sees results quickly\n      // We scatter them in a wider area around viewport [x-400, x+width+400]\n      x = viewport.x - 400 + Math.random() * (viewport.width + 800);\n    } else {\n      // Fallback to edges\n      x = (Math.random() < 0.5 ? -180 : this.width + 180);\n    }\n    \n    const y = vY - 40 + Math.random() * (this.bandHeight - 20); // only in band\n    const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n    const speed = 8 + Math.random() * 22; // horizontal drift speed\n    const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n    // Draw an organic cloud using overlapping circles (soft edges)\n    const rx = w * 0.5;\n    const ry = h * 0.5;\n    const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n    const baseR = Math.min(rx, ry) * 0.55;\n    for (let k = 0; k < circles; k++) {\n      const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n      const dist = 0.2 + Math.random() * 0.35;\n      const cx = Math.cos(t) * rx * dist;\n      const cy = Math.sin(t) * ry * dist;\n      const r = baseR * (0.7 + Math.random() * 0.7);\n      g.circle(cx, cy, r);\n    }\n    // central mass\n    g.circle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n    g.fill({ color: 0xffffff, alpha: 1.0 });\n    g.alpha = 0; // Start invisible for fade-in\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.patches.push({ \n      g, w, h, \n      vx: speed * this.windDirection, \n      vy, \n      targetAlpha: alpha, \n      currentAlpha: 0,\n      phase: Math.random() * Math.PI * 2,\n      dying: false\n    });\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    // We don't change this.width/height here as they are map bounds,\n    // but we can update bandHeight if the screen height changed significantly.\n    this.bandHeight = Math.max(1, Math.floor(h * 0.3)); \n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vW = viewport ? viewport.width : 1280;\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    for (let i = 0; i < targetCount; i++) {\n      this.spawnOne(true);\n      // For initial ones, set alpha immediately\n      if (this.patches.length > 0) {\n        const p = this.patches[this.patches.length - 1];\n        p.currentAlpha = p.targetAlpha;\n        p.g.alpha = p.currentAlpha;\n      }\n    }\n  }\n\n  update(dtMs) {\n    // Live intensity update with smoothing\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : 1280;\n    const vH = viewport ? viewport.height : 720;\n\n    const bandTop = vY - 100;\n    const bandBottom = vY + this.bandHeight;\n\n    // Adjust cloud count gradually\n    // We scale target count based on viewport width (default 18 for 1280px)\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    const activePatches = this.patches.filter(p => {\n      if (p.dying) return false;\n      if (!viewport) return true;\n      // Only count patches that are within a reasonable distance of the viewport\n      return p.g.x > vX - 1000 && p.g.x < vX + vW + 1000;\n    });\n    \n    if (activePatches.length < targetCount) {\n      // Spawn one cloud per ~300ms if needed, to avoid sudden pops\n      this._spawnTimer = (this._spawnTimer || 0) + dtMs;\n      if (this._spawnTimer > 300 || activePatches.length === 0) {\n        this.spawnOne(activePatches.length === 0);\n        this._spawnTimer = 0;\n      }\n    } else if (activePatches.length > targetCount) {\n      // Mark one for death\n      const toKill = activePatches[0];\n      if (toKill) toKill.dying = true;\n    }\n\n    const toRemove = [];\n    for (let i = 0; i < this.patches.length; i++) {\n      const p = this.patches[i];\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // Alpha handling\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      \n      // Cleanup if too far from viewport (e.g. teleport)\n      if (viewport && !p.dying && (p.g.x < vX - 2500 || p.g.x > vX + vW + 2500)) {\n        p.dying = true;\n      }\n\n      if (p.dying) {\n        p.currentAlpha -= dt * 0.1; // Fade out slowly\n        if (p.currentAlpha <= 0) {\n          toRemove.push(i);\n          continue;\n        }\n      } else if (p.currentAlpha < p.targetAlpha) {\n        p.currentAlpha += dt * 0.05; // Fade in slowly\n        if (p.currentAlpha > p.targetAlpha) p.currentAlpha = p.targetAlpha;\n      }\n\n      p.g.alpha = Math.max(0, Math.min(0.55, p.currentAlpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      const margin = 800; // Increased margin to ensure they don't pop out visibly\n      if (viewport) {\n          const leftBound = vX - margin;\n          const rightBound = vX + vW + margin;\n          if (p.g.x < leftBound) p.g.x = rightBound;\n          if (p.g.x > rightBound) p.g.x = leftBound;\n      } else {\n          if (p.g.x < -margin) p.g.x = W + margin;\n          if (p.g.x > W + margin) p.g.x = -margin;\n      }\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n\n    // Remove dead patches\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.patches[idx];\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n      this.patches.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    // We draw a large rectangle to cover the viewport\n    g.rect(0, 0, w, h);\n    g.fill({ color: 0x9fb7c9, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      // Follow camera\n      if (this.g) this.g.x = viewport.x;\n      if (this.layer1) this.layer1.x = viewport.x;\n      if (this.layer2) this.layer2.x = viewport.x;\n      \n      // We also need to follow Y if the map is tall\n      if (this.g) this.g.y = viewport.y;\n      if (this.layer1) this.layer1.y = viewport.y;\n      if (this.layer2) this.layer2.y = viewport.y;\n    }\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.25, 0.9, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.8, 1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    \n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      g.x = viewport.x;\n      g.y = viewport.y;\n      g.rect(0, 0, viewport.width, viewport.height);\n    } else {\n      g.rect(0, 0, this.width, this.height);\n    }\n    g.fill({ color: 0xffffff, alpha: this.flashAlpha });\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, topY;\n    if (viewport) {\n      // Strike within viewport\n      x = Math.floor(viewport.x + this._rand(8, viewport.width - 8));\n      topY = viewport.y - Math.floor(this._rand(10, 40));\n    } else {\n      x = Math.floor(this._rand(8, W - 8));\n      topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    }\n\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2, 5, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xCCEEFF;\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n    g.stroke({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n      g.stroke({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Graphics } from 'pixi.js';\n\n// Lava rain system: similar to rain but red/orange and potentially deals damage (handled by engine)\nexport default class WeatherLavaRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 300; \n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(120, Math.floor(area / 3000));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Lava drops are slightly thicker and more glowing\n    g.rect(0, 0, 2, 10);\n    // Glowing yellow/orange color\n    const color = Math.random() > 0.3 ? 0xffaa00 : 0xffcc00;\n    g.fill({ color, alpha: 0.95 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 400 + Math.random() * 400; // slightly slower/heavier than water rain\n    const vx = (Math.random() * 40 - 20); \n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.1; \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, alive: true });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    let target = Math.floor(this.maxParticles * norm);\n    if (norm > 0 && target < 5) target = 5;\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      const toSpawn = Math.min(deficit, Math.max(1, Math.ceil(target * 0.02)), 30);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    \n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (p) {\n          try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n        }\n      }\n    }\n\n    const dt = dtMs / 1000;\n    const gAcc = 1200; \n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.vy += gAcc * dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Interaction with surfaces / water\n      if (this.api.getLiquidSurfaceY) {\n        const waterY = this.api.getLiquidSurfaceY('water', p.x);\n        if (Number.isFinite(waterY) && p.y >= waterY) {\n          if (typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: waterY, strength: 0.9 });\n          }\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Interaction with solid surfaces\n      if (this.api.isSolidAt(p.x, p.y)) {\n         // Lava drops just vanish on hit with a tiny \"ember\" effect (optional)\n         if (typeof this.api.onLavaImpact === 'function' && Math.random() > 0.5) {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: 0.2 });\n         }\n         p.alive = false;\n         toRemove.push(i);\n         continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 50 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Radioactive fog overlay: similar to fog but toxic green\nexport default class WeatherRadioactiveFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0;\n\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    this.noiseTex = WeatherRadioactiveFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    this.layer2 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    \n    this.layer1.tileScale.set(1.2, 1.2);\n    this.layer2.tileScale.set(0.7, 0.9);\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100;\n    return Math.max(0, Math.min(0.75, t * 0.75));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0);\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    g.rect(0, 0, w, h);\n    // Toxic green tint\n    g.fill({ color: 0x1a5c1a, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      if (this.g) { this.g.x = viewport.x; this.g.y = viewport.y; }\n      if (this.layer1) { this.layer1.x = viewport.x; this.layer1.y = viewport.y; }\n      if (this.layer2) { this.layer2.x = viewport.x; this.layer2.y = viewport.y; }\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    const pulse = 1 + 0.06 * Math.sin(this.time * 0.001);\n    this._applyAlphas(pulse);\n\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    if (this.layer1) { try { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); } catch {} }\n    if (this.layer2) { try { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); } catch {} }\n    this.layer1 = null; this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.3 + 0.4 * t);\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.7;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    this.speed1 = { x: lerp(0.004, 0.02, t), y: lerp(0.0, 0.01, t) };\n    this.speed2 = { x: lerp(-0.005, -0.015, t), y: lerp(0.003, 0.015, t) };\n  }\n\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 180 + Math.floor(Math.random() * 75); \n      img.data[i] = v * 0.4;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v * 0.4;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Meteor rain system: large falling fireballs that can deal damage via API callback\nexport default class WeatherMeteorRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 15; // Meteors are rare and large\n  }\n\n  resize(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n  spawnOne() {\n    const size = 4 + Math.random() * 8; // Meteor radius\n    const isLarge = size > 9;\n    \n    const g = new Graphics();\n    g.clear();\n    \n    // Core\n    g.circle(0, 0, size);\n    g.fill({ color: 0x555555, alpha: 1 });\n    \n    // Glow/Fire\n    g.circle(0, 0, size * 1.5);\n    g.fill({ color: 0xff4500, alpha: 0.4 });\n    \n    // Tail\n    g.moveTo(-size, 0);\n    g.lineTo(0, -size * 4);\n    g.lineTo(size, 0);\n    g.fill({ color: 0xff8c00, alpha: 0.6 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 200 + Math.random() * (viewport.width + 400);\n      y = viewport.y - 100 - Math.random() * 200;\n    } else {\n      x = Math.random() * this.width;\n      y = -100 - Math.random() * 200;\n    }\n\n    const vx = 100 + Math.random() * 100; // slanted fall\n    const vy = 400 + Math.random() * 300;\n    \n    g.x = x;\n    g.y = y;\n    // Rotate towards fall direction\n    g.rotation = Math.atan2(vy, vx) - Math.PI/2;\n    \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, size, isLarge, alive: true, waterTouched: false });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0005 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = this.intensity / 100;\n    const target = Math.floor(this.maxParticles * norm);\n\n    if (this.particles.length < target && Math.random() < 0.02 * norm) {\n      this.spawnOne();\n    }\n\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      const playerState = typeof this.api.getPlayerState === 'function'\n        ? this.api.getPlayerState()\n        : null;\n      let hitEntity = false;\n      if (playerState) {\n        const px = (playerState.x || 0) + (playerState.width || 0) / 2;\n        const py = (playerState.y || 0) + (playerState.height || 0) / 2;\n        const pr = Math.max(6, Math.max(playerState.width || 0, playerState.height || 0) / 2);\n        const dx = px - p.x;\n        const dy = py - p.y;\n        if ((dx * dx + dy * dy) <= Math.pow(p.size + pr, 2)) {\n          hitEntity = true;\n        } else if (Array.isArray(playerState.entities)) {\n          for (const ent of playerState.entities) {\n            const ex = (ent.x || 0) + (ent.width || 0) / 2;\n            const ey = (ent.y || 0) + (ent.height || 0) / 2;\n            const er = Math.max(6, Math.max(ent.width || 0, ent.height || 0) / 2);\n            const edx = ex - p.x;\n            const edy = ey - p.y;\n            if ((edx * edx + edy * edy) <= Math.pow(p.size + er, 2)) {\n              hitEntity = true;\n              break;\n            }\n          }\n        }\n      }\n\n      if (hitEntity) {\n        if (typeof this.api.onMeteorHit === 'function') {\n          this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'air' });\n        }\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const liquidType = typeof this.api.getLiquidTypeAt === 'function'\n        ? this.api.getLiquidTypeAt(p.x, p.y)\n        : null;\n\n      if (liquidType) {\n        if (liquidType === 'water' && typeof this.api.onWaterImpact === 'function') {\n          if (!p.waterTouched) {\n            this.api.onWaterImpact({ x: p.x, strength: p.isLarge ? 1.4 : 0.8 });\n            p.waterTouched = true;\n          }\n          // Meteors pass through water until hitting solid ground\n        } else {\n          if (liquidType === 'lava' && typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.6 : 0.9 });\n          }\n\n          if (typeof this.api.onMeteorHit === 'function') {\n            this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: liquidType });\n          }\n\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Check collision with solid world\n      if (this.api.isSolidAt(p.x, p.y)) {\n        // Explosion effect\n        if (typeof this.api.onLavaImpact === 'function') {\n           this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.5 : 0.8 });\n        }\n        \n        // Notify engine about meteor hit for damage\n        if (typeof this.api.onMeteorHit === 'function') {\n           this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'ground' });\n        }\n\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      if (viewport && (p.y > viewport.y + viewport.height + 100 || p.x > viewport.x + viewport.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      } else if (!viewport && (p.y > this.height + 100 || p.x > this.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.circle(d.x, d.y, size);\n      g.fill({ color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.circle(r.x, r.y, r.r);\n      g.stroke({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// BubbleFX: lightweight bubble particles for underwater ambience\nexport default class BubbleFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.bubbles = [];\n    this.maxBubbles = 120;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.bubbles = [];\n  }\n\n  trigger({ x = 0, y = 0, size = 2, rise = 0.03, life = 1200, drift = 0.02 } = {}) {\n    if (this.bubbles.length >= this.maxBubbles) return;\n    const g = new Graphics();\n    g.x = 0;\n    g.y = 0;\n    this.node.addChild(g);\n    this.bubbles.push({\n      g,\n      x,\n      y,\n      size,\n      rise,\n      drift,\n      life: 0,\n      max: life\n    });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.bubbles.length - 1; i >= 0; i--) {\n      const b = this.bubbles[i];\n      b.life += dt;\n      b.y -= b.rise * dt;\n      b.x += (Math.random() - 0.5) * b.drift * dt;\n      const t = Math.min(1, b.life / b.max);\n      const alpha = 0.7 * (1 - t);\n      const size = Math.max(0.5, b.size * (1 - t * 0.2));\n      const g = b.g;\n      g.clear();\n      g.circle(b.x, b.y, size);\n      g.stroke({ width: 1, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (b.life >= b.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.bubbles.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      g.stroke({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n\n      // glowing ember\n      g.circle(e.x, e.y, emberSize);\n      g.fill({ color: 0xffa229, alpha: 0.9 * emberAlpha });\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.circle(p.x, p.y, radius);\n      g.fill({ color: 0xdfdad2, alpha: Math.max(0, alpha) });\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite, Sprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.bgContainer = opts.bgContainer || null;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n\n    // Use multiple sample points for better precision\n    // 1. Center\n    const points = [\n      { x: px + pw * 0.5, y: py + ph * 0.5 },\n      { x: px + pw * 0.5, y: py + ph * 0.1 }, // Top\n      { x: px + pw * 0.5, y: py + ph * 0.9 }, // Bottom\n    ];\n\n    for (const pt of points) {\n      const gx = Math.floor(pt.x / this.tileSize);\n      const gy = Math.floor(pt.y / this.tileSize);\n      const idx = gy * this.mapWidth + gx;\n      if (region.tileIndicesSet && region.tileIndicesSet.has(idx)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { if (r.bgNode && r.bgNode.parent) r.bgNode.parent.removeChild(r.bgNode); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n        try { r.bgNode?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._quicksandTex?.destroy(true); } catch {}\n    try { this._waterfallTex?.destroy(true); } catch {}\n    try { this._lavaWaterfallTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    try { this._lavaDetailTex?.destroy(true); } catch {}\n    try { this._waterDetailTex?.destroy(true); } catch {}\n    try { this._quicksandDetailTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    if (this._gradTextures) {\n      for (const k in this._gradTextures) {\n        try { this._gradTextures[k].destroy(true); } catch {}\n      }\n      this._gradTextures = null;\n    }\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.bgNode?.parent && r.bgNode.parent.removeChild(r.bgNode); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n      try { r.bgNode?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      try { this._quicksandTex?.destroy(true); } catch {}\n      try { this._waterfallTex?.destroy(true); } catch {}\n      try { this._lavaWaterfallTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n      try { this._lavaDetailTex?.destroy(true); } catch {}\n      try { this._waterDetailTex?.destroy(true); } catch {}\n      try { this._quicksandDetailTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null; this._quicksandTex = null; this._waterfallTex = null;\n      this._lavaWaterfallTex = null;\n      this._radioactiveWaterTex = null; this._radioactiveWaterfallTex = null;\n      this._lavaDetailTex = null; this._waterDetailTex = null; this._quicksandDetailTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0, y: 0 }; // Static (bubbles added via texture/noise)\n    const lavaDrift = { x: 0, y: 0 }; // Static (floating pieces added via noise/texture)\n    const quicksandDrift = { x: 0, y: 0 }; // Static (pixels fade via noise)\n    const waterfallDrift = { x: 0, y: 0.15 }; // Fast vertical drift\n    const lavaWaterfallDrift = { x: 0, y: 0.12 }; // Lava falls a bit slower/thicker\n    const radioactiveWaterDrift = { x: 0, y: 0 }; // Static\n    const radioactiveWaterfallDrift = { x: 0, y: 0.12 }; // Match lava waterfall speed or similar\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : (r.type === 'quicksand' ? quicksandDrift : (r.type === 'waterfall' ? waterfallDrift : (r.type === 'lava_waterfall' ? lavaWaterfallDrift : (r.type === 'radioactive_waterfall' ? radioactiveWaterfallDrift : (r.type === 'radioactive_water' ? radioactiveWaterDrift : waterDrift)))));\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly with smooth transitions)\n      let targetAlpha = 0.95;\n      if (r.type === 'water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.50 : 0.95;\n      } else if (r.type === 'quicksand') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.70 : 1.0;\n      } else if (r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.40 : 0.65;\n      } else if (r.type === 'radioactive_water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.55 : 0.90;\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.60 : 0.98;\n      }\n\n      // Smooth transition (lerp)\n      if (r.currentAlpha === undefined) r.currentAlpha = sprite.alpha;\n      const lerpFactor = 0.005; // Adjust for speed of transition\n      const alphaDiff = targetAlpha - r.currentAlpha;\n      r.currentAlpha += alphaDiff * Math.min(1, dt * lerpFactor);\n      sprite.alpha = r.currentAlpha;\n\n      // Splash animation for waterfalls\n      if ((r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') && r.splashG && Array.isArray(r.bottomEdges)) {\n        const g = r.splashG;\n        g.clear();\n        const thickness = Math.max(2, Math.floor(this.tileSize * 0.25));\n        const F = 1000;\n        const cycle = (this._time % F) / F;\n        \n        for (const e of r.bottomEdges) {\n          // Animated foam/splash at the bottom\n          const splashHeight = thickness * (0.8 + Math.sin(this._time * 0.01 + e.x) * 0.2);\n          g.rect(e.x, e.y + this.tileSize - splashHeight, e.w, splashHeight);\n          \n          // Bubbles\n          for (let k = 0; k < 5; k++) {\n             const bx = e.x + ((e.x * 13 + k * 37 + this._time * 0.05) % e.w);\n             const by = e.y + this.tileSize - (Math.random() * thickness * 2);\n             g.circle(bx, by, 1 + Math.random() * 2);\n          }\n        }\n        const splashColor = r.type === 'lava_waterfall' ? 0xffcc00 : (r.type === 'radioactive_waterfall' ? 0xadff2f : 0xffffff);\n        g.fill({ color: splashColor, alpha: 0.5 + Math.sin(this._time * 0.02) * 0.2 });\n      }\n\n      // Animate noise/detail overlays\n      if (r.noise1) {\n        if (r.type === 'water') {\n          r.noise1.tilePosition.y -= 0.015 * dt; // Bubbles go UP\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.001) * 0.005 * dt; \n        } else if (r.type === 'lava') {\n          r.noise1.tilePosition.x += 0.004 * dt; \n          r.noise1.tilePosition.y += 0.002 * dt;\n        } else if (r.type === 'quicksand') {\n          // Fade effect for pixels\n          r.noise1.alpha = 0.4 + Math.sin(this._time * 0.001) * 0.2;\n          r.noise1.tilePosition.x += 0.001 * dt;\n        } else if (r.type.includes('waterfall')) {\n          r.noise1.tilePosition.y += drift.y * 0.8 * dt;\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.002) * 0.02 * dt;\n        } else {\n          r.noise1.tilePosition.x += 0.008 * dt;\n          r.noise1.tilePosition.y += 0.004 * dt;\n        }\n      }\n      if (r.noise2) {\n        if (r.type === 'quicksand') {\n          r.noise2.alpha = 0.2 + Math.cos(this._time * 0.0015) * 0.1;\n        } else if (r.type.includes('waterfall')) {\n          r.noise2.tilePosition.y += drift.y * 1.2 * dt;\n        } else {\n          r.noise2.tilePosition.x -= 0.005 * dt;\n          r.noise2.tilePosition.y += 0.003 * dt;\n        }\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.rect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.fill({ color: 0xc9ecff, alpha: 0.35 });\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.lava_waterfall) return 'lava_waterfall';\n      if (def.flags.radioactive_waterfall) return 'radioactive_waterfall';\n      if (def.flags.waterfall) return 'waterfall';\n      if (def.flags.radioactive_water) return 'radioactive_water';\n      if (def.flags.quicksand) return 'quicksand';\n      if (def.flags.lava) return 'lava';\n      if (def.flags.water) return 'water';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n      _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n        const node = new Container();\n        const mask = new Graphics();\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        const tileIndicesSet = new Set(tileIndices);\n\n        mask.clear();\n        const bleed = 1; // Palielints bleed, lai nosegtu spraugas\n        for (let k = 0; k < tileIndices.length; k++) {\n          const idx = tileIndices[k];\n          const gx = (idx % mapWidth);\n          const gy = Math.floor(idx / mapWidth);\n          mask.rect(\n            gx * tileSize - bleed,\n            gy * tileSize - bleed,\n            tileSize + bleed * 2,\n            tileSize + bleed * 2\n          );\n        }\n        mask.fill({ color: 0xffffff, alpha: 1 });\n\n        const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                     : (type === 'quicksand' ? (this._quicksandTex || (this._quicksandTex = this._createQuicksandTexture(tileSize)))\n                                     : (type === 'waterfall' ? (this._waterfallTex || (this._waterfallTex = this._createWaterfallTexture(tileSize)))\n                                     : (type === 'lava_waterfall' ? (this._lavaWaterfallTex || (this._lavaWaterfallTex = this._createLavaWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_waterfall' ? (this._radioactiveWaterfallTex || (this._radioactiveWaterfallTex = this._createRadioactiveWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_water' ? (this._radioactiveWaterTex || (this._radioactiveWaterTex = this._createRadioactiveWaterTexture(tileSize)))\n                                     : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize))))))));\n        \n        // v8 addressMode iestatana\n        if (tex.source && tex.source.style) {\n          tex.source.style.addressMode = 'repeat';\n        }\n\n        const tiling = new TilingSprite({\n          texture: tex,\n          width: worldW,\n          height: worldH\n        });\n        \n        tiling.tileScale.set(1, 1);\n        tiling.alpha = type === 'lava' ? 0.98 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.6 : 0.92);\n        node.addChild(tiling);\n\n        // Noise/Detail sli\n        let detailTex1, detailTex2;\n        if (type.includes('lava')) {\n          detailTex1 = this._lavaDetailTex || (this._lavaDetailTex = this._createLavaDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type === 'quicksand') {\n          detailTex1 = this._quicksandDetailTex || (this._quicksandDetailTex = this._createQuicksandDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type.includes('radioactive')) {\n          detailTex1 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n          detailTex2 = this._noiseTex;\n        } else {\n          // water, waterfall\n          detailTex1 = this._waterDetailTex || (this._waterDetailTex = this._createWaterDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        }\n\n        if (detailTex1.source && detailTex1.source.style) detailTex1.source.style.addressMode = 'repeat';\n        if (detailTex2.source && detailTex2.source.style) detailTex2.source.style.addressMode = 'repeat';\n\n        const noise1 = new TilingSprite({ texture: detailTex1, width: worldW, height: worldH });\n        const noise2 = new TilingSprite({ texture: detailTex2, width: worldW, height: worldH });\n        \n        if (type === 'water' || type === 'radioactive_water') {\n          noise1.alpha = 0.25; noise2.alpha = 0.15;\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          noise1.alpha = 0.2; noise2.alpha = 0.15;\n        } else if (type === 'lava') {\n          noise1.alpha = 0.4; noise2.alpha = 0.2;\n        } else if (type === 'quicksand') {\n          noise1.alpha = 0.6; noise2.alpha = 0.3;\n        } else {\n          noise1.alpha = 0.12; noise2.alpha = 0.15;\n        }\n        node.addChild(noise1, noise2);\n\n        // LABOJUMS: Maska tiek pievienota k brns, lai t sekotu ldzi node koordintm\n        node.addChild(mask);\n        node.mask = mask;\n\n        // Background slnis (zIndex 28) - lai aizsegtu fonu caur deni\n        let bgNode = null;\n        if (this.bgContainer) {\n          bgNode = new Container();\n          const bgMask = new Graphics();\n          bgMask.clear();\n          for (let k = 0; k < tileIndices.length; k++) {\n            const idx = tileIndices[k];\n            const gx = (idx % mapWidth);\n            const gy = Math.floor(idx / mapWidth);\n            bgMask.rect(gx * tileSize - bleed, gy * tileSize - bleed, tileSize + bleed * 2, tileSize + bleed * 2);\n          }\n          bgMask.fill({ color: 0xffffff, alpha: 1 });\n          bgNode.addChild(bgMask);\n          bgNode.mask = bgMask;\n\n          const bgG = new Graphics();\n          let minY = Infinity, maxY = -Infinity;\n          for (let k = 0; k < tileIndices.length; k++) {\n            const gy = Math.floor(tileIndices[k] / mapWidth) * tileSize;\n            if (gy < minY) minY = gy;\n            if (gy + tileSize > maxY) maxY = gy + tileSize;\n          }\n\n          if (!this._gradTextures) this._gradTextures = {};\n          if (!this._gradTextures[type]) {\n            let color, bottomColor;\n            if (type.includes('lava')) {\n              color = '#ffaa00'; bottomColor = '#884400';\n            } else if (type.includes('radioactive')) {\n              color = '#004400'; bottomColor = '#001100';\n            } else if (type === 'quicksand') {\n              color = '#5d4037'; bottomColor = '#2d1d19';\n            } else { \n              color = '#3a7fb8'; bottomColor = '#0b1d2e';\n            }\n            this._gradTextures[type] = this._createGradientTexture(color, bottomColor);\n          }\n\n          const bgSprite = new Sprite(this._gradTextures[type]);\n          bgSprite.width = worldW;\n          bgSprite.height = worldH;\n          bgSprite.y = 0;\n          \n          bgNode.addChild(bgSprite);\n          this.bgContainer.addChild(bgNode);\n        }\n\n        const baseAlpha = type === 'lava' ? 0.98 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.6 : 0.92);\n\n        if (type === 'water' || type === 'radioactive_water') {\n          const capG = new Graphics();\n          node.addChild(capG);\n          const topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n          // Saglabjam atsauces uz r reistr\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          const splashG = new Graphics();\n          node.addChild(splashG);\n          const bottomEdges = this._computeBottomEdgeSpans(tileIndices, mapWidth, tileSize);\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, splashG, bottomEdges, tileIndicesSet, currentAlpha: baseAlpha });\n        } else {\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        }\n\n        this.container.addChild(node);\n      }\n\n      _createGradientTexture(topColor, bottomColor) {\n        const canvas = document.createElement('canvas');\n        const size = 64; \n        canvas.width = 2; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, topColor);\n        g.addColorStop(1, bottomColor);\n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, 2, size);\n        return Texture.from(canvas);\n      }\n\n  _createWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient to remove horizontal bars\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // No horizontal gradient to remove bars\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    // Lava pieces/streaks (vertical) - these go down\n    ctx.fillStyle = '#ffed8a';\n    for (let k = 0; k < 10; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 15;\n      const w = 3 + Math.random() * 4; // Wider \"chunks\"\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid sand color\n    ctx.fillStyle = '#a6915b';\n    ctx.fillRect(0, 0, size, size);\n\n    // grainy texture (static here, will animate pixels via noise)\n    ctx.globalAlpha = 0.3;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 25; k++) {\n      ctx.fillRect(Math.random() * size, Math.random() * size, 1, 1);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Background color\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 15; k++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.4;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 25;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid toxic green\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Some mini bubbles (static here, noise provides movement)\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random() * 1.5, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.15 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 8 + Math.random() * 15;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n    \n    // Pievienojam burbuus (prasba: \"var pieveinot burbuus kuri iet uzleju k radioactive water\")\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 6; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random(), 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ff8800'; \n    for (let i = 0; i < 10; i++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      const sw = 12 + Math.random() * 24;\n      const sh = 10 + Math.random() * 20;\n      ctx.fillRect(Math.random() * w, Math.random() * h, sw, sh);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createWaterDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < 12; i++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * w, Math.random() * h, 1 + Math.random() * 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#5c5031';\n    for (let i = 0; i < 100; i++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.5;\n      ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 256, h = 256) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = '#ffffff';\n    for(let i=0; i<500; i++) {\n      ctx.globalAlpha = Math.random() * 0.05;\n      ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its bottom boundary per row.\n  _computeBottomEdgeSpans(tileIndices, mapWidth, tileSize) {\n    const set = new Set(tileIndices);\n    const spans = [];\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const below = idx + mapWidth;\n      if (!set.has(below)) {\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.roundRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.fill({ color: this._trackColor, alpha: 0.85 });\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.roundRect(0, 0, innerW, h, radius);\n    this._fill.fill({ color: this._color, alpha: 1 });\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  tiles: 20,\n  tilesAnim: 25,\n  liquidBackground: 28,\n  objBehind: 30,\n  secretsBelow: 35,\n  player: 40,\n  projectiles: 50,\n  objFront: 60,\n  secretsAbove: 65,\n  weather: 70,\n  fog: 80,\n  liquids: 90,\n  liquidFx: 100,\n  overlay: 110,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#3a7fb8');\n    g.addColorStop(0.5, '#5ba3d9');\n    g.addColorStop(1, '#3a7fb8');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (yellow to golden)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#ffaa00');\n    g.addColorStop(1, '#ffcc00');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffff00');\n      grad.addColorStop(1, '#ffaa00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffffff';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\nexport const isQuicksandDef = (def) => !!(def && def.flags && def.flags.quicksand);\nexport const isWaterfallDef = (def) => !!(def && def.flags && def.flags.waterfall);\nexport const isLavaWaterfallDef = (def) => !!(def && def.flags && def.flags.lava_waterfall);\nexport const isRadioactiveWaterDef = (def) => !!(def && def.flags && def.flags.radioactive_water);\nexport const isRadioactiveWaterfallDef = (def) => !!(def && def.flags && def.flags.radioactive_waterfall);\n\n// Generate procedural quicksand frames (cached per tile size)\nexport const createQuicksandFrames = (tileSize) => {\n  const frames = [];\n  const F = 12; // slightly more frames for smoother slow movement\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base sand color (brownish yellow)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#a6915b');\n    g.addColorStop(1, '#7d6d42');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // grainy texture / swirling patterns\n    const t = i / F;\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 4; k++) {\n       const y = Math.floor((tileSize / 4) * k + (t * tileSize)) % tileSize;\n       ctx.fillRect(0, y, tileSize, 1);\n    }\n    \n    // random grains\n    ctx.globalAlpha = 0.15;\n    ctx.fillStyle = '#d1ba7d';\n    const count = Math.max(5, Math.floor(tileSize * 0.25));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 43 + i * 7) % tileSize);\n      const ry = Math.floor((k * 61 + i * 11) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural waterfall frames\nexport const createWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent blue (izmantojam dens krsas)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(42, 93, 143, 0.5)');\n    g.addColorStop(0.5, 'rgba(91, 163, 217, 0.5)');\n    g.addColorStop(1, 'rgba(42, 93, 143, 0.5)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // sas vertiklas svtrias\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    const count = 6;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.3);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava waterfall frames\nexport const createLavaWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent lava colors\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(255, 170, 0, 0.6)');\n    g.addColorStop(0.5, 'rgba(255, 204, 0, 0.6)');\n    g.addColorStop(1, 'rgba(255, 170, 0, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated lava streaks\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';\n    const count = 5;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.4);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive water frames\nexport const createRadioactiveWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 12;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient (toxic green)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#1a5c1a');\n    g.addColorStop(1, '#0d2e0d');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    \n    // Bubbles\n    ctx.globalAlpha = 0.6;\n    ctx.fillStyle = '#32cd32';\n    const bubbleCount = 4;\n    for (let k = 0; k < bubbleCount; k++) {\n      const bx = Math.floor((k * 137 + i * 2) % tileSize);\n      const by = Math.floor((tileSize + k * 43 - (t * tileSize + k * 10)) % tileSize);\n      const size = 1 + (Math.sin(t * Math.PI + k) * 0.5 + 0.5) * 2;\n      ctx.beginPath();\n      ctx.arc(bx, by, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Glow streaks\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#adff2f';\n    for (let b = 0; b < 2; b++) {\n      const y = Math.floor((tileSize / 2) * b + Math.sin((t + b * 0.5) * Math.PI * 2) * (tileSize * 0.1));\n      ctx.fillRect(0, y, tileSize, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive waterfall frames\nexport const createRadioactiveWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 16; // more frames for slower motion\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(26, 92, 26, 0.6)');\n    g.addColorStop(0.5, 'rgba(50, 205, 50, 0.6)');\n    g.addColorStop(1, 'rgba(26, 92, 26, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    ctx.fillStyle = 'rgba(173, 255, 47, 0.5)';\n    const count = 4; // fewer streaks\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.2);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3, minWidth = 0, minHeight = 0 }) {\n    if (!this.container) return;\n    this.clear();\n\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = w;\n    solid.height = h;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: w, height: h });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = h / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight, minWidth = 0, minHeight = 0) {\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = w;\n      this.bgSprite.height = h;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = w;\n      this.imgSprite.height = h;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = h / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl, minWidth = 0, minHeight = 0 } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n      minWidth,\n      minHeight\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const resize = (worldWidth, worldHeight, minWidth = 0, minHeight = 0) => {\n    if (parallaxHelper) {\n      parallaxHelper.resize(worldWidth, worldHeight, minWidth, minHeight);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    resize,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container, Text, Rectangle } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n\n  // Static sprite sheet frame (grid-based)\n  if (!spr && def.spriteSheet && def.spriteSheet.enabled && def.texture && Number.isFinite(Number(def.spriteSheet.frameIndex))) {\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    if (source && source.width > 1 && source.height > 1) {\n      const totalSprites = Math.max(1, Number(def.spriteSheet.totalSprites) || 1);\n      const columns = Math.max(1, Number(def.spriteSheet.columns) || 1);\n      const rows = Math.ceil(totalSprites / columns);\n      const frameWidth = Number(def.spriteSheet.frameWidth) || (source.width / columns);\n      const frameHeight = Number(def.spriteSheet.frameHeight) || (source.height / rows);\n      const frameIndex = Math.max(0, Math.min(totalSprites - 1, Number(def.spriteSheet.frameIndex)));\n      const col = frameIndex % columns;\n      const row = Math.floor(frameIndex / columns);\n      const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n      spr = new Sprite(new Texture({ source, frame: rect }));\n    }\n  }\n\n  // Ja nav tekstru masva vai tas ir tuks, minm parasto tekstru\n  if (!spr && def.texture) {\n    const tex = getTexture(def.texture);\n    if (tex) {\n      spr = new Sprite(tex);\n    }\n  }\n\n  // Ja joprojm nav spr (piemram, nav tekstras), prbaudm editorIcon\n  if (!spr && def.editorIcon) {\n    spr = new Text({\n        text: def.editorIcon,\n        style: {\n            fontSize: 24,\n            fill: 0xffffff,\n            fontWeight: 'bold',\n            dropShadow: true,\n            dropShadowColor: 0x000000,\n            dropShadowBlur: 4,\n            dropShadowDistance: 2\n        }\n    });\n    // Centrjam tekstu tile ietvaros\n    spr.anchor.set(0.5, 0.5);\n    // T k ms lietojam anchor 0.5, mums bs jpielgo pozcija vlk vai eit\n    // Bet buildSpriteFromDef parasti atgrie objektu, kura anchor ir (0,0) pc noklusjuma\n    // lai tas atbilstu tileSize pozicionanai.\n    // Tpc iestatsim anchor uz 0, bet nedaudz nobdsim?\n    // Labk lietot anchor 0.5 un layerBuilder- pieskaitt tileSize/2.\n  }\n\n  if (!spr) {\n    spr = new Sprite(Texture.WHITE);\n  }\n\n  if (spr instanceof Sprite) {\n    spr.anchor.set(0, 0);\n  } else if (spr instanceof Text) {\n    // Tekstam ms gribam, lai tas btu centr, tpc atstjam 0.5\n  }\n  \n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = Math.round(dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth));\n  container.y = Math.round(playerState.y || 0);\n};\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef, isQuicksandDef, isWaterfallDef, isLavaWaterfallDef, isRadioactiveWaterDef, isRadioactiveWaterfallDef, createWaterFrames, createLavaFrames, createQuicksandFrames } from './liquidRendering';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const { bgRef, objBehindRef, objFrontRef, roomBgRef, roomObjBehindRef, roomObjFrontRef, secretLayerRef } = refs;\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous and destroy old children to prevent memory leaks/ticker buildup\n  const safeDestroy = (container) => {\n    if (!container) return;\n    const children = container.removeChildren();\n    children.forEach(child => {\n      try {\n        // Destroy child but KEEP textures in cache\n        child.destroy({ children: true, texture: false });\n      } catch (e) {}\n    });\n  };\n\n  safeDestroy(bgRef);\n  safeDestroy(objBehindRef);\n  safeDestroy(objFrontRef);\n  safeDestroy(roomBgRef);\n  safeDestroy(roomObjBehindRef);\n  safeDestroy(roomObjFrontRef);\n  safeDestroy(secretLayerRef?.below);\n  safeDestroy(secretLayerRef?.above);\n\n  const secretOverlays = {\n    below: new Map(),\n    above: new Map()\n  };\n\n  // 1. Render main map\n  renderMapContent(refs, options, 0, 0, secretOverlays, bgRef, objBehindRef, objFrontRef);\n\n  // 2. Render active rooms\n  const { activeRoomIds, maps, objectMetadata, secretMapData, mapWidth, tileSize } = options;\n  if (activeRoomIds && activeRoomIds.length > 0 && maps && objectMetadata && secretMapData) {\n    activeRoomIds.forEach(roomId => {\n      const roomMap = maps[roomId];\n      if (!roomMap) return;\n\n      // Find the room_area on the current map that links to this room\n      const roomAreaIndex = Object.keys(objectMetadata).find(idx => \n        secretMapData[idx] === 'room_area' && objectMetadata[idx].linkedMapId === roomId\n      );\n\n      if (roomAreaIndex !== undefined) {\n        const idx = parseInt(roomAreaIndex);\n        const ox = Math.round((idx % mapWidth) * tileSize);\n        const oy = Math.round(Math.floor(idx / mapWidth) * tileSize);\n        \n        const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n        \n        const roomOptions = {\n          ...options,\n          mapWidth: roomMap.mapWidth || roomMap.width,\n          mapHeight: roomMap.mapHeight || roomMap.height,\n          tileMapData: roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [],\n          objectMapData: roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [],\n          secretMapData: roomSecrets,\n          objectMetadata: roomMap.objectMetadata || {},\n          mapType: 'room',\n          backgroundColor: roomMap.selectedBackgroundColor,\n          activeRoomIds: [] // Avoid recursion\n        };\n\n        renderMapContent(refs, roomOptions, ox, oy, secretOverlays, roomBgRef, roomObjBehindRef, roomObjFrontRef);\n      }\n    });\n  }\n\n  // 3. Render collected secret overlays\n  renderSecretOverlays(refs, options, secretOverlays);\n};\n\nconst renderMapContent = (refs, options, offsetX, offsetY, secretOverlays, targetBg, targetObjBehind, targetObjFront) => {\n  const {\n    mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData,\n    revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType,\n    activeRoomIds, maps\n  } = options;\n\n  const { secretLayerRef } = refs;\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Pre-calculate indices covered by active rooms to hide main map content under them\n  const activeRoomIndices = new Set();\n  const roomWindowIndices = new Set(); // Store indices where rooms have windows\n\n  if (mapType !== 'room' && activeRoomIds && activeRoomIds.length > 0 && maps) {\n      Object.entries(objectMetadata || {}).forEach(([idxStr, meta]) => {\n          const idx = parseInt(idxStr);\n          if (secretMapData?.[idx] === 'room_area' && meta?.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n              const roomMap = maps[meta.linkedMapId];\n              if (!roomMap) return;\n\n              const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n              const rw = meta.width || 1;\n              const rh = meta.height || 1;\n              const rx = idx % mapWidth;\n              const ry = Math.floor(idx / mapWidth);\n              const rMapW = roomMap.mapWidth || roomMap.width || rw;\n\n              for (let dy = 0; dy < rh; dy++) {\n                  for (let dx = 0; dx < rw; dx++) {\n                      const worldIdx = (ry + dy) * mapWidth + (rx + dx);\n                      const localIdx = dy * rMapW + dx;\n                      \n                      // In the main map context, roomWindowIndices are spots where we DON'T hide the main map\n                      // because the room has a \"hole\" (window) there.\n                      // A \"hole\" is defined as no tile AND no object in the room map.\n                      const roomTiles = roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [];\n                      const roomObjs = roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [];\n                      \n                      if (!roomTiles[localIdx] && !roomObjs[localIdx]) {\n                          roomWindowIndices.add(worldIdx);\n                          activeRoomIndices.add(worldIdx); // Also hide main map tiles here to see background through windows\n                      } else {\n                          activeRoomIndices.add(worldIdx);\n                      }\n                  }\n              }\n          }\n      });\n  }\n\n  // Add background color for rooms\n  if (mapType === 'room') {\n    const bgColorStr = options.backgroundColor || '#1a1a1a';\n    const bgColorHex = bgColorStr.startsWith('#') ? \n        parseInt(bgColorStr.substring(1), 16) : \n        0x1a1a1a;\n    \n    const roomBg = new Graphics();\n    const floorTileIds = new Set(tileMapData.filter(id => id));\n    const floorObjIds = new Set(objectMapData.filter(id => id && !id.includes('player')));\n\n    for (let i = 0; i < mapWidth * mapHeight; i++) {\n        const id = tileMapData[i];\n        const objId = objectMapData[i];\n        \n        // Window logic: if there is no tile AND no object, it's a window (transparent)\n        // Be very strict about what counts as content\n        const hasContent = (id && id !== \"0\") || (objId && objId !== \"0\" && !objId.includes('player'));\n\n        if (hasContent) {\n            const tx = i % mapWidth;\n            const ty = Math.floor(i / mapWidth);\n            const x = offsetX + tx * tileSize;\n            const y = offsetY + ty * tileSize;\n            \n            // Use a slightly larger rect (0.5px) to prevent gaps/bleeding between tiles\n            // but keep the overall room boundary sharp\n            roomBg.rect(x - 0.25, y - 0.25, tileSize + 0.5, tileSize + 0.5);\n        }\n    }\n    roomBg.fill({ color: bgColorHex, alpha: 1 });\n    targetBg.addChild(roomBg);\n  }\n\n  // Background tiles\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    const secretId = secretMapData?.[i];\n\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    // Hide content if it's under an active room\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area'; // Don't treat room_area as a classic secret filter if it's used as a window\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n\n    if (isInSecretArea && isSecretRevealed) {\n      const filterColor = secretDef?.filterColorInGame || secretDef?.filterColor || 'rgba(0, 0, 0, 0.6)';\n      const renderAbove = secretDef?.renderAbovePlayer;\n      const key = `${x},${y}`;\n      if (renderAbove) {\n        secretOverlays.above.set(key, filterColor);\n      } else {\n        secretOverlays.below.set(key, filterColor);\n      }\n    }\n\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      renderOnSecretLayer = true;\n    } else if (isInSecretArea && isSecretRevealed) {\n      renderOnSecretLayer = true;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def) || isWaterfallDef(def) || isLavaWaterfallDef(def) || isRadioactiveWaterDef(def) || isRadioactiveWaterfallDef(def) || def.type === 'entity' || def.subtype === 'platform') {\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    if (renderOnSecretLayer) {\n      let backingSprite;\n      if (frames && frames.length > 0) {\n        backingSprite = new AnimatedSprite(frames);\n        backingSprite.animationSpeed = sprite.animationSpeed;\n        backingSprite.play();\n      } else if (sprite.texture) {\n        backingSprite = new Sprite(sprite.texture);\n      }\n\n      if (backingSprite) {\n        backingSprite.x = x;\n        backingSprite.y = y;\n        backingSprite.width = tileSize;\n        backingSprite.height = tileSize;\n        targetBg.addChild(backingSprite);\n      }\n\n      const backing = new Graphics();\n      backing.rect(x, y, tileSize, tileSize);\n      backing.fill({ color: 0x000000, alpha: 0.7 });\n      targetBg.addChild(backing);\n\n      sprite.alpha = 0.4;\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        targetBg.addChild(sprite);\n      }\n    } else {\n      targetBg.addChild(sprite);\n    }\n  }\n\n  // Objects\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n\n    const secretId = secretMapData?.[i];\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    const def = getDef(id);\n    if (!def || def.type === 'entity' || def.subtype === 'platform' || def.subtype === 'pushable' || def.isPushable) continue;\n\n    const meta = (objectMetadata && objectMetadata[i]) || {};\n    const maxH = def.maxHealth || 100;\n    const health = meta.health !== undefined ? meta.health : maxH;\n\n    let visualElement;\n    if (def.spriteSheet && def.spriteSheet.enabled) {\n      const totalSprites = def.spriteSheet.totalSprites || 1;\n      const columns = def.spriteSheet.columns || totalSprites;\n      \n      const healthPercent = Math.max(0, Math.min(100, (health / maxH) * 100));\n      let frameIndex = 0;\n      \n      if (meta.currentFrame !== undefined) {\n        frameIndex = meta.currentFrame;\n      } else if (def.subtype === 'door' && mapType === 'room') {\n        frameIndex = def.interaction?.frames?.inside || 2;\n      } else if (Number.isFinite(Number(def.spriteSheet?.frameIndex))) {\n        frameIndex = Number(def.spriteSheet.frameIndex);\n      } else {\n        frameIndex = Math.floor((1 - healthPercent / 100) * (totalSprites - 1));\n      }\n      \n      frameIndex = Math.max(0, Math.min(totalSprites - 1, frameIndex));\n\n      const baseTexture = getTexture(def.texture);\n      const source = baseTexture?.source;\n      if (source && source.width > 1) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const frameWidth = texWidth / columns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / columns);\n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        visualElement = new Sprite(new Texture({ source: source, frame: rect }));\n      } else {\n        visualElement = buildSpriteFromDef(def);\n      }\n    } else {\n      visualElement = buildSpriteFromDef(def);\n    }\n\n    if (!visualElement) continue;\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n    \n    const renderOffsetX = Number(def.render?.offsetX) || 0;\n    const renderOffsetY = Number(def.render?.offsetY) || 0;\n    const overlapX = Number(def.render?.overlapX) || 0;\n    const overlapY = Number(def.render?.overlapY) || 0;\n    if (visualElement.anchor && visualElement.anchor.x === 0.5) {\n      visualElement.x = tileSize / 2 + renderOffsetX - overlapX / 2;\n      visualElement.y = tileSize / 2 + renderOffsetY - overlapY / 2;\n    } else {\n      visualElement.x = renderOffsetX - overlapX / 2;\n      visualElement.y = renderOffsetY - overlapY / 2;\n    }\n    \n    const tileW = meta.width || def.width || 1;\n    const tileH = meta.height || def.height || 1;\n    const objWidth = tileW * tileSize;\n    const objHeight = tileH * tileSize;\n    visualElement.width = objWidth + overlapX;\n    visualElement.height = objHeight + overlapY;\n\n    const container = new Container();\n    const isLargeDecoration = def.type === 'decoration' && (tileW > 1 || tileH > 1);\n    const anchorOffsetX = isLargeDecoration ? -Math.floor(tileW / 2) * tileSize : 0;\n    const anchorOffsetY = isLargeDecoration ? -(tileH - 1) * tileSize : 0;\n    container.x = x + anchorOffsetX;\n    container.y = y + anchorOffsetY;\n    container.isRoomContent = mapType === 'room';\n    \n    const isWeatherTrigger = def.type === 'weather_trigger';\n    const isMessageTrigger = def.type === 'message_trigger';\n    const isWolfSecret = def.type === 'wolf_secret';\n    const shouldShowAnyway = (isWeatherTrigger || isMessageTrigger || isWolfSecret) && (isEditor || isEditorPlayMode);\n    \n    if (def.isHiddenInGame && !isEditor && !shouldShowAnyway) {\n        container.visible = false;\n    }\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    if (isInSecretArea && !isSecretRevealed && !isEditor) {\n      container.visible = false;\n    }\n\n    container.addChild(visualElement);\n\n    if (def.isDestructible && health < maxH && health > 0) {\n      try {\n        const hb = new HealthBar({\n          width: objWidth,\n          height: 4,\n          offsetX: 0,\n          offsetY: -5\n        });\n        hb.update(health, maxH);\n        container.addChild(hb);\n      } catch (e) {}\n    }\n\n    const renderAbove = meta.renderAbovePlayer !== undefined ? !!meta.renderAbovePlayer : !!def.renderAbovePlayer;\n    if (renderAbove) {\n      targetObjFront.addChild(container);\n    } else {\n      targetObjBehind.addChild(container);\n    }\n  }\n};\n\nconst renderSecretOverlays = (refs, options, overlays) => {\n  const { tileSize } = options;\n  const { secretLayerRef } = refs;\n\n  const drawOverlay = (map, container) => {\n    if (!container || map.size === 0) return;\n    const overlay = new Graphics();\n    map.forEach((filterColor, key) => {\n      const [x, y] = key.split(',').map(Number);\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    container.addChild(overlay);\n  };\n\n  drawOverlay(overlays.below, secretLayerRef?.below);\n  drawOverlay(overlays.above, secretLayerRef?.above);\n};\n","import { Container, Text } from 'pixi.js';\nimport floatConfig from '../../../../assets/json/system/floating_text.json';\n\nexport const createFloatingTextManager = (layer) => {\n  const items = [];\n  const cfg = floatConfig || {};\n  const defaultCfg = cfg.default || {};\n  const critCfg = cfg.crit || {};\n\n  const add = ({\n    x,\n    y,\n    text,\n    color = '#ff3b3b',\n    fontSize = 14,\n    ttlMs = 900,\n    amount,\n    crit\n  }) => {\n    if (!layer || !Number.isFinite(x) || !Number.isFinite(y) || !text) return;\n\n    const amountValue = Number.isFinite(amount) ? amount : null;\n    const critThreshold = Number.isFinite(critCfg.threshold) ? critCfg.threshold : null;\n    const isCrit = !!crit || (amountValue !== null && critThreshold !== null && Math.abs(amountValue) >= critThreshold);\n\n    const baseColor = defaultCfg.color || color;\n    const finalColor = isCrit ? (critCfg.color || baseColor) : baseColor;\n    const finalFontSize = isCrit ? (critCfg.fontSize || Math.round((defaultCfg.fontSize || fontSize) * 1.2)) : (defaultCfg.fontSize || fontSize);\n    const finalTtl = isCrit ? (critCfg.ttlMs || defaultCfg.ttlMs || ttlMs) : (defaultCfg.ttlMs || ttlMs);\n    const riseSpeed = isCrit ? (critCfg.riseSpeed || defaultCfg.riseSpeed || 0.04) : (defaultCfg.riseSpeed || 0.04);\n    const jitterX = Number.isFinite(defaultCfg.jitterX) ? defaultCfg.jitterX : 6;\n    const jitterY = Number.isFinite(defaultCfg.jitterY) ? defaultCfg.jitterY : 2;\n    const prefix = isCrit && typeof critCfg.prefix === 'string' ? critCfg.prefix : '';\n    const suffix = isCrit && typeof critCfg.suffix === 'string' ? critCfg.suffix : '';\n    const finalText = `${prefix}${text}${suffix}`;\n\n    const label = new Text({\n      text: String(finalText),\n      style: {\n        fontFamily: 'monospace',\n        fontSize: finalFontSize,\n        fill: finalColor,\n        stroke: '#000000',\n        strokeThickness: 2,\n        dropShadow: true,\n        dropShadowColor: '#000000',\n        dropShadowBlur: 2,\n        dropShadowDistance: 1\n      }\n    });\n\n    label.anchor.set(0.5, 1);\n    const jitterXValue = (Math.random() * 2 - 1) * jitterX;\n    const jitterYValue = (Math.random() * 2 - 1) * jitterY;\n    label.position.set(x + jitterXValue, y + jitterYValue);\n    layer.addChild(label);\n\n    items.push({\n      label,\n      ttl: finalTtl,\n      total: finalTtl,\n      vy: -riseSpeed\n    });\n  };\n\n  const update = (deltaMs) => {\n    if (!items.length) return;\n    for (let i = items.length - 1; i >= 0; i--) {\n      const item = items[i];\n      item.ttl -= deltaMs;\n      if (item.ttl <= 0) {\n        try { item.label.destroy(); } catch {}\n        items.splice(i, 1);\n        continue;\n      }\n      item.label.y += item.vy * deltaMs;\n      item.label.alpha = Math.max(0, item.ttl / item.total);\n    }\n  };\n\n  return { add, update };\n};\n\nexport const createFloatingTextLayer = () => new Container();\n","import { Container, Graphics } from 'pixi.js';\n\nexport const createBreakEffectLayer = () => {\n  const layer = new Container();\n  layer.sortableChildren = true;\n  return layer;\n};\n\nexport const createBreakEffectManager = (layer) => {\n  const particles = [];\n\n  const add = ({ x, y, config }) => {\n    if (!layer || !config) return;\n    const count = Math.max(1, Number(config.count) || 12);\n    const speed = Math.max(0.2, Number(config.speed) || 2);\n    const lifeMs = Math.max(120, Number(config.lifeMs) || 600);\n    const size = Math.max(1, Number(config.size) || 2);\n    const gravity = Number.isFinite(Number(config.gravity)) ? Number(config.gravity) : 0.02;\n    const shape = config.shape === 'circle' ? 'circle' : 'square';\n    const angleRange = Array.isArray(config.angleRange) && config.angleRange.length >= 2 ? config.angleRange : null;\n    const colors = Array.isArray(config.colors) && config.colors.length ? config.colors : [0xffffff];\n    const chunks = config.chunks && typeof config.chunks === 'object' ? config.chunks : null;\n\n    for (let i = 0; i < count; i++) {\n      const angle = angleRange\n        ? (Number(angleRange[0]) + Math.random() * (Number(angleRange[1]) - Number(angleRange[0])))\n        : (Math.random() * Math.PI * 2);\n      const sp = speed * (0.5 + Math.random() * 0.9);\n      const g = new Graphics();\n      if (shape === 'circle') {\n        g.circle(0, 0, size * 0.6);\n      } else {\n        g.rect(-size / 2, -size / 2, size, size);\n      }\n      g.fill({ color: colors[i % colors.length], alpha: 1 });\n      g.x = x;\n      g.y = y;\n      layer.addChild(g);\n      particles.push({\n        g,\n        x,\n        y,\n        vx: Math.cos(angle) * sp,\n        vy: Math.sin(angle) * sp,\n        life: lifeMs,\n        maxLife: lifeMs,\n        gravity\n      });\n    }\n\n    if (chunks) {\n      const chunkCount = Math.max(0, Number(chunks.count) || 0);\n      const chunkSpeed = Math.max(0.3, Number(chunks.speed) || speed * 1.2);\n      const chunkLife = Math.max(160, Number(chunks.lifeMs) || lifeMs * 1.1);\n      const chunkSize = Math.max(size, Number(chunks.size) || size * 1.6);\n      const chunkGravity = Number.isFinite(Number(chunks.gravity)) ? Number(chunks.gravity) : gravity;\n      const chunkShape = chunks.shape === 'square' ? 'square' : 'circle';\n      const chunkAngle = Array.isArray(chunks.angleRange) && chunks.angleRange.length >= 2 ? chunks.angleRange : angleRange;\n      const chunkColors = Array.isArray(chunks.colors) && chunks.colors.length ? chunks.colors : colors;\n\n      for (let i = 0; i < chunkCount; i++) {\n        const angle = chunkAngle\n          ? (Number(chunkAngle[0]) + Math.random() * (Number(chunkAngle[1]) - Number(chunkAngle[0])))\n          : (Math.random() * Math.PI * 2);\n        const sp = chunkSpeed * (0.6 + Math.random() * 0.9);\n        const g = new Graphics();\n        if (chunkShape === 'circle') {\n          g.circle(0, 0, chunkSize * 0.6);\n        } else {\n          g.rect(-chunkSize / 2, -chunkSize / 2, chunkSize, chunkSize);\n        }\n        g.fill({ color: chunkColors[i % chunkColors.length], alpha: 1 });\n        g.x = x;\n        g.y = y;\n        layer.addChild(g);\n        particles.push({\n          g,\n          x,\n          y,\n          vx: Math.cos(angle) * sp,\n          vy: Math.sin(angle) * sp,\n          life: chunkLife,\n          maxLife: chunkLife,\n          gravity: chunkGravity\n        });\n      }\n    }\n  };\n\n  const update = (dt) => {\n    if (!particles.length) return;\n    const delta = Math.max(0, Number(dt) || 0);\n    for (let i = particles.length - 1; i >= 0; i--) {\n      const p = particles[i];\n      p.life -= delta;\n      if (p.life <= 0) {\n        if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n        particles.splice(i, 1);\n        continue;\n      }\n      p.x = (p.x || 0) + p.vx * (delta / 16.67);\n      p.y = (p.y || 0) + p.vy * (delta / 16.67);\n      p.vy += (Number(p.gravity) || 0.02) * (delta / 16.67);\n      if (p.g) {\n        p.g.x = p.x;\n        p.g.y = p.y;\n        p.g.alpha = Math.max(0, p.life / p.maxLife);\n      }\n    }\n  };\n\n  const clear = () => {\n    for (const p of particles) {\n      if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n    }\n    particles.length = 0;\n  };\n\n  return { add, update, clear };\n};\n\nexport default {\n  createBreakEffectLayer,\n  createBreakEffectManager\n};\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = getDefById(registryItems, id);\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.lava_waterfall ? 'lava_waterfall' :\n               (def.flags.radioactive_waterfall ? 'radioactive_waterfall' :\n               (def.flags.waterfall ? 'waterfall' :\n               (def.flags.radioactive_water ? 'radioactive_water' :\n               (def.flags.quicksand ? 'quicksand' :\n               (def.flags.lava ? 'lava' :\n               (def.flags.water ? 'water' : 'liquid'))))));\n  const overlayColorRaw = def?.liquid?.overlay?.color ?? def?.liquid?.overlayColor ?? def?.tintBelowSurface;\n  const overlayAlphaRaw = def?.liquid?.overlay?.alpha ?? def?.liquid?.overlayAlpha;\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    overlay: {\n      color: Number(overlayColorRaw),\n      alpha: Number(overlayAlphaRaw)\n    },\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    },\n    resources: def?.liquid?.resources || {}\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  const defaultOverlay = (() => {\n    if (type.includes('lava')) return { color: 10914816, alpha: 0.25 };\n    if (type === 'quicksand') return { color: 10916187, alpha: 0.2 };\n    if (type === 'radioactive_water' || type === 'radioactive_waterfall') return { color: 1727514, alpha: 0.18 };\n    return { color: 1919093, alpha: 0.15 };\n  })();\n  const rawOverlayColor = candidate.params?.overlay?.color;\n  const rawOverlayAlpha = candidate.params?.overlay?.alpha;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    overlay: {\n      color: Number.isFinite(rawOverlayColor) ? rawOverlayColor : defaultOverlay.color,\n      alpha: Number.isFinite(rawOverlayAlpha) ? rawOverlayAlpha : defaultOverlay.alpha\n    },\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    },\n    resources: candidate.params?.resources || {}\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","import React, { useEffect, useRef, useMemo, useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets, BlurFilter, ColorMatrixFilter, Texture, Sprite } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder, LavaRain as WeatherLavaRain, RadioactiveFog as WeatherRadioactiveFog, MeteorRain as WeatherMeteorRain } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, BubbleFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { syncEntities, cleanupEntities } from './entityManager';\nimport { rebuildLayers } from './layerBuilder';\nimport { createFloatingTextLayer, createFloatingTextManager } from './floatingTextManager';\nimport { createBreakEffectLayer, createBreakEffectManager } from './breakEffectManager';\nimport { getLiquidAtPixel } from '../../../../engine/liquids/liquidUtils';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({\n  skipCacheIdWarning: true,\n  preferCreateImageBitmap: false, // Prevents WebGL warning: texImage: Alpha-premult and y-flip are deprecated\n});\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\nconst LIQUID_SURFACE_MAP = [\n  { key: 'lava', surface: 'lava' },\n  { key: 'radioactive', surface: 'radiation' },\n  { key: 'quicksand', surface: 'quicksand' },\n  { key: 'water', surface: 'water' },\n];\n\nconst toSurfaceType = (liquidType) => {\n  if (!liquidType) return null;\n  for (const entry of LIQUID_SURFACE_MAP) {\n    if (liquidType.includes(entry.key)) return entry.surface;\n  }\n  return null;\n};\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = EMPTY_ARRAY,\n  objectMapData = EMPTY_ARRAY,\n  secretMapData = EMPTY_ARRAY,\n  revealedSecrets = EMPTY_ARRAY,\n  registryItems = EMPTY_ARRAY,\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  weatherLavaRain = 0,\n  weatherRadioactiveFog = 0,\n  weatherMeteorRain = 0,\n  projectiles = EMPTY_ARRAY,\n  healthBarEnabled = true,\n  objectMetadata = EMPTY_OBJECT,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n  isEditor = false,\n  isEditorPlayMode = false,\n  mapType = 'overworld',\n  activeRoomIds = EMPTY_ARRAY,\n  maps = EMPTY_OBJECT,\n  showGrid = false,\n  renderLayers = null, // null means all layers, otherwise an array of layer names to show\n  pointerEvents = 'auto',\n  onWeatherEffectHit = null,\n  roomBlurEnabled = true,\n  debugOverlayEnabled = false,\n}) => {\n  const [isPixiReady, setIsPixiReady] = useState(false);\n\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const cameraPosRef = useRef({ x: 0, y: 0 });\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const roomBgRef = useRef(null);\n  const roomObjBehindRef = useRef(null);\n  const roomObjFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerLayerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidBgLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null, fog: null, lavaRain: null, radioactiveFog: null, meteorRain: null });\n  const weatherPropsRef = useRef({ rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0, lavaRain: 0, radioactiveFog: 0, meteorRain: 0 });\n  const tileMapDataRef = useRef(tileMapData);\n  const registryItemsRef = useRef(registryItems);\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const entitiesLayerRef = useRef(null);\n  const entitySpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef(EMPTY_ARRAY);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0, targetAlpha: 0, currentAlpha: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const bubbleFxRef = useRef(null);\n  const fishBubbleStateRef = useRef(new Map());\n  const entityWaterStateRef = useRef(new Map());\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n  const gridRef = useRef(null);\n  const showGridRef = useRef(showGrid);\n  const roomBlurEnabledRef = useRef(roomBlurEnabled);\n  const blurFilterRef = useRef(new BlurFilter({ strength: 0 }));\n  const darkenFilterRef = useRef(new ColorMatrixFilter());\n  const roomBrightnessFilterRef = useRef(new ColorMatrixFilter());\n  const vignetteRef = useRef(null);\n  const floatingLayerRef = useRef(null);\n  const debugLayerRef = useRef(null);\n  const debugEnabledRef = useRef(!!debugOverlayEnabled);\n  const floatingManagerRef = useRef(null);\n  const breakFxLayerRef = useRef(null);\n  const breakFxManagerRef = useRef(null);\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { showGridRef.current = showGrid; }, [showGrid]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { roomBlurEnabledRef.current = roomBlurEnabled; }, [roomBlurEnabled]);\n  useEffect(() => { debugEnabledRef.current = !!debugOverlayEnabled; }, [debugOverlayEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n  useEffect(() => { tileMapDataRef.current = tileMapData; }, [tileMapData]);\n  useEffect(() => { registryItemsRef.current = registryItems; }, [registryItems]);\n\n  // Sync weather props to ref for systems to read live\n  useEffect(() => {\n    weatherPropsRef.current = {\n      rain: Number(weatherRain) || 0,\n      snow: Number(weatherSnow) || 0,\n      clouds: Number(weatherClouds) || 0,\n      fog: Number(weatherFog) || 0,\n      thunder: Number(weatherThunder) || 0,\n      lavaRain: Number(weatherLavaRain) || 0,\n      radioactiveFog: Number(weatherRadioactiveFog) || 0,\n      meteorRain: Number(weatherMeteorRain) || 0,\n    };\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl,\n      minWidth: appRef.current?.screen?.width || 0,\n      minHeight: appRef.current?.screen?.height || 0\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      if (appRef.current) return;\n\n      const app = new Application();\n      try {\n        await app.init({\n          resizeTo: mountRef.current,\n          backgroundAlpha: 0,\n          antialias: false,\n          autoDensity: true,\n        });\n\n        // Enable z-index sorting for the main stage\n        app.stage.sortableChildren = true;\n\n        if (destroyed) {\n          app.destroy(true, { children: true, texture: true });\n          return;\n        }\n\n        if (!app.renderer) return;\n\n        appRef.current = app;\n        app.stage.sortableChildren = true;\n\n        // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const roomBg = new Container();\n      const roomObjBehind = new Container();\n      const roomObjFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const entitiesLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidBgLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const vignetteLayer = new Container();\n      const overlayLayer = new Container();\n      const floatingLayer = createFloatingTextLayer();\n      const breakFxLayer = createBreakEffectLayer();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      roomBg.zIndex = LAYERS.tiles + 1;\n      objBehind.zIndex = LAYERS.objBehind;\n      roomObjBehind.zIndex = LAYERS.objBehind + 1;\n      objFront.zIndex = LAYERS.objFront;\n      roomObjFront.zIndex = LAYERS.objFront + 1;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      entitiesLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidBgLayer.zIndex = LAYERS.liquidBackground;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      vignetteLayer.zIndex = LAYERS.overlay - 1;\n      overlayLayer.zIndex = LAYERS.overlay;\n      floatingLayer.zIndex = LAYERS.overlay + 1;\n      breakFxLayer.zIndex = LAYERS.overlay + 2;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      roomBgRef.current = roomBg;\n      roomObjBehindRef.current = roomObjBehind;\n      roomObjFrontRef.current = roomObjFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      playerLayerRef.current = playerLayer;\n      liquidBgLayerRef.current = liquidBgLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      entitiesLayerRef.current = entitiesLayer;\n      vignetteRef.current = vignetteLayer;\n      overlayLayerRef.current = overlayLayer;\n      floatingLayerRef.current = floatingLayer;\n      floatingManagerRef.current = createFloatingTextManager(floatingLayer);\n      breakFxLayerRef.current = breakFxLayer;\n      breakFxManagerRef.current = createBreakEffectManager(breakFxLayer);\n    \n      const gridGraphics = new Graphics();\n      gridRef.current = gridGraphics;\n      overlayLayer.addChild(gridGraphics);\n      overlayLayer.addChild(breakFxLayer);\n\n      const debugGraphics = new Graphics();\n      debugLayerRef.current = debugGraphics;\n      overlayLayer.addChild(debugGraphics);\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      const allLayersMap = {\n        background: [bg, bgAnim],\n        parallax: [parallaxLayer],\n        tiles: [bg, bgAnim], // Aliased for convenience\n        objects: [objBehind, objFront, secretBelowLayer, secretAboveLayer, entitiesLayer, projLayer],\n        player: [playerLayer],\n        weather: [weatherLayer, fogLayer],\n        liquids: [liquidBgLayer, liquidLayer, liquidFxLayer],\n        overlay: [overlayLayer]\n      };\n\n      if (renderLayers) {\n        renderLayers.forEach(layerName => {\n          const layers = allLayersMap[layerName];\n          if (layers) layers.forEach(l => {\n            if (!app.stage.children.includes(l)) app.stage.addChild(l);\n          });\n        });\n      } else {\n        // Add layers in z-order priority (back to front) for stability\n        app.stage.addChild(\n          parallaxLayer,\n          bg, bgAnim, \n          roomBg,\n          liquidBgLayer, \n          objBehind, \n          roomObjBehind,\n          secretBelowLayer, \n          playerLayer, \n          entitiesLayer, \n          projLayer, \n          objFront, \n          roomObjFront,\n          secretAboveLayer, \n          weatherLayer, \n          fogLayer, \n          liquidLayer, \n          liquidFxLayer,\n          vignetteLayer,\n          overlayLayer,\n          floatingLayer\n        );\n      }\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas - DROA PIEVIENOANA\n      if (mountRef.current && app.renderer && app.canvas) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.rect(0, 0, W, H);\n      g.fill({ color: 0x1d4875, alpha: 1 });\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffcc00, warn: 0xffaa00, danger: 0xff8800 };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas && app.renderer) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          // No need to manually rebuild here as the main useEffect will catch app state or we can just trigger a state change if needed.\n          // But Pixi v8 often recovers automatically. To be safe, we can force a rebuild by just waiting for next tick.\n        });\n      }\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n            mapWidth, \n            mapHeight, \n            tileSize,\n            bgContainer: liquidBgLayerRef.current\n          });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { bubbleFxRef.current = new BubbleFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n      } catch {}\n\n      rebuildParallax();\n\n      // Finalize initialization by setting appRef\n      // This will trigger the second useEffect to build layers and player\n      appRef.current = app;\n      setIsPixiReady(true);\n      app.ticker.add(() => {\n        if (gridRef.current) {\n          gridRef.current.clear();\n          if (showGridRef.current) {\n            for (let x = 0; x <= mapWidth; x++) {\n              gridRef.current.moveTo(x * tileSize, 0);\n              gridRef.current.lineTo(x * tileSize, mapHeight * tileSize);\n            }\n            for (let y = 0; y <= mapHeight; y++) {\n              gridRef.current.moveTo(0, y * tileSize);\n              gridRef.current.lineTo(mapWidth * tileSize, y * tileSize);\n            }\n            gridRef.current.stroke({ width: 0.5, color: 0xffffff, alpha: 0.2 });\n          }\n        }\n\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          updatePlayerSprite(\n            { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n            s,\n            tileSize,\n            hbEnabledRef.current\n          );\n        }\n\n        // Camera Follow\n        const sw = app.screen.width;\n        const sh = app.screen.height;\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        if (s) {\n          const targetX = (s.x || 0) + (s.width || tileSize) / 2;\n          const targetY = (s.y || 0) + (s.height || tileSize) / 2;\n\n          let camX = targetX - sw / 2;\n          let camY = targetY - sh / 2;\n\n          // Constraints with centering for small maps\n          if (worldW < sw) {\n            camX = (worldW - sw) / 2;\n          } else {\n            camX = Math.max(0, Math.min(camX, worldW - sw));\n          }\n\n          if (worldH < sh) {\n            camY = (worldH - sh) / 2;\n          } else {\n            camY = Math.max(0, Math.min(camY, worldH - sh));\n          }\n\n          // Use a small dead-zone/smooth follow to prevent 1px jitter from sub-pixel player movement\n          const lastCam = cameraPosRef.current || { x: camX, y: camY, rawX: camX, rawY: camY };\n          const smoothing = 0.2; // Lerp factor (0 to 1, higher is faster)\n          const rawX = lastCam.rawX !== undefined ? lastCam.rawX : camX;\n          const rawY = lastCam.rawY !== undefined ? lastCam.rawY : camY;\n          \n          const nextRawX = rawX + (camX - rawX) * smoothing;\n          const nextRawY = rawY + (camY - rawY) * smoothing;\n\n          cameraPosRef.current = { \n            x: Math.round(nextRawX), \n            y: Math.round(nextRawY),\n            rawX: nextRawX,\n            rawY: nextRawY\n          };\n          \n          app.stage.pivot.set(Math.round(nextRawX), Math.round(nextRawY));\n          \n          window.__PLAYER_POS__ = { x: s.x, y: s.y };\n\n          if (parallaxRef.current) {\n            parallaxRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          if (vignetteRef.current && vignetteRef.current.visible) {\n            vignetteRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          const f = parallaxFactorRef.current;\n          if (parallaxManagerRef.current) {\n            parallaxManagerRef.current.resize(worldW, worldH, sw, sh);\n            parallaxManagerRef.current.setScroll(nextRawX, f);\n          }\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        const swNow = app.screen.width;\n        const shNow = app.screen.height;\n\n        if (systems.rain) {\n          if (systems.rain.resize) systems.rain.resize(swNow, shNow);\n          systems.rain.update(dt);\n        }\n        if (systems.lavaRain) {\n          if (systems.lavaRain.resize) systems.lavaRain.resize(swNow, shNow);\n          systems.lavaRain.update(dt);\n        }\n        if (systems.snow) {\n          if (systems.snow.resize) systems.snow.resize(swNow, shNow);\n          systems.snow.update(dt);\n        }\n        if (systems.meteorRain) {\n          if (systems.meteorRain.resize) systems.meteorRain.resize(swNow, shNow);\n          systems.meteorRain.update(dt);\n        }\n        if (systems.clouds) {\n          if (systems.clouds.resize) systems.clouds.resize(swNow, shNow);\n          systems.clouds.update(dt);\n        }\n        if (systems.fog) {\n          if (systems.fog.resize) systems.fog.resize(swNow, shNow);\n          systems.fog.update(dt);\n        }\n        if (systems.radioactiveFog) {\n          if (systems.radioactiveFog.resize) systems.radioactiveFog.resize(swNow, shNow);\n          systems.radioactiveFog.update(dt);\n        }\n        if (systems.thunder) {\n          if (systems.thunder.resize) systems.thunder.resize(swNow, shNow);\n          systems.thunder.update(dt);\n        }\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { bubbleFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater/lava overlay with smooth fade-in/out\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n\n          // Safety check: ensure graphics object exists and is attached\n          if (u && (!u.g || u.g.destroyed)) {\n            const overlayL = overlayLayerRef.current;\n            if (overlayL) {\n              const g = new Graphics();\n              overlayL.addChild(g);\n              u.g = g;\n              u.currentAlpha = 0;\n              u.targetAlpha = 0;\n              u.time = 0;\n            }\n          }\n\n          if (u && u.g) {\n            // Check if player's head is in water/lava for full overlay\n            // If only body is in liquid, use a much subtler effect or none\n            const liquidType = sNow.liquidType;\n            const headUnder = !!(sNow && sNow.headUnderWater);\n            const inLiquid = !!(sNow && sNow.inWater);\n            \n            const overlayCfg = sNow.liquidOverlay || null;\n            const showOverlay = headUnder && !!overlayCfg;\n\n            let overlayColor = 0x1d4875;\n            let maxTargetAlpha = 0.15;\n\n            if (overlayCfg) {\n              if (Number.isFinite(overlayCfg.color)) overlayColor = overlayCfg.color;\n              if (Number.isFinite(overlayCfg.alpha)) maxTargetAlpha = overlayCfg.alpha;\n            }\n\n            if (showOverlay) {\n              u.time += dt;\n              // Target alpha with pulse effect\n              const pulseBase = (maxTargetAlpha * 0.8) + (maxTargetAlpha * 0.2) * Math.sin(u.time * 0.0025);\n              u.targetAlpha = pulseBase;\n\n              // Smooth fade-in: gradually approach target alpha\n              const fadeSpeed = 0.01; // Faster fade-in for immediate visibility\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeSpeed);\n\n              // Update color if liquid type changed (only when needed to avoid constant redraw)\n              if (!u.g.visible || u.lastLiquidType !== liquidType) {\n                u.g.clear();\n                u.g.rect(0, 0, mapWidth * tileSize, mapHeight * tileSize);\n                u.g.fill({ color: overlayColor, alpha: 1 });\n                u.lastLiquidType = liquidType;\n              }\n\n              u.g.visible = true;\n              u.g.alpha = u.currentAlpha;\n            } else {\n              // Smooth fade-out\n              u.targetAlpha = 0;\n              const fadeOutSpeed = 0.008; // Faster fade-out\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeOutSpeed);\n              u.g.alpha = u.currentAlpha;\n\n              if (u.currentAlpha < 0.01) {\n                u.currentAlpha = 0;\n                u.g.alpha = 0;\n                u.g.visible = false;\n                u.time = 0; // Reset time for next submersion\n              }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n\n        // Entities\n        const sNow = playerStateRef.current || {};\n        syncEntities(entitiesLayerRef.current, entitySpritesRef.current, sNow.entities, registryItems, tileSize);\n\n        try {\n          const ents = sNow.entities || [];\n          const tileData = tileMapDataRef.current;\n          const regs = registryItemsRef.current;\n          const seen = new Set();\n\n          for (const ent of ents) {\n            if (!ent) continue;\n            const id = ent.id;\n            seen.add(id);\n            const def = ent.def || {};\n            const cx = (ent.x || 0) + (ent.width || tileSize) * 0.5;\n            const cy = (ent.y || 0) + (ent.height || tileSize) * 0.5;\n            const liq = (tileData && regs)\n              ? getLiquidAtPixel(cx, cy, mapWidth, mapHeight, tileSize, tileData, regs)\n              : null;\n            const inWater = !!(liq && (liq.type === 'water' || liq.type === 'waterfall'));\n\n            const prev = entityWaterStateRef.current.get(id) || { inWater: false };\n            if (inWater && !prev.inWater && waterFxRef.current && liquidSystemRef.current) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', cx);\n              const strength = Math.min(2, Math.max(0.3, Math.abs(ent.vy || 0) * 0.08 + 0.4));\n              if (Number.isFinite(sy)) {\n                waterFxRef.current?.trigger({ x: cx, y: sy, strength, upward: false });\n                try { liquidSystemRef.current?.addWave?.('water', cx, Math.min(2.2, strength)); } catch {}\n              }\n            }\n            entityWaterStateRef.current.set(id, { inWater });\n\n            const isFish = def.subtype === 'fish' || def.ai?.type === 'fish' || def.fish;\n            const isAlive = Number(ent.health) > 0;\n            if (isFish && isAlive && !ent.isDormant && inWater && bubbleFxRef.current) {\n              const cfg = def.fish || {};\n              const interval = Math.max(200, Number(cfg.bubbleIntervalMs) || 900);\n              const jitter = Math.max(0, Number(cfg.bubbleJitter) || 0.4);\n              const state = fishBubbleStateRef.current.get(id) || { t: 0 };\n              state.t += dt;\n              if (state.t >= interval) {\n                state.t = 0;\n                const bx = cx + (Math.random() - 0.5) * tileSize * jitter;\n                const by = cy + (Math.random() - 0.5) * tileSize * jitter;\n                bubbleFxRef.current.trigger({\n                  x: bx,\n                  y: by,\n                  size: 2,\n                  rise: 0.025 + Math.random() * 0.02,\n                  life: 1000 + Math.random() * 400,\n                  drift: 0.015 + Math.random() * 0.02\n                });\n              }\n              fishBubbleStateRef.current.set(id, state);\n            } else if (isFish) {\n              fishBubbleStateRef.current.delete(id);\n            }\n          }\n\n          for (const key of fishBubbleStateRef.current.keys()) {\n            if (!seen.has(key)) fishBubbleStateRef.current.delete(key);\n          }\n          for (const key of entityWaterStateRef.current.keys()) {\n            if (!seen.has(key)) entityWaterStateRef.current.delete(key);\n          }\n        } catch {}\n\n        // Floating texts\n        floatingManagerRef.current?.update(dt);\n        // Break FX\n        breakFxManagerRef.current?.update(dt);\n      });\n    } catch (error) {\n      console.error('PixiStage init failed:', error);\n    }\n  };\n\n  init();\n\n  return () => {\n    destroyed = true;\n    if (appRef.current) {\n      const appToDestroy = appRef.current;\n      appRef.current = null;\n      appToDestroy.destroy(true, { children: true, texture: true });\n    }\n    try { liquidSystemRef.current?.destroy(); } catch {}\n    try { waterFxRef.current?.destroy(); } catch {}\n    try { bubbleFxRef.current?.destroy(); } catch {}\n    try { lavaEmbersRef.current?.destroy(); } catch {}\n    try { lavaSteamRef.current?.destroy(); } catch {}\n    try { parallaxManagerRef.current?.destroy(); } catch {}\n    parallaxManagerRef.current = null;\n    try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n    try {\n      weatherSystemsRef.current.rain?.destroy();\n      weatherSystemsRef.current.snow?.destroy();\n      weatherSystemsRef.current.fog?.destroy();\n    } catch {}\n    cleanupProjectiles(projectileSpritesRef.current);\n    cleanupEntities(entitySpritesRef.current);\n    clearTextureCache();\n  };\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      floatingManagerRef.current?.add(detail);\n    };\n    window.addEventListener('game-floating-text', handler);\n    return () => window.removeEventListener('game-floating-text', handler);\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      if (Number.isFinite(detail.x) && Number.isFinite(detail.y) && detail.config) {\n        breakFxManagerRef.current?.add(detail);\n      }\n    };\n    window.addEventListener('game-break-effect', handler);\n    return () => window.removeEventListener('game-break-effect', handler);\n  }, []);\n\n  useEffect(() => {\n    const isInsideRoom = activeRoomIds && activeRoomIds.length > 0;\n    const targetBlur = (isInsideRoom && roomBlurEnabled) ? 4 : 0;\n    const roomBrightness = isInsideRoom ? 1.25 : 1.0; // Slightly brighter interior\n    \n    if (blurFilterRef.current) {\n      blurFilterRef.current.strength = targetBlur;\n    }\n\n    if (darkenFilterRef.current) {\n      darkenFilterRef.current.reset();\n      if (isInsideRoom) {\n        // Desaturate and darken background when inside\n        darkenFilterRef.current.desaturate();\n        darkenFilterRef.current.brightness(0.75, true);\n      }\n    }\n\n    if (roomBrightnessFilterRef.current) {\n      roomBrightnessFilterRef.current.reset();\n      roomBrightnessFilterRef.current.brightness(roomBrightness, false);\n    }\n\n    if (vignetteRef.current) {\n      vignetteRef.current.visible = isInsideRoom;\n      if (isInsideRoom && !vignetteRef.current.children.length) {\n        const sw = appRef.current?.screen?.width || 800;\n        const sh = appRef.current?.screen?.height || 600;\n        \n        // Create programmatic vignette texture using canvas\n        const canvas = document.createElement('canvas');\n        canvas.width = 512;\n        canvas.height = 512;\n        const ctx = canvas.getContext('2d');\n        const grad = ctx.createRadialGradient(256, 256, 100, 256, 256, 360);\n        grad.addColorStop(0, 'rgba(0,0,0,0)');\n        grad.addColorStop(1, 'rgba(0,0,0,0.6)');\n        ctx.fillStyle = grad;\n        ctx.fillRect(0, 0, 512, 512);\n        \n        const tex = Texture.from(canvas);\n        const sprite = new Sprite(tex);\n        sprite.width = sw;\n        sprite.height = sh;\n        vignetteRef.current.addChild(sprite);\n        \n        // Also update sprite size on resize\n        vignetteRef.current._vignetteSprite = sprite;\n      }\n      \n      // Sync vignette position to camera (it should be screen-space)\n      if (isInsideRoom && vignetteRef.current._vignetteSprite) {\n        vignetteRef.current.x = cameraPosRef.current.x;\n        vignetteRef.current.y = cameraPosRef.current.y;\n        vignetteRef.current._vignetteSprite.width = appRef.current?.screen?.width || 800;\n        vignetteRef.current._vignetteSprite.height = appRef.current?.screen?.height || 600;\n      }\n    }\n\n    const layersToBlur = [\n      bgRef.current,\n      bgAnimRef.current,\n      objBehindRef.current,\n      objFrontRef.current,\n      secretLayerRef.current?.below,\n      secretLayerRef.current?.above,\n      liquidBgLayerRef.current,\n      liquidLayerRef.current,\n      parallaxRef.current\n    ];\n\n    layersToBlur.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        \n        // Blur filter\n        if (targetBlur > 0) {\n          if (!layer.filters.includes(blurFilterRef.current)) {\n            layer.filters = [...layer.filters, blurFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== blurFilterRef.current);\n        }\n\n        // Darken/Desaturate filter (Background only)\n        if (isInsideRoom) {\n          if (!layer.filters.includes(darkenFilterRef.current)) {\n            layer.filters = [...layer.filters, darkenFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== darkenFilterRef.current);\n        }\n\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n\n    // Apply brightness to room layers\n    const roomLayers = [\n      roomBgRef.current,\n      roomObjBehindRef.current,\n      roomObjFrontRef.current\n    ];\n\n    roomLayers.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        if (isInsideRoom) {\n          if (!layer.filters.includes(roomBrightnessFilterRef.current)) {\n            layer.filters = [...layer.filters, roomBrightnessFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== roomBrightnessFilterRef.current);\n        }\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n  }, [activeRoomIds, roomBlurEnabled]);\n\n  useEffect(() => {\n    const g = debugLayerRef.current;\n    if (!g) return;\n    g.clear();\n    if (!debugEnabledRef.current) {\n      g.visible = false;\n      return;\n    }\n    g.visible = true;\n\n    const getDefById = (id) => {\n      if (!id) return null;\n      const map = registryItems && registryItems.__byId;\n      if (map && typeof map.get === 'function') return map.get(id) || null;\n      return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    const tileCount = mapWidth * mapHeight;\n    for (let i = 0; i < tileCount; i++) {\n      const tileId = tileMapData[i];\n      if (!tileId) continue;\n      const def = getDefById(tileId);\n      if (!def) continue;\n      const x = (i % mapWidth) * tileSize;\n      const y = Math.floor(i / mapWidth) * tileSize;\n      const isLiquid = !!def.flags?.liquid;\n      const isLava = !!def.flags?.lava || !!def.flags?.lava_waterfall;\n      const isRadio = !!def.flags?.radioactive || !!def.flags?.radioactive_waterfall;\n      const hasCollision = !!def.collision;\n\n      if (isLiquid) {\n        const color = isLava ? 0xffa500 : (isRadio ? 0x32cd32 : 0x2ecdf1);\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color, alpha: 0.18 });\n      } else if (hasCollision) {\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color: 0xff3b3b, alpha: 0.12 });\n      }\n    }\n\n    if (Array.isArray(secretMapData) && secretMapData.length) {\n      g.stroke({ width: 1, color: 0xb57bff, alpha: 0.6 });\n      for (let i = 0; i < secretMapData.length; i++) {\n        if (secretMapData[i] !== 'room_area') continue;\n        const x = (i % mapWidth) * tileSize;\n        const y = Math.floor(i / mapWidth) * tileSize;\n        g.rect(x, y, tileSize, tileSize);\n      }\n    }\n  }, [debugOverlayEnabled, tileMapData, secretMapData, mapWidth, mapHeight, tileSize, registryItems]);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n\n    let active = true;\n\n    const runRebuild = async () => {\n        // Collect all textures to preload\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n            addUrl(def?.texture);\n            if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n            addUrl(playerVisuals.texture);\n            if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n            await Assets.load(urls);\n        }\n\n        if (!active || !appRef.current) return;\n\n        if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n            rebuildLayers(\n                { \n                  bgRef: bgRef.current, \n                  objBehindRef: objBehindRef.current, \n                  objFrontRef: objFrontRef.current, \n                  roomBgRef: roomBgRef.current,\n                  roomObjBehindRef: roomObjBehindRef.current,\n                  roomObjFrontRef: roomObjFrontRef.current,\n                  secretLayerRef: secretLayerRef.current \n                },\n                { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType, backgroundColor, activeRoomIds, maps }\n            );\n\n            // Rebuild player visuals if visuals changed or player not created yet\n            const pLayer = playerLayerRef.current;\n            if (pLayer) {\n                if (playerRef.current) {\n                    pLayer.removeChild(playerRef.current);\n                    try { playerRef.current.destroy({ children: true }); } catch {}\n                }\n                \n                const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerStateRef.current, tileSize);\n                pLayer.addChild(playerComponents.container);\n                playerRef.current = playerComponents.container;\n                playerSpriteRefs.current = playerComponents.sprites;\n                playerHealthBarRef.current = playerComponents.healthBar;\n            }\n\n            // Rebuild liquid regions only if tileMapData changed (not just revealedSecrets)\n            // This prevents liquid \"jumping\" when revealing secrets\n            const tileDataString = JSON.stringify(tileMapData);\n            const prevTileDataString = liquidSystemRef.current?._lastTileData;\n            if (tileDataString !== prevTileDataString) {\n                try {\n                    if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n                    if (liquidLayerRef.current) {\n                        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n                            mapWidth, \n                            mapHeight, \n                            tileSize,\n                            bgContainer: liquidBgLayerRef.current\n                        });\n                        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n                        liquidSystemRef.current._lastTileData = tileDataString; // Track what we built\n                    }\n                } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n                try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n            }\n\n            // Upload to GPU to avoid lazy initialization warnings\n            if (app.renderer && app.renderer.prepare) {\n                try {\n                    await app.renderer.prepare.upload(app.stage);\n                } catch (e) {\n                    // Prepare might fail in some edge cases or context loss\n                }\n            }\n        }\n    };\n\n    runRebuild();\n\n    return () => { active = false; };\n  }, [tileMapData, objectMapData, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets, objectMetadata, playerVisuals, isPixiReady, activeRoomIds, maps, mapType, backgroundColor]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer || !isPixiReady) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getPlayerState: () => playerStateRef.current,\n      getLiquidTypeAt: (x, y) => {\n        const tmd = tileMapDataRef.current;\n        const regs = registryItemsRef.current;\n        if (!tmd || !regs) return null;\n        const liq = getLiquidAtPixel(x, y, mapWidth, mapHeight, tileSize, tmd, regs);\n        if (!liq) return null;\n        return toSurfaceType(liq.type);\n      },\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      },\n      onMeteorHit: (data) => {\n        if (typeof onWeatherEffectHit === 'function') {\n          onWeatherEffectHit('meteor', data);\n        }\n      },\n      getViewport: () => ({\n        x: cameraPosRef.current.x,\n        y: cameraPosRef.current.y,\n        width: app.screen?.width || 800,\n        height: app.screen?.height || 600\n      })\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.rain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.snow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.clouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.thunder) || 0));\n    const getFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.fog) || 0));\n    const getLavaRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.lavaRain) || 0));\n    const getRadioactiveFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.radioactiveFog) || 0));\n    const getMeteorRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.meteorRain) || 0));\n\n    // Initialize systems if they don't exist\n    if (!weatherSystemsRef.current.rain) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n    }\n    if (!weatherSystemsRef.current.lavaRain) {\n      weatherSystemsRef.current.lavaRain = new WeatherLavaRain(weatherLayer, api, getLavaRainIntensity);\n    }\n    if (!weatherSystemsRef.current.snow) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n    }\n    if (!weatherSystemsRef.current.meteorRain) {\n      weatherSystemsRef.current.meteorRain = new WeatherMeteorRain(weatherLayer, api, getMeteorRainIntensity);\n    }\n    if (!weatherSystemsRef.current.clouds) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n    }\n    if (!weatherSystemsRef.current.fog) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, getFogIntensity);\n    }\n    if (!weatherSystemsRef.current.radioactiveFog) {\n      weatherSystemsRef.current.radioactiveFog = new WeatherRadioactiveFog(fogLayer, api, getRadioactiveFogIntensity);\n    }\n    if (!weatherSystemsRef.current.thunder) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n    }\n\n    // Return cleanup to destroy all when stage unmounts or map changes\n    return () => {\n      try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.lavaRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n      try { weatherSystemsRef.current.meteorRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n      try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.radioactiveFog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n      weatherSystemsRef.current = { rain: null, lavaRain: null, snow: null, meteorRain: null, clouds: null, thunder: null, fog: null, radioactiveFog: null };\n    };\n  }, [mapWidth, mapHeight, tileSize, isSolidAt, isPixiReady]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%', pointerEvents }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  objectMetadata: PropTypes.object,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  weatherLavaRain: PropTypes.number,\n  weatherRadioactiveFog: PropTypes.number,\n  weatherMeteorRain: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n  roomBlurEnabled: PropTypes.bool,\n  debugOverlayEnabled: PropTypes.bool,\n  renderLayers: PropTypes.arrayOf(PropTypes.string),\n  pointerEvents: PropTypes.string,\n  onWeatherEffectHit: PropTypes.func,\n};\n\nexport default PixiStage;\n","import { Sprite, AnimatedSprite, Texture } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Create new sprite\n      const def = getRegItem(registryItems, p.defId);\n      if (def && Array.isArray(def.textures) && def.textures.length > 1) {\n        const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n        if (frames.length > 0) {\n          spr = new AnimatedSprite(frames);\n          spr.animationSpeed = msToSpeed(def.animationSpeed);\n          spr.play();\n        }\n      }\n      if (!spr) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        spr = new Sprite(tex);\n      }\n      spr.anchor.set(0.5, 0.5);\n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x + (p.dir >= 0 ? 0 : 0);\n    spr.y = p.y;\n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = p.dir >= 0 ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","import { Sprite, Texture, Rectangle } from 'pixi.js';\nimport { getTexture } from './helpers';\n\n/**\n * Sinhroniz un atjaunina kustgo enttiju (piem. tanku) spraitus.\n * @param {Container} entitiesLayer PixiJS konteiners enttijm\n * @param {Map} entitySpritesMap Map, kur glabjas esoie spraiti (pc ID)\n * @param {Array} entitiesList Enttiju saraksts no dzinja\n * @param {Array} registryItems Reistra elementi\n * @param {number} tileSize Flzes izmrs pikseos\n */\nexport const syncEntities = (entitiesLayer, entitySpritesMap, entitiesList, registryItems, tileSize) => {\n  if (!entitiesLayer) return;\n\n  const seen = new Set();\n  const list = entitiesList || [];\n\n  for (const ent of list) {\n    const key = ent.id;\n    seen.add(key);\n\n    let spr = entitySpritesMap.get(key);\n    const def = ent.def || {};\n\n    if (!spr) {\n      // Izveidojam jaunu spraitu ar baltu tekstru k aizvietotju, kamr ldjas st\n      spr = new Sprite(Texture.WHITE);\n      spr.anchor.set(0, 0);\n      entitiesLayer.addChild(spr);\n      entitySpritesMap.set(key, spr);\n      spr._lastFrameIndex = -1;\n    }\n\n    // Atjaunojam tekstru no spritesheet, ja nepiecieams\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    const isTextureReady = source && source.width > 1;\n\n    if (def.spriteSheet && def.spriteSheet.enabled && isTextureReady) {\n      const columns = def.spriteSheet.columns || 1;\n      const frameIndex = ent.currentSpriteIndex !== undefined ? ent.currentSpriteIndex : 0;\n      \n      if (spr._lastFrameIndex !== frameIndex) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const totalSprites = def.spriteSheet.totalSprites || 1;\n\n        // Ja kolonnu skaits JSON ir nepareizs vai trkst, minm to aprint\n        let effectiveColumns = columns;\n        if (!effectiveColumns || effectiveColumns <= 0) {\n            effectiveColumns = Math.floor(texWidth / (def.spriteSheet.frameWidth || 32)) || 1;\n        }\n\n        const frameWidth = texWidth / effectiveColumns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / effectiveColumns);\n        \n        const col = frameIndex % effectiveColumns;\n        const row = Math.floor(frameIndex / effectiveColumns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        try {\n            spr.texture = new Texture({\n              source: source,\n              frame: rect\n            });\n            spr._lastFrameIndex = frameIndex;\n        } catch (e) {\n            console.warn(`Failed to create texture for entity ${key} frame ${frameIndex}`, e);\n            spr.texture = baseTexture;\n        }\n      }\n    } else if (isTextureReady) {\n      if (spr.texture !== baseTexture) {\n        spr.texture = baseTexture;\n        spr._lastFrameIndex = -1;\n      }\n    } else if (def.editorIcon) {\n        // Ja nav tekstras, bet ir ikona (piemram, bultia, kaut gan ts te nevajadztu bt k enttijai)\n        if (spr.texture !== Texture.WHITE) spr.texture = Texture.WHITE;\n    }\n\n    // Pozcija un izmrs\n    const targetWidth = ent.width || tileSize;\n    const targetHeight = ent.height || tileSize;\n    \n    spr.width = targetWidth;\n    spr.height = targetHeight;\n    \n    // Nodroinm, ka scale nav 0 vai NaN (ja tekstra bija dvaina skum)\n    if (!spr.scale.x || isNaN(spr.scale.x)) spr.scale.x = 1;\n    if (!spr.scale.y || isNaN(spr.scale.y)) spr.scale.y = 1;\n\n    // Virziens (flipping)\n    const direction = ent.direction !== undefined ? ent.direction : 1;\n    const flipY = !!ent.flipY;\n    const alpha = Number.isFinite(ent.alpha) ? ent.alpha : 1;\n    \n    // Ja ir definta rotcija (piem. akmeiem), izmantojam centru k enkuru\n    if (ent.rotation !== undefined) {\n        spr.anchor.set(0.5, 0.5);\n        spr.x = ent.x + targetWidth / 2;\n        spr.y = ent.y + targetHeight / 2;\n        spr.rotation = ent.rotation;\n        spr.alpha = alpha;\n        \n        // Flipping ar centru enkuru\n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n    } else {\n        // Standarta enkurs (augjais kreisais stris)\n        spr.anchor.set(0, 0);\n        spr.rotation = 0;\n        spr.alpha = alpha;\n        \n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n        \n        // Pozicionana emot vr flipping pie enkura (0,0)\n        spr.x = ent.x + (direction < 0 ? targetWidth : 0);\n        spr.y = ent.y + (flipY ? targetHeight : 0);\n    }\n  }\n\n  // Noemam spraitus enttijm, kas vairs neeksist\n  for (const [key, spr] of entitySpritesMap.entries()) {\n    if (!seen.has(key)) {\n      if (spr.parent) spr.parent.removeChild(spr);\n      spr.destroy({ children: true, texture: false }); // Tekstras koplietoanas d ts neizncinm\n      entitySpritesMap.delete(key);\n    }\n  }\n};\n\n/**\n * Attra visus enttiju spraitus.\n */\nexport const cleanupEntities = (entitySpritesMap) => {\n  for (const spr of entitySpritesMap.values()) {\n    if (spr.parent) spr.parent.removeChild(spr);\n    spr.destroy({ children: true, texture: false });\n  }\n  entitySpritesMap.clear();\n};\n","// Item collection extracted from useGameEngine.js\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata: mainMetadata, secretMapData, activeMapId } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  // --- ROOM OVERLAY LOGIC ---\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && mainMetadata) {\n    if (!gameState.current.collectedItems) {\n      gameState.current.collectedItems = new Set();\n    }\n\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          // Inside a room!\n          const localX = centerX - rx;\n          const localY = centerY - ry;\n          const rWidth = roomMap.mapWidth || roomMap.width || 20;\n          const rgX = Math.floor(localX / TILE_SIZE);\n          const rgY = Math.floor(localY / TILE_SIZE);\n          const rIndex = rgY * rWidth + rgX;\n          \n          const itemKey = `${meta.linkedMapId}:${rIndex}`;\n          if (gameState.current.collectedItems.has(itemKey)) return;\n\n          const rObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          if (rObjectData && rObjectData[rIndex]) {\n            // Call collectItem recursively or just handle it here\n            const rItemId = rObjectData[rIndex];\n            const rItemDef = getDefById(registryItems, rItemId);\n            \n            if (rItemDef && rItemDef.pickup && !rItemId.includes('player')) {\n               if (rItemDef.name && rItemDef.name.startsWith('interactable.')) return;\n\n               // Pick it up\n               let pickedUp = false;\n               if (rItemDef.effect && rItemDef.effect.health) {\n                 const healthBonus = parseInt(rItemDef.effect.health, 10);\n                 if (gameState.current.health < MAX_HEALTH) {\n                   gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n                   pickedUp = true;\n                 }\n               } else if (rItemDef.effect && rItemDef.effect.fireball) {\n                 const ammoBonus = parseInt(rItemDef.effect.fireball, 10) || 0;\n                 gameState.current.ammo = (gameState.current.ammo || 0) + ammoBonus;\n                 pickedUp = true;\n               }\n\n               if (pickedUp) {\n                 gameState.current.collectedItems.add(itemKey);\n                 try {\n                   playShotSfx(rItemDef?.sfx, Math.max(0, Math.min(1, rItemDef?.sfxVolume ?? 1)));\n                 } catch {}\n                 if (onStateUpdate) {\n                   onStateUpdate('collectItem', { index: rIndex, mapId: meta.linkedMapId });\n                 }\n                 return;\n               }\n            }\n          }\n          // If we are in a room, we don't pick up items from the main map below\n          return;\n        }\n      }\n    }\n  }\n  // --- END ROOM OVERLAY LOGIC ---\n\n  if (!gameState.current.collectedItems) {\n    gameState.current.collectedItems = new Set();\n  }\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const mapKey = activeMapId || 'main';\n  const itemKey = `${mapKey}:${index}`;\n  if (gameState.current.collectedItems.has(itemKey)) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = getDefById(registryItems, itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n}\n","export function resolveInteractableContext({\n  mapData,\n  mapWidth,\n  mapHeight,\n  objectLayerData,\n  mainObjectMetadata,\n  secretMapData,\n  activeRoomIds: activeRoomIdsProp,\n  centerX,\n  centerY,\n  TILE_SIZE\n}) {\n  const hasMainMetadata = mainObjectMetadata && Object.keys(mainObjectMetadata).length > 0;\n  let activeTargetMap = mapData;\n  let activeObjectData = objectLayerData;\n  let activeMetadata = hasMainMetadata\n    ? mainObjectMetadata\n    : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n  let activeMapWidth = mapWidth;\n  let activeMapHeight = mapHeight;\n  let offsetX = 0;\n  let offsetY = 0;\n  let currentMapId = mapData?.id || 'main';\n\n  const projectMaps = mapData?.maps || mapData?.projectMaps || {};\n  const activeRoomIds = activeRoomIdsProp || mapData?.meta?.activeRoomIds || [];\n\n  if (activeRoomIds.length > 0) {\n    const mainMetadata = hasMainMetadata\n      ? mainObjectMetadata\n      : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = projectMaps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          activeTargetMap = roomMap;\n          activeMapWidth = roomMap.mapWidth || roomMap.width || 20;\n          activeMapHeight = roomMap.mapHeight || roomMap.height || 15;\n          activeObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          activeMetadata = roomMap.objectMetadata || {};\n          offsetX = rx;\n          offsetY = ry;\n          currentMapId = meta.linkedMapId;\n          break;\n        }\n      }\n    }\n  }\n\n  return {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps,\n    activeRoomIds\n  };\n}\n\nexport default { resolveInteractableContext };\n","/**\n * Finds spawn position in a map by trigger ID or player start\n */\nexport function findSpawnPosition(map, triggerId, tileSize) {\n  if (!map) return null;\n\n  const mapW = map.width || map.mapWidth || map.meta?.width || 20;\n  const metadata = map.objectMetadata || map.meta?.objectMetadata || {};\n\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data;\n\n  if (!objData) return null;\n\n  let spawnIdx = -1;\n\n  const triggerRequested = triggerId !== undefined && triggerId !== null && triggerId !== '';\n  if (triggerRequested) {\n    for (let i = 0; i < objData.length; i++) {\n      if (!objData[i]) continue;\n      if (metadata[i] && metadata[i].triggerId === triggerId) {\n        spawnIdx = i;\n        break;\n      }\n    }\n  }\n\n  if (spawnIdx === -1 && !triggerRequested) {\n    spawnIdx = objData.findIndex(id => id && id.includes('player'));\n  }\n\n  if (spawnIdx !== -1) {\n    return {\n      x: (spawnIdx % mapW) * tileSize,\n      y: Math.floor(spawnIdx / mapW) * tileSize\n    };\n  }\n\n  return null;\n}\n\nexport default { findSpawnPosition };\n","import { findSpawnPosition } from './spawn';\n\nconst resolveMapObjects = (map) => {\n  if (!map) return { mapW: 20, objData: [], metadata: {} };\n  const mapW = map.mapWidth || map.width || map.meta?.width || 20;\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data || [];\n  const metadata = map.objectMetadata || map.meta?.objectMetadata || {};\n  return { mapW, objData, metadata };\n};\n\nconst findExitDoorSpawn = ({ map, targetRoomId, roomMeta, tileSize }) => {\n  const { mapW, objData, metadata } = resolveMapObjects(map);\n  if (!Array.isArray(objData) || objData.length === 0) return null;\n\n  const matchIds = [];\n  if (roomMeta?.spawnTriggerId !== undefined && roomMeta?.spawnTriggerId !== null && roomMeta?.spawnTriggerId !== '') {\n    matchIds.push(roomMeta.spawnTriggerId);\n  }\n  if (roomMeta?.triggerId !== undefined && roomMeta?.triggerId !== null && roomMeta?.triggerId !== '') {\n    if (!matchIds.includes(roomMeta.triggerId)) {\n      matchIds.push(roomMeta.triggerId);\n    }\n  }\n  let candidateIdx = -1;\n  let matchedIdx = -1;\n\n  for (let i = 0; i < objData.length; i++) {\n    const id = objData[i];\n    if (!id || !String(id).includes('door')) continue;\n    const meta = metadata[i];\n    if (!meta || meta.targetMapId !== targetRoomId) continue;\n    if (candidateIdx === -1) candidateIdx = i;\n    if (matchIds.length) {\n      if (matchIds.some(id => meta.spawnTriggerId === id || meta.triggerId === id)) {\n        matchedIdx = i;\n        break;\n      }\n    }\n  }\n\n  const doorIdx = matchedIdx !== -1 ? matchedIdx : candidateIdx;\n  if (doorIdx === -1) return null;\n  return {\n    index: doorIdx,\n    x: (doorIdx % mapW) * tileSize,\n    y: Math.floor(doorIdx / mapW) * tileSize,\n    meta: metadata[doorIdx] || {}\n  };\n};\n\nexport function handleDoorInteraction({\n  objDef,\n  currentMeta,\n  actualIndex,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  mapData,\n  mapWidth,\n  TILE_SIZE,\n  activeTargetMap,\n  projectMaps\n}) {\n  if (!objDef || objDef.subtype !== 'door') return false;\n  if (!keys?.e) return true;\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 600) return true;\n  gameState.current.lastETime = now;\n\n  const sound = currentMeta?.sound || objDef.interaction?.sound;\n  if (sound) {\n    try { playShotSfx(sound, objDef.sfxVolume || 0.5); } catch {}\n  }\n\n  if (onStateUpdate) {\n    onStateUpdate('setObjectFrame', {\n      index: actualIndex,\n      frame: objDef.interaction?.frames?.opening || 1,\n      mapId: activeTargetMap === mapData ? null : activeTargetMap.id\n    });\n  }\n\n  const delayS = currentMeta?.delaySeconds !== undefined ? currentMeta.delaySeconds : (objDef.interaction?.delaySeconds || 0.5);\n  const targetMapId = currentMeta?.targetMapId;\n\n  if (onStateUpdate && targetMapId) {\n    setTimeout(() => {\n      const targetMap = projectMaps[targetMapId];\n      const isRoom = targetMap && targetMap.type === 'room';\n      const isExitingRoom = !isRoom && activeTargetMap !== mapData && targetMapId === 'main';\n\n      if (isRoom || isExitingRoom) {\n        let newX = gameState.current.x;\n        let newY = gameState.current.y;\n        let exitTriggerId = currentMeta?.spawnTriggerId;\n        if (exitTriggerId === undefined || exitTriggerId === null || exitTriggerId === '') {\n          exitTriggerId = currentMeta?.triggerId;\n        }\n\n        if (isRoom) {\n          const roomAreaMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {};\n          const roomAreaEntry = Object.entries(roomAreaMeta)\n            .find(([, m]) => m.linkedMapId === targetMapId);\n          let rx = 0;\n          let ry = 0;\n          if (roomAreaEntry) {\n            const raIdx = parseInt(roomAreaEntry[0], 10);\n            rx = (raIdx % mapWidth) * TILE_SIZE;\n            ry = Math.floor(raIdx / mapWidth) * TILE_SIZE;\n          }\n          const spawn = findSpawnPosition(targetMap, currentMeta.spawnTriggerId, TILE_SIZE);\n          if (spawn) {\n            newX = rx + spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n            newY = ry + spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n          }\n        } else {\n          const roomAreaMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {};\n          const roomAreaEntry = Object.entries(roomAreaMeta)\n            .find(([, m]) => m.linkedMapId === activeTargetMap.id);\n          if (roomAreaEntry) {\n            let spawnFound = false;\n            if (exitTriggerId !== undefined && exitTriggerId !== null && exitTriggerId !== '') {\n              const spawn = findSpawnPosition(mapData, exitTriggerId, TILE_SIZE);\n              if (spawn) {\n                newX = spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n                newY = spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n                spawnFound = true;\n              }\n            }\n            if (!spawnFound) {\n              const fallback = findExitDoorSpawn({\n                map: mapData,\n                targetRoomId: activeTargetMap.id,\n                roomMeta: currentMeta,\n                tileSize: TILE_SIZE\n              });\n              if (fallback) {\n                newX = fallback.x + (TILE_SIZE - gameState.current.width) / 2;\n                newY = fallback.y + (TILE_SIZE - gameState.current.height) / 2;\n                spawnFound = true;\n                if (exitTriggerId === undefined || exitTriggerId === null || exitTriggerId === '') {\n                  if (fallback.meta?.triggerId !== undefined) {\n                    exitTriggerId = fallback.meta.triggerId;\n                  } else if (fallback.meta?.spawnTriggerId !== undefined) {\n                    exitTriggerId = fallback.meta.spawnTriggerId;\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        gameState.current.x = newX;\n        gameState.current.y = newY;\n        gameState.current.vx = 0;\n        gameState.current.vy = 0;\n        const triggerId = isExitingRoom ? exitTriggerId : currentMeta.spawnTriggerId;\n        onStateUpdate('switchMap', { targetMapId, triggerId });\n      } else {\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      }\n    }, delayS * 1000);\n  }\n\n  return true;\n}\n\nexport default { handleDoorInteraction };\n","export function handleTeleportInteraction({\n  objId,\n  objDef,\n  currentMeta,\n  actualIndex,\n  activeObjectData,\n  activeMetadata,\n  activeMapWidth,\n  offsetX,\n  offsetY,\n  projectMaps,\n  onStateUpdate,\n  playShotSfx,\n  gameState,\n  TILE_SIZE\n}) {\n  if (!objId || !objId.includes('portal')) return false;\n  if (!currentMeta || currentMeta.triggerId === undefined || currentMeta.triggerId === null) return true;\n\n  const targetMapId = currentMeta.targetMapId;\n  if (targetMapId && projectMaps && projectMaps[targetMapId]) {\n    if (onStateUpdate) {\n      onStateUpdate('switchMap', {\n        targetMapId,\n        triggerId: currentMeta.triggerId\n      });\n      try {\n        const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n        playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n      } catch {}\n    }\n    return true;\n  }\n\n  for (let i = 0; i < (activeObjectData?.length || 0); i++) {\n    if (i === actualIndex) continue;\n    const destId = activeObjectData[i];\n    if (destId && (destId.includes('target') || destId === 'portal_target')) {\n      const destMeta = activeMetadata?.[i];\n      if (destMeta && destMeta.triggerId === currentMeta.triggerId) {\n        const tx = offsetX + (i % activeMapWidth) * TILE_SIZE;\n        const ty = offsetY + Math.floor(i / activeMapWidth) * TILE_SIZE;\n\n        gameState.current.x = tx;\n        gameState.current.y = ty;\n\n        try {\n          const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n          playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n        } catch {}\n        return true;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport default { handleTeleportInteraction };\n","export function applyInteractableEffects({\n  objDef,\n  actualIndex,\n  currentMapId,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  MAX_HEALTH\n}) {\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return false;\n  if (!objDef.effect) return true;\n\n  const interactableKey = currentMapId === 'main' ? `${actualIndex}` : `${currentMapId}:${actualIndex}`;\n  if (gameState.current.usedInteractables.has(interactableKey)) return true;\n\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return true;\n\n    gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  return true;\n}\n\nexport default { applyInteractableEffects };\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = getDefById(registryItems, startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n  const revealedSet = (revealedSecrets instanceof Set)\n    ? revealedSecrets\n    : new Set(revealedSecrets || []);\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSet.has(idx)) continue;\n\n      const def = getDefById(registryItems, secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSet.has(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","import i18n from './i18n';\nimport enMessages from './translations/en/tutorial_messages.json';\nimport lvMessages from './translations/lv/tutorial_messages.json';\nimport noMessages from './translations/no/tutorial_messages.json';\nimport ruMessages from './translations/ru/tutorial_messages.json';\nimport jaMessages from './translations/ja/tutorial_messages.json';\n\nconst MESSAGES = {\n  en: enMessages,\n  lv: lvMessages,\n  no: noMessages,\n  ru: ruMessages,\n  ja: jaMessages\n};\n\nconst getLang = (lang) => {\n  const raw = lang || i18n?.language || 'en';\n  const base = raw.includes('-') ? raw.split('-')[0] : raw;\n  return MESSAGES[base] ? base : 'en';\n};\n\nexport const getTutorialChapters = (lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  return Array.from(new Set([...Object.keys(fallback), ...Object.keys(data)])).sort();\n};\n\nexport const getTutorialItems = (chapter, lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  const chapterData = (data[chapter] && Object.keys(data[chapter]).length)\n    ? data[chapter]\n    : (fallback[chapter] || {});\n  return Object.keys(chapterData)\n    .sort((a, b) => Number(a) - Number(b))\n    .map((id) => ({ id, text: chapterData[id] }));\n};\n\nexport const getTutorialText = (chapter, id, lang) => {\n  if (!chapter || id === undefined || id === null) return '';\n  const l = getLang(lang);\n  const data = MESSAGES[l] || MESSAGES.en || {};\n  const fallback = (MESSAGES.en || {})[chapter]?.[String(id)] || '';\n  return data[chapter]?.[String(id)] || fallback;\n};\n\nexport default {\n  getTutorialChapters,\n  getTutorialItems,\n  getTutorialText\n};\n","// Secret-related trigger handlers (weather, messages)\nimport { getTutorialText } from '../../../i18n/tutorialMessages';\n\nexport function handleWeatherTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx\n}) {\n  if (!objDef || objDef.type !== 'weather_trigger') return false;\n\n  const weatherType = objDef.weatherType; // rain, snow, clouds, fog, thunder\n  const action = objDef.weatherAction; // on, off, set\n  let value = 0;\n\n  if (action === 'set' || action === 'on') {\n    value = currentMeta?.intensity !== undefined ? currentMeta.intensity : (action === 'on' ? 100 : 50);\n  } else if (action === 'off') {\n    value = 0;\n  }\n\n  if (!gameState.current.lastWeatherTrigger) {\n    gameState.current.lastWeatherTrigger = {};\n  }\n\n  const lastVal = gameState.current.lastWeatherTrigger[index];\n  if (lastVal !== value) {\n    if (onStateUpdate) {\n      onStateUpdate('updateWeather', { type: weatherType, value });\n    }\n    gameState.current.lastWeatherTrigger[index] = value;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport function handleMessageTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  keys\n}) {\n  if (!objDef || objDef.type !== 'message_trigger') return false;\n\n  const requiresActionKey = !!(objDef.requiresActionKey || objDef.interaction?.requiresKey);\n  if (requiresActionKey && !keys?.e) {\n    return false;\n  }\n\n  const i18nChapter = currentMeta?.i18nChapter;\n  const i18nId = currentMeta?.i18nId;\n  const message = (currentMeta?.message && String(currentMeta.message).trim())\n    ? currentMeta.message\n    : (i18nChapter && i18nId ? getTutorialText(i18nChapter, i18nId) : null);\n  if (!message) return true;\n\n  if (!gameState.current.lastMessageTrigger) {\n    gameState.current.lastMessageTrigger = {};\n  }\n\n  const lastMsg = gameState.current.lastMessageTrigger[index];\n  if (lastMsg !== message) {\n    if (onStateUpdate) {\n      onStateUpdate('showMessage', { text: message, duration: 8000 });\n    }\n    gameState.current.lastMessageTrigger[index] = message;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport default { handleWeatherTrigger, handleMessageTrigger };\n","// Wolfenstein-style secret triggers and movement handling\n\nexport function triggerWolfSecret({\n  objDef,\n  index,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  playerCenterX,\n  playerCenterY,\n  objCenterX,\n  objCenterY,\n  playerGridX,\n  playerGridY,\n  objGridX,\n  objGridY\n}) {\n  if (!objDef || objDef.type !== 'wolf_secret') return false;\n  if (!keys?.e) return true;\n\n  const moveX = objDef.moveX || 0;\n  const moveY = objDef.moveY || 0;\n  if (moveX !== 0 || moveY !== 0) {\n    const hasGrid = Number.isFinite(playerGridX) && Number.isFinite(playerGridY) && Number.isFinite(objGridX) && Number.isFinite(objGridY);\n    if (hasGrid) {\n      if (moveX < 0 && !(playerGridX > objGridX)) return true;\n      if (moveX > 0 && !(playerGridX < objGridX)) return true;\n      if (moveY < 0) {\n        if (!keys?.w) return true;\n        if (!(playerGridY > objGridY)) return true;\n      }\n      if (moveY > 0) {\n        if (!keys?.s) return true;\n        if (!(playerGridY < objGridY)) return true;\n      }\n    } else {\n      const eps = 0.01;\n      if (moveX < 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX > objCenterX + eps)) return true;\n      }\n      if (moveX > 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX < objCenterX - eps)) return true;\n      }\n      if (moveY < 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.w) return true;\n        if (!(playerCenterY > objCenterY + eps)) return true;\n      }\n      if (moveY > 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.s) return true;\n        if (!(playerCenterY < objCenterY - eps)) return true;\n      }\n    }\n  }\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 1000) return true;\n  gameState.current.lastETime = now;\n\n  if (onStateUpdate) {\n    const dx = moveX;\n    const dy = moveY;\n    onStateUpdate('shiftTile', { index, dx, dy });\n\n    if (objDef.sfx) {\n      try { playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5); } catch {}\n    }\n  }\n  return true;\n}\n\nexport function applyWolfSecretShift({\n  index,\n  dx,\n  dy,\n  mapWidth,\n  mapHeight,\n  getObjectId,\n  getObjectDef,\n  moveTile,\n  moveObject,\n  moveMetadata,\n  removeObject,\n  stepDelayMs = 250,\n  setTimeoutFn = setTimeout,\n  shouldCancel\n}) {\n  let currentIdx = index;\n  let remainingDx = dx;\n  let remainingDy = dy;\n  const originId = getObjectId(currentIdx);\n  if (!originId) return;\n\n  const moveStep = () => {\n    if (shouldCancel && shouldCancel()) return;\n    const currentId = getObjectId(currentIdx);\n    if (!currentId || currentId !== originId) return;\n    if (remainingDx === 0 && remainingDy === 0) {\n      if (removeObject) removeObject(currentIdx);\n      return;\n    }\n\n    const stepX = remainingDx > 0 ? 1 : (remainingDx < 0 ? -1 : 0);\n    const stepY = remainingDy > 0 ? 1 : (remainingDy < 0 ? -1 : 0);\n\n    const tx = (currentIdx % mapWidth) + stepX;\n    const ty = Math.floor(currentIdx / mapWidth) + stepY;\n\n    if (tx >= 0 && tx < mapWidth && ty >= 0 && ty < mapHeight) {\n      const targetIndex = ty * mapWidth + tx;\n\n      const isLastStepOfBatch = (Math.abs(remainingDx) === 1 && remainingDy === 0) ||\n        (Math.abs(remainingDy) === 1 && remainingDx === 0);\n      if (isLastStepOfBatch) {\n        const targetObjId = getObjectId(targetIndex);\n        const targetDef = getObjectDef(targetObjId);\n        if (targetDef && targetDef.type === 'wolf_secret') {\n          const extraX = Math.abs(targetDef.moveX || 3);\n          const extraY = Math.abs(targetDef.moveY || 3);\n          if (remainingDx !== 0) remainingDx += (remainingDx > 0 ? extraX : -extraX);\n          if (remainingDy !== 0) remainingDy += (remainingDy > 0 ? extraY : -extraY);\n        }\n      }\n\n      if (moveTile) moveTile(currentIdx, targetIndex);\n      if (moveObject) moveObject(currentIdx, targetIndex);\n      if (moveMetadata) moveMetadata(currentIdx, targetIndex);\n\n      currentIdx = targetIndex;\n      remainingDx -= stepX;\n      remainingDy -= stepY;\n\n      if (remainingDx !== 0 || remainingDy !== 0) {\n        setTimeoutFn(moveStep, stepDelayMs);\n      } else {\n        if (removeObject) removeObject(currentIdx);\n      }\n    } else {\n      if (removeObject) removeObject(currentIdx);\n    }\n  };\n\n  moveStep();\n}\n\nexport default { triggerWolfSecret, applyWolfSecretShift };\n","// Helpers for crack_block secret behavior\n\nexport function shouldRemoveCrackBlock(def, newHealth) {\n  if (!def || def.type !== 'crack_block') return false;\n  const threshold = def.passableHealthThreshold || 0;\n  return newHealth <= threshold;\n}\n\nexport default { shouldRemoveCrackBlock };\n","import { resolveInteractableContext } from './context';\nimport { handleDoorInteraction } from './doors';\nimport { handleTeleportInteraction } from './teleport';\nimport { applyInteractableEffects } from './effects';\nimport { handleWeatherTrigger, handleMessageTrigger, triggerWolfSecret } from '../secrets';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, mapHeight, objectLayerData) {\n  const {\n    registryItems,\n    TILE_SIZE,\n    MAX_HEALTH,\n    playShotSfx,\n    onStateUpdate,\n    gameState,\n    mapData,\n    activeRoomIds: activeRoomIdsProp,\n    objectMetadata: mainObjectMetadata,\n    secretMapData\n  } = ctx;\n  if (!objectLayerData) return;\n\n  const keys = ctx.input?.current || {};\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps\n  } = resolveInteractableContext({\n    mapData,\n    mapWidth,\n    mapHeight,\n    objectLayerData,\n    mainObjectMetadata,\n    secretMapData,\n    activeRoomIds: activeRoomIdsProp,\n    centerX,\n    centerY,\n    TILE_SIZE\n  });\n\n  const localX = centerX - offsetX;\n  const localY = centerY - offsetY;\n\n  const gridX = Math.floor(localX / TILE_SIZE);\n  const gridY = Math.floor(localY / TILE_SIZE);\n  let index = gridY * activeMapWidth + gridX;\n\n  if (keys.e) {\n    let targetIndex = null;\n\n    if (keys.w) {\n        const upIndex = (gridY - 1) * activeMapWidth + gridX;\n        if (gridY - 1 >= 0) {\n          const upObjId = activeObjectData?.[upIndex];\n          const upDef = getDefById(registryItems, upObjId);\n          if (upDef && upDef.type === 'wolf_secret') {\n            targetIndex = upIndex;\n          }\n        }\n      }\n\n    if (targetIndex === null && keys.s) {\n      const downIndex = (gridY + 1) * activeMapWidth + gridX;\n      const limitHeight = activeMapHeight || mapHeight || 0;\n      if (gridY + 1 < limitHeight) {\n        const downObjId = activeObjectData?.[downIndex];\n        const downDef = getDefById(registryItems, downObjId);\n        if (downDef && downDef.type === 'wolf_secret') {\n          targetIndex = downIndex;\n        }\n      }\n    }\n\n    if (targetIndex === null) {\n      const dir = keys.d ? 1 : (keys.a ? -1 : (gameState.current.direction || 1));\n      const frontX = localX + dir * (TILE_SIZE * 0.8);\n      const frontGridX = Math.floor(frontX / TILE_SIZE);\n      const frontIndex = gridY * activeMapWidth + frontGridX;\n\n      if (frontIndex >= 0 && frontIndex < (activeObjectData?.length || 0)) {\n        const frontObjId = activeObjectData[frontIndex];\n        if (frontObjId) {\n          const frontDef = getDefById(registryItems, frontObjId);\n          if (frontDef && (\n            frontDef.type === 'wolf_secret' ||\n            frontDef.subtype === 'door' ||\n            frontDef.name?.startsWith('interactable.') ||\n            (frontDef.type === 'message_trigger' && (frontDef.requiresActionKey || frontDef.interaction?.requiresKey))\n          )) {\n            targetIndex = frontIndex;\n          }\n        }\n      }\n    }\n\n    if (targetIndex !== null) {\n      index = targetIndex;\n    }\n  }\n\n  let foundIndex = -1;\n  const directObjId = activeObjectData ? activeObjectData[index] : null;\n  if (directObjId) {\n    foundIndex = index;\n  } else if (activeMetadata) {\n    for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      const w = meta.width || 1;\n      const h = meta.height || 1;\n      if (w > 1 || h > 1) {\n        const ox = idx % activeMapWidth;\n        const oy = Math.floor(idx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          if (activeObjectData && activeObjectData[idx]) {\n            foundIndex = idx;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (foundIndex === -1) return;\n  const actualIndex = foundIndex;\n\n  let currentMeta = activeMetadata?.[actualIndex];\n  if (!currentMeta && mapData) {\n    const fromMap = mapData?.maps?.[currentMapId]?.objectMetadata;\n    const fromMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata;\n    currentMeta = (fromMap && fromMap[actualIndex]) || (fromMeta && fromMeta[actualIndex]) || currentMeta;\n  }\n  const objId = activeObjectData[actualIndex];\n  if (!objId) return;\n\n  const objDef = getDefById(registryItems, objId);\n  if (!objDef) return;\n\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (handleWeatherTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx })) return;\n  if (handleMessageTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx, keys })) return;\n  if (triggerWolfSecret({\n    objDef,\n    index: actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    playerCenterX: localX,\n    playerCenterY: localY,\n    objCenterX: ((actualIndex % activeMapWidth) + 0.5) * TILE_SIZE,\n    objCenterY: (Math.floor(actualIndex / activeMapWidth) + 0.5) * TILE_SIZE,\n    playerGridX: gridX,\n    playerGridY: gridY,\n    objGridX: actualIndex % activeMapWidth,\n    objGridY: Math.floor(actualIndex / activeMapWidth)\n  })) return;\n\n  if (handleDoorInteraction({\n    objDef,\n    currentMeta,\n    actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    mapData,\n    mapWidth,\n    TILE_SIZE,\n    activeTargetMap,\n    projectMaps\n  })) return;\n\n  if (handleTeleportInteraction({\n    objId,\n    objDef,\n    currentMeta,\n    actualIndex,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    offsetX,\n    offsetY,\n    projectMaps,\n    onStateUpdate,\n    playShotSfx,\n    gameState,\n    TILE_SIZE\n  })) return;\n\n  if (objDef.subtype === 'end' && !gameState.current.isWinning) {\n    gameState.current.isWinning = true;\n    gameState.current.winCounter = 0;\n    gameState.current.winCountSpeed = objDef.winCountSpeed || 10;\n    return;\n  }\n\n  applyInteractableEffects({\n    objDef,\n    actualIndex,\n    currentMapId,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    MAX_HEALTH\n  });\n}\n\nexport default { checkInteractables };\n","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor(playerRight / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor(playerBottom / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = getDefById(registryItems, objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight >= tileLeft && playerLeft <= tileRight;\n      const overlapsVertically = playerBottom >= tileTop && playerTop <= tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const overlapTop = playerBottom - tileTop;\n        const overlapBottom = tileBottom - playerTop;\n        const overlapLeft = playerRight - tileLeft;\n        const overlapRight = tileRight - playerLeft;\n        const min = Math.min(overlapTop, overlapBottom, overlapLeft, overlapRight);\n        touchingTop = (min === overlapTop);\n        touchingBottom = (!touchingTop && min === overlapBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === overlapLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","import meteorBreakEffectsConfig from '../../assets/json/system/meteor_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst clamp01 = (v) => Math.max(0, Math.min(1, v));\n\nconst getConfig = () => {\n  if (!meteorBreakEffectsConfig || meteorBreakEffectsConfig.enabled === false) return null;\n  return meteorBreakEffectsConfig;\n};\n\nconst lerp = (a, b, t) => a + (b - a) * t;\n\nconst scaleFromRange = (range, fallback, t) => {\n  if (!Array.isArray(range) || range.length < 2) return fallback;\n  const a = Number(range[0]);\n  const b = Number(range[1]);\n  if (!Number.isFinite(a) || !Number.isFinite(b)) return fallback;\n  return lerp(a, b, t);\n};\n\nconst readNumber = (value, fallback) => {\n  const n = Number(value);\n  return Number.isFinite(n) ? n : fallback;\n};\n\nexport const getMeteorBreakEffectConfig = ({ size, surfaceType }) => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n\n  const defaults = cfg.defaults || {};\n  const sizeScale = cfg.sizeScale || {};\n  const minSize = readNumber(sizeScale.min, 4);\n  const maxSize = readNumber(sizeScale.max, 12);\n  const denom = Math.max(1, maxSize - minSize);\n  const t = clamp01((readNumber(size, minSize) - minSize) / denom);\n\n  let count = scaleFromRange(sizeScale.count, defaults.count, t);\n  let speed = scaleFromRange(sizeScale.speed, defaults.speed, t);\n  let lifeMs = scaleFromRange(sizeScale.lifeMs, defaults.lifeMs, t);\n  let particleSize = scaleFromRange(sizeScale.size, defaults.size, t);\n  let gravity = readNumber(defaults.gravity, 0.02);\n  let shape = defaults.shape || 'square';\n  let angleRange = Array.isArray(defaults.angleRange) ? defaults.angleRange : null;\n\n  const surfaces = cfg.surfaces || {};\n  const surface = surfaceType && surfaces[surfaceType] ? surfaces[surfaceType] : surfaces.ground;\n  if (surface) {\n    count = readNumber(surface.count, count);\n    speed = readNumber(surface.speed, speed);\n    lifeMs = readNumber(surface.lifeMs, lifeMs);\n    particleSize = readNumber(surface.size, particleSize);\n    gravity = readNumber(surface.gravity, gravity);\n    shape = surface.shape || shape;\n    angleRange = Array.isArray(surface.angleRange) ? surface.angleRange : angleRange;\n  }\n\n  const colorsRaw = (surface && Array.isArray(surface.colors)) ? surface.colors : defaults.colors;\n  const colors = Array.isArray(colorsRaw) && colorsRaw.length ? colorsRaw.map(normalizeColor) : [0xffffff];\n\n  return {\n    count: readNumber(count, 12),\n    speed: readNumber(speed, 2.4),\n    lifeMs: readNumber(lifeMs, 700),\n    size: readNumber(particleSize, 3),\n    colors,\n    gravity,\n    shape,\n    angleRange\n  };\n};\n\nexport default {\n  getMeteorBreakEffectConfig\n};\n","import biologicalBreakEffectsConfig from '../../assets/json/system/biological_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!biologicalBreakEffectsConfig || biologicalBreakEffectsConfig.enabled === false) return null;\n  return biologicalBreakEffectsConfig;\n};\n\nexport const getBiologicalBreakEffectConfig = () => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const base = cfg.default || {};\n  const chunks = cfg.chunks && typeof cfg.chunks === 'object' ? cfg.chunks : null;\n  const colors = Array.isArray(base.colors) && base.colors.length ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 18,\n    speed: Number(base.speed) || 2.4,\n    lifeMs: Number(base.lifeMs) || 700,\n    size: Number(base.size) || 2,\n    gravity: Number.isFinite(Number(base.gravity)) ? Number(base.gravity) : 0.02,\n    shape: base.shape || 'circle',\n    angleRange: Array.isArray(base.angleRange) ? base.angleRange : null,\n    colors,\n    chunks: chunks || null\n  };\n};\n\nexport default {\n  getBiologicalBreakEffectConfig\n};\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef, isInsideRoom } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    \n    let vol = Math.max(0, Math.min(1, volume ?? 1));\n    let muffled = !!isInsideRoom;\n\n    if (muffled) {\n        vol *= 0.5; // Reduce volume if inside\n    }\n\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        \n        // If we wanted a filter for SFX, we'd need to set up Web Audio context for each sound,\n        // which might be heavy for many sounds. Let's stick to volume reduction for simplicity \n        // unless Web Audio context is already available and passed in.\n\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol, muffled);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol, muffled = false) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    \n    // Lowpass filter if muffled\n    let lastNode = osc;\n    if (muffled) {\n        const filter = audioCtx.createBiquadFilter();\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(600, now);\n        osc.connect(filter);\n        lastNode = filter;\n    }\n\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(muffled ? 260 : 520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    \n    lastNode.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  friction = 0.8,\n  acceleration = 0.2,\n  deltaMs = 16.67\n}) {\n  let { x, vx, width, direction, y, height } = state;\n  \n  const timeScale = deltaMs / 16.67;\n  const targetVx = keys?.a ? -MOVE_SPEED : (keys?.d ? MOVE_SPEED : 0);\n  \n  if (targetVx !== 0) {\n    // Accelerate\n    vx += targetVx * acceleration * timeScale;\n    if (Math.abs(vx) > MOVE_SPEED) vx = Math.sign(vx) * MOVE_SPEED;\n    direction = Math.sign(targetVx);\n  } else {\n    // Apply friction (time-scaled)\n    const effectiveFriction = Math.pow(friction, timeScale);\n    vx *= effectiveFriction;\n    if (Math.abs(vx) < 0.1) vx = 0;\n  }\n\n  const proposedX = x + vx * timeScale;\n  const py = y ?? 0;\n  if (checkCollision(proposedX, py, mapWidth, mapHeight, width, height)) {\n    // Precza apstans pie ra\n    const step = 0.05;\n    const sign = Math.sign(vx);\n    let safeX = x;\n    const moveDist = Math.abs(vx * timeScale);\n    \n    for (let d = step; d <= moveDist; d += step) {\n      const nextX = x + d * sign;\n      if (!checkCollision(nextX, py, mapWidth, mapHeight, width, height)) {\n        safeX = nextX;\n      } else {\n        break;\n      }\n    }\n    x = safeX;\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  // Sanitize coordinates to avoid sub-pixel noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  x = Math.round(x * 1000) / 1000;\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isLiquidAt(wx, wy): optional helper to detect liquid type at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isLiquidAt,\n  prevInWater,\n  deltaMs = 16.67\n}) {\n  const timeScale = deltaMs / 16.67;\n  \n  // Liquid defaults\n  let liqBuoyancy = 0.5; // reduces effective gravity by 50%\n  let liqDragY = 0.88;  // vertical damping per frame when in liquid\n  let liqTerminal = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n  let swimImpulseMult = 0.55;\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  let activeLiquidType = null;\n\n  if (typeof isLiquidAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    \n    const feetLiq = isLiquidAt(cx, feetY);\n    const chestLiq = isLiquidAt(cx, chestY);\n    const headLiq = isLiquidAt(cx, headY);\n    \n    activeLiquidType = feetLiq || chestLiq;\n    inWater = !!activeLiquidType;\n    headUnderWater = !!headLiq;\n    atSurface = inWater && !headUnderWater;\n\n    // Apply per-liquid physics overrides\n    if (activeLiquidType === 'quicksand') {\n      liqBuoyancy = -0.15; // Negative buoyancy makes player sink!\n      liqDragY = 0.85;     // Higher drag\n      liqTerminal = 1.2;   // Very slow terminal velocity for sinking\n      swimImpulseMult = 0.35; // Harder to jump/swim\n    } else if (activeLiquidType === 'lava') {\n      liqBuoyancy = 0.3;\n      liqDragY = 0.82;\n    } else if (activeLiquidType === 'waterfall') {\n      liqBuoyancy = -0.5; // Acts like extra gravity\n      liqDragY = 0.95;     // Very low resistance\n      liqTerminal = TERMINAL_VELOCITY * 1.5; // Allow falling faster than usual terminal velocity\n    } else if (activeLiquidType === 'lava_waterfall') {\n      liqBuoyancy = -0.4; // Slightly more viscous than water\n      liqDragY = 0.92;\n      liqTerminal = TERMINAL_VELOCITY * 1.3;\n    } else if (activeLiquidType === 'radioactive_waterfall') {\n      liqBuoyancy = -0.2; // Slower fall than normal waterfall\n      liqDragY = 0.94;\n      liqTerminal = TERMINAL_VELOCITY * 0.7; // Slower speed\n    } else if (activeLiquidType === 'radioactive_water') {\n      liqBuoyancy = 0.45; // Slightly less buoyant than water\n      liqDragY = 0.86;\n    }\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * swimImpulseMult));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5 * timeScale; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - liqBuoyancy) * timeScale;\n    vy *= Math.pow(liqDragY, timeScale);\n    if (vy > liqTerminal) vy = liqTerminal;\n  } else {\n    vy += GRAVITY * timeScale;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  const proposedY = y + vy * timeScale;\n  if (checkCollision(x, proposedY, mapWidth, mapHeight, width, height)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      // Snapping to the pixel above the tile - use a small offset consistent with collision inset\n      y = Math.floor((proposedY + height - 0.1) / TILE_SIZE) * TILE_SIZE - height;\n      \n      if (Math.abs(vx || 0) > 0.1) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((proposedY + 0.1) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y = proposedY;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  // Sanitize coordinates to prevent floating point noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  y = Math.round(y * 1000) / 1000;\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Collision helpers (migrated from GameEngine/collision.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile or an object)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve definitions\n// - secretData: secret layer array (ids)\n// - objectData: object layer array (ids)\n// - objectMetadata: metadata for objects (e.g. health)\n// - entities: array of active entities (optional)\n// - ignoreEntityId: ID of the entity to ignore in check (optional)\n// - maps: all project maps (optional, for room overlays)\n// - activeRoomIds: IDs of currently active/open rooms (optional)\n// - isRoom: boolean, whether we are checking collision for a room sub-map\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds, isRoom = false) {\n  try {\n    const gx = Math.floor(wx / TILE_SIZE);\n    const gy = Math.floor(wy / TILE_SIZE);\n\n    // Boundary check\n    if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n        // Rooms have strict boundaries. Main map allows falling off the bottom.\n        // checkCollision handles top/left/right boundaries for main map.\n        return isRoom; \n    }\n\n    // Allow movement above the map (already handled by gx,gy check usually, but just in case)\n    if (wy < 0) return false;\n\n    // 0. Check for active rooms (sub-maps) - Priority check\n    if (!isRoom && maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n      let insideAnyRoom = false;\n      \n      for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n        const idx = parseInt(idxStr);\n        if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n          const roomMap = maps[meta.linkedMapId];\n          if (!roomMap) continue;\n\n          const rx = (idx % mapWidthTiles) * TILE_SIZE;\n          const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n          const rw = (meta.width || 1) * TILE_SIZE;\n          const rh = (meta.height || 1) * TILE_SIZE;\n\n          // Boundary check with pixel precision\n          // Pievienojam nelielu pielaidi (0.2px) apak, lai snapping loika vertical.js \n          // (kas izmanto y + height - 0.1) nepalaistu garm istabas grdu.\n          if (wx >= rx && wx < rx + rw && wy >= ry && wy < ry + rh + 0.2) {\n            insideAnyRoom = true;\n            \n            const localWx = wx - rx;\n            const localWy = wy - ry;\n            \n            const roomTileW = roomMap.mapWidth || roomMap.width;\n            const roomTileH = roomMap.mapHeight || roomMap.height;\n            \n            const roomTiles = roomMap.tileMapData || roomMap.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data;\n            const roomObjects = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            const roomSecrets = roomMap.secretMapData || roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data;\n\n            const solidInRoom = isSolidAtPixel(\n              localWx, localWy, \n              roomTileW, roomTileH, TILE_SIZE, \n              roomTiles, \n              registryItems, \n              roomSecrets, \n              roomObjects, \n              roomMap.objectMetadata, \n              null, \n              ignoreEntityId,\n              null,\n              null,\n              true // WE ARE IN A ROOM\n            );\n\n            if (solidInRoom) return true;\n            \n            // If the room map has NO content at this spot, it's a window/open area.\n            // The recursive call with isRoom=true already blocked the boundaries of the room map.\n            return false;\n          }\n        }\n      }\n      \n      if (!insideAnyRoom) {\n        // Izmums: aujam atrasties uz durvm, kas ir atvrtas, pat ja ts ir rpus room_area.\n        // Tas ir nepiecieams, lai spltjs neiestrgtu teleportcijas brd, izejot no istabas.\n        const index = gy * mapWidthTiles + gx;\n        const objId = objectData && objectData[index];\n        if (objId) {\n        const objDef = getDefById(registryItems, objId);\n          if (objDef && objDef.subtype === 'door') {\n            const meta = (objectMetadata && objectMetadata[index]) || {};\n            let frame = meta.currentFrame;\n            if (frame === undefined) frame = 0;\n            \n            const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n            if (frame !== closedFrame) {\n              return false; // Durvis ir atvrtas, aujam te atrasties\n            }\n          }\n        }\n        return true; \n      }\n    }\n\n    const index = gy * mapWidthTiles + gx;\n    \n    // 0. Check entities first (dynamic obstacles)\n    if (entities) {\n      for (const ent of entities) {\n        if (ent.id === ignoreEntityId) continue;\n        if (ent.health <= 0 || ent.isExploding) continue;\n        // Platforms are stand-on-able but not usually \"solid\" for other entities' horizontal physics\n        if (ent.subtype === 'platform') continue;\n        // Fish should not block movement (player or other entities)\n        if (ent.subtype === 'fish' || ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish) continue;\n\n        if (wx >= ent.x && wx < ent.x + ent.width && wy >= ent.y && wy < ent.y + ent.height) {\n          return true;\n        }\n      }\n    }\n\n    // Check if this tile has a secret - secrets make tiles passable\n    if (secretData && secretData[index]) {\n      return false;\n    }\n\n    // 1. Check objects layer first (like the wooden box)\n    if (objectData && objectData[index]) {\n      const objId = objectData[index];\n      const objDef = getDefById(registryItems, objId);\n      \n      const isEntity = objDef && (\n        objDef.type === 'entity' || \n        objDef.subtype === 'tank' || \n        objDef.subtype === 'platform' ||\n        objDef.subtype === 'pushable' ||\n        objDef.isPushable ||\n        (objDef.name && objDef.name.toLowerCase().includes('entities.'))\n      );\n\n      if (objDef && objDef.collision && !isEntity) {\n        // Durvju specil loika: atvrtas/lietotas durvis nav cietas\n        if (objDef.subtype === 'door') {\n          const meta = (objectMetadata && objectMetadata[index]) || {};\n          let frame = meta.currentFrame;\n          \n          if (frame === undefined) {\n              // Default frame for rooms is 'inside' (open)\n              if (isRoom) {\n                  frame = objDef.interaction?.frames?.inside ?? 0;\n              } else {\n                  frame = 0; // Default for main map is closed\n              }\n          }\n\n          const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n          \n          // Ja durvis nav aizvrtas (ir atvrans fz vai atvrtas), ts nav cietas\n          if (frame !== closedFrame) {\n            return false;\n          }\n        }\n\n        // Special logic for destructible objects like the wooden box\n        if (objDef.isDestructible && objectMetadata && objectMetadata[index]) {\n          const health = objectMetadata[index].health !== undefined ? objectMetadata[index].health : objDef.maxHealth;\n          const threshold = objDef.passableHealthThreshold || 0;\n          if (health <= threshold) {\n            return false; // Box is broken, can pass through\n          }\n        }\n        return true;\n      }\n    }\n\n    // 2. Check tiles layer\n    const tileId = tileData[index];\n    if (!tileId) return false;\n    const tileDef = getDefById(registryItems, tileId);\n    if (!tileDef || !tileDef.collision) return false;\n    if (tileDef.collision === true) return true;\n    if (typeof tileDef.collision === 'object') {\n      return !!(\n        tileDef.collision.top ||\n        tileDef.collision.bottom ||\n        tileDef.collision.left ||\n        tileDef.collision.right\n      );\n    }\n    return false;\n  } catch (error) {\n    console.error('Error in isSolidAtPixel:', error);\n    return false;\n  }\n}\n\n// AABB collision check for player rectangle at (newX, newY)\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds) {\n  // Insets and epsilon values to prevent \"sticking\" and ensure stable grounding.\n  // inset: distance from corners for edge-mid points to avoid catching perpendicular walls.\n  // eps: small offset from the actual edge to ensure we stay within the intended tile/boundary.\n  const inset = 1.0; \n  const eps = 0.1;\n  \n  const points = [\n    // Vertical checks (Top/Bottom)\n    { x: newX + inset, y: newY + eps }, \n    { x: newX + width - inset, y: newY + eps },\n    { x: newX + width / 2, y: newY + eps },\n    \n    { x: newX + inset, y: newY + height - eps },\n    { x: newX + width - inset, y: newY + height - eps },\n    { x: newX + width / 2, y: newY + height - eps },\n\n    // Horizontal checks (Left/Right)\n    { x: newX + eps, y: newY + inset },\n    { x: newX + eps, y: newY + height - inset },\n    { x: newX + eps, y: newY + height / 2 },\n\n    { x: newX + width - eps, y: newY + inset },\n    { x: newX + width - eps, y: newY + height - inset },\n    { x: newX + width - eps, y: newY + height / 2 }\n  ];\n\n  for (let p of points) {\n    const gx = Math.floor(p.x / TILE_SIZE);\n    const gy = Math.floor(p.y / TILE_SIZE);\n    \n    // Boundary checks: block left, right, and top edges of the world.\n    // Allow falling off the bottom (gy >= mapHeightTiles).\n    if (gx < 0 || gx >= mapWidthTiles || gy < 0) return true;\n\n    if (isSolidAtPixel(p.x, p.y, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Gets physical properties of the surface below the player (friction, acceleration)\n */\nexport function getSurfaceProperties(x, y, width, height, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectMetadata, maps, activeRoomIds) {\n  const cx = x + width / 2;\n  const feetY = y + height + 1; // 1 pixel below feet\n\n  // Check for active rooms (sub-maps) - Priority check\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n    for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidthTiles) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (cx >= rx && cx < rx + rw && feetY >= ry && feetY < ry + rh + 2) {\n          // Point is inside an active room!\n          const localCx = cx - rx;\n          const localFeetY = feetY - ry;\n          \n          const roomTileW = roomMap.mapWidth || roomMap.width;\n          const roomTileH = roomMap.mapHeight || roomMap.height;\n          \n          return getSurfaceProperties(\n            localCx - width/2, localFeetY - height - 1, width, height,\n            roomTileW, roomTileH, TILE_SIZE,\n            roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data),\n            registryItems,\n            roomMap.secretMapData,\n            roomMap.objectMetadata,\n            null,\n            null\n          );\n        }\n      }\n    }\n  }\n\n  const gx = Math.floor(cx / TILE_SIZE);\n  const gy = Math.floor(feetY / TILE_SIZE);\n  \n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n    return { friction: 0.8, acceleration: 0.2 };\n  }\n  \n  const index = gy * mapWidthTiles + gx;\n  const tileId = tileData ? tileData[index] : null;\n  if (!tileId) return { friction: 0.8, acceleration: 0.2 };\n  \n    const tileDef = getDefById(registryItems, tileId);\n  if (!tileDef) return { friction: 0.8, acceleration: 0.2 };\n  \n  // If block has slipperiness, use it. Default friction is 0.8.\n  const slipperiness = tileDef.slipperiness !== undefined ? tileDef.slipperiness : 0.8;\n  \n  return {\n    friction: slipperiness,\n    // When slippery, acceleration is lower (harder to start/change direction)\n    acceleration: tileDef.slipperiness !== undefined ? (1 - slipperiness) * 2 + 0.05 : 0.2\n  };\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n  getSurfaceProperties\n};\n","import weatherDamageConfig from '../../assets/json/system/weather_damage.json';\n\nconst clampIntensity = (v) => {\n  const n = Number(v) || 0;\n  return Math.max(0, Math.min(100, n));\n};\n\nconst getWeatherConfig = (type) => {\n  return weatherDamageConfig?.weather?.[type] || null;\n};\n\nexport const getMapWeather = (mapData) => {\n  if (!mapData) return {};\n  let base = {};\n  if (mapData.weather) base = mapData.weather;\n  else {\n    const metaWeather = mapData.meta?.weather;\n    if (metaWeather && Object.keys(metaWeather).length > 0) {\n      base = metaWeather;\n    } else {\n      const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap;\n      if (activeId && mapData.maps && mapData.maps[activeId] && mapData.maps[activeId].weather) {\n        base = mapData.maps[activeId].weather;\n      } else {\n        base = mapData.meta?.weather || {};\n      }\n    }\n  }\n  let runtime = {};\n  try {\n    const rt = window.__GAME_RUNTIME_SETTINGS__ || {};\n    runtime = {\n      rain: rt.weatherRain,\n      snow: rt.weatherSnow,\n      clouds: rt.weatherClouds,\n      fog: rt.weatherFog,\n      thunder: rt.weatherThunder,\n      lavaRain: rt.weatherLavaRain,\n      radioactiveFog: rt.weatherRadioactiveFog,\n      meteorRain: rt.weatherMeteorRain\n    };\n  } catch {}\n  const merged = { ...base };\n  Object.keys(runtime).forEach(key => {\n    if (runtime[key] !== undefined && runtime[key] !== null) {\n      merged[key] = runtime[key];\n    }\n  });\n  return merged;\n};\n\nexport const getWeatherDps = (type, intensity) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return 0;\n  const pct = clampIntensity(intensity);\n  if (pct <= 0) return 0;\n  const maxDps = Number(cfg.maxDps) || 0;\n  const minDps = Number(cfg.minDps) || 0;\n  const dps = (pct / 100) * maxDps;\n  return Math.max(minDps, dps);\n};\n\nexport const getRadioactivityRates = () => {\n  const cfg = getWeatherConfig('radioactiveFog') || {};\n  const inc = Number(cfg.radioactivityPerSecond);\n  const dec = Number(cfg.radioactivityRegenPerSecond);\n  return {\n    increase: Number.isFinite(inc) ? inc : 0,\n    decay: Number.isFinite(dec) ? dec : 0\n  };\n};\n\nexport const weatherAffectsPlayer = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  return !!cfg.affects?.player;\n};\n\nexport const weatherAffectsEnemy = (type, enemyId, enemyName) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  const enemies = cfg.affects?.enemies;\n  if (enemies === 'true') return true;\n  if (enemies === true || enemies === 'all') return true;\n  if (enemies && typeof enemies === 'object' && enemies.mode === 'all') {\n    const excluded = Array.isArray(enemies.exclude) ? enemies.exclude : [];\n    const isExcluded = (value) => value && excluded.some(ex => value === ex || value.includes(ex));\n    if (isExcluded(enemyId)) return false;\n    if (isExcluded(enemyName)) return false;\n    return true;\n  }\n  if (Array.isArray(enemies)) {\n    if (enemyId && enemies.some(ex => enemyId === ex || enemyId.includes(ex))) return true;\n    if (enemyName && enemies.some(ex => enemyName === ex || enemyName.includes(ex))) return true;\n    return false;\n  }\n  return false;\n};\n\nexport const weatherBlockedByCover = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg) return false;\n  return !!cfg.blockedByCover;\n};\n","import { isSolidAtPixel } from '../physics/collision';\n\nconst isInsideActiveRoom = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  secretData,\n  objectMetadata,\n  activeRoomIds\n}) => {\n  if (!activeRoomIds || !activeRoomIds.length) return false;\n  if (!secretData || !objectMetadata) return false;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false;\n  for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n    const idx = parseInt(idxStr, 10);\n    if (secretData[idx] !== 'room_area') continue;\n    if (!meta?.linkedMapId || !activeRoomIds.includes(meta.linkedMapId)) continue;\n    const rx = idx % mapWidth;\n    const ry = Math.floor(idx / mapWidth);\n    const rw = meta.width || 1;\n    const rh = meta.height || 1;\n    if (gx >= rx && gx < rx + rw && gy >= ry && gy < ry + rh) return true;\n  }\n  return false;\n};\n\nexport const isCoveredFromAbove = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  tileData,\n  registryItems,\n  secretData,\n  objectData,\n  objectMetadata,\n  maps,\n  activeRoomIds\n}) => {\n  if (!Number.isFinite(x) || !Number.isFinite(y)) return false;\n  if (isInsideActiveRoom({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectMetadata, activeRoomIds })) {\n    return true;\n  }\n  const gridX = Math.floor(x / TILE_SIZE);\n  if (gridX < 0 || gridX >= mapWidth) return false;\n  let gridY = Math.floor(y / TILE_SIZE) - 1;\n  for (; gridY >= 0; gridY--) {\n    const wx = gridX * TILE_SIZE + TILE_SIZE / 2;\n    const wy = gridY * TILE_SIZE + TILE_SIZE / 2;\n    if (isSolidAtPixel(wx, wy, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, null, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n};\n","import { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { isSolidAtPixel } from '../physics';\nimport { getWeatherDps, getMapWeather, weatherAffectsEnemy, weatherBlockedByCover } from './weatherDamage';\nimport { isCoveredFromAbove } from './weatherCover';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nconst getTileLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.tileMapData)) return mapData.tileMapData;\n  const layer = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile');\n  return layer?.data || [];\n};\n\nconst getSecretLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.secretMapData)) return mapData.secretMapData;\n  const layer = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret');\n  return layer?.data || [];\n};\n\nconst liquidTypeToHabitat = (liquidType) => {\n  if (!liquidType) return 'none';\n  if (liquidType.includes('radioactive')) return 'radioactive';\n  if (liquidType.includes('lava')) return 'lava';\n  if (liquidType.includes('quicksand')) return 'quicksand';\n  if (liquidType.includes('water')) return 'water';\n  return 'none';\n};\n\nconst isFishEntity = (ent) => {\n  if (!ent) return false;\n  const def = ent.def || {};\n  return ent.subtype === 'fish' || def.subtype === 'fish' || def.ai?.type === 'fish' || !!def.fish;\n};\n\nconst getFishTriggerAt = ({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectData, registryItems }) => {\n  if (!registryItems) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return null;\n  const idx = gy * mapWidth + gx;\n  const secretId = secretData ? secretData[idx] : null;\n  const objectId = objectData ? objectData[idx] : null;\n  const def = getDefById(registryItems, secretId) || getDefById(registryItems, objectId);\n  if (!def) return null;\n  if (def.type === 'secret' && def.subtype === 'animal_trigger' && def.triggerType === 'fish') return def;\n  return null;\n};\n\nconst getWaterSurfaceY = ({ x, mapWidth, mapHeight, tileData, registryItems, TILE_SIZE }) => {\n  if (!tileData || mapWidth <= 0 || mapHeight <= 0) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  if (gx < 0 || gx >= mapWidth) return null;\n  for (let gy = 0; gy < mapHeight; gy++) {\n    const idx = gy * mapWidth + gx;\n    const id = tileData[idx];\n    if (!id) continue;\n    const def = getDefById(registryItems, id);\n    if (!def || !def.flags || !def.flags.liquid) continue;\n    if (def.flags.water || def.flags.waterfall) {\n      return gy * TILE_SIZE;\n    }\n  }\n  return null;\n};\n\n/**\n * Atjaunina visas aktvs enttijas (piemram, tankus).\n * @param {Object} ctx Konteksts ar nepiecieamajiem datiem un funkcijm\n * @param {number} deltaMs Laiks kop pdj kadra\n */\nexport function updateEntities(ctx, deltaMs) {\n  const {\n    entitiesRef,\n    gameState,\n    mapWidth,\n    mapHeight,\n    TILE_SIZE,\n    checkCollision,\n    isLiquidAt,\n    getLiquidSample,\n    spawnProjectile,\n    playSfx,\n    constants,\n    objectData,\n    mapData,\n    registryItems,\n    onStateUpdate,\n    activeRoomIds\n  } = ctx;\n\n  if (!entitiesRef.current || entitiesRef.current.length === 0) return;\n\n  const { GRAVITY, TERMINAL_VELOCITY } = constants;\n  const playerX = gameState.current.x;\n  const playerY = gameState.current.y;\n  const weatherNow = getMapWeather(mapData);\n  const lavaRainInt = Number(weatherNow.lavaRain || 0);\n  const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n\n  // Ms modificjam enttijas pa tieo ref\n  const entities = entitiesRef.current;\n  for (let i = entities.length - 1; i >= 0; i--) {\n    const entity = entities[i];\n    const def = entity.def || {};\n    const isFish = def?.subtype === 'fish' || def?.ai?.type === 'fish' || !!def?.fish;\n    // 1. Ja enttija ir mirusi, apstrdjam sprdzienu vai noemanu\n    if (entity.health <= 0 && !isFish) {\n      if (!entity.isExploding) {\n        entity.isExploding = true;\n        entity.animation = 'explode';\n        entity.animFrame = 0;\n        entity.animTimer = 0;\n        entity.vx = 0; // Apstjamies sprdziena laik\n        entity.vy = 0;\n        entity.isGrounded = true; // Sprgst uz zemes\n      }\n      \n      const explodeAnim = def.spriteSheet?.animations?.explode || [];\n      const totalFrames = explodeAnim.length;\n      const frameDuration = 100; // ms uz kadru\n      \n      entity.animTimer += deltaMs;\n      if (entity.animTimer >= frameDuration) {\n        entity.animTimer = 0;\n        entity.animFrame++;\n        if (entity.animFrame >= totalFrames) {\n          entity.shouldRemove = true;\n        }\n      }\n      if (entity.shouldRemove) {\n        entities.splice(i, 1);\n      }\n      continue;\n    }\n\n    // 1.2. Liquid damage (e.g. lava, radioactive water)\n    const liquidSample = getLiquidSample ? getLiquidSample({\n      x: entity.x,\n      y: entity.y,\n      width: entity.width,\n      height: entity.height,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight\n    }) : { inLiquid: false };\n\n    if (isFish) {\n      const cfg = def.fish || {};\n      const activeRadiusPx = (Number(cfg.activeRadius) || 18) * TILE_SIZE;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      const dxView = (playerX + gameState.current.width / 2) - ex;\n      const dyView = (playerY + gameState.current.height / 2) - ey;\n      const distView = Math.sqrt(dxView * dxView + dyView * dyView);\n      const isActive = distView <= activeRadiusPx;\n\n      if (!isActive && entity.health > 0) {\n        entity.isDormant = true;\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.animation = 'idle';\n        const idleAnim = def.spriteSheet?.animations?.idle || [0];\n        entity.currentSpriteIndex = idleAnim[0] || 0;\n        continue;\n      }\n      entity.isDormant = false;\n    }\n\n    if (liquidSample.inLiquid && liquidSample.params && liquidSample.params.dps > 0) {\n      entity.liquidDamageAcc = (entity.liquidDamageAcc || 0) + deltaMs;\n      while (entity.liquidDamageAcc >= 1000) {\n        entity.liquidDamageAcc -= 1000;\n        const dmg = liquidSample.params.dps;\n        entity.health = Math.max(0, entity.health - dmg);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: dmg\n          });\n        }\n      }\n    } else {\n      entity.liquidDamageAcc = 0;\n    }\n\n    // 1.3. Weather damage (Lava Rain, Radioactive Fog)\n    const enemyId = entity.defId || def?.id;\n    const enemyName = def?.name;\n    let lavaDps = weatherAffectsEnemy('lavaRain', enemyId, enemyName) ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    if (lavaDps > 0 && liquidSample.inLiquid && liquidSample.type && liquidSample.type.includes('water')) {\n      lavaDps = 0;\n    }\n    const radioDps = weatherAffectsEnemy('radioactiveFog', enemyId, enemyName) ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data || [];\n        const secretData = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n        const objectMetadata = mapData.meta?.objectMetadata || {};\n        const covered = isCoveredFromAbove({\n          x: entity.x + entity.width / 2,\n          y: entity.y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIds || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const totalWeatherDps = lavaDps + radioDps;\n\n    if (totalWeatherDps > 0) {\n      entity.weatherDamageAcc = (entity.weatherDamageAcc || 0) + deltaMs;\n      if (entity.weatherDamageAcc >= 1000) {\n        entity.weatherDamageAcc -= 1000;\n        entity.health = Math.max(0, entity.health - totalWeatherDps);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: totalWeatherDps\n          });\n        }\n      }\n    } else {\n      entity.weatherDamageAcc = 0;\n    }\n\n    if (isFish) {\n      const cfg = def.fish || {};\n      const habitat = cfg.habitat || {};\n      const now = Number(gameState.current.timeMs) || 0;\n      const dt = Math.max(0, Number(deltaMs) || 0) / 1000;\n      const liquidType = liquidSample?.type || null;\n      const habitatKey = liquidTypeToHabitat(liquidType);\n      const isAllowed = !!(liquidSample?.inLiquid && habitatKey && habitat[habitatKey] !== false);\n      const requireLiquid = cfg.requireLiquid !== false;\n      const inWaterNow = !!(liquidSample?.inLiquid && habitatKey === 'water');\n\n      entity.fishState = entity.fishState || {};\n      const fs = entity.fishState;\n\n      if (!fs.initialized) {\n        fs.initialized = true;\n        entity.direction = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.animFrame = 0;\n        fs.animTimer = 0;\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health > 0) {\n        const prevInWater = !!fs.prevInWater;\n        if (prevInWater && !inWaterNow && def.sounds?.water_out) {\n          playSfx(def.sounds.water_out, 0.35);\n        } else if (!prevInWater && inWaterNow && def.sounds?.water_in) {\n          playSfx(def.sounds.water_in, 0.35);\n        }\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health <= 0) {\n        const player = gameState.current;\n        const hit = (\n          player.x < entity.x + entity.width &&\n          player.x + player.width > entity.x &&\n          player.y < entity.y + entity.height &&\n          player.y + player.height > entity.y\n        );\n        if (hit) {\n          gameState.current.fishCount = Math.max(0, (Number(gameState.current.fishCount) || 0) + 1);\n          entities.splice(i, 1);\n          continue;\n        }\n        if (entity.fishState?.removeOnNext) {\n          entities.splice(i, 1);\n          continue;\n        }\n        const tileData = getTileLayerData(mapData);\n        const secretData = getSecretLayerData(mapData);\n        const objectMetadata = mapData?.meta?.objectMetadata;\n        const cx = entity.x + entity.width / 2;\n        const headY = entity.y + Math.min(4, entity.height * 0.125);\n        const chestY = entity.y + entity.height * 0.45;\n        const feetY = entity.y + entity.height - 2;\n        const solidAtSample = isSolidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds);\n        const canFloat = !!(liquidSample?.inLiquid && liquidSample?.type && liquidSample.type.includes('water') && !solidAtSample);\n        if (canFloat) {\n          const surfaceY = getWaterSurfaceY({\n            x: entity.x + entity.width / 2,\n            mapWidth,\n            mapHeight,\n            tileData,\n            registryItems,\n            TILE_SIZE\n          });\n          const surfaceOffset = Number.isFinite(cfg.deathSurfaceOffset) ? cfg.deathSurfaceOffset : 0.5;\n          if (Number.isFinite(surfaceY)) {\n            const targetY = surfaceY - entity.height * surfaceOffset;\n            const floatSpeed = (Number(cfg.deathFloatSpeed) || 0.25) * TILE_SIZE;\n            if (entity.y > targetY) {\n              entity.y = Math.max(targetY, entity.y - floatSpeed * dt);\n            } else {\n              entity.y = targetY;\n            }\n          }\n        }\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.isGrounded = canFloat ? false : checkCollision(entity.x, entity.y + 1, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n        entity.flipY = true;\n        entity.animation = 'dead';\n        const deadAnim = def.spriteSheet?.animations?.dead || [];\n        entity.currentSpriteIndex = deadAnim.length ? deadAnim[0] : (cfg.meteorShockFrame || 2);\n        continue;\n      }\n\n      entity.flipY = false;\n      entity.alpha = 1;\n\n      if (requireLiquid && !isAllowed && !fs.isJumping) {\n        entities.splice(i, 1);\n        continue;\n      }\n\n      const panicRadiusPx = (Number(cfg.panicRadius) || 6) * TILE_SIZE;\n      const panicSpeed = (Number(cfg.panicSpeed) || 2.2) * TILE_SIZE;\n      const baseSpeed = (Number(cfg.swimSpeed) || 0.6) * TILE_SIZE;\n      const verticalDrift = (Number(cfg.verticalDrift) || 0.25) * TILE_SIZE;\n      const isWaterfall = !!(liquidType && liquidType.includes('waterfall'));\n      const waterfallDriftMultiplier = Number.isFinite(cfg.waterfallDriftMultiplier) ? cfg.waterfallDriftMultiplier : 0.4;\n      const waterfallSpeedMultiplier = Number.isFinite(cfg.waterfallSpeedMultiplier) ? cfg.waterfallSpeedMultiplier : 0.7;\n\n      const triggerDef = getFishTriggerAt({\n        x: entity.x + entity.width / 2,\n        y: entity.y + entity.height / 2,\n        mapWidth,\n        mapHeight,\n        TILE_SIZE,\n        secretData: getSecretLayerData(mapData),\n        objectData,\n        registryItems\n      });\n      const triggerCfg = triggerDef?.fishTrigger || {};\n      const fishJumpCfg = cfg.jump || {};\n      const mergedJumpCfg = { ...triggerCfg, ...fishJumpCfg };\n      const nowMs = Number(gameState.current.timeMs) || 0;\n      const nextJumpAt = Number(fs.nextJumpAt) || 0;\n      const canJump = !fs.isJumping && nowMs >= nextJumpAt && triggerDef && liquidSample?.inLiquid && liquidTypeToHabitat(liquidType) === 'water';\n\n      if (canJump) {\n        const chance = Math.max(0, Math.min(1, Number(mergedJumpCfg.chance ?? 1)));\n        if (Math.random() <= chance) {\n          const jumpDir = Math.random() < 0.5 ? -1 : 1;\n          entity.direction = jumpDir;\n          fs.isJumping = true;\n          fs.jumpVx = (Number(mergedJumpCfg.speedX) || 3.5) * TILE_SIZE * jumpDir;\n          fs.jumpVy = -(Number(mergedJumpCfg.speedY) || 6) * TILE_SIZE;\n          fs.jumpGravity = (Number(mergedJumpCfg.gravity) || 18) * TILE_SIZE;\n          fs.jumpBounce = Number.isFinite(mergedJumpCfg.bounce) ? Number(mergedJumpCfg.bounce) : 0.35;\n          fs.nextJumpAt = nowMs + (Number(mergedJumpCfg.cooldownMs) || 1400);\n        }\n      }\n\n      if (fs.isJumping) {\n        const dtSec = Math.max(0, Number(deltaMs) || 0) / 1000;\n        fs.jumpVy = (Number(fs.jumpVy) || 0) + (Number(fs.jumpGravity) || (GRAVITY * 60)) * dtSec;\n        let nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        let nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n\n        if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          fs.jumpVx = -(Number(fs.jumpVx) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        }\n\n        if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          if ((Number(fs.jumpVy) || 0) > 0) {\n            entity.health = 0;\n            fs.isJumping = false;\n            entity.vx = 0;\n            entity.vy = 0;\n            entity.isGrounded = true;\n            entity.x = nextX;\n            entity.y = Math.floor((nextY + entity.height - 0.1) / TILE_SIZE) * TILE_SIZE - entity.height;\n            continue;\n          }\n          fs.jumpVy = Math.abs(Number(fs.jumpVy) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n        }\n\n        const landingSample = getLiquidSample ? getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        }) : { inLiquid: false };\n\n        if (landingSample?.inLiquid && liquidTypeToHabitat(landingSample?.type) === 'water' && (Number(fs.jumpVy) || 0) > 0) {\n          fs.isJumping = false;\n          entity.vx = 0;\n          entity.vy = 0;\n        } else {\n          entity.vx = Number(fs.jumpVx) || 0;\n          entity.vy = Number(fs.jumpVy) || 0;\n        }\n\n        entity.x = nextX;\n        entity.y = nextY;\n        entity.isGrounded = false;\n        continue;\n      }\n\n      const px = playerX + gameState.current.width / 2;\n      const py = playerY + gameState.current.height / 2;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      const dx = px - ex;\n      const dy = py - ey;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (fs.shockUntil && fs.shockUntil > now) {\n        const shockFrame = Number(cfg.meteorShockFrame) || 2;\n        entity.animation = 'shock';\n        entity.currentSpriteIndex = shockFrame;\n      }\n\n      const lastWaterEnter = gameState.current.lastWaterEnter;\n      if (lastWaterEnter && Number(lastWaterEnter.time) && now - Number(lastWaterEnter.time) < 1200) {\n        const waveRadiusPx = (Number(cfg.playerWaveRadius) || 10) * TILE_SIZE;\n        if (dist <= waveRadiusPx) {\n          fs.waveImpulse = Number(cfg.playerWaveImpulse) || 0.35;\n          fs.waveUntil = now + 400;\n        }\n        if (dist <= panicRadiusPx) {\n          fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n        }\n      }\n      if (gameState.current.inWater && dist <= panicRadiusPx) {\n        fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n      }\n\n      const isPanicking = fs.panicUntil && fs.panicUntil > now;\n      let dir = entity.direction || 1;\n      if (isPanicking) {\n        dir = dx >= 0 ? -1 : 1;\n      } else if (now >= (fs.nextTurnAt || 0)) {\n        dir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n      }\n      entity.direction = dir;\n\n      if (now >= (fs.nextVerticalAt || 0)) {\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n      }\n\n      let vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n      let vy = (fs.verticalDir || 1) * verticalDrift;\n      if (isWaterfall) {\n        vx *= waterfallSpeedMultiplier;\n        vy *= waterfallDriftMultiplier;\n        const downSpeed = (Number(cfg.waterfallDownSpeed) || 2.4) * TILE_SIZE;\n        vy = Math.max(Math.abs(vy), downSpeed);\n        entity.alpha = Number.isFinite(cfg.waterfallAlpha) ? cfg.waterfallAlpha : 1;\n      }\n\n      if (fs.waveUntil && fs.waveUntil > now) {\n        const impulse = Math.max(0, Number(fs.waveImpulse) || 0.35) * TILE_SIZE;\n        vx += (Math.random() - 0.5) * impulse;\n        vy += (Math.random() - 0.5) * impulse * 0.5;\n      }\n\n      let nextX = entity.x + vx * dt;\n      let nextY = entity.y + vy * dt;\n\n      if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        dir *= -1;\n        entity.direction = dir;\n        vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n        nextX = entity.x + vx * dt;\n      }\n\n      if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        fs.verticalDir *= -1;\n        vy = fs.verticalDir * verticalDrift;\n        nextY = entity.y + vy * dt;\n      }\n\n      if (typeof getLiquidSample === 'function') {\n        const sampleNext = getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        });\n        const nextType = liquidTypeToHabitat(sampleNext?.type);\n        const nextAllowed = !!(sampleNext?.inLiquid && nextType && habitat[nextType] !== false);\n        if (!nextAllowed) {\n          fs.verticalDir *= -1;\n          dir *= -1;\n          entity.direction = dir;\n          vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n          vy = fs.verticalDir * verticalDrift;\n          nextX = entity.x + vx * dt;\n          nextY = entity.y + vy * dt;\n        }\n      }\n\n      if (entitiesRef?.current?.length) {\n        const cx = nextX + entity.width / 2;\n        const cy = nextY + entity.height / 2;\n        const gx = Math.floor(cx / TILE_SIZE);\n        const gy = Math.floor(cy / TILE_SIZE);\n        for (const other of entitiesRef.current) {\n          if (other.id === entity.id) continue;\n          if (!isFishEntity(other) || other.health <= 0) continue;\n          const ocx = other.x + other.width / 2;\n          const ocy = other.y + other.height / 2;\n          if (Math.floor(ocx / TILE_SIZE) !== gx || Math.floor(ocy / TILE_SIZE) !== gy) continue;\n          const dir = String(entity.id) < String(other.id) ? -1 : 1;\n          const nudge = dir * TILE_SIZE * 0.25;\n          const tryX = nextX + nudge;\n          if (!checkCollision(tryX, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextX = tryX;\n            entity.direction = dir;\n            break;\n          }\n          const tryY = nextY + nudge;\n          if (!checkCollision(nextX, tryY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextY = tryY;\n            break;\n          }\n        }\n      }\n\n      entity.x = nextX;\n      entity.y = nextY;\n      entity.vx = vx;\n      entity.vy = vy;\n      entity.isGrounded = false;\n\n      const anims = def.spriteSheet?.animations || {};\n      let animKey = 'swim';\n      if (isPanicking && anims.panic) animKey = 'panic';\n      if (Math.abs(vx) < 0.02 && anims.idle) animKey = 'idle';\n\n      if (!(fs.shockUntil && fs.shockUntil > now)) {\n        const currentAnim = anims[animKey] || anims.swim || anims.idle || [0];\n        fs.animTimer = (fs.animTimer || 0) + deltaMs;\n        const frameDur = 180;\n        if (fs.animTimer >= frameDur) {\n          fs.animTimer = 0;\n          fs.animFrame = (fs.animFrame || 0) + 1;\n          if (fs.animFrame >= currentAnim.length) fs.animFrame = 0;\n        }\n        entity.currentSpriteIndex = currentAnim[fs.animFrame % currentAnim.length];\n      }\n\n      continue;\n    }\n\n    // 1.5. Pushable objektu (Akmeu) fizika\n    if (entity.subtype === 'pushable' || def?.isPushable) {\n      const inLiquid = liquidSample.inLiquid;\n      const liquidType = liquidSample.type;\n\n      // Skaas, ja iekrt idrum\n      if (inLiquid && !entity.prevInLiquid) {\n        if (liquidType === 'water' && def.sounds?.water_splash) {\n          playSfx(def.sounds.water_splash, 0.4);\n        } else if (liquidType === 'lava' && def.sounds?.lava_splash) {\n          playSfx(def.sounds.lava_splash, 0.4);\n        }\n      }\n      entity.prevInLiquid = inLiquid;\n\n        // Horizontl kustba ar berzi\n        const mh = moveHorizontal({\n          keys: {}, \n          state: { x: entity.x, y: entity.y, vx: entity.vx || 0, width: entity.width, height: entity.height, direction: entity.direction },\n          MOVE_SPEED: 6.0, // Palielints max trums akmeiem (Supaplex stil)\n          TILE_SIZE,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) return true;\n            \n            // Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            return (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n          },\n          friction: inLiquid ? 0.7 : 0.85,\n          acceleration: 0.2\n        });\n        entity.x = mh.x;\n        entity.vx = mh.vx;\n        entity.direction = mh.direction;\n\n      // Vertikl fizika\n      if (inLiquid && liquidType === 'lava') {\n        // Lna slkana lav\n        const sinkingSpeed = def.sinkingSpeed || 0.2;\n        entity.vy = sinkingSpeed;\n        entity.y += entity.vy;\n        entity.isGrounded = false;\n        \n        // Prbaudm vai neesam izgjui cauri zemei lav\n        if (checkCollision(entity.x, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n           // Atstumjam atpaka, ja atduras pret dibenu\n           entity.y -= entity.vy;\n           entity.vy = 0;\n           entity.isGrounded = true;\n        }\n      } else {\n        // Fall distance tracking: if falling, accumulate distance\n        if (entity.isGrounded) {\n          entity.fallDistance = 0;\n        } else if ((entity.vy || 0) > 0) {\n          entity.fallDistance = (entity.fallDistance || 0) + (entity.vy || 0);\n        }\n\n        // Standarta gravitcija (den lnka)\n        const vp = applyVerticalPhysics({\n          keys: {}, \n          x: entity.x,\n          y: entity.y,\n          vy: entity.vy || 0,\n          isGrounded: entity.isGrounded,\n          animation: 'idle',\n          GRAVITY: inLiquid ? GRAVITY * 0.3 : GRAVITY,\n          TERMINAL_VELOCITY,\n          JUMP_FORCE: 0,\n          TILE_SIZE,\n          width: entity.width,\n          height: entity.height,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // 1. Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) {\n              // Ja ms kaut kam uzkrtam un esam kritui pietiekami ilgi\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                // Atrodam kuru enttiju ms aizskrm (lai nogalintu ienaidniekus)\n                if (entitiesRef.current) {\n                  for (const other of entitiesRef.current) {\n                    if (other.id === entity.id || other.health <= 0 || other.subtype === 'platform' || other.subtype === 'pushable') continue;\n                    \n                    const hitOther = (\n                      nx < other.x + other.width &&\n                      nx + (w || entity.width) > other.x &&\n                      ny < other.y + other.height &&\n                      ny + (h || entity.height) > other.y\n                    );\n                    \n                    if (hitOther) {\n                      other.health = 0; // Nogalinm ienaidnieku\n                      // Vartu atskaot skau, ja tda definta\n                      if (def.sounds?.kill_enemy) {\n                        playSfx(def.sounds.kill_enemy, 0.5);\n                      }\n                    }\n                  }\n                }\n              }\n              return true;\n            }\n            \n            // 2. Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            const hitPlayer = (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n            \n            if (hitPlayer) {\n              // Ja akmens uzkrt spltjam pc brva kritiena (vismaz 1 tuks bloks)\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                gameState.current.health = 0; // Fatal impact\n              }\n              return true;\n            }\n            \n            return false;\n          },\n          isLiquidAt,\n          vx: entity.vx\n        });\n        entity.y = vp.y;\n        entity.vy = vp.vy;\n        entity.isGrounded = vp.isGrounded;\n\n        // --- ROLLING LOGIC (Supaplex style) ---\n        // Akmei ripo lej no citiem apaiem objektiem vai pakpieniem, ja ir brva vieta sn un pa diagonli\n        if (entity.isGrounded && Math.abs(entity.vx) < 0.1 && def.isRound) {\n          const checkEmpty = (tx, ty) => !checkCollision(tx, ty, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n          \n          // Minm ripot pa KREISI\n          const leftX = entity.x - TILE_SIZE;\n          // canRollLeft: vai flze pa kreisi ir brva UN vai flze pa kreisi uz leju ir brva (tukums/pakpiens)\n          const canRollLeft = checkEmpty(leftX, entity.y) && checkEmpty(leftX, entity.y + TILE_SIZE);\n          \n          if (canRollLeft) {\n            // Ripojam pa kreisi. Palielints trums (6.0), lai \"veas\" trk\n            entity.vx = -6.0; \n          } else {\n            // Minm ripot pa LABI\n            const rightX = entity.x + TILE_SIZE;\n            const canRollRight = checkEmpty(rightX, entity.y) && checkEmpty(rightX, entity.y + TILE_SIZE);\n            if (canRollRight) {\n              entity.vx = 6.0;\n            }\n          }\n        }\n\n        // Atjaunojam rotciju, ja akmens veas (horizontal movement while grounded)\n      if (entity.isGrounded && Math.abs(entity.vx) > 0.1 && def.isRound) {\n        // Rotcija proporcionla trumam (0.07 rad/px * vx)\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.07);\n        if (def.sounds?.roll) {\n          const nowMs = Number(gameState.current.timeMs) || 0;\n          const lastAt = Number(entity.lastRollSfxAt) || 0;\n          if (!lastAt || nowMs - lastAt >= 450) {\n            playSfx(def.sounds.roll, 0.35);\n            entity.lastRollSfxAt = nowMs;\n          }\n        }\n      } else if (!entity.isGrounded && def.isRound) {\n        // Ar krtot var nedaudz rott, ja ir bijis horizontls trums\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.03);\n      }\n      }\n\n      // Animcija akmenim parasti ir statiska\n      entity.animation = 'idle';\n      entity.currentSpriteIndex = def.spriteSheet?.animations?.idle?.[0] || 0;\n\n      continue;\n    }\n\n    // Platformu loika\n    if (entity.subtype === 'platform') {\n      const speed = def.speed || 1.5;\n      const mapW = mapWidth;\n      const mapH = mapHeight;\n      \n      // Mekljam bultias vairkos punktos (centr un mals), lai nepalaistu garm\n      const points = [\n        { x: entity.x + entity.width / 2, y: entity.y + entity.height / 2 }, // Centrs\n        { x: entity.x + 5, y: entity.y + entity.height / 2 },                // Kreis mala\n        { x: entity.x + entity.width - 5, y: entity.y + entity.height / 2 }  // Lab mala\n      ];\n      \n      let arrowId = null;\n      let foundArrowDef = null;\n\n      for (const p of points) {\n        const tx = Math.floor(p.x / TILE_SIZE);\n        const ty = Math.floor(p.y / TILE_SIZE);\n        \n        if (tx < 0 || tx >= mapW || ty < 0 || ty >= mapH) continue;\n        const idx = ty * mapW + tx;\n\n        // 1. Specilais arrows slnis\n        const arrowsLayer = ctx.mapData?.layers?.find(l => l.name === 'arrows' || l.name === 'Arrows')?.data;\n        let id = arrowsLayer ? arrowsLayer[idx] : null;\n        \n        // 2. Objektu slnis\n        if (!id && ctx.objectData) {\n          id = ctx.objectData[idx];\n        }\n\n        if (id) {\n          const aDef = getDefById(ctx.registryItems, id);\n          if (aDef && aDef.subtype === 'arrow') {\n            arrowId = id;\n            foundArrowDef = aDef;\n            break; \n          }\n        }\n      }\n      \n      if (foundArrowDef) {\n        // Mainm kustbas virzienu atbilstoi bultiai\n        if (foundArrowDef.direction === 'up') { entity.vx = 0; entity.vy = -speed; }\n        else if (foundArrowDef.direction === 'down') { entity.vx = 0; entity.vy = speed; }\n        else if (foundArrowDef.direction === 'left') { entity.vx = -speed; entity.vy = 0; }\n        else if (foundArrowDef.direction === 'right') { entity.vx = speed; entity.vy = 0; }\n      }\n\n      // Ja platforma vl nekustas, iedodam tai skuma impulsu\n      if (entity.vx === 0 && entity.vy === 0) {\n        entity.vx = speed;\n      }\n\n      // Kustba\n      let nextX = entity.x + entity.vx * (deltaMs / 16.6);\n      let nextY = entity.y + entity.vy * (deltaMs / 16.6);\n      \n      // Robeu prbaude (neaujam aizbraukt aiz kartes)\n      const worldW = mapWidth * TILE_SIZE;\n      const worldH = mapHeight * TILE_SIZE;\n      \n      if (nextX < 0) { \n        nextX = 0; \n        entity.vx = Math.abs(entity.vx); // Move Right\n      } else if (nextX + entity.width > worldW) { \n        nextX = worldW - entity.width; \n        entity.vx = -Math.abs(entity.vx); // Move Left\n      }\n      \n      if (nextY < 0) { \n        nextY = 0; \n        entity.vy = Math.abs(entity.vy); // Move Down\n      } else if (nextY + entity.height > worldH) { \n        nextY = worldH - entity.height; \n        entity.vy = -Math.abs(entity.vy); // Move Up\n      }\n      \n      entity.x = nextX;\n      entity.y = nextY;\n\n      // Spltja \"prveana\"\n      const player = gameState.current;\n      const onPlatform = (\n        player.x + player.width > entity.x &&\n        player.x < entity.x + entity.width &&\n        Math.abs((player.y + player.height) - entity.y) < 5 &&\n        player.vy >= 0\n      );\n\n      if (onPlatform) {\n        player.x += entity.vx * (deltaMs / 16.6);\n        player.y = entity.y - player.height;\n        player.vy = 0;\n        player.isGrounded = true;\n        \n        // Atjauninam animciju, lai nebtu \"fall\" uz platformas\n        if (Math.abs(player.vx) > 0.1) {\n          player.animation = 'run';\n        } else {\n          player.animation = 'idle';\n        }\n      }\n\n      continue;\n    }\n\n    const ai = def.ai || {};\n    const reactionDist = (ai.reactionDistance || 10) * TILE_SIZE;\n    const shootDist = (ai.shootDistance || 8) * TILE_SIZE;\n    const speed = def.speed || 1.2;\n\n    const dx = playerX - entity.x;\n    const dy = playerY - entity.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let keys = { a: false, d: false, w: false };\n\n    // 2. AI Uzvedba\n    if (dist < reactionDist) {\n      // Sekojam spltjam\n      if (dx > TILE_SIZE * 0.5) {\n          keys.d = true;\n          entity.direction = 1;\n      } else if (dx < -TILE_SIZE * 0.5) {\n          keys.a = true;\n          entity.direction = -1;\n      }\n\n      // Lkana, ja AI to atbalsta un priek ir rslis\n      if (ai.canJump && entity.isGrounded) {\n          const nextX = entity.x + entity.direction * 10;\n          if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n              keys.w = true;\n          }\n      }\n\n      // auana\n      if (dist < shootDist) {\n        if (entity.shootCooldown <= 0) {\n           const facingPlayer = (dx > 0 && entity.direction > 0) || (dx < 0 && entity.direction < 0);\n           // Tanks auj, ja skats uz spltju vai ja tas ir pietiekami tuvu\n           if (facingPlayer || dist < TILE_SIZE * 2) {\n             entity.isShooting = true;\n             entity.shootCooldown = ai.shootCooldown || 2000;\n             \n             // Izsaucam via izveidi\n             if (typeof spawnProjectile === 'function') {\n                // Novietojam viu rpus tanka korpusa (atkarb no virziena)\n                const spawnX = entity.x + (entity.width / 2) + (entity.direction * (entity.width / 2 + 10));\n                const spawnY = entity.y + (entity.height * 0.4); // Nedaudz augstk par centru (stobrs)\n                \n                spawnProjectile(\n                  spawnX, \n                  spawnY, \n                  entity.direction,\n                  entity.id\n                );\n             }\n           }\n        }\n      }\n    } else if (ai.patrol) {\n      // Patruanas rems\n      if (entity.direction > 0) keys.d = true;\n      else keys.a = true;\n\n    // Sienas un ru prbaude, lai grieztos atpaka\n    const nextX = entity.x + entity.direction * 10;\n    let hitSomething = checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height);\n\n    // Tanku specifisk kolzija (ar spltju un citiem tankiem)\n    if (!hitSomething && entity.subtype === 'tank') {\n      // 1. Prbaude ar spltju\n      const p = gameState.current;\n      if (nextX < p.x + p.width && nextX + entity.width > p.x && entity.y < p.y + p.height && entity.y + entity.height > p.y) {\n        hitSomething = true;\n      }\n\n      // 2. Prbaude ar citiem tankiem\n      if (!hitSomething) {\n        for (const other of entitiesRef.current) {\n          if (other === entity || other.health <= 0 || other.isExploding) continue;\n          if (other.subtype !== 'tank') continue;\n\n          if (nextX < other.x + other.width && nextX + entity.width > other.x && entity.y < other.y + other.height && entity.y + entity.height > other.y) {\n            hitSomething = true;\n            // Liekam ar otram tankam maint virzienu, ja tie brauc viens otram virs\n            if ((entity.direction > 0 && other.direction < 0) || (entity.direction < 0 && other.direction > 0)) {\n               other.direction *= -1;\n            }\n            break;\n          }\n        }\n      }\n    }\n\n    if (hitSomething) {\n      entity.direction *= -1;\n    }\n    \n    // Platformas malas prbaude\n      if (ai.stayOnPlatform && entity.isGrounded) {\n          const groundX = entity.x + (entity.direction > 0 ? entity.width : 0) + entity.direction * 5;\n          const groundY = entity.y + entity.height + 5;\n          if (!checkCollision(groundX, groundY, mapWidth, mapHeight, 2, 2)) {\n              entity.direction *= -1;\n          }\n      }\n    }\n\n    // Cooldown atjaunoana\n    if (entity.shootCooldown > 0) {\n      entity.shootCooldown -= deltaMs;\n      // Pc 300ms prtraucam auanas animciju\n      if (entity.shootCooldown < (ai.shootCooldown || 2000) - 300) {\n        entity.isShooting = false;\n      }\n    }\n\n    // 3. Fizika un kustba\n    const frameSpeed = speed * (deltaMs / 16.67);\n    \n    const checkEntityCollision = (nx, ny) => {\n        // Statisk pasaule\n        if (checkCollision(nx, ny, mapWidth, mapHeight, entity.width, entity.height)) return true;\n        \n        // Tankiem blojam ceu, ja priek ir spltjs vai cits tanks\n        if (entity.subtype === 'tank') {\n            const p = gameState.current;\n            if (nx < p.x + p.width && nx + entity.width > p.x && ny < p.y + p.height && ny + entity.height > p.y) return true;\n            \n            for (const other of entitiesRef.current) {\n                if (other === entity || other.health <= 0 || other.isExploding) continue;\n                if (other.subtype !== 'tank') continue;\n                if (nx < other.x + other.width && nx + entity.width > other.x && ny < other.y + other.height && ny + entity.height > other.y) return true;\n            }\n        }\n        return false;\n    };\n\n    const mh = moveHorizontal({\n      keys,\n      state: { \n        x: entity.x, \n        y: entity.y, \n        vx: entity.vx || 0,\n        width: entity.width, \n        direction: entity.direction \n      },\n      MOVE_SPEED: frameSpeed,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision\n    });\n    entity.x = mh.x;\n    entity.vx = mh.vx;\n    entity.direction = mh.direction;\n\n    const vp = applyVerticalPhysics({\n      keys,\n      x: entity.x,\n      y: entity.y,\n      vy: entity.vy,\n      isGrounded: entity.isGrounded,\n      animation: entity.animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE: ai.canJump ? 8 : 0,\n      TILE_SIZE,\n      width: entity.width,\n      height: entity.height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision,\n      isLiquidAt: ctx.isLiquidAt,\n      vx: entity.vx\n    });\n    entity.y = vp.y;\n    entity.vy = vp.vy;\n    entity.isGrounded = vp.isGrounded;\n\n    // 4. Animcijas stvoka noteikana\n    if (entity.isShooting) {\n      entity.animation = 'shoot';\n    } else if (entity.health <= (def.maxHealth || 100) * 0.5) {\n      entity.animation = 'move_damaged';\n    } else if (entity.vx === 0 && entity.isGrounded) {\n      entity.animation = 'idle';\n    } else {\n      entity.animation = 'move';\n    }\n\n    // Atjaunojam animcijas rmi, ja tas nav sprdziens\n    if (!entity.isExploding) {\n        const anims = def.spriteSheet?.animations || {};\n        let currentAnim = anims[entity.animation];\n        \n        // Rezerves varianti, ja specifisk animcija nav atrasta\n        if (!currentAnim || !Array.isArray(currentAnim) || currentAnim.length === 0) {\n            currentAnim = anims['move'] || anims['idle'] || [0];\n        }\n        \n        entity.animTimer = (entity.animTimer || 0) + deltaMs;\n        const frameDur = 100; // ms\n        if (entity.animTimer >= frameDur) {\n            entity.animTimer = 0;\n            entity.animFrame = (entity.animFrame || 0) + 1;\n            if (entity.animFrame >= currentAnim.length) {\n                entity.animFrame = 0;\n            }\n        }\n        entity.currentSpriteIndex = currentAnim[entity.animFrame % currentAnim.length];\n    } else {\n        const explodeAnim = def.spriteSheet?.animations?.explode || [39];\n        // Sprdziena animcija tiek vadta augstk (death sekcij)\n        entity.currentSpriteIndex = explodeAnim[Math.min(entity.animFrame, explodeAnim.length - 1)];\n    }\n\n    if (entity.shouldRemove) {\n      entities.splice(i, 1);\n    }\n  }\n}\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { resolveInteractableContext } from '../gameplay/interactables/context';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\nimport { updateEntities } from '../gameplay/entities';\nimport { getWeatherDps, getMapWeather, getRadioactivityRates, weatherAffectsPlayer, weatherBlockedByCover } from '../gameplay/weatherDamage';\nimport { isCoveredFromAbove } from '../gameplay/weatherCover';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isLiquidAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions,\n    registryItems\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isLiquidAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, playSfx, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const mapWidth = mapData.meta?.width || mapData.width || 20;\n  const mapHeight = mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo,\n    iceResist,\n    maxIceResist\n  } = gameState.current;\n\n  const dt = Math.max(0, deltaMs || 0);\n  const physicsDt = Math.min(dt, 100);\n\n  // 0.5) Resources update (before physics to affect them)\n  // Ice resistance depletion: drains while on slippery surface; regenerates otherwise\n  const layers = ctx.mapData.layers || [];\n  const backgroundLayer = layers.find(l => l.name === 'background')?.data || [];\n  const secretLayer = layers.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n  const objectMetadata = mapData.meta?.objectMetadata || {};\n  const surface = helpers.getSurfaceProperties ? helpers.getSurfaceProperties(x, y, width, height, mapWidth, mapHeight, TILE_SIZE, backgroundLayer, ctx.registryItems) : { friction: 0.8, acceleration: 0.2 };\n  \n  const isSlippery = surface.friction >= 0.9;\n  let currentIceRes = Number(iceResist);\n  const maxIce = Math.max(1, Number(maxIceResist || 100));\n  if (!Number.isFinite(currentIceRes)) currentIceRes = maxIce;\n\n  if (isSlippery) {\n    currentIceRes -= (20 * dt) / 1000;\n  } else {\n    currentIceRes += (35 * dt) / 1000;\n  }\n  currentIceRes = Math.max(0, Math.min(maxIce, currentIceRes));\n  gameState.current.iceResist = currentIceRes;\n\n  let effectiveFriction = surface.friction;\n  if (isSlippery && currentIceRes > 0) {\n      const ratio = currentIceRes / maxIce;\n      const targetFriction = 0.8;\n      effectiveFriction = surface.friction - (surface.friction - targetFriction) * ratio;\n  }\n\n  // 1) Horizontal movement\n  const checkCollisionExtended = (nx, ny, mw, mh, w, h) => {\n    return checkCollision(nx, ny, mw, mh, w, h);\n  };\n\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, vx, width, direction, height },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    friction: effectiveFriction,\n    acceleration: isSlippery ? (currentIceRes > 0 ? 0.15 : surface.acceleration) : surface.acceleration,\n    deltaMs: physicsDt\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 1.1) Pushable objects logic (Stone pushing)\n  let isPushing = false;\n  let pushTarget = null;\n  \n  const currentStrength = gameState.current.strength || 30;\n  const isAlreadyAtMax = currentStrength >= 99;\n  const lastPushTime = gameState.current.lastPushTime || 0;\n  const gracePeriod = 300; // ms, kur strength nesamazins pat ja kontakts pazd uz brdi\n\n  if (entitiesRef.current) {\n    // Ja jau stumjam ar pilnu jaudu, esam pielaidgki pret attlumu (histerze), \n    // lai kompenstu nelielas fizikas dzinja nobdes.\n    const pushDist = isAlreadyAtMax ? 15 : 5;\n    const overlapDist = isAlreadyAtMax ? 12 : 5;\n\n    for (const ent of entitiesRef.current) {\n      if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n        // Prbaudm vai spltjs ir blakus akmenim\n        const isNextToLeft = (x + width + pushDist > ent.x) && (x + width <= ent.x + overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n        const isNextToRight = (x - pushDist < ent.x + ent.width) && (x >= ent.x + ent.width - overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n\n        if ((isNextToLeft && keys.d) || (isNextToRight && keys.a)) {\n          isPushing = true;\n          pushTarget = ent;\n          break;\n        }\n      }\n    }\n  }\n\n  if (isPushing) {\n    gameState.current.strength = Math.min(100, currentStrength + (65 * dt) / 1000); // Aug par ~65% sekund\n    if (gameState.current.strength >= 100 && pushTarget) {\n      // Pastumjam akmeni\n      const pushForce = 2.0;\n      pushTarget.vx = (x < pushTarget.x ? 1 : -1) * pushForce;\n      gameState.current.lastPushTime = timestamp; \n      \n      // Atskaojam skau\n      if (pushTarget.def?.sounds?.push && (!pushTarget.lastPushSoundTime || timestamp - pushTarget.lastPushSoundTime > 450)) {\n        playSfx(pushTarget.def.sounds.push, 0.3);\n        pushTarget.lastPushSoundTime = timestamp;\n      }\n    }\n  } else {\n    // Prbaudm grace periodu pirms skam samazint spku\n    const timeSincePush = timestamp - lastPushTime;\n    if (timeSincePush > gracePeriod) {\n      if (currentStrength > 30) {\n        gameState.current.strength = Math.max(30, currentStrength - (35 * dt) / 1000);\n      } else {\n        gameState.current.strength = 30;\n      }\n    }\n  }\n\n  // 1.9) Ladder check (allow climbing when overlapping ladder objects)\n  const getDefById = (id) => {\n    if (!id) return null;\n    const map = registryItems && registryItems.__byId;\n    if (map && typeof map.get === 'function') return map.get(id) || null;\n    return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n  };\n\n  const findLadderAtPlayer = () => {\n    if (!objectData || !registryItems) return null;\n    const centerX = x + width / 2;\n    const centerY = y + height / 2;\n    const ctxResolved = resolveInteractableContext({\n      mapData,\n      mapWidth,\n      mapHeight,\n      objectLayerData: objectData,\n      mainObjectMetadata: objectMetadata,\n      secretMapData: secretLayer,\n      activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n      centerX,\n      centerY,\n      TILE_SIZE\n    });\n    const { activeObjectData, activeMetadata, activeMapWidth, activeMapHeight, offsetX, offsetY } = ctxResolved;\n    if (!activeObjectData) return null;\n    const localX = centerX - offsetX;\n    const localY = centerY - offsetY;\n    const gridX = Math.floor(localX / TILE_SIZE);\n    const gridY = Math.floor(localY / TILE_SIZE);\n    if (gridX < 0 || gridY < 0 || gridX >= activeMapWidth || gridY >= activeMapHeight) return null;\n    let idx = gridY * activeMapWidth + gridX;\n    let objId = activeObjectData[idx];\n    if (!objId && activeMetadata) {\n      for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n        const baseIdx = parseInt(idxStr, 10);\n        const w = meta.width || 1;\n        const h = meta.height || 1;\n        if (w <= 1 && h <= 1) continue;\n        const ox = baseIdx % activeMapWidth;\n        const oy = Math.floor(baseIdx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          objId = activeObjectData[baseIdx];\n          idx = baseIdx;\n          break;\n        }\n      }\n    }\n    if (!objId) return null;\n    const def = getDefById(objId);\n    if (!def) return null;\n    const isLadder = !!(def.flags?.ladder || def.subtype === 'ladder' || def.type === 'ladder');\n    if (!isLadder) return null;\n    return { def, index: idx };\n  };\n\n  const ladderInfo = findLadderAtPlayer();\n\n  // 2) Vertical physics\n  let vp = null;\n  let remaining = physicsDt;\n  let steps = 0;\n  const prevInWaterFrame = !!gameState.current.inWater;\n  let prevInWater = prevInWaterFrame;\n  if (ladderInfo && !keys?.space) {\n    const ladderSpeed = Math.max(40, Number(ladderInfo.def?.ladder?.speed) || 120);\n    const climbDir = (keys.w ? -1 : 0) + (keys.s ? 1 : 0);\n    if (climbDir !== 0) {\n      const proposedY = y + (climbDir * ladderSpeed) * (physicsDt / 1000);\n      if (!checkCollisionExtended(x, proposedY, mapWidth, mapHeight, width, height)) {\n        y = proposedY;\n      }\n      animation = 'climb';\n    }\n    vy = 0;\n    isGrounded = false;\n    vp = { y, vy, isGrounded, animation, inWater: false, headUnderWater: false, atSurface: false };\n  } else {\n    while (remaining > 0 && steps < 10) {\n      const stepMs = Math.min(16.67, remaining);\n      vp = applyVerticalPhysics({\n        keys,\n        x,\n        y,\n        vy,\n        isGrounded,\n        animation,\n        GRAVITY,\n        TERMINAL_VELOCITY,\n        JUMP_FORCE,\n        TILE_SIZE,\n        width,\n        height,\n        mapWidth,\n        mapHeight,\n        checkCollision: checkCollisionExtended,\n        vx,\n        isLiquidAt: (wx, wy) => {\n          try { return typeof isLiquidAt === 'function' ? isLiquidAt(wx, wy) : null; } catch { return null; }\n        },\n        prevInWater,\n        deltaMs: stepMs\n      });\n      y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n      prevInWater = !!vp.inWater;\n      remaining -= stepMs;\n      steps++;\n    }\n  }\n  const inWater = !!(vp ? vp.inWater : gameState.current.inWater);\n  const headUnderWater = !!(vp ? vp.headUnderWater : gameState.current.headUnderWater);\n  const atSurface = !!(vp ? vp.atSurface : gameState.current.atSurface);\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else if (liquidType === 'quicksand') {\n      vx *= 0.72; // Quicksand is very thick\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n    const resourceParams = liquidParams?.resources || {};\n    const parseNumber = (v) => (v === null || v === undefined || v === '') ? null : Number(v);\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = resourceParams.oxygen || liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = resourceParams.lavaResist || liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n    const iceParams = resourceParams.iceResist;\n    const strengthParams = resourceParams.strength;\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    const oxygenApplies = !!(resourceParams.oxygen || liquidType === 'water' || liquidType === 'quicksand' || liquidType === 'radioactive_water' || liquidType === 'waterfall' || liquidType === 'radioactive_waterfall');\n    const oxygenEnabled = oxyParams?.enabled !== false;\n    const oxyDrain = parseNumber(oxyParams?.drainPerSecond);\n    const oxyRegen = parseNumber(oxyParams?.regenPerSecond);\n    if (oxygenEnabled && headUnderWater && oxygenApplies && Number.isFinite(oxyDrain)) {\n      oxy -= (Math.max(0, oxyDrain) * dt) / 1000;\n    } else if (oxygenEnabled) {\n      oxy += (Math.max(0, Number.isFinite(oxyRegen) ? oxyRegen : 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resist depletion while in lava; regenerates outside\n    const lavaApplies = !!(resourceParams.lavaResist || liquidType === 'lava' || liquidType === 'lava_waterfall');\n    const lavaEnabled = lavaParams?.enabled !== false;\n    const lavaDrain = parseNumber(lavaParams?.drainPerSecond);\n    const lavaRegen = parseNumber(lavaParams?.regenPerSecond);\n    if (lavaEnabled && lavaApplies && liquidType && liquidType.includes('lava') && Number.isFinite(lavaDrain)) {\n      lavaRes -= (Math.max(0, lavaDrain) * dt) / 1000;\n    } else if (lavaEnabled) {\n      lavaRes += (Math.max(0, Number.isFinite(lavaRegen) ? lavaRegen : 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Ice resist & strength can be optionally affected by liquids\n    const applyResource = (key, maxKey, params) => {\n      if (!params || params.enabled === false) return;\n      const drain = parseNumber(params.drainPerSecond);\n      const regen = parseNumber(params.regenPerSecond);\n      if (!Number.isFinite(drain) && !Number.isFinite(regen)) return;\n      const maxVal = Math.max(1, Number(gameState.current[maxKey] || 100));\n      let cur = Number(gameState.current[key]);\n      if (!Number.isFinite(cur)) cur = maxVal;\n      if (inWater || liquidType) {\n        if (Number.isFinite(drain)) cur -= (Math.max(0, drain) * dt) / 1000;\n      } else if (Number.isFinite(regen)) {\n        cur += (Math.max(0, regen) * dt) / 1000;\n      }\n      cur = Math.max(0, Math.min(maxVal, cur));\n      gameState.current[key] = cur;\n      gameState.current[maxKey] = maxVal;\n    };\n\n    applyResource('iceResist', 'maxIceResist', iceParams);\n    applyResource('strength', 'maxStrength', strengthParams);\n\n    // Radioactivity: fills up in radioactive liquid; slowly returns to 20% outside\n    const weatherNow = getMapWeather(mapData);\n    const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n    const fogActive = weatherAffectsPlayer('radioactiveFog') && radioFogInt > 0;\n    const maxRadio = Math.max(1, Number(gameState.current.maxRadioactivity || 100));\n    let radio = Number(gameState.current.radioactivity);\n    if (!Number.isFinite(radio)) radio = maxRadio * 0.2;\n\n    const radioParams = resourceParams.radioactivity;\n    const radioEnabled = radioParams?.enabled !== false;\n    const radioBaseline = Number.isFinite(parseNumber(radioParams?.baselinePercent)) ? Math.max(0, Math.min(1, parseNumber(radioParams?.baselinePercent))) : 0.2;\n    const radioGain = Number.isFinite(parseNumber(radioParams?.gainPerSecond)) ? Math.max(0, parseNumber(radioParams?.gainPerSecond)) : (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall' ? 15 : 0);\n    const radioDecay = Number.isFinite(parseNumber(radioParams?.decayPerSecond)) ? Math.max(0, parseNumber(radioParams?.decayPerSecond)) : 5;\n    const radioRecover = Number.isFinite(parseNumber(radioParams?.recoverPerSecond)) ? Math.max(0, parseNumber(radioParams?.recoverPerSecond)) : 2;\n    const radioApplies = !!(radioParams || liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall');\n\n    if (radioEnabled && radioApplies && (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall')) {\n      radio += (radioGain * dt) / 1000; \n    } else if (radioEnabled && !fogActive) {\n      const baseline = maxRadio * radioBaseline;\n      if (radio > baseline) {\n        radio -= (radioDecay * dt) / 1000;\n      } else if (radio < baseline) {\n        radio += (radioRecover * dt) / 1000;\n      }\n    }\n\n    // Radioactivity resource changes from fog (deplete while fog is active)\n    if (weatherAffectsPlayer('radioactiveFog')) {\n      const rates = getRadioactivityRates();\n      if (radioFogInt > 0 && rates.increase > 0) {\n        const dec = (radioFogInt / 100) * rates.increase * (dt / 1000);\n        radio -= dec;\n      } else if (radioFogInt <= 0 && rates.decay > 0 && !fogActive) {\n        const inc = rates.decay * (dt / 1000);\n        radio += inc;\n      }\n    }\n\n    radio = Math.max(0, Math.min(maxRadio, radio));\n    gameState.current.radioactivity = radio;\n    gameState.current.maxRadioactivity = maxRadio;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && oxygenApplies) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if ((liquidType === 'lava' || liquidType === 'lava_waterfall') && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n\n    // Weather damage (Lava Rain, Radioactive Fog)\n    const weather = weatherNow || getMapWeather(mapData);\n    const lavaRainInt = Number(weather.lavaRain || 0);\n\n    let lavaDps = weatherAffectsPlayer('lavaRain') ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    const radioDps = weatherAffectsPlayer('radioactiveFog') ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && (inWater || (liquidType && liquidType.includes('water')))) {\n      lavaDps = 0;\n    }\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = backgroundLayer;\n        const secretData = secretLayer;\n        const covered = isCoveredFromAbove({\n          x: x + width / 2,\n          y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems: ctx.registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const effectiveRadioDps = (radioDps > 0 && Number(radio) <= 0) ? radioDps : 0;\n    const totalWeatherDps = lavaDps + effectiveRadioDps;\n\n    if (totalWeatherDps > 0) {\n      weatherDamageAccRef.current += dt;\n      if (weatherDamageAccRef.current >= 1000) {\n        weatherDamageAccRef.current -= 1000;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - totalWeatherDps);\n        const HIT_FLASH_MS = 500;\n        gameState.current.hitTimerMs = Math.max(Number(gameState.current.hitTimerMs) || 0, HIT_FLASH_MS);\n        if (actions.onStateUpdate) {\n          actions.onStateUpdate('playerDamage', {\n            damage: totalWeatherDps,\n            x: x + width / 2,\n            y\n          });\n        }\n      }\n    } else {\n      weatherDamageAccRef.current = 0;\n    }\n\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  const healthEnabled = resourceParams?.health?.enabled !== false;\n  const healthDpsOverride = (healthEnabled && resourceParams?.health && resourceParams.health.damagePerSecond !== null && resourceParams.health.damagePerSecond !== undefined)\n    ? Number(resourceParams.health.damagePerSecond)\n    : null;\n  const effectiveDps = Number.isFinite(healthDpsOverride) ? Math.max(0, healthDpsOverride) : Number(liquidParams?.dps);\n  if (liquidType && liquidParams && Number(effectiveDps) > 0) {\n    try {\n      if (liquidType && liquidType.includes('lava')) {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection and triggers\n  // Sync moved state to Ref so triggers can see it and modify it (Teleport, Knockback, etc.)\n  gameState.current.x = x;\n  gameState.current.y = y;\n  gameState.current.vx = vx;\n  gameState.current.vy = vy;\n  gameState.current.isGrounded = isGrounded;\n  gameState.current.animation = animation;\n\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, mapHeight, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // Sync back from Ref in case triggers changed something\n  x = gameState.current.x;\n  y = gameState.current.y;\n  vx = gameState.current.vx;\n  vy = gameState.current.vy;\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0) {\n    const originX = x + (direction >= 0 ? width + 4 : -4);\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1, 'player');\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 5.5) Update entities (tanks etc.)\n  try {\n    updateEntities({\n      entitiesRef,\n      gameState,\n      mapData,\n      objectData,\n      mapWidth,\n      mapHeight,\n      TILE_SIZE,\n      checkCollision,\n      isLiquidAt,\n      getLiquidSample,\n      spawnProjectile,\n      playSfx,\n      constants,\n      registryItems: ctx.registryItems,\n      onStateUpdate: actions.onStateUpdate,\n      activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n    }, Math.min(dt, 100)); // Ierobeojam deltaMs uz 100ms, lai izvairtos no milzgiem lcieniem\n    \n    // Sinhronizjam loklos maingos pc enttiju (platformu) ietekmes\n    x = gameState.current.x;\n    y = gameState.current.y;\n    vx = gameState.current.vx;\n    vy = gameState.current.vy;\n    isGrounded = gameState.current.isGrounded;\n    animation = gameState.current.animation;\n\n    if (checkSecrets && entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n          try { checkSecrets(ent.x, ent.y, ent.width, ent.height, mapWidth, mapHeight); } catch {}\n        }\n      }\n    }\n    \n    // Kontaktbojjumi no enttijm\n    const player = gameState.current;\n    if (entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        \n        // AABB prbaude\n        const hit = (\n          player.x < ent.x + ent.width &&\n          player.x + player.width > ent.x &&\n          player.y < ent.y + ent.height &&\n          player.y + player.height > ent.y\n        );\n        \n        if (hit && Number(player.hitTimerMs) <= 0) {\n          // Pievienojam nelielu atgrdienu (knockback)\n          const knockbackDir = player.x + player.width / 2 < ent.x + ent.width / 2 ? -1 : 1;\n          gameState.current.vx = knockbackDir * 5;\n          gameState.current.vy = -3;\n          \n          // Iestatm bezsmertbas periodu un vizulo flash\n          gameState.current.hitTimerMs = 500;\n          \n          // Samazinm spltja veselbu\n          gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - 10);\n          \n          if (actions.onStateUpdate) {\n            actions.onStateUpdate('playerDamage', { damage: 10, x: player.x + player.width / 2, y: player.y });\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"Entity update failed:\", e);\n  }\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Win and Death check\n  if (gameState.current.isWinning) {\n    gameState.current.winCounter = (gameState.current.winCounter || 0) + (gameState.current.winCountSpeed || 10) * (deltaMs / 100);\n    if (gameState.current.winCounter >= 100) {\n      gameState.current.winCounter = 100;\n      // Trigger level win event if needed\n      if (actions.onStateUpdate) actions.onStateUpdate('levelWin');\n    }\n  }\n\n  if ((Number(gameState.current.health) || 0) <= 0 || y > mapHeight * TILE_SIZE + 300) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  if (!prevInWaterFrame && inWater) {\n    gameState.current.lastWaterEnter = {\n      x: x + width / 2,\n      y: y + height / 2,\n      time: Number(timestamp) || 0\n    };\n  }\n\n  if (actions.playSfx) {\n    const playerDef = getDefById('player');\n    if (playerDef?.sounds?.water_out && prevInWaterFrame && !inWater) {\n      try { actions.playSfx(playerDef.sounds.water_out, 0.35); } catch {}\n    } else if (playerDef?.sounds?.water_in && !prevInWaterFrame && inWater) {\n      try { actions.playSfx(playerDef.sounds.water_in, 0.35); } catch {}\n    }\n  }\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    timeMs: Number(timestamp) || 0,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null,\n    liquidOverlay: liquidParams?.overlay || null,\n    onIce: isSlippery\n  };\n\n  // Floating text deltas for player resources\n  if (actions.onStateUpdate) {\n    const floatState = gameState.current.floatingText || { prev: {}, acc: {} };\n    const resources = [\n      { key: 'health', color: '#ff3b3b' },\n      { key: 'oxygen', color: '#2ecdf1' },\n      { key: 'lavaResist', color: '#ffcc00' },\n      { key: 'iceResist', color: '#a5f3fc' },\n      { key: 'strength', color: '#8b5a2b' },\n      { key: 'radioactivity', color: '#32cd32' }\n    ];\n    const baseX = x + width / 2;\n    const baseY = y - 6;\n\n    resources.forEach((res, idx) => {\n      const cur = Number(gameState.current[res.key]) || 0;\n      if (!Number.isFinite(floatState.prev[res.key])) {\n        floatState.prev[res.key] = cur;\n        floatState.acc[res.key] = 0;\n        return;\n      }\n      const diff = cur - floatState.prev[res.key];\n      if (diff !== 0) {\n        floatState.acc[res.key] = (floatState.acc[res.key] || 0) + diff;\n        if (Math.abs(floatState.acc[res.key]) >= 1) {\n          const amt = Math.round(floatState.acc[res.key]);\n          floatState.acc[res.key] -= amt;\n          const sign = amt > 0 ? '+' : '';\n          actions.onStateUpdate('floatingText', {\n            x: baseX + (idx - 2.5) * 6,\n            y: baseY,\n            text: `${sign}${amt}`,\n            color: res.color,\n            amount: amt\n          });\n        }\n      }\n      floatState.prev[res.key] = cur;\n    });\n\n    gameState.current.floatingText = floatState;\n  }\n\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\nexport const MAX_ICE_RESIST = 100;\nexport const MAX_RADIOACTIVITY = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles, handleWeatherEffectHit } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal, getSurfaceProperties } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST,\n    MAX_ICE_RESIST,\n    MAX_RADIOACTIVITY\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret, objectMetadata\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret, objectMetadata, activeRoomIds, mapWidth, mapHeight) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        fishCount: 0,\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        iceResist: MAX_ICE_RESIST,\n        maxIceResist: MAX_ICE_RESIST,\n        radioactivity: MAX_RADIOACTIVITY * 0.2, // 20% default\n        maxRadioactivity: MAX_RADIOACTIVITY,\n        strength: 30,\n        maxStrength: 100,\n        lastPushTime: 0,\n        isWinning: false,\n        winCounter: 0,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n    const weatherDamageAccRef = useRef(0);                // Weather damage DPS accumulator\n    const entitiesRef = useRef([]);                        // Active moving entities (tanks, etc.)\n\n    // Refs for props to avoid stale closures in the game loop\n    const onStateUpdateRef = useRef(onStateUpdate);\n    const onRevealSecretRef = useRef(onRevealSecret);\n    const onGameOverRef = useRef(onGameOver);\n    const objectMetadataRef = useRef(objectMetadata);\n    const revealedSecretsRef = useRef(revealedSecrets);\n    const activeRoomIdsRef = useRef(activeRoomIds);\n    const mapWidthRef = useRef(mapWidth);\n    const mapHeightRef = useRef(mapHeight);\n    const tileDataRef = useRef(tileData);\n    const objectDataRef = useRef(objectData);\n    const secretDataRef = useRef(secretData);\n\n    useEffect(() => { onStateUpdateRef.current = onStateUpdate; }, [onStateUpdate]);\n    useEffect(() => { onRevealSecretRef.current = onRevealSecret; }, [onRevealSecret]);\n    useEffect(() => { onGameOverRef.current = onGameOver; }, [onGameOver]);\n    useEffect(() => { objectMetadataRef.current = objectMetadata; }, [objectMetadata]);\n    useEffect(() => { revealedSecretsRef.current = revealedSecrets; }, [revealedSecrets]);\n    useEffect(() => { activeRoomIdsRef.current = activeRoomIds; }, [activeRoomIds]);\n    useEffect(() => { mapWidthRef.current = mapWidth; }, [mapWidth]);\n    useEffect(() => { mapHeightRef.current = mapHeight; }, [mapHeight]);\n    useEffect(() => { tileDataRef.current = tileData; }, [tileData]);\n    useEffect(() => { objectDataRef.current = objectData; }, [objectData]);\n    useEffect(() => { secretDataRef.current = secretData; }, [secretData]);\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        const isInsideRoom = activeRoomIdsRef.current && activeRoomIdsRef.current.length > 0;\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume);\n    };\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Weather effects impact handling (meteors, etc.)\n    const handleWeatherEffectHitWrapper = (type, data) => {\n        handleWeatherEffectHit(type, data, {\n            gameState,\n            entitiesRef,\n            TILE_SIZE,\n            onBreakEffect: (detail) => {\n                window.dispatchEvent(new CustomEvent('game-break-effect', { detail }));\n            }\n        });\n    };\n\n    // Listen for weather effect hits from the UI/Renderer\n    useEffect(() => {\n        const onHit = (e) => {\n            if (e && e.detail) {\n                handleWeatherEffectHitWrapper(e.detail.type, e.detail.data);\n            }\n        };\n        window.addEventListener('weather-effect-hit', onHit);\n        return () => window.removeEventListener('weather-effect-hit', onHit);\n    }, []);\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecretRef.current) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecretsRef.current || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecretRef.current(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    const lastMapIdRef = useRef(null);\n\n    // Initialize player at starting position\n    useEffect(() => {\n        if (!mapData) {\n            isInitialized.current = false;\n            lastMapIdRef.current = null;\n            return;\n        }\n\n        // Unique identifier for the map session\n        // We include projectName and timestamps to distinguish between different projects \n        // that might use the same activeMapId (like \"main\")\n        const meta = mapData.meta || {};\n        const projectName = meta.projectName || '';\n        const mapId = meta.activeMapId || mapData.name || 'default';\n        const timestamp = meta.date_map_last_updated || meta.date_map_created_at || '';\n        \n        // Use a unique ID that changes on map load or restart\n        const currentMapId = `${projectName}|${mapId}|${timestamp}`;\n        const isNewMapLoad = currentMapId !== lastMapIdRef.current;\n\n        // Ja sple jau ir inicializta UN t ir t pati karte, nemainm spltja pozciju\n        // Tas novr \"reset\" uz skumu, kad spltjs pace itemu vai mains laikapstki\n        if (isInitialized.current && !isNewMapLoad) return;\n\n        lastMapIdRef.current = currentMapId;\n\n        // Reset state for new initialization\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        entitiesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapWidth || mapData.meta?.width || mapData.width || 20;\n            const mapH = mapHeight || mapData.meta?.height || mapData.height || 15;\n            \n            // Search for entities in objectData\n            const initialEntities = [];\n            if (objectData && Array.isArray(objectData)) {\n                objectData.forEach((id, idx) => {\n                    if (id && !id.includes('player')) {\n                        const def = findItemById(id) || registryItems.find(r => r.id === id);\n                        const isEntity = def && (\n                            def.type === 'entity' || \n                            def.subtype === 'tank' || \n                            def.subtype === 'platform' ||\n                            def.isPushable ||\n                            (def.name && def.name.toLowerCase().includes('entities.'))\n                        );\n\n                        if (isEntity) {\n                            initialEntities.push({\n                                id: `entity_${idx}_${Date.now()}_${idx}`,\n                                defId: id,\n                                def: def,\n                                x: (idx % mapW) * TILE_SIZE,\n                                y: Math.floor(idx / mapW) * TILE_SIZE,\n                                width: (Number(def.width) || 1) * TILE_SIZE,\n                                height: (Number(def.height) || 1) * TILE_SIZE,\n                                vx: 0,\n                                vy: 0,\n                                health: def.maxHealth || 100,\n                                direction: def.subtype === 'platform' ? 1 : (def.isPushable ? 1 : -1),\n                                animation: (def.subtype === 'platform' || def.isPushable) ? 'idle' : 'move',\n                                animFrame: 0,\n                                animTimer: 0,\n                                isGrounded: false,\n                                shootCooldown: 0,\n                                currentSpriteIndex: 0,\n                                subtype: def.subtype || (def.isPushable ? 'pushable' : null),\n                                rotation: def.isRound ? 0 : undefined\n                            });\n                        }\n                    }\n                });\n            }\n            entitiesRef.current = initialEntities;\n\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // 1. Priority: spawnTriggerId hint (from inter-map teleport)\n                const spawnTriggerId = mapData.meta?.spawnTriggerId;\n                let startIndex = -1;\n\n                if (spawnTriggerId !== undefined && spawnTriggerId !== null) {\n                    startIndex = objLayer.data.findIndex((id, idx) => {\n                        if (!id || (!id.includes('target') && id !== 'portal_target')) return false;\n                        const meta = objectMetadataRef.current?.[idx] || mapData.meta?.objectMetadata?.[idx];\n                        return meta && meta.triggerId === spawnTriggerId;\n                    });\n                }\n\n                // 2. Fallback: Search for player (anything containing 'player')\n                if (startIndex === -1) {\n                    startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n                }\n\n                if (startIndex !== -1) {\n                    let startX = (startIndex % mapW) * TILE_SIZE;\n                    let startY = Math.floor(startIndex / mapW) * TILE_SIZE;\n\n                    // Get data from registry\n                    const playerId = objLayer.data[startIndex];\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    const prevAmmo = Math.max(0, Number(gameState.current?.ammo) || 0);\n                    const prevFishCount = Math.max(0, Number(gameState.current?.fishCount) || 0);\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: prevAmmo,\n                        fishCount: prevFishCount,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: Number(registryPlayer?.strength) || 30,\n                        maxStrength: Number(registryPlayer?.maxStrength) || 100,\n                        lastPushTime: 0,\n                        isWinning: false,\n                        winCounter: 0\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    const pW = gameState.current.width || TILE_SIZE;\n                    const pH = gameState.current.height || TILE_SIZE;\n                    while (checkCollision(gameState.current.x, gameState.current.y, undefined, undefined, pW, pH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: 30,\n                        maxStrength: 100,\n                        lastPushTime: 0\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST,\n                    radioactivity: MAX_RADIOACTIVITY * 0.2,\n                    maxRadioactivity: MAX_RADIOACTIVITY,\n                    strength: 30,\n                    maxStrength: 100,\n                    lastPushTime: 0\n                };\n                setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]); // objectData removed - item collection shouldn't trigger re-initialization\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mw, mh, w, h, ignoreEntityId) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE,\n            tileDataRef.current || tileData,\n            registryItems,\n            w !== undefined ? w : gameState.current.width,\n            h !== undefined ? h : gameState.current.height,\n            secretDataRef.current || secretData,\n            objectDataRef.current || objectData,\n            objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreEntityId || null,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mw, mh, TILE_SIZE_OVERRIDE, tileDataOverride, registryItemsOverride, secretDataOverride, objectDataOverride, objectMetadataOverride, ignoreId) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE_OVERRIDE || TILE_SIZE,\n            tileDataOverride || tileDataRef.current || tileData,\n            registryItemsOverride || registryItems,\n            secretDataOverride || secretDataRef.current || secretData,\n            objectDataOverride || objectDataRef.current || objectData,\n            objectMetadataOverride || objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreId,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // New: liquid type check at a world pixel\n    const getLiquidTypeAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        const liq = getLiquidAtPixel(wx, wy, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileData, registryItems);\n        return liq ? liq.type : null;\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthRef.current || 20,\n            mapHeight: mapHeightRef.current || 15,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction, ownerId = 'player') => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction, ownerId);\n    };\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData: objectDataRef.current,\n            input,\n            refs: { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef },\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            registryItems,\n            helpers: {\n                checkCollision,\n                getSurfaceProperties: (x, y, w, h) => getSurfaceProperties(x, y, w, h, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileDataRef.current, registryItems, secretDataRef.current, objectMetadataRef.current || mapData?.meta?.objectMetadata, mapData?.maps, activeRoomIdsRef.current || mapData?.meta?.activeRoomIds),\n                isLiquidAt: (wx, wy) => getLiquidTypeAtPixel(wx, wy),\n                getLiquidSample: ({ x, y, width, height }) =>\n                    sampleLiquid({ x, y, width, height })\n            },\n            actions: {\n                collectItem: (x, y, mw, objectLayer) =>\n                collectItem({\n                    registryItems,\n                    TILE_SIZE,\n                    MAX_HEALTH,\n                    playShotSfx,\n                    onStateUpdate: onStateUpdateRef.current,\n                    gameState,\n                    maps: mapData?.maps,\n                    activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n                    objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata,\n                    secretMapData: secretDataRef.current || secretData,\n                    activeMapId: mapData?.meta?.activeMapId || mapData?.meta?.activeMap || 'main'\n                }, x, y, mapWidthRef.current || 20, objectDataRef.current),\n                checkInteractables: (x, y, mw, mh, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState, mapData, input, activeRoomIds: activeRoomIdsRef.current, objectMetadata: objectMetadataRef.current, secretMapData: secretDataRef.current || secretData }, x, y, mapWidthRef.current || 20, mapHeightRef.current || 15, objectDataRef.current),\n                checkHazardDamage: (x, y, mw, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidthRef.current || 20, objectDataRef.current, deltaMs),\n                checkSecrets: (x, y, width, height, mw, mh) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                spawnProjectile: (originX, originY, direction, ownerId) =>\n                    spawnProjectile(originX, originY, direction, ownerId),\n                playSfx: (url, volume) => playShotSfx(url, volume),\n                updateProjectiles: (deltaMs, mw, mh) =>\n                    updateProjectiles({ \n                        projectilesRef, \n                        entitiesRef,\n                        playerState: gameState.current,\n                        TILE_SIZE, \n                        isSolidAtPixel, \n                        findItemById, \n                        objectData: objectDataRef.current, \n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata, \n                        tileData: tileDataRef.current || tileData,\n                        secretData: secretDataRef.current || secretData,\n                        registryItems,\n                        onStateUpdate: onStateUpdateRef.current,\n                        playSfx: playShotSfx\n                    }, deltaMs, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                setPlayer: (next) => setPlayer(next),\n                onGameOver: onGameOverRef.current\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        if (!mapData) return;\n        requestRef.current = requestAnimationFrame(update);\n        return () => {\n            if (requestRef.current) cancelAnimationFrame(requestRef.current);\n        };\n    }, [mapData]); // Restart loop ONLY if map changes, not objects\n\n    return player;\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false,\n        e: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n            keys.current.e = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'KeyE':\n                    keys.current.e = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'KeyE':\n                    keys.current.e = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","import { getMeteorBreakEffectConfig } from './meteorBreakEffects';\nimport { getBiologicalBreakEffectConfig } from './biologicalBreakEffects';\n\n/**\n * Handles weather effect impacts like meteor strikes, lightning, etc.\n * This logic is decoupled from useGameEngine to allow for easier expansion.\n */\nexport const handleWeatherEffectHit = (type, data, context) => {\n    if (!type || !data || !context) return;\n    const { gameState, entitiesRef, onBreakEffect } = context;\n\n    if (type === 'meteor') {\n        const { x, y, size, isLarge, surfaceType } = data;\n        const damage = isLarge ? 40 : 20;\n        const radius = size * 1.5;\n\n        // 1. Check player impact\n        if (gameState && gameState.current) {\n            const p = gameState.current;\n            const dx = (p.x + p.width / 2) - x;\n            const dy = (p.y + p.height / 2) - y;\n            const dist = Math.sqrt(dx * dx + dy * dy);\n\n            if (dist < radius + p.width / 2) {\n                gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - damage);\n                gameState.current.hitTimerMs = 500;\n                // Add knockback\n                if (dist > 0) {\n                    gameState.current.vx += (dx / dist) * 10;\n                    gameState.current.vy -= 5;\n                } else {\n                    gameState.current.vy -= 10; // direct hit\n                }\n            }\n        }\n\n        // 2. Check entities impact\n        if (entitiesRef && entitiesRef.current) {\n            entitiesRef.current.forEach(ent => {\n                const isFish = ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish;\n                const edx = (ent.x + ent.width / 2) - x;\n                const edy = (ent.y + ent.height / 2) - y;\n                const edist = Math.sqrt(edx * edx + edy * edy);\n\n                const prevHealth = Number(ent.health) || 0;\n                const inDamageRadius = edist < radius + ent.width / 2;\n                if (inDamageRadius) {\n                    ent.health = Math.max(0, prevHealth - damage);\n                    // Platforms don't take knockback, but others might\n                    if (ent.subtype !== 'platform') {\n                        if (edist > 0) {\n                            ent.vx += (edx / edist) * 8;\n                            ent.vy -= 3;\n                        } else {\n                            ent.vy -= 6;\n                        }\n                    }\n                }\n\n                if (isFish) {\n                    const cfg = ent.def?.fish || {};\n                    const shockRadius = (Number(cfg.meteorShockRadius) || 0) * (context?.TILE_SIZE || 32);\n                    if (shockRadius > 0 && edist <= shockRadius) {\n                        ent.fishState = ent.fishState || {};\n                        ent.fishState.shockUntil = (Number(gameState?.current?.timeMs) || 0) + (Number(cfg.meteorShockDurationMs) || 1800);\n                    }\n                    const wasDead = prevHealth <= 0;\n                    if (wasDead && ent.health <= 0 && inDamageRadius) {\n                        const now = Number(gameState?.current?.timeMs) || 0;\n                        ent.fishState = ent.fishState || {};\n                        const lastFx = Number(ent.fishState.lastBioFxAt) || 0;\n                        const alreadyQueued = !!ent.fishState.removeOnNext;\n                        if (!alreadyQueued && now - lastFx > 200) {\n                            const bioConfig = getBiologicalBreakEffectConfig();\n                            if (bioConfig && typeof onBreakEffect === 'function') {\n                                onBreakEffect({ x: ent.x + ent.width / 2, y: ent.y + ent.height / 2, config: bioConfig });\n                            }\n                            ent.fishState.lastBioFxAt = now;\n                            ent.fishState.removeOnNext = true;\n                        }\n                    }\n                }\n            });\n        }\n\n        const breakConfig = getMeteorBreakEffectConfig({ size, surfaceType });\n        if (breakConfig && typeof onBreakEffect === 'function') {\n            onBreakEffect({ x, y, config: breakConfig });\n        }\n    }\n\n    // Future weather types can be added here\n    // e.g., if (type === 'lightning') { ... }\n};\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction, ownerId = 'player') {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    ownerId, // Tagad ms zinm, kur izva\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag,\n    dmg: pDef?.damage || 10\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n  const nowMs = Number(playerState?.timeMs) || 0;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      // Updated isSolidAtPixel call with all necessary layers\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n    }\n    return false;\n  };\n\n  const checkObjectHit = (cx, cy, hw, hh) => {\n    if (!objectData) return null;\n    const pts = [\n        { x: cx - hw, y: cy - hh },\n        { x: cx + hw, y: cy - hh },\n        { x: cx - hw, y: cy + hh },\n        { x: cx + hw, y: cy + hh },\n        { x: cx, y: cy }\n    ];\n    for (const pt of pts) {\n        const gx = Math.floor(pt.x / TILE_SIZE);\n        const gy = Math.floor(pt.y / TILE_SIZE);\n        if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) continue;\n        const index = gy * mapWidth + gx;\n        const objId = objectData[index];\n        if (objId) {\n            const def = findItemById(objId);\n            if (def && def.isDestructible) {\n                // Check if already passable\n                const currentMeta = objectMetadata?.[index] || {};\n                const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                if (health > (def.passableHealthThreshold || 0)) {\n                    return index;\n                }\n            }\n        }\n    }\n    return null;\n  };\n\n  const checkEntityHit = (cx, cy, hw, hh, p) => {\n    if (!entitiesRef?.current) return null;\n    for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.id === p.ownerId) continue; // Ignorjam izvju\n\n        const ex = ent.x;\n        const ey = ent.y;\n        const ew = ent.width;\n        const eh = ent.height;\n        if (cx + hw > ex && cx - hw < ex + ew &&\n            cy + hh > ey && cy - hh < ey + eh) {\n            return ent;\n        }\n    }\n    return null;\n  };\n\n  const checkPlayerHit = (cx, cy, hw, hh, p) => {\n    if (!playerState || p.ownerId === 'player') return false; // Ignorjam, ja izva spltjs\n    \n    const ex = playerState.x;\n    const ey = playerState.y;\n    const ew = playerState.width || TILE_SIZE;\n    const eh = playerState.height || TILE_SIZE;\n    if (cx + hw > ex && cx - hw < ex + ew &&\n        cy + hh > ey && cy - hh < ey + eh) {\n        return true;\n    }\n    return false;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    let removed = false;\n\n    for (let s = 0; s < steps; s++) {\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n      \n      const hitPlayerX = checkPlayerHit(nextX, cy, hw, hh, p);\n      if (hitPlayerX) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntX = checkEntityHit(nextX, cy, hw, hh, p);\n      if (hitEntX) {\n        hitEntX.health -= p.dmg || 10;\n        const isFish = hitEntX.subtype === 'fish' || hitEntX.def?.subtype === 'fish' || hitEntX.def?.ai?.type === 'fish' || !!hitEntX.def?.fish;\n        if (isFish && hitEntX.health > 0) {\n          hitEntX.fishState = hitEntX.fishState || {};\n          const panicMs = Number(hitEntX.def?.fish?.panicDurationMs) || 1200;\n          hitEntX.fishState.panicUntil = Math.max(hitEntX.fishState.panicUntil || 0, nowMs + panicMs * 2);\n        }\n        if (isFish && playSfx) {\n          const hitSound = hitEntX.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\";\n          try { playSfx(hitSound, 0.4); } catch {}\n        }\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntX.x + hitEntX.width / 2,\n            y: hitEntX.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxX = checkObjectHit(nextX, cy, hw, hh);\n      if (hitIdxX !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxX, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      \n      const hitPlayerY = checkPlayerHit(cx, nextY, hw, hh, p);\n      if (hitPlayerY) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntY = checkEntityHit(cx, nextY, hw, hh, p);\n      if (hitEntY) {\n        hitEntY.health -= p.dmg || 10;\n        const isFish = hitEntY.subtype === 'fish' || hitEntY.def?.subtype === 'fish' || hitEntY.def?.ai?.type === 'fish' || !!hitEntY.def?.fish;\n        if (isFish && hitEntY.health > 0) {\n          hitEntY.fishState = hitEntY.fishState || {};\n          const panicMs = Number(hitEntY.def?.fish?.panicDurationMs) || 1200;\n          hitEntY.fishState.panicUntil = Math.max(hitEntY.fishState.panicUntil || 0, nowMs + panicMs * 2);\n        }\n        if (isFish && playSfx) {\n          const hitSound = hitEntY.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\";\n          try { playSfx(hitSound, 0.4); } catch {}\n        }\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntY.x + hitEntY.width / 2,\n            y: hitEntY.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxY = checkObjectHit(cx, nextY, hw, hh);\n      if (hitIdxY !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxY, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className, spriteSheet, frameIndex }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    // Ja ir spraitts, rdm tikai pirmo kadru (vai citu, ja nordts)\n    if (spriteSheet && spriteSheet.enabled) {\n        const columns = spriteSheet.columns || 1;\n        const total = spriteSheet.totalSprites || 1;\n        const rows = Math.ceil(total / columns);\n        \n        // Editor parasti rdm pirmo kadru (index 0) vai nordto kadru\n        const fallbackFrame = spriteSheet && Number.isFinite(Number(spriteSheet.frameIndex)) ? Number(spriteSheet.frameIndex) : 0;\n        const currentFrame = frameIndex !== undefined ? frameIndex : fallbackFrame;\n        const col = currentFrame % columns;\n        const row = Math.floor(currentFrame / columns);\n\n        return (\n            <div className={className} style={{\n                ...style,\n                overflow: 'hidden',\n                display: 'inline-block',\n                width: style?.width || '32px',\n                height: style?.height || '32px',\n                position: 'relative'\n            }}>\n                <img\n                    src={imgSrc}\n                    alt={alt || ''}\n                    style={{\n                        position: 'absolute',\n                        width: `${columns * 100}%`,\n                        height: `${rows * 100}%`,\n                        left: `-${col * 100}%`,\n                        top: `-${row * 100}%`,\n                        maxWidth: 'none',\n                        maxHeight: 'none',\n                        display: 'block'\n                    }}\n                    draggable={false}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false}\n        />\n    );\n};\n\nexport default AnimatedItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport fireballA from '../../../assets/images/items/fireball_basic_A.png';\nimport fireballB from '../../../assets/images/items/fireball_basic_B.png';\nimport fireballC from '../../../assets/images/items/fireball_basic_C.png';\nimport fireballD from '../../../assets/images/items/fireball_basic_D.png';\nimport fishSprite from '../../../assets/images/entities/animals/fish_01.png';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: auto;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nconst FishDisplay = styled(AmmoDisplay)`\n    color: rgba(140, 230, 255, 0.95);\n`;\n\nconst AmmoIcon = styled.span`\n    width: 22px;\n    height: 22px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    image-rendering: pixelated;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    //gap: 8px;\n`;\n\nconst BarsContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    //gap: 1px;\n    width: 250px;\n    padding-top: 5px;\n    padding-bottom: 5px;\n   // border: solid 1px red;\n`;\n\nconst BarRow = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n`;\n\nconst BarWrapper = styled.div`\n    flex: 1;\n    height: 6px;\n    background-color: rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.4);\n    position: relative;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\n`;\n\nconst BarFill = styled.div.attrs(props => ({\n    style: {\n        width: `${props.$percent}%`,\n        backgroundColor: props.$color,\n    },\n}))`\n    height: 100%;\n    transition: width 0.3s ease;\n`;\n\nconst BarLabel = styled.div`\n    width: 60px;\n    font-size: 8px;\n    color: white;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px black;\n    pointer-events: none;\n    white-space: nowrap;\n    text-transform: uppercase;\n    text-align: right;\n`;\n\nconst GameHeader = ({ \n    health, \n    maxHealth = 100, \n    ammo = 0, \n    fishCount = 0,\n    oxygen = 100, \n    maxOxygen = 100, \n    lavaResist = 100, \n    maxLavaResist = 100,\n    iceResist = 100,\n    maxIceResist = 100,\n    strength = 30,\n    maxStrength = 100,\n    radioactivity = 20,\n    maxRadioactivity = 100,\n    inWater = false,\n    liquidType = null,\n    onIce = false\n}) => {\n    const hpPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));\n    const oxyPercent = Math.max(0, Math.min(100, (oxygen / maxOxygen) * 100));\n    const lavaPercent = Math.max(0, Math.min(100, (lavaResist / maxLavaResist) * 100));\n    const icePercent = Math.max(0, Math.min(100, (iceResist / maxIceResist) * 100));\n    const strengthPercent = Math.max(0, Math.min(100, (strength / maxStrength) * 100));\n    const radioPercent = Math.max(0, Math.min(100, (radioactivity / maxRadioactivity) * 100));\n    const fireballFrames = [fireballA, fireballB, fireballC, fireballD, fireballC, fireballB];\n\n    return (\n        <HeaderContainer>\n            <div style={{ display: 'flex', gap: '14px', alignItems: 'center' }}>\n                <AmmoDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            textures={fireballFrames}\n                            speed={300}\n                            alt=\"Fireball ammo\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {ammo || 0}\n                </AmmoDisplay>\n                <FishDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            texture={fishSprite}\n                            spriteSheet={{ enabled: true, columns: 2, totalSprites: 3, frameIndex: 0 }}\n                            alt=\"Fish\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {fishCount || 0}\n                </FishDisplay>\n            </div>\n\n            <RightSection>\n                <BarsContainer>\n                    {/* HP Bar */}\n                    <BarRow>\n                        <BarLabel>HP</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={hpPercent} $color=\"#ff3232\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Oxygen Bar */}\n                    <BarRow>\n                        <BarLabel>OZ</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={oxyPercent} $color=\"#2ecdf1\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Lava Bar */}\n                    <BarRow>\n                        <BarLabel>LAVA</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={lavaPercent} $color=\"#ffcc00\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Ice Bar */}\n                    <BarRow>\n                        <BarLabel>ICE</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={icePercent} $color=\"#a5f3fc\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Strength Bar */}\n                    <BarRow>\n                        <BarLabel>STRNGTH</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={strengthPercent} $color=\"#8b5a2b\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Radioactivity Bar */}\n                    <BarRow>\n                        <BarLabel>RADIO</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={radioPercent} $color=\"#32cd32\" />\n                        </BarWrapper>\n                    </BarRow>\n                </BarsContainer>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    maxHealth: PropTypes.number,\n    ammo: PropTypes.number,\n    fishCount: PropTypes.number,\n    oxygen: PropTypes.number,\n    maxOxygen: PropTypes.number,\n    lavaResist: PropTypes.number,\n    maxLavaResist: PropTypes.number,\n    iceResist: PropTypes.number,\n    maxIceResist: PropTypes.number,\n    strength: PropTypes.number,\n    maxStrength: PropTypes.number,\n    radioactivity: PropTypes.number,\n    maxRadioactivity: PropTypes.number,\n    inWater: PropTypes.bool,\n    liquidType: PropTypes.string,\n    onIce: PropTypes.bool\n};\n\nexport default GameHeader;\n","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\n// Built-in: debug overlay toggle\nregister({\n  name: 'debug',\n  description: \"Toggle debug overlay: debug [on|off|toggle]\",\n  handler({ args }) {\n    const mode = (args && args[0]) ? String(args[0]).toLowerCase() : 'toggle';\n    const current = !!(window.__GAME_RUNTIME_SETTINGS__ && window.__GAME_RUNTIME_SETTINGS__.debugOverlayEnabled);\n    const next = (mode === 'on') ? true : (mode === 'off' ? false : !current);\n    try {\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        debugOverlayEnabled: next\n      };\n      try { localStorage.setItem('game_debug_overlay', next ? '1' : '0'); } catch {}\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: { debugOverlayEnabled: next } }));\n    } catch {}\n    return `Debug overlay ${next ? 'enabled' : 'disabled'}.`;\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Lava Rain (0..100)\n  const [lavaRain, setLavaRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_lavarain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherLavaRain === 'number') return Math.max(0, Math.min(100, g.weatherLavaRain));\n    } catch {}\n    return 0;\n  });\n  // New: Radioactive Fog (0..100)\n  const [radioactiveFog, setRadioactiveFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_radioactivefog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRadioactiveFog === 'number') return Math.max(0, Math.min(100, g.weatherRadioactiveFog));\n    } catch {}\n    return 0;\n  });\n  // New: Meteor Rain (0..100)\n  const [meteorRain, setMeteorRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_meteorrain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherMeteorRain === 'number') return Math.max(0, Math.min(100, g.weatherMeteorRain));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [debugOverlayEnabled, setDebugOverlayEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_debug_overlay');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.debugOverlayEnabled === 'boolean') return g.debugOverlayEnabled;\n    } catch {}\n    return false;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [roomBlurEnabled, setRoomBlurEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_graphics_room_blur');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.roomBlurEnabled === 'boolean') return g.roomBlurEnabled;\n    } catch {}\n    return true;\n  });\n  const [showCoordinates, setShowCoordinates] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_show_coords');\n      return ls === '1';\n    } catch {}\n    return false;\n  });\n\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Listen for runtime settings updates from game engine or other sources\n  useEffect(() => {\n    const onSettingsUpdate = (e) => {\n      const patch = (e && e.detail) || {};\n      if (patch.weatherRain !== undefined) setRain(patch.weatherRain);\n      if (patch.weatherSnow !== undefined) setSnow(patch.weatherSnow);\n      if (patch.weatherClouds !== undefined) setClouds(patch.weatherClouds);\n      if (patch.weatherFog !== undefined) setFog(patch.weatherFog);\n      if (patch.weatherThunder !== undefined) setThunder(patch.weatherThunder);\n      if (patch.weatherLavaRain !== undefined) setLavaRain(patch.weatherLavaRain);\n      if (patch.weatherRadioactiveFog !== undefined) setRadioactiveFog(patch.weatherRadioactiveFog);\n      if (patch.weatherMeteorRain !== undefined) setMeteorRain(patch.weatherMeteorRain);\n      if (patch.backgroundParallaxFactor !== undefined) setParallax(patch.backgroundParallaxFactor);\n      if (patch.roomBlurEnabled !== undefined) setRoomBlurEnabled(!!patch.roomBlurEnabled);\n      if (patch.healthBarEnabled !== undefined) setHealthBarEnabled(!!patch.healthBarEnabled);\n      if (patch.oxygenBarEnabled !== undefined) setOxygenBarEnabled(!!patch.oxygenBarEnabled);\n      if (patch.lavaBarEnabled !== undefined) setLavaBarEnabled(!!patch.lavaBarEnabled);\n      if (patch.waterSplashesEnabled !== undefined) setWaterSplashesEnabled(!!patch.waterSplashesEnabled);\n      if (patch.lavaEmbersEnabled !== undefined) setLavaEmbersEnabled(!!patch.lavaEmbersEnabled);\n      if (patch.debugOverlayEnabled !== undefined) setDebugOverlayEnabled(!!patch.debugOverlayEnabled);\n    };\n    window.addEventListener('game-settings-update', onSettingsUpdate);\n    return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.roomBlurEnabled === 'boolean') {\n          setRoomBlurEnabled(g.roomBlurEnabled);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.weatherLavaRain === 'number') setLavaRain(Math.max(0, Math.min(100, g.weatherLavaRain)));\n        if (typeof g.weatherRadioactiveFog === 'number') setRadioactiveFog(Math.max(0, Math.min(100, g.weatherRadioactiveFog)));\n        if (typeof g.weatherMeteorRain === 'number') setMeteorRain(Math.max(0, Math.min(100, g.weatherMeteorRain)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n        if (typeof g.debugOverlayEnabled === 'boolean') setDebugOverlayEnabled(!!g.debugOverlayEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  useEffect(() => {\n    try { localStorage.setItem('game_ui_show_coords', showCoordinates ? '1' : '0'); } catch {}\n  }, [showCoordinates]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Blur in Room</label>\n          <input\n            type=\"checkbox\"\n            checked={!!roomBlurEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setRoomBlurEnabled(v);\n              try { localStorage.setItem('game_graphics_room_blur', v ? '1' : '0'); } catch {}\n              emitUpdate({ roomBlurEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Coordinates</label>\n          <input\n            type=\"checkbox\"\n            checked={!!showCoordinates}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setShowCoordinates(v);\n              emitUpdate({ showCoordinates: v });\n            }}\n          />\n        </div>\n        {showCoordinates && (\n          <div style={{ marginTop: 8, padding: '4px 8px', background: 'rgba(0,0,0,0.3)', borderRadius: 4, fontSize: 11, fontFamily: 'monospace', color: '#4ec9b0' }}>\n            Pos: X={Math.round(window.__PLAYER_POS__?.x || 0)}, Y={Math.round(window.__PLAYER_POS__?.y || 0)}\n          </div>\n        )}\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lavas lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(lavaRain) ? lavaRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setLavaRain(v);\n            try { localStorage.setItem('game_weather_lavarain', String(v)); } catch {}\n            emitUpdate({ weatherLavaRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(lavaRain) ? lavaRain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Radioakt. migla</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(radioactiveFog) ? radioactiveFog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRadioactiveFog(v);\n            try { localStorage.setItem('game_weather_radioactivefog', String(v)); } catch {}\n            emitUpdate({ weatherRadioactiveFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(radioactiveFog) ? radioactiveFog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Meteortu lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(meteorRain) ? meteorRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setMeteorRain(v);\n            try { localStorage.setItem('game_weather_meteorrain', String(v)); } catch {}\n            emitUpdate({ weatherMeteorRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(meteorRain) ? meteorRain : 0}</span>\n      </div>\n    </section>\n  );\n\n  const renderDebug = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Debug</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 160 }}>Show Debug Overlay</label>\n        <input\n          type=\"checkbox\"\n          checked={!!debugOverlayEnabled}\n          onChange={(e) => {\n            const v = !!e.target.checked;\n            setDebugOverlayEnabled(v);\n            try { localStorage.setItem('game_debug_overlay', v ? '1' : '0'); } catch {}\n            emitUpdate({ debugOverlayEnabled: v });\n          }}\n        />\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather','Debug'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n        {activeTab === 'Debug' && renderDebug()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import breakEffectsConfig from '../../assets/json/system/object_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!breakEffectsConfig || breakEffectsConfig.enabled === false) return null;\n  return breakEffectsConfig;\n};\n\nexport const getBreakEffectParams = (def) => {\n  if (!def) return null;\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const id = def.id;\n  const type = def.type;\n  const subtype = def.subtype;\n  const name = def.name;\n  const ids = Array.isArray(cfg.objectIds) ? cfg.objectIds : [];\n  const types = Array.isArray(cfg.objectTypes) ? cfg.objectTypes : [];\n  const matchesValue = (value, list) => {\n    if (!value) return false;\n    return list.some(item => item === value || value.includes(item));\n  };\n  const matched = matchesValue(id, ids) || matchesValue(name, ids) || matchesValue(type, types) || matchesValue(subtype, types);\n  if (!matched) return null;\n  const base = cfg.default || {};\n  const colors = Array.isArray(base.colors) ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 12,\n    speed: Number(base.speed) || 2,\n    lifeMs: Number(base.lifeMs) || 600,\n    size: Number(base.size) || 2,\n    colors\n  };\n};\n\nexport const shouldTriggerBreakEffect = (def, newHealth) => {\n  if (!def) return false;\n  const params = getBreakEffectParams(def);\n  if (!params) return false;\n  const threshold = Number(def.passableHealthThreshold ?? 0);\n  const hp = Number(newHealth);\n  if (!Number.isFinite(hp)) return false;\n  return hp <= threshold;\n};\n\nexport default {\n  getBreakEffectParams,\n  shouldTriggerBreakEffect\n};\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\n// - isInsideRoom: boolean  apply muffled effect\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6, isInsideRoom = false }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n  const audioCtxRef = useRef(null);\n  const sourceNodeRef = useRef(null);\n  const filterNodeRef = useRef(null);\n  const gainNodeRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n      if (audioCtxRef.current) {\n        audioCtxRef.current.close().catch(() => {});\n        audioCtxRef.current = null;\n        sourceNodeRef.current = null;\n        filterNodeRef.current = null;\n        gainNodeRef.current = null;\n      }\n    } catch {}\n  };\n\n  const setupWebAudio = (audio) => {\n    try {\n      const AudioContext = window.AudioContext || window.webkitAudioContext;\n      if (!AudioContext) return;\n\n      const ctx = new AudioContext();\n      const source = ctx.createMediaElementSource(audio);\n      const filter = ctx.createBiquadFilter();\n      const gain = ctx.createGain();\n\n      filter.type = 'lowpass';\n      filter.frequency.value = isInsideRoom ? 800 : 22000;\n      gain.gain.value = isInsideRoom ? 0.5 : 1.0;\n\n      source.connect(filter);\n      filter.connect(gain);\n      gain.connect(ctx.destination);\n\n      audioCtxRef.current = ctx;\n      sourceNodeRef.current = source;\n      filterNodeRef.current = filter;\n      gainNodeRef.current = gain;\n    } catch (e) {\n      console.warn('Web Audio setup failed:', e);\n    }\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Web Audio setup for filters\n    setupWebAudio(audio);\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume/room changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    // Direct audio volume (without Web Audio or as fallback)\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    \n    // Web Audio updates\n    if (audioCtxRef.current) {\n      if (filterNodeRef.current) {\n        filterNodeRef.current.frequency.setTargetAtTime(isInsideRoom ? 800 : 22000, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.gain.setTargetAtTime(isInsideRoom ? 0.4 : 1.0, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (audioCtxRef.current.state === 'suspended' && enabled) {\n        audioCtxRef.current.resume().catch(() => {});\n      }\n    }\n\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume, isInsideRoom]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst Overlay = styled.div`\n    position: absolute;\n    top: 70px;\n    left: 10%;\n    transform: none;\n    width: 80%;\n    text-align: left;\n    pointer-events: none;\n    z-index: 1500;\n    \n    h2 {\n        font-size: 22px;\n        color: white;\n        text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);\n        margin: 0;\n        padding: 12px 14px;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-weight: 800;\n        letter-spacing: 0.5px;\n        white-space: pre-line;\n        line-height: 1;\n        background: rgba(0, 0, 0, 0.45);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 6px;\n        opacity: ${props => props.$isVisible ? 1 : 0};\n        transition: opacity 2s ease-in-out;\n    }\n`;\n\nexport const MessageOverlay = ({ text, isVisible }) => {\n    if (!text) return null;\n    return (\n        <Overlay $isVisible={isVisible}>\n            <h2>{text}</h2>\n        </Overlay>\n    );\n};\n\nMessageOverlay.propTypes = {\n    text: PropTypes.string,\n    isVisible: PropTypes.bool\n};\n\nMessageOverlay.defaultProps = {\n    text: '',\n    isVisible: false\n};\n\nexport default MessageOverlay;\n","import map1 from '../assets/maps/template.json';\nimport map2 from '../assets/maps/exampel_liquids.json';\nimport map3 from '../assets/maps/exampel_sectors_01.json';\nimport map4 from '../assets/maps/exampel_sectors_02.json';\nimport map5 from '../assets/maps/exampel_m2room.json';\nimport map6 from '../assets/maps/exampel_weather_01.json';\nimport map7 from '../assets/maps/Ports.json';\nimport map8 from '../assets/maps/fish.json';\n\n\nexport const BUILT_IN_MAPS = [\n    map1,\n    map2,\n    map3,\n    map4,\n    map5,\n    map6,\n    map7,\n    map8\n];\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport { findSpawnPosition } from '../../../engine/gameplay/interactables';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../engine/gameplay/breakEffects';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, removeTileAtIndex, moveTileInMap, moveObjectInMap, updateObjectAtIndex, updateObjectMetadata, setObjectTextureIndex, revealSecretZone, resetGame, setGameOver, toggleRoom, clearRooms } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\nimport { BUILT_IN_MAPS } from '../../../constants/builtInMaps';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nconst WinCounterOverlay = styled.div`\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 120px;\n    font-weight: bold;\n    color: #fff;\n    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,255,255,0.5);\n    z-index: 2000;\n    pointer-events: none;\n    font-family: 'Courier New', Courier, monospace;\n`;\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    overflow: hidden;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nexport default function Game() {\n    const { t } = useTranslation('game');\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n\n    // Redux state\n    const gameState = useSelector(state => state.game) || {};\n    const uiState = useSelector(state => state.ui) || {};\n    const {\n        activeMapData = null,\n        tileMapData = [],\n        objectMapData = [],\n        secretMapData = [],\n        objectMetadata = {},\n        revealedSecrets = [],\n        objectTextureIndices = {},\n        mapWidth = 20,\n        mapHeight = 15,\n        isGameOver = false,\n        activeRoomIds = [],\n        projectMaps = {}\n    } = gameState;\n    const {\n        isMapModalOpen = true,\n        cameraScrollX = 0,\n        shouldCenterMap = false\n    } = uiState;\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    // In-game messages\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n\n    useEffect(() => {\n        const onToggle = (e) => {\n            const enabled = !!(e?.detail?.enabled);\n            setSoundEnabled(enabled);\n            try { localStorage.setItem('game_sound_enabled', enabled ? '1' : '0'); } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        return () => window.removeEventListener('game-sound-toggle', onToggle);\n    }, []);\n\n    useEffect(() => {\n        if (messageTimerRef.current) {\n            clearTimeout(messageTimerRef.current);\n            messageTimerRef.current = null;\n        }\n        setGameMessage({ text: '', isVisible: false });\n    }, [activeMapData]);\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        dispatch(setGameOver(true));\n    };\n\n    const handleReplay = () => {\n        if (activeMapData) {\n            console.log(\"Replaying map...\");\n            const mapToLoad = {\n                ...activeMapData,\n                meta: {\n                    ...activeMapData.meta,\n                    date_map_last_updated: new Date().toISOString()\n                }\n            };\n            loadMapData(mapToLoad);\n            dispatch(setGameOver(false));\n        }\n    };\n\n    const playerStateRef = useRef(null);\n    const activeMapIdRef = useRef(null);\n    const isGameOverRef = useRef(false);\n\n    useEffect(() => {\n        const id = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n        activeMapIdRef.current = id;\n    }, [activeMapData]);\n\n    useEffect(() => {\n        isGameOverRef.current = !!isGameOver;\n    }, [isGameOver]);\n\n    const handleStateUpdate = useCallback((action, payload) => {\n        if (action === 'collectItem') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            dispatch(removeObjectAtIndex({ index, mapId }));\n        } else if (action === 'interactable') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            \n            const targetObjectData = (!mapId || mapId === 'main') ? objectMapData : (activeMapData?.maps?.[mapId]?.objectMapData || []);\n            const currentId = targetObjectData[index];\n            \n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used', mapId }));\n            }\n        } else if (action === 'setObjectFrame') {\n            const { index, frame, mapId } = payload;\n            dispatch(updateObjectMetadata({ index, metadata: { currentFrame: frame }, mapId }));\n        } else if (action === 'switchMap') {\n            const { targetMapId, triggerId } = payload;\n            const projectMapsResolved = Object.keys(projectMaps || {}).length\n                ? projectMaps\n                : (activeMapData?.maps || activeMapData?.projectMaps || {});\n            const targetMap = projectMapsResolved[targetMapId];\n            \n            if (targetMap && targetMap.type === 'room') {\n                if (!activeRoomIds.includes(targetMapId)) {\n                    dispatch(toggleRoom(targetMapId));\n                }\n                return;\n            } else if (targetMapId === 'main' && activeRoomIds.length > 0) {\n                dispatch(clearRooms());\n                \n                // Open the door at the exit target position to prevent getting stuck\n                const spawn = findSpawnPosition(activeMapData, triggerId, 32);\n                if (spawn) {\n                    const spawnIdx = (Math.floor(spawn.y / 32) * mapWidth) + Math.floor(spawn.x / 32);\n                    const spawnObjId = objectMapData[spawnIdx];\n                    const spawnDef = registryItems.find(r => r.id === spawnObjId);\n                    if (spawnDef && spawnDef.subtype === 'door') {\n                        dispatch(updateObjectMetadata({ \n                            index: spawnIdx, \n                            metadata: { currentFrame: spawnDef.interaction?.frames?.opening || 1 } \n                        }));\n                    }\n                }\n                return;\n            }\n            \n            if (targetMap) {\n                console.log(`Switching to map: ${targetMapId}, looking for trigger: ${triggerId}`);\n                \n                // Ms varam vienkri nodot visu projektu un pielikt spawnTriggerId\n                const projectToLoad = {\n                    ...activeMapData,\n                    maps: projectMapsResolved,\n                    meta: {\n                        ...activeMapData.meta,\n                        activeMapId: targetMapId,\n                        spawnTriggerId: triggerId\n                    }\n                };\n                \n                loadMapData(projectToLoad);\n            }\n        } else if (action === 'objectDamage') {\n            const { index, damage } = payload;\n            const objId = objectMapData[index];\n            if (objId) {\n                const def = registryItems.find(r => r.id === objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata[index] || {};\n                    const maxH = def.maxHealth || 100;\n                    const newHealth = Math.max(0, (currentMeta.health !== undefined ? currentMeta.health : maxH) - damage);\n                    const metaPatch = { health: newHealth };\n                    if (shouldTriggerBreakEffect(def, newHealth) && !currentMeta.breakFxPlayed) {\n                        metaPatch.breakFxPlayed = true;\n                        const cfg = getBreakEffectParams(def);\n                        if (cfg) {\n                            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            window.dispatchEvent(new CustomEvent('game-break-effect', {\n                                detail: { x, y, config: cfg }\n                            }));\n                        }\n                    }\n                    dispatch(updateObjectMetadata({ index, metadata: metaPatch }));\n\n                    if (shouldRemoveCrackBlock(def, newHealth)) {\n                        dispatch(removeTileAtIndex(index));\n                    }\n\n                    const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                    const y = Math.floor(index / mapWidth) * TILE_SIZE;\n                    window.dispatchEvent(new CustomEvent('game-floating-text', {\n                        detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n                    }));\n                }\n            }\n        } else if (action === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (action === 'shiftTile' && payload) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapIdRef.current;\n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => objectMapData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => dispatch(moveTileInMap({ fromIndex: from, toIndex: to })),\n                moveObject: (from, to) => dispatch(moveObjectInMap({ fromIndex: from, toIndex: to })),\n                removeObject: idx => dispatch(removeObjectAtIndex(idx)),\n                shouldCancel: () => isGameOverRef.current || activeMapIdRef.current !== mapIdAtStart\n            });\n        } else if (action === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            const ps = playerStateRef.current;\n            const px = Number.isFinite(x) ? x : (ps?.x || 0) + (ps?.width || TILE_SIZE) / 2;\n            const py = Number.isFinite(y) ? y : (ps?.y || 0);\n            if (Number.isFinite(px) && Number.isFinite(py) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x: px, y: py, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        } else if (action === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (action === 'levelWin') {\n            console.log(\"Level Win! Returning to map selection.\");\n            setTimeout(() => {\n                alert(\"Level Complete!\");\n                dispatch(setMapModalOpen(true));\n            }, 500);\n        } else if (action === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1); // e.g., weatherRain\n            setRuntimeSettings(prev => ({ ...prev, [settingKey]: value }));\n            \n            // Dispatch event so UI components like GameSettings can update their state\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (action === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            // o darbbu ms izmantosim, lai nodotu informciju dzinjam caur ref vai eventu\n            // Bet labk ir tiei izsaukt dzinja funkciju, ja tda ir.\n            // T k useGameEngine ir hook, ms nevaram viegli izsaukt t iekjo funkciju.\n            // Tomr ms varam izmantot window eventu vai ref.\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (action === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        }\n    }, [activeMapData, activeRoomIds, dispatch, mapHeight, mapWidth, objectMapData, objectMetadata, projectMaps, registryItems]);\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const playerState = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        activeRoomIds,\n        mapWidth,\n        mapHeight\n    );\n    useEffect(() => {\n        playerStateRef.current = playerState;\n    }, [playerState]);\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => {\n            dispatch(setMapModalOpen(true));\n            dispatch(setGameOver(false)); // Reset game over when opening new game modal\n        };\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherLavaRain: (runtimeSettings.weatherLavaRain ?? 0),\n                weatherRadioactiveFog: (runtimeSettings.weatherRadioactiveFog ?? 0),\n                weatherMeteorRain: (runtimeSettings.weatherMeteorRain ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                roomBlurEnabled: (runtimeSettings.roomBlurEnabled ?? true),\n                debugOverlayEnabled: (runtimeSettings.debugOverlayEnabled ?? false),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const cloneMapData = (data) => {\n        if (!data) return data;\n        try {\n            if (typeof structuredClone === 'function') {\n                return structuredClone(data);\n            }\n        } catch {}\n        try {\n            return JSON.parse(JSON.stringify(data));\n        } catch {\n            return data;\n        }\n    };\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            const sourceMapData = cloneMapData(mapData);\n            let effectiveMapData = sourceMapData;\n            \n            // Atbalsts Version 2.0 (Multi-map project)\n            if (sourceMapData.meta?.version === \"2.0\" && sourceMapData.maps) {\n                const activeId = sourceMapData.meta.activeMapId || Object.keys(sourceMapData.maps)[0];\n                const activeMap = sourceMapData.maps[activeId];\n                \n                if (activeMap) {\n                    const activeLayers = activeMap.layers || [];\n                    const bgLayer = activeLayers.find(l => l.name === 'background' || l.type === 'tile');\n                    const objLayer = activeLayers.find(l => l.name === 'entities' || l.type === 'object');\n                    const secretLayer = activeLayers.find(l => l.name === 'secrets' || l.type === 'secret');\n                    const mapTileData = activeMap.tileMapData || bgLayer?.data;\n                    const mapObjectData = activeMap.objectMapData || objLayer?.data;\n                    const mapSecretData = activeMap.secretMapData || secretLayer?.data;\n\n                    // Konvertjam uz formtu, ko saprot dzinjs un setActiveMap\n                    effectiveMapData = {\n                        ...sourceMapData, // Saglabjam visu projektu\n                        meta: {\n                            ...sourceMapData.meta,\n                            width: activeMap.width,\n                            height: activeMap.height,\n                            name: activeMap.name,\n                            backgroundImage: activeMap.backgroundImage,\n                            backgroundColor: activeMap.backgroundColor,\n                            backgroundMusic: activeMap.backgroundMusic,\n                            backgroundParallaxFactor: activeMap.backgroundParallaxFactor,\n                            weather: activeMap.weather,\n                            objectMetadata: activeMap.objectMetadata || {},\n                            playerPosition: activeMap.playerPosition\n                        },\n                        layers: [\n                            { name: 'background', data: mapTileData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'entities', data: mapObjectData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'secrets', data: mapSecretData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) }\n                        ]\n                    };\n                }\n            }\n\n            const nowIso = new Date().toISOString();\n            if (!effectiveMapData.meta) effectiveMapData.meta = {};\n            effectiveMapData.meta.date_map_last_updated = nowIso;\n\n            const w = effectiveMapData.meta?.width || effectiveMapData.width || 20;\n            const h = effectiveMapData.meta?.height || effectiveMapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (effectiveMapData.layers) {\n                const bgLayer = effectiveMapData.layers.find(l => l.name === 'background' || l.type === 'tile');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = effectiveMapData.layers.find(l => l.name === 'entities' || l.type === 'object');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = effectiveMapData.layers.find(l => l.name === 'secrets' || l.type === 'secret');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = effectiveMapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData: effectiveMapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n            dispatch(setGameOver(false)); // Ensure game over is reset on map load\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: effectiveMapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    const debugOverlayEnabled = !!(runtimeSettings.debugOverlayEnabled);\n    const debugMapId = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n\n    return (\n        <GameContainer onClick={() => {\n            window.dispatchEvent(new CustomEvent('game-sound-user-gesture'));\n        }}>\n        \n            {/* Game Header */}\n            {/* UI Overlays */}\n            {playerState?.isWinning && (\n                <WinCounterOverlay>\n                    {Math.floor(playerState.winCounter || 0)}\n                </WinCounterOverlay>\n            )}\n\n            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n\n            <GameHeader \n                health={playerState.health} \n                maxHealth={playerState.maxHealth}\n                ammo={playerState.ammo || 0} \n                fishCount={playerState.fishCount || 0}\n                oxygen={playerState.oxygen}\n                maxOxygen={playerState.maxOxygen}\n                lavaResist={playerState.lavaResist}\n                maxLavaResist={playerState.maxLavaResist}\n                iceResist={playerState.iceResist}\n                maxIceResist={playerState.maxIceResist}\n                strength={playerState.strength}\n                maxStrength={playerState.maxStrength}\n                radioactivity={playerState.radioactivity}\n                maxRadioactivity={playerState.maxRadioactivity}\n                inWater={playerState.inWater}\n                liquidType={playerState.liquidType}\n                onIce={playerState.onIce}\n            />\n\n            {debugOverlayEnabled && (\n                <div style={{\n                    position: 'absolute',\n                    top: 70,\n                    left: 70,\n                    background: 'rgba(0,0,0,0.6)',\n                    color: '#eaeaea',\n                    padding: '8px 10px',\n                    fontSize: 11,\n                    lineHeight: 1.4,\n                    borderRadius: 4,\n                    zIndex: 2100,\n                    pointerEvents: 'none',\n                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace'\n                }}>\n                    <div>Map: {debugMapId}</div>\n                    <div>Pos: {Math.round(playerState.x || 0)}, {Math.round(playerState.y || 0)}</div>\n                    <div>Room: {Array.isArray(activeRoomIds) && activeRoomIds.length ? activeRoomIds.join(', ') : 'none'}</div>\n                    <div>Weather: rain {runtimeSettings.weatherRain ?? 0} | snow {runtimeSettings.weatherSnow ?? 0} | fog {runtimeSettings.weatherFog ?? 0}</div>\n                    <div>Weather: lava {runtimeSettings.weatherLavaRain ?? 0} | radio {runtimeSettings.weatherRadioactiveFog ?? 0}</div>\n                    <div>HP {Math.round(playerState.health || 0)} / {Math.round(playerState.maxHealth || 0)}</div>\n                    <div>O2 {Math.round(playerState.oxygen || 0)} | Lava {Math.round(playerState.lavaResist || 0)} | Rad {Math.round(playerState.radioactivity || 0)}</div>\n                </div>\n            )}\n\n\n            {isGameOver && (\n                <GameOverOverlay>\n                    <GameOverTitle>Game Over</GameOverTitle>\n                    <ReplayButton onClick={handleReplay}>\n                        REPLAY \n                    </ReplayButton>\n                </GameOverOverlay>\n            )}\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>{t('GAME_MAP_SELECT_TITLE')}</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => {\n                                const isV2 = map.meta?.version === \"2.0\";\n                                const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                                const author = map.meta?.author || \"Unknown\";\n                                \n                                let sizeInfo = \"\";\n                                let subMapInfo = \"\";\n\n                                if (isV2 && map.maps) {\n                                    const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                                    if (mainMap) {\n                                        sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                                    }\n                                    \n                                    const mapValues = Object.values(map.maps);\n                                    const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                                    const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                                    \n                                    subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                                } else {\n                                    sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                                }\n\n                                return (\n                                    <MapCard key={index} onClick={() => loadMapData(map)}>\n                                        <div>\n                                            <MapTitle>{projectName}</MapTitle>\n                                            <MapAuthor>{t('GAME_MAP_BY', { author })}</MapAuthor>\n                                        </div>\n                                        {map.meta?.description && (\n                                            <MapDescription title={map.meta.description}>\n                                                {map.meta.description}\n                                            </MapDescription>\n                                        )}\n                                        <MapInfo>\n                                            <div>{t('GAME_MAP_SIZE', { size: `${sizeInfo}${subMapInfo}` })}</div>\n                                        </MapInfo>\n                                    </MapCard>\n                                );\n                            })}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 {t('GAME_MAP_LOAD_CUSTOM')}\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherLavaRain={runtimeSettings.weatherLavaRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherMeteorRain={runtimeSettings.weatherMeteorRain ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherRadioactiveFog={runtimeSettings.weatherRadioactiveFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                            roomBlurEnabled={runtimeSettings.roomBlurEnabled ?? true}\n                            debugOverlayEnabled={runtimeSettings.debugOverlayEnabled ?? false}\n                            isEditor={false}\n                            mapType={activeMapData?.type || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={projectMaps}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer \n                metaPath={activeMapData?.meta?.backgroundMusic} \n                enabled={soundEnabled} \n                volume={0.6} \n                isInsideRoom={activeRoomIds.length > 0}\n            />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","import saveFile from '../../../../utilities/saveFile';\nimport errorHandler from '../../../../services/errorHandler';\n\nexport const saveMap = async ({\n    maps,\n    activeMapId,\n    mapName,\n    creatorName,\n    mapDescription,\n    createdAt,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    const projectData = {\n        meta: {\n            version: \"2.0\",\n            projectName: mapName,\n            author: creatorName,\n            description: mapDescription,\n            date_created: createdDate,\n            date_last_updated: currentDate,\n            activeMapId: activeMapId\n        },\n        maps: {}\n    };\n\n    // Serialize all maps\n    Object.values(maps).forEach(map => {\n        const filledBlocks = map.tileMapData.filter(t => t !== null).length;\n        const objectsCount = map.objectMapData.filter(o => o !== null).length;\n        \n        projectData.maps[map.id] = {\n            id: map.id,\n            name: map.name,\n            description: map.description || '',\n            type: map.type,\n            width: map.mapWidth,\n            height: map.mapHeight,\n            backgroundImage: map.selectedBackgroundImage || null,\n            backgroundColor: map.selectedBackgroundColor || null,\n            backgroundParallaxFactor: map.backgroundParallaxFactor || 0.3,\n            backgroundMusic: map.selectedBackgroundMusic || null,\n            weather: map.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n            objectMetadata: map.objectMetadata || {},\n            playerPosition: map.playerPosition || null,\n            worldX: map.worldX || 0,\n            worldY: map.worldY || 0,\n            statistics: {\n                total_tiles: map.mapWidth * map.mapHeight,\n                filled_tiles: filledBlocks,\n                total_objects: objectsCount\n            },\n            layers: [\n                { type: \"tile\", name: \"background\", data: map.tileMapData },\n                { type: \"object\", name: \"entities\", data: map.objectMapData },\n                { type: \"secret\", name: \"secrets\", data: map.secretMapData || Array(map.mapWidth * map.mapHeight).fill(null) }\n            ]\n        };\n    });\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(projectData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Project saved successfully', {\n                component: 'Editor',\n                projectName: mapName,\n                fileName,\n                mapsCount: Object.keys(maps).length\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save project. Check console for details.');\n    }\n};\n\nexport const applyMapData = (loaded, {\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setPlayerPosition,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData,\n    setObjectMetadata,\n    setWeatherRain,\n    setWeatherSnow,\n    setWeatherClouds,\n    setWeatherFog,\n    setWeatherThunder,\n    setWeatherLavaRain,\n    setWeatherRadioactiveFog,\n    setWeatherMeteorRain,\n    // Multi-map setters\n    setMaps,\n    setActiveMapId\n}) => {\n    try {\n        // Check for multi-map format (version 2.0)\n        if (loaded.meta && loaded.meta.version === \"2.0\" && loaded.maps) {\n            const projectMaps = {};\n            \n            Object.keys(loaded.maps).forEach(mapId => {\n                const m = loaded.maps[mapId];\n                const bgLayer = m.layers.find(l => l.type === 'tile');\n                const objLayer = m.layers.find(l => l.type === 'object');\n                const secretLayer = m.layers.find(l => l.type === 'secret');\n                \n                projectMaps[mapId] = {\n                    id: mapId,\n                    name: m.name,\n                    description: m.description || '',\n                    type: m.type || 'overworld',\n                    mapWidth: m.width,\n                    mapHeight: m.height,\n                    tileMapData: bgLayer ? bgLayer.data : Array(m.width * m.height).fill(null),\n                    objectMapData: objLayer ? objLayer.data : Array(m.width * m.height).fill(null),\n                    secretMapData: secretLayer ? secretLayer.data : Array(m.width * m.height).fill(null),\n                    objectMetadata: m.objectMetadata || {},\n                    selectedBackgroundImage: m.backgroundImage,\n                    selectedBackgroundColor: m.backgroundColor,\n                    backgroundParallaxFactor: m.backgroundParallaxFactor || 0.3,\n                    selectedBackgroundMusic: m.backgroundMusic,\n                    weather: m.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                    playerPosition: m.playerPosition || null,\n                    worldX: m.worldX || 0,\n                    worldY: m.worldY || 0\n                };\n            });\n            \n            setMaps(projectMaps);\n            setMapName(loaded.meta.projectName || \"Loaded Project\");\n            setCreatorName(loaded.meta.author || \"Anonymous\");\n            setMapDescription(loaded.meta.description || \"\");\n            setCreatedAt(loaded.meta.date_created || new Date().toISOString());\n            \n            const activeId = loaded.meta.activeMapId || Object.keys(projectMaps)[0];\n            setActiveMapId(activeId);\n            \n            const activeMap = projectMaps[activeId];\n            if (activeMap) {\n                setMapWidth(activeMap.mapWidth);\n                setMapHeight(activeMap.mapHeight);\n                setTileMapData(activeMap.tileMapData);\n                setObjectMapData(activeMap.objectMapData);\n                setSecretMapData(activeMap.secretMapData);\n                setObjectMetadata(activeMap.objectMetadata);\n                setSelectedBackgroundImage(activeMap.selectedBackgroundImage);\n                setSelectedBackgroundColor(activeMap.selectedBackgroundColor);\n                setBackgroundParallaxFactor(activeMap.backgroundParallaxFactor);\n                setSelectedBackgroundMusic(activeMap.selectedBackgroundMusic);\n                \n                setWeatherRain(activeMap.weather.rain);\n                setWeatherSnow(activeMap.weather.snow);\n                setWeatherClouds(activeMap.weather.clouds);\n                setWeatherFog(activeMap.weather.fog);\n                setWeatherThunder(activeMap.weather.thunder);\n                setWeatherLavaRain(activeMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(activeMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(activeMap.weather.meteorRain || 0);\n\n                if (activeMap.playerPosition) setPlayerPosition(activeMap.playerPosition);\n            }\n            \n            errorHandler.info('Project loaded successfully', {\n                component: 'Editor',\n                projectName: loaded.meta.projectName\n            });\n        } else if (loaded.meta) {\n            // Legacy 1.0 format\n            setMapWidth(loaded.meta.width);\n            setMapHeight(loaded.meta.height);\n\n            if (loaded.meta.name) setMapName(loaded.meta.name);\n            if (loaded.meta.author) setCreatorName(loaded.meta.author);\n            if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n            const bgLayer = loaded.layers.find(l => l.name === 'background');\n            const objLayer = loaded.layers.find(l => l.name === 'entities');\n            const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n            \n            const singleMap = {\n                id: 'main',\n                name: loaded.meta.name || \"Main Map\",\n                type: 'overworld',\n                mapWidth: loaded.meta.width,\n                mapHeight: loaded.meta.height,\n                tileMapData: bgLayer ? bgLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMapData: objLayer ? objLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                secretMapData: secretLayer ? secretLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMetadata: loaded.meta.objectMetadata || {},\n                selectedBackgroundImage: loaded.meta.backgroundImage,\n                selectedBackgroundColor: loaded.meta.backgroundColor,\n                backgroundParallaxFactor: loaded.meta.backgroundParallaxFactor || 0.3,\n                selectedBackgroundMusic: loaded.meta.backgroundMusic,\n                weather: loaded.meta.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                playerPosition: null\n            };\n\n            setMaps({ 'main': singleMap });\n            setActiveMapId('main');\n\n            if (bgLayer) setTileMapData(bgLayer.data);\n            if (objLayer) setObjectMapData(objLayer.data);\n            if (secretLayer) setSecretMapData(secretLayer.data);\n            \n            // Set other states\n            if (loaded.meta.backgroundImage) setSelectedBackgroundImage(loaded.meta.backgroundImage);\n            if (loaded.meta.backgroundColor) setSelectedBackgroundColor(loaded.meta.backgroundColor);\n            if (loaded.meta.backgroundParallaxFactor !== undefined) setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n            if (loaded.meta.backgroundMusic) setSelectedBackgroundMusic(loaded.meta.backgroundMusic);\n            if (loaded.meta.objectMetadata) setObjectMetadata(loaded.meta.objectMetadata);\n            if (loaded.meta.weather) {\n                setWeatherRain(loaded.meta.weather.rain || 0);\n                setWeatherSnow(loaded.meta.weather.snow || 0);\n                setWeatherClouds(loaded.meta.weather.clouds || 0);\n                setWeatherFog(loaded.meta.weather.fog || 0);\n                setWeatherThunder(loaded.meta.weather.thunder || 0);\n                setWeatherLavaRain(loaded.meta.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(loaded.meta.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(loaded.meta.weather.meteorRain || 0);\n            }\n            if (loaded.meta.playerPosition) setPlayerPosition(loaded.meta.playerPosition);\n\n            errorHandler.info('Map loaded successfully (Converted to Project)', {\n                component: 'Editor',\n                mapName: loaded.meta.name\n            });\n        } else {\n            // Oldest format\n            if (loaded.width) setMapWidth(loaded.width);\n            if (loaded.height) setMapHeight(loaded.height);\n            if (loaded.tiles) setTileMapData(loaded.tiles);\n            setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n            errorHandler.warn('Loaded map in legacy format', {\n                component: 'Editor'\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'applyMapData'\n        });\n        alert('Error applying map data. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    ...setters\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                applyMapData(loaded, setters);\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const loadBuiltInMap = ({\n    mapData,\n    ...setters\n}) => {\n    try {\n        applyMapData(mapData, setters);\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'loadBuiltInMap'\n        });\n        alert('Error loading built-in map.');\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets, objectMetadata: oldMeta } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        if (!oldArr) return newArr;\n        const offsetY = newHeight - oldH;\n        for (let y = 0; y < newHeight; y++) {\n            const oldY = y - offsetY;\n            if (oldY < 0 || oldY >= oldH) continue;\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[oldY * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    const resizeMetadata = (oldM) => {\n        const newM = {};\n        if (!oldM) return newM;\n        const offsetY = newHeight - oldH;\n        for (let y = 0; y < newHeight; y++) {\n            const oldY = y - offsetY;\n            if (oldY < 0 || oldY >= oldH) continue;\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                const oldIdx = oldY * oldW + x;\n                const newIdx = y * newWidth + x;\n                if (oldM[oldIdx]) {\n                    newM[newIdx] = oldM[oldIdx];\n                }\n            }\n        }\n        return newM;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets));\n    setObjectMetadata(resizeMetadata(oldMeta));\n};\n","import React from 'react';\n\nexport const ObjectLinks = React.memo(({ mapWidth, mapHeight, objectMapData, objectMetadata }) => {\n    const links = [];\n    const portals = [];\n    const targets = [];\n\n    // Collect all portals and targets with Trigger IDs\n    objectMapData.forEach((id, index) => {\n        if (!id) return;\n        const metadata = objectMetadata?.[index];\n        if (!metadata || metadata.triggerId === undefined || metadata.triggerId === null) return;\n\n        const x = (index % mapWidth) * 32 + 16;\n        const y = Math.floor(index / mapWidth) * 32 + 16;\n\n        if (id.includes('portal') && !id.includes('target')) {\n            portals.push({ x, y, id: metadata.triggerId });\n        } else if (id.includes('target') || id === 'portal_target') {\n            targets.push({ x, y, id: metadata.triggerId });\n        }\n    });\n\n    // Draw lines between matching IDs\n    portals.forEach(p => {\n        targets.forEach(t => {\n            if (p.id === t.id) {\n                links.push(\n                    <line\n                        key={`link-${p.x}-${p.y}-${t.x}-${t.y}`}\n                        x1={p.x} y1={p.y}\n                        x2={t.x} y2={t.y}\n                        stroke=\"#fff\"\n                        strokeWidth=\"2\"\n                        strokeDasharray=\"5,5\"\n                    />\n                );\n            }\n        });\n    });\n\n    return (\n        <svg style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: mapWidth * 32,\n            height: mapHeight * 32, // Note: mapHeight must be available\n            zIndex: 10,\n            pointerEvents: 'none',\n            opacity: 0.6\n        }}>\n            {links}\n        </svg>\n    );\n});\n","import React from 'react';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const EditorTile = React.memo(({\n    index,\n    x, y,\n    activeTool,\n    tileObj,\n    objObj,\n    secretObj,\n    objectMetadata,\n    isHighlighted,\n    parentRegionIndex,\n    borderStyle,\n    bgStyle,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleResizeStart,\n    handleMoveStart,\n    filter,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages\n}) => {\n    const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n    const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n    const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n    const isQuicksandTile = !!(tileObj && tileObj.flags && tileObj.flags.quicksand);\n    const isWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.waterfall);\n    const isLavaWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.lava_waterfall);\n    const isRadioactiveWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_water);\n    const isRadioactiveWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_waterfall);\n\n    const actualIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n    const triggerId = objectMetadata?.[actualIndex]?.triggerId;\n    const intensity = objectMetadata?.[actualIndex]?.intensity;\n    const messageText = objectMetadata?.[actualIndex]?.message;\n    const i18nChapter = objectMetadata?.[actualIndex]?.i18nChapter;\n    const i18nId = objectMetadata?.[actualIndex]?.i18nId;\n    const i18nText = objObj?.type === 'message_trigger' ? getTutorialText(i18nChapter, i18nId) : '';\n    const resolvedMessageText = messageText || i18nText;\n    \n    // Dimensijas emam no tie indeksa, lai izvairtos no citu objektu (piem. Room Area) \n    // ietekmes uz 1x1 objektiem, kas atrodas to robes.\n    const width = Number(objectMetadata?.[index]?.width ?? objObj?.width ?? secretObj?.width ?? 1);\n    const height = Number(objectMetadata?.[index]?.height ?? objObj?.height ?? secretObj?.height ?? 1);\n\n    const handleMouseDown = (e) => {\n        // If we're clicking a tile that's part of a region, we should interact with the anchor\n        const targetIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n        \n        if (activeTool === 'move') {\n            const hasMovable = objectMetadata[targetIndex] || objObj || secretObj;\n            if (hasMovable) {\n                e.stopPropagation();\n                handleMoveStart(targetIndex);\n                return;\n            }\n        }\n        handleGridMouseDown(index, e);\n    };\n\n    const isResizable = React.useMemo(() => {\n        if (!objObj && !secretObj) return false;\n        \n        // Room areas (windows) on room maps are NOT resizable\n        if (secretObj && secretObj.subtype === 'room' && mapType === 'room') return false;\n\n        // Specifically requested to disable for these types, except Room Areas which MUST be resizable\n        if (secretObj && secretObj.type === 'secret' && secretObj.subtype !== 'room') return false;\n        if (objObj && (objObj.type === 'crack_block' || objObj.type === 'wolf_secret')) return false;\n        return true;\n    }, [objObj, secretObj, mapType]);\n\n    const hasObjectOrSecret = objObj || secretObj || (parentRegionIndex !== null);\n\n    return (\n        <div\n            onMouseDown={handleMouseDown}\n            onMouseEnter={() => handleGridMouseEnter(index)}\n            style={{\n                width: '32px',\n                height: '32px',\n                border: borderStyle,\n                backgroundColor: bgStyle,\n                position: 'relative',\n                boxSizing: 'border-box',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                overflow: 'visible',\n                cursor: (activeTool === 'move' && hasObjectOrSecret) ? 'grab' : 'default'\n            }}>\n            \n            {isHighlighted && parentRegionIndex === null && isResizable && (\n                <>\n                    {/* Resize Handles */}\n                    {/* Right */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'right'); }}\n                        style={{ position: 'absolute', right: `${-(width-1)*32 - 6}px`, top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Left */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'left'); }}\n                        style={{ position: 'absolute', left: '-6px', top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Bottom */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'bottom'); }}\n                        style={{ position: 'absolute', bottom: `${-(height-1)*32 - 6}px`, left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                    {/* Top */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'top'); }}\n                        style={{ position: 'absolute', top: '-6px', left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                </>\n            )}\n\n            {/* Tile Layer */}\n            {tileObj && (\n                <div style={{ filter: filter ? filter('tile') : 'none', transition: 'filter 0.3s ease' }}>\n                    {isLiquidTile ? (\n                        <div style={{\n                            width: '32px', height: '32px',\n                            background: isLavaWaterfallTile ? 'rgba(255, 204, 0, 0.7)' : (isLavaTile ? 'rgba(255, 204, 0, 0.7)' : (isWaterTile || isWaterfallTile ? 'rgba(58, 127, 184, 0.7)' : (isQuicksandTile ? 'rgba(218, 165, 32, 0.7)' : (isRadioactiveWaterTile || isRadioactiveWaterfallTile ? 'rgba(50, 205, 50, 0.7)' : 'rgba(0, 255, 255, 0.3)')))),\n                            display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: '8px'\n                        }}>\n                            {isLavaWaterfallTile ? 'L.FALL' : (isLavaTile ? 'LAVA' : (isRadioactiveWaterfallTile ? 'RADFALL' : (isRadioactiveWaterTile ? 'RAD' : (isWaterTile ? 'WATER' : (isWaterfallTile ? 'FALL' : (isQuicksandTile ? 'QUICK' : 'LIQ'))))))}\n                        </div>\n                    ) : (\n                        <AnimatedItem\n                            textures={tileObj.textures}\n                            texture={tileObj.texture}\n                            speed={tileObj.animationSpeed}\n                            spriteSheet={tileObj.spriteSheet}\n                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\n                        />\n                    )}\n                </div>\n            )}\n\n            {/* Secret Layer */}\n            {secretObj && (secretObj.subtype !== 'room' || isRoomAreaVisible || showRoomMapContent || activeTool === 'area' || mapType === 'room') && (\n                <div style={{\n                    position: 'absolute', \n                    top: '0', left: '0',\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: secretObj.filterColorInEditor || secretObj.filterColor || 'rgba(128, 0, 128, 0.4)',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    color: '#fff', fontSize: '10px', fontWeight: 'bold', zIndex: 2,\n                    filter: filter ? filter('secret') : 'none', transition: 'filter 0.3s ease',\n                    border: '1px dashed rgba(255,255,255,0.5)',\n                    boxSizing: 'border-box',\n                    pointerEvents: 'none'\n                }}>\n                    {mapType !== 'room' && (secretObj.editorIcon || 'SECRET')}\n                </div>\n            )}\n\n            {/* Object Layer */}\n            {objObj && (() => {\n                const renderOffsetX = Number(objObj?.render?.offsetX) || 0;\n                const renderOffsetY = Number(objObj?.render?.offsetY) || 0;\n                const overlapX = Number(objObj?.render?.overlapX) || 0;\n                const overlapY = Number(objObj?.render?.overlapY) || 0;\n                const isLargeDecoration = objObj.type === 'decoration' && (width > 1 || height > 1);\n                const isTree = objObj.editor?.group === 'trees';\n                const renderAboveOverride = objectMetadata?.[actualIndex]?.renderAbovePlayer;\n                const resolvedRenderAbove = renderAboveOverride !== undefined ? renderAboveOverride : objObj.renderAbovePlayer;\n                const treeLayerLabel = resolvedRenderAbove ? 'TREE: ABOVE PLAYER' : 'TREE: BEHIND PLAYER';\n                const anchorOffsetX = isLargeDecoration ? -Math.floor(width / 2) * 32 : 0;\n                const anchorOffsetY = isLargeDecoration ? -(height - 1) * 32 : 0;\n                const baseTop = objObj.type === 'decoration' ? 0 : 2;\n                const baseLeft = objObj.type === 'decoration' ? 0 : 2;\n                const baseWidth = objObj.type === 'decoration' ? (width * 32) : (width * 32 - 4);\n                const baseHeight = objObj.type === 'decoration' ? (height * 32) : (height * 32 - 4);\n                return (\n                <div style={{\n                    position: 'absolute', \n                    top: `${baseTop + renderOffsetY + anchorOffsetY - overlapY / 2}px`,\n                    left: `${baseLeft + renderOffsetX + anchorOffsetX - overlapX / 2}px`,\n                    width: `${baseWidth + overlapX}px`,\n                    height: `${baseHeight + overlapY}px`,\n                    zIndex: 3,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    filter: filter ? filter('object') : 'none', transition: 'filter 0.3s ease',\n                    pointerEvents: 'none' // Let clicks pass through to the tile for resizing handles\n                }}>\n                    {objObj.editorIcon ? (\n                        <span style={{\n                            fontSize: objObj.editorIcon === 'i18n' ? '12px' : '20px',\n                            width: '100%',\n                            height: '100%',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            backgroundColor: 'rgba(255,255,255,0.1)',\n                            border: '1px dashed rgba(255,255,255,0.3)',\n                            color: '#222',\n                            fontWeight: 700\n                        }}>{objObj.editorIcon}</span>\n                    ) : (\n                        <AnimatedItem\n                            textures={objObj.textures}\n                            texture={objObj.texture}\n                            speed={objObj.animationSpeed}\n                            spriteSheet={objObj.spriteSheet}\n                            frameIndex={objectMetadata?.[actualIndex]?.currentFrame !== undefined ? objectMetadata[actualIndex].currentFrame : (objObj.subtype === 'door' && mapType === 'room' ? (objObj.interaction?.frames?.inside || 2) : 0)}\n                            style={{ \n                                width: '100%', \n                                height: '100%', \n                                objectFit: objObj.type === 'decoration' ? 'cover' : 'contain', \n                                backgroundColor: objObj.type === 'decoration' ? 'transparent' : 'rgba(255,255,255,0.1)', \n                                border: objObj.type === 'decoration' ? 'none' : '1px dashed rgba(255,255,255,0.3)' \n                            }}\n                        />\n                    )}\n\n                    {isTree && (\n                        <div style={{\n                            position: 'absolute',\n                            top: '-28px',\n                            left: '50%',\n                            transform: 'translateX(-50%)',\n                            backgroundColor: 'rgba(0,0,0,0.7)',\n                            color: '#fff',\n                            padding: '1px 6px',\n                            borderRadius: '3px',\n                            fontSize: '10px',\n                            whiteSpace: 'nowrap',\n                            zIndex: 12,\n                            border: '1px solid #fff'\n                        }}>\n                            {treeLayerLabel}\n                        </div>\n                    )}\n\n                    {objObj.type === 'message_trigger' && (\n                        <div style={{\n                            position: 'absolute',\n                            inset: '2px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            background: '#fff9c4',\n                            border: '1px solid #fbc02d',\n                            color: '#333',\n                            fontWeight: 700,\n                            fontSize: (objObj.editorIcon === 'i18n' || objObj.i18nMessage) ? '12px' : '18px'\n                        }}>\n                            {objObj.editorIcon || (objObj.i18nMessage ? 'i18n' : '')}\n                        </div>\n                    )}\n\n                    {/* Trigger ID */}\n                    {triggerId !== undefined && triggerId !== null && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', left: '0',\n                            backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 10, border: '1px solid #fff'\n                        }}>\n                            ID: {triggerId}\n                        </div>\n                    )}\n\n                    {/* Intensity */}\n                    {intensity !== undefined && intensity !== null && objObj && (objObj.type === 'weather_trigger' || objObj.hasIntensity) && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', right: '0',\n                            backgroundColor: 'rgba(0,100,200,0.8)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 11, border: '1px solid #fff'\n                        }}>\n                            {intensity}%\n                        </div>\n                    )}\n\n                    {/* Message Bubble */}\n                    {showMessages && objObj && objObj.type === 'message_trigger' && resolvedMessageText && (\n                        <div style={{\n                            position: 'absolute',\n                            left: '50%',\n                            bottom: '100%',\n                            transform: 'translateX(-50%)',\n                            marginBottom: '8px',\n                            maxWidth: '140px',\n                            backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                            color: '#222',\n                            border: '1px solid rgba(0,0,0,0.6)',\n                            borderRadius: '8px',\n                            padding: '4px 6px',\n                            fontSize: '10px',\n                            lineHeight: 1.2,\n                            textAlign: 'center',\n                            zIndex: 12,\n                            pointerEvents: 'none'\n                        }}>\n                            {resolvedMessageText}\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-6px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '6px solid transparent',\n                                borderRight: '6px solid transparent',\n                                borderTop: '6px solid rgba(255, 255, 255, 0.95)'\n                            }} />\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-7px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '7px solid transparent',\n                                borderRight: '7px solid transparent',\n                                borderTop: '7px solid rgba(0,0,0,0.6)',\n                                zIndex: -1\n                            }} />\n                        </div>\n                    )}\n                </div>\n                );\n            })()}\n\n            {/* Room Area Visibility Overlay */}\n            {(isRoomAreaVisible || showRoomMapContent || activeTool === 'area') && secretObj && secretObj.subtype === 'room' && mapType !== 'room' && (\n                <div style={{\n                    position: 'absolute',\n                    top: 0, left: 0,\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: 'rgba(255, 255, 0, 0.2)',\n                    border: '2px solid gold',\n                    boxSizing: 'border-box',\n                    zIndex: 4,\n                    pointerEvents: 'none',\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#000',\n                    fontSize: '10px',\n                    fontWeight: 'bold',\n                    textShadow: '0 0 2px #fff'\n                }}>\n                    <span style={{ fontSize: '14px' }}></span>\n                    <span style={{ whiteSpace: 'nowrap' }}>{objectMetadata?.[actualIndex]?.roomName || 'Unnamed'}</span>\n                    <span style={{ fontSize: '9px' }}>{width}x{height}m</span>\n                </div>\n            )}\n        </div>\n    );\n});\n","import React, { useCallback, useRef, useState } from 'react';\nimport { ObjectLinks } from './viewport/ObjectLinks';\nimport { EditorTile } from './viewport/EditorTile';\nimport PixiStage from '../game/PixiStage';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    registryItems,\n    hoverIndex,\n    highlightedIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    handleResizeStart,\n    handleMoveStart,\n    setIsDragging,\n    selectedTile,\n    weatherRain,\n    weatherSnow,\n    weatherClouds,\n    weatherFog,\n    weatherThunder,\n    weatherLavaRain,\n    weatherRadioactiveFog,\n    weatherMeteorRain,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages,\n    maps\n}) => {\n    const isEraserActive = activeTool === 'brush' && selectedTile === null;\n    const isBrushActive = activeTool === 'brush';\n    const isBucketActive = activeTool === 'bucket';\n    const tileSize = 32;\n    const gridRef = useRef(null);\n    const [cursorIndex, setCursorIndex] = useState(null);\n\n    const regions = React.useMemo(() => {\n        const res = [];\n        if (!objectMetadata) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            if (meta.width > 1 || meta.height > 1) {\n                const idx = parseInt(idxStr);\n                res.push({ \n                    idx, \n                    x: idx % mapWidth, \n                    y: Math.floor(idx / mapWidth), \n                    w: meta.width || 1, \n                    h: meta.height || 1 \n                });\n            }\n        }\n        return res;\n    }, [objectMetadata, mapWidth]);\n\n    const roomAreas = React.useMemo(() => {\n        const res = [];\n        if (!secretMapData || !objectMetadata || !showRoomMapContent) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                res.push({\n                    id: meta.linkedMapId,\n                    x: idx % mapWidth,\n                    y: Math.floor(idx / mapWidth),\n                    width: meta.width || 1,\n                    height: meta.height || 1,\n                    mapData: maps[meta.linkedMapId]\n                });\n            }\n        }\n        return res;\n    }, [secretMapData, objectMetadata, showRoomMapContent, maps, mapWidth]);\n\n    const getLayerColor = (layer, alpha = 0.5) => {\n        if (layer === 'tile') return `rgba(24, 144, 255, ${alpha})`;\n        if (layer === 'object') return `rgba(245, 34, 45, ${alpha})`;\n        if (layer === 'secret') return `rgba(114, 46, 209, ${alpha})`;\n        return `rgba(255, 255, 255, ${alpha})`;\n    };\n\n    const getGridStyles = () => {\n        let color = 'rgba(255, 255, 255, 0.15)';\n        let visible = showGrid;\n\n        if (isEraserActive) {\n            color = getLayerColor(activeLayer, 0.4);\n            visible = true;\n        } else if (isBrushActive || isBucketActive) {\n            color = getLayerColor(activeLayer, 0.25);\n            visible = true; // Auto-show grid when using drawing tools\n        }\n\n        return {\n            backgroundImage: visible ? `\n                linear-gradient(to right, ${color} 1px, transparent 1px),\n                linear-gradient(to bottom, ${color} 1px, transparent 1px)\n            ` : 'none',\n            backgroundSize: '32px 32px'\n        };\n    };\n\n    const getLayerFilter = useCallback((layer) => {\n        if (!isEraserActive) return 'none';\n        return activeLayer === layer ? 'none' : 'grayscale(100%) opacity(0.2) blur(2px)';\n    }, [isEraserActive, activeLayer]);\n\n    const getPlacementAnchor = useCallback((tile, layer) => {\n        if (!tile) return { x: 0, y: 0 };\n        if (layer !== 'object' && layer !== 'props') return { x: 0, y: 0 };\n        const width = Number(tile.width ?? 1);\n        const height = Number(tile.height ?? 1);\n        if (tile.type === 'decoration' && (width > 1 || height > 1)) {\n            return { x: Math.floor(width / 2), y: height - 1 };\n        }\n        return { x: 0, y: 0 };\n    }, []);\n\n    const handleGridMouseMove = useCallback((event) => {\n        const rect = gridRef.current ? gridRef.current.getBoundingClientRect() : event.currentTarget.getBoundingClientRect();\n        const localX = event.clientX - rect.left;\n        const localY = event.clientY - rect.top;\n        if (localX < 0 || localY < 0 || localX >= mapWidth * tileSize || localY >= mapHeight * tileSize) {\n            handleGridMouseLeave();\n            setCursorIndex(null);\n            return;\n        }\n        const gridX = Math.floor(localX / tileSize);\n        const gridY = Math.floor(localY / tileSize);\n        if (gridX < 0 || gridY < 0 || gridX >= mapWidth || gridY >= mapHeight) return;\n        const nextIndex = gridY * mapWidth + gridX;\n        setCursorIndex(prev => (prev === nextIndex ? prev : nextIndex));\n        handleGridMouseEnter(nextIndex);\n    }, [handleGridMouseEnter, handleGridMouseLeave, mapWidth, mapHeight, tileSize]);\n\n    const getOverlayColor = () => {\n        if (!isEraserActive) return 'transparent';\n        if (activeLayer === 'tile') return 'rgba(24, 144, 255, 0.25)'; // Blueish for blocks\n        if (activeLayer === 'object') return 'rgba(245, 34, 45, 0.25)'; // Reddish for objects\n        if (activeLayer === 'secret') return 'rgba(114, 46, 209, 0.25)'; // Purplish for secrets\n        return 'transparent';\n    };\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => handleGridMouseUp(hoverIndex)}\n            onMouseMove={handleGridMouseMove}\n            onContextMenu={(e) => e.preventDefault()}>\n            <div\n                style={{\n                    position: 'relative',\n                    width: mapWidth * tileSize,\n                    height: mapHeight * tileSize,\n                    overflow: 'hidden'\n                }}\n                onMouseLeave={() => {\n                    handleGridMouseLeave();\n                    setCursorIndex(null);\n                }}\n            >\n                \n                <ObjectLinks \n                    mapWidth={mapWidth} \n                    mapHeight={mapHeight} \n                    objectMapData={objectMapData} \n                    objectMetadata={objectMetadata} \n                />\n\n                {/* Room Map Content Overlay */}\n                {showRoomMapContent && roomAreas.map(room => (\n                    <div\n                        key={room.id}\n                        style={{\n                            position: 'absolute',\n                            left: room.x * 32,\n                            top: room.y * 32,\n                            width: room.width * 32,\n                            height: room.height * 32,\n                            zIndex: 6,\n                            pointerEvents: 'none',\n                            overflow: 'hidden',\n                            boxShadow: '0 0 15px rgba(0,0,0,0.5)',\n                            border: '2px solid #f39c12'\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={room.mapData.mapWidth}\n                            mapHeight={room.mapData.mapHeight}\n                            tileSize={32}\n                            tileMapData={room.mapData.tileMapData || []}\n                            objectMapData={room.mapData.objectMapData || []}\n                            secretMapData={room.mapData.secretMapData || []}\n                            objectMetadata={room.mapData.objectMetadata || {}}\n                            registryItems={registryItems}\n                            backgroundColor={room.mapData.selectedBackgroundColor}\n                            backgroundImage={room.mapData.selectedBackgroundImage}\n                            backgroundParallaxFactor={room.mapData.backgroundParallaxFactor}\n                            isEditor={true}\n                            mapType={room.mapData.type || 'room'}\n                        />\n                    </div>\n                ))}\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        backgroundImage: (selectedBackgroundUrl && showBackgroundImage && !isEraserActive) ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: (isEraserActive || !showBackgroundImage || !selectedBackgroundUrl) ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x', backgroundSize: 'auto 100%',\n                        zIndex: 0, pointerEvents: 'none'\n                    }}\n                />\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        backgroundColor: getOverlayColor(),\n                        zIndex: 5, pointerEvents: 'none',\n                        transition: 'background-color 0.3s ease'\n                    }}\n                />\n\n                {/* Top Grid Overlay */}\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        zIndex: 10, pointerEvents: 'none',\n                        ...getGridStyles()\n                    }}\n                />\n\n                {isBrushActive && selectedTile && (activeLayer === 'object' || activeLayer === 'props') && (cursorIndex !== null || hoverIndex !== null) && (\n                    (() => {\n                        const previewIndex = cursorIndex !== null ? cursorIndex : hoverIndex;\n                        const anchor = getPlacementAnchor(selectedTile, activeLayer);\n                        const gridX = previewIndex % mapWidth;\n                        const gridY = Math.floor(previewIndex / mapWidth);\n                        const previewX = (gridX - anchor.x) * tileSize;\n                        const previewY = (gridY - anchor.y) * tileSize;\n                        const previewW = Number(selectedTile.width ?? 1) * tileSize;\n                        const previewH = Number(selectedTile.height ?? 1) * tileSize;\n                        const renderOffsetX = Number(selectedTile?.render?.offsetX) || 0;\n                        const renderOffsetY = Number(selectedTile?.render?.offsetY) || 0;\n                        const overlapX = Number(selectedTile?.render?.overlapX) || 0;\n                        const overlapY = Number(selectedTile?.render?.overlapY) || 0;\n\n                        return (\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    top: 0,\n                                    left: 0,\n                                    width: mapWidth * tileSize,\n                                    height: mapHeight * tileSize,\n                                    overflow: 'hidden',\n                                    pointerEvents: 'none',\n                                    zIndex: 9\n                                }}\n                            >\n                                <div\n                                    style={{\n                                        position: 'absolute',\n                                        left: previewX + renderOffsetX - overlapX / 2,\n                                        top: previewY + renderOffsetY - overlapY / 2,\n                                        width: previewW + overlapX,\n                                        height: previewH + overlapY,\n                                        opacity: 0.6,\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center'\n                                    }}\n                                >\n                                    <AnimatedItem\n                                        textures={selectedTile.textures}\n                                        texture={selectedTile.texture}\n                                        speed={selectedTile.animationSpeed}\n                                        spriteSheet={selectedTile.spriteSheet}\n                                        style={{\n                                            width: '100%',\n                                            height: '100%',\n                                            objectFit: selectedTile.type === 'decoration' ? 'cover' : 'contain'\n                                        }}\n                                        alt={selectedTile.name}\n                                    />\n                                </div>\n                            </div>\n                        );\n                    })()\n                )}\n\n                {/* Weather Effects Overlay */}\n                {(weatherRain > 0 || weatherSnow > 0 || weatherClouds > 0 || weatherFog > 0 || weatherThunder > 0 || weatherLavaRain > 0 || weatherRadioactiveFog > 0 || weatherMeteorRain > 0) && (\n                    <div\n                        style={{\n                            position: 'absolute', top: 0, left: 0,\n                            width: mapWidth * 32, height: mapHeight * 32,\n                            zIndex: 15, pointerEvents: 'none',\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={[]}\n                            objectMapData={[]}\n                            registryItems={registryItems}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            renderLayers={['weather']}\n                            pointerEvents=\"none\"\n                        />\n                    </div>\n                )}\n\n                <div className=\"grid\"\n                    ref={gridRef}\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px', border: '1px solid #444', backgroundColor: 'transparent',\n                        position: 'relative', cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}\n                    onMouseMove={handleGridMouseMove}\n                    onContextMenu={(e) => e.preventDefault()}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        let dTileId = tileMapData[index];\n                        let dObjId = objectMapData[index];\n                        let dSecId = secretMapData?.[index];\n\n                        if (selection && previewPosition) {\n                            const { w, h } = selection;\n                            const px = previewPosition.x;\n                            const py = previewPosition.y;\n                            if (x >= px && x < px + w && y >= py && y < py + h) {\n                                const idx = (y - py) * w + (x - px);\n                                dTileId = selection.tileData[idx];\n                                dObjId = selection.objectData[idx];\n                                dSecId = selection.secretData?.[idx];\n                            }\n                        }\n\n                        const tileObj = dTileId ? registryItems.find(r => r.id === dTileId) : null;\n                        const objObj = dObjId ? registryItems.find(r => r.id === dObjId) : null;\n                        const secretObj = dSecId ? registryItems.find(r => r.id === dSecId) : null;\n\n                        let borderStyle = 'none';\n                        let bgStyle = 'transparent';\n\n                        const layerColor = getLayerColor(activeLayer, 1);\n\n                        if (activeTool === 'brush' && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) {\n                                borderStyle = `1px dashed ${layerColor}`;\n                                if (isEraserActive) bgStyle = 'rgba(255, 0, 0, 0.1)';\n                            }\n                        } else if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                            else if (hoverIndex === index) borderStyle = '2px solid orange';\n                        } else if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid blue';\n                        } else if (activeTool === 'area') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { \n                                    borderStyle = '1px dashed gold'; \n                                    bgStyle = 'rgba(255, 255, 0, 0.2)'; \n                                }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid gold';\n                        }\n\n                        if (highlightedIndex === index) { borderStyle = '3px solid gold'; bgStyle = 'rgba(255, 215, 0, 0.4)'; }\n                        \n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                borderStyle = '2px solid cyan'; bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red'; bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n\n                        const parentRegion = regions.find(r => x >= r.x && x < r.x + r.w && y >= r.y && y < r.y + r.h);\n\n                        return (\n                            <EditorTile \n                                key={index}\n                                index={index}\n                                x={x} y={y}\n                                activeTool={activeTool}\n                                tileObj={tileObj}\n                                objObj={objObj}\n                                secretObj={secretObj}\n                                objectMetadata={objectMetadata}\n                                isHighlighted={highlightedIndex === index || (parentRegion && highlightedIndex === parentRegion.idx)}\n                                parentRegionIndex={parentRegion ? parentRegion.idx : null}\n                                borderStyle={borderStyle}\n                                bgStyle={bgStyle}\n                                handleGridMouseDown={handleGridMouseDown}\n                                handleGridMouseEnter={handleGridMouseEnter}\n                                handleResizeStart={handleResizeStart}\n                                handleMoveStart={handleMoveStart}\n                                filter={getLayerFilter}\n                                mapType={mapType}\n                                isRoomAreaVisible={isRoomAreaVisible}\n                                showRoomMapContent={showRoomMapContent}\n                                showMessages={showMessages}\n                            />\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const EditorToolsContainer = styled.div`\n    display: contents;\n`;\n\nexport const HeaderBar = styled.div`\n    padding: 0 15px;\n    background-color: #222;\n    border-bottom: none;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 60px;\n    box-sizing: border-box;\n    color: #fff;\n    z-index: 1105;\n    position: relative;\n\n    &::after {\n        content: \"\";\n        position: absolute;\n        left: 60px;\n        right: 0;\n        bottom: 0;\n        height: 1px;\n        background-color: #000;\n        pointer-events: none;\n    }\n`;\n\nexport const ToolsSection = styled.div`\n    display: flex;\n    gap: 15px;\n    align-items: center;\n`;\n\nexport const ToolsGroup = styled.div`\n    display: flex;\n    gap: 10px;\n    align-items: center;\n`;\n\nexport const ToolsInnerGroup = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsRow = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsEditorButton = styled.button`\n    min-width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : (props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : (props.$variant === 'danger' ? '#dc3545' : (props.$variant === 'secondary' ? '#f0f0f0' : '#333'))))};\n    color: ${props => props.$variant === 'secondary' ? '#333' : '#fff'};\n    border: 1px solid ${props => props.$active ? '#1E88E5' : (props.$variant === 'play' ? '#388E3C' : (props.$variant === 'pause' ? '#F57C00' : (props.$variant === 'danger' ? '#c82333' : (props.$variant === 'secondary' ? '#ccc' : '#fff'))))};\n    border-radius: 4px;\n    font-size: ${props => props.$small ? '14px' : '20px'};\n    font-weight: ${props => props.$variant === 'play' || props.$variant === 'pause' ? 'bold' : 'normal'};\n    line-height: 1;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: ${props => props.$square ? '0' : '0 15px'};\n    width: ${props => props.$square ? '40px' : 'auto'};\n    outline: none;\n    user-select: none;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : (props.$variant === 'play' ? '#45a049' : (props.$variant === 'pause' ? '#fb8c00' : (props.$variant === 'danger' ? '#bd2130' : (props.$variant === 'secondary' ? '#e0e0e0' : '#444'))))};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n\n    span {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n`;\n\nexport const StrikeThrough = styled.div`\n    position: absolute;\n    width: 100%;\n    height: 2px;\n    background-color: #f5222d;\n    transform: rotate(-45deg);\n    top: 50%;\n    left: 0;\n    z-index: 2;\n    pointer-events: none;\n`;\n\nexport const LayerIndicator = styled.div`\n    padding: 0 12px;\n    height: 40px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    font-size: 11px;\n    font-weight: 800;\n    text-transform: uppercase;\n    margin-right: 15px;\n    margin-left: 15px;\n    white-space: nowrap;\n    border: 1px solid;\n    box-sizing: border-box;\n    background-color: ${props => props.$bgColor || '#e6f7ff'};\n    border-color: ${props => props.$borderColor || '#91d5ff'};\n    color: ${props => props.$textColor || '#1890ff'};\n`;\n\nexport const BgColorContainer = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n`;\n\nexport const BgColorInputWrapper = styled.div`\n    position: relative;\n    display: flex;\n    align-items: center;\n`;\n\nexport const BgColorInput = styled.input`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    opacity: ${props => props.disabled ? 0.4 : 1};\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n`;\n\nexport const BgTransparentButton = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &::after {\n        content: \"\";\n        width: 100%;\n        height: 100%;\n        background-image: \n            linear-gradient(45deg, #ccc 25%, transparent 25%), \n            linear-gradient(-45deg, #ccc 25%, transparent 25%), \n            linear-gradient(45deg, transparent 75%, #ccc 75%), \n            linear-gradient(-45deg, transparent 75%, #ccc 75%);\n        background-size: 8px 8px;\n        background-position: 0 0, 0 4px, 4px 4px, 4px 0;\n        background-color: #fff;\n        opacity: 0.8;\n        border-radius: 2px;\n    }\n`;\n\nexport const PlayButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const PlayButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : '#333')};\n    color: #fff;\n    font-size: 18px;\n    box-sizing: border-box;\n`;\n\nexport const InfoContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    align-items: flex-start;\n    color: #bbb;\n    margin-left: auto;\n`;\n\nexport const InfoItem = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nexport const InfoLabel = styled.span`\n    font-size: 11px;\n    text-transform: uppercase;\n    opacity: 0.8;\n`;\n\nexport const InfoValue = styled.span`\n    color: #fff;\n    font-size: 12px;\n`;\n\nexport const EraserButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    //cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const EraserButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$active ? (props.$textColor || '#1890ff') : (props.$bgColor || '#f0f0f0')};\n    color: ${props => props.$active ? '#fff' : (props.$textColor || '#000')};\n    font-size: 11px;\n    font-weight: bold;\n    border: ${props => props.$active ? '1px solid #fff' : 'none'};\n    box-sizing: border-box;\n`;\n\nexport const SelectionActions = styled.div`\n    display: flex;\n    gap: 5px;\n    margin-left: 5px;\n    border-left: 1px solid #ccc;\n    padding-left: 5px;\n`;\n\nexport const ConfirmButton = styled(ToolsEditorButton)`\n    background-color: #e6f7ff;\n    color: #1890ff;\n    \n    &:hover {\n        background-color: #bae7ff;\n    }\n`;\n\nexport const CancelButton = styled(ToolsEditorButton)`\n    background-color: #fff1f0;\n    color: #f5222d;\n\n    &:hover {\n        background-color: #ffccc7;\n    }\n`;\n\nexport const GridIcon = styled.span`\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n`;\n","import styled from 'styled-components';\n\n/*\n* Container*/\nexport const SidebarContainer = styled.div`\n    width: 60px;\n    height: 100%;\n    background-color: #222;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding-top: 10px;\n    z-index: 1100;\n    border-right: 1px solid #000;\n    flex-shrink: 0;\n    overflow-y: auto;\n\n    &::-webkit-scrollbar {\n        width: 0px;\n        background: transparent;\n    }\n    \n    -ms-overflow-style: none;\n    scrollbar-width: none;\n`;\n\nexport const ElementEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const PanelContainer = styled.div`\n    position: absolute;\n    left: 60px;\n    top: 60px;\n    width: 320px;\n    height: calc(100% - 60px);\n    background-color: #fff;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    z-index: 1090;\n    box-shadow: 4px 0 10px rgba(0,0,0,0.2);\n    \n    /* Animation settings */\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;\n    transform: ${props => props.$isOpen ? 'translateX(0)' : 'translateX(-110%)'};\n    opacity: ${props => props.$isOpen ? '1' : '0'};\n    pointer-events: ${props => props.$isOpen ? 'all' : 'none'};\n`;\n\nexport const PanelHeader = styled.div`\n    padding: 8px 15px;\n    background-color: #f0f0f0;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 32px;\n    box-sizing: border-box;\n    color: #333;\n\n    span {\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n`;\n\nexport const PanelBody = styled.div`\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n`;\n\nexport const CloseButton = styled.button`\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 16px;\n    padding: 0 5px;\n    color: #666;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    outline: none;\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nexport const OperationButton = styled.button`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: ${props => props.$danger ? '#d32f2f' : '#000'};\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n    outline: none;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n\n// Also exporting as a label for file input usage in OperationsPanel\nexport const OperationLabel = styled.label`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: #000;\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n","import React from 'react';\nimport { ToolsEditorButton } from '../styles/EditorToolsButton';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    tempMapDescription,\n    setTempMapDescription,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', borderRadius: '8px',\n                boxShadow: '0 8px 24px rgba(0,0,0,0.2)', width: '320px',\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\n            }}>\n                <div style={{\n                    padding: '12px 15px',\n                    borderBottom: '2px solid #eee',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                }}>\n                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 'bold', color: '#333' }}>Create New Map</h3>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </div>\n\n                <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Map Name:</label>\n                        <input\n                            type=\"text\"\n                            value={tempMapName}\n                            onChange={(e) => setTempMapName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Creator Nickname:</label>\n                        <input\n                            type=\"text\"\n                            value={tempCreatorName}\n                            onChange={(e) => setTempCreatorName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Description:</label>\n                        <textarea\n                            value={tempMapDescription}\n                            onChange={(e) => setTempMapDescription(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box', minHeight: '60px', resize: 'vertical' }}\n                        />\n                    </div>\n\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                        <ToolsEditorButton onClick={onClose} $variant=\"secondary\" $small>\n                            Cancel\n                        </ToolsEditorButton>\n                        <ToolsEditorButton onClick={() => confirmNewMap(tempMapName, tempCreatorName, tempMapDescription)} $variant=\"play\" $small>\n                            Create\n                        </ToolsEditorButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { BUILT_IN_MAPS } from '../../../../constants/builtInMaps';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalHeader = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    font-size: 24px;\n    color: #333;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nexport const BuiltInMapsModal = ({ isOpen, onClose, onSelect }) => {\n    if (!isOpen) return null;\n\n    return (\n        <ModalOverlay onClick={onClose}>\n            <ModalContent onClick={e => e.stopPropagation()}>\n                <ModalHeader>\n                    <ModalTitle>Select a Built-in Map to Edit</ModalTitle>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </ModalHeader>\n                \n                <MapList>\n                    {BUILT_IN_MAPS.map((map, index) => {\n                        const isV2 = map.meta?.version === \"2.0\";\n                        const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                        const author = map.meta?.author || \"Unknown\";\n                        const description = map.meta?.description || \"\";\n                        \n                        let sizeInfo = \"\";\n                        let subMapInfo = \"\";\n\n                        if (isV2 && map.maps) {\n                            const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                            if (mainMap) {\n                                sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                            }\n                            \n                            const mapValues = Object.values(map.maps);\n                            const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                            const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                            \n                            subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                        } else {\n                            sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                        }\n\n                        return (\n                            <MapCard key={index} onClick={() => {\n                                onSelect(map);\n                                onClose();\n                            }}>\n                                <div>\n                                    <MapTitle>{projectName}</MapTitle>\n                                    <MapAuthor>By: {author}</MapAuthor>\n                                </div>\n                                {description && (\n                                    <MapDescription title={description}>\n                                        {description}\n                                    </MapDescription>\n                                )}\n                                <MapInfo>\n                                    <div>Size: {sizeInfo}{subMapInfo}</div>\n                                </MapInfo>\n                            </MapCard>\n                        );\n                    })}\n                </MapList>\n            </ModalContent>\n        </ModalOverlay>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nlet topZIndex = 1002;\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [position] = useState(defaultPosition);\n    const [zIndex, setZIndex] = useState(() => {\n        topZIndex += 1;\n        return topZIndex;\n    });\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    const lastHeightRef = useRef(0);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            if (height !== lastHeightRef.current) {\n                lastHeightRef.current = height;\n                onHeightChange(height);\n            }\n        }\n    });\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            topZIndex += 1;\n            setZIndex(topZIndex);\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#fff',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n                zIndex: zIndex,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh',\n                overflow: 'hidden'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '12px 15px',\n                    backgroundColor: '#fff',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '18px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '2px solid #eee',\n                    color: '#333'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0,\n                            color: '#333'\n                        }}\n                        title={isMinimized ? t('EDITOR_SCENE_WINDOW_MAXIMIZE') : t('EDITOR_SCENE_WINDOW_MINIMIZE')}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            color: '#333',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title={t('EDITOR_SCENE_WINDOW_CLOSE')}\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '15px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const EditorMapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(5, Math.min(100, startSize.width + blocksX));\n            const newHeight = Math.max(5, Math.min(100, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                {t('EDITOR_SCENE_RESIZER_LABEL')}{' '}\n                <span style={{ color: '#4CAF50' }}>{mapWidth} x {mapHeight}</span>{' '}\n                {t('EDITOR_SCENE_RESIZER_BLOCKS')}\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: 2,\n                        right: 2,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 {t('EDITOR_SCENE_RESIZER_HINT_LINE1')}<br/>\n                {t('EDITOR_SCENE_RESIZER_HINT_LINE2')}\n            </div>\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundColor\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = backgroundColor || '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.lava_waterfall) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.radioactive_waterfall) {\n                                ctx.fillStyle = '#32cd32';\n                            } else if (tile.flags.waterfall) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.water) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.quicksand) {\n                                ctx.fillStyle = '#a6915b';\n                            } else if (tile.flags.radioactive_water) {\n                                ctx.fillStyle = '#32cd32';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n        // Draw connections between portals and targets\n        if (objectMetadata) {\n            const portals = [];\n            const targets = [];\n\n            for (let i = 0; i < mapWidth * mapHeight; i++) {\n                const id = objectMapData[i];\n                if (!id) continue;\n                const metadata = objectMetadata[i];\n                if (!metadata || metadata.triggerId === null || metadata.triggerId === undefined) continue;\n\n                const pos = {\n                    x: (i % mapWidth) * tileWidth + tileWidth / 2,\n                    y: Math.floor(i / mapWidth) * tileHeight + tileHeight / 2\n                };\n\n                if (id.includes('portal') && !id.includes('target')) {\n                    portals.push({ triggerId: metadata.triggerId, pos });\n                } else if (id.includes('target') || id === 'portal_target') {\n                    targets.push({ triggerId: metadata.triggerId, pos });\n                }\n            }\n\n            portals.forEach(portal => {\n                const target = targets.find(t => t.triggerId === portal.triggerId);\n                if (target) {\n                    ctx.beginPath();\n                    ctx.setLineDash([5, 3]);\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.moveTo(portal.pos.x, portal.pos.y);\n                    ctx.lineTo(target.pos.x, target.pos.y);\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n                }\n            });\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, objectMetadata, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useRef, useEffect, useMemo, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WorldView = ({\n    maps,\n    activeMapId,\n    switchMap,\n    registryItems,\n    currentMapData,\n    createMap,\n    deleteMap,\n    updateMapData,\n    onAddRoomArea,\n    showRoomMapContent\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const canvasRef = useRef(null);\n    const containerRef = useRef(null);\n    const mapLayoutsRef = useRef({});\n    const dragRef = useRef(null); // { id, startX, startY, mapStartX, mapStartY }\n\n    // Prepare all maps data, using live data for the active map\n    const allMaps = useMemo(() => {\n        const result = { ...maps };\n        if (currentMapData && currentMapData.id && result[currentMapData.id]) {\n            result[currentMapData.id] = {\n                ...result[currentMapData.id],\n                mapWidth: currentMapData.mapWidth,\n                mapHeight: currentMapData.mapHeight,\n                tileMapData: currentMapData.tileMapData,\n                objectMapData: currentMapData.objectMapData,\n                objectMetadata: currentMapData.objectMetadata,\n                selectedBackgroundColor: currentMapData.selectedBackgroundColor\n            };\n        }\n        return Object.values(result);\n    }, [maps, currentMapData]);\n\n    // Draw function\n    const draw = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        \n        // Settings\n        const baseTileSize = 4; // Each tile in world view\n        \n        // Sync mapLayoutsRef with allMaps, but preserve positions for maps being dragged\n        const layouts = mapLayoutsRef.current;\n        \n        // Remove layouts for deleted maps\n        const currentIds = new Set(allMaps.map(m => m.id));\n        Object.keys(layouts).forEach(id => {\n            if (!currentIds.has(id)) {\n                delete layouts[id];\n            }\n        });\n\n        allMaps.forEach(map => {\n            const isDragging = dragRef.current && dragRef.current.id === map.id;\n            const w = map.mapWidth * baseTileSize;\n            const h = map.mapHeight * baseTileSize;\n\n            if (!layouts[map.id]) {\n                layouts[map.id] = { x: map.worldX || 0, y: map.worldY || 0, w, h, map };\n            } else {\n                layouts[map.id].w = w;\n                layouts[map.id].h = h;\n                layouts[map.id].map = map;\n                // Update position from props ONLY if not currently dragging this map\n                if (!isDragging) {\n                    layouts[map.id].x = map.worldX || 0;\n                    layouts[map.id].y = map.worldY || 0;\n                }\n            }\n        });\n\n        // Clear\n        ctx.fillStyle = '#222';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Grid (optional but helpful)\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 1;\n        for (let x = 0; x < canvas.width; x += 50) {\n            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();\n        }\n        for (let y = 0; y < canvas.height; y += 50) {\n            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();\n        }\n\n        // 1. Draw Maps\n        Object.values(layouts).forEach(layout => {\n            const { x, y, w, h, map } = layout;\n            const tileW = w / map.mapWidth;\n            const tileH = h / map.mapHeight;\n\n            // Background\n            ctx.fillStyle = map.selectedBackgroundColor || '#87CEEB';\n            ctx.fillRect(x, y, w, h);\n\n            // Active indicator\n            if (map.id === activeMapId) {\n                ctx.strokeStyle = '#e3de0a';\n                ctx.lineWidth = 3;\n                ctx.strokeRect(x - 4, y - 4, w + 8, h + 8);\n            } else {\n                ctx.strokeStyle = '#555';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, w, h);\n            }\n\n            // Name\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px Arial';\n            ctx.fillText(map.name, x, y - 10);\n            ctx.font = '10px Arial';\n            ctx.fillStyle = '#aaa';\n            ctx.fillText(map.type, x, y + h + 12);\n\n            // Delete button (X)\n            if (map.id !== 'main') {\n                ctx.fillStyle = '#ff4d4f';\n                ctx.fillRect(x + w - 15, y - 25, 15, 15);\n                ctx.fillStyle = '#fff';\n                ctx.font = 'bold 12px Arial';\n                ctx.fillText('', x + w - 11, y - 13);\n            }\n\n            // Draw Tiles & Objects (simplified)\n            for (let i = 0; i < map.mapWidth * map.mapHeight; i++) {\n                const tx = (i % map.mapWidth) * tileW + x;\n                const ty = Math.floor(i / map.mapWidth) * tileH + y;\n\n                const tileId = map.tileMapData[i];\n                const objId = map.objectMapData[i];\n                const secretId = map.secretMapData ? map.secretMapData[i] : null;\n                const meta = map.objectMetadata ? map.objectMetadata[i] : null;\n\n                // If it's a room area and we want to show content\n                if (showRoomMapContent && secretId === 'room_area' && meta?.linkedMapId && layouts[meta.linkedMapId]) {\n                    const roomMap = layouts[meta.linkedMapId].map;\n                    const rW = meta.width || 1;\n                    const rH = meta.height || 1;\n                    const rAreaW = rW * tileW;\n                    const rAreaH = rH * tileH;\n                    const rTileW = rAreaW / roomMap.mapWidth;\n                    const rTileH = rAreaH / roomMap.mapHeight;\n\n                    // Room Background\n                    ctx.fillStyle = roomMap.selectedBackgroundColor || '#1a1a1a';\n                    ctx.fillRect(tx, ty, rAreaW, rAreaH);\n                    \n                    // Room Tiles (very simplified)\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n                    for (let ri = 0; ri < roomMap.mapWidth * roomMap.mapHeight; ri++) {\n                        if (roomMap.tileMapData[ri]) {\n                            ctx.fillRect(\n                                tx + (ri % roomMap.mapWidth) * rTileW,\n                                ty + Math.floor(ri / roomMap.mapWidth) * rTileH,\n                                Math.ceil(rTileW), Math.ceil(rTileH)\n                            );\n                        }\n                    }\n                    \n                    // Room Border\n                    ctx.strokeStyle = '#f39c12';\n                    ctx.lineWidth = 0.5;\n                    ctx.strokeRect(tx, ty, rAreaW, rAreaH);\n                } else {\n                    if (tileId) {\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (objId) {\n                        if (objId.includes('portal') && !objId.includes('target')) {\n                            ctx.fillStyle = '#007bff';\n                        } else if (objId.includes('target') || objId === 'portal_target') {\n                            ctx.fillStyle = '#ffc107';\n                        } else {\n                            ctx.fillStyle = '#dc3545';\n                        }\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (secretId === 'room_area') {\n                        ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                        ctx.strokeStyle = 'gold';\n                        ctx.lineWidth = 1;\n                        ctx.strokeRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                    }\n                }\n            }\n        });\n\n        // 2. Draw Connections\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 2;\n\n        Object.values(layouts).forEach(sourceLayout => {\n            const { map: sourceMap, x: sx, y: sy, w: sw, h: sh } = sourceLayout;\n            const tileW = sw / sourceMap.mapWidth;\n            const tileH = sh / sourceMap.mapHeight;\n\n            const metadata = sourceMap.objectMetadata || {};\n            \n            for (let i = 0; i < sourceMap.mapWidth * sourceMap.mapHeight; i++) {\n                const objId = sourceMap.objectMapData[i];\n                if (!objId) continue;\n                \n                const meta = metadata[i];\n                if (!meta) continue;\n\n                // Identify if this is a connection source\n                const isPortalSource = objId.includes('portal') && !objId.includes('target');\n                const objDef = registryItems.find(r => r.id === objId);\n                const isDoorSource = objDef && objDef.subtype === 'door';\n\n                if (!isPortalSource && !isDoorSource) continue;\n\n                // For portals we match by triggerId, for doors by spawnTriggerId\n                const linkId = isPortalSource ? meta.triggerId : meta.spawnTriggerId;\n                if (linkId === null || linkId === undefined) continue;\n\n                const targetMapId = meta.targetMapId || sourceMap.id;\n                const targetLayout = layouts[targetMapId];\n\n                if (targetLayout) {\n                    const { map: targetMap, x: tx, y: ty, w: tw, h: th } = targetLayout;\n                    const tTileW = tw / targetMap.mapWidth;\n                    const tTileH = th / targetMap.mapHeight;\n\n                    // Find target object in target map\n                    for (let j = 0; j < targetMap.mapWidth * targetMap.mapHeight; j++) {\n                        const tObjId = targetMap.objectMapData[j];\n                        if (!tObjId) continue;\n\n                        const tObjDef = registryItems.find(r => r.id === tObjId);\n                        const isTarget = tObjId.includes('target') || tObjId === 'portal_target';\n                        const isDoorTarget = tObjDef && tObjDef.subtype === 'door';\n\n                        if (!isTarget && !isDoorTarget) continue;\n\n                        const tMeta = targetMap.objectMetadata?.[j];\n                        if (tMeta && tMeta.triggerId === linkId) {\n                            // Link found!\n                            const startX = sx + (i % sourceMap.mapWidth) * tileW + tileW / 2;\n                            const startY = sy + Math.floor(i / sourceMap.mapWidth) * tileH + tileH / 2;\n                            const endX = tx + (j % targetMap.mapWidth) * tTileW + tTileW / 2;\n                            const endY = ty + Math.floor(j / targetMap.mapWidth) * tTileH + tTileH / 2;\n\n                            // Draw line\n                            ctx.beginPath();\n                            ctx.strokeStyle = (sourceMap.id === targetMap.id) ? '#fff' : '#00ff00';\n                            ctx.moveTo(startX, startY);\n                            \n                            if (sourceMap.id !== targetMap.id) {\n                                // Calculate mid points for a nicer curve\n                                const cp1X = startX + (endX - startX) * 0.25;\n                                const cp1Y = Math.min(startY, endY) - 100;\n                                const cp2X = startX + (endX - startX) * 0.75;\n                                const cp2Y = Math.min(startY, endY) - 100;\n                                ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, endX, endY);\n                            } else {\n                                ctx.lineTo(endX, endY);\n                            }\n                            ctx.stroke();\n\n                            // Arrow head\n                            const angle = Math.atan2(endY - startY, endX - startX);\n                            ctx.save();\n                            ctx.setLineDash([]);\n                            ctx.translate(endX, endY);\n                            ctx.rotate(angle);\n                            ctx.beginPath();\n                            ctx.moveTo(0, 0);\n                            ctx.lineTo(-10, -5);\n                            ctx.lineTo(-10, 5);\n                            ctx.closePath();\n                            ctx.fillStyle = ctx.strokeStyle;\n                            ctx.fill();\n                            ctx.restore();\n                            \n                            break;\n                        }\n                    }\n                }\n            }\n        });\n    }, [allMaps, activeMapId, showRoomMapContent]);\n\n    useEffect(() => {\n        draw();\n    }, [allMaps, activeMapId, draw, showRoomMapContent]);\n\n    const handleMouseDown = (e) => {\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const layouts = Object.values(mapLayoutsRef.current || {});\n        \n        // Check for delete button first\n        for (const layout of layouts) {\n            if (layout.map.id !== 'main') {\n                const btnX = layout.x + layout.w - 15;\n                const btnY = layout.y - 25;\n                if (x >= btnX && x <= btnX + 15 && y >= btnY && y <= btnY + 15) {\n                    if (window.confirm(t('EDITOR_SCENE_WORLD_DELETE_CONFIRM', { name: layout.map.name }))) {\n                        deleteMap(layout.map.id);\n                    }\n                    return;\n                }\n            }\n        }\n\n        // Check for map drag/select\n        for (const layout of layouts) {\n            if (x >= layout.x && x <= layout.x + layout.w &&\n                y >= layout.y && y <= layout.y + layout.h) {\n                \n                if (e.detail === 2) { // Double click to switch\n                    switchMap(layout.map.id);\n                } else {\n                    dragRef.current = {\n                        id: layout.map.id,\n                        startX: x,\n                        startY: y,\n                        mapStartX: layout.x,\n                        mapStartY: layout.y\n                    };\n                }\n                return;\n            }\n        }\n    };\n\n    const handleMouseMove = (e) => {\n        if (!dragRef.current) return;\n\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const dx = x - dragRef.current.startX;\n        const dy = y - dragRef.current.startY;\n\n        const newX = Math.max(0, dragRef.current.mapStartX + dx);\n        const newY = Math.max(0, dragRef.current.mapStartY + dy);\n\n        // Update local layout for immediate visual feedback\n        if (mapLayoutsRef.current[dragRef.current.id]) {\n            mapLayoutsRef.current[dragRef.current.id].x = newX;\n            mapLayoutsRef.current[dragRef.current.id].y = newY;\n            draw();\n        }\n    };\n\n    const handleMouseUp = (e) => {\n        if (!dragRef.current) return;\n\n        const layout = mapLayoutsRef.current[dragRef.current.id];\n        if (layout) {\n            updateMapData(dragRef.current.id, {\n                worldX: layout.x,\n                worldY: layout.y\n            });\n        }\n        \n        dragRef.current = null;\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '10px' }}>\n            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n                <button\n                    onClick={() => switchMap('main')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#1e88e5', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_MAIN')}\n                </button>\n                <button \n                    onClick={() => createMap('overworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_OVERWORLD')}\n                </button>\n                <button \n                    onClick={() => createMap('underworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#5D4037', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_UNDERWORLD')}\n                </button>\n                <button \n                    onClick={onAddRoomArea}\n                    title={t('EDITOR_SCENE_WORLD_ADD_ROOM_TITLE')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#f39c12', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + m<sup>2</sup>\n                </button>\n                <div style={{ marginLeft: 'auto', color: '#ccc', fontSize: '11px' }}>\n                    {t('EDITOR_SCENE_WORLD_HELP')}\n                </div>\n            </div>\n\n            <div ref={containerRef} style={{ width: '100%', height: '500px', backgroundColor: '#333', overflow: 'auto', borderRadius: '4px', position: 'relative', border: '1px solid #555' }}>\n                <canvas\n                    ref={canvasRef}\n                    width={2000}\n                    height={2000}\n                    style={{ display: 'block', cursor: dragRef.current ? 'grabbing' : 'grab' }}\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseLeave={handleMouseUp}\n                />\n                <div style={{ position: 'absolute', bottom: '10px', right: '10px', backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '5px 10px', borderRadius: '4px', fontSize: '11px', pointerEvents: 'none' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#fff', border: '1px dashed #fff' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTRA')}</div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#00ff00', border: '1px dashed #00ff00' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTER')}</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const BackgroundPanel = ({ \n    backgroundOptions, \n    selectedBackgroundImage, \n    setSelectedBackgroundImage, \n    selectedBackgroundColor, \n    backgroundParallaxFactor, \n    setBackgroundParallaxFactor \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '12px' }}>{t('EDITOR_SCENE_BACKGROUND_IMAGE')}</span>\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>\n                    <div onClick={() => setSelectedBackgroundImage(null)}\n                        style={{\n                            border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #2196F3',\n                            borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                            boxShadow: !selectedBackgroundImage ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                        }}\n                        title={t('EDITOR_SCENE_BACKGROUND_SOLID')}>\n                        <div style={{ width: '100%', height: '60px', background: selectedBackgroundColor, display: 'block', borderRadius: '4px' }} />\n                        <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: !selectedBackgroundImage ? 'bold' : 'normal' }}>{t('EDITOR_SCENE_BACKGROUND_SOLID')}</div>\n                    </div>\n                    {backgroundOptions.map((bg) => (\n                        <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                            style={{\n                                border: selectedBackgroundImage === bg.metaPath ? '2px solid #2196F3' : '1px solid #ccc',\n                                borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                boxShadow: selectedBackgroundImage === bg.metaPath ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                            }}\n                            title={bg.name}>\n                            <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '60px', objectFit: 'cover', display: 'block', borderRadius: '4px' }} />\n                            <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: selectedBackgroundImage === bg.metaPath ? 'bold' : 'normal' }}>{bg.name}</div>\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            <section style={{ backgroundColor: '#f9f9f9', padding: '15px', borderRadius: '8px', border: '1px solid #ddd' }}>\n                <div style={{ marginBottom: '0px' }}>\n                    <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>{t('EDITOR_SCENE_BACKGROUND_PARALLAX')}</label>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                            onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))}\n                            style={{ flex: 1 }} />\n                        <span style={{ fontSize: '13px', fontWeight: 'bold', minWidth: '35px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                    </div>\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nexport const MusicPanel = ({ \n    musicOptions, \n    selectedBackgroundMusic, \n    setSelectedBackgroundMusic \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>{t('EDITOR_SCENE_MUSIC_TITLE')}</span>\n                <select\n                    value={selectedBackgroundMusic || ''}\n                    onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                    style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ccc', fontSize: '13px', marginBottom: '10px' }}>\n                    <option value=\"\">{t('EDITOR_SCENE_MUSIC_NONE')}</option>\n                    {musicOptions.map(m => (\n                        <option key={m.name} value={m.metaPath}>{m.name}</option>\n                    ))}\n                </select>\n                <div style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\n                    {t('EDITOR_SCENE_MUSIC_STATUS', {\n                        status: selectedBackgroundMusic ? t('EDITOR_SCENE_MUSIC_STATUS_SELECTED') : t('EDITOR_SCENE_MUSIC_STATUS_SILENCE')\n                    })}\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WeatherPanel = ({\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const weatherItems = [\n        { label: t('EDITOR_SCENE_WEATHER_RAIN'), value: weatherRain, setter: setWeatherRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_LAVA_RAIN'), value: weatherLavaRain, setter: setWeatherLavaRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_SNOW'), value: weatherSnow, setter: setWeatherSnow, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_METEOR_RAIN'), value: weatherMeteorRain, setter: setWeatherMeteorRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_CLOUDS'), value: weatherClouds, setter: setWeatherClouds, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_FOG'), value: weatherFog, setter: setWeatherFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_RADIO_FOG'), value: weatherRadioactiveFog, setter: setWeatherRadioactiveFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_THUNDER'), value: weatherThunder, setter: setWeatherThunder, icon: '' },\n    ];\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px', padding: '5px' }}>\n            {weatherItems.map((item) => (\n                <div key={item.label} style={{ \n                    backgroundColor: '#f9f9f9', \n                    padding: '12px', \n                    borderRadius: '8px', \n                    border: '1px solid #ddd' \n                }}>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\n                        <span style={{ fontSize: '13px', fontWeight: 'bold' }}>\n                            {item.icon} {item.label}\n                        </span>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', color: '#2196F3' }}>\n                            {item.value}%\n                        </span>\n                    </div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input \n                            type=\"range\" \n                            min=\"0\" \n                            max=\"100\" \n                            step=\"1\" \n                            value={item.value}\n                            onChange={(e) => item.setter(parseInt(e.target.value))}\n                            style={{ flex: 1, cursor: 'pointer' }} \n                        />\n                    </div>\n                </div>\n            ))}\n            <div style={{ fontSize: '11px', color: '#888', fontStyle: 'italic', textAlign: 'center', marginTop: '5px' }}>\n                {t('EDITOR_SCENE_WEATHER_HINT')}\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const SceneEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const RightSidebarContainer = styled.div`\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    z-index: 1100;\n`;\n","import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { DraggableWindow } from './editorScene/DraggableWindow';\nimport { EditorMapResizer } from './editorScene/EditorMapResizer';\nimport { Minimap } from './editorScene/Minimap';\nimport { WorldView } from './editorScene/WorldView';\nimport { BackgroundPanel } from './editorScene/BackgroundPanel';\nimport { MusicPanel } from './editorScene/MusicPanel';\nimport { WeatherPanel } from './editorScene/WeatherPanel';\nimport { SceneEditorButton, RightSidebarContainer } from './styles/EditorSceneButtonStyle';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\n\nexport const EditorScene = ({\n    handleMapResize,\n    isResizeWindowOpen,\n    setIsResizeWindowOpen,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain,\n    // New props for multi-map\n    maps,\n    activeMapId,\n    switchMap,\n    createMap,\n    deleteMap,\n    updateMapData,\n    isWorldViewOpen,\n    setIsWorldViewOpen,\n    onAddRoomArea,\n    showRoomMapContent,\n    activeRoomIds\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [isMinimapOpen, setIsMinimapOpen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isBackgroundOpen, setIsBackgroundOpen] = useState(false);\n    const [isMusicOpen, setIsMusicOpen] = useState(false);\n\n    return (\n        <div style={{ display: 'contents' }}>\n            <BackgroundMusicPlayer \n                metaPath={selectedBackgroundMusic} \n                enabled={true} \n                volume={0.4} \n                isInsideRoom={activeRoomIds?.length > 0}\n            />\n            {/* Right side buttons */}\n            <RightSidebarContainer>\n                <SceneEditorButton onClick={() => setIsMinimapOpen(!isMinimapOpen)} $active={isMinimapOpen} title={t('EDITOR_SCENE_BUTTON_MAPS_MINIMAP')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsWorldViewOpen(!isWorldViewOpen)} $active={isWorldViewOpen} title={t('EDITOR_SCENE_BUTTON_WORLD_VIEW')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsBackgroundOpen(!isBackgroundOpen)} $active={isBackgroundOpen} title={t('EDITOR_SCENE_BUTTON_BACKGROUND')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsMusicOpen(!isMusicOpen)} $active={isMusicOpen} title={t('EDITOR_SCENE_BUTTON_MUSIC')}>\n                    <span style={{ color: '#fff' }}></span>\n                </SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsSettingsOpen(!isSettingsOpen)} $active={isSettingsOpen} title={t('EDITOR_SCENE_BUTTON_SETTINGS')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} $active={isResizeWindowOpen} title={t('EDITOR_SCENE_BUTTON_RESIZE')}></SceneEditorButton>\n            </RightSidebarContainer>\n\n            {/* Floating Windows */}\n            {isMinimapOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MINIMAP')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsMinimapOpen(false)}\n                >\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '5px' }}>\n                        <Minimap\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            backgroundColor={selectedBackgroundColor}\n                        />\n                        <div style={{ fontSize: '12px', color: '#ccc', textAlign: 'center' }}>\n                            {maps[activeMapId]?.name || t('EDITOR_SCENE_MINIMAP_CURRENT_MAP')}\n                        </div>\n                    </div>\n                </DraggableWindow>\n            )}\n\n            {isWorldViewOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_WORLD_VIEW')}\n                    defaultPosition={{ x: 100, y: 100 }}\n                    defaultWidth={800}\n                    isOpenDefault={true}\n                    onClose={() => setIsWorldViewOpen(false)}\n                >\n                    <WorldView \n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        registryItems={registryItems}\n                        createMap={createMap}\n                        deleteMap={deleteMap}\n                        updateMapData={updateMapData}\n                        onAddRoomArea={onAddRoomArea}\n                        showRoomMapContent={showRoomMapContent}\n                        // Current map live data\n                        currentMapData={{\n                            id: activeMapId,\n                            mapWidth,\n                            mapHeight,\n                            tileMapData,\n                            objectMapData,\n                            objectMetadata,\n                            selectedBackgroundColor\n                        }}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isBackgroundOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_BACKGROUND')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsBackgroundOpen(false)}\n                >\n                    <BackgroundPanel \n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isMusicOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MUSIC')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 300 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsMusicOpen(false)}\n                >\n                    <MusicPanel \n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isSettingsOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_SETTINGS')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 400 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsSettingsOpen(false)}\n                >\n                    <WeatherPanel \n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_RESIZE')}\n                    defaultPosition={{ x: 400, y: 100 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsResizeWindowOpen(false)}\n                >\n                    <EditorMapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={handleMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { OperationButton, OperationLabel } from '../styles/EditorElementsButtonStyle';\n\nexport const OperationsPanel = ({ \n    openNewMapModal, \n    saveMap, \n    loadMap, \n    openBuiltInModal,\n    clearMap, \n    mapName, \n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const inputStyle = {\n        width: '100%',\n        border: '1px solid transparent',\n        background: 'transparent',\n        padding: '4px 6px',\n        fontSize: '13px',\n        fontWeight: 'bold',\n        outline: 'none',\n        borderRadius: '4px',\n        boxSizing: 'border-box',\n        transition: 'all 0.2s ease',\n        cursor: 'pointer'\n    };\n\n    const handleFocus = (e) => {\n        e.target.style.borderColor = '#2196F3';\n        e.target.style.backgroundColor = '#fff';\n        e.target.style.cursor = 'text';\n    };\n\n    const handleBlur = (e) => {\n        e.target.style.borderColor = 'transparent';\n        e.target.style.backgroundColor = 'transparent';\n        e.target.style.cursor = 'pointer';\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\n            <div style={{ \n                padding: '15px', \n                backgroundColor: '#f9f9f9', \n                borderRadius: '8px', \n                border: '1px solid #ddd', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px' \n            }}>\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\n                    <OperationButton onClick={openNewMapModal} title={t('EDITOR_ELEMENTS_OP_NEW_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_NEW')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={saveMap} title={t('EDITOR_ELEMENTS_OP_SAVE_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_SAVE')}</span>\n                    </OperationButton>\n                    <OperationLabel title={t('EDITOR_ELEMENTS_OP_LOAD_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_LOAD')}</span>\n                        <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} />\n                    </OperationLabel>\n                    <OperationButton onClick={openBuiltInModal} title={t('EDITOR_ELEMENTS_OP_BUILT_IN_MAPS_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_BUILT_IN')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={clearMap} $danger title={t('EDITOR_ELEMENTS_OP_CLEAR_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_CLEAR')}</span>\n                    </OperationButton>\n                </div>\n            </div>\n\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_MAP_NAME_LABEL')}</label>\n                    <input \n                        value={mapName} \n                        onChange={(e) => setMapName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_MAP_NAME_TITLE')}\n                    />\n                </div>\n                \n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_AUTHOR_LABEL')}</label>\n                    <input \n                        value={creatorName} \n                        onChange={(e) => setCreatorName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_AUTHOR_TITLE')}\n                    />\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_DESCRIPTION_LABEL')}</label>\n                    <textarea \n                        value={mapDescription} \n                        onChange={(e) => setMapDescription(e.target.value)}\n                        style={{ ...inputStyle, fontWeight: 'normal', minHeight: '60px', resize: 'vertical' }}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_DESCRIPTION_TITLE')}\n                    />\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const CollapsiblePanel = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '4px 6px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none', lineHeight: 1.1, minHeight: '20px' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { CollapsiblePanel } from './CollapsiblePanel';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport i18n from '../../../../i18n/i18n';\nimport { getTutorialChapters, getTutorialItems } from '../../../../i18n/tutorialMessages';\n\nexport const PalettePanel = ({ \n    isPlayMode, \n    category,\n    blocks, \n    liquids, \n    entities, \n    decorations, \n    items, \n    interactables, \n    hazards, \n    secrets, \n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    objectMetadata,\n    setObjectMetadata,\n    objectMapData,\n    highlightedIndex,\n    setHighlightedIndex,\n    registryItems,\n    handlePaletteSelect, \n    selectedTile \n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [selectedChapter, setSelectedChapter] = useState('');\n\n    const currentLang = i18n?.language || 'en';\n    const tutorialChapters = useMemo(() => getTutorialChapters(currentLang), [currentLang]);\n    const tutorialItems = useMemo(\n        () => (selectedChapter ? getTutorialItems(selectedChapter, currentLang) : []),\n        [selectedChapter, currentLang]\n    );\n\n    useEffect(() => {\n        if (!selectedChapter && tutorialChapters.length > 0) {\n            setSelectedChapter(tutorialChapters[0]);\n        } else if (selectedChapter && !tutorialChapters.includes(selectedChapter)) {\n            setSelectedChapter(tutorialChapters[0] || '');\n        }\n    }, [tutorialChapters, selectedChapter]);\n\n    const getLiquidLabel = ({\n        isLavaWaterfall,\n        isLava,\n        isRadioactiveWaterfall,\n        isRadioactive,\n        isWater,\n        isWaterfall,\n        isQuicksand\n    }) => {\n        if (isLavaWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LFALL');\n        if (isLava) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LAVA');\n        if (isRadioactiveWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RADFALL');\n        if (isRadioactive) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RAD');\n        if (isWater) return t('EDITOR_ELEMENTS_LIQUID_LABEL_WATER');\n        if (isWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_FALL');\n        if (isQuicksand) return t('EDITOR_ELEMENTS_LIQUID_LABEL_QUICK');\n        return t('EDITOR_ELEMENTS_LIQUID_LABEL_LIQ');\n    };\n\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const editorIcon = item.editorIcon;\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isQuicksand = !!(item.flags && item.flags.quicksand);\n        const isWaterfall = !!(item.flags && item.flags.waterfall);\n        const isLavaWaterfall = !!(item.flags && item.flags.lava_waterfall);\n        const isRadioactive = !!(item.flags && item.flags.radioactive);\n        const isRadioactiveWaterfall = !!(item.flags && item.flags.radioactive_waterfall);\n        const isSecret = item.type === 'secret';\n        const isWeatherTrigger = item.type === 'weather_trigger';\n        const isMessageTrigger = item.type === 'message_trigger';\n        \n        const swatchStyle = isLavaWaterfall\n            ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isWater || isWaterfall ? { background: 'linear-gradient(180deg,#3a7fb8,#5ba3d9)' }\n            : (isQuicksand ? { background: 'linear-gradient(180deg,#a6915b,#7d6d42)' }\n            : (isRadioactive || isRadioactiveWaterfall ? { background: 'linear-gradient(180deg,#1a5c1a,#32cd32)' }\n            : { background: '#eee' }))));\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.displayName || item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColorInEditor || item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.editorIcon || (item.subtype === 'above' ? t('EDITOR_ELEMENTS_SECRET_ABOVE') : t('EDITOR_ELEMENTS_SECRET_BELOW'))}\n                    </div>\n                ) : (isWeatherTrigger || isMessageTrigger) ? (\n                    hasImage ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            spriteSheet={item.spriteSheet}\n                            style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                            alt={item.name}\n                        />\n                    ) : (\n                        (() => {\n                            const iconText = item.editorIcon || (item.i18nMessage ? 'i18n' : '');\n                            return (\n                        <div style={{\n                            width: '100%', height: '100%', borderRadius: 2,\n                            display: 'flex', alignItems: 'center', justifyContent: 'center',\n                            background: isMessageTrigger ? '#fff9c4' : '#f0f4f8', \n                            border: isMessageTrigger ? '1px solid #fbc02d' : '1px solid #d1d9e6',\n                            color: '#333', fontSize: (iconText === 'i18n' ? '12px' : '18px'), fontWeight: 700\n                        }}>\n                            {iconText}\n                        </div>\n                            );\n                        })()\n                    )\n                ) : editorIcon ? (\n                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>\n                        {editorIcon}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        spriteSheet={item.spriteSheet}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid\n                            ? getLiquidLabel({\n                                isLavaWaterfall,\n                                isLava,\n                                isRadioactiveWaterfall,\n                                isRadioactive,\n                                isWater,\n                                isWaterfall,\n                                isQuicksand\n                            })\n                            : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    if (isPlayMode) {\n        return (\n            <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                {t('EDITOR_ELEMENTS_PALETTE_DISABLED')}\n            </div>\n        );\n    }\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            {category === 'blocks' && (() => {\n                const getBlockGroup = (b) => {\n                    if (b.editor?.group) return b.editor.group;\n                    const name = (b.id || b.name || '').toLowerCase();\n                    if (name.includes('brick')) return 'bricks';\n                    if (name.includes('diorite') || name.includes('stone')) return 'stone';\n                    if (name.includes('metal')) return 'metal';\n                    if (name.includes('wood')) return 'wood';\n                    return 'ground';\n                };\n\n                const groupOrder = [\n                    { key: 'ground', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_GROUND'), color: 'blue', open: true },\n                    { key: 'bricks', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_BRICKS'), color: 'blue', open: true },\n                    { key: 'stone', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_STONE'), color: 'blue', open: true },\n                    { key: 'metal', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_METAL'), color: 'blue', open: true },\n                    { key: 'wood', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_WOOD'), color: 'blue', open: true }\n                ];\n\n                const withGroups = blocks.map(b => ({\n                    item: b,\n                    group: getBlockGroup(b)\n                }));\n\n                const sortBlocks = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(b => b.group === group.key).sort(sortBlocks);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(b => renderPaletteItem(b.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(b => !groupOrder.some(g => g.key === b.group)).sort(sortBlocks);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(b => renderPaletteItem(b.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'liquids' && (() => {\n                const getLiquidGroup = (li) => {\n                    if (li.editor?.group) return li.editor.group;\n                    if (li.flags?.quicksand) return 'quicksand';\n                    if (li.flags?.lava || li.flags?.lava_waterfall) return 'lava';\n                    if (li.flags?.radioactive || li.flags?.radioactive_waterfall) return 'radiation';\n                    if (li.flags?.water || li.flags?.waterfall) return 'water';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'quicksand', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_QUICKSAND'), color: 'goldenrod', open: true },\n                    { key: 'water', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_WATER'), color: 'blue', open: true },\n                    { key: 'lava', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_LAVA'), color: 'orange', open: true },\n                    { key: 'radiation', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_RADIATION'), color: 'green', open: true }\n                ];\n\n                const withGroups = liquids.map(li => ({\n                    item: li,\n                    group: getLiquidGroup(li)\n                }));\n\n                const sortLiquids = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(li => li.group === group.key).sort(sortLiquids);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(li => renderPaletteItem(li.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(li => !groupOrder.some(g => g.key === li.group)).sort(sortLiquids);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_LIQUIDS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_LIQUIDS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(li => renderPaletteItem(li.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'decorations' && (() => {\n                const getDecorationGroup = (d) => {\n                    if (d.editor?.group) return d.editor.group;\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'trees', title: t('EDITOR_ELEMENTS_DECORATIONS_GROUP_TREES'), color: 'green', open: true }\n                ];\n\n                const withGroups = decorations.map(d => ({\n                    item: d,\n                    group: getDecorationGroup(d)\n                }));\n\n                const sortDecorations = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(d => d.group === group.key).sort(sortDecorations);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(d => renderPaletteItem(d.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(d => !groupOrder.some(g => g.key === d.group)).sort(sortDecorations);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(d => renderPaletteItem(d.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'entities' && (() => {\n                const getEntityGroup = (e) => {\n                    if (e.editor?.group) return e.editor.group;\n                    const name = (e.id || e.name || '').toLowerCase();\n                    if (name.includes('player')) return 'player';\n                    if (name.includes('fish') || name.includes('animal')) return 'animals';\n                    return 'enemies';\n                };\n\n                const groupOrder = [\n                    { key: 'player', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_PLAYER'), color: 'red', open: true },\n                    { key: 'animals', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ANIMALS'), color: 'red', open: true },\n                    { key: 'enemies', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ENEMIES'), color: 'red', open: true }\n                ];\n\n                const withGroups = entities.map(e => ({\n                    item: e,\n                    group: getEntityGroup(e)\n                }));\n\n                const sortEntities = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(e => e.group === group.key).sort(sortEntities);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(e => renderPaletteItem(e.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(e => !groupOrder.some(g => g.key === e.group)).sort(sortEntities);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ENTITIES_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ENTITIES_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(e => renderPaletteItem(e.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'items' && (() => {\n                const getItemGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.effect?.health) return 'health';\n                    if (i.effect?.fireball) return 'ammunition';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'health', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_HEALTH'), color: 'green', open: true },\n                    { key: 'ammunition', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_AMMUNITION'), color: 'green', open: true }\n                ];\n\n                const withGroups = items.map(i => ({\n                    item: i,\n                    group: getItemGroup(i)\n                }));\n\n                const sortItems = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(i => i.group === group.key).sort(sortItems);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortItems);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ITEMS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ITEMS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'interactables' && (() => {\n                const getInteractableGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.subtype === 'door') return 'entrances';\n                    if (i.subtype === 'ladder') return 'ledders';\n                    if (i.subtype === 'platform' || i.subtype === 'arrow') return 'platforms';\n                    if ((i.id || '').includes('portal') || (i.name || '').includes('portal')) return 'ports';\n                    if (i.subtype === 'end') return 'ends';\n                    const name = (i.id || i.name || '').toLowerCase();\n                    if (name.includes('berry')) return 'harvestables';\n                    if (name.includes('stone') || name.includes('wooden_box')) return 'physics';\n                    if (name.includes('ice')) return 'blocks';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'harvestables', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_HARVESTABLES'), color: 'purple', open: true },\n                    { key: 'physics', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PHYSIC'), color: 'purple', open: true },\n                    { key: 'entrances', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENTRANCES'), color: 'purple', open: true },\n                    { key: 'platforms', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PLATFORMS'), color: 'purple', open: true },\n                    { key: 'ledders', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_LEDDERS'), color: 'purple', open: true },\n                    { key: 'ports', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PORTS'), color: 'purple', open: true },\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_BLOCKS'), color: 'purple', open: true },\n                    { key: 'ends', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENDS'), color: 'purple', open: true }\n                ];\n\n                const withGroups = interactables.map(i => ({\n                    item: i,\n                    group: getInteractableGroup(i)\n                }));\n\n                const sortInteractables = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(i => i.group === group.key).sort(sortInteractables);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortInteractables);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'hazards' && (() => {\n                const getHazardGroup = (h) => {\n                    if (h.editor?.group) return h.editor.group;\n                    if (h.collision) return 'blocks';\n                    return 'obstacles';\n                };\n\n                const groupOrder = [\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_BLOCKS'), color: 'orange', open: true },\n                    { key: 'obstacles', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_OBSTACLES'), color: 'brown', open: true }\n                ];\n\n                const withGroups = hazards.map(h => ({\n                    item: h,\n                    group: getHazardGroup(h)\n                }));\n\n                const sortHazards = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(h => h.group === group.key).sort(sortHazards);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(h => renderPaletteItem(h.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(h => !groupOrder.some(g => g.key === h.group)).sort(sortHazards);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_HAZARDS_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(h => renderPaletteItem(h.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'secrets' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_OPEN_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'open').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n                    \n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_SECRET_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype !== 'open' && s.subtype !== 'room' && s.subtype !== 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_CRACKABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {crackableWalls && crackableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_PUSHABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {pushableWalls && pushableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_ANIMAL_TRIGGERS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'weather' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'rain').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_SNOW')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'snow').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_CLOUDS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'clouds').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'fog').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_THUNDER')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'thunder').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_LAVA_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'lavaRain').map(w => renderPaletteItem(w, 'red', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RADIO_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'radioactiveFog').map(w => renderPaletteItem(w, 'green', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_METEOR_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'meteorRain').map(w => renderPaletteItem(w, 'orange', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'messages' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_MESSAGES_TITLE')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {messages && messages.map(m => renderPaletteItem(m, 'gold', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n                    {selectedTile && (selectedTile.i18nMessage || selectedTile.type === 'message_trigger') && (\n                        <CollapsiblePanel title={t('EDITOR_ELEMENTS_I18N_TITLE')} isOpenDefault={true}>\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>\n                                    {tutorialChapters.map(ch => (\n                                        <button\n                                            key={ch}\n                                            onClick={() => setSelectedChapter(ch)}\n                                            style={{\n                                                padding: '4px 8px',\n                                                fontSize: '11px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ccc',\n                                                background: ch === selectedChapter ? '#f4c542' : '#f0f0f0',\n                                                cursor: 'pointer'\n                                            }}\n                                        >\n                                            {ch}\n                                        </button>\n                                    ))}\n                                </div>\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '6px', maxHeight: '200px', overflowY: 'auto' }}>\n                                    {tutorialItems.map(item => (\n                                        <button\n                                            key={`${selectedChapter}_${item.id}`}\n                                            onClick={() => {\n                                                let targetIndex = highlightedIndex;\n                                                if ((targetIndex === null || targetIndex === undefined) && selectedTile?.id && objectMapData) {\n                                                    const idx = objectMapData.findIndex(id => id === selectedTile.id);\n                                                    if (idx >= 0) {\n                                                        targetIndex = idx;\n                                                        if (setHighlightedIndex) setHighlightedIndex(idx);\n                                                    }\n                                                }\n                                                if (targetIndex === null || targetIndex === undefined) return;\n                                                const objId = objectMapData?.[targetIndex];\n                                                const objDef = registryItems?.find(r => r.id === objId);\n                                                if (!objDef || objDef.type !== 'message_trigger') return;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [targetIndex]: {\n                                                        ...prev[targetIndex],\n                                                        i18nChapter: selectedChapter,\n                                                        i18nId: item.id,\n                                                        message: ''\n                                                    }\n                                                }));\n                                            }}\n                                            style={{\n                                                display: 'flex',\n                                                alignItems: 'center',\n                                                justifyContent: 'space-between',\n                                                gap: '8px',\n                                                padding: '6px 8px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ddd',\n                                                background: '#fff',\n                                                cursor: 'pointer',\n                                                textAlign: 'left'\n                                            }}\n                                        >\n                                            <span style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_I18N_ID', { id: item.id })}</span>\n                                            <span style={{ fontSize: '11px', color: '#222', flex: 1 }}>{item.text}</span>\n                                        </button>\n                                    ))}\n                                </div>\n                                {(highlightedIndex === null || highlightedIndex === undefined) && (\n                                    <div style={{ fontSize: '11px', color: '#888' }}>\n                                        {t('EDITOR_ELEMENTS_I18N_SELECT_HINT')}\n                                    </div>\n                                )}\n                            </div>\n                        </CollapsiblePanel>\n                    )}\n                </div>\n            )}\n\n            {category === 'obstacles' && (\n                <CollapsiblePanel title={t('EDITOR_ELEMENTS_OBSTACLES_TITLE')} isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {obstacles && obstacles.length > 0 ? (\n                            obstacles.map(o => renderPaletteItem(o, 'brown', 'object'))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                {t('EDITOR_ELEMENTS_OBSTACLES_EMPTY')}\n                            </div>\n                        )}\n                    </div>\n                </CollapsiblePanel>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\n\nexport const StatisticsPanel = ({ \n    totalTiles, \n    mapWidth, \n    mapHeight, \n    filledBlocks, \n    objectsCount, \n    emptyBlocks,\n    objectMapData,\n    registryItems,\n    maps\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const registryMap = registryItems && registryItems.__byId;\n    const getDef = (id) => {\n        if (!id) return null;\n        if (registryMap && typeof registryMap.get === 'function') return registryMap.get(id) || null;\n        return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    let itemsCount = 0;\n    let entitiesCount = 0;\n\n    if (Array.isArray(objectMapData)) {\n        objectMapData.forEach((id) => {\n            if (!id) return;\n            const def = getDef(id);\n            if (!def) return;\n            const name = (def.name || '').toLowerCase();\n            if (name.startsWith('item.')) itemsCount += 1;\n            if (def.type === 'entity' || def.subtype === 'tank' || def.subtype === 'platform' || name.includes('entities.')) {\n                entitiesCount += 1;\n            }\n        });\n    }\n\n    const mapList = maps ? Object.values(maps) : [];\n    const mapsTotal = mapList.length;\n    const mapsOverworld = mapList.filter(m => m.type === 'overworld').length;\n    const mapsUnderworld = mapList.filter(m => m.type === 'underworld').length;\n    const mapsRooms = mapList.filter(m => m.type === 'room').length;\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n            <div style={{ padding: '15px', backgroundColor: '#e6f7ff', borderRadius: '8px', border: '1px solid #91d5ff' }}>\n                <div style={{ fontSize: '14px', marginBottom: '8px' }}>\n                    <Trans i18nKey=\"EDITOR_ELEMENTS_STATS_TOTAL_AREA\" t={t} values={{ count: totalTiles }} components={[<strong key=\"count\" />]} />\n                </div>\n                <div style={{ fontSize: '13px', color: '#0050b3' }}>{t('EDITOR_ELEMENTS_STATS_DIMENSIONS', { width: mapWidth, height: mapHeight })}</div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#f6ffed', borderRadius: '8px', border: '1px solid #b7eb8f', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#389e0d' }}>{filledBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_FILLED_BLOCKS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#fff7e6', borderRadius: '8px', border: '1px solid #ffd591', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#d46b08' }}>{objectsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_OBJECTS')}</div>\n                </div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#eef7ff', borderRadius: '8px', border: '1px solid #b3d8ff', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#1565c0' }}>{itemsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ITEMS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#f3e8ff', borderRadius: '8px', border: '1px solid #d1c4e9', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#5e35b1' }}>{entitiesCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ENTITIES')}</div>\n                </div>\n            </div>\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#666' }}>{emptyBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_EMPTY_SPACE')}</div>\n            </div>\n            {mapsTotal > 0 && (\n                <div style={{ padding: '12px', backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #ddd' }}>\n                    <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#444', marginBottom: '6px' }}>\n                        {t('EDITOR_ELEMENTS_STATS_MAPS_TOTAL', { count: mapsTotal })}\n                    </div>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: '#666' }}>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_OVERWORLD', { count: mapsOverworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_UNDERWORLD', { count: mapsUnderworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_ROOMS', { count: mapsRooms })}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const ObjectPropsPanel = ({ \n    objectMapData, \n    secretMapData,\n    registryItems, \n    mapWidth, \n    objectMetadata, \n    highlightedIndex, \n    setHighlightedIndex, \n    setObjectMetadata,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const mapType = maps[activeMapId]?.type || 'overworld';\n    const mapList = Object.values(maps || {});\n    const listRef = React.useRef(null);\n\n    // Auto-scroll to highlighted item\n    React.useEffect(() => {\n        if (highlightedIndex !== null && listRef.current) {\n            const highlightedElement = listRef.current.querySelector(`[data-index=\"${highlightedIndex}\"]`);\n            if (highlightedElement) {\n                highlightedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n        }\n    }, [highlightedIndex]);\n\n    return (\n        <div style={{ padding: '0' }}>\n            <p style={{ fontSize: '12px', color: '#666', lineHeight: '1.4' }}>\n                {t('EDITOR_ELEMENTS_PROPS_INTRO_LINE1')}\n                <br />\n                <strong>1.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE2\"\n                    t={t}\n                    components={[<strong key=\"portal\" />, <strong key=\"target\" />, <strong key=\"weather\" />, <strong key=\"message\" />]}\n                />\n                <br />\n                <strong>2.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE3\"\n                    t={t}\n                    components={[<strong key=\"trigger\" />, <strong key=\"intensity\" />, <strong key=\"messageText\" />]}\n                />\n            </p>\n            <div ref={listRef} style={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}>\n                {Array.from({ length: objectMapData.length }).map((_, index) => {\n                    const objId = objectMapData[index];\n                    const secretId = secretMapData ? secretMapData[index] : null;\n                    \n                    if (!objId && !secretId) return null;\n\n                    const objDef = objId ? registryItems.find(r => r.id === objId) : null;\n                    const secretDef = secretId ? registryItems.find(r => r.id === secretId) : null;\n                    \n                    const isWeather = objDef && objDef.type === 'weather_trigger';\n                    const isMessage = objDef && objDef.type === 'message_trigger';\n                    const isPortalOrTarget = objId && (objId.includes('portal') || objId.includes('target') || objId === 'portal_target');\n                    const isDoor = objDef && objDef.subtype === 'door';\n                    const isRoomArea = secretDef && secretDef.subtype === 'room' && mapType !== 'room';\n                    const isTree = objDef && objDef.type === 'decoration' && objDef.editor?.group === 'trees';\n\n                    if (!isPortalOrTarget && !isWeather && !isMessage && !isRoomArea && !isDoor && !isTree) return null;\n\n                    const def = objDef || secretDef;\n                    const id = objId || secretId;\n\n                    const x = index % mapWidth;\n                    const y = Math.floor(index / mapWidth);\n                    const metadata = objectMetadata[index] || {};\n                    const i18nPreview = metadata.i18nChapter && metadata.i18nId\n                        ? getTutorialText(metadata.i18nChapter, metadata.i18nId)\n                        : '';\n                    const isHighlighted = highlightedIndex === index;\n\n                    return (\n                        <div key={index} \n                            data-index={index}\n                            onMouseEnter={() => setHighlightedIndex(index)}\n                            onMouseLeave={() => setHighlightedIndex(null)}\n                            style={{\n                                padding: '10px',\n                                border: isHighlighted ? '1px solid gold' : '1px solid #eee',\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '5px',\n                                backgroundColor: isHighlighted ? '#fffde7' : '#f9f9f9',\n                                marginBottom: '5px',\n                                borderRadius: '4px',\n                                transition: 'all 0.2s ease'\n                            }}\n                        >\n                            <div style={{ fontWeight: 'bold', fontSize: '13px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                                <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    {isRoomArea ? '' : (isTree ? '' : ((isWeather || isMessage) ? def.editorIcon : (id.includes('portal') && !id.includes('target') ? '' : '')))} {def.displayName || def.name}\n                                </span>\n                                <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                    <span style={{ color: '#666', fontSize: '11px' }}>({x}, {y})</span>\n                                    <button \n                                        onClick={() => {\n                                            const el = document.querySelector(`.viewport`);\n                                            if (el) {\n                                                const scrollX = x * 32 - el.clientWidth / 2 + 16;\n                                                const scrollY = y * 32 - el.clientHeight / 2 + 16;\n                                                el.scrollTo({ left: scrollX, top: scrollY, behavior: 'smooth' });\n                                            }\n                                        }}\n                                        style={{ \n                                            padding: '2px 6px', fontSize: '10px', cursor: 'pointer',\n                                            backgroundColor: '#eee', border: '1px solid #ccc', borderRadius: '3px'\n                                        }}\n                                        title={t('EDITOR_ELEMENTS_PROPS_LOCATE_TITLE')}\n                                    >\n                                        {t('EDITOR_ELEMENTS_PROPS_LOCATE_LABEL')}\n                                    </button>\n                                </div>\n                            </div>\n\n                            {isRoomArea && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_ROOM_NAME')}</label>\n                                        <input\n                                            type=\"text\"\n                                            value={metadata.roomName || ''}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_ROOM_NAME_PLACEHOLDER')}\n                                            onChange={(e) => {\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], roomName: e.target.value }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                            }}\n                                        />\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE')}</label>\n                                        <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.width || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], width: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                            <span>x</span>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.height || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], height: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                        </div>\n                                    </div>\n                                    {metadata.linkedMapId ? (\n                                        <div style={{ fontSize: '11px', color: 'green' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_LINKED_MAP', { id: metadata.linkedMapId })}\n                                        </div>\n                                    ) : (\n                                        <button\n                                            onClick={() => {\n                                                if (createMap) {\n                                                    const mapId = createMap('room', metadata.roomName || 'Room Area', metadata.width || 1, metadata.height || 1);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], linkedMapId: mapId }\n                                                    }));\n                                                }\n                                            }}\n                                            style={{\n                                                padding: '6px',\n                                                backgroundColor: '#4CAF50',\n                                                color: 'white',\n                                                border: 'none',\n                                                borderRadius: '4px',\n                                                cursor: 'pointer',\n                                                fontWeight: 'bold'\n                                            }}\n                                        >\n                                            {t('EDITOR_ELEMENTS_PROPS_CONFIRM')}\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n\n                            {(!isWeather && !isMessage && !isRoomArea && !isTree) && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID')}</label>\n                                    <input\n                                        type=\"number\"\n                                        value={metadata.triggerId || ''}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], triggerId: isNaN(val) ? null : val }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                        placeholder={t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {isTree && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_TREE_LAYER_LABEL')}</label>\n                                    <select\n                                        value={(metadata.renderAbovePlayer !== undefined ? metadata.renderAbovePlayer : def.renderAbovePlayer) ? 'above' : 'behind'}\n                                        onChange={(e) => {\n                                            const nextAbove = e.target.value === 'above';\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], renderAbovePlayer: nextAbove }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    >\n                                        <option value=\"behind\">{t('EDITOR_ELEMENTS_TREE_LAYER_BEHIND')}</option>\n                                        <option value=\"above\">{t('EDITOR_ELEMENTS_TREE_LAYER_ABOVE')}</option>\n                                    </select>\n                                </div>\n                            )}\n\n                            {isWeather && def.hasIntensity && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_INTENSITY')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        max=\"100\"\n                                        value={metadata.intensity !== undefined ? metadata.intensity : 50}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], intensity: isNaN(val) ? 0 : Math.min(100, Math.max(0, val)) }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    />\n                                </div>\n                            )}\n\n                            {isMessage && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\n                                    {(metadata.i18nChapter || metadata.i18nId) && (\n                                        <div style={{ fontSize: '11px', color: '#666' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_I18N_LABEL', {\n                                                chapter: metadata.i18nChapter || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY'),\n                                                id: metadata.i18nId || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY')\n                                            })}\n                                            {i18nPreview && (\n                                                <div style={{ marginTop: '4px', color: '#333' }}>\n                                                    {i18nPreview}\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_MESSAGE_TEXT')}</label>\n                                    <textarea\n                                        value={metadata.message || ''}\n                                        onChange={(e) => {\n                                            const val = e.target.value;\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], message: val }\n                                            }));\n                                        }}\n                                        rows={3}\n                                        style={{\n                                            width: '100%',\n                                            padding: '6px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0',\n                                            resize: 'vertical',\n                                            fontFamily: 'inherit'\n                                        }}\n                                        placeholder={i18nPreview || t('EDITOR_ELEMENTS_PROPS_MESSAGE_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {( (id.includes('portal') && !id.includes('target')) || isDoor ) && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px', marginTop: '5px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TARGET_MAP')}</label>\n                                        <select\n                                            value={metadata.targetMapId || ''}\n                                            onChange={(e) => {\n                                                const val = e.target.value;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], targetMapId: val === '' ? null : val }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        >\n                                            <option value=\"\">{t('EDITOR_ELEMENTS_PROPS_CURRENT_MAP_OPTION')}</option>\n                                            {mapList.map(m => (\n                                                <option key={m.id} value={m.id}>{m.name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SPAWN_ID')}</label>\n                                        <input\n                                            type=\"number\"\n                                            value={metadata.spawnTriggerId !== undefined ? metadata.spawnTriggerId : ''}\n                                            onChange={(e) => {\n                                                const val = parseInt(e.target.value);\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], spawnTriggerId: isNaN(val) ? null : val }\n                                                }));\n                                            }}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_SPAWN_ID_PLACEHOLDER')}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        />\n                                    </div>\n                                    {isDoor && (\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                            <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_DELAY')}</label>\n                                            <input\n                                                type=\"number\"\n                                                step=\"0.1\"\n                                                value={metadata.delaySeconds !== undefined ? metadata.delaySeconds : (objDef.interaction?.delaySeconds || 0.5)}\n                                                onChange={(e) => {\n                                                    const val = parseFloat(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], delaySeconds: isNaN(val) ? 0.5 : val }\n                                                    }));\n                                                }}\n                                                style={{\n                                                    flex: 1,\n                                                    padding: '4px 8px',\n                                                    border: '1px solid #ccc',\n                                                    borderRadius: '4px',\n                                                    fontSize: '13px',\n                                                    backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                                }}\n                                            />\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                            {/* Size Configuration */}\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px', paddingTop: '5px', borderTop: '1px solid #eee' }}>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_W')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.width || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], width: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_H')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.height || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], height: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <span style={{ fontSize: '10px', color: '#999' }}>{t('EDITOR_ELEMENTS_PROPS_RESIZE_HINT')}</span>\n                            </div>\n                        </div>\n                    );\n                })}\n                {objectMapData.filter(id => {\n                    if (!id) return false;\n                    const def = registryItems.find(r => r.id === id);\n                    const isWeather = def && def.type === 'weather_trigger';\n                    const isMessage = def && def.type === 'message_trigger';\n                    const isPortalOrTarget = id.includes('portal') || id.includes('target') || id === 'portal_target';\n                    const isTree = def && def.type === 'decoration' && def.editor?.group === 'trees';\n                    return isPortalOrTarget || isWeather || isMessage || isTree;\n                }).length === 0 && (\n                    <p style={{ textAlign: 'center', color: '#999', marginTop: '20px', fontSize: '14px' }}>\n                        {t('EDITOR_ELEMENTS_PROPS_NO_CONFIGURABLE')}\n                    </p>\n                )}\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    SidebarContainer,\n    ElementEditorButton,\n    PanelContainer,\n    PanelHeader,\n    PanelBody,\n    CloseButton\n} from './styles/EditorElementsButtonStyle';\n\n// Panels\nimport { OperationsPanel } from './editorElements/OperationsPanel';\nimport { PalettePanel } from './editorElements/PalettePanel';\nimport { StatisticsPanel } from './editorElements/StatisticsPanel';\nimport { ObjectPropsPanel } from './editorElements/ObjectPropsPanel';\n\nexport const EditorElements = ({\n    mapName,\n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    openNewMapModal,\n    openBuiltInModal,\n    saveMap,\n    loadMap,\n    clearMap,\n    isPlayMode,\n    handlePaletteSelect,\n    selectedTile,\n    blocks,\n    liquids,\n    entities,\n    items,\n    decorations,\n    interactables,\n    hazards,\n    secrets,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    setObjectMetadata,\n    registryItems,\n    highlightedIndex,\n    setHighlightedIndex,\n    activePanel,\n    setActivePanel,\n    togglePanel,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [lastPanel, setLastPanel] = React.useState(null);\n    const [pinnedPanel, setPinnedPanel] = React.useState(null);\n    const hoverTimerRef = React.useRef(null);\n\n    React.useEffect(() => {\n        if (activePanel) {\n            setLastPanel(activePanel);\n        }\n    }, [activePanel]);\n\n    const displayPanel = activePanel || lastPanel;\n\n    const clearHoverTimer = () => {\n        if (hoverTimerRef.current) {\n            clearTimeout(hoverTimerRef.current);\n            hoverTimerRef.current = null;\n        }\n    };\n\n    const handleIconClick = (panel) => {\n        clearHoverTimer();\n        if (pinnedPanel === panel) {\n            setPinnedPanel(null);\n            setActivePanel(null);\n            return;\n        }\n        setPinnedPanel(panel);\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseEnter = (panel) => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        hoverTimerRef.current = setTimeout(() => {\n            setActivePanel(null);\n        }, 120);\n    };\n\n    const handlePanelMouseEnter = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n    };\n\n    const handlePanelMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(null);\n    };\n\n    const panelTitles = {\n        map: t('EDITOR_ELEMENTS_PANEL_OPERATIONS'),\n        blocks: t('EDITOR_ELEMENTS_PANEL_BLOCKS'),\n        liquids: t('EDITOR_ELEMENTS_PANEL_LIQUIDS'),\n        decorations: t('EDITOR_ELEMENTS_PANEL_DECORATIONS'),\n        entities: t('EDITOR_ELEMENTS_PANEL_ENTITIES'),\n        items: t('EDITOR_ELEMENTS_PANEL_ITEMS'),\n        interactables: t('EDITOR_ELEMENTS_PANEL_INTERACTABLES'),\n        hazards: t('EDITOR_ELEMENTS_PANEL_HAZARDS'),\n        secrets: t('EDITOR_ELEMENTS_PANEL_SECTORS'),\n        weather: t('EDITOR_ELEMENTS_PANEL_WEATHER'),\n        messages: t('EDITOR_ELEMENTS_PANEL_MESSAGES'),\n        obstacles: t('EDITOR_ELEMENTS_PANEL_OBSTACLES'),\n        stats: t('EDITOR_ELEMENTS_PANEL_STATISTICS'),\n        props: t('EDITOR_ELEMENTS_PANEL_PROPERTIES')\n    };\n\n    return (\n        <div style={{ display: 'flex', height: '100%', position: 'relative', zIndex: 1001 }}>\n            {/* Sidebar Left Icons */}\n            <SidebarContainer>\n                <ElementEditorButton onClick={() => handleIconClick('map')} onMouseEnter={() => handleIconMouseEnter('map')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'map'} title={t('EDITOR_ELEMENTS_ICON_MAP_CONTROLS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('blocks')} onMouseEnter={() => handleIconMouseEnter('blocks')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'blocks'} title={t('EDITOR_ELEMENTS_ICON_BLOCKS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('liquids')} onMouseEnter={() => handleIconMouseEnter('liquids')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'liquids'} title={t('EDITOR_ELEMENTS_ICON_LIQUIDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('decorations')} onMouseEnter={() => handleIconMouseEnter('decorations')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'decorations'} title={t('EDITOR_ELEMENTS_ICON_DECORATIONS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('obstacles')} onMouseEnter={() => handleIconMouseEnter('obstacles')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'obstacles'} title={t('EDITOR_ELEMENTS_ICON_OBSTACLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('items')} onMouseEnter={() => handleIconMouseEnter('items')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'items'} title={t('EDITOR_ELEMENTS_ICON_ITEMS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('entities')} onMouseEnter={() => handleIconMouseEnter('entities')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'entities'} title={t('EDITOR_ELEMENTS_ICON_ENTITIES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('interactables')} onMouseEnter={() => handleIconMouseEnter('interactables')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'interactables'} title={t('EDITOR_ELEMENTS_ICON_INTERACTABLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('hazards')} onMouseEnter={() => handleIconMouseEnter('hazards')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'hazards'} title={t('EDITOR_ELEMENTS_ICON_HAZARDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('secrets')} onMouseEnter={() => handleIconMouseEnter('secrets')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'secrets'} title={t('EDITOR_ELEMENTS_ICON_SECTORS')}>2</ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('weather')} onMouseEnter={() => handleIconMouseEnter('weather')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'weather'} title={t('EDITOR_ELEMENTS_ICON_WEATHER')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('messages')} onMouseEnter={() => handleIconMouseEnter('messages')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'messages'} title={t('EDITOR_ELEMENTS_ICON_MESSAGES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('stats')} onMouseEnter={() => handleIconMouseEnter('stats')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'stats'} title={t('EDITOR_ELEMENTS_ICON_STATISTICS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('props')} onMouseEnter={() => handleIconMouseEnter('props')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'props'} title={t('EDITOR_ELEMENTS_ICON_PROPERTIES')}></ElementEditorButton>\n            </SidebarContainer>\n\n            {/* Sidebar Fixed Panel Content */}\n            <PanelContainer $isOpen={!!activePanel} onMouseEnter={handlePanelMouseEnter} onMouseLeave={handlePanelMouseLeave}>\n                {displayPanel && (\n                    <>\n                        {/* Panel Header */}\n                        <PanelHeader>\n                            <span>{panelTitles[displayPanel]}</span>\n                            <CloseButton onClick={() => { setPinnedPanel(null); setActivePanel(null); }}></CloseButton>\n                        </PanelHeader>\n\n                        {/* Panel Body */}\n                        <PanelBody>\n                            {displayPanel === 'map' && (\n                                <OperationsPanel \n                                    openNewMapModal={openNewMapModal}\n                                    openBuiltInModal={openBuiltInModal}\n                                    saveMap={saveMap}\n                                    loadMap={loadMap}\n                                    clearMap={clearMap}\n                                    mapName={mapName}\n                                    creatorName={creatorName}\n                                    mapDescription={mapDescription}\n                                    setMapName={setMapName}\n                                    setCreatorName={setCreatorName}\n                                    setMapDescription={setMapDescription}\n                                />\n                            )}\n\n                            {(displayPanel === 'blocks' || \n                              displayPanel === 'liquids' || \n                              displayPanel === 'decorations' || \n                              displayPanel === 'entities' || \n                              displayPanel === 'items' || \n                              displayPanel === 'interactables' || \n                              displayPanel === 'hazards' || \n                              displayPanel === 'secrets' ||\n                              displayPanel === 'weather' ||\n                              displayPanel === 'messages' ||\n                              displayPanel === 'obstacles') && (\n                                <PalettePanel \n                                    isPlayMode={isPlayMode}\n                                    category={displayPanel}\n                                    blocks={blocks}\n                                    liquids={liquids}\n                                    entities={entities}\n                                    decorations={decorations}\n                                    items={items}\n                                    interactables={interactables}\n                                    hazards={hazards}\n                                    secrets={secrets}\n                                    weather={weather}\n                                    messages={messages}\n                                    crackableWalls={crackableWalls}\n                                    pushableWalls={pushableWalls}\n                                    obstacles={obstacles}\n                                    handlePaletteSelect={handlePaletteSelect}\n                                    selectedTile={selectedTile}\n                                    objectMetadata={objectMetadata}\n                                    setObjectMetadata={setObjectMetadata}\n                                    objectMapData={objectMapData}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    registryItems={registryItems}\n                                />\n                            )}\n\n\n                            {displayPanel === 'stats' && (\n                                <StatisticsPanel \n                                    totalTiles={totalTiles}\n                                    mapWidth={mapWidth}\n                                    mapHeight={mapHeight}\n                                    filledBlocks={filledBlocks}\n                                    objectsCount={objectsCount}\n                                    emptyBlocks={emptyBlocks}\n                                    objectMapData={objectMapData}\n                                    registryItems={registryItems}\n                                    maps={maps}\n                                />\n                            )}\n\n                            {displayPanel === 'props' && (\n                                <ObjectPropsPanel \n                                    objectMapData={objectMapData}\n                                    secretMapData={secretMapData}\n                                    registryItems={registryItems}\n                                    mapWidth={mapWidth}\n                                    objectMetadata={objectMetadata}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    setObjectMetadata={setObjectMetadata}\n                                    maps={maps}\n                                    activeMapId={activeMapId}\n                                    createMap={createMap}\n                                />\n                            )}\n                        </PanelBody>\n                    </>\n                )}\n            </PanelContainer>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    EditorToolsContainer,\n    HeaderBar,\n    ToolsSection,\n    ToolsGroup,\n    ToolsInnerGroup,\n    ToolsRow,\n    ToolsEditorButton,\n    StrikeThrough,\n    LayerIndicator,\n    BgColorContainer,\n    BgColorInputWrapper,\n    BgColorInput,\n    BgTransparentButton,\n    PlayButtonContainer,\n    PlayButtonInner,\n    InfoContainer,\n    InfoItem,\n    InfoLabel,\n    InfoValue,\n    EraserButtonContainer,\n    EraserButtonInner,\n    SelectionActions,\n    ConfirmButton,\n    CancelButton,\n    GridIcon\n} from './styles/EditorToolsButton';\n\nexport const EditorTools = (props) => {\n    const { t } = useTranslation('editor_tools');\n    const {\n        mapName, \n        creatorName, \n        activePanel, \n        togglePanel,\n        showGrid, \n        setShowGrid,\n        isPlayMode,\n        handlePlay,\n        handlePause,\n        handleReset,\n        activeTool,\n        setActiveTool,\n        brushSize,\n        setBrushSize,\n        activeLayer,\n        selection,\n        moveSelection,\n        selectionMode,\n        setSelectionMode,\n        commitSelection,\n        cancelSelection,\n        selectedTile,\n        handlePaletteSelect,\n        selectedBackgroundColor,\n        setSelectedBackgroundColor,\n        showBackgroundImage,\n        setShowBackgroundImage,\n        showMessages,\n        setShowMessages,\n        isRoomAreaVisible,\n        setIsRoomAreaVisible,\n        showRoomMapContent,\n        setShowRoomMapContent\n    } = props;\n    const getEraserData = (layer) => {\n        const isLayerBrushActive = activeLayer === layer\n            && activeTool === 'brush'\n            && selectedTile !== null;\n        const isLayerBucketActive = activeLayer === layer\n            && activeTool === 'bucket'\n            && selectedTile !== null;\n        const isActive = (selectedTile === null && activeLayer === layer) || isLayerBrushActive || isLayerBucketActive;\n        const colors = {\n            tile: { bg: '#e6f7ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', text: '#722ed1' },\n            props: { bg: '#fffbe6', text: '#faad14' }\n        };\n        const active = colors[layer] || colors.tile;\n        return {\n            isActive,\n            bgColor: active.bg,\n            textColor: active.text\n        };\n    };\n\n    const getLayerIndicatorData = () => {\n        const colors = {\n            tile: { bg: '#e6f7ff', border: '#91d5ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', border: '#ffa39e', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', border: '#d3adf7', text: '#722ed1' },\n            props: { bg: '#fffbe6', border: '#ffe58f', text: '#faad14' }\n        };\n        const active = colors[activeLayer] || colors.tile;\n        return {\n            $bgColor: active.bg,\n            $borderColor: active.border,\n            $textColor: active.text\n        };\n    };\n\n    return (\n        <EditorToolsContainer>\n            {/* Main Header Bar */}\n            <HeaderBar>\n                <ToolsSection>\n                    <ToolsGroup>\n\n                        {/* Brush - Bucket - Move - Area */}\n                        <ToolsRow>\n                            {[\n                                { id: 'brush', icon: '', title: t('EDITOR_TOOLS_BRUSH_TITLE') },\n                                { id: 'bucket', icon: '', title: t('EDITOR_TOOLS_BUCKET_TITLE') },\n                                { id: 'move', icon: '', title: t('EDITOR_TOOLS_MOVE_TITLE') },\n                            ].map(tool => (\n                                <ToolsEditorButton\n                                    key={tool.id}\n                                    onClick={() => !isPlayMode && setActiveTool(tool.id)}\n                                    $active={activeTool === tool.id && !isPlayMode}\n                                    $square\n                                    $disabled={isPlayMode}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : tool.title}\n                                >\n                                    {tool.icon}\n                                    {isPlayMode && <StrikeThrough />}\n                                </ToolsEditorButton>\n                            ))}\n                        </ToolsRow>\n\n                        {/* Cut - Copy - Paste */}\n                        <ToolsInnerGroup>\n                            {['cut', 'copy'].map(mode => {\n                                const isDisabled = isPlayMode || activeTool !== 'move';\n                                return (\n                                    <ToolsEditorButton\n                                        key={mode}\n                                        onClick={() => !isDisabled && setSelectionMode(mode)}\n                                        $active={selectionMode === mode && !isDisabled}\n                                        $square\n                                        $disabled={isDisabled}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? (mode === 'cut' ? t('EDITOR_TOOLS_CUT_ONLY_MOVE') : t('EDITOR_TOOLS_COPY_ONLY_MOVE')) : (mode === 'cut' ? t('EDITOR_TOOLS_CUT_SELECTION') : t('EDITOR_TOOLS_COPY_SELECTION')))}\n                                    >\n                                        {mode === 'cut' ? '' : ''}\n                                        {isDisabled && <StrikeThrough />}\n                                    </ToolsEditorButton>\n                                );\n                            })}\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && activeTool === 'move' && commitSelection()}\n                                $square\n                                $disabled={isPlayMode || activeTool !== 'move'}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (activeTool !== 'move' ? t('EDITOR_TOOLS_PASTE_ONLY_MOVE') : t('EDITOR_TOOLS_PASTE_SELECTION'))}\n                            >\n                                \n                                {(isPlayMode || activeTool !== 'move') && <StrikeThrough />}\n                            </ToolsEditorButton>\n                            {selection && !isPlayMode && (\n                                <SelectionActions>\n                                    <ConfirmButton onClick={commitSelection} $square title={t('EDITOR_TOOLS_CONFIRM_SELECTION')}></ConfirmButton>\n                                    <CancelButton onClick={cancelSelection} $square title={t('EDITOR_TOOLS_CANCEL_SELECTION')}></CancelButton>\n                                </SelectionActions>\n                            )}\n                        </ToolsInnerGroup>\n\n                        {/* Size */}\n                        <ToolsInnerGroup>\n                            {['I', 'II', 'III', 'IV', 'V'].map((roman, idx) => {\n                                const size = idx + 1;\n                                const isDisabled = isPlayMode || activeTool !== 'brush';\n                                return (\n                                    <ToolsEditorButton \n                                        key={size} \n                                    onClick={() => !isDisabled && setBrushSize(size)} \n                                    $active={brushSize === size && !isDisabled} \n                                    $square \n                                    $disabled={isDisabled}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? t('EDITOR_TOOLS_BRUSH_SIZE_ONLY') : t('EDITOR_TOOLS_BRUSH_SIZE', { size }))}\n                                >\n                                    {roman}\n                                    {isDisabled && <StrikeThrough />}\n                                </ToolsEditorButton>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        {/* Background Immage */}\n                        <ToolsRow>\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && setShowBackgroundImage(!showBackgroundImage)}\n                                $active={showBackgroundImage && !isPlayMode}\n                                $square\n                                $disabled={isPlayMode}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (showBackgroundImage ? t('EDITOR_TOOLS_BACKGROUND_IMAGE_HIDE') : t('EDITOR_TOOLS_BACKGROUND_IMAGE_SHOW'))}\n                            >\n                                \n                                {isPlayMode && <StrikeThrough />}\n                            </ToolsEditorButton>\n\n                            {/* Grid */}\n                            <ToolsEditorButton\n                                onClick={() => setShowGrid(!showGrid)}\n                                $active={showGrid}\n                                $square\n                                title={showGrid ? t('EDITOR_TOOLS_GRID_HIDE') : t('EDITOR_TOOLS_GRID_SHOW')}\n                            >\n                                <GridIcon>\n                                    {showGrid ? '' : ''}\n                                </GridIcon>\n                            </ToolsEditorButton>\n\n                            {/* Messages Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowMessages(!showMessages)}\n                                $active={showMessages}\n                                $square\n                                title={showMessages ? t('EDITOR_TOOLS_MESSAGES_HIDE') : t('EDITOR_TOOLS_MESSAGES_SHOW')}\n                            >\n                                \n                            </ToolsEditorButton>\n\n                            {/* Room Area Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setIsRoomAreaVisible(!isRoomAreaVisible)}\n                                $active={isRoomAreaVisible}\n                                $square\n                                title={isRoomAreaVisible ? t('EDITOR_TOOLS_ROOM_AREA_HIDE') : t('EDITOR_TOOLS_ROOM_AREA_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Room Map Content Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowRoomMapContent(!showRoomMapContent)}\n                                $active={showRoomMapContent}\n                                $square\n                                title={showRoomMapContent ? t('EDITOR_TOOLS_ROOM_CONTENT_HIDE') : t('EDITOR_TOOLS_ROOM_CONTENT_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Background Color Picker */}\n                            <BgColorContainer>\n                                <BgColorInputWrapper>\n                                    <BgColorInput\n                                        type=\"color\"\n                                        value={selectedBackgroundColor && selectedBackgroundColor !== 'transparent' ? selectedBackgroundColor : '#000000'}\n                                        onChange={(e) => !isPlayMode && setSelectedBackgroundColor(e.target.value)}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_COLOR')}\n                                        disabled={isPlayMode}\n                                    />\n                                    {isPlayMode && <StrikeThrough />}\n                                </BgColorInputWrapper>\n                                <BgTransparentButton \n                                    $active={selectedBackgroundColor === 'transparent'}\n                                    onClick={() => !isPlayMode && setSelectedBackgroundColor('transparent')}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_TRANSPARENT')}\n                                />\n                            </BgColorContainer>\n                        </ToolsRow>\n\n\n\n                        {/* Active Layer Indicator */}\n                        <ToolsInnerGroup>\n                            <LayerIndicator {...getLayerIndicatorData()}>\n                                {t('EDITOR_TOOLS_LAYER_LABEL', {\n                                    layer: activeLayer === 'tile'\n                                        ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                        : (activeLayer === 'object'\n                                            ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                            : (activeLayer === 'secret'\n                                                ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                })}\n                            </LayerIndicator>\n                        </ToolsInnerGroup>\n\n                        {/* Layers: Block - Object - Sector - Props */}\n                        <ToolsInnerGroup>\n                            {['tile', 'object', 'secret', 'props'].map(layer => {\n                                const { isActive, bgColor, textColor } = getEraserData(layer);\n                                const isDisabled = isPlayMode;\n                                return (\n                                    <EraserButtonContainer\n                                        key={layer}\n                                        onClick={() => !isDisabled && handlePaletteSelect(null, layer)}\n                                        $active={isActive && !isDisabled}\n                                        $disabled={isDisabled}\n                                        title={isDisabled ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_ERASE_LABEL', {\n                                            layer: layer === 'tile'\n                                                ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                                : (layer === 'object'\n                                                    ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                                    : (layer === 'secret'\n                                                        ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                        : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                        })}\n                                    >\n                                        <EraserButtonInner $bgColor={bgColor} $textColor={textColor} $active={isActive && !isDisabled}>\n                                            {layer === 'tile' ? 'B' : (layer === 'object' ? 'O' : (layer === 'secret' ? 'S' : 'P'))}\n                                        </EraserButtonInner>\n                                        {isDisabled && <StrikeThrough />}\n                                    </EraserButtonContainer>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        <ToolsInnerGroup>\n                            <ToolsRow>\n                                <PlayButtonContainer onClick={isPlayMode ? handlePause : handlePlay} title={isPlayMode ? t('EDITOR_TOOLS_PAUSE_TITLE') : t('EDITOR_TOOLS_PLAY_TITLE')}>\n                                    <PlayButtonInner $variant={isPlayMode ? 'pause' : 'play'}>\n                                        <span>{isPlayMode ? '' : ''}</span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n\n                                <PlayButtonContainer onClick={handleReset} title={t('EDITOR_TOOLS_RESET_TITLE')}>\n                                    <PlayButtonInner>\n                                        <span></span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n                            </ToolsRow>\n                        </ToolsInnerGroup>\n                    </ToolsGroup>\n                </ToolsSection>\n\n\n                <ToolsSection>\n                    <InfoContainer>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_MAP')}</InfoLabel>\n                            <InfoValue>{mapName}</InfoValue>\n                        </InfoItem>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_BY')}</InfoLabel>\n                            <InfoValue>{creatorName}</InfoValue>\n                        </InfoItem>\n                    </InfoContainer>\n                </ToolsSection>\n            </HeaderBar>\n        </EditorToolsContainer>\n    );\n};\n","import { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { TILE_SIZE } from '../../../../constants/gameConstants';\nimport { useGameEngine } from '../../../../utilities/useGameEngine';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../../engine/gameplay/breakEffects';\n\nconst EMPTY_ARRAY = [];\n\nexport const useEditorPlayMode = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n    selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n    registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    maps, activeMapId, switchMap, spawnTriggerId,\n    setTileMapData, updateMapData\n) => {\n    const [isPlayMode, setIsPlayMode] = useState(false);\n    const [isGameOver, setIsGameOver] = useState(false);\n    const [restartCounter, setRestartCounter] = useState(0);\n    const [editorSnapshot, setEditorSnapshot] = useState(null);\n    const [revealedSecrets, setRevealedSecrets] = useState([]);\n    const [activeRoomIds, setActiveRoomIds] = useState(new Set());\n    const [playModeObjectData, setPlayModeObjectData] = useState([]);\n    const [playModeSecretData, setPlayModeSecretData] = useState([]);\n    const [playModeWeather, setPlayModeWeather] = useState({\n        rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0,\n        lavaRain: 0, radioactiveFog: 0, meteorRain: 0\n    });\n    const [playModeMapsVersion, setPlayModeMapsVersion] = useState(0);\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n    const lastSyncedMapIdRef = useRef(null);\n    const isPlayModeRef = useRef(isPlayMode);\n    const playModeMapsRef = useRef({});\n\n    useEffect(() => {\n        isPlayModeRef.current = isPlayMode;\n    }, [isPlayMode]);\n\n    // Stability for engine initialization - only changes when map changes or play mode is toggled\n    const engineInitId = useMemo(() => {\n        return isPlayMode ? `${activeMapId}_${restartCounter}_${Date.now()}` : null;\n    }, [isPlayMode, activeMapId, restartCounter]);\n\n    // Derived data to ensure useGameEngine gets fresh data even before useEffect syncs state.\n    // This prevents the engine from using old map data during initialization.\n    const currentPlayObjectData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) {\n            const playData = [...objectMapData];\n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n            return playData;\n        }\n        return playModeObjectData;\n    }, [isPlayMode, activeMapId, playModeObjectData, objectMapData, spawnTriggerId, mapWidth, mapHeight]);\n\n    const currentPlaySecretData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) return [...secretMapData];\n        return playModeSecretData;\n    }, [isPlayMode, activeMapId, playModeSecretData, secretMapData]);\n\n    const playModeMaps = useMemo(() => {\n        if (!isPlayMode) return maps;\n        const overrides = playModeMapsRef.current || {};\n        const merged = { ...maps };\n        Object.keys(overrides).forEach(id => {\n            if (!merged[id]) return;\n            merged[id] = {\n                ...merged[id],\n                objectMapData: overrides[id].objectMapData || merged[id].objectMapData,\n                secretMapData: overrides[id].secretMapData || merged[id].secretMapData,\n                objectMetadata: overrides[id].objectMetadata || merged[id].objectMetadata\n            };\n        });\n        return merged;\n    }, [isPlayMode, maps, playModeMapsVersion]);\n\n    const mapDataForGame = useMemo(() => ({\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: TILE_SIZE,\n            activeMapId: activeMapId,\n            spawnTriggerId: spawnTriggerId,\n            backgroundImage: selectedBackgroundImage,\n            backgroundColor: selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            objectMetadata: objectMetadata,\n            activeRoomIds: Array.from(activeRoomIds),\n            date_map_last_updated: engineInitId, \n            weather: {\n                rain: isPlayMode ? playModeWeather.rain : weatherRain,\n                lavaRain: isPlayMode ? playModeWeather.lavaRain : weatherLavaRain,\n                snow: isPlayMode ? playModeWeather.snow : weatherSnow,\n                meteorRain: isPlayMode ? playModeWeather.meteorRain : weatherMeteorRain,\n                clouds: isPlayMode ? playModeWeather.clouds : weatherClouds,\n                fog: isPlayMode ? playModeWeather.fog : weatherFog,\n                radioactiveFog: isPlayMode ? playModeWeather.radioactiveFog : weatherRadioactiveFog,\n                thunder: isPlayMode ? playModeWeather.thunder : weatherThunder\n            }\n        },\n        maps: playModeMaps, // Project maps for inter-map teleports\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: currentPlayObjectData },\n            { type: \"secret\", name: \"secrets\", data: currentPlaySecretData }\n        ]\n    }), [\n        mapWidth, mapHeight, activeMapId, spawnTriggerId, selectedBackgroundImage, selectedBackgroundColor, \n        backgroundParallaxFactor, tileMapData, currentPlayObjectData, objectMetadata, activeRoomIds,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playModeWeather,\n        isPlayMode, playModeMaps, engineInitId\n    ]);\n\n    // Synchronize play mode state when map changes (e.g., during inter-map teleport)\n    useEffect(() => {\n        if (isPlayMode && lastSyncedMapIdRef.current !== activeMapId) {\n            const saved = playModeMapsRef.current?.[activeMapId];\n            if (saved) {\n                setPlayModeObjectData([...saved.objectMapData]);\n                setPlayModeSecretData([...(saved.secretMapData || [])]);\n                if (saved.objectMetadata) {\n                    setObjectMetadata({ ...saved.objectMetadata });\n                }\n                setRevealedSecrets([]);\n                if (messageTimerRef.current) {\n                    clearTimeout(messageTimerRef.current);\n                    messageTimerRef.current = null;\n                }\n                setGameMessage({ text: '', isVisible: false });\n                lastSyncedMapIdRef.current = activeMapId;\n                return;\n            }\n            const playData = [...objectMapData];\n            \n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(playData);\n            setPlayModeSecretData([...secretMapData]);\n            setRevealedSecrets([]);\n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n                messageTimerRef.current = null;\n            }\n            setGameMessage({ text: '', isVisible: false });\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    }, [activeMapId, isPlayMode, objectMapData, secretMapData, mapWidth, mapHeight, spawnTriggerId]);\n\n    const handleGameOver = useCallback(() => {\n        setIsGameOver(true);\n    }, []);\n\n    const handleReplay = useCallback(() => {\n        setIsGameOver(false);\n        setRestartCounter(prev => prev + 1);\n        setRevealedSecrets([]);\n        if (editorSnapshot) {\n            setPlayModeObjectData([...editorSnapshot.objectMapData]);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n        }\n    }, [editorSnapshot, setObjectMetadata]);\n\n    const handleStateUpdate = useCallback((newState, payload) => {\n        if (newState && typeof newState === 'object' && newState.x !== undefined && newState.y !== undefined) {\n            setPlayerPosition({ x: newState.x, y: newState.y });\n        } else if (newState === 'collectItem' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const newData = [...prev];\n                    newData[index] = null;\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newData = [...(playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [])];\n                newData[index] = null;\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMapData: newData\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'interactable' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const currentId = prev[index];\n                    if (!currentId) return prev;\n                    const newData = [...prev];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const mapObj = playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [];\n                const currentId = mapObj[index];\n                if (currentId) {\n                    const newData = [...mapObj];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[mapId] = {\n                        ...(playModeMapsRef.current[mapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                }\n            }\n        } else if (newState === 'setObjectFrame' && payload !== undefined) {\n            const { index, frame, mapId } = payload;\n            if (!mapId || mapId === activeMapId) {\n                setObjectMetadata(prev => {\n                    const next = {\n                        ...prev,\n                        [index]: { ...prev[index], currentFrame: frame }\n                    };\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMetadata: next\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return next;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newMeta = { ...((playModeMapsRef.current?.[mapId]?.objectMetadata) || maps[mapId].objectMetadata || {}) };\n                newMeta[index] = { ...(newMeta[index] || {}), currentFrame: frame };\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMetadata: newMeta\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'switchMap' && payload !== undefined) {\n            const { targetMapId, triggerId } = payload;\n            \n            // Check if target is a room\n            const targetMap = maps[targetMapId];\n            if (targetMap && targetMap.type === 'room') {\n                setActiveRoomIds(prev => {\n                    const next = new Set(prev);\n                    if (next.has(targetMapId)) next.delete(targetMapId);\n                    else next.add(targetMapId);\n                    return next;\n                });\n            } else if (targetMapId === 'main' && activeRoomIds.size > 0) {\n                setActiveRoomIds(new Set());\n            } else if (switchMap && targetMapId) {\n                playModeMapsRef.current[activeMapId] = {\n                    objectMapData: [...playModeObjectData],\n                    secretMapData: [...playModeSecretData],\n                    objectMetadata: { ...objectMetadata }\n                };\n                setPlayModeMapsVersion(v => v + 1);\n                // We keep play mode active when switching maps via teleport\n                switchMap(targetMapId, triggerId);\n            }\n        } else if (newState === 'objectDamage' && payload !== undefined) {\n            const { index, damage } = payload;\n            const objId = playModeObjectData[index];\n            const def = registryItems.find(r => r.id === objId);\n            if (!def) return;\n\n            setObjectMetadata(prev => {\n                const current = prev[index] || {};\n                const maxH = def.maxHealth || 100;\n                const newHealth = Math.max(0, (current.health !== undefined ? current.health : maxH) - damage);\n                \n                if (shouldRemoveCrackBlock(def, newHealth)) {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[index] = null;\n                            return newTiles;\n                        });\n                    }\n                }\n\n                if (shouldTriggerBreakEffect(def, newHealth) && !current.breakFxPlayed) {\n                    const cfg = getBreakEffectParams(def);\n                    if (cfg) {\n                        const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        window.dispatchEvent(new CustomEvent('game-break-effect', {\n                            detail: { x, y, config: cfg }\n                        }));\n                    }\n                }\n\n                return {\n                    ...prev,\n                    [index]: { ...current, health: newHealth, breakFxPlayed: current.breakFxPlayed || shouldTriggerBreakEffect(def, newHealth) }\n                };\n            });\n            const nextMeta = {\n                ...(objectMetadata || {}),\n                [index]: {\n                    ...(objectMetadata?.[index] || {}),\n                    health: Math.max(0, ((objectMetadata?.[index]?.health ?? (def.maxHealth || 100)) - damage))\n                }\n            };\n            playModeMapsRef.current[activeMapId] = {\n                ...(playModeMapsRef.current[activeMapId] || {}),\n                objectMetadata: nextMeta\n            };\n            setPlayModeMapsVersion(v => v + 1);\n\n            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(index / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n            }));\n        } else if (newState === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (newState === 'shiftTile' && payload !== undefined) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapId;\n            \n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => playModeObjectData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[to] = newTiles[from];\n                            newTiles[from] = null;\n                            return newTiles;\n                        });\n                    }\n                },\n                moveObject: (from, to) => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[to] = newObjs[from];\n                        newObjs[from] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                moveMetadata: (from, to) => {\n                    setObjectMetadata(prevMeta => {\n                        const newMeta = { ...prevMeta };\n                        if (newMeta[from]) {\n                            newMeta[to] = newMeta[from];\n                            delete newMeta[from];\n                        }\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMetadata: newMeta\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newMeta;\n                    });\n                },\n                removeObject: idx => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[idx] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                shouldCancel: () => !isPlayModeRef.current || activeMapId !== mapIdAtStart\n            });\n        } else if (newState === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            setPlayModeWeather(prev => ({\n                ...prev,\n                [type]: value\n            }));\n            \n            // Dispatch event for any UI components that might be listening\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1);\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (newState === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        } else if (newState === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (newState === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (newState === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        }\n    }, [activeMapId, maps, updateMapData, activeRoomIds, playModeObjectData, registryItems, setPlayerPosition, setObjectMetadata, switchMap, playModeSecretData, objectMetadata, mapWidth, mapHeight]);\n\n    const handleRevealSecret = useCallback((secretIndices) => {\n        const next = Array.isArray(secretIndices) ? secretIndices : [secretIndices];\n        if (next.length === 0) return;\n        setRevealedSecrets(prev => [...prev, ...next]);\n    }, []);\n\n    const gameEngineState = useGameEngine(\n        isPlayMode ? mapDataForGame : null,\n        isPlayMode ? tileMapData : EMPTY_ARRAY,\n        isPlayMode ? currentPlayObjectData : EMPTY_ARRAY,\n        isPlayMode ? currentPlaySecretData : EMPTY_ARRAY,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        Array.from(activeRoomIds),\n        mapWidth,\n        mapHeight\n    );\n\n    const handlePlay = () => {\n        setEditorSnapshot({\n            tileMapData: [...tileMapData],\n            objectMapData: [...objectMapData],\n            secretMapData: [...secretMapData],\n            objectMetadata: { ...objectMetadata },\n            playerPosition: { ...playerPosition }\n        });\n\n        const playData = [...objectMapData];\n        let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n        if (spawnIndex === -1) {\n            const spawnX = Math.min(3, mapWidth - 1);\n            const spawnY = Math.min(3, mapHeight - 1);\n            spawnIndex = spawnY * mapWidth + spawnX;\n            playData[spawnIndex] = 'player';\n        }\n\n        setPlayModeObjectData(playData);\n        setPlayModeSecretData([...secretMapData]);\n        playModeMapsRef.current = {\n            [activeMapId]: {\n                objectMapData: playData,\n                secretMapData: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            }\n        };\n        setPlayModeMapsVersion(v => v + 1);\n        setPlayModeWeather({\n            rain: weatherRain,\n            snow: weatherSnow,\n            clouds: weatherClouds,\n            fog: weatherFog,\n            thunder: weatherThunder,\n            lavaRain: weatherLavaRain,\n            radioactiveFog: weatherRadioactiveFog,\n            meteorRain: weatherMeteorRain\n        });\n        setRevealedSecrets([]);\n        lastSyncedMapIdRef.current = activeMapId;\n        setIsPlayMode(true);\n        setIsGameOver(false); // Reset game over when starting play mode\n    };\n\n    const handlePause = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false); // Reset game over when exiting play mode\n        playModeMapsRef.current = {};\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    const handleReset = () => {\n        if (editorSnapshot) {\n            if (setTileMapData) {\n                setTileMapData([...editorSnapshot.tileMapData]);\n            }\n\n            const resetData = [...editorSnapshot.objectMapData];\n            let spawnIndex = resetData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                resetData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(resetData);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n            setRevealedSecrets([]);\n            playModeMapsRef.current = {\n                [activeMapId]: {\n                    objectMapData: resetData,\n                    secretMapData: [...editorSnapshot.secretMapData],\n                    objectMetadata: { ...editorSnapshot.objectMetadata }\n                }\n            };\n            setPlayModeMapsVersion(v => v + 1);\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    };\n\n    const handleForceStop = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false);\n        setEditorSnapshot(null);\n        setPlayModeObjectData([]);\n        setPlayModeSecretData([]);\n        setRevealedSecrets([]);\n        playModeMapsRef.current = {};\n        lastSyncedMapIdRef.current = null;\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    return {\n        isPlayMode,\n        setIsPlayMode,\n        isGameOver,\n        handlePlay,\n        handlePause,\n        handleReset,\n        handleForceStop,\n        handleReplay,\n        handleStateUpdate,\n        playModeObjectData: currentPlayObjectData,\n        playModeSecretData: currentPlaySecretData,\n        playModeWeather,\n        playModeMaps,\n        gameMessage,\n        revealedSecrets,\n        activeRoomIds: Array.from(activeRoomIds),\n        gameEngineState\n    };\n};\n","import { useCallback } from 'react';\nimport { saveMap, loadMap, loadBuiltInMap, clearMap } from '../editorTools/mapOperations';\n\nexport const useEditorOperations = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    mapName, creatorName, mapDescription, createdAt,\n    selectedBackgroundImage, selectedBackgroundColor,\n    backgroundParallaxFactor, selectedBackgroundMusic, playerPosition,\n    registryItems, setCreatedAt,\n    setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n    setSelectedBackgroundImage, setSelectedBackgroundColor,\n    setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n    setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n    // Multi-map props\n    maps, setMaps, activeMapId, setActiveMapId\n) => {\n    const handleSaveMap = useCallback(() => {\n        // Construct the updated maps object with current active map data\n        // to ensure latest changes are saved even if debounce hasn't run\n        const currentMapData = {\n            ...maps[activeMapId],\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weather: {\n                rain: weatherRain,\n                snow: weatherSnow,\n                clouds: weatherClouds,\n                fog: weatherFog,\n                thunder: weatherThunder,\n                lavaRain: weatherLavaRain,\n                radioactiveFog: weatherRadioactiveFog,\n                meteorRain: weatherMeteorRain\n            },\n            playerPosition\n        };\n\n        const updatedMaps = {\n            ...maps,\n            [activeMapId]: currentMapData\n        };\n\n        saveMap({\n            maps: updatedMaps, \n            activeMapId,\n            mapName, creatorName, mapDescription, createdAt,\n            registryItems, setCreatedAt\n        });\n    }, [\n        maps, activeMapId, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain\n    ]);\n\n    const handleLoadMap = useCallback((event) => {\n        loadMap({\n            event, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleLoadBuiltInMap = useCallback((mapData) => {\n        loadBuiltInMap({\n            mapData, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleClearMap = useCallback(() => {\n        clearMap({ \n            mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata \n        });\n    }, [mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    const openNewMapModal = () => {\n        setTempMapName(mapName);\n        setTempCreatorName(creatorName);\n        setTempMapDescription(mapDescription);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = (tempMapName, tempCreatorName, tempMapDescription) => {\n        setMapName(tempMapName || \"New Map\");\n        setCreatorName(tempCreatorName || \"Anonymous\");\n        setMapDescription(tempMapDescription || \"\");\n        setCreatedAt(new Date().toISOString());\n        \n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n        \n        setIsNewMapModalOpen(false);\n    };\n\n    return {\n        handleSaveMap,\n        handleLoadMap,\n        handleLoadBuiltInMap,\n        handleClearMap,\n        openNewMapModal,\n        confirmNewMap\n    };\n};\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = new Set();\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.add(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    if (startId === targetId) return currentData;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    return newData;\n};\n\nexport const paintTile = ({\n    index, brushSize, activeLayer, selectedTile,\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    isRoomAreaVisible, activeTool\n}) => {\n    const isPropsLayer = activeLayer === 'props';\n    const targetLayer = isPropsLayer ? 'object' : activeLayer;\n\n    const targetData = targetLayer === 'tile' ? tileMapData : (targetLayer === 'object' ? objectMapData : secretMapData);\n    const setTargetData = targetLayer === 'tile' ? setTileMapData : (targetLayer === 'object' ? setObjectMapData : setSecretMapData);\n    \n    const newData = [...targetData];\n    let newMetadata = objectMetadata ? { ...objectMetadata } : null;\n    let metadataChanged = false;\n\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                \n                // Protection for Room Areas\n                if (targetLayer === 'secret' && secretMapData[targetIndex] === 'room_area') {\n                    const isRoomAreaTool = activeTool === 'area' || selectedTile?.id === 'room_area';\n                    const isEraser = selectedTile === null;\n                    if (!isRoomAreaVisible && !isRoomAreaTool && !isEraser) {\n                        continue; // Skip overwriting room_area if not visible and not using room tool\n                    }\n                }\n\n                if (isPropsLayer && selectedTile === null) {\n                    // In props layer eraser mode, remove object + metadata.\n                    newData[targetIndex] = null;\n                    if (newMetadata && newMetadata[targetIndex]) {\n                        delete newMetadata[targetIndex];\n                        metadataChanged = true;\n                    }\n                } else {\n                    newData[targetIndex] = selectedTile ? selectedTile.id : null;\n                    // If we are painting/erasing in object layer, we should also handle metadata\n                    if (targetLayer === 'object' && selectedTile === null) {\n                        if (newMetadata && newMetadata[targetIndex]) {\n                            delete newMetadata[targetIndex];\n                            metadataChanged = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    setTargetData(newData);\n    if (metadataChanged && setObjectMetadata) {\n        setObjectMetadata(newMetadata);\n    }\n};\n","import { useState, useRef, useEffect, useCallback } from 'react';\nimport { getFloodFillIndices, floodFill, paintTile as paintTileUtil } from '../editorTools/paintingTools';\n\nexport const useEditorPainting = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n    setTileMapData, setObjectMapData, setSecretMapData,\n    activeTool, brushSize, activeLayer, selectedTile, selection, \n    setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n    setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n    objectMetadata, setObjectMetadata,\n    maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n) => {\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [resizeState, setResizeState] = useState(null); // { index, edge, startX, startY, startW, startH }\n    const [moveState, setMoveState] = useState(null); // { index, startX, startY, objId, secretId, meta }\n    const bucketTimerRef = useRef(null);\n    const rightEraseRef = useRef(false);\n\n    const getLinkedRoomAt = useCallback((index) => {\n        if (!showRoomMapContent || !secretMapData || !objectMetadata) return null;\n        \n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n\n        // Scan for room areas\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                const rx = idx % mapWidth;\n                const ry = Math.floor(idx / mapWidth);\n                const rw = meta.width || 1;\n                const rh = meta.height || 1;\n\n                if (x >= rx && x < rx + rw && y >= ry && y < ry + rh) {\n                    return {\n                        mapId: meta.linkedMapId,\n                        roomX: rx,\n                        roomY: ry,\n                        roomWidth: rw,\n                        roomHeight: rh,\n                        localX: x - rx,\n                        localY: y - ry,\n                        map: maps[meta.linkedMapId]\n                    };\n                }\n            }\n        }\n        return null;\n    }, [showRoomMapContent, secretMapData, objectMetadata, maps, mapWidth]);\n\n    const paintTile = useCallback((index, overrideSelectedTile) => {\n        const effectiveTile = overrideSelectedTile !== undefined ? overrideSelectedTile : selectedTile;\n        const linkedRoom = getLinkedRoomAt(index);\n        \n        if (linkedRoom && showRoomMapContent) {\n            const { mapId, localX, localY, map } = linkedRoom;\n            const rWidth = map.mapWidth;\n            const rHeight = map.mapHeight;\n            const roomIndex = localY * rWidth + localX;\n\n            const setRoomData = (layer, newData) => {\n                updateMapData(mapId, { [layer]: newData });\n            };\n\n            const setRoomMetadata = (newMeta) => {\n                updateMapData(mapId, { objectMetadata: newMeta });\n            };\n\n            paintTileUtil({\n            index: roomIndex,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile: effectiveTile,\n                mapWidth: rWidth,\n                mapHeight: rHeight,\n                tileMapData: map.tileMapData || [],\n                objectMapData: map.objectMapData || [],\n                secretMapData: map.secretMapData || [],\n                objectMetadata: map.objectMetadata || {},\n                setTileMapData: (data) => setRoomData('tileMapData', data),\n                setObjectMapData: (data) => setRoomData('objectMapData', data),\n                setSecretMapData: (data) => setRoomData('secretMapData', data),\n                setObjectMetadata: setRoomMetadata,\n                isRoomAreaVisible\n            });\n            return;\n        }\n\n        paintTileUtil({\n            index,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile: effectiveTile,\n            mapWidth,\n            mapHeight,\n            tileMapData,\n            objectMapData,\n            secretMapData,\n            objectMetadata,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData,\n            setObjectMetadata,\n            isRoomAreaVisible\n        });\n    }, [getLinkedRoomAt, showRoomMapContent, updateMapData, activeTool, brushSize, activeLayer, selectedTile, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, isRoomAreaVisible]);\n\n    const handleResizeStart = useCallback((index, edge) => {\n        const meta = objectMetadata[index] || {};\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setResizeState({\n            index,\n            edge,\n            startX: x,\n            startY: y,\n            startW: meta.width || 1,\n            startH: meta.height || 1\n        });\n        setIsDragging(true);\n    }, [objectMetadata, mapWidth, setIsDragging]);\n\n    const handleMoveStart = useCallback((index) => {\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setMoveState({\n            index,\n            startX: x,\n            startY: y,\n            objId: objectMapData[index],\n            secretId: secretMapData[index],\n            meta: objectMetadata[index] ? { ...objectMetadata[index] } : null\n        });\n        setIsDragging(true);\n        setHighlightedIndex(index);\n    }, [objectMapData, secretMapData, objectMetadata, mapWidth, setIsDragging, setHighlightedIndex]);\n\n    const handleGridMouseDown = useCallback((index, e) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n        const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n        const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n        \n        const mTileMapData = useLinked ? linkedRoom.map.tileMapData : tileMapData;\n        const mObjectMapData = useLinked ? linkedRoom.map.objectMapData : objectMapData;\n        const mSecretMapData = useLinked ? linkedRoom.map.secretMapData : secretMapData;\n        const mObjectMetadata = useLinked ? linkedRoom.map.objectMetadata : objectMetadata;\n\n        const mSetTileMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { tileMapData: data }) : setTileMapData;\n        const mSetObjectMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMapData: data }) : setObjectMapData;\n        const mSetSecretMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { secretMapData: data }) : setSecretMapData;\n        const mSetObjectMetadata = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMetadata: data }) : setObjectMetadata;\n\n        // Quick select for configurable objects\n        const existingObjId = mObjectMapData[mIndex];\n        const existingSecretId = mSecretMapData[mIndex];\n        const isEraser = selectedTile === null && activeTool === 'brush';\n        const isRoomMap = maps[activeMapId]?.type === 'room';\n\n        if (!isEraser && (existingObjId || existingSecretId) && setActivePanel && setHighlightedIndex) {\n            const objDef = existingObjId ? registryItems?.find(r => r.id === existingObjId) : null;\n            const secretDef = existingSecretId ? registryItems?.find(r => r.id === existingSecretId) : null;\n\n            const isWeather = objDef && objDef.type === 'weather_trigger';\n            const isMessage = objDef && objDef.type === 'message_trigger';\n            const isPortalOrTarget = existingObjId && (existingObjId.includes('portal') || existingObjId.includes('target') || existingObjId === 'portal_target');\n            const isDoor = objDef && objDef.subtype === 'door';\n            const isRoomArea = secretDef && secretDef.subtype === 'room' && !isRoomMap;\n\n            if (isWeather || isMessage || isPortalOrTarget || isDoor || isRoomArea) {\n                setActivePanel('props');\n                setHighlightedIndex(useLinked ? index : mIndex);\n            }\n        }\n\n        if (activeTool === 'brush') {\n            const isRightErase = e.button === 2;\n            rightEraseRef.current = isRightErase;\n            if (isRightErase) {\n                e.preventDefault();\n                setIsDragging(true);\n                paintTile(index, null);\n                return;\n            }\n            setIsDragging(true);\n            paintTile(index);\n        } else if (activeTool === 'area') {\n            setIsDragging(true);\n            setDragStart({ x: index % mapWidth, y: Math.floor(index / mapWidth) });\n        } else if (activeTool === 'bucket') {\n            const isPropsLayer = activeLayer === 'props';\n            const targetLayer = isPropsLayer ? 'object' : activeLayer;\n            const targetData = targetLayer === 'tile' ? mTileMapData : (targetLayer === 'object' ? mObjectMapData : mSecretMapData);\n            const targetValue = targetData[mIndex];\n            const newValue = selectedTile ? selectedTile.id : null;\n            if (targetValue === newValue) return;\n\n            const newData = floodFill(mIndex, newValue, targetData, mWidth, mHeight);\n            \n            if (targetLayer === 'tile') mSetTileMapData(newData);\n            else if (targetLayer === 'object') {\n                mSetObjectMapData(newData);\n                // Clean up metadata for all affected indices if erasing\n                if (newValue === null && mObjectMetadata && mSetObjectMetadata) {\n                    const affectedIndices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                    let metaChanged = false;\n                    const newMeta = { ...mObjectMetadata };\n                    affectedIndices.forEach(idx => {\n                        if (newMeta[idx]) {\n                            delete newMeta[idx];\n                            metaChanged = true;\n                        }\n                    });\n                    if (metaChanged) mSetObjectMetadata(newMeta);\n                }\n            }\n            else mSetSecretMapData(newData);\n        } else if (activeTool === 'move') {\n            if (selection) return;\n\n            // If we clicked on an object/secret, start moving it\n            if (existingObjId || existingSecretId) {\n                handleMoveStart(mIndex); // Note: move/resize on linked rooms might still be buggy\n            } else {\n                const x = index % mapWidth;\n                const y = Math.floor(index / mapWidth);\n                setDragStart({ x, y });\n                setIsDragging(true);\n            }\n        }\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, setActivePanel, setHighlightedIndex, registryItems, activeTool, setIsDragging, paintTile, activeLayer, selectedTile, selection, handleMoveStart, setDragStart, getLinkedRoomAt, showRoomMapContent, updateMapData]);\n\n    const handleGridMouseMove = useCallback((index) => {\n        setHoverIndex(index);\n        const curX = index % mapWidth;\n        const curY = Math.floor(index / mapWidth);\n\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        if (resizeState) {\n            // Resize logic - keep on active map for now as it's complex\n            const dx = curX - resizeState.startX;\n            const dy = curY - resizeState.startY;\n            let newW = resizeState.startW;\n            let newH = resizeState.startH;\n            let newIndex = resizeState.index;\n\n            if (resizeState.edge === 'right') newW = Math.max(1, resizeState.startW + dx);\n            if (resizeState.edge === 'bottom') newH = Math.max(1, resizeState.startH + dy);\n            \n            if (resizeState.edge === 'left') {\n                const shift = Math.min(resizeState.startW - 1, dx);\n                newW = resizeState.startW - shift;\n                newIndex = resizeState.startY * mapWidth + (resizeState.startX + shift);\n            }\n            if (resizeState.edge === 'top') {\n                const shift = Math.min(resizeState.startH - 1, dy);\n                newH = resizeState.startH - shift;\n                newIndex = (resizeState.startY + shift) * mapWidth + resizeState.startX;\n            }\n\n            if (newW !== (objectMetadata[resizeState.index]?.width || 1) || \n                newH !== (objectMetadata[resizeState.index]?.height || 1) ||\n                newIndex !== resizeState.index) {\n                \n                const meta = { ...objectMetadata[resizeState.index] };\n                meta.width = newW;\n                meta.height = newH;\n                \n                setObjectMetadata(prev => {\n                    const next = { ...prev };\n                    delete next[resizeState.index];\n                    next[newIndex] = meta;\n                    return next;\n                });\n\n                if (newIndex !== resizeState.index) {\n                    const objId = objectMapData[resizeState.index];\n                    const secretId = secretMapData[resizeState.index];\n                    setObjectMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = objId;\n                        return next;\n                    });\n                    setSecretMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = secretId;\n                        return next;\n                    });\n                    setResizeState(prev => ({ ...prev, index: newIndex, startX: newIndex % mapWidth, startY: Math.floor(newIndex / mapWidth), startW: newW, startH: newH }));\n                    setHighlightedIndex(newIndex);\n                }\n            }\n        } else if (moveState) {\n            if (index === moveState.index) return;\n            \n            // Perform move\n            setObjectMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.objId;\n                return next;\n            });\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.secretId;\n                return next;\n            });\n            setObjectMetadata(prev => {\n                const next = { ...prev };\n                delete next[moveState.index];\n                if (moveState.meta) next[index] = moveState.meta;\n                return next;\n            });\n            setMoveState(prev => ({ ...prev, index, startX: curX, startY: curY }));\n            setHighlightedIndex(index);\n\n        } else if (activeTool === 'brush' && isDragging) {\n            const shouldErase = rightEraseRef.current;\n            paintTile(index, shouldErase ? null : undefined);\n        } else if (activeTool === 'bucket') {\n            if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = setTimeout(() => {\n                const targetLayer = activeLayer === 'props' ? 'object' : activeLayer;\n                \n                const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n                const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n                const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n                const mData = useLinked ? linkedRoom.map : { tileMapData, objectMapData, secretMapData };\n                \n                const targetData = targetLayer === 'tile' ? mData.tileMapData : (targetLayer === 'object' ? mData.objectMapData : mData.secretMapData);\n                const indices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                \n                if (useLinked) {\n                    // We need to convert linked room indices back to main map indices for preview?\n                    // Or just skip preview for linked rooms for now to keep it simple.\n                    setBucketPreviewIndices(new Set()); \n                } else {\n                    setBucketPreviewIndices(indices);\n                }\n            }, 10);\n        }\n    }, [setHoverIndex, activeTool, isDragging, paintTile, activeLayer, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight, setBucketPreviewIndices, resizeState, moveState, objectMetadata, setObjectMetadata, setObjectMapData, setSecretMapData, setHighlightedIndex, getLinkedRoomAt, showRoomMapContent]);\n\n    const handleGridMouseUp = useCallback((index) => {\n        if (activeTool === 'area' && isDragging && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n            const baseIndex = y1 * mapWidth + x1;\n\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[baseIndex] = 'room_area';\n                return next;\n            });\n            setObjectMetadata(prev => ({\n                ...prev,\n                [baseIndex]: { ...prev[baseIndex], width: w, height: h, roomName: 'New Room' }\n            }));\n            setHighlightedIndex(baseIndex);\n            if (setActivePanel) setActivePanel('props');\n            setIsDragging(false);\n            setDragStart(null);\n            return;\n        }\n\n        if (activeTool === 'move' && isDragging && !resizeState && !moveState && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const tileData = [];\n            const objectData = [];\n            const secretData = [];\n            const selectionMetadata = {};\n\n            for (let y = y1; y <= y2; y++) {\n                for (let x = x1; x <= x2; x++) {\n                    const idx = y * mapWidth + x;\n                    tileData.push(tileMapData[idx]);\n                    objectData.push(objectMapData[idx]);\n                    secretData.push(secretMapData[idx]);\n                    if (objectMetadata[idx]) {\n                        selectionMetadata[`${x - x1},${y - y1}`] = { ...objectMetadata[idx] };\n                    }\n                }\n            }\n\n            setSelection({\n                x: x1, y: y1, w, h,\n                originalX: x1, originalY: y1,\n                tileData, objectData, secretData,\n                metadata: selectionMetadata\n            });\n            setPreviewPosition({ x: x1, y: y1 });\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            });\n            setDragStart(null);\n        }\n\n        rightEraseRef.current = false;\n        setIsDragging(false);\n        setResizeState(null);\n        setMoveState(null);\n    }, [activeTool, isDragging, resizeState, moveState, dragStart, mapWidth, tileMapData, objectMapData, secretMapData, setSelection, setPreviewPosition, setOriginalMapData, setDragStart, setIsDragging]);\n\n    return {\n        hoverIndex,\n        setHoverIndex,\n        bucketPreviewIndices,\n        setBucketPreviewIndices,\n        handleGridMouseDown,\n        handleGridMouseMove,\n        handleGridMouseUp,\n        handleResizeStart,\n        handleMoveStart,\n        paintTile\n    };\n};\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { resizeMapData } from './editorTools/mapOperations';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './editorTools/NewMapModal';\nimport { BuiltInMapsModal } from './editorTools/BuiltInMapsModal';\nimport { EditorScene } from './EditorScene';\nimport { EditorElements } from './EditorElements';\nimport { EditorTools } from './EditorTools';\nimport PixiStage from '../game/PixiStage';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\n// Custom Hooks\nimport { useEditorRegistry } from './hooks/useEditorRegistry';\nimport { useEditorSelection } from './hooks/useEditorSelection';\nimport { useEditorPlayMode } from './hooks/useEditorPlayMode';\nimport { useEditorOperations } from './hooks/useEditorOperations';\nimport { useEditorPainting } from './hooks/useEditorPainting';\nimport { useEditorMaps } from './hooks/useEditorMaps';\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nexport const Editor = () => {\n    const registryItems = useMemo(() => getRegistry() || [], []);\n    const playerVisuals = useMemo(() => registryItems.find(item => item.id === 'player') || EMPTY_OBJECT, [registryItems]);\n\n    // Basic Map State\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [objectMetadata, setObjectMetadata] = useState({});\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n    const [showBackgroundImage, setShowBackgroundImage] = useState(true);\n    const [showMessages, setShowMessages] = useState(() => {\n        try {\n            const v = localStorage.getItem('editor_show_messages');\n            if (v === null) return true;\n            return v !== '0';\n        } catch {\n            return true;\n        }\n    });\n\n    // Tools & Modes State\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [isRoomAreaVisible, setIsRoomAreaVisible] = useState(false);\n    const [showRoomMapContent, setShowRoomMapContent] = useState(false);\n    const [isWorldViewOpen, setIsWorldViewOpen] = useState(false);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata });\n\n    // Metadata State\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [mapDescription, setMapDescription] = useState(\"\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [highlightedIndex, setHighlightedIndex] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [isBuiltInMapsModalOpen, setIsBuiltInMapsModalOpen] = useState(false);\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n    const [tempMapDescription, setTempMapDescription] = useState(\"\");\n    const [activePanel, setActivePanel] = useState(null);\n\n    // Asset Options\n    const backgroundOptions = useMemo(() => loadBackgroundOptions(), []);\n    const musicOptions = useMemo(() => loadMusicOptions(), []);\n\n    // Background State\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#99C1F1');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    // Weather State\n    const [weatherRain, setWeatherRain] = useState(0);\n    const [weatherSnow, setWeatherSnow] = useState(0);\n    const [weatherClouds, setWeatherClouds] = useState(0);\n    const [weatherFog, setWeatherFog] = useState(0);\n    const [weatherThunder, setWeatherThunder] = useState(0);\n    const [weatherLavaRain, setWeatherLavaRain] = useState(0);\n    const [weatherRadioactiveFog, setWeatherRadioactiveFog] = useState(0);\n    const [weatherMeteorRain, setWeatherMeteorRain] = useState(0);\n\n    const [playerPosition, setPlayerPosition] = useState({ x: 100, y: 100 });\n\n    useEffect(() => {\n        try { localStorage.setItem('editor_show_messages', showMessages ? '1' : '0'); } catch {}\n    }, [showMessages]);\n\n    // Multi-map state\n    const { \n        maps, setMaps, activeMapId, setActiveMapId, createMap: createNewMap, updateMapData, deleteMap \n    } = useEditorMaps();\n\n    const lastActiveMapIdRef = useRef(activeMapId);\n\n    const switchMap = useCallback((newMapId, spawnTriggerId = null) => {\n        if (newMapId === activeMapId) return;\n\n        // 1. Save current map data to store\n        updateMapData(activeMapId, {\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n            weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n            playerPosition\n        });\n\n        // 2. Load new map data\n        const nextMap = maps[newMapId];\n        if (nextMap) {\n            setMapWidth(nextMap.mapWidth);\n            setMapHeight(nextMap.mapHeight);\n            setTileMapData(nextMap.tileMapData);\n            setObjectMapData(nextMap.objectMapData);\n            setSecretMapData(nextMap.secretMapData);\n            setObjectMetadata(nextMap.objectMetadata || {});\n            setCreatedAt(nextMap.createdAt || new Date().toISOString());\n            setSelectedBackgroundImage(nextMap.selectedBackgroundImage);\n            setSelectedBackgroundColor(nextMap.selectedBackgroundColor);\n            setBackgroundParallaxFactor(nextMap.backgroundParallaxFactor || 0.3);\n            setSelectedBackgroundMusic(nextMap.selectedBackgroundMusic);\n            \n            if (nextMap.weather) {\n                setWeatherRain(nextMap.weather.rain || 0);\n                setWeatherSnow(nextMap.weather.snow || 0);\n                setWeatherClouds(nextMap.weather.clouds || 0);\n                setWeatherFog(nextMap.weather.fog || 0);\n                setWeatherThunder(nextMap.weather.thunder || 0);\n                setWeatherLavaRain(nextMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(nextMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(nextMap.weather.meteorRain || 0);\n            }\n            \n            if (nextMap.playerPosition) {\n                setPlayerPosition(nextMap.playerPosition);\n            }\n            \n            // If we have a spawnTriggerId, we might want to store it temporarily\n            // so useEditorPlayMode can include it in mapDataForGame.meta\n            // But actually, we can just update the map data in the store with this triggerId.\n            if (spawnTriggerId !== null) {\n                updateMapData(newMapId, { ...nextMap, spawnTriggerId });\n            }\n\n            setActiveMapId(newMapId);\n        }\n    }, [\n        activeMapId, maps, updateMapData, setActiveMapId,\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const handleCreateMap = useCallback((type, name, width, height) => {\n        const finalName = name || prompt(`Enter ${type} map name:`, `New ${type.charAt(0).toUpperCase() + type.slice(1)}`);\n        if (finalName) {\n            const finalWidth = width || mapWidth;\n            const finalHeight = height || mapHeight;\n            const newId = createNewMap(type, finalName, finalWidth, finalHeight);\n            return newId;\n        }\n    }, [createNewMap, mapWidth, mapHeight]);\n\n    // Update store when current map data changes (for minimap preview)\n    useEffect(() => {\n        // Skip update if activeMapId just changed to prevent overwriting new map data with old map state\n        if (lastActiveMapIdRef.current !== activeMapId) {\n            lastActiveMapIdRef.current = activeMapId;\n            return;\n        }\n\n        const timeout = setTimeout(() => {\n            updateMapData(activeMapId, {\n                mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n                selectedBackgroundImage, selectedBackgroundColor,\n                selectedBackgroundMusic, backgroundParallaxFactor,\n                weather: {\n                    rain: weatherRain,\n                    snow: weatherSnow,\n                    clouds: weatherClouds,\n                    fog: weatherFog,\n                    thunder: weatherThunder,\n                    lavaRain: weatherLavaRain,\n                    radioactiveFog: weatherRadioactiveFog,\n                    meteorRain: weatherMeteorRain\n                },\n                playerPosition\n            });\n        }, 1000); // Debounce store updates\n        return () => clearTimeout(timeout);\n    }, [\n        activeMapId, updateMapData, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, selectedBackgroundMusic, backgroundParallaxFactor,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    // Use Custom Hooks\n    const { \n        blocks, liquids, entities, decorations, items, interactables, hazards, secrets, weather, messages, crackableWalls, pushableWalls, obstacles \n    } = useEditorRegistry(registryItems);\n\n    const { \n        selection, setSelection, selectionMode, setSelectionMode, previewPosition, setPreviewPosition,\n        originalMapData, setOriginalMapData, moveSelection, commitSelection, cancelSelection \n    } = useEditorSelection(mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata);\n\n    const {\n        isPlayMode, handlePlay, handlePause, handleReset, handleReplay, handleStateUpdate, handleForceStop,\n        playModeObjectData, playModeSecretData, playModeWeather, playModeMaps, gameMessage, revealedSecrets, \n        activeRoomIds, gameEngineState, isGameOver\n    } = useEditorPlayMode(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n        registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        maps, activeMapId, switchMap, maps[activeMapId]?.spawnTriggerId,\n        setTileMapData, updateMapData\n    );\n\n    const {\n        handleSaveMap, handleLoadMap, handleLoadBuiltInMap, handleClearMap, openNewMapModal, confirmNewMap\n    } = useEditorOperations(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        maps, setMaps, activeMapId, setActiveMapId\n    );\n\n    const handleLoadMapWrapped = useCallback((event) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadMap(event);\n    }, [isPlayMode, handleForceStop, handleLoadMap]);\n\n    const handleLoadBuiltInMapWrapped = useCallback((mapData) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadBuiltInMap(mapData);\n    }, [isPlayMode, handleForceStop, handleLoadBuiltInMap]);\n\n    const {\n        hoverIndex, setHoverIndex, bucketPreviewIndices, setBucketPreviewIndices,\n        handleGridMouseDown, handleGridMouseMove, handleGridMouseUp,\n        handleResizeStart, handleMoveStart, paintTile\n    } = useEditorPainting(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n        setTileMapData, setObjectMapData, setSecretMapData,\n        activeTool, brushSize, activeLayer, selectedTile, selection, \n        setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n        setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n        objectMetadata, setObjectMetadata,\n        maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n    );\n\n    // Side Effects\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    const togglePanel = (panel) => {\n        setActivePanel(prev => prev === panel ? null : panel);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n        resizeMapData({\n            newWidth, newHeight, stateRef, setMapWidth, setMapHeight,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata\n        });\n    };\n\n    const handlePaletteSelect = useCallback((item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    }, []);\n\n    // Grid Event Handlers\n    \n    const handleGridMouseLeave = useCallback(() => {\n        setHoverIndex(null);\n        setBucketPreviewIndices(new Set());\n    }, [setHoverIndex, setBucketPreviewIndices]);\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    const onAddRoomArea = useCallback(() => {\n        setIsWorldViewOpen(false);\n        setActiveTool('area');\n        setActiveLayer('secret');\n    }, []);\n\n    const handleDeleteMap = useCallback((id) => {\n        if (id === activeMapId) {\n            switchMap('main');\n        }\n        deleteMap(id);\n    }, [activeMapId, switchMap, deleteMap]);\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\n            <NewMapModal \n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                tempMapDescription={tempMapDescription}\n                setTempMapDescription={setTempMapDescription}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <BuiltInMapsModal \n                isOpen={isBuiltInMapsModalOpen}\n                onClose={() => setIsBuiltInMapsModalOpen(false)}\n                onSelect={handleLoadBuiltInMapWrapped}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', flex: 1, flexDirection: 'row',\n                filter: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'none' : 'auto',\n                overflow: 'hidden'\n            }}>\n                <EditorElements \n                    mapName={mapName}\n                    creatorName={creatorName}\n                    mapDescription={mapDescription}\n                    setMapName={setMapName}\n                    setCreatorName={setCreatorName}\n                    setMapDescription={setMapDescription}\n                    openNewMapModal={openNewMapModal}\n                    openBuiltInModal={() => setIsBuiltInMapsModalOpen(true)}\n                    saveMap={handleSaveMap}\n                    loadMap={handleLoadMapWrapped}\n                    clearMap={handleClearMap}\n                    isPlayMode={isPlayMode}\n                    handlePaletteSelect={handlePaletteSelect}\n                    selectedTile={selectedTile}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    decorations={decorations}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    weather={weather}\n                    messages={messages}\n                    crackableWalls={crackableWalls}\n                    pushableWalls={pushableWalls}\n                    obstacles={obstacles}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    objectMapData={objectMapData}\n                    secretMapData={secretMapData}\n                    objectMetadata={objectMetadata}\n                    setObjectMetadata={setObjectMetadata}\n                    registryItems={registryItems}\n                    highlightedIndex={highlightedIndex}\n                    setHighlightedIndex={setHighlightedIndex}\n                    activePanel={activePanel}\n                    setActivePanel={setActivePanel}\n                    togglePanel={togglePanel}\n                    maps={maps}\n                    activeMapId={activeMapId}\n                    createMap={handleCreateMap}\n                />\n\n                <div style={{ display: 'flex', flex: 1, flexDirection: 'column', overflow: 'hidden' }}>\n                    <EditorTools\n                        mapName={mapName}\n                        creatorName={creatorName}\n                        activePanel={activePanel}\n                        togglePanel={togglePanel}\n                        showGrid={showGrid}\n                        setShowGrid={setShowGrid}\n                        isPlayMode={isPlayMode}\n                        handlePlay={handlePlay}\n                        handlePause={handlePause}\n                        handleReset={handleReset}\n                        activeTool={activeTool}\n                        setActiveTool={setActiveTool}\n                        brushSize={brushSize}\n                        setBrushSize={setBrushSize}\n                        activeLayer={activeLayer}\n                        selection={selection}\n                        moveSelection={moveSelection}\n                        selectionMode={selectionMode}\n                        setSelectionMode={setSelectionMode}\n                        commitSelection={commitSelection}\n                        cancelSelection={cancelSelection}\n                        selectedTile={selectedTile}\n                        handlePaletteSelect={handlePaletteSelect}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        showBackgroundImage={showBackgroundImage}\n                        setShowBackgroundImage={setShowBackgroundImage}\n                        showMessages={showMessages}\n                        setShowMessages={setShowMessages}\n                        isRoomAreaVisible={isRoomAreaVisible}\n                        setIsRoomAreaVisible={setIsRoomAreaVisible}\n                        showRoomMapContent={showRoomMapContent}\n                        setShowRoomMapContent={setShowRoomMapContent}\n                    />\n                    \n                    <div style={{ display: 'flex', flex: 1, flexDirection: 'row', overflow: 'hidden', position: 'relative' }}>\n\n                    <EditorScene \n                        handleMapResize={handleMapResize}\n                        isResizeWindowOpen={isResizeWindowOpen}\n                        setIsResizeWindowOpen={setIsResizeWindowOpen}\n                        isWorldViewOpen={isWorldViewOpen}\n                        setIsWorldViewOpen={setIsWorldViewOpen}\n                        onAddRoomArea={onAddRoomArea}\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                        // Multi-map props\n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        createMap={handleCreateMap}\n                        deleteMap={handleDeleteMap}\n                        updateMapData={updateMapData}\n                        showRoomMapContent={showRoomMapContent}\n                        activeRoomIds={activeRoomIds}\n                    />\n\n                    {!isPlayMode ? (\n                        <Viewport\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            selectedBackgroundUrl={selectedBackgroundUrl}\n                            selectedBackgroundColor={selectedBackgroundColor}\n                            selectedBackgroundImage={selectedBackgroundImage}\n                            showBackgroundImage={showBackgroundImage}\n                            showGrid={showGrid}\n                            activeLayer={activeLayer}\n                            activeTool={activeTool}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            hoverIndex={hoverIndex}\n                            highlightedIndex={highlightedIndex}\n                            brushSize={brushSize}\n                            bucketPreviewIndices={bucketPreviewIndices}\n                            selection={selection}\n                            previewPosition={previewPosition}\n                            dragStart={dragStart}\n                            isDragging={isDragging}\n                            selectedTile={selectedTile}\n                            handleGridMouseDown={handleGridMouseDown}\n                            handleGridMouseEnter={handleGridMouseMove}\n                            handleGridMouseUp={handleGridMouseUp}\n                            handleGridMouseLeave={handleGridMouseLeave}\n                            handleResizeStart={handleResizeStart}\n                            handleMoveStart={handleMoveStart}\n                            setIsDragging={setIsDragging}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            mapType={maps[activeMapId]?.type || 'overworld'}\n                            isRoomAreaVisible={isRoomAreaVisible}\n                            showRoomMapContent={showRoomMapContent}\n                            showMessages={showMessages}\n                            maps={maps}\n                        />\n                    ) : (\n                        <div style={{ flex: 1, position: 'relative', backgroundColor: '#000' }}>\n                            <PixiStage\n                                mapWidth={mapWidth}\n                                mapHeight={mapHeight}\n                                tileSize={TILE_SIZE}\n                                tileMapData={tileMapData}\n                                objectMapData={playModeObjectData}\n                                secretMapData={playModeSecretData}\n                                revealedSecrets={revealedSecrets || []}\n                                registryItems={registryItems}\n                                playerState={gameEngineState}\n                                playerVisuals={playerVisuals}\n                                projectiles={gameEngineState?.projectiles || []}\n                                objectMetadata={objectMetadata}\n                                backgroundImage={showBackgroundImage ? selectedBackgroundImage : null}\n                                backgroundColor={selectedBackgroundColor}\n                                backgroundParallaxFactor={backgroundParallaxFactor}\n                                weatherRain={playModeWeather.rain}\n                                weatherLavaRain={playModeWeather.lavaRain}\n                                weatherSnow={playModeWeather.snow}\n                                weatherMeteorRain={playModeWeather.meteorRain}\n                                weatherClouds={playModeWeather.clouds}\n                                weatherFog={playModeWeather.fog}\n                                weatherRadioactiveFog={playModeWeather.radioactiveFog}\n                                weatherThunder={playModeWeather.thunder}\n                                onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                                isEditor={false}\n                                isEditorPlayMode={true}\n                                showGrid={showGrid}\n                            mapType={(playModeMaps?.[activeMapId]?.type || maps[activeMapId]?.type) || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={playModeMaps || maps}\n                        />\n                            {isGameOver && (\n                                <GameOverOverlay>\n                                    <GameOverTitle>Game Over</GameOverTitle>\n                                    <ReplayButton onClick={handleReplay}>\n                                        REPLAY \n                                    </ReplayButton>\n                                </GameOverOverlay>\n                            )}\n                            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    </div>\n);\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import { useState, useCallback } from 'react';\n\nexport const useEditorMaps = () => {\n    const [maps, setMaps] = useState({\n        'main': {\n            id: 'main',\n            name: 'Main',\n            description: '',\n            type: 'overworld',\n            mapWidth: 20,\n            mapHeight: 15,\n            tileMapData: Array(20 * 15).fill(null),\n            objectMapData: Array(20 * 15).fill(null),\n            secretMapData: Array(20 * 15).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: '#99C1F1',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: { x: 100, y: 100 },\n            worldX: 50,\n            worldY: 50\n        }\n    });\n    const [activeMapId, setActiveMapId] = useState('main');\n\n    const createMap = useCallback((type, name, width = 20, height = 15) => {\n        const id = `map_${Date.now()}`;\n        \n        // Find a good spot for new map\n        const existingMaps = Object.values(maps);\n        const maxY = Math.max(...existingMaps.map(m => m.worldY || 0), 0);\n        \n        const newMap = {\n            id,\n            name: name || (type === 'overworld' ? 'New Overworld' : 'New Underworld'),\n            description: '',\n            type,\n            mapWidth: width,\n            mapHeight: height,\n            tileMapData: Array(width * height).fill(null),\n            objectMapData: Array(width * height).fill(null),\n            secretMapData: Array(width * height).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: type === 'overworld' ? '#99C1F1' : '#1a1a1a',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: null, // Only one map should have player eventually\n            worldX: 50,\n            worldY: maxY + 150\n        };\n\n        setMaps(prev => ({\n            ...prev,\n            [id]: newMap\n        }));\n        return id;\n    }, []);\n\n    const updateMapData = useCallback((id, data) => {\n        setMaps(prev => ({\n            ...prev,\n            [id]: {\n                ...prev[id],\n                ...data\n            }\n        }));\n    }, []);\n\n    const deleteMap = useCallback((id) => {\n        if (id === 'main') return; // Cannot delete main map\n        setMaps(prev => {\n            const newMaps = { ...prev };\n            delete newMaps[id];\n            return newMaps;\n        });\n        if (activeMapId === id) {\n            setActiveMapId('main');\n        }\n    }, [activeMapId]);\n\n    return {\n        maps,\n        setMaps,\n        activeMapId,\n        setActiveMapId,\n        createMap,\n        updateMapData,\n        deleteMap\n    };\n};\n","import { useMemo } from 'react';\n\nexport const useEditorRegistry = (registryItems) => {\n    const blocks = useMemo(() => \n        registryItems.filter(item => {\n            if (!item.name || !item.name.startsWith('block.')) return false;\n            if (item.flags && item.flags.liquid) return false;\n            if (item.editor && item.editor.panel && item.editor.panel !== 'blocks') return false;\n            return true;\n        }), \n    [registryItems]);\n\n    const liquids = useMemo(() => \n        registryItems.filter(item => item.flags && item.flags.liquid), \n    [registryItems]);\n\n    const entities = useMemo(() => {\n        const baseEntities = registryItems.filter(item => {\n            if (!item.name || !item.name.toLowerCase().includes('entities.')) return false;\n            if (item.isHiddenInEditor) return false;\n            return !item.type || item.type === 'default' || item.type === 'entity' || item.subtype === 'tank';\n        });\n\n        const itemsToMove = registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            item.id !== 'hertz_item' && \n            item.id !== 'fireball_ammo'\n        );\n\n        return [...baseEntities, ...itemsToMove];\n    }, [registryItems]);\n\n    const decorations = useMemo(() => \n        registryItems.filter(item => {\n            if (item.type === 'decoration') return true;\n            if (item.name && item.name.toLowerCase().includes('decoration.')) return true;\n            if (item.id && item.id.includes('stone_pack')) return true;\n            return false;\n        }), \n    [registryItems]);\n\n    const items = useMemo(() => \n        registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            (item.id === 'hertz_item' || item.id === 'fireball_ammo')\n        ), \n    [registryItems]);\n\n    const interactables = useMemo(() => \n        registryItems.filter(item => {\n            if (item.editor && item.editor.panel) return item.editor.panel === 'interactables';\n            return item.type === 'interactable' || (item.name && item.name.startsWith('interactable.'));\n        }), \n    [registryItems]);\n\n    const hazards = useMemo(() => \n        registryItems.filter(item => item.type === 'hazard' || (item.name && item.name.startsWith('hazard.'))), \n    [registryItems]);\n\n    const secrets = useMemo(() => \n        registryItems.filter(item => item.type === 'secret'), \n    [registryItems]);\n\n    const weather = useMemo(() => \n        registryItems.filter(item => item.type === 'weather_trigger'), \n    [registryItems]);\n\n    const messages = useMemo(() => \n        registryItems.filter(item => item.type === 'message_trigger'), \n    [registryItems]);\n\n    const crackableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'crack_block'),\n    [registryItems]);\n\n    const pushableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'wolf_secret'),\n    [registryItems]);\n\n    const obstacles = useMemo(() => \n        registryItems.filter(item => item.type === 'obstacle' || (item.name && item.name.startsWith('obstacle.'))), \n    [registryItems]);\n\n    return {\n        blocks,\n        liquids,\n        entities,\n        decorations,\n        items,\n        interactables,\n        hazards,\n        secrets,\n        weather,\n        messages,\n        crackableWalls,\n        pushableWalls,\n        obstacles\n    };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nexport const useEditorSelection = (mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata) => {\n    const [selection, setSelection] = useState(null);\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n\n    const moveSelection = useCallback((dx, dy) => {\n        if (!selection || !previewPosition) return;\n        setPreviewPosition({ \n            x: previewPosition.x + dx, \n            y: previewPosition.y + dy \n        });\n    }, [selection, previewPosition]);\n\n    const cancelSelection = useCallback(() => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, []);\n\n    const commitSelection = useCallback(() => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n        const newObjectMetadata = { ...originalMapData.objectMetadata };\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                        delete newObjectMetadata[idx];\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                    \n                    if (selection.metadata && selection.metadata[`${px},${py}`]) {\n                        newObjectMetadata[destIdx] = { ...selection.metadata[`${px},${py}`] };\n                    }\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setObjectMetadata(newObjectMetadata);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, [selection, previewPosition, originalMapData, selectionMode, mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode, commitSelection, cancelSelection]);\n\n    return {\n        selection,\n        setSelection,\n        selectionMode,\n        setSelectionMode,\n        previewPosition,\n        setPreviewPosition,\n        originalMapData,\n        setOriginalMapData,\n        moveSelection,\n        commitSelection,\n        cancelSelection\n    };\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/Editor\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","activeMapData","tileMapData","objectMapData","secretMapData","objectMetadata","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","projectMaps","isLoading","error","isPaused","isGameOver","activeRoomIds","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","meta","maps","updateObjectMap","updateObjectMetadata","index","metadata","mapId","activeId","activeMapId","activeMap","targetId","removeObjectAtIndex","undefined","room","layerData","layers","find","l","type","data","length","removeTileAtIndex","moveTileInMap","fromIndex","toIndex","len","moveObjectInMap","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","forEach","idx","includes","push","toggleRoom","roomId","filter","clearRooms","setLoading","setError","setPaused","setGameOver","resetGame","actions","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","ui","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","lv_navigation_home","no_navigation","no_navigation_home","en_navigation","en_navigation_home","ru_navigation","ru_navigation_home","ja_navigation","ja_navigation_home","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","tutorial","lv_tutorial_messages","lv_game_map_selector","editor_elements","lv_editor_elements","editor_scene","lv_editor_scene","editor_tools","lv_editor_tools","no","no_tutorial_messages","no_game_map_selector","no_editor_elements","no_editor_scene","no_editor_tools","en","en_tutorial_messages","en_game_map_selector","en_editor_elements","en_editor_scene","en_editor_tools","ru","ru_tutorial_messages","ru_game_map_selector","ru_editor_elements","ru_editor_scene","ru_editor_tools","ja","ja_tutorial_messages","ja_game_map_selector","ja_editor_elements","ja_editor_scene","ja_editor_tools","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","SettingsButton","props","$soundOff","DropdownContainer","div","DropdownMenu","MenuItem","ToggleSwitch","$active","SectionHeaderNavigationLanguages","dropdownRef","useRef","isMenuOpen","setIsMenuOpen","useState","soundEnabled","setSoundEnabled","v","localStorage","getItem","currentLang","language","handleLanguageChange","newLang","changeLanguage","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","ref","title","toggleSound","next","setItem","CustomEvent","detail","enabled","height","backgroundColor","margin","padding","color","StyledLogo","p","SectionHeaderNavigationLogo","tag","trim","toLowerCase","StyledSectionHeaderNavigation","StyledSectionContent","_registry","_registryMap","initRegistry","console","time","jsonContext","require","imageContext","soundContext","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","resolveSoundsMap","sounds","Array","isArray","k","entries","key","item","resolvedTexture","texture","resolvedTextures","textures","path","sfx","sfxResolved","defaultAnimation","animItem","r","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","Map","set","__byId","log","timeEnd","getRegistry","findItemById","get","items","flexDirection","justifyContent","alignItems","width","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","apiUrl","env","REACT_APP_API_URL","logo","URL_LOGO_01","URL_LOGO_02","URL_LOGO_03","URL_LOGO_04","URL_LOGO_05","HomeContainer","Home","LOGO_01","config","LOGO_02","LOGO_03","LOGO_04","LOGO_05","src","alt","TextureCache","constructor","this","_map","url","m","has","tex","Texture","from","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","maxParticles","resize","area","Math","max","floor","setIntensity","min","Number","spawnOne","g","Graphics","rect","fill","alpha","viewport","getViewport","x","y","random","speed","vx","vy","rotation","addChild","bounces","alive","update","dtMs","targetIntensity","abs","lerpFactor","exp","norm","scaled","pow","deficit","maxPerFrame","smooth","ceil","toSpawn","i","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","strength","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","vY","vH","j","splice","WeatherSnow","flakes","seeded","maxFlakes","options","circle","minY","maxY","drift","settled","life","phase","restMs","viewportH","viewportY","seedCount","f","sin","sYwater","sYlava","gAcc","WeatherClouds","bandHeight","patches","windDirection","filters","BlurFilter","quality","rebuild","isInitial","w","h","vX","vW","range","rx","ry","circles","baseR","PI","dist","cx","cos","cy","targetAlpha","currentAlpha","dying","targetCount","W","bandTop","bandBottom","activePatches","_spawnTimer","toKill","osc","leftBound","rightBound","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","nv","_applyAlphas","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","moveTo","lineTo","stroke","alignment","cap","join","branchCount","ang","bx","by","worldX","maxH","isSolid","WeatherLavaRain","waterY","WeatherRadioactiveFog","WeatherMeteorRain","size","isLarge","atan2","waterTouched","playerState","getPlayerState","hitEntity","px","py","pr","dx","dy","entities","ent","ex","ey","er","edx","edy","onMeteorHit","surfaceType","liquidType","getLiquidTypeAt","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","count","spd","d","BubbleFX","bubbles","maxBubbles","rise","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","cur","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","bgContainer","_regions","_waterTex","_lavaTex","_quicksandTex","_waterfallTex","_lavaWaterfallTex","_radioactiveWaterTex","_radioactiveWaterfallTex","_time","_noiseTex","_lavaDetailTex","_waterDetailTex","_quicksandDetailTex","_playerState","setPlayerState","_checkPlayerInRegion","region","pw","ph","pt","tileIndicesSet","getSurfaceY","X","topEdges","bgNode","_gradTextures","mw","mh","ts","changed","waterDrift","lavaDrift","quicksandDrift","waterfallDrift","lavaWaterfallDrift","radioactiveWaterDrift","radioactiveWaterfallDrift","sprite","alphaDiff","splashG","bottomEdges","F","splashHeight","splashColor","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","ampNow","amp","capG","centerX","sigma","gauss","maxDisp","build","typeAt","liquid","lava_waterfall","radioactive_waterfall","waterfall","radioactive_water","quicksand","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","Set","bleed","_createLavaTexture","_createQuicksandTexture","_createWaterfallTexture","_createLavaWaterfallTexture","_createRadioactiveWaterfallTexture","_createRadioactiveWaterTexture","_createWaterTexture","source","addressMode","tiling","detailTex1","detailTex2","_createLavaDetailTexture","_createQuicksandDetailTexture","_createWaterDetailTexture","bgMask","bottomColor","_createGradientTexture","bgSprite","Sprite","_computeTopEdgeSpans","_computeBottomEdgeSpans","topColor","createLinearGradient","addColorStop","fillStyle","fillRect","globalAlpha","beginPath","arc","sw","sh","tilesByRow","above","rowList","cols","sort","start","prev","below","addWave","HealthBar","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","visible","c","pct","_redrawFill","roundRect","innerW","freeze","parallax","tiles","tilesAnim","liquidBackground","objBehind","secretsBelow","player","projectiles","objFront","secretsAbove","weather","fog","liquids","liquidFx","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","isWaterfallDef","isLavaWaterfallDef","isRadioactiveWaterDef","isRadioactiveWaterfallDef","ParallaxBackground","textureCache","cache","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","minWidth","minHeight","hex","parseInt","slice","solid","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","spriteSheet","frameIndex","totalSprites","columns","rows","frameWidth","frameHeight","col","row","Rectangle","frame","editorIcon","Text","dropShadow","dropShadowColor","dropShadowBlur","dropShadowDistance","anchor","createPlayerContainer","playerVisuals","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","hit","renderMapContent","refs","secretOverlays","targetBg","targetObjBehind","targetObjFront","isEditor","isEditorPlayMode","mapType","secretLayerRef","activeRoomIndices","roomWindowIndices","idxStr","linkedMapId","roomMap","rw","rh","rMapW","worldIdx","localIdx","roomTiles","roomObjs","add","bgColorStr","bgColorHex","substring","roomBg","objId","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","filterColor","filterColorInGame","renderAbove","renderAbovePlayer","renderOnSecretLayer","backingSprite","backing","isPushable","maxHealth","health","visualElement","healthPercent","currentFrame","interaction","inside","renderOffsetX","render","renderOffsetY","overlapX","overlapY","tileW","tileH","objWidth","objHeight","isLargeDecoration","anchorOffsetX","anchorOffsetY","isRoomContent","isWeatherTrigger","isMessageTrigger","isWolfSecret","shouldShowAnyway","isHiddenInGame","isDestructible","hb","renderSecretOverlays","overlays","drawOverlay","split","match","parseFloat","createBreakEffectLayer","layer","sortableChildren","createBreakEffectManager","lifeMs","gravity","shape","angleRange","chunks","angle","sp","maxLife","chunkCount","chunkSpeed","chunkLife","chunkSize","chunkGravity","chunkShape","chunkAngle","chunkColors","delta","getLiquidAtPixel","wx","wy","mapWidthTiles","mapHeightTiles","TILE_SIZE","tileData","getDefById","overlayColorRaw","overlayColor","tintBelowSurface","overlayAlphaRaw","overlayAlpha","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","oxygen","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","headY","chestY","feet","chest","head","candidate","inLiquid","headUnder","atSurface","defaultOverlay","rawOverlayColor","rawOverlayAlpha","tickLiquidDamage","deltaMs","accRef","gameState","HIT_FLASH_MS","hitTimerMs","setPreferences","skipCacheIdWarning","preferCreateImageBitmap","EMPTY_ARRAY","EMPTY_OBJECT","LIQUID_SURFACE_MAP","PixiStage","backgroundImage","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherLavaRain","weatherRadioactiveFog","weatherMeteorRain","healthBarEnabled","weatherFog","weatherThunder","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","showGrid","renderLayers","pointerEvents","onWeatherEffectHit","roomBlurEnabled","debugOverlayEnabled","isPixiReady","setIsPixiReady","mountRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","cameraPosRef","bgRef","bgAnimRef","bgImageRef","bgColorRef","objBehindRef","objFrontRef","roomBgRef","roomObjBehindRef","roomObjFrontRef","playerRef","playerLayerRef","playerSpriteRefs","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidBgLayerRef","liquidSystemRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","lavaRain","radioactiveFog","meteorRain","weatherPropsRef","tileMapDataRef","registryItemsRef","projectilesLayerRef","projectileSpritesRef","entitiesLayerRef","entitySpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","overlayLayerRef","underwaterRef","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","bubbleFxRef","fishBubbleStateRef","entityWaterStateRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","inWater","gridRef","showGridRef","roomBlurEnabledRef","blurFilterRef","darkenFilterRef","ColorMatrixFilter","roomBrightnessFilterRef","vignetteRef","floatingLayerRef","debugLayerRef","debugEnabledRef","floatingManagerRef","breakFxLayerRef","breakFxManagerRef","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","createSolidChecker","collision","top","bottom","left","right","rebuildParallax","useCallback","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","screen","destroyed","async","app","Application","resizeTo","backgroundAlpha","antialias","autoDensity","stage","renderer","bg","bgAnim","roomObjBehind","roomObjFront","secretBelowLayer","secretAboveLayer","playerLayer","entitiesLayer","weatherLayer","liquidBgLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","vignetteLayer","overlayLayer","floatingLayer","breakFxLayer","LAYERS","cfg","floatConfig","defaultCfg","critCfg","crit","ttlMs","amount","amountValue","critThreshold","threshold","isCrit","baseColor","finalColor","finalFontSize","finalTtl","riseSpeed","jitterY","finalText","prefix","suffix","label","String","fontFamily","strokeThickness","jitterXValue","jitterYValue","position","ttl","total","createFloatingTextManager","gridGraphics","debugGraphics","allLayersMap","objects","layerName","urlSet","addUrl","urls","playerComponents","innerHTML","appendChild","hbOverlay","oxyColors","oxyBar","lavaColors","lvBar","preventDefault","ticker","updatePlayerSprite","inLava","effectiveWidth","isHit","dir","direction","mag","scale","camX","camY","lastCam","rawX","rawY","smoothing","nextRawX","nextRawY","pivot","__PLAYER_POS__","deltaMS","systems","swNow","shNow","sNow","overlayL","headUnderWater","overlayCfg","liquidOverlay","showOverlay","maxTargetAlpha","pulseBase","fadeSpeed","lastLiquidType","fadeOutSpeed","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","baseX","baseY","hbO","show","nextBarY","maxOxy","maxOxygen","curOxy","maxLv","maxLavaResist","curLv","lavaResist","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","syncEntities","entitySpritesMap","entitiesList","_lastFrameIndex","isTextureReady","currentSpriteIndex","texWidth","texHeight","effectiveColumns","targetWidth","targetHeight","isNaN","flipY","absScaleX","absScaleY","ents","regs","liq","isFish","ai","fish","isAlive","isDormant","interval","bubbleIntervalMs","jitter","bubbleJitter","appToDestroy","values","cleanupProjectiles","cleanupEntities","handler","isInsideRoom","targetBlur","roomBrightness","reset","desaturate","brightness","grad","createRadialGradient","_vignetteSprite","tileCount","tileId","isLiquid","isRadio","radioactive","hasCollision","active","rebuildLayers","safeDestroy","removeChildren","child","roomAreaIndex","ox","oy","roomSecrets","roomOptions","selectedBackgroundColor","pLayer","tileDataString","JSON","stringify","prevTileDataString","_lastTileData","prepare","upload","runRebuild","tmd","entry","toSurfaceType","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","getFogIntensity","getLavaRainIntensity","getRadioactiveFogIntensity","getMeteorRainIntensity","propTypes","PropTypes","isRequired","resolveInteractableContext","objectLayerData","mainObjectMetadata","activeRoomIdsProp","centerY","hasMainMetadata","activeTargetMap","activeObjectData","activeMetadata","activeMapWidth","activeMapHeight","currentMapId","mainMetadata","findSpawnPosition","triggerId","mapW","objLayer","objData","spawnIdx","triggerRequested","findIndex","handleDoorInteraction","objDef","currentMeta","actualIndex","onStateUpdate","playShotSfx","lastETime","sound","sfxVolume","opening","delayS","delaySeconds","targetMapId","setTimeout","targetMap","isRoom","isExitingRoom","newX","newY","exitTriggerId","spawnTriggerId","roomAreaMeta","roomAreaEntry","raIdx","spawn","spawnFound","fallback","findExitDoorSpawn","targetRoomId","roomMeta","resolveMapObjects","matchIds","candidateIdx","matchedIdx","some","doorIdx","handleTeleportInteraction","vol","destId","destMeta","tx","ty","applyInteractableEffects","MAX_HEALTH","effect","interactableKey","usedInteractables","healthBonus","fireball","ammoBonus","ammo","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","revealedSet","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerIndex","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","MESSAGES","enMessages","lvMessages","noMessages","ruMessages","jaMessages","getLang","lang","raw","getTutorialChapters","getTutorialItems","chapter","chapterData","getTutorialText","handleWeatherTrigger","weatherType","weatherAction","value","lastWeatherTrigger","handleMessageTrigger","requiresActionKey","requiresKey","i18nChapter","i18nId","message","lastMessageTrigger","duration","triggerWolfSecret","playerCenterX","playerCenterY","objCenterX","objCenterY","playerGridX","playerGridY","objGridX","objGridY","moveX","moveY","eps","applyWolfSecretShift","getObjectId","getObjectDef","moveTile","moveObject","moveMetadata","removeObject","stepDelayMs","setTimeoutFn","shouldCancel","currentIdx","remainingDx","remainingDy","originId","moveStep","currentId","stepX","stepY","targetIndex","targetObjId","extraX","extraY","shouldRemoveCrackBlock","newHealth","passableHealthThreshold","checkInteractables","input","localX","localY","gridX","gridY","upIndex","upObjId","upDef","downIndex","downObjId","downDef","frontX","frontIndex","frontObjId","frontDef","foundIndex","fromMap","fromMeta","isWinning","winCounter","winCountSpeed","normalizeColor","scaleFromRange","readNumber","getMeteorBreakEffectConfig","meteorBreakEffectsConfig","defaults","sizeScale","minSize","maxSize","denom","particleSize","ground","colorsRaw","getBiologicalBreakEffectConfig","biologicalBreakEffectsConfig","beepFallback","muffled","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","lastNode","createBiquadFilter","frequency","setValueAtTime","connect","exponentialRampToValueAtTime","destination","stop","moveHorizontal","MOVE_SPEED","checkCollision","friction","acceleration","timeScale","targetVx","sign","proposedX","step","safeX","moveDist","nextX","applyVerticalPhysics","isGrounded","animation","GRAVITY","TERMINAL_VELOCITY","JUMP_FORCE","isLiquidAt","prevInWater","liqBuoyancy","liqDragY","liqTerminal","swimImpulseMult","activeLiquidType","feetLiq","chestLiq","space","swimImpulse","proposedY","isSolidAtPixel","secretData","objectData","ignoreEntityId","insideAnyRoom","localWx","localWy","roomTileW","roomTileH","roomObjects","closed","isExploding","isEntity","tileDef","getSurfaceProperties","feetY","slipperiness","getWeatherConfig","weatherDamageConfig","getMapWeather","metaWeather","runtime","rt","__GAME_RUNTIME_SETTINGS__","merged","getWeatherDps","clampIntensity","maxDps","minDps","weatherAffectsPlayer","affects","weatherAffectsEnemy","enemyId","enemyName","enemies","mode","excluded","exclude","isExcluded","weatherBlockedByCover","blockedByCover","isCoveredFromAbove","isInsideActiveRoom","getTileLayerData","getSecretLayerData","liquidTypeToHabitat","isFishEntity","getFishTriggerAt","objectId","triggerType","getWaterSurfaceY","updateFrame","constants","helpers","isInitialized","lastTimeRef","projectilesRef","entitiesRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","weatherDamageAccRef","activeRoomIdsRef","getLiquidSample","collectItem","checkHazardDamage","checkSecrets","spawnProjectile","playSfx","updateProjectiles","setPlayer","onGameOver","continue","iceResist","maxIceResist","physicsDt","backgroundLayer","secretLayer","isSlippery","currentIceRes","maxIce","effectiveFriction","ratio","targetFriction","checkCollisionExtended","isPushing","pushTarget","currentStrength","isAlreadyAtMax","lastPushTime","pushDist","overlapDist","isNextToLeft","isNextToRight","pushForce","lastPushSoundTime","ladderInfo","findLadderAtPlayer","ctxResolved","baseIdx","ladder","vp","remaining","steps","prevInWaterFrame","ladderSpeed","climbDir","stepMs","liquidParams","sample","resourceParams","parseNumber","maxLava","oxy","lavaRes","oxyParams","lavaParams","iceParams","strengthParams","oxygenApplies","oxygenEnabled","oxyDrain","oxyRegen","lavaApplies","lavaEnabled","lavaDrain","lavaRegen","applyResource","maxKey","drain","regen","maxVal","weatherNow","radioFogInt","fogActive","maxRadio","maxRadioactivity","radio","radioactivity","radioParams","radioEnabled","radioBaseline","baselinePercent","radioGain","gainPerSecond","radioDecay","decayPerSecond","radioRecover","recoverPerSecond","baseline","rates","getRadioactivityRates","inc","radioactivityPerSecond","dec","radioactivityRegenPerSecond","increase","tickDepleteDps","dpsValue","lavaRainInt","lavaDps","radioDps","totalWeatherDps","damage","healthDpsOverride","effectiveDps","currentAmmo","mouseLeft","playerX","playerY","entity","animFrame","animTimer","totalFrames","animations","explode","frameDuration","shouldRemove","liquidSample","activeRadiusPx","activeRadius","dxView","dyView","sqrt","idleAnim","idle","liquidDamageAcc","dmg","weatherDamageAcc","habitat","timeMs","habitatKey","isAllowed","requireLiquid","inWaterNow","fishState","fs","initialized","nextTurnAt","turnMinMs","turnMaxMs","nextVerticalAt","verticalDir","water_out","water_in","fishCount","removeOnNext","solidAtSample","canFloat","surfaceY","surfaceOffset","deathSurfaceOffset","floatSpeed","deathFloatSpeed","deadAnim","dead","meteorShockFrame","isJumping","panicRadiusPx","panicRadius","panicSpeed","baseSpeed","swimSpeed","verticalDrift","isWaterfall","waterfallDriftMultiplier","waterfallSpeedMultiplier","triggerDef","mergedJumpCfg","fishTrigger","jump","nowMs","nextJumpAt","chance","jumpDir","jumpVx","speedX","jumpVy","speedY","jumpGravity","jumpBounce","bounce","cooldownMs","dtSec","nextY","landingSample","shockUntil","shockFrame","lastWaterEnter","playerWaveRadius","waveImpulse","playerWaveImpulse","waveUntil","panicUntil","panicDurationMs","isPanicking","downSpeed","waterfallDownSpeed","waterfallAlpha","impulse","sampleNext","nextType","other","ocx","ocy","nudge","tryX","tryY","anims","animKey","panic","currentAnim","swim","frameDur","prevInLiquid","water_splash","lava_splash","ew","eh","sinkingSpeed","fallDistance","kill_enemy","isRound","checkEmpty","leftX","rightX","roll","lastAt","lastRollSfxAt","mapH","arrowId","foundArrowDef","arrowsLayer","aDef","reactionDist","reactionDistance","shootDist","shootDistance","canJump","shootCooldown","isShooting","patrol","hitSomething","stayOnPlatform","groundX","groundY","frameSpeed","checkEntityCollision","explodeAnim","updateEntities","knockbackDir","maxX","playerDef","onIce","floatState","floatingText","acc","res","diff","amt","MAX_OXYGEN","MAX_LAVA_RESIST","MAX_RADIOACTIVITY","errorHandler","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","logData","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","useGameEngine","onRevealSecret","useInput","clearKeys","handleKeyDown","tagName","typing","isContentEditable","repeat","handleMouseDown","handleMouseUp","handleKeyUp","onToggleTerminal","passive","maxStrength","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","projectileIdRef","soundEnabledRef","audioCtxUnlockedRef","onStateUpdateRef","onRevealSecretRef","onGameOverRef","objectMetadataRef","revealedSecretsRef","mapWidthRef","mapHeightRef","tileDataRef","objectDataRef","secretDataRef","onToggle","onUserGesture","volume","audio","Audio","pause","once","checkHazardDamageWrapper","candidates","pushCandidate","touch","damageDirections","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","overlapTop","overlapBottom","overlapLeft","overlapRight","sideScore","chosen","prevIndex","damageOnce","baseDamage","immediate","TICK_MS","component","function","playerPosition","damageType","localRevealedRef","handleWeatherEffectHitWrapper","handleWeatherEffectHit","onBreakEffect","edist","prevHealth","inDamageRadius","shockRadius","meteorShockRadius","meteorShockDurationMs","lastFx","lastBioFxAt","bioConfig","breakConfig","onHit","lastMapIdRef","projectName","date_map_last_updated","date_map_created_at","isNewMapLoad","initialEntities","startX","startY","playerId","registryPlayer","prevAmmo","prevFishCount","pW","pH","maxXAtStart","checkCollisionExternal","TILE_SIZE_OVERRIDE","tileDataOverride","registryItemsOverride","secretDataOverride","objectDataOverride","objectMetadataOverride","ignoreId","isSolidAtPixelExternal","originX","originY","ownerId","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","proj","cwt","collisionWithTiles","hbs","hitboxScale","ric","spawnProjectileExternal","getLiquidTypeAtPixel","sampleLiquid","aabb","objectLayer","collectedItems","rWidth","rgX","rIndex","itemKey","rObjectData","rItemId","rItemDef","pickup","pickedUp","mapKey","itemId","itemDef","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","checkObjectHit","checkEntityHit","checkPlayerHit","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","stepTime","removed","hitEntX","panicMs","hitSound","hitIdxX","hypot","hitEntY","hitIdxY","requestAnimationFrame","cancelAnimationFrame","AnimatedItem","setIndex","setInterval","clearInterval","imgSrc","fallbackFrame","maxWidth","maxHeight","draggable","HeaderContainer","AmmoDisplay","FishDisplay","AmmoIcon","span","RightSection","BarsContainer","BarRow","BarWrapper","BarFill","attrs","$percent","$color","BarLabel","GameHeader","hpPercent","oxyPercent","lavaPercent","icePercent","strengthPercent","radioPercent","fireballFrames","fireballA","fireballB","fireballC","fireballD","imageRendering","fishSprite","commands","register","cmd","listCommands","description","executeCommand","panelStyleBase","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","focus","onKey","scrollTop","scrollHeight","transform","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setLavaRain","setRadioactiveFog","setMeteorRain","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setDebugOverlayEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","setRoomBlurEnabled","showCoordinates","setShowCoordinates","minimized","setMinimized","pos","setPos","parse","setSize","draggingRef","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onSettingsUpdate","patch","onOpen","onMove","clientX","clientY","onUp","onResize","emitUpdate","panelStyle","userSelect","contentStyle","buttonStyle","marginLeft","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","defaultValue","_Fragment","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","getBreakEffectParams","breakEffectsConfig","ids","objectIds","types","objectTypes","matchesValue","shouldTriggerBreakEffect","hp","BackgroundMusicPlayer","audioRef","currentSrcRef","sourceNodeRef","filterNodeRef","gainNodeRef","musicContext","cleanup","close","resolveUrl","loop","createMediaElementSource","setupWebAudio","setTargetAtTime","onGesture","val","Overlay","$isVisible","MessageOverlay","isVisible","defaultProps","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapDescription","MapInfo","WinCounterOverlay","GameOverOverlay","GameOverTitle","h1","ReplayButton","ModalDivider","FileUploadLabel","HiddenFileInput","Viewport","$blurred","GameCanvas","PlaceholderMessage","Game","dispatch","useDispatch","viewportRef","useSelector","uiState","runtimeSettings","setRuntimeSettings","gameMessage","setGameMessage","messageTimerRef","clearTimeout","activeMapIdRef","isGameOverRef","handleStateUpdate","projectMapsResolved","spawnObjId","spawnDef","projectToLoad","loadMapData","metaPatch","breakFxPlayed","mapIdAtStart","ps","alert","settingKey","charAt","handleGameOver","indices","handleOpenModalEvent","weatherFogLegacy","sourceMapData","structuredClone","cloneMapData","effectiveMapData","version","activeLayers","bgLayer","mapTileData","mapObjectData","mapSecretData","backgroundMusic","nowIso","mapName","dimensions","debugMapId","handleReplay","mapToLoad","isV2","author","sizeInfo","subMapInfo","mainMap","mapValues","accept","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","contents","suggestedName","mimeType","showSaveFilePicker","writable","createWritable","blob","Blob","write","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","applyMapData","setMapWidth","setMapHeight","setMapName","setCreatorName","setMapDescription","setCreatedAt","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","setSelectedBackgroundMusic","setPlayerPosition","setTileMapData","setObjectMapData","setSecretMapData","setObjectMetadata","setWeatherRain","setWeatherSnow","setWeatherClouds","setWeatherFog","setWeatherThunder","setWeatherLavaRain","setWeatherRadioactiveFog","setWeatherMeteorRain","setMaps","setActiveMapId","selectedBackgroundImage","selectedBackgroundMusic","worldY","date_created","ObjectLinks","React","links","portals","targets","x1","y1","x2","y2","strokeWidth","strokeDasharray","opacity","EditorTile","activeTool","tileObj","objObj","secretObj","isHighlighted","parentRegionIndex","borderStyle","bgStyle","handleGridMouseDown","handleGridMouseEnter","handleResizeStart","handleMoveStart","isRoomAreaVisible","showRoomMapContent","showMessages","isLiquidTile","isWaterTile","isLavaTile","isQuicksandTile","isWaterfallTile","isLavaWaterfallTile","isRadioactiveWaterTile","isRadioactiveWaterfallTile","messageText","i18nText","resolvedMessageText","isResizable","hasObjectOrSecret","onMouseEnter","boxSizing","objectFit","filterColorInEditor","isTree","editor","group","renderAboveOverride","treeLayerLabel","baseTop","baseLeft","baseWidth","baseHeight","inset","i18nMessage","hasIntensity","borderLeft","borderRight","textShadow","roomName","selectedBackgroundUrl","showBackgroundImage","activeLayer","hoverIndex","highlightedIndex","brushSize","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseUp","handleGridMouseLeave","setIsDragging","selectedTile","isEraserActive","isBrushActive","isBucketActive","cursorIndex","setCursorIndex","regions","roomAreas","getLayerColor","getLayerFilter","getPlacementAnchor","tile","handleGridMouseMove","getBoundingClientRect","currentTarget","nextIndex","onMouseUp","onMouseMove","onContextMenu","onMouseLeave","backgroundRepeat","backgroundSize","getGridStyles","previewIndex","previewX","previewY","previewW","previewH","gridTemplateColumns","gridTemplateRows","_","dTileId","dObjId","dSecId","layerColor","hx","hy","minX","selX","selY","originalX","originalY","parentRegion","EditorToolsContainer","HeaderBar","ToolsSection","ToolsGroup","ToolsInnerGroup","ToolsRow","ToolsEditorButton","$variant","$small","$square","$disabled","StrikeThrough","LayerIndicator","$bgColor","$borderColor","$textColor","BgColorContainer","BgColorInputWrapper","BgColorInput","disabled","BgTransparentButton","PlayButtonContainer","PlayButtonInner","InfoContainer","InfoItem","InfoLabel","InfoValue","EraserButtonContainer","EraserButtonInner","SelectionActions","ConfirmButton","CancelButton","GridIcon","SidebarContainer","ElementEditorButton","PanelContainer","$isOpen","PanelHeader","PanelBody","CloseButton","OperationButton","$danger","OperationLabel","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","tempMapDescription","setTempMapDescription","confirmNewMap","ModalHeader","BuiltInMapsModal","onSelect","topZIndex","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","setZIndex","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","lastHeightRef","offsetHeight","handleMouseMove","EditorMapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","obj","strokeStyle","lineWidth","portal","setLineDash","WorldView","switchMap","currentMapData","createMap","deleteMap","updateMapData","onAddRoomArea","mapLayoutsRef","dragRef","allMaps","draw","layouts","currentIds","layout","strokeRect","font","fillText","rAreaW","rAreaH","rTileW","rTileH","ri","sourceLayout","sourceMap","sx","isPortalSource","isDoorSource","linkId","targetLayout","tw","th","tTileW","tTileH","tObjId","tObjDef","isTarget","isDoorTarget","tMeta","endX","cp1X","cp1Y","cp2X","cp2Y","bezierCurveTo","save","translate","rotate","closePath","restore","btnX","btnY","confirm","mapStartX","mapStartY","BackgroundPanel","backgroundOptions","paddingTop","MusicPanel","musicOptions","fontStyle","status","WeatherPanel","weatherItems","setter","icon","SceneEditorButton","RightSidebarContainer","EditorScene","handleMapResize","isResizeWindowOpen","setIsResizeWindowOpen","isWorldViewOpen","setIsWorldViewOpen","isMinimapOpen","setIsMinimapOpen","setIsSettingsOpen","isBackgroundOpen","setIsBackgroundOpen","isMusicOpen","setIsMusicOpen","OperationsPanel","openNewMapModal","saveMap","loadMap","openBuiltInModal","clearMap","creatorName","mapDescription","inputStyle","handleFocus","handleBlur","onFocus","onBlur","CollapsiblePanel","setIsOpen","PalettePanel","isPlayMode","category","blocks","decorations","interactables","hazards","secrets","messages","crackableWalls","pushableWalls","obstacles","setHighlightedIndex","handlePaletteSelect","selectedChapter","setSelectedChapter","tutorialChapters","tutorialItems","getLiquidLabel","isLavaWaterfall","isRadioactiveWaterfall","isRadioactive","isWater","isQuicksand","renderPaletteItem","hasImage","isSecret","swatchStyle","displayName","iconText","getBlockGroup","groupOrder","withGroups","sortBlocks","ao","order","bo","localeCompare","groupPanels","flexWrap","otherItems","getLiquidGroup","li","sortLiquids","getDecorationGroup","sortDecorations","getEntityGroup","sortEntities","groupItems","getItemGroup","sortItems","getInteractableGroup","sortInteractables","getHazardGroup","sortHazards","ch","StatisticsPanel","totalTiles","filledBlocks","objectsCount","emptyBlocks","registryMap","itemsCount","entitiesCount","mapList","mapsTotal","mapsOverworld","mapsUnderworld","mapsRooms","Trans","i18nKey","components","ObjectPropsPanel","listRef","highlightedElement","querySelector","scrollIntoView","behavior","block","isWeather","isMessage","isPortalOrTarget","isDoor","isRoomArea","i18nPreview","el","scrollX","clientWidth","scrollY","clientHeight","scrollTo","nextAbove","EditorElements","activePanel","setActivePanel","togglePanel","lastPanel","setLastPanel","pinnedPanel","setPinnedPanel","hoverTimerRef","displayPanel","clearHoverTimer","handleIconClick","panel","handleIconMouseEnter","handleIconMouseLeave","panelTitles","stats","handlePanelMouseEnter","handlePanelMouseLeave","EditorTools","setShowGrid","handlePlay","handlePause","handleReset","setActiveTool","setBrushSize","moveSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","setShowBackgroundImage","setShowMessages","setIsRoomAreaVisible","setShowRoomMapContent","tool","isDisabled","roman","getLayerIndicatorData","object","secret","textColor","getEraserData","useEditorOperations","createdAt","setIsNewMapModalOpen","handleSaveMap","currentDate","projectData","date_last_updated","statistics","total_tiles","filled_tiles","total_objects","json","saveFile","mapsCount","handleLoadMap","setters","handleLoadBuiltInMap","loadBuiltInMap","handleClearMap","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","isPropsLayer","targetLayer","setTargetData","newData","newMetadata","metadataChanged","targetX","useEditorPainting","setSelection","setPreviewPosition","setOriginalMapData","setDragStart","setHoverIndex","setBucketPreviewIndices","resizeState","setResizeState","moveState","setMoveState","bucketTimerRef","rightEraseRef","getLinkedRoomAt","roomX","roomY","roomWidth","roomHeight","overrideSelectedTile","effectiveTile","linkedRoom","rHeight","setRoomData","setRoomMetadata","newMeta","paintTileUtil","edge","useLinked","mWidth","mHeight","mIndex","mTileMapData","mObjectMapData","mSecretMapData","mObjectMetadata","mSetTileMapData","mSetObjectMapData","mSetSecretMapData","mSetObjectMetadata","existingObjId","existingSecretId","isEraser","isRoomMap","isRightErase","targetData","targetValue","newValue","floodFill","affectedIndices","metaChanged","curX","curY","newW","newH","newIndex","shouldErase","mData","baseIndex","selectionMetadata","tileMap","objectMap","secretMap","Editor","setSelectedTile","setActiveLayer","stateRef","isNewMapModalOpen","isBuiltInMapsModalOpen","setIsBuiltInMapsModalOpen","loadBackgroundOptions","loadMusicOptions","createNewMap","useEditorMaps","existingMaps","newMap","newMaps","lastActiveMapIdRef","newMapId","nextMap","handleCreateMap","finalName","prompt","timeout","selectedBgOption","useEditorRegistry","originalMapData","useEditorSelection","newTileMap","newObjectMap","newSecretMap","newObjectMetadata","destX","destY","destIdx","srcDataIdx","handleForceStop","playModeObjectData","playModeSecretData","playModeWeather","playModeMaps","gameEngineState","useEditorPlayMode","setIsPlayMode","setIsGameOver","restartCounter","setRestartCounter","editorSnapshot","setEditorSnapshot","setRevealedSecrets","setActiveRoomIds","setPlayModeObjectData","setPlayModeSecretData","setPlayModeWeather","playModeMapsVersion","setPlayModeMapsVersion","lastSyncedMapIdRef","isPlayModeRef","playModeMapsRef","engineInitId","currentPlayObjectData","playData","spawnIndex","spawnX","currentPlaySecretData","overrides","mapDataForGame","saved","newState","mapObj","prevTiles","newTiles","nextMeta","prevObjs","newObjs","prevMeta","handleRevealSecret","secretIndices","resetData","handleLoadMapWrapped","handleLoadBuiltInMapWrapped","handleDeleteMap","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","oldMeta","resizeArray","oldArr","newArr","oldY","oldM","newM","oldIdx","newIdx","resizeMetadata","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App"],"ignoreList":[],"sourceRoot":""}