{"version":3,"file":"static/js/main.132fb233.js","mappings":"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","sources":["webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/config.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/weather/LavaRain.js","webpack://element_masters/./src/Pixi/effects/weather/RadioactiveFog.js","webpack://element_masters/./src/Pixi/effects/weather/MeteorRain.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/BubbleFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/floatingTextManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/breakEffectManager.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/engine/gameplay/seaRescue.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/entityManager.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables/context.js","webpack://element_masters/./src/engine/gameplay/interactables/spawn.js","webpack://element_masters/./src/engine/gameplay/interactables/doors.js","webpack://element_masters/./src/engine/gameplay/interactables/teleport.js","webpack://element_masters/./src/engine/gameplay/interactables/effects.js","webpack://element_masters/./src/engine/gameplay/secrets/reveal.js","webpack://element_masters/./src/i18n/tutorialMessages.js","webpack://element_masters/./src/engine/gameplay/secrets/triggers.js","webpack://element_masters/./src/engine/gameplay/secrets/wolfSecret.js","webpack://element_masters/./src/engine/gameplay/secrets/crackBlock.js","webpack://element_masters/./src/engine/gameplay/interactables/checkInteractables.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/gameplay/meteorBreakEffects.js","webpack://element_masters/./src/engine/gameplay/biologicalBreakEffects.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/engine/gameplay/weatherDamage.js","webpack://element_masters/./src/engine/gameplay/weatherCover.js","webpack://element_masters/./src/engine/gameplay/entities.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/weatherEffects.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/engine/gameplay/breakEffects.js","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/sections/chapters/shared/MessageOverlay.jsx","webpack://element_masters/./src/constants/builtInMaps.js","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/mapOperations.js","webpack://element_masters/./src/sections/chapters/editor/viewport/ObjectLinks.jsx","webpack://element_masters/./src/sections/chapters/editor/viewport/EditorTile.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorToolsButton.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorElementsButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorTools/BuiltInMapsModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/EditorMapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WorldView.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/BackgroundPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/MusicPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WeatherPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorSceneButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/EditorScene.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/OperationsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/CollapsiblePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/PalettePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/StatisticsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/ObjectPropsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorElements.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorTools.jsx","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPlayMode.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorOperations.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/paintingTools.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPainting.js","webpack://element_masters/./src/sections/chapters/editor/Editor.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorMaps.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorRegistry.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorSelection.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js","webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.(ogg%7Cmp3%7Cwav%7Cm4a)$i"],"sourcesContent":["/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  objectMetadata: {}, // Track metadata per object position { index: { health: 100, etc } }\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  projectMaps: {}, // For Project v2.0 (multi-map)\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n  activeRoomIds: [], // IDs of currently active rooms (overlays)\n  seaRescuePoints: 0,\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      let { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n\n      // Migration for Sea Rescue boxes (ID change)\n      const migrateBoxes = (data) => {\n        if (!data || !Array.isArray(data)) return;\n        for (let i = 0; i < data.length; i++) {\n          if (data[i] === 'minispill_sea_rescue_box') {\n            data[i] = 'minispill_sea_rescue_box0';\n          }\n        }\n      };\n\n      if (objectMapData) migrateBoxes(objectMapData);\n      \n      // Migrate all maps in project\n      if (mapData?.maps) {\n        Object.values(mapData.maps).forEach(m => {\n          const mapObjectData = m.objectMapData || m.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          if (mapObjectData) migrateBoxes(mapObjectData);\n        });\n      }\n\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.objectMetadata = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {}; // Load initial metadata from map\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.activeRoomIds = []; // Reset active rooms on new map load\n      state.isGameOver = false;\n      state.seaRescuePoints = 0; // Reset points on new map load\n\n      // If this is a project (v2.0) with multiple maps\n      if (mapData?.maps) {\n        state.projectMaps = mapData.maps;\n      }\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    updateObjectMetadata: (state, action) => {\n      const { index, metadata, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        state.objectMetadata[index] = {\n          ...(state.objectMetadata[index] || {}),\n          ...metadata\n        };\n        if (state.projectMaps[targetId]) {\n          if (!state.projectMaps[targetId].objectMetadata) {\n            state.projectMaps[targetId].objectMetadata = {};\n          }\n          state.projectMaps[targetId].objectMetadata[index] = {\n            ...(state.projectMaps[targetId].objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          state.objectMetadata[index] = {\n            ...(state.objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n        if (!state.projectMaps[mapId].objectMetadata) {\n          state.projectMaps[mapId].objectMetadata = {};\n        }\n        state.projectMaps[mapId].objectMetadata[index] = {\n          ...(state.projectMaps[mapId].objectMetadata[index] || {}),\n          ...metadata\n        };\n      }\n    },\n    removeObjectAtIndex: (state, action) => {\n      const { index, mapId } = typeof action.payload === 'object' ? action.payload : { index: action.payload, mapId: null };\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = null;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = null;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = null;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          // Make sure we are working with a fresh array if we want to trigger changes reliably\n          room.objectMapData = [...room.objectMapData];\n        }\n        \n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = null;\n        }\n      }\n    },\n    removeTileAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.tileMapData[index] !== undefined) {\n        state.tileMapData[index] = null;\n      }\n    },\n    moveTileInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.tileMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.tileMapData[fromIndex] === undefined) return;\n      state.tileMapData[toIndex] = state.tileMapData[fromIndex];\n      state.tileMapData[fromIndex] = null;\n    },\n    moveObjectInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.objectMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.objectMapData[fromIndex] === undefined) return;\n      state.objectMapData[toIndex] = state.objectMapData[fromIndex];\n      state.objectMapData[fromIndex] = null;\n      \n      // Move metadata as well\n      if (state.objectMetadata[fromIndex]) {\n        state.objectMetadata[toIndex] = state.objectMetadata[fromIndex];\n        delete state.objectMetadata[fromIndex];\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = newId;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = newId;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = newId;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          room.objectMapData = [...room.objectMapData];\n        }\n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = newId;\n        }\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    toggleRoom: (state, action) => {\n      const roomId = action.payload;\n      if (state.activeRoomIds.includes(roomId)) {\n        state.activeRoomIds = state.activeRoomIds.filter(id => id !== roomId);\n      } else {\n        state.activeRoomIds.push(roomId);\n      }\n    },\n    clearRooms: (state) => {\n      state.activeRoomIds = [];\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    addSeaRescuePoints: (state, action) => {\n      state.seaRescuePoints += action.payload;\n    },\n    captureSeaRescueBox: (state, action) => {\n      const { triggerIndex, boxId, mapWidth } = action.payload;\n      \n      // Find the lowest available trigger in the same column\n      const col = triggerIndex % mapWidth;\n      const mapHeight = state.mapHeight;\n      let targetIndex = -1;\n\n      // Scan from bottom to top in the same column\n      for (let y = mapHeight - 1; y >= 0; y--) {\n        const idx = y * mapWidth + col;\n        const objId = state.objectMapData[idx];\n        \n        if (objId === 'minispill_sea_rescue_trigger') {\n          const meta = state.objectMetadata[idx] || {};\n          if (!meta.capturedBoxId) {\n            targetIndex = idx;\n            break;\n          }\n        }\n      }\n\n      // If no empty trigger in column, use the one that was hit (fallback)\n      const finalIndex = targetIndex !== -1 ? targetIndex : triggerIndex;\n      \n      state.objectMetadata[finalIndex] = {\n        ...(state.objectMetadata[finalIndex] || {}),\n        capturedBoxId: boxId\n      };\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  updateObjectMetadata,\n  removeObjectAtIndex,\n  removeTileAtIndex,\n  moveTileInMap,\n  moveObjectInMap,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  toggleRoom,\n  clearRooms,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  addSeaRescuePoints,\n  captureSeaRescueBox,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\nimport lv_tutorial_messages from \"./translations/lv/tutorial_messages.json\"\nimport no_tutorial_messages from \"./translations/no/tutorial_messages.json\"\nimport en_tutorial_messages from \"./translations/en/tutorial_messages.json\"\nimport ru_tutorial_messages from \"./translations/ru/tutorial_messages.json\"\nimport ja_tutorial_messages from \"./translations/ja/tutorial_messages.json\"\nimport en_game_map_selector from \"./translations/en/game_map_selector.json\"\nimport en_editor_elements from \"./translations/en/editor_elements.json\"\nimport en_editor_scene from \"./translations/en/editor_scene.json\"\nimport en_editor_tools from \"./translations/en/editor_tools.json\"\nimport lv_game_map_selector from \"./translations/lv/game_map_selector.json\"\nimport no_game_map_selector from \"./translations/no/game_map_selector.json\"\nimport ru_game_map_selector from \"./translations/ru/game_map_selector.json\"\nimport ja_game_map_selector from \"./translations/ja/game_map_selector.json\"\nimport lv_editor_elements from \"./translations/lv/editor_elements.json\"\nimport no_editor_elements from \"./translations/no/editor_elements.json\"\nimport ru_editor_elements from \"./translations/ru/editor_elements.json\"\nimport ja_editor_elements from \"./translations/ja/editor_elements.json\"\nimport lv_editor_scene from \"./translations/lv/editor_scene.json\"\nimport no_editor_scene from \"./translations/no/editor_scene.json\"\nimport ru_editor_scene from \"./translations/ru/editor_scene.json\"\nimport ja_editor_scene from \"./translations/ja/editor_scene.json\"\nimport lv_editor_tools from \"./translations/lv/editor_tools.json\"\nimport no_editor_tools from \"./translations/no/editor_tools.json\"\nimport ru_editor_tools from \"./translations/ru/editor_tools.json\"\nimport ja_editor_tools from \"./translations/ja/editor_tools.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"en\",\n        fallbackLng: \"en\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\", \"tutorial\", \"game\", \"editor_elements\", \"editor_scene\", \"editor_tools\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation,\n                tutorial: lv_tutorial_messages,\n                game: lv_game_map_selector,\n                editor_elements: lv_editor_elements,\n                editor_scene: lv_editor_scene,\n                editor_tools: lv_editor_tools\n            },\n            no: {\n                navigation: no_navigation,\n                tutorial: no_tutorial_messages,\n                game: no_game_map_selector,\n                editor_elements: no_editor_elements,\n                editor_scene: no_editor_scene,\n                editor_tools: no_editor_tools\n            },\n            en: {\n                navigation: en_navigation,\n                tutorial: en_tutorial_messages,\n                game: en_game_map_selector,\n                editor_elements: en_editor_elements,\n                editor_scene: en_editor_scene,\n                editor_tools: en_editor_tools\n            },\n            ru: {\n                navigation: ru_navigation,\n                tutorial: ru_tutorial_messages,\n                game: ru_game_map_selector,\n                editor_elements: ru_editor_elements,\n                editor_scene: ru_editor_scene,\n                editor_tools: ru_editor_tools\n            },\n            ja: {\n                navigation: ja_navigation,\n                tutorial: ja_tutorial_messages,\n                game: ja_game_map_selector,\n                editor_elements: ja_editor_elements,\n                editor_scene: ja_editor_scene,\n                editor_tools: ja_editor_tools\n            },\n        },\n    })\n\nexport default i18n\n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n\n        </nav>\n    )\n}\n\n/*\n<NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n* */","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\nimport { useState, useRef, useEffect } from \"react\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    height: 36px;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nconst SettingsButton = styled(NavButton)`\n    ${props => props.$soundOff ? `\n        animation: soundOffPulse 2s ease-in-out infinite;\n        @keyframes soundOffPulse {\n            0% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n            50% { box-shadow: 0 0 12px rgba(86, 255, 138, 0.5); border-color: rgba(86, 255, 138, 0.9); color: #e8fff2; }\n            100% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n        }\n    ` : ''}\n`;\n\nconst DropdownContainer = styled.div`\n    position: relative;\n    display: flex;\n`\n\nconst DropdownMenu = styled.div`\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background-color: #333;\n    border: 1px solid #444;\n    border-radius: 4px;\n    padding: 10px;\n    z-index: 2000;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n    min-width: 150px;\n    margin-top: 5px;\n`\n\nconst MenuItem = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px;\n    color: white;\n    font-size: 12px;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &:hover {\n        background-color: #444;\n    }\n`\n\nconst ToggleSwitch = styled.div`\n    width: 34px;\n    height: 18px;\n    background-color: ${props => props.$active ? '#f4c542' : '#666'};\n    border-radius: 9px;\n    position: relative;\n    transition: background-color 0.3s;\n\n    &::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        left: ${props => props.$active ? '18px' : '2px'};\n        width: 14px;\n        height: 14px;\n        background-color: white;\n        border-radius: 50%;\n        transition: left 0.3s;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const dropdownRef = useRef(null);\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    const currentLang = i18n.language || 'en'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    const toggleSound = () => {\n        const next = !soundEnabled;\n        setSoundEnabled(next);\n        try { localStorage.setItem('game_sound_enabled', next ? '1' : '0'); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n    };\n\n    useEffect(() => {\n        const handleClickOutside = (event) => {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n                setIsMenuOpen(false);\n            }\n        };\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n\n            <DropdownContainer ref={dropdownRef}>\n                <SettingsButton\n                    onClick={() => setIsMenuOpen(!isMenuOpen)}\n                    title=\"Settings\"\n                    $soundOff={!soundEnabled}\n                >\n                    \n                </SettingsButton>\n                {isMenuOpen && (\n                    <DropdownMenu>\n                        <MenuItem onClick={toggleSound}>\n                            <span>Sound Effects</span>\n                            <ToggleSwitch $active={soundEnabled} />\n                        </MenuItem>\n                        <div style={{ height: '1px', backgroundColor: '#444', margin: '5px 0' }} />\n                        <div style={{ padding: '5px 8px', fontSize: '10px', color: '#888' }}>\n                            GAME SETTINGS\n                        </div>\n                    </DropdownMenu>\n                )}\n            </DropdownContainer>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    text-transform: uppercase;\n    margin: 0;\n    line-height: 1.1;\n\n    .tagline {\n        font-size: 0.7rem;\n        letter-spacing: 0.04em;\n        text-transform: lowercase;\n        opacity: 0.7;\n    }\n`\n\nexport function SectionHeaderNavigationLogo() {\n    const tag = (process.env.APP_GIT_TAG || '').trim();\n\n    return (\n        <StyledLogo>\n            <span>Element Masters</span>\n            {tag ? <span className=\"tagline\">{tag.toLowerCase()}</span> : null}\n        </StyledLogo>\n    )\n}\n","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\nlet _registryMap = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        const resolveSoundsMap = (sounds) => {\n            if (!sounds || typeof sounds !== 'object') return sounds;\n            const out = Array.isArray(sounds) ? [] : {};\n            for (const [k, v] of Object.entries(sounds)) {\n                if (typeof v === 'string') {\n                    out[k] = resolveSound(v);\n                } else if (v && typeof v === 'object') {\n                    out[k] = resolveSoundsMap(v);\n                } else {\n                    out[k] = v;\n                }\n            }\n            return out;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null),\n                sounds: resolveSoundsMap(item.sounds)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        _registryMap = new Map();\n        _registry.forEach(item => {\n            if (item && item.id) _registryMap.set(item.id, item);\n        });\n        _registry.__byId = _registryMap;\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    if (!_registry) return null;\n    if (_registryMap) return _registryMap.get(id) || null;\n    return _registry.find(item => item.id === id);\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n\n        </div>\n      )\n    }\n\nexport default App\n/*\n <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n* */","import Logo1 from './assets/logo/Logo1.png';\nimport Logo2 from './assets/logo/Logo2.png';\nimport Logo3 from './assets/logo/Logo3.png';\nimport Logo4 from './assets/logo/Logo4.png';\nimport Logo5 from './assets/logo/Logo5.png';\n\nconst config = {\n    apiUrl: (typeof process !== 'undefined' && process.env?.REACT_APP_API_URL) || 'http://localhost:8000',\n\n    logo: {\n        URL_LOGO_01: Logo1,\n        URL_LOGO_02: Logo2,\n        URL_LOGO_03: Logo3,\n        URL_LOGO_04: Logo4,\n        URL_LOGO_05: Logo5,\n    },\n\n};\n\nexport default config\n","import React from 'react'\nimport styled from 'styled-components'\nimport config from '../../config'\n\nconst HomeContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    //background-color: darkred;\n    \n    .logoRow{\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        width: 100%;\n        height: auto;\n        margin: 10px;\n        //border: solid 1px red;\n        \n        & img {\n            width: 350px;\n        }\n    }\n`\n\nexport default function Home() {\n    const LOGO_01 = config.logo.URL_LOGO_01\n    const LOGO_02 = config.logo.URL_LOGO_02\n    const LOGO_03 = config.logo.URL_LOGO_03\n    const LOGO_04 = config.logo.URL_LOGO_04\n    const LOGO_05 = config.logo.URL_LOGO_05\n    console.log(LOGO_01, LOGO_02, LOGO_03, LOGO_04, LOGO_05)\n\n    return (\n        <HomeContainer>\n           <div className={\"logoRow\"}>\n               <img src={LOGO_01} alt=\"logo\" />\n               <img src={LOGO_02} alt=\"logo\" />\n               <img src={LOGO_03} alt=\"logo\" />\n               <img src={LOGO_04} alt=\"logo\" />\n\n           </div>\n        </HomeContainer>\n    )\n}\n","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on viewport area to keep FPS stable\n    this.maxParticles = 400; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(160, Math.floor(area / 2300));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.rect(0, 0, 1.3, 9);\n    g.fill({ color: 0x4aa3ff, alpha: 0.92 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus a small margin for slanted fall\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 100 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    this.seeded = false;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = 300; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxFlakes = Math.max(120, Math.floor(area / 3000));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(options = null) {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.circle(0, 0, r);\n    g.fill({ color: 0xffffff, alpha: 0.97 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus margin\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      const minY = options && Number.isFinite(options.minY) ? options.minY : (viewport.y - 10);\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : (viewport.y - 40);\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    } else {\n      x = Math.random() * this.width;\n      const minY = options && Number.isFinite(options.minY) ? options.minY : -10;\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : -40;\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    }\n\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    if (target === 0) {\n      this.seeded = false;\n    }\n\n    const deficit = target - this.flakes.length;\n    if (!this.seeded && target > 0) {\n      const viewportH = viewport ? viewport.height : this.height;\n      const viewportY = viewport ? viewport.y : 0;\n      const seedCount = Math.min(target, Math.max(24, Math.floor(this.maxFlakes * 0.35)));\n      for (let i = 0; i < seedCount; i++) {\n        this.spawnOne({\n          minY: viewportY - viewportH * 0.35,\n          maxY: viewportY + viewportH * 0.9\n        });\n      }\n      this.seeded = true;\n    }\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40 || (viewport && f.y > viewport.y + viewport.height + 100)) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n    this.windDirection = 1; // 1: from left to right, -1: from right to left\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(isInitial = false) {\n    const g = new Graphics();\n    const w = 140 + Math.random() * 300; // cloud size\n    const h = 80 + Math.random() * 160;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : this.width;\n\n    let x;\n    if (isInitial) {\n      // Initial scatter across the whole viewport (or map if no viewport)\n      const range = Math.max(vW, this.width) + 800;\n      const startX = viewport ? vX - 400 : -400;\n      x = startX + Math.random() * range;\n    } else if (viewport) {\n      // Dynamic spawn: place in or near viewport so the user sees results quickly\n      // We scatter them in a wider area around viewport [x-400, x+width+400]\n      x = viewport.x - 400 + Math.random() * (viewport.width + 800);\n    } else {\n      // Fallback to edges\n      x = (Math.random() < 0.5 ? -180 : this.width + 180);\n    }\n    \n    const y = vY - 40 + Math.random() * (this.bandHeight - 20); // only in band\n    const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n    const speed = 8 + Math.random() * 22; // horizontal drift speed\n    const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n    // Draw an organic cloud using overlapping circles (soft edges)\n    const rx = w * 0.5;\n    const ry = h * 0.5;\n    const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n    const baseR = Math.min(rx, ry) * 0.55;\n    for (let k = 0; k < circles; k++) {\n      const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n      const dist = 0.2 + Math.random() * 0.35;\n      const cx = Math.cos(t) * rx * dist;\n      const cy = Math.sin(t) * ry * dist;\n      const r = baseR * (0.7 + Math.random() * 0.7);\n      g.circle(cx, cy, r);\n    }\n    // central mass\n    g.circle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n    g.fill({ color: 0xffffff, alpha: 1.0 });\n    g.alpha = 0; // Start invisible for fade-in\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.patches.push({ \n      g, w, h, \n      vx: speed * this.windDirection, \n      vy, \n      targetAlpha: alpha, \n      currentAlpha: 0,\n      phase: Math.random() * Math.PI * 2,\n      dying: false\n    });\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    // We don't change this.width/height here as they are map bounds,\n    // but we can update bandHeight if the screen height changed significantly.\n    this.bandHeight = Math.max(1, Math.floor(h * 0.3)); \n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vW = viewport ? viewport.width : 1280;\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    for (let i = 0; i < targetCount; i++) {\n      this.spawnOne(true);\n      // For initial ones, set alpha immediately\n      if (this.patches.length > 0) {\n        const p = this.patches[this.patches.length - 1];\n        p.currentAlpha = p.targetAlpha;\n        p.g.alpha = p.currentAlpha;\n      }\n    }\n  }\n\n  update(dtMs) {\n    // Live intensity update with smoothing\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : 1280;\n    const vH = viewport ? viewport.height : 720;\n\n    const bandTop = vY - 100;\n    const bandBottom = vY + this.bandHeight;\n\n    // Adjust cloud count gradually\n    // We scale target count based on viewport width (default 18 for 1280px)\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    const activePatches = this.patches.filter(p => {\n      if (p.dying) return false;\n      if (!viewport) return true;\n      // Only count patches that are within a reasonable distance of the viewport\n      return p.g.x > vX - 1000 && p.g.x < vX + vW + 1000;\n    });\n    \n    if (activePatches.length < targetCount) {\n      // Spawn one cloud per ~300ms if needed, to avoid sudden pops\n      this._spawnTimer = (this._spawnTimer || 0) + dtMs;\n      if (this._spawnTimer > 300 || activePatches.length === 0) {\n        this.spawnOne(activePatches.length === 0);\n        this._spawnTimer = 0;\n      }\n    } else if (activePatches.length > targetCount) {\n      // Mark one for death\n      const toKill = activePatches[0];\n      if (toKill) toKill.dying = true;\n    }\n\n    const toRemove = [];\n    for (let i = 0; i < this.patches.length; i++) {\n      const p = this.patches[i];\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // Alpha handling\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      \n      // Cleanup if too far from viewport (e.g. teleport)\n      if (viewport && !p.dying && (p.g.x < vX - 2500 || p.g.x > vX + vW + 2500)) {\n        p.dying = true;\n      }\n\n      if (p.dying) {\n        p.currentAlpha -= dt * 0.1; // Fade out slowly\n        if (p.currentAlpha <= 0) {\n          toRemove.push(i);\n          continue;\n        }\n      } else if (p.currentAlpha < p.targetAlpha) {\n        p.currentAlpha += dt * 0.05; // Fade in slowly\n        if (p.currentAlpha > p.targetAlpha) p.currentAlpha = p.targetAlpha;\n      }\n\n      p.g.alpha = Math.max(0, Math.min(0.55, p.currentAlpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      const margin = 800; // Increased margin to ensure they don't pop out visibly\n      if (viewport) {\n          const leftBound = vX - margin;\n          const rightBound = vX + vW + margin;\n          if (p.g.x < leftBound) p.g.x = rightBound;\n          if (p.g.x > rightBound) p.g.x = leftBound;\n      } else {\n          if (p.g.x < -margin) p.g.x = W + margin;\n          if (p.g.x > W + margin) p.g.x = -margin;\n      }\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n\n    // Remove dead patches\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.patches[idx];\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n      this.patches.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    // We draw a large rectangle to cover the viewport\n    g.rect(0, 0, w, h);\n    g.fill({ color: 0x9fb7c9, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      // Follow camera\n      if (this.g) this.g.x = viewport.x;\n      if (this.layer1) this.layer1.x = viewport.x;\n      if (this.layer2) this.layer2.x = viewport.x;\n      \n      // We also need to follow Y if the map is tall\n      if (this.g) this.g.y = viewport.y;\n      if (this.layer1) this.layer1.y = viewport.y;\n      if (this.layer2) this.layer2.y = viewport.y;\n    }\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.25, 0.9, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.8, 1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    \n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      g.x = viewport.x;\n      g.y = viewport.y;\n      g.rect(0, 0, viewport.width, viewport.height);\n    } else {\n      g.rect(0, 0, this.width, this.height);\n    }\n    g.fill({ color: 0xffffff, alpha: this.flashAlpha });\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, topY;\n    if (viewport) {\n      // Strike within viewport\n      x = Math.floor(viewport.x + this._rand(8, viewport.width - 8));\n      topY = viewport.y - Math.floor(this._rand(10, 40));\n    } else {\n      x = Math.floor(this._rand(8, W - 8));\n      topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    }\n\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2, 5, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xCCEEFF;\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n    g.stroke({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n      g.stroke({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Graphics } from 'pixi.js';\n\n// Lava rain system: similar to rain but red/orange and potentially deals damage (handled by engine)\nexport default class WeatherLavaRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 300; \n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(120, Math.floor(area / 3000));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Lava drops are slightly thicker and more glowing\n    g.rect(0, 0, 2, 10);\n    // Glowing yellow/orange color\n    const color = Math.random() > 0.3 ? 0xffaa00 : 0xffcc00;\n    g.fill({ color, alpha: 0.95 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 400 + Math.random() * 400; // slightly slower/heavier than water rain\n    const vx = (Math.random() * 40 - 20); \n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.1; \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, alive: true });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    let target = Math.floor(this.maxParticles * norm);\n    if (norm > 0 && target < 5) target = 5;\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      const toSpawn = Math.min(deficit, Math.max(1, Math.ceil(target * 0.02)), 30);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    \n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (p) {\n          try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n        }\n      }\n    }\n\n    const dt = dtMs / 1000;\n    const gAcc = 1200; \n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.vy += gAcc * dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Interaction with surfaces / water\n      if (this.api.getLiquidSurfaceY) {\n        const waterY = this.api.getLiquidSurfaceY('water', p.x);\n        if (Number.isFinite(waterY) && p.y >= waterY) {\n          if (typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: waterY, strength: 0.9 });\n          }\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Interaction with solid surfaces\n      if (this.api.isSolidAt(p.x, p.y)) {\n         // Lava drops just vanish on hit with a tiny \"ember\" effect (optional)\n         if (typeof this.api.onLavaImpact === 'function' && Math.random() > 0.5) {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: 0.2 });\n         }\n         p.alive = false;\n         toRemove.push(i);\n         continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 50 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Radioactive fog overlay: similar to fog but toxic green\nexport default class WeatherRadioactiveFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0;\n\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    this.noiseTex = WeatherRadioactiveFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    this.layer2 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    \n    this.layer1.tileScale.set(1.2, 1.2);\n    this.layer2.tileScale.set(0.7, 0.9);\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100;\n    return Math.max(0, Math.min(0.75, t * 0.75));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0);\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    g.rect(0, 0, w, h);\n    // Toxic green tint\n    g.fill({ color: 0x1a5c1a, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      if (this.g) { this.g.x = viewport.x; this.g.y = viewport.y; }\n      if (this.layer1) { this.layer1.x = viewport.x; this.layer1.y = viewport.y; }\n      if (this.layer2) { this.layer2.x = viewport.x; this.layer2.y = viewport.y; }\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    const pulse = 1 + 0.06 * Math.sin(this.time * 0.001);\n    this._applyAlphas(pulse);\n\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    if (this.layer1) { try { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); } catch {} }\n    if (this.layer2) { try { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); } catch {} }\n    this.layer1 = null; this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.3 + 0.4 * t);\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.7;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    this.speed1 = { x: lerp(0.004, 0.02, t), y: lerp(0.0, 0.01, t) };\n    this.speed2 = { x: lerp(-0.005, -0.015, t), y: lerp(0.003, 0.015, t) };\n  }\n\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 180 + Math.floor(Math.random() * 75); \n      img.data[i] = v * 0.4;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v * 0.4;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Meteor rain system: large falling fireballs that can deal damage via API callback\nexport default class WeatherMeteorRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 15; // Meteors are rare and large\n  }\n\n  resize(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n  spawnOne() {\n    const size = 4 + Math.random() * 8; // Meteor radius\n    const isLarge = size > 9;\n    \n    const g = new Graphics();\n    g.clear();\n    \n    // Core\n    g.circle(0, 0, size);\n    g.fill({ color: 0x555555, alpha: 1 });\n    \n    // Glow/Fire\n    g.circle(0, 0, size * 1.5);\n    g.fill({ color: 0xff4500, alpha: 0.4 });\n    \n    // Tail\n    g.moveTo(-size, 0);\n    g.lineTo(0, -size * 4);\n    g.lineTo(size, 0);\n    g.fill({ color: 0xff8c00, alpha: 0.6 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 200 + Math.random() * (viewport.width + 400);\n      y = viewport.y - 100 - Math.random() * 200;\n    } else {\n      x = Math.random() * this.width;\n      y = -100 - Math.random() * 200;\n    }\n\n    const vx = 100 + Math.random() * 100; // slanted fall\n    const vy = 400 + Math.random() * 300;\n    \n    g.x = x;\n    g.y = y;\n    // Rotate towards fall direction\n    g.rotation = Math.atan2(vy, vx) - Math.PI/2;\n    \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, size, isLarge, alive: true, waterTouched: false });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0005 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = this.intensity / 100;\n    const target = Math.floor(this.maxParticles * norm);\n\n    if (this.particles.length < target && Math.random() < 0.02 * norm) {\n      this.spawnOne();\n    }\n\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      const playerState = typeof this.api.getPlayerState === 'function'\n        ? this.api.getPlayerState()\n        : null;\n      let hitEntity = false;\n      if (playerState) {\n        const px = (playerState.x || 0) + (playerState.width || 0) / 2;\n        const py = (playerState.y || 0) + (playerState.height || 0) / 2;\n        const pr = Math.max(6, Math.max(playerState.width || 0, playerState.height || 0) / 2);\n        const dx = px - p.x;\n        const dy = py - p.y;\n        if ((dx * dx + dy * dy) <= Math.pow(p.size + pr, 2)) {\n          hitEntity = true;\n        } else if (Array.isArray(playerState.entities)) {\n          for (const ent of playerState.entities) {\n            const ex = (ent.x || 0) + (ent.width || 0) / 2;\n            const ey = (ent.y || 0) + (ent.height || 0) / 2;\n            const er = Math.max(6, Math.max(ent.width || 0, ent.height || 0) / 2);\n            const edx = ex - p.x;\n            const edy = ey - p.y;\n            if ((edx * edx + edy * edy) <= Math.pow(p.size + er, 2)) {\n              hitEntity = true;\n              break;\n            }\n          }\n        }\n      }\n\n      if (hitEntity) {\n        if (typeof this.api.onMeteorHit === 'function') {\n          this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'air' });\n        }\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const liquidType = typeof this.api.getLiquidTypeAt === 'function'\n        ? this.api.getLiquidTypeAt(p.x, p.y)\n        : null;\n\n      if (liquidType) {\n        if (liquidType === 'water' && typeof this.api.onWaterImpact === 'function') {\n          if (!p.waterTouched) {\n            this.api.onWaterImpact({ x: p.x, strength: p.isLarge ? 1.4 : 0.8 });\n            p.waterTouched = true;\n          }\n          // Meteors pass through water until hitting solid ground\n        } else {\n          if (liquidType === 'lava' && typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.6 : 0.9 });\n          }\n\n          if (typeof this.api.onMeteorHit === 'function') {\n            this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: liquidType });\n          }\n\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Check collision with solid world\n      if (this.api.isSolidAt(p.x, p.y)) {\n        // Explosion effect\n        if (typeof this.api.onLavaImpact === 'function') {\n           this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.5 : 0.8 });\n        }\n        \n        // Notify engine about meteor hit for damage\n        if (typeof this.api.onMeteorHit === 'function') {\n           this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'ground' });\n        }\n\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      if (viewport && (p.y > viewport.y + viewport.height + 100 || p.x > viewport.x + viewport.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      } else if (!viewport && (p.y > this.height + 100 || p.x > this.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.circle(d.x, d.y, size);\n      g.fill({ color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.circle(r.x, r.y, r.r);\n      g.stroke({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// BubbleFX: lightweight bubble particles for underwater ambience\nexport default class BubbleFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.bubbles = [];\n    this.maxBubbles = 120;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.bubbles = [];\n  }\n\n  trigger({ x = 0, y = 0, size = 2, rise = 0.03, life = 1200, drift = 0.02, color = 0xc9ecff } = {}) {\n    if (this.bubbles.length >= this.maxBubbles) return;\n    const g = new Graphics();\n    g.x = 0;\n    g.y = 0;\n    this.node.addChild(g);\n    this.bubbles.push({\n      g,\n      x,\n      y,\n      size,\n      rise,\n      drift,\n      life: 0,\n      max: life,\n      color\n    });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.bubbles.length - 1; i >= 0; i--) {\n      const b = this.bubbles[i];\n      b.life += dt;\n      b.y -= b.rise * dt;\n      b.x += (Math.random() - 0.5) * b.drift * dt;\n      const t = Math.min(1, b.life / b.max);\n      const alpha = 0.7 * (1 - t);\n      const size = Math.max(0.5, b.size * (1 - t * 0.2));\n      const g = b.g;\n      g.clear();\n      g.circle(b.x, b.y, size);\n      g.stroke({ width: 1, color: b.color || 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (b.life >= b.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.bubbles.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      g.stroke({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n\n      // glowing ember\n      g.circle(e.x, e.y, emberSize);\n      g.fill({ color: 0xffa229, alpha: 0.9 * emberAlpha });\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.circle(p.x, p.y, radius);\n      g.fill({ color: 0xdfdad2, alpha: Math.max(0, alpha) });\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite, Sprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.bgContainer = opts.bgContainer || null;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n\n    // Use multiple sample points for better precision\n    // 1. Center\n    const points = [\n      { x: px + pw * 0.5, y: py + ph * 0.5 },\n      { x: px + pw * 0.5, y: py + ph * 0.1 }, // Top\n      { x: px + pw * 0.5, y: py + ph * 0.9 }, // Bottom\n    ];\n\n    for (const pt of points) {\n      const gx = Math.floor(pt.x / this.tileSize);\n      const gy = Math.floor(pt.y / this.tileSize);\n      const idx = gy * this.mapWidth + gx;\n      if (region.tileIndicesSet && region.tileIndicesSet.has(idx)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { if (r.bgNode && r.bgNode.parent) r.bgNode.parent.removeChild(r.bgNode); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n        try { r.bgNode?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._quicksandTex?.destroy(true); } catch {}\n    try { this._waterfallTex?.destroy(true); } catch {}\n    try { this._lavaWaterfallTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    try { this._lavaDetailTex?.destroy(true); } catch {}\n    try { this._waterDetailTex?.destroy(true); } catch {}\n    try { this._quicksandDetailTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    if (this._gradTextures) {\n      for (const k in this._gradTextures) {\n        try { this._gradTextures[k].destroy(true); } catch {}\n      }\n      this._gradTextures = null;\n    }\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.bgNode?.parent && r.bgNode.parent.removeChild(r.bgNode); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n      try { r.bgNode?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      try { this._quicksandTex?.destroy(true); } catch {}\n      try { this._waterfallTex?.destroy(true); } catch {}\n      try { this._lavaWaterfallTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n      try { this._lavaDetailTex?.destroy(true); } catch {}\n      try { this._waterDetailTex?.destroy(true); } catch {}\n      try { this._quicksandDetailTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null; this._quicksandTex = null; this._waterfallTex = null;\n      this._lavaWaterfallTex = null;\n      this._radioactiveWaterTex = null; this._radioactiveWaterfallTex = null;\n      this._lavaDetailTex = null; this._waterDetailTex = null; this._quicksandDetailTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0, y: 0 }; // Static (bubbles added via texture/noise)\n    const lavaDrift = { x: 0, y: 0 }; // Static (floating pieces added via noise/texture)\n    const quicksandDrift = { x: 0, y: 0 }; // Static (pixels fade via noise)\n    const waterfallDrift = { x: 0, y: 0.15 }; // Fast vertical drift\n    const lavaWaterfallDrift = { x: 0, y: 0.12 }; // Lava falls a bit slower/thicker\n    const radioactiveWaterDrift = { x: 0, y: 0 }; // Static\n    const radioactiveWaterfallDrift = { x: 0, y: 0.12 }; // Match lava waterfall speed or similar\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : (r.type === 'quicksand' ? quicksandDrift : (r.type === 'waterfall' ? waterfallDrift : (r.type === 'lava_waterfall' ? lavaWaterfallDrift : (r.type === 'radioactive_waterfall' ? radioactiveWaterfallDrift : (r.type === 'radioactive_water' ? radioactiveWaterDrift : waterDrift)))));\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly with smooth transitions)\n      let targetAlpha = 0.95;\n      if (r.type === 'water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.35 : 0.45;\n      } else if (r.type === 'quicksand') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.55 : 0.75;\n      } else if (r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.30 : 0.45;\n      } else if (r.type === 'radioactive_water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.40 : 0.50;\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.45 : 0.60;\n      }\n\n      // Smooth transition (lerp)\n      if (r.currentAlpha === undefined) r.currentAlpha = sprite.alpha;\n      const lerpFactor = 0.005; // Adjust for speed of transition\n      const alphaDiff = targetAlpha - r.currentAlpha;\n      r.currentAlpha += alphaDiff * Math.min(1, dt * lerpFactor);\n      sprite.alpha = r.currentAlpha;\n\n      // Splash animation for waterfalls\n      if ((r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') && r.splashG && Array.isArray(r.bottomEdges)) {\n        const g = r.splashG;\n        g.clear();\n        const thickness = Math.max(2, Math.floor(this.tileSize * 0.25));\n        const F = 1000;\n        const cycle = (this._time % F) / F;\n        \n        for (const e of r.bottomEdges) {\n          // Animated foam/splash at the bottom\n          const splashHeight = thickness * (0.8 + Math.sin(this._time * 0.01 + e.x) * 0.2);\n          g.rect(e.x, e.y + this.tileSize - splashHeight, e.w, splashHeight);\n          \n          // Bubbles\n          for (let k = 0; k < 5; k++) {\n             const bx = e.x + ((e.x * 13 + k * 37 + this._time * 0.05) % e.w);\n             const by = e.y + this.tileSize - (Math.random() * thickness * 2);\n             g.circle(bx, by, 1 + Math.random() * 2);\n          }\n        }\n        const splashColor = r.type === 'lava_waterfall' ? 0xffcc00 : (r.type === 'radioactive_waterfall' ? 0xadff2f : 0xffffff);\n        g.fill({ color: splashColor, alpha: 0.5 + Math.sin(this._time * 0.02) * 0.2 });\n      }\n\n      // Animate noise/detail overlays\n      if (r.noise1) {\n        if (r.type === 'water') {\n          r.noise1.tilePosition.y -= 0.015 * dt; // Bubbles go UP\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.001) * 0.005 * dt; \n        } else if (r.type === 'lava') {\n          r.noise1.tilePosition.x += 0.004 * dt; \n          r.noise1.tilePosition.y += 0.002 * dt;\n        } else if (r.type === 'quicksand') {\n          // Fade effect for pixels\n          r.noise1.alpha = 0.4 + Math.sin(this._time * 0.001) * 0.2;\n          r.noise1.tilePosition.x += 0.001 * dt;\n        } else if (r.type.includes('waterfall')) {\n          r.noise1.tilePosition.y += drift.y * 0.8 * dt;\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.002) * 0.02 * dt;\n        } else {\n          r.noise1.tilePosition.x += 0.008 * dt;\n          r.noise1.tilePosition.y += 0.004 * dt;\n        }\n      }\n      if (r.noise2) {\n        if (r.type === 'quicksand') {\n          r.noise2.alpha = 0.2 + Math.cos(this._time * 0.0015) * 0.1;\n        } else if (r.type.includes('waterfall')) {\n          r.noise2.tilePosition.y += drift.y * 1.2 * dt;\n        } else {\n          r.noise2.tilePosition.x -= 0.005 * dt;\n          r.noise2.tilePosition.y += 0.003 * dt;\n        }\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.rect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.fill({ color: 0xc9ecff, alpha: 0.35 });\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.lava_waterfall) return 'lava_waterfall';\n      if (def.flags.radioactive_waterfall) return 'radioactive_waterfall';\n      if (def.flags.waterfall) return 'waterfall';\n      if (def.flags.radioactive_water) return 'radioactive_water';\n      if (def.flags.quicksand) return 'quicksand';\n      if (def.flags.lava) return 'lava';\n      if (def.flags.water) return 'water';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n      _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n        const node = new Container();\n        const mask = new Graphics();\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        const tileIndicesSet = new Set(tileIndices);\n\n        mask.clear();\n        const bleed = 1; // Palielints bleed, lai nosegtu spraugas\n        for (let k = 0; k < tileIndices.length; k++) {\n          const idx = tileIndices[k];\n          const gx = (idx % mapWidth);\n          const gy = Math.floor(idx / mapWidth);\n          mask.rect(\n            gx * tileSize - bleed,\n            gy * tileSize - bleed,\n            tileSize + bleed * 2,\n            tileSize + bleed * 2\n          );\n        }\n        mask.fill({ color: 0xffffff, alpha: 1 });\n\n        const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                     : (type === 'quicksand' ? (this._quicksandTex || (this._quicksandTex = this._createQuicksandTexture(tileSize)))\n                                     : (type === 'waterfall' ? (this._waterfallTex || (this._waterfallTex = this._createWaterfallTexture(tileSize)))\n                                     : (type === 'lava_waterfall' ? (this._lavaWaterfallTex || (this._lavaWaterfallTex = this._createLavaWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_waterfall' ? (this._radioactiveWaterfallTex || (this._radioactiveWaterfallTex = this._createRadioactiveWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_water' ? (this._radioactiveWaterTex || (this._radioactiveWaterTex = this._createRadioactiveWaterTexture(tileSize)))\n                                     : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize))))))));\n        \n        // v8 addressMode iestatana\n        if (tex.source && tex.source.style) {\n          tex.source.style.addressMode = 'repeat';\n        }\n\n        const tiling = new TilingSprite({\n          texture: tex,\n          width: worldW,\n          height: worldH\n        });\n        \n        tiling.tileScale.set(1, 1);\n        tiling.alpha = type === 'lava' ? 0.60 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.45 : (type === 'quicksand' ? 0.75 : 0.45));\n        node.addChild(tiling);\n\n        // Noise/Detail sli\n        let detailTex1, detailTex2;\n        if (type.includes('lava')) {\n          detailTex1 = this._lavaDetailTex || (this._lavaDetailTex = this._createLavaDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type === 'quicksand') {\n          detailTex1 = this._quicksandDetailTex || (this._quicksandDetailTex = this._createQuicksandDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type.includes('radioactive')) {\n          detailTex1 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n          detailTex2 = this._noiseTex;\n        } else {\n          // water, waterfall\n          detailTex1 = this._waterDetailTex || (this._waterDetailTex = this._createWaterDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        }\n\n        if (detailTex1.source && detailTex1.source.style) detailTex1.source.style.addressMode = 'repeat';\n        if (detailTex2.source && detailTex2.source.style) detailTex2.source.style.addressMode = 'repeat';\n\n        const noise1 = new TilingSprite({ texture: detailTex1, width: worldW, height: worldH });\n        const noise2 = new TilingSprite({ texture: detailTex2, width: worldW, height: worldH });\n        \n        if (type === 'water' || type === 'radioactive_water') {\n          noise1.alpha = 0.25; noise2.alpha = 0.15;\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          noise1.alpha = 0.2; noise2.alpha = 0.15;\n        } else if (type === 'lava') {\n          noise1.alpha = 0.4; noise2.alpha = 0.2;\n        } else if (type === 'quicksand') {\n          noise1.alpha = 0.6; noise2.alpha = 0.3;\n        } else {\n          noise1.alpha = 0.12; noise2.alpha = 0.15;\n        }\n        node.addChild(noise1, noise2);\n\n        // LABOJUMS: Maska tiek pievienota k brns, lai t sekotu ldzi node koordintm\n        node.addChild(mask);\n        node.mask = mask;\n\n        // Background slnis (zIndex 28) - lai aizsegtu fonu caur deni\n        let bgNode = null;\n        if (this.bgContainer) {\n          bgNode = new Container();\n          const bgMask = new Graphics();\n          bgMask.clear();\n          for (let k = 0; k < tileIndices.length; k++) {\n            const idx = tileIndices[k];\n            const gx = (idx % mapWidth);\n            const gy = Math.floor(idx / mapWidth);\n            bgMask.rect(gx * tileSize - bleed, gy * tileSize - bleed, tileSize + bleed * 2, tileSize + bleed * 2);\n          }\n          bgMask.fill({ color: 0xffffff, alpha: 1 });\n          bgNode.addChild(bgMask);\n          bgNode.mask = bgMask;\n\n          const bgG = new Graphics();\n          let minY = Infinity, maxY = -Infinity;\n          for (let k = 0; k < tileIndices.length; k++) {\n            const gy = Math.floor(tileIndices[k] / mapWidth) * tileSize;\n            if (gy < minY) minY = gy;\n            if (gy + tileSize > maxY) maxY = gy + tileSize;\n          }\n\n          if (!this._gradTextures) this._gradTextures = {};\n          if (!this._gradTextures[type]) {\n            let color, bottomColor;\n            if (type.includes('lava')) {\n              color = '#ffaa00'; bottomColor = '#884400';\n            } else if (type.includes('radioactive')) {\n              color = '#004400'; bottomColor = '#001100';\n            } else if (type === 'quicksand') {\n              color = '#5d4037'; bottomColor = '#2d1d19';\n            } else { \n              color = '#3a7fb8'; bottomColor = '#0b1d2e';\n            }\n            this._gradTextures[type] = this._createGradientTexture(color, bottomColor);\n          }\n\n          const bgSprite = new Sprite(this._gradTextures[type]);\n          bgSprite.width = worldW;\n          bgSprite.height = worldH;\n          bgSprite.y = 0;\n          \n          bgNode.addChild(bgSprite);\n          this.bgContainer.addChild(bgNode);\n        }\n\n        const baseAlpha = type === 'lava' ? 0.60 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.45 : (type === 'quicksand' ? 0.75 : 0.45));\n\n        if (type === 'water' || type === 'radioactive_water') {\n          const capG = new Graphics();\n          node.addChild(capG);\n          const topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n          // Saglabjam atsauces uz r reistr\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          const splashG = new Graphics();\n          node.addChild(splashG);\n          const bottomEdges = this._computeBottomEdgeSpans(tileIndices, mapWidth, tileSize);\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, splashG, bottomEdges, tileIndicesSet, currentAlpha: baseAlpha });\n        } else {\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        }\n\n        this.container.addChild(node);\n      }\n\n      _createGradientTexture(topColor, bottomColor) {\n        const canvas = document.createElement('canvas');\n        const size = 64; \n        canvas.width = 2; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, topColor);\n        g.addColorStop(1, bottomColor);\n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, 2, size);\n        return Texture.from(canvas);\n      }\n\n  _createWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient to remove horizontal bars\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // No horizontal gradient to remove bars\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    // Lava pieces/streaks (vertical) - these go down\n    ctx.fillStyle = '#ffed8a';\n    for (let k = 0; k < 10; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 15;\n      const w = 3 + Math.random() * 4; // Wider \"chunks\"\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid sand color\n    ctx.fillStyle = '#a6915b';\n    ctx.fillRect(0, 0, size, size);\n\n    // grainy texture (static here, will animate pixels via noise)\n    ctx.globalAlpha = 0.3;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 25; k++) {\n      ctx.fillRect(Math.random() * size, Math.random() * size, 1, 1);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Background color\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 15; k++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.4;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 25;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid toxic green\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Some mini bubbles (static here, noise provides movement)\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random() * 1.5, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.15 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 8 + Math.random() * 15;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n    \n    // Pievienojam burbuus (prasba: \"var pieveinot burbuus kuri iet uzleju k radioactive water\")\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 6; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random(), 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ff8800'; \n    for (let i = 0; i < 10; i++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      const sw = 12 + Math.random() * 24;\n      const sh = 10 + Math.random() * 20;\n      ctx.fillRect(Math.random() * w, Math.random() * h, sw, sh);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createWaterDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < 12; i++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * w, Math.random() * h, 1 + Math.random() * 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#5c5031';\n    for (let i = 0; i < 100; i++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.5;\n      ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 256, h = 256) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = '#ffffff';\n    for(let i=0; i<500; i++) {\n      ctx.globalAlpha = Math.random() * 0.05;\n      ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its bottom boundary per row.\n  _computeBottomEdgeSpans(tileIndices, mapWidth, tileSize) {\n    const set = new Set(tileIndices);\n    const spans = [];\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const below = idx + mapWidth;\n      if (!set.has(below)) {\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.roundRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.fill({ color: this._trackColor, alpha: 0.85 });\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.roundRect(0, 0, innerW, h, radius);\n    this._fill.fill({ color: this._color, alpha: 1 });\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  tiles: 20,\n  tilesAnim: 25,\n  liquidBackground: 28,\n  objBehind: 30,\n  secretsBelow: 35,\n  player: 40,\n  liquids: 45,\n  liquidFx: 48,\n  projectiles: 50,\n  objFront: 60,\n  secretsAbove: 65,\n  weather: 70,\n  fog: 80,\n  overlay: 110,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#3a7fb8');\n    g.addColorStop(0.5, '#5ba3d9');\n    g.addColorStop(1, '#3a7fb8');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (yellow to golden)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#ffaa00');\n    g.addColorStop(1, '#ffcc00');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffff00');\n      grad.addColorStop(1, '#ffaa00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffffff';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\nexport const isQuicksandDef = (def) => !!(def && def.flags && def.flags.quicksand);\nexport const isWaterfallDef = (def) => !!(def && def.flags && def.flags.waterfall);\nexport const isLavaWaterfallDef = (def) => !!(def && def.flags && def.flags.lava_waterfall);\nexport const isRadioactiveWaterDef = (def) => !!(def && def.flags && def.flags.radioactive_water);\nexport const isRadioactiveWaterfallDef = (def) => !!(def && def.flags && def.flags.radioactive_waterfall);\n\n// Generate procedural quicksand frames (cached per tile size)\nexport const createQuicksandFrames = (tileSize) => {\n  const frames = [];\n  const F = 12; // slightly more frames for smoother slow movement\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base sand color (brownish yellow)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#a6915b');\n    g.addColorStop(1, '#7d6d42');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // grainy texture / swirling patterns\n    const t = i / F;\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 4; k++) {\n       const y = Math.floor((tileSize / 4) * k + (t * tileSize)) % tileSize;\n       ctx.fillRect(0, y, tileSize, 1);\n    }\n    \n    // random grains\n    ctx.globalAlpha = 0.15;\n    ctx.fillStyle = '#d1ba7d';\n    const count = Math.max(5, Math.floor(tileSize * 0.25));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 43 + i * 7) % tileSize);\n      const ry = Math.floor((k * 61 + i * 11) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural waterfall frames\nexport const createWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent blue (izmantojam dens krsas)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(42, 93, 143, 0.5)');\n    g.addColorStop(0.5, 'rgba(91, 163, 217, 0.5)');\n    g.addColorStop(1, 'rgba(42, 93, 143, 0.5)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // sas vertiklas svtrias\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    const count = 6;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.3);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava waterfall frames\nexport const createLavaWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent lava colors\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(255, 170, 0, 0.6)');\n    g.addColorStop(0.5, 'rgba(255, 204, 0, 0.6)');\n    g.addColorStop(1, 'rgba(255, 170, 0, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated lava streaks\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';\n    const count = 5;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.4);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive water frames\nexport const createRadioactiveWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 12;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient (toxic green)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#1a5c1a');\n    g.addColorStop(1, '#0d2e0d');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    \n    // Bubbles\n    ctx.globalAlpha = 0.6;\n    ctx.fillStyle = '#32cd32';\n    const bubbleCount = 4;\n    for (let k = 0; k < bubbleCount; k++) {\n      const bx = Math.floor((k * 137 + i * 2) % tileSize);\n      const by = Math.floor((tileSize + k * 43 - (t * tileSize + k * 10)) % tileSize);\n      const size = 1 + (Math.sin(t * Math.PI + k) * 0.5 + 0.5) * 2;\n      ctx.beginPath();\n      ctx.arc(bx, by, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Glow streaks\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#adff2f';\n    for (let b = 0; b < 2; b++) {\n      const y = Math.floor((tileSize / 2) * b + Math.sin((t + b * 0.5) * Math.PI * 2) * (tileSize * 0.1));\n      ctx.fillRect(0, y, tileSize, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive waterfall frames\nexport const createRadioactiveWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 16; // more frames for slower motion\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(26, 92, 26, 0.6)');\n    g.addColorStop(0.5, 'rgba(50, 205, 50, 0.6)');\n    g.addColorStop(1, 'rgba(26, 92, 26, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    ctx.fillStyle = 'rgba(173, 255, 47, 0.5)';\n    const count = 4; // fewer streaks\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.2);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3, minWidth = 0, minHeight = 0 }) {\n    if (!this.container) return;\n    this.clear();\n\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = w;\n    solid.height = h;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: w, height: h });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = h / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight, minWidth = 0, minHeight = 0) {\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = w;\n      this.bgSprite.height = h;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = w;\n      this.imgSprite.height = h;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = h / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl, minWidth = 0, minHeight = 0 } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n      minWidth,\n      minHeight\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const resize = (worldWidth, worldHeight, minWidth = 0, minHeight = 0) => {\n    if (parallaxHelper) {\n      parallaxHelper.resize(worldWidth, worldHeight, minWidth, minHeight);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    resize,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container, Text, Rectangle } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n\n  // Static sprite sheet frame (grid-based)\n  if (!spr && def.spriteSheet && def.spriteSheet.enabled && def.texture && Number.isFinite(Number(def.spriteSheet.frameIndex))) {\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    if (source && source.width > 1 && source.height > 1) {\n      const totalSprites = Math.max(1, Number(def.spriteSheet.totalSprites) || 1);\n      const columns = Math.max(1, Number(def.spriteSheet.columns) || 1);\n      const rows = Math.ceil(totalSprites / columns);\n      const frameWidth = Number(def.spriteSheet.frameWidth) || (source.width / columns);\n      const frameHeight = Number(def.spriteSheet.frameHeight) || (source.height / rows);\n      const frameIndex = Math.max(0, Math.min(totalSprites - 1, Number(def.spriteSheet.frameIndex)));\n      const col = frameIndex % columns;\n      const row = Math.floor(frameIndex / columns);\n      const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n      spr = new Sprite(new Texture({ source, frame: rect }));\n    }\n  }\n\n  // Ja nav tekstru masva vai tas ir tuks, minm parasto tekstru\n  if (!spr && def.texture) {\n    const tex = getTexture(def.texture);\n    if (tex) {\n      spr = new Sprite(tex);\n    }\n  }\n\n  // Ja joprojm nav spr (piemram, nav tekstras), prbaudm editorIcon\n  if (!spr && def.editorIcon) {\n    spr = new Text({\n        text: def.editorIcon,\n        style: {\n            fontSize: 24,\n            fill: 0xffffff,\n            fontWeight: 'bold',\n            dropShadow: true,\n            dropShadowColor: 0x000000,\n            dropShadowBlur: 4,\n            dropShadowDistance: 2\n        }\n    });\n    // Centrjam tekstu tile ietvaros\n    spr.anchor.set(0.5, 0.5);\n    // T k ms lietojam anchor 0.5, mums bs jpielgo pozcija vlk vai eit\n    // Bet buildSpriteFromDef parasti atgrie objektu, kura anchor ir (0,0) pc noklusjuma\n    // lai tas atbilstu tileSize pozicionanai.\n    // Tpc iestatsim anchor uz 0, bet nedaudz nobdsim?\n    // Labk lietot anchor 0.5 un layerBuilder- pieskaitt tileSize/2.\n  }\n\n  if (!spr) {\n    spr = new Sprite(Texture.WHITE);\n  }\n\n  if (spr instanceof Sprite) {\n    spr.anchor.set(0, 0);\n  } else if (spr instanceof Text) {\n    // Tekstam ms gribam, lai tas btu centr, tpc atstjam 0.5\n  }\n  \n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = Math.round(dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth));\n  container.y = Math.round(playerState.y || 0);\n};\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef, isQuicksandDef, isWaterfallDef, isLavaWaterfallDef, isRadioactiveWaterDef, isRadioactiveWaterfallDef, createWaterFrames, createLavaFrames, createQuicksandFrames } from './liquidRendering';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const { bgRef, objBehindRef, objFrontRef, roomBgRef, roomObjBehindRef, roomObjFrontRef, secretLayerRef } = refs;\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous and destroy old children to prevent memory leaks/ticker buildup\n  const safeDestroy = (container) => {\n    if (!container) return;\n    const children = container.removeChildren();\n    children.forEach(child => {\n      try {\n        // Destroy child but KEEP textures in cache\n        child.destroy({ children: true, texture: false });\n      } catch (e) {}\n    });\n  };\n\n  safeDestroy(bgRef);\n  safeDestroy(objBehindRef);\n  safeDestroy(objFrontRef);\n  safeDestroy(roomBgRef);\n  safeDestroy(roomObjBehindRef);\n  safeDestroy(roomObjFrontRef);\n  safeDestroy(secretLayerRef?.below);\n  safeDestroy(secretLayerRef?.above);\n\n  const secretOverlays = {\n    below: new Map(),\n    above: new Map()\n  };\n\n  // 1. Render main map\n  renderMapContent(refs, options, 0, 0, secretOverlays, bgRef, objBehindRef, objFrontRef);\n\n  // 2. Render active rooms\n  const { activeRoomIds, maps, objectMetadata, secretMapData, mapWidth, tileSize } = options;\n  if (activeRoomIds && activeRoomIds.length > 0 && maps && objectMetadata && secretMapData) {\n    activeRoomIds.forEach(roomId => {\n      const roomMap = maps[roomId];\n      if (!roomMap) return;\n\n      // Find the room_area on the current map that links to this room\n      const roomAreaIndex = Object.keys(objectMetadata).find(idx => \n        secretMapData[idx] === 'room_area' && objectMetadata[idx].linkedMapId === roomId\n      );\n\n      if (roomAreaIndex !== undefined) {\n        const idx = parseInt(roomAreaIndex);\n        const ox = Math.round((idx % mapWidth) * tileSize);\n        const oy = Math.round(Math.floor(idx / mapWidth) * tileSize);\n        \n        const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n        \n        const roomOptions = {\n          ...options,\n          mapWidth: roomMap.mapWidth || roomMap.width,\n          mapHeight: roomMap.mapHeight || roomMap.height,\n          tileMapData: roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [],\n          objectMapData: roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [],\n          secretMapData: roomSecrets,\n          objectMetadata: roomMap.objectMetadata || {},\n          mapType: 'room',\n          backgroundColor: roomMap.selectedBackgroundColor,\n          activeRoomIds: [] // Avoid recursion\n        };\n\n        renderMapContent(refs, roomOptions, ox, oy, secretOverlays, roomBgRef, roomObjBehindRef, roomObjFrontRef);\n      }\n    });\n  }\n\n  // 3. Render collected secret overlays\n  renderSecretOverlays(refs, options, secretOverlays);\n};\n\nconst renderMapContent = (refs, options, offsetX, offsetY, secretOverlays, targetBg, targetObjBehind, targetObjFront) => {\n  const {\n    mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData,\n    revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType,\n    activeRoomIds, maps\n  } = options;\n\n  const { secretLayerRef } = refs;\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Pre-calculate indices covered by active rooms to hide main map content under them\n  const activeRoomIndices = new Set();\n  const roomWindowIndices = new Set(); // Store indices where rooms have windows\n\n  if (mapType !== 'room' && activeRoomIds && activeRoomIds.length > 0 && maps) {\n      Object.entries(objectMetadata || {}).forEach(([idxStr, meta]) => {\n          const idx = parseInt(idxStr);\n          if (secretMapData?.[idx] === 'room_area' && meta?.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n              const roomMap = maps[meta.linkedMapId];\n              if (!roomMap) return;\n\n              const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n              const rw = meta.width || 1;\n              const rh = meta.height || 1;\n              const rx = idx % mapWidth;\n              const ry = Math.floor(idx / mapWidth);\n              const rMapW = roomMap.mapWidth || roomMap.width || rw;\n\n              for (let dy = 0; dy < rh; dy++) {\n                  for (let dx = 0; dx < rw; dx++) {\n                      const worldIdx = (ry + dy) * mapWidth + (rx + dx);\n                      const localIdx = dy * rMapW + dx;\n                      \n                      // In the main map context, roomWindowIndices are spots where we DON'T hide the main map\n                      // because the room has a \"hole\" (window) there.\n                      // A \"hole\" is defined as no tile AND no object in the room map.\n                      const roomTiles = roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [];\n                      const roomObjs = roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [];\n                      \n                      if (!roomTiles[localIdx] && !roomObjs[localIdx]) {\n                          roomWindowIndices.add(worldIdx);\n                          activeRoomIndices.add(worldIdx); // Also hide main map tiles here to see background through windows\n                      } else {\n                          activeRoomIndices.add(worldIdx);\n                      }\n                  }\n              }\n          }\n      });\n  }\n\n  // Add background color for rooms\n  if (mapType === 'room') {\n    const bgColorStr = options.backgroundColor || '#1a1a1a';\n    const bgColorHex = bgColorStr.startsWith('#') ? \n        parseInt(bgColorStr.substring(1), 16) : \n        0x1a1a1a;\n    \n    const roomBg = new Graphics();\n    const floorTileIds = new Set(tileMapData.filter(id => id));\n    const floorObjIds = new Set(objectMapData.filter(id => id && !id.includes('player')));\n\n    for (let i = 0; i < mapWidth * mapHeight; i++) {\n        const id = tileMapData[i];\n        const objId = objectMapData[i];\n        \n        // Window logic: if there is no tile AND no object, it's a window (transparent)\n        // Be very strict about what counts as content\n        const hasContent = (id && id !== \"0\") || (objId && objId !== \"0\" && !objId.includes('player'));\n\n        if (hasContent) {\n            const tx = i % mapWidth;\n            const ty = Math.floor(i / mapWidth);\n            const x = offsetX + tx * tileSize;\n            const y = offsetY + ty * tileSize;\n            \n            // Use a slightly larger rect (0.5px) to prevent gaps/bleeding between tiles\n            // but keep the overall room boundary sharp\n            roomBg.rect(x - 0.25, y - 0.25, tileSize + 0.5, tileSize + 0.5);\n        }\n    }\n    roomBg.fill({ color: bgColorHex, alpha: 1 });\n    targetBg.addChild(roomBg);\n  }\n\n  // Background tiles\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    const secretId = secretMapData?.[i];\n\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    // Hide content if it's under an active room\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area'; // Don't treat room_area as a classic secret filter if it's used as a window\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n\n    if (isInSecretArea && isSecretRevealed) {\n      const filterColor = secretDef?.filterColorInGame || secretDef?.filterColor || 'rgba(0, 0, 0, 0.6)';\n      const renderAbove = secretDef?.renderAbovePlayer;\n      const key = `${x},${y}`;\n      if (renderAbove) {\n        secretOverlays.above.set(key, filterColor);\n      } else {\n        secretOverlays.below.set(key, filterColor);\n      }\n    }\n\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      renderOnSecretLayer = true;\n    } else if (isInSecretArea && isSecretRevealed) {\n      renderOnSecretLayer = true;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def) || isWaterfallDef(def) || isLavaWaterfallDef(def) || isRadioactiveWaterDef(def) || isRadioactiveWaterfallDef(def) || def.type === 'entity' || def.subtype === 'platform') {\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    if (renderOnSecretLayer) {\n      let backingSprite;\n      if (frames && frames.length > 0) {\n        backingSprite = new AnimatedSprite(frames);\n        backingSprite.animationSpeed = sprite.animationSpeed;\n        backingSprite.play();\n      } else if (sprite.texture) {\n        backingSprite = new Sprite(sprite.texture);\n      }\n\n      if (backingSprite) {\n        backingSprite.x = x;\n        backingSprite.y = y;\n        backingSprite.width = tileSize;\n        backingSprite.height = tileSize;\n        targetBg.addChild(backingSprite);\n      }\n\n      const backing = new Graphics();\n      backing.rect(x, y, tileSize, tileSize);\n      backing.fill({ color: 0x000000, alpha: 0.7 });\n      targetBg.addChild(backing);\n\n      sprite.alpha = 0.4;\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        targetBg.addChild(sprite);\n      }\n    } else {\n      targetBg.addChild(sprite);\n    }\n  }\n\n  // Objects\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n\n    const secretId = secretMapData?.[i];\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    const def = getDef(id);\n    if (!def || def.type === 'entity' || def.subtype === 'platform' || def.subtype === 'pushable' || def.isPushable) continue;\n\n    const meta = (objectMetadata && objectMetadata[i]) || {};\n    const maxH = def.maxHealth || 100;\n    const health = meta.health !== undefined ? meta.health : maxH;\n\n    let visualElement;\n    if (def.spriteSheet && def.spriteSheet.enabled) {\n      const totalSprites = def.spriteSheet.totalSprites || 1;\n      const columns = def.spriteSheet.columns || totalSprites;\n      \n      const healthPercent = Math.max(0, Math.min(100, (health / maxH) * 100));\n      let frameIndex = 0;\n      \n      if (meta.currentFrame !== undefined) {\n        frameIndex = meta.currentFrame;\n      } else if (def.subtype === 'door' && mapType === 'room') {\n        frameIndex = def.interaction?.frames?.inside || 2;\n      } else if (Number.isFinite(Number(def.spriteSheet?.frameIndex))) {\n        frameIndex = Number(def.spriteSheet.frameIndex);\n      } else {\n        frameIndex = Math.floor((1 - healthPercent / 100) * (totalSprites - 1));\n      }\n      \n      frameIndex = Math.max(0, Math.min(totalSprites - 1, frameIndex));\n\n      const baseTexture = getTexture(def.texture);\n      const source = baseTexture?.source;\n      if (source && source.width > 1) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const frameWidth = texWidth / columns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / columns);\n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        visualElement = new Sprite(new Texture({ source: source, frame: rect }));\n      } else {\n        visualElement = buildSpriteFromDef(def);\n      }\n    } else {\n      visualElement = buildSpriteFromDef(def);\n    }\n\n    if (!visualElement) continue;\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n    \n    const renderOffsetX = Number(def.render?.offsetX) || 0;\n    const renderOffsetY = Number(def.render?.offsetY) || 0;\n    const overlapX = Number(def.render?.overlapX) || 0;\n    const overlapY = Number(def.render?.overlapY) || 0;\n    if (visualElement.anchor && visualElement.anchor.x === 0.5) {\n      visualElement.x = tileSize / 2 + renderOffsetX - overlapX / 2;\n      visualElement.y = tileSize / 2 + renderOffsetY - overlapY / 2;\n    } else {\n      visualElement.x = renderOffsetX - overlapX / 2;\n      visualElement.y = renderOffsetY - overlapY / 2;\n    }\n    \n    const tileW = meta.width || def.width || 1;\n    const tileH = meta.height || def.height || 1;\n    const objWidth = tileW * tileSize;\n    const objHeight = tileH * tileSize;\n    visualElement.width = objWidth + overlapX;\n    visualElement.height = objHeight + overlapY;\n\n    const container = new Container();\n    const isLargeDecoration = def.type === 'decoration' && (tileW > 1 || tileH > 1);\n    const anchorOffsetX = isLargeDecoration ? -Math.floor(tileW / 2) * tileSize : 0;\n    const anchorOffsetY = isLargeDecoration ? -(tileH - 1) * tileSize : 0;\n    container.x = x + anchorOffsetX;\n    container.y = y + anchorOffsetY;\n    container.isRoomContent = mapType === 'room';\n    \n    if (id === 'minispill_sea_rescue_ship' || id === 'minispill_sea_rescue_trigger') {\n      container.isSeaRescueShipPart = true;\n      container.baseX = container.x;\n      container.baseY = container.y;\n    }\n    \n    if (id.startsWith('minispill_sea_rescue_box')) {\n      container.isSeaRescueBox = true;\n      container.baseY = container.y;\n      container.bubbles = def.bubbles;\n      container.boxWidth = def.width || 1;\n      container.boxHeight = def.height || 1;\n    }\n    \n    const isWeatherTrigger = def.type === 'weather_trigger';\n    const isMessageTrigger = def.type === 'message_trigger';\n    const isWolfSecret = def.type === 'wolf_secret';\n    const shouldShowAnyway = (isWeatherTrigger || isMessageTrigger || isWolfSecret) && (isEditor || isEditorPlayMode);\n    \n    if (def.isHiddenInGame && !isEditor && !shouldShowAnyway) {\n      if (meta.capturedBoxId) {\n        visualElement.visible = false;\n      } else {\n        container.visible = false;\n      }\n    }\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    if (isInSecretArea && !isSecretRevealed && !isEditor) {\n      container.visible = false;\n    }\n\n    container.addChild(visualElement);\n\n    if (meta.capturedBoxId) {\n      const boxDef = getDef(meta.capturedBoxId);\n      if (boxDef) {\n        let boxSprite;\n        if (boxDef.spriteSheet && boxDef.spriteSheet.enabled) {\n          const bBaseTexture = getTexture(boxDef.texture);\n          const bSource = bBaseTexture?.source;\n          if (bSource && bSource.width > 1) {\n            const bCols = boxDef.spriteSheet.columns || boxDef.spriteSheet.totalSprites || 1;\n            const bTotal = boxDef.spriteSheet.totalSprites || 1;\n            const bFrameIndex = Math.max(0, Math.min(bTotal - 1, Number(boxDef.spriteSheet.frameIndex) || 0));\n            const bFrameWidth = bSource.width / bCols;\n            const bFrameHeight = bSource.height / Math.ceil(bTotal / bCols);\n            const bCol = bFrameIndex % bCols;\n            const bRow = Math.floor(bFrameIndex / bCols);\n            const bRect = new Rectangle(bCol * bFrameWidth, bRow * bFrameHeight, bFrameWidth, bFrameHeight);\n            boxSprite = new Sprite(new Texture({ source: bSource, frame: bRect }));\n          }\n        }\n        if (!boxSprite) {\n          boxSprite = buildSpriteFromDef(boxDef);\n        }\n        if (boxSprite) {\n          boxSprite.width = tileSize * 0.8;\n          boxSprite.height = tileSize * 0.8;\n          boxSprite.x = (objWidth - boxSprite.width) / 2;\n          boxSprite.y = (objHeight - boxSprite.height) / 2 - 4;\n          container.addChild(boxSprite);\n        }\n      }\n    }\n\n    if (def.isDestructible && health < maxH && health > 0) {\n      try {\n        const hb = new HealthBar({\n          width: objWidth,\n          height: 4,\n          offsetX: 0,\n          offsetY: -5\n        });\n        hb.update(health, maxH);\n        container.addChild(hb);\n      } catch (e) {}\n    }\n\n    const renderAbove = meta.renderAbovePlayer !== undefined ? !!meta.renderAbovePlayer : !!def.renderAbovePlayer;\n    if (renderAbove) {\n      targetObjFront.addChild(container);\n    } else {\n      targetObjBehind.addChild(container);\n    }\n  }\n};\n\nconst renderSecretOverlays = (refs, options, overlays) => {\n  const { tileSize } = options;\n  const { secretLayerRef } = refs;\n\n  const drawOverlay = (map, container) => {\n    if (!container || map.size === 0) return;\n    const overlay = new Graphics();\n    map.forEach((filterColor, key) => {\n      const [x, y] = key.split(',').map(Number);\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    container.addChild(overlay);\n  };\n\n  drawOverlay(overlays.below, secretLayerRef?.below);\n  drawOverlay(overlays.above, secretLayerRef?.above);\n};\n","import { Container, Text } from 'pixi.js';\nimport floatConfig from '../../../../assets/json/system/floating_text.json';\n\nexport const createFloatingTextManager = (layer) => {\n  const items = [];\n  const cfg = floatConfig || {};\n  const defaultCfg = cfg.default || {};\n  const critCfg = cfg.crit || {};\n\n  const add = ({\n    x,\n    y,\n    text,\n    color = '#ff3b3b',\n    fontSize = 14,\n    ttlMs = 900,\n    amount,\n    crit\n  }) => {\n    if (!layer || !Number.isFinite(x) || !Number.isFinite(y) || !text) return;\n\n    const amountValue = Number.isFinite(amount) ? amount : null;\n    const critThreshold = Number.isFinite(critCfg.threshold) ? critCfg.threshold : null;\n    const isCrit = !!crit || (amountValue !== null && critThreshold !== null && Math.abs(amountValue) >= critThreshold);\n\n    const baseColor = defaultCfg.color || color;\n    const finalColor = isCrit ? (critCfg.color || baseColor) : baseColor;\n    const finalFontSize = isCrit ? (critCfg.fontSize || Math.round((defaultCfg.fontSize || fontSize) * 1.2)) : (defaultCfg.fontSize || fontSize);\n    const finalTtl = isCrit ? (critCfg.ttlMs || defaultCfg.ttlMs || ttlMs) : (defaultCfg.ttlMs || ttlMs);\n    const riseSpeed = isCrit ? (critCfg.riseSpeed || defaultCfg.riseSpeed || 0.04) : (defaultCfg.riseSpeed || 0.04);\n    const jitterX = Number.isFinite(defaultCfg.jitterX) ? defaultCfg.jitterX : 6;\n    const jitterY = Number.isFinite(defaultCfg.jitterY) ? defaultCfg.jitterY : 2;\n    const prefix = isCrit && typeof critCfg.prefix === 'string' ? critCfg.prefix : '';\n    const suffix = isCrit && typeof critCfg.suffix === 'string' ? critCfg.suffix : '';\n    const finalText = `${prefix}${text}${suffix}`;\n\n    const label = new Text({\n      text: String(finalText),\n      style: {\n        fontFamily: 'monospace',\n        fontSize: finalFontSize,\n        fill: finalColor,\n        stroke: '#000000',\n        strokeThickness: 2,\n        dropShadow: true,\n        dropShadowColor: '#000000',\n        dropShadowBlur: 2,\n        dropShadowDistance: 1\n      }\n    });\n\n    label.anchor.set(0.5, 1);\n    const jitterXValue = (Math.random() * 2 - 1) * jitterX;\n    const jitterYValue = (Math.random() * 2 - 1) * jitterY;\n    label.position.set(x + jitterXValue, y + jitterYValue);\n    layer.addChild(label);\n\n    items.push({\n      label,\n      ttl: finalTtl,\n      total: finalTtl,\n      vy: -riseSpeed\n    });\n  };\n\n  const update = (deltaMs) => {\n    if (!items.length) return;\n    for (let i = items.length - 1; i >= 0; i--) {\n      const item = items[i];\n      item.ttl -= deltaMs;\n      if (item.ttl <= 0) {\n        try { item.label.destroy(); } catch {}\n        items.splice(i, 1);\n        continue;\n      }\n      item.label.y += item.vy * deltaMs;\n      item.label.alpha = Math.max(0, item.ttl / item.total);\n    }\n  };\n\n  return { add, update };\n};\n\nexport const createFloatingTextLayer = () => new Container();\n","import { Container, Graphics } from 'pixi.js';\n\nexport const createBreakEffectLayer = () => {\n  const layer = new Container();\n  layer.sortableChildren = true;\n  return layer;\n};\n\nexport const createBreakEffectManager = (layer) => {\n  const particles = [];\n\n  const add = ({ x, y, config }) => {\n    if (!layer || !config) return;\n    const count = Math.max(1, Number(config.count) || 12);\n    const speed = Math.max(0.2, Number(config.speed) || 2);\n    const lifeMs = Math.max(120, Number(config.lifeMs) || 600);\n    const size = Math.max(1, Number(config.size) || 2);\n    const gravity = Number.isFinite(Number(config.gravity)) ? Number(config.gravity) : 0.02;\n    const shape = config.shape === 'circle' ? 'circle' : 'square';\n    const angleRange = Array.isArray(config.angleRange) && config.angleRange.length >= 2 ? config.angleRange : null;\n    const colors = Array.isArray(config.colors) && config.colors.length ? config.colors : [0xffffff];\n    const chunks = config.chunks && typeof config.chunks === 'object' ? config.chunks : null;\n\n    for (let i = 0; i < count; i++) {\n      const angle = angleRange\n        ? (Number(angleRange[0]) + Math.random() * (Number(angleRange[1]) - Number(angleRange[0])))\n        : (Math.random() * Math.PI * 2);\n      const sp = speed * (0.5 + Math.random() * 0.9);\n      const g = new Graphics();\n      if (shape === 'circle') {\n        g.circle(0, 0, size * 0.6);\n      } else {\n        g.rect(-size / 2, -size / 2, size, size);\n      }\n      g.fill({ color: colors[i % colors.length], alpha: 1 });\n      g.x = x;\n      g.y = y;\n      layer.addChild(g);\n      particles.push({\n        g,\n        x,\n        y,\n        vx: Math.cos(angle) * sp,\n        vy: Math.sin(angle) * sp,\n        life: lifeMs,\n        maxLife: lifeMs,\n        gravity\n      });\n    }\n\n    if (chunks) {\n      const chunkCount = Math.max(0, Number(chunks.count) || 0);\n      const chunkSpeed = Math.max(0.3, Number(chunks.speed) || speed * 1.2);\n      const chunkLife = Math.max(160, Number(chunks.lifeMs) || lifeMs * 1.1);\n      const chunkSize = Math.max(size, Number(chunks.size) || size * 1.6);\n      const chunkGravity = Number.isFinite(Number(chunks.gravity)) ? Number(chunks.gravity) : gravity;\n      const chunkShape = chunks.shape === 'square' ? 'square' : 'circle';\n      const chunkAngle = Array.isArray(chunks.angleRange) && chunks.angleRange.length >= 2 ? chunks.angleRange : angleRange;\n      const chunkColors = Array.isArray(chunks.colors) && chunks.colors.length ? chunks.colors : colors;\n\n      for (let i = 0; i < chunkCount; i++) {\n        const angle = chunkAngle\n          ? (Number(chunkAngle[0]) + Math.random() * (Number(chunkAngle[1]) - Number(chunkAngle[0])))\n          : (Math.random() * Math.PI * 2);\n        const sp = chunkSpeed * (0.6 + Math.random() * 0.9);\n        const g = new Graphics();\n        if (chunkShape === 'circle') {\n          g.circle(0, 0, chunkSize * 0.6);\n        } else {\n          g.rect(-chunkSize / 2, -chunkSize / 2, chunkSize, chunkSize);\n        }\n        g.fill({ color: chunkColors[i % chunkColors.length], alpha: 1 });\n        g.x = x;\n        g.y = y;\n        layer.addChild(g);\n        particles.push({\n          g,\n          x,\n          y,\n          vx: Math.cos(angle) * sp,\n          vy: Math.sin(angle) * sp,\n          life: chunkLife,\n          maxLife: chunkLife,\n          gravity: chunkGravity\n        });\n      }\n    }\n  };\n\n  const update = (dt) => {\n    if (!particles.length) return;\n    const delta = Math.max(0, Number(dt) || 0);\n    for (let i = particles.length - 1; i >= 0; i--) {\n      const p = particles[i];\n      p.life -= delta;\n      if (p.life <= 0) {\n        if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n        particles.splice(i, 1);\n        continue;\n      }\n      p.x = (p.x || 0) + p.vx * (delta / 16.67);\n      p.y = (p.y || 0) + p.vy * (delta / 16.67);\n      p.vy += (Number(p.gravity) || 0.02) * (delta / 16.67);\n      if (p.g) {\n        p.g.x = p.x;\n        p.g.y = p.y;\n        p.g.alpha = Math.max(0, p.life / p.maxLife);\n      }\n    }\n  };\n\n  const clear = () => {\n    for (const p of particles) {\n      if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n    }\n    particles.length = 0;\n  };\n\n  return { add, update, clear };\n};\n\nexport default {\n  createBreakEffectLayer,\n  createBreakEffectManager\n};\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = getDefById(registryItems, id);\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.lava_waterfall ? 'lava_waterfall' :\n               (def.flags.radioactive_waterfall ? 'radioactive_waterfall' :\n               (def.flags.waterfall ? 'waterfall' :\n               (def.flags.radioactive_water ? 'radioactive_water' :\n               (def.flags.quicksand ? 'quicksand' :\n               (def.flags.lava ? 'lava' :\n               (def.flags.water ? 'water' : 'liquid'))))));\n  const overlayColorRaw = def?.liquid?.overlay?.color ?? def?.liquid?.overlayColor ?? def?.tintBelowSurface;\n  const overlayAlphaRaw = def?.liquid?.overlay?.alpha ?? def?.liquid?.overlayAlpha;\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    overlay: {\n      color: Number(overlayColorRaw),\n      alpha: Number(overlayAlphaRaw)\n    },\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    },\n    resources: def?.liquid?.resources || {}\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  const defaultOverlay = (() => {\n    if (type.includes('lava')) return { color: 10914816, alpha: 0.25 };\n    if (type === 'quicksand') return { color: 10916187, alpha: 0.2 };\n    if (type === 'radioactive_water' || type === 'radioactive_waterfall') return { color: 1727514, alpha: 0.18 };\n    return { color: 1919093, alpha: 0.15 };\n  })();\n  const rawOverlayColor = candidate.params?.overlay?.color;\n  const rawOverlayAlpha = candidate.params?.overlay?.alpha;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    overlay: {\n      color: Number.isFinite(rawOverlayColor) ? rawOverlayColor : defaultOverlay.color,\n      alpha: Number.isFinite(rawOverlayAlpha) ? rawOverlayAlpha : defaultOverlay.alpha\n    },\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    },\n    resources: candidate.params?.resources || {}\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","import React, { useEffect, useRef, useMemo, useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets, BlurFilter, ColorMatrixFilter, Texture, Sprite } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder, LavaRain as WeatherLavaRain, RadioactiveFog as WeatherRadioactiveFog, MeteorRain as WeatherMeteorRain } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, BubbleFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { syncEntities, cleanupEntities } from './entityManager';\nimport { drawSeaRescueTrajectory } from '../../../../engine/gameplay/seaRescue';\nimport { rebuildLayers } from './layerBuilder';\nimport { createFloatingTextLayer, createFloatingTextManager } from './floatingTextManager';\nimport { createBreakEffectLayer, createBreakEffectManager } from './breakEffectManager';\nimport { getLiquidAtPixel } from '../../../../engine/liquids/liquidUtils';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({\n  skipCacheIdWarning: true,\n  preferCreateImageBitmap: false, // Prevents WebGL warning: texImage: Alpha-premult and y-flip are deprecated\n});\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\nconst LIQUID_SURFACE_MAP = [\n  { key: 'lava', surface: 'lava' },\n  { key: 'radioactive', surface: 'radiation' },\n  { key: 'quicksand', surface: 'quicksand' },\n  { key: 'water', surface: 'water' },\n];\n\nconst toSurfaceType = (liquidType) => {\n  if (!liquidType) return null;\n  for (const entry of LIQUID_SURFACE_MAP) {\n    if (liquidType.includes(entry.key)) return entry.surface;\n  }\n  return null;\n};\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = EMPTY_ARRAY,\n  objectMapData = EMPTY_ARRAY,\n  secretMapData = EMPTY_ARRAY,\n  revealedSecrets = EMPTY_ARRAY,\n  registryItems = EMPTY_ARRAY,\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  weatherLavaRain = 0,\n  weatherRadioactiveFog = 0,\n  weatherMeteorRain = 0,\n  projectiles = EMPTY_ARRAY,\n  healthBarEnabled = true,\n  objectMetadata = EMPTY_OBJECT,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n  isEditor = false,\n  isEditorPlayMode = false,\n  mapType = 'overworld',\n  activeRoomIds = EMPTY_ARRAY,\n  maps = EMPTY_OBJECT,\n  showGrid = false,\n  renderLayers = null, // null means all layers, otherwise an array of layer names to show\n  pointerEvents = 'auto',\n  onWeatherEffectHit = null,\n  roomBlurEnabled = true,\n  debugOverlayEnabled = false,\n  engineInput = null,\n  engineRefs = null,\n  mapData = null,\n}) => {\n  const [isPixiReady, setIsPixiReady] = useState(false);\n\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const cameraPosRef = useRef({ x: 0, y: 0 });\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const roomBgRef = useRef(null);\n  const roomObjBehindRef = useRef(null);\n  const roomObjFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerLayerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidBgLayerRef = useRef(null);\n  const trajectoryLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const engineInputRef = useRef(engineInput);\n  const engineRefsRef = useRef(engineRefs);\n  const mapTypeRef = useRef(mapType);\n  const mapDataRef = useRef(mapData);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null, fog: null, lavaRain: null, radioactiveFog: null, meteorRain: null });\n  const weatherPropsRef = useRef({ rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0, lavaRain: 0, radioactiveFog: 0, meteorRain: 0 });\n  const tileMapDataRef = useRef(tileMapData);\n  const registryItemsRef = useRef(registryItems);\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const entitiesLayerRef = useRef(null);\n  const entitySpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef(EMPTY_ARRAY);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const driftSettingsRef = useRef({ enabled: true, amplitude: 5, speed: 0.002 });\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0, targetAlpha: 0, currentAlpha: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const bubbleFxRef = useRef(null);\n  const fishBubbleStateRef = useRef(new Map());\n  const entityWaterStateRef = useRef(new Map());\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n  const gridRef = useRef(null);\n  const showGridRef = useRef(showGrid);\n  const roomBlurEnabledRef = useRef(roomBlurEnabled);\n  const blurFilterRef = useRef(new BlurFilter({ strength: 0 }));\n  const darkenFilterRef = useRef(new ColorMatrixFilter());\n  const roomBrightnessFilterRef = useRef(new ColorMatrixFilter());\n  const vignetteRef = useRef(null);\n  const floatingLayerRef = useRef(null);\n  const debugLayerRef = useRef(null);\n  const debugEnabledRef = useRef(!!debugOverlayEnabled);\n  const floatingManagerRef = useRef(null);\n  const breakFxLayerRef = useRef(null);\n  const breakFxManagerRef = useRef(null);\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { showGridRef.current = showGrid; }, [showGrid]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { roomBlurEnabledRef.current = roomBlurEnabled; }, [roomBlurEnabled]);\n  useEffect(() => { debugEnabledRef.current = !!debugOverlayEnabled; }, [debugOverlayEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { engineInputRef.current = engineInput; }, [engineInput]);\n  useEffect(() => { engineRefsRef.current = engineRefs; }, [engineRefs]);\n  useEffect(() => { mapTypeRef.current = mapType; }, [mapType]);\n  useEffect(() => { mapDataRef.current = mapData; }, [mapData]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n  useEffect(() => { tileMapDataRef.current = tileMapData; }, [tileMapData]);\n  useEffect(() => { registryItemsRef.current = registryItems; }, [registryItems]);\n\n  useEffect(() => {\n    if (mapType === 'sea_rescue') {\n      fetch('/assets/json/mini_spill/sea_rescue/sea_rescue_settings.json')\n        .then(r => r.json())\n        .then(data => {\n          if (data.drift) driftSettingsRef.current = data.drift;\n        })\n        .catch(err => console.warn('Failed to load drift settings:', err));\n    }\n  }, [mapType]);\n\n  // Sync weather props to ref for systems to read live\n  useEffect(() => {\n    weatherPropsRef.current = {\n      rain: Number(weatherRain) || 0,\n      snow: Number(weatherSnow) || 0,\n      clouds: Number(weatherClouds) || 0,\n      fog: Number(weatherFog) || 0,\n      thunder: Number(weatherThunder) || 0,\n      lavaRain: Number(weatherLavaRain) || 0,\n      radioactiveFog: Number(weatherRadioactiveFog) || 0,\n      meteorRain: Number(weatherMeteorRain) || 0,\n    };\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl,\n      minWidth: appRef.current?.screen?.width || 0,\n      minHeight: appRef.current?.screen?.height || 0\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      if (appRef.current) return;\n\n      const app = new Application();\n      try {\n        await app.init({\n          resizeTo: mountRef.current,\n          backgroundAlpha: 0,\n          antialias: false,\n          autoDensity: true,\n        });\n\n        // Enable z-index sorting for the main stage\n        app.stage.sortableChildren = true;\n        app.stage.eventMode = 'static';\n        app.stage.hitArea = app.screen;\n\n        if (destroyed) {\n          app.destroy(true, { children: true, texture: true });\n          return;\n        }\n\n        if (!app.renderer) return;\n\n        appRef.current = app;\n        app.stage.sortableChildren = true;\n\n        // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const roomBg = new Container();\n      const roomObjBehind = new Container();\n      const roomObjFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const entitiesLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidBgLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const vignetteLayer = new Container();\n      const overlayLayer = new Container();\n      const floatingLayer = createFloatingTextLayer();\n      const breakFxLayer = createBreakEffectLayer();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      roomBg.zIndex = LAYERS.tiles + 1;\n      objBehind.zIndex = LAYERS.objBehind;\n      roomObjBehind.zIndex = LAYERS.objBehind + 1;\n      objFront.zIndex = LAYERS.objFront;\n      roomObjFront.zIndex = LAYERS.objFront + 1;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      entitiesLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidBgLayer.zIndex = LAYERS.liquidBackground;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      vignetteLayer.zIndex = LAYERS.overlay - 1;\n      overlayLayer.zIndex = LAYERS.overlay;\n      floatingLayer.zIndex = LAYERS.overlay + 1;\n      breakFxLayer.zIndex = LAYERS.overlay + 2;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      roomBgRef.current = roomBg;\n      roomObjBehindRef.current = roomObjBehind;\n      roomObjFrontRef.current = roomObjFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      playerLayerRef.current = playerLayer;\n      liquidBgLayerRef.current = liquidBgLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      entitiesLayerRef.current = entitiesLayer;\n      vignetteRef.current = vignetteLayer;\n      overlayLayerRef.current = overlayLayer;\n      floatingLayerRef.current = floatingLayer;\n      floatingManagerRef.current = createFloatingTextManager(floatingLayer);\n      breakFxLayerRef.current = breakFxLayer;\n      breakFxManagerRef.current = createBreakEffectManager(breakFxLayer);\n    \n      const gridGraphics = new Graphics();\n      gridRef.current = gridGraphics;\n      overlayLayer.addChild(gridGraphics);\n\n      const trajectoryGraphics = new Graphics();\n      trajectoryLayerRef.current = trajectoryGraphics;\n      overlayLayer.addChild(trajectoryGraphics);\n\n      overlayLayer.addChild(breakFxLayer);\n\n      const debugGraphics = new Graphics();\n      debugLayerRef.current = debugGraphics;\n      overlayLayer.addChild(debugGraphics);\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      const allLayersMap = {\n        background: [bg, bgAnim],\n        parallax: [parallaxLayer],\n        tiles: [bg, bgAnim], // Aliased for convenience\n        objects: [objBehind, objFront, secretBelowLayer, secretAboveLayer, entitiesLayer, projLayer],\n        player: [playerLayer],\n        weather: [weatherLayer, fogLayer],\n        liquids: [liquidBgLayer, liquidLayer, liquidFxLayer],\n        overlay: [overlayLayer]\n      };\n\n      if (renderLayers) {\n        renderLayers.forEach(layerName => {\n          const layers = allLayersMap[layerName];\n          if (layers) layers.forEach(l => {\n            if (!app.stage.children.includes(l)) app.stage.addChild(l);\n          });\n        });\n      } else {\n        // Add layers in z-order priority (back to front) for stability\n        app.stage.addChild(\n          parallaxLayer,\n          bg, bgAnim, \n          roomBg,\n          liquidBgLayer, \n          objBehind, \n          roomObjBehind,\n          secretBelowLayer, \n          playerLayer, \n          entitiesLayer, \n          projLayer, \n          objFront, \n          roomObjFront,\n          secretAboveLayer, \n          weatherLayer, \n          fogLayer, \n          liquidLayer, \n          liquidFxLayer,\n          vignetteLayer,\n          overlayLayer,\n          floatingLayer\n        );\n      }\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas - DROA PIEVIENOANA\n      if (mountRef.current && app.renderer && app.canvas) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.rect(0, 0, W, H);\n      g.fill({ color: 0x1d4875, alpha: 1 });\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffcc00, warn: 0xffaa00, danger: 0xff8800 };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas && app.renderer) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          // No need to manually rebuild here as the main useEffect will catch app state or we can just trigger a state change if needed.\n          // But Pixi v8 often recovers automatically. To be safe, we can force a rebuild by just waiting for next tick.\n        });\n      }\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n            mapWidth, \n            mapHeight, \n            tileSize,\n            bgContainer: liquidBgLayerRef.current\n          });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { bubbleFxRef.current = new BubbleFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      \n      if (engineRefs) {\n        engineRefs.fx = {\n          triggerSplash: (x, y, color) => waterFxRef.current?.trigger({ x, y, color }),\n          triggerBubbles: (x, y, color) => bubbleFxRef.current?.trigger({ x, y, color })\n        };\n      }\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n      } catch {}\n\n      rebuildParallax();\n\n      // Finalize initialization by setting appRef\n      // This will trigger the second useEffect to build layers and player\n      appRef.current = app;\n      setIsPixiReady(true);\n      app.ticker.add(() => {\n        if (gridRef.current) {\n          gridRef.current.clear();\n          if (showGridRef.current) {\n            for (let x = 0; x <= mapWidth; x++) {\n              gridRef.current.moveTo(x * tileSize, 0);\n              gridRef.current.lineTo(x * tileSize, mapHeight * tileSize);\n            }\n            for (let y = 0; y <= mapHeight; y++) {\n              gridRef.current.moveTo(0, y * tileSize);\n              gridRef.current.lineTo(mapWidth * tileSize, y * tileSize);\n            }\n            gridRef.current.stroke({ width: 0.5, color: 0xffffff, alpha: 0.2 });\n          }\n        }\n\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          playerRef.current.visible = mapTypeRef.current !== 'sea_rescue';\n          if (playerRef.current.visible) {\n            updatePlayerSprite(\n                { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n                s,\n                tileSize,\n                hbEnabledRef.current\n            );\n          }\n        }\n\n        // Camera Follow\n        const sw = app.screen.width;\n        const sh = app.screen.height;\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        if (s) {\n          const targetX = (s.x || 0) + (s.width || tileSize) / 2;\n          const targetY = (s.y || 0) + (s.height || tileSize) / 2;\n\n          let camX = targetX - sw / 2;\n          let camY = targetY - sh / 2;\n\n          // Constraints with centering for small maps\n          if (worldW < sw) {\n            camX = (worldW - sw) / 2;\n          } else {\n            camX = Math.max(0, Math.min(camX, worldW - sw));\n          }\n\n          if (worldH < sh) {\n            camY = (worldH - sh) / 2;\n          } else {\n            camY = Math.max(0, Math.min(camY, worldH - sh));\n          }\n\n          // Use a small dead-zone/smooth follow to prevent 1px jitter from sub-pixel player movement\n          const lastCam = cameraPosRef.current || { x: camX, y: camY, rawX: camX, rawY: camY };\n          const smoothing = 0.2; // Lerp factor (0 to 1, higher is faster)\n          const rawX = lastCam.rawX !== undefined ? lastCam.rawX : camX;\n          const rawY = lastCam.rawY !== undefined ? lastCam.rawY : camY;\n          \n          const nextRawX = rawX + (camX - rawX) * smoothing;\n          const nextRawY = rawY + (camY - rawY) * smoothing;\n\n          cameraPosRef.current = { \n            x: Math.round(nextRawX), \n            y: Math.round(nextRawY),\n            rawX: nextRawX,\n            rawY: nextRawY\n          };\n\n          if (engineRefsRef.current) {\n            if (!engineRefsRef.current.cameraRef) engineRefsRef.current.cameraRef = { x: 0, y: 0 };\n            engineRefsRef.current.cameraRef.x = nextRawX;\n            engineRefsRef.current.cameraRef.y = nextRawY;\n\n            // Update world mouse position for gameplay logic\n            const mouseData = app.renderer.events.pointer.global;\n            const worldMouse = app.stage.toLocal(mouseData);\n            if (!engineRefsRef.current.mouseWorldPos) engineRefsRef.current.mouseWorldPos = { x: 0, y: 0 };\n            engineRefsRef.current.mouseWorldPos.x = worldMouse.x;\n            engineRefsRef.current.mouseWorldPos.y = worldMouse.y;\n          }\n          \n          app.stage.pivot.set(Math.round(nextRawX), Math.round(nextRawY));\n          \n          window.__PLAYER_POS__ = { x: s.x, y: s.y };\n\n          if (parallaxRef.current) {\n            parallaxRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          if (vignetteRef.current && vignetteRef.current.visible) {\n            vignetteRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          const f = parallaxFactorRef.current;\n          if (parallaxManagerRef.current) {\n            parallaxManagerRef.current.resize(worldW, worldH, sw, sh);\n            parallaxManagerRef.current.setScroll(nextRawX, f);\n          }\n\n          // Sea Rescue Trajectory\n          if (trajectoryLayerRef.current) {\n            trajectoryLayerRef.current.clear();\n            if (mapTypeRef.current === 'sea_rescue') {\n                const time = app.ticker.lastTime;\n                const driftY = driftSettingsRef.current.enabled \n                  ? Math.sin(time * driftSettingsRef.current.speed) * driftSettingsRef.current.amplitude \n                  : 0;\n\n                if (engineRefsRef.current) {\n                  engineRefsRef.current.driftY = driftY;\n                }\n\n                const drawCtx = {\n                    input: engineInputRef.current,\n                    refs: engineRefsRef.current,\n                    cameraX: nextRawX,\n                    cameraY: nextRawY,\n                    mapData: mapDataRef.current,\n                    tileSize: tileSize,\n                    driftY: driftY\n                };\n                drawSeaRescueTrajectory(drawCtx, trajectoryLayerRef.current);\n            }\n          }\n        }\n\n        // Sea Rescue Drift & Bubbles\n        if (mapTypeRef.current === 'sea_rescue') {\n          const time = app.ticker.lastTime;\n          const driftY = driftSettingsRef.current.enabled \n            ? Math.sin(time * driftSettingsRef.current.speed) * driftSettingsRef.current.amplitude \n            : 0;\n          \n          const now = Date.now();\n          const updateSeaRescueVisuals = (container) => {\n            if (!container) return;\n            const shipOffset = (mapTypeRef.current === 'sea_rescue' && s) ? (s.x || 0) : 0;\n            container.children.forEach(child => {\n              // Drift (Ship, Triggers & Boxes)\n              if (child.isSeaRescueShipPart || child.isSeaRescueBox) {\n                if (child.isSeaRescueShipPart) {\n                    child.x = (child.baseX || child.x) + shipOffset;\n                }\n                const phase = child.isSeaRescueBox ? ((child.x * 0.1) + (child.y * 0.1)) : 0;\n                child.y = (child.baseY || child.y) + Math.sin((time * driftSettingsRef.current.speed) + phase) * driftSettingsRef.current.amplitude;\n              }\n              // Bubbles (Boxes)\n              if (child.isSeaRescueBox && child.bubbles?.enabled && bubbleFxRef.current) {\n                if (!child.lastBubbleTime || now - child.lastBubbleTime > (child.bubbles.intervalMs || 1000)) {\n                  const w = (child.boxWidth || 1) * tileSize;\n                  const h = (child.boxHeight || 1) * tileSize;\n                  const bx = child.x + Math.random() * w;\n                  const by = child.y + Math.random() * h;\n                  \n                  bubbleFxRef.current.trigger({\n                    x: bx,\n                    y: by,\n                    color: child.bubbles.color ? parseInt(child.bubbles.color.replace('#', '0x'), 16) : 0xc9ecff,\n                    rise: 0.02 + Math.random() * 0.02,\n                    life: 1500 + Math.random() * 1000\n                  });\n                  child.lastBubbleTime = now;\n                }\n              }\n            });\n          };\n          updateSeaRescueVisuals(objBehindRef.current);\n          updateSeaRescueVisuals(objFrontRef.current);\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        const swNow = app.screen.width;\n        const shNow = app.screen.height;\n\n        if (systems.rain) {\n          if (systems.rain.resize) systems.rain.resize(swNow, shNow);\n          systems.rain.update(dt);\n        }\n        if (systems.lavaRain) {\n          if (systems.lavaRain.resize) systems.lavaRain.resize(swNow, shNow);\n          systems.lavaRain.update(dt);\n        }\n        if (systems.snow) {\n          if (systems.snow.resize) systems.snow.resize(swNow, shNow);\n          systems.snow.update(dt);\n        }\n        if (systems.meteorRain) {\n          if (systems.meteorRain.resize) systems.meteorRain.resize(swNow, shNow);\n          systems.meteorRain.update(dt);\n        }\n        if (systems.clouds) {\n          if (systems.clouds.resize) systems.clouds.resize(swNow, shNow);\n          systems.clouds.update(dt);\n        }\n        if (systems.fog) {\n          if (systems.fog.resize) systems.fog.resize(swNow, shNow);\n          systems.fog.update(dt);\n        }\n        if (systems.radioactiveFog) {\n          if (systems.radioactiveFog.resize) systems.radioactiveFog.resize(swNow, shNow);\n          systems.radioactiveFog.update(dt);\n        }\n        if (systems.thunder) {\n          if (systems.thunder.resize) systems.thunder.resize(swNow, shNow);\n          systems.thunder.update(dt);\n        }\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { bubbleFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater/lava overlay with smooth fade-in/out\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n\n          // Safety check: ensure graphics object exists and is attached\n          if (u && (!u.g || u.g.destroyed)) {\n            const overlayL = overlayLayerRef.current;\n            if (overlayL) {\n              const g = new Graphics();\n              overlayL.addChild(g);\n              u.g = g;\n              u.currentAlpha = 0;\n              u.targetAlpha = 0;\n              u.time = 0;\n            }\n          }\n\n          if (u && u.g) {\n            // Check if player's head is in water/lava for full overlay\n            // If only body is in liquid, use a much subtler effect or none\n            const liquidType = sNow.liquidType;\n            const headUnder = !!(sNow && sNow.headUnderWater);\n            const inLiquid = !!(sNow && sNow.inWater);\n            \n            const overlayCfg = sNow.liquidOverlay || null;\n            const showOverlay = headUnder && !!overlayCfg;\n\n            let overlayColor = 0x1d4875;\n            let maxTargetAlpha = 0.15;\n\n            if (overlayCfg) {\n              if (Number.isFinite(overlayCfg.color)) overlayColor = overlayCfg.color;\n              if (Number.isFinite(overlayCfg.alpha)) maxTargetAlpha = overlayCfg.alpha;\n            }\n\n            if (showOverlay) {\n              u.time += dt;\n              // Target alpha with pulse effect\n              const pulseBase = (maxTargetAlpha * 0.8) + (maxTargetAlpha * 0.2) * Math.sin(u.time * 0.0025);\n              u.targetAlpha = pulseBase;\n\n              // Smooth fade-in: gradually approach target alpha\n              const fadeSpeed = 0.01; // Faster fade-in for immediate visibility\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeSpeed);\n\n              // Update color if liquid type changed (only when needed to avoid constant redraw)\n              if (!u.g.visible || u.lastLiquidType !== liquidType) {\n                u.g.clear();\n                u.g.rect(0, 0, mapWidth * tileSize, mapHeight * tileSize);\n                u.g.fill({ color: overlayColor, alpha: 1 });\n                u.lastLiquidType = liquidType;\n              }\n\n              u.g.visible = true;\n              u.g.alpha = u.currentAlpha;\n            } else {\n              // Smooth fade-out\n              u.targetAlpha = 0;\n              const fadeOutSpeed = 0.008; // Faster fade-out\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeOutSpeed);\n              u.g.alpha = u.currentAlpha;\n\n              if (u.currentAlpha < 0.01) {\n                u.currentAlpha = 0;\n                u.g.alpha = 0;\n                u.g.visible = false;\n                u.time = 0; // Reset time for next submersion\n              }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n\n        // Entities\n        const sNow = playerStateRef.current || {};\n        syncEntities(entitiesLayerRef.current, entitySpritesRef.current, sNow.entities, registryItems, tileSize);\n\n        try {\n          const ents = sNow.entities || [];\n          const tileData = tileMapDataRef.current;\n          const regs = registryItemsRef.current;\n          const seen = new Set();\n\n          for (const ent of ents) {\n            if (!ent) continue;\n            const id = ent.id;\n            seen.add(id);\n            const def = ent.def || {};\n            const cx = (ent.x || 0) + (ent.width || tileSize) * 0.5;\n            const cy = (ent.y || 0) + (ent.height || tileSize) * 0.5;\n            const liq = (tileData && regs)\n              ? getLiquidAtPixel(cx, cy, mapWidth, mapHeight, tileSize, tileData, regs)\n              : null;\n            const inWater = !!(liq && (liq.type === 'water' || liq.type === 'waterfall'));\n\n            const prev = entityWaterStateRef.current.get(id) || { inWater: false };\n            if (inWater && !prev.inWater && waterFxRef.current && liquidSystemRef.current) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', cx);\n              const strength = Math.min(2, Math.max(0.3, Math.abs(ent.vy || 0) * 0.08 + 0.4));\n              if (Number.isFinite(sy)) {\n                waterFxRef.current?.trigger({ x: cx, y: sy, strength, upward: false });\n                try { liquidSystemRef.current?.addWave?.('water', cx, Math.min(2.2, strength)); } catch {}\n              }\n            }\n            entityWaterStateRef.current.set(id, { inWater });\n\n            const isFish = def.subtype === 'fish' || def.ai?.type === 'fish' || def.fish;\n            const isAlive = Number(ent.health) > 0;\n            if (isFish && isAlive && !ent.isDormant && inWater && bubbleFxRef.current) {\n              const cfg = def.fish || {};\n              const interval = Math.max(200, Number(cfg.bubbleIntervalMs) || 900);\n              const jitter = Math.max(0, Number(cfg.bubbleJitter) || 0.4);\n              const state = fishBubbleStateRef.current.get(id) || { t: 0 };\n              state.t += dt;\n              if (state.t >= interval) {\n                state.t = 0;\n                const bx = cx + (Math.random() - 0.5) * tileSize * jitter;\n                const by = cy + (Math.random() - 0.5) * tileSize * jitter;\n                bubbleFxRef.current.trigger({\n                  x: bx,\n                  y: by,\n                  size: 2,\n                  rise: 0.025 + Math.random() * 0.02,\n                  life: 1000 + Math.random() * 400,\n                  drift: 0.015 + Math.random() * 0.02\n                });\n              }\n              fishBubbleStateRef.current.set(id, state);\n            } else if (isFish) {\n              fishBubbleStateRef.current.delete(id);\n            }\n          }\n\n          for (const key of fishBubbleStateRef.current.keys()) {\n            if (!seen.has(key)) fishBubbleStateRef.current.delete(key);\n          }\n          for (const key of entityWaterStateRef.current.keys()) {\n            if (!seen.has(key)) entityWaterStateRef.current.delete(key);\n          }\n        } catch {}\n\n        // Floating texts\n        floatingManagerRef.current?.update(dt);\n        // Break FX\n        breakFxManagerRef.current?.update(dt);\n      });\n    } catch (error) {\n      console.error('PixiStage init failed:', error);\n    }\n  };\n\n  init();\n\n  return () => {\n    destroyed = true;\n    if (appRef.current) {\n      const appToDestroy = appRef.current;\n      appRef.current = null;\n      appToDestroy.destroy(true, { children: true, texture: true });\n    }\n    try { liquidSystemRef.current?.destroy(); } catch {}\n    try { waterFxRef.current?.destroy(); } catch {}\n    try { bubbleFxRef.current?.destroy(); } catch {}\n    try { lavaEmbersRef.current?.destroy(); } catch {}\n    try { lavaSteamRef.current?.destroy(); } catch {}\n    try { parallaxManagerRef.current?.destroy(); } catch {}\n    parallaxManagerRef.current = null;\n    try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n    try {\n      weatherSystemsRef.current.rain?.destroy();\n      weatherSystemsRef.current.snow?.destroy();\n      weatherSystemsRef.current.fog?.destroy();\n    } catch {}\n    cleanupProjectiles(projectileSpritesRef.current);\n    cleanupEntities(entitySpritesRef.current);\n    clearTextureCache();\n  };\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      floatingManagerRef.current?.add(detail);\n    };\n    window.addEventListener('game-floating-text', handler);\n    return () => window.removeEventListener('game-floating-text', handler);\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      if (Number.isFinite(detail.x) && Number.isFinite(detail.y) && detail.config) {\n        breakFxManagerRef.current?.add(detail);\n      }\n    };\n    window.addEventListener('game-break-effect', handler);\n    return () => window.removeEventListener('game-break-effect', handler);\n  }, []);\n\n  useEffect(() => {\n    const isInsideRoom = activeRoomIds && activeRoomIds.length > 0;\n    const targetBlur = (isInsideRoom && roomBlurEnabled) ? 4 : 0;\n    const roomBrightness = isInsideRoom ? 1.25 : 1.0; // Slightly brighter interior\n    \n    if (blurFilterRef.current) {\n      blurFilterRef.current.strength = targetBlur;\n    }\n\n    if (darkenFilterRef.current) {\n      darkenFilterRef.current.reset();\n      if (isInsideRoom) {\n        // Desaturate and darken background when inside\n        darkenFilterRef.current.desaturate();\n        darkenFilterRef.current.brightness(0.75, true);\n      }\n    }\n\n    if (roomBrightnessFilterRef.current) {\n      roomBrightnessFilterRef.current.reset();\n      roomBrightnessFilterRef.current.brightness(roomBrightness, false);\n    }\n\n    if (vignetteRef.current) {\n      vignetteRef.current.visible = isInsideRoom;\n      if (isInsideRoom && !vignetteRef.current.children.length) {\n        const sw = appRef.current?.screen?.width || 800;\n        const sh = appRef.current?.screen?.height || 600;\n        \n        // Create programmatic vignette texture using canvas\n        const canvas = document.createElement('canvas');\n        canvas.width = 512;\n        canvas.height = 512;\n        const ctx = canvas.getContext('2d');\n        const grad = ctx.createRadialGradient(256, 256, 100, 256, 256, 360);\n        grad.addColorStop(0, 'rgba(0,0,0,0)');\n        grad.addColorStop(1, 'rgba(0,0,0,0.6)');\n        ctx.fillStyle = grad;\n        ctx.fillRect(0, 0, 512, 512);\n        \n        const tex = Texture.from(canvas);\n        const sprite = new Sprite(tex);\n        sprite.width = sw;\n        sprite.height = sh;\n        vignetteRef.current.addChild(sprite);\n        \n        // Also update sprite size on resize\n        vignetteRef.current._vignetteSprite = sprite;\n      }\n      \n      // Sync vignette position to camera (it should be screen-space)\n      if (isInsideRoom && vignetteRef.current._vignetteSprite) {\n        vignetteRef.current.x = cameraPosRef.current.x;\n        vignetteRef.current.y = cameraPosRef.current.y;\n        vignetteRef.current._vignetteSprite.width = appRef.current?.screen?.width || 800;\n        vignetteRef.current._vignetteSprite.height = appRef.current?.screen?.height || 600;\n      }\n    }\n\n    const layersToBlur = [\n      bgRef.current,\n      bgAnimRef.current,\n      objBehindRef.current,\n      objFrontRef.current,\n      secretLayerRef.current?.below,\n      secretLayerRef.current?.above,\n      liquidBgLayerRef.current,\n      liquidLayerRef.current,\n      parallaxRef.current\n    ];\n\n    layersToBlur.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        \n        // Blur filter\n        if (targetBlur > 0) {\n          if (!layer.filters.includes(blurFilterRef.current)) {\n            layer.filters = [...layer.filters, blurFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== blurFilterRef.current);\n        }\n\n        // Darken/Desaturate filter (Background only)\n        if (isInsideRoom) {\n          if (!layer.filters.includes(darkenFilterRef.current)) {\n            layer.filters = [...layer.filters, darkenFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== darkenFilterRef.current);\n        }\n\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n\n    // Apply brightness to room layers\n    const roomLayers = [\n      roomBgRef.current,\n      roomObjBehindRef.current,\n      roomObjFrontRef.current\n    ];\n\n    roomLayers.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        if (isInsideRoom) {\n          if (!layer.filters.includes(roomBrightnessFilterRef.current)) {\n            layer.filters = [...layer.filters, roomBrightnessFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== roomBrightnessFilterRef.current);\n        }\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n  }, [activeRoomIds, roomBlurEnabled]);\n\n  useEffect(() => {\n    const g = debugLayerRef.current;\n    if (!g) return;\n    g.clear();\n    if (!debugEnabledRef.current) {\n      g.visible = false;\n      return;\n    }\n    g.visible = true;\n\n    const getDefById = (id) => {\n      if (!id) return null;\n      const map = registryItems && registryItems.__byId;\n      if (map && typeof map.get === 'function') return map.get(id) || null;\n      return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    const tileCount = mapWidth * mapHeight;\n    for (let i = 0; i < tileCount; i++) {\n      const tileId = tileMapData[i];\n      if (!tileId) continue;\n      const def = getDefById(tileId);\n      if (!def) continue;\n      const x = (i % mapWidth) * tileSize;\n      const y = Math.floor(i / mapWidth) * tileSize;\n      const isLiquid = !!def.flags?.liquid;\n      const isLava = !!def.flags?.lava || !!def.flags?.lava_waterfall;\n      const isRadio = !!def.flags?.radioactive || !!def.flags?.radioactive_waterfall;\n      const hasCollision = !!def.collision;\n\n      if (isLiquid) {\n        const color = isLava ? 0xffa500 : (isRadio ? 0x32cd32 : 0x2ecdf1);\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color, alpha: 0.18 });\n      } else if (hasCollision) {\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color: 0xff3b3b, alpha: 0.12 });\n      }\n    }\n\n    if (Array.isArray(secretMapData) && secretMapData.length) {\n      g.stroke({ width: 1, color: 0xb57bff, alpha: 0.6 });\n      for (let i = 0; i < secretMapData.length; i++) {\n        if (secretMapData[i] !== 'room_area') continue;\n        const x = (i % mapWidth) * tileSize;\n        const y = Math.floor(i / mapWidth) * tileSize;\n        g.rect(x, y, tileSize, tileSize);\n      }\n    }\n  }, [debugOverlayEnabled, tileMapData, secretMapData, mapWidth, mapHeight, tileSize, registryItems]);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n\n    let active = true;\n\n    const runRebuild = async () => {\n        // Collect all textures to preload\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n            addUrl(def?.texture);\n            if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n            addUrl(playerVisuals.texture);\n            if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n            await Assets.load(urls);\n        }\n\n        if (!active || !appRef.current) return;\n\n        if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n            rebuildLayers(\n                { \n                  bgRef: bgRef.current, \n                  objBehindRef: objBehindRef.current, \n                  objFrontRef: objFrontRef.current, \n                  roomBgRef: roomBgRef.current,\n                  roomObjBehindRef: roomObjBehindRef.current,\n                  roomObjFrontRef: roomObjFrontRef.current,\n                  secretLayerRef: secretLayerRef.current \n                },\n                { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType, backgroundColor, activeRoomIds, maps }\n            );\n\n            // Rebuild player visuals if visuals changed or player not created yet\n            const pLayer = playerLayerRef.current;\n            if (pLayer) {\n                if (playerRef.current) {\n                    pLayer.removeChild(playerRef.current);\n                    try { playerRef.current.destroy({ children: true }); } catch {}\n                }\n                \n                const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerStateRef.current, tileSize);\n                pLayer.addChild(playerComponents.container);\n                playerRef.current = playerComponents.container;\n                playerSpriteRefs.current = playerComponents.sprites;\n                playerHealthBarRef.current = playerComponents.healthBar;\n            }\n\n            // Rebuild liquid regions only if tileMapData changed (not just revealedSecrets)\n            // This prevents liquid \"jumping\" when revealing secrets\n            const tileDataString = JSON.stringify(tileMapData);\n            const prevTileDataString = liquidSystemRef.current?._lastTileData;\n            if (tileDataString !== prevTileDataString) {\n                try {\n                    if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n                    if (liquidLayerRef.current) {\n                        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n                            mapWidth, \n                            mapHeight, \n                            tileSize,\n                            bgContainer: liquidBgLayerRef.current\n                        });\n                        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n                        liquidSystemRef.current._lastTileData = tileDataString; // Track what we built\n                    }\n                } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n                try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n            }\n\n            // Upload to GPU to avoid lazy initialization warnings\n            if (app.renderer && app.renderer.prepare) {\n                try {\n                    await app.renderer.prepare.upload(app.stage);\n                } catch (e) {\n                    // Prepare might fail in some edge cases or context loss\n                }\n            }\n        }\n    };\n\n    runRebuild();\n\n    return () => { active = false; };\n  }, [tileMapData, objectMapData, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets, objectMetadata, playerVisuals, isPixiReady, activeRoomIds, maps, mapType, backgroundColor]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer || !isPixiReady) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getPlayerState: () => playerStateRef.current,\n      getLiquidTypeAt: (x, y) => {\n        const tmd = tileMapDataRef.current;\n        const regs = registryItemsRef.current;\n        if (!tmd || !regs) return null;\n        const liq = getLiquidAtPixel(x, y, mapWidth, mapHeight, tileSize, tmd, regs);\n        if (!liq) return null;\n        return toSurfaceType(liq.type);\n      },\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      },\n      onMeteorHit: (data) => {\n        if (typeof onWeatherEffectHit === 'function') {\n          onWeatherEffectHit('meteor', data);\n        }\n      },\n      getViewport: () => ({\n        x: cameraPosRef.current.x,\n        y: cameraPosRef.current.y,\n        width: app.screen?.width || 800,\n        height: app.screen?.height || 600\n      })\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.rain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.snow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.clouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.thunder) || 0));\n    const getFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.fog) || 0));\n    const getLavaRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.lavaRain) || 0));\n    const getRadioactiveFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.radioactiveFog) || 0));\n    const getMeteorRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.meteorRain) || 0));\n\n    // Initialize systems if they don't exist\n    if (!weatherSystemsRef.current.rain) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n    }\n    if (!weatherSystemsRef.current.lavaRain) {\n      weatherSystemsRef.current.lavaRain = new WeatherLavaRain(weatherLayer, api, getLavaRainIntensity);\n    }\n    if (!weatherSystemsRef.current.snow) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n    }\n    if (!weatherSystemsRef.current.meteorRain) {\n      weatherSystemsRef.current.meteorRain = new WeatherMeteorRain(weatherLayer, api, getMeteorRainIntensity);\n    }\n    if (!weatherSystemsRef.current.clouds) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n    }\n    if (!weatherSystemsRef.current.fog) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, getFogIntensity);\n    }\n    if (!weatherSystemsRef.current.radioactiveFog) {\n      weatherSystemsRef.current.radioactiveFog = new WeatherRadioactiveFog(fogLayer, api, getRadioactiveFogIntensity);\n    }\n    if (!weatherSystemsRef.current.thunder) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n    }\n\n    // Return cleanup to destroy all when stage unmounts or map changes\n    return () => {\n      try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.lavaRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n      try { weatherSystemsRef.current.meteorRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n      try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.radioactiveFog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n      weatherSystemsRef.current = { rain: null, lavaRain: null, snow: null, meteorRain: null, clouds: null, thunder: null, fog: null, radioactiveFog: null };\n    };\n  }, [mapWidth, mapHeight, tileSize, isSolidAt, isPixiReady]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%', pointerEvents }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  objectMetadata: PropTypes.object,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  weatherLavaRain: PropTypes.number,\n  weatherRadioactiveFog: PropTypes.number,\n  weatherMeteorRain: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n  roomBlurEnabled: PropTypes.bool,\n  debugOverlayEnabled: PropTypes.bool,\n  renderLayers: PropTypes.arrayOf(PropTypes.string),\n  pointerEvents: PropTypes.string,\n  onWeatherEffectHit: PropTypes.func,\n};\n\nexport default PixiStage;\n","export function updateSeaRescue(ctx, deltaMs) {\n  const {\n    mapData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions,\n    registryItems\n  } = ctx;\n\n  const { gameState, projectilesRef, projectileIdRef, objectMetadata: objMetaRef } = refs;\n  const { TILE_SIZE } = constants;\n  const { isSolidAtPixel, findItemById } = helpers;\n  const { playSfx, onStateUpdate } = actions;\n  \n  const objectMetadata = objMetaRef?.current || mapData.meta?.objectMetadata || {};\n  \n  const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n  const activeMap = mapData.maps ? mapData.maps[activeId] : mapData;\n  if (activeMap.type !== 'sea_rescue') return;\n\n  const keys = input.current;\n  const mousePos = keys.mousePos;\n  const isMouseDown = keys.mouseLeft;\n\n  // We need a way to track the currently dragged box\n  if (!refs.seaRescueRef || refs.seaRescueRef.mapId !== activeId) {\n    refs.seaRescueRef = {\n      mapId: activeId,\n      draggedBox: null, // { index, startX, startY }\n      points: 0,\n      triggeredSeagulls: new Set(),\n      soundState: {\n        isMoving: false,\n        engineSoundTimer: 0\n      }\n    };\n  }\n  const sr = refs.seaRescueRef;\n  if (!sr.triggeredSeagulls) sr.triggeredSeagulls = new Set();\n  if (!sr.soundState) sr.soundState = { isMoving: false, engineSoundTimer: 0 };\n\n  const objectData = ctx.objectData || activeMap.layers?.find(l => l.name === 'objects' || l.name === 'entities' || l.type === 'object')?.data || [];\n  const mapWidth = activeMap.width || mapData.meta?.width || 20;\n\n  // Implement Seagull trigger logic\n  const shipX = gameState.current.x;\n  const shipY = gameState.current.y;\n  const shipDef = findItemById('minispill_sea_rescue_ship');\n  const shipW = (shipDef?.width || 27) * TILE_SIZE;\n  const shipH = (shipDef?.height || 7) * TILE_SIZE;\n\n  // Ship sounds logic\n  const isMoving = Math.abs(gameState.current.vx) > 5 || keys.a || keys.d || keys.ArrowLeft || keys.ArrowRight;\n  const ss = sr.soundState;\n\n  if (isMoving && !ss.isMoving) {\n    const hornSound = shipDef?.sounds?.horn;\n    if (hornSound) {\n      const audio = playSfx(hornSound, 0.6);\n      if (audio && shipDef.horn) {\n        const stopTime = (audio.duration || 2) * 1000 * shipDef.horn;\n        if (audio.duration) {\n          setTimeout(() => { try { audio.pause(); } catch {} }, stopTime);\n        } else {\n          audio.addEventListener('loadedmetadata', () => {\n            setTimeout(() => { try { audio.pause(); } catch {} }, audio.duration * 1000 * shipDef.horn);\n          }, { once: true });\n        }\n      }\n    }\n  }\n\n  if (isMoving) {\n    ss.engineSoundTimer -= deltaMs;\n    if (ss.engineSoundTimer <= 0) {\n      const engineSound = shipDef?.sounds?.engine;\n      if (engineSound) {\n        playSfx(engineSound, 0.35);\n        ss.engineSoundTimer = 1800; // Engine sound interval\n      }\n    }\n  } else {\n    ss.engineSoundTimer = 0;\n  }\n  ss.isMoving = isMoving;\n\n  const shipGridXStart = Math.floor(shipX / TILE_SIZE);\n  const shipGridXEnd = Math.floor((shipX + shipW) / TILE_SIZE);\n  const shipGridYStart = Math.floor(shipY / TILE_SIZE);\n  const shipGridYEnd = Math.floor((shipY + shipH) / TILE_SIZE);\n\n  for (let gy = shipGridYStart; gy <= shipGridYEnd; gy++) {\n    for (let gx = shipGridXStart; gx <= shipGridXEnd; gx++) {\n      if (gx < 0 || gy < 0 || gx >= mapWidth) continue;\n      const idx = gy * mapWidth + gx;\n      const objId = objectData[idx];\n      if (objId === 'minispill_sea_rescue_seagull' && !sr.triggeredSeagulls.has(idx)) {\n        sr.triggeredSeagulls.add(idx);\n        const seagullDef = findItemById(objId);\n        const sound = seagullDef?.sounds?.trigger || \"/assets/sound/sfx/target/seagull-3-34057.ogg\";\n        playSfx(sound, 0.7);\n      }\n    }\n  }\n\n  // World mouse position\n  // Note: We need to account for camera scroll\n  // In updateFrame, camera scroll isn't directly passed, but we can infer it or pass it.\n  // PixiStage uses cameraScrollX/Y.\n  \n  const cameraX = ctx.cameraX || refs.cameraRef?.x || 0;\n  const cameraY = ctx.cameraY || refs.cameraRef?.y || 0;\n  \n  const worldMouseX = refs.mouseWorldPos?.x || (mousePos.x + cameraX);\n  const worldMouseY = refs.mouseWorldPos?.y || (mousePos.y + cameraY);\n\n  // Load physics settings\n  const settings = findItemById('sea_rescue_settings')?.physics || {};\n  const G = settings.gravity || 1600;\n  const POWER = settings.power || 6;\n  const MAX_DRAG = settings.maxDrag || 140;\n\n  if (isMouseDown) {\n    if (!sr.draggedBox) {\n      // Try to find a box under the mouse\n      const gx = Math.floor(worldMouseX / TILE_SIZE);\n      const gy = Math.floor(worldMouseY / TILE_SIZE);\n      let index = gy * mapWidth + gx;\n      let objId = objectData[index];\n      \n      // Ja tie flz nek nav, mekljam lielus objektus (meta data vai root flzes), kas vartu prklt o flzi\n      if (!objId) {\n        // 1. Mekljam metadata (ja tda ir)\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n          const idx = parseInt(idxStr, 10);\n          const w = meta.width || 1;\n          const h = meta.height || 1;\n          if (w <= 1 && h <= 1) continue;\n          \n          const ox = idx % mapWidth;\n          const oy = Math.floor(idx / mapWidth);\n          if (gx >= ox && gx < ox + w && gy >= oy && gy < oy + h) {\n            objId = objectData[idx];\n            index = idx;\n            break;\n          }\n        }\n\n        // 2. Ja joprojm nek nav, mekljam root flzes apkrtn (jo kastes ir 3x2)\n        if (!objId) {\n          for (let dy = 0; dy <= 2; dy++) {\n            for (let dx = 0; dx <= 3; dx++) {\n              const rx = gx - dx;\n              const ry = gy - dy;\n              if (rx < 0 || ry < 0) continue;\n              const rIdx = ry * mapWidth + rx;\n              const rId = objectData[rIdx];\n              if (rId && rId.startsWith('minispill_sea_rescue_box')) {\n                const def = findItemById(rId);\n                const w = def?.width || 3;\n                const h = def?.height || 2;\n                if (gx >= rx && gx < rx + w && gy >= ry && gy < ry + h) {\n                  objId = rId;\n                  index = rIdx;\n                  break;\n                }\n              }\n            }\n            if (objId) break;\n          }\n        }\n      }\n\n      if (objId && objId.startsWith('minispill_sea_rescue_box')) {\n        const def = findItemById(objId);\n        const meta = objectMetadata[index] || {};\n        const w = meta.width || def?.width || 1;\n        const h = meta.height || def?.height || 1;\n        \n        // Calculate object center\n        const ox = index % mapWidth;\n        const oy = Math.floor(index / mapWidth);\n        \n        sr.draggedBox = {\n          index,\n          startX: (ox + w / 2) * TILE_SIZE,\n          startY: (oy + h / 2) * TILE_SIZE,\n          objId\n        };\n      }\n    }\n  } else {\n    if (sr.draggedBox) {\n      // Launch!\n      const { startX, startY, index, objId } = sr.draggedBox;\n      const driftY = refs.driftY || ctx.driftY || 0;\n      const currentStartY = startY + driftY;\n      \n      const dragX = startX - worldMouseX;\n      const dragY = currentStartY - worldMouseY;\n      const dist = Math.sqrt(dragX * dragX + dragY * dragY);\n      const limitedDist = Math.min(dist, MAX_DRAG);\n      const ratio = limitedDist / (dist || 1);\n      \n      const vx = dragX * ratio * POWER;\n      const vy = dragY * ratio * POWER;\n      \n      // Spawn a special projectile that looks like the box\n      const id = projectileIdRef.current++;\n      \n      const def = findItemById(objId);\n      const meta = objectMetadata[index] || {};\n      const w = (meta.width || def?.width || 1) * TILE_SIZE;\n      const h = (meta.height || def?.height || 1) * TILE_SIZE;\n      const frameIndex = meta.frameIndex !== undefined ? meta.frameIndex : (def?.spriteSheet?.frameIndex || 0);\n\n      const proj = {\n        id,\n        ownerId: 'player',\n        x: startX,\n        y: currentStartY,\n        vx,\n        vy,\n        dir: vx >= 0 ? 1 : -1,\n        w: w,\n        h: h,\n        life: 30000,\n        defId: objId,\n        isSeaRescueBox: true,\n        frameIndex: frameIndex,\n        gravity: G, // px/s^2\n        useSimplePhysics: true // Flag for updateProjectiles\n      };\n      \n      projectilesRef.current.push(proj);\n      \n      // Remove box from map via state update (avoid direct modification of read-only objectData)\n      if (typeof onStateUpdate === 'function') {\n        onStateUpdate('collectItem', { index });\n      }\n      \n      sr.draggedBox = null;\n\n      // Effects and Sounds\n      if (typeof playSfx === 'function') {\n        const outSound = def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\";\n        playSfx(outSound, 0.6);\n      }\n      if (refs.fx?.triggerSplash) {\n        refs.fx.triggerSplash(startX, currentStartY);\n      }\n    }\n  }\n}\n\nexport function drawSeaRescueTrajectory(ctx, graphics) {\n  const sr = ctx.refs.seaRescueRef;\n  if (!sr || !sr.draggedBox) return;\n  \n  const { startX, startY } = sr.draggedBox;\n  const driftY = ctx.driftY || 0;\n  const currentStartY = startY + driftY;\n  \n  const { mousePos } = ctx.input.current;\n  const cameraX = ctx.cameraX || ctx.refs?.cameraRef?.x || 0;\n  const cameraY = ctx.cameraY || ctx.refs?.cameraRef?.y || 0;\n  \n  const worldMouseX = ctx.refs?.mouseWorldPos?.x || (mousePos.x + cameraX);\n  const worldMouseY = ctx.refs?.mouseWorldPos?.y || (mousePos.y + cameraY);\n  \n  // Load physics settings\n  const findItemById = ctx.helpers?.findItemById || ((id) => null);\n  const settings = findItemById('sea_rescue_settings')?.physics || {};\n  const G = settings.gravity || 1600;\n  const POWER = settings.power || 6;\n  const MAX_DRAG = settings.maxDrag || 140;\n  const STEPS = settings.trajectorySteps || 35;\n  const DT = settings.dt || 0.06;\n  \n  const dragX = startX - worldMouseX;\n  const dragY = currentStartY - worldMouseY;\n  const dist = Math.sqrt(dragX * dragX + dragY * dragY);\n  const limitedDist = Math.min(dist, MAX_DRAG);\n  const ratio = limitedDist / (dist || 1);\n  \n  const vx = dragX * ratio * POWER;\n  const vy = dragY * ratio * POWER;\n  \n  graphics.clear();\n  graphics.beginFill(0xffffff, 0.8);\n  \n  // Get map bounds to stop trajectory\n  const activeId = ctx.mapData.meta?.activeMapId || ctx.mapData.meta?.activeMap || 'main';\n  const activeMap = ctx.mapData.maps ? ctx.mapData.maps[activeId] : ctx.mapData;\n  const ts = ctx.tileSize || 32;\n  const mapWidthPx = (activeMap.width || 20) * ts;\n  const mapHeightPx = (activeMap.height || 20) * ts;\n\n  for (let i = 1; i <= STEPS; i++) {\n    const t = i * DT;\n    const px = startX + vx * t;\n    const py = currentStartY + vy * t + 0.5 * G * t * t;\n    \n    // Stop if out of bounds\n    if (px < 0 || px > mapWidthPx || py > mapHeightPx) break;\n    \n    // Draw dot\n    graphics.drawCircle(px, py, 3);\n  }\n  graphics.endFill();\n}\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Sea Rescue boxes use a container for 50/50 water effect\n      if (p.isSeaRescueBox) {\n        spr = new Container();\n        spr.isSeaRescueBox = true;\n      }\n\n      const def = getRegItem(registryItems, p.defId);\n      if (def) {\n        if (Array.isArray(def.textures) && def.textures.length > 1) {\n          const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n          if (frames.length > 0) {\n            const anim = new AnimatedSprite(frames);\n            anim.animationSpeed = msToSpeed(def.animationSpeed);\n            anim.play();\n            if (spr instanceof Container) {\n              spr.addChild(anim);\n              spr.mainVisual = anim;\n            } else {\n              spr = anim;\n            }\n          }\n        } else if (def.spriteSheet && def.spriteSheet.enabled) {\n          const totalSprites = def.spriteSheet.totalSprites || 1;\n          const columns = def.spriteSheet.columns || totalSprites;\n          const frameIndex = p.frameIndex !== undefined ? p.frameIndex : (def.spriteSheet.frameIndex || 0);\n          \n          const baseTexture = getTexture(def.texture);\n          const source = baseTexture?.source;\n          if (source && source.width > 1) {\n            const frameWidth = source.width / columns;\n            const frameHeight = source.height / Math.ceil(totalSprites / columns);\n            const col = frameIndex % columns;\n            const row = Math.floor(frameIndex / columns);\n            const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n            const tex = new Texture({ source: source, frame: rect });\n            const s = new Sprite(tex);\n            if (spr instanceof Container) {\n              spr.addChild(s);\n              spr.mainVisual = s;\n            } else {\n              spr = s;\n            }\n          }\n        }\n      }\n      \n      if (!spr || (spr instanceof Container && spr.children.length === 0)) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        const s = new Sprite(tex);\n        if (spr instanceof Container) {\n          spr.addChild(s);\n          spr.mainVisual = s;\n        } else {\n          spr = s;\n        }\n      }\n      \n      if (spr.anchor) {\n        spr.anchor.set(0.5, 0.5);\n      } else if (spr.mainVisual && spr.mainVisual.anchor) {\n        spr.mainVisual.anchor.set(0.5, 0.5);\n      }\n      \n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x;\n    spr.y = p.y;\n    spr.rotation = p.rotation || 0;\n    \n    // Sea Rescue 50/50 Floating effect\n    if (spr.isSeaRescueBox && spr.mainVisual) {\n      if (p.floating) {\n        if (!spr.splitContainer) {\n          spr.mainVisual.visible = false;\n          spr.splitContainer = new Container();\n          spr.addChild(spr.splitContainer);\n          \n          // Full box sprite for above water\n          const topPart = new Sprite(spr.mainVisual.texture);\n          topPart.anchor.set(0.5, 0.5);\n          \n          // Full box sprite for below water (with tint)\n          const bottomPart = new Sprite(spr.mainVisual.texture);\n          bottomPart.anchor.set(0.5, 0.5);\n          bottomPart.tint = 0x4488ff;\n          bottomPart.alpha = 0.8;\n\n          // Masks to cut them horizontally\n          const topMask = new Graphics();\n          const bottomMask = new Graphics();\n          \n          spr.splitContainer.addChild(bottomPart);\n          spr.splitContainer.addChild(topPart);\n          spr.splitContainer.addChild(topMask);\n          spr.splitContainer.addChild(bottomMask);\n          \n          topPart.mask = topMask;\n          bottomPart.mask = bottomMask;\n          \n          spr.topMask = topMask;\n          spr.bottomMask = bottomMask;\n          spr.topPart = topPart;\n          spr.bottomPart = bottomPart;\n        }\n        \n        spr.splitContainer.visible = true;\n        \n        // Update masks to stay horizontal regardless of container rotation\n        // We want the water line to be at the container's center (spr.y)\n        // Since masks are children of spr, they move/rotate with spr.\n        // To keep them horizontal, we must counter-rotate them and adjust their shape.\n        \n        const baseY = p.baseY !== undefined ? p.baseY : p.y;\n        const dy = baseY - p.y; // World vertical offset from center to water line\n        const rotation = spr.rotation || 0;\n        const pWidth = Number(p.w) || tileSize;\n        const pHeight = Number(p.h) || tileSize;\n        const maskW = pWidth * 2; // Extra wide to cover during rotation\n        const maskH = Math.max(pHeight * 2, Math.abs(dy) + pHeight);\n        \n        if (!isNaN(pWidth) && !isNaN(pHeight)) {\n          // Calculate local coordinates for the water surface point (0, dy) in world space\n          // mx = dy * sin(rotation), my = dy * cos(rotation)\n          const mx = dy * Math.sin(rotation);\n          const my = dy * Math.cos(rotation);\n\n          spr.topMask.clear();\n          spr.topMask.rect(-maskW/2, -maskH, maskW, maskH);\n          spr.topMask.fill({ color: 0xffffff, alpha: 1 });\n          spr.topMask.position.set(mx, my);\n          spr.topMask.rotation = -rotation;\n          \n          spr.bottomMask.clear();\n          spr.bottomMask.rect(-maskW/2, 0, maskW, maskH);\n          spr.bottomMask.fill({ color: 0xffffff, alpha: 1 });\n          spr.bottomMask.position.set(mx, my);\n          spr.bottomMask.rotation = -rotation;\n        }\n\n        // Keep parts synced with main visual in case of animation\n        if (spr.mainVisual instanceof AnimatedSprite) {\n          spr.topPart.texture = spr.mainVisual.texture;\n          spr.bottomPart.texture = spr.mainVisual.texture;\n        }\n      } else {\n        if (spr.splitContainer) spr.splitContainer.visible = false;\n        spr.mainVisual.visible = true;\n      }\n    }\n    \n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = (p.dir === undefined || p.dir >= 0) ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","import { Sprite, Texture, Rectangle } from 'pixi.js';\nimport { getTexture } from './helpers';\n\n/**\n * Sinhroniz un atjaunina kustgo enttiju (piem. tanku) spraitus.\n * @param {Container} entitiesLayer PixiJS konteiners enttijm\n * @param {Map} entitySpritesMap Map, kur glabjas esoie spraiti (pc ID)\n * @param {Array} entitiesList Enttiju saraksts no dzinja\n * @param {Array} registryItems Reistra elementi\n * @param {number} tileSize Flzes izmrs pikseos\n */\nexport const syncEntities = (entitiesLayer, entitySpritesMap, entitiesList, registryItems, tileSize) => {\n  if (!entitiesLayer) return;\n\n  const seen = new Set();\n  const list = entitiesList || [];\n\n  for (const ent of list) {\n    const key = ent.id;\n    seen.add(key);\n\n    let spr = entitySpritesMap.get(key);\n    const def = ent.def || {};\n\n    if (!spr) {\n      // Izveidojam jaunu spraitu ar baltu tekstru k aizvietotju, kamr ldjas st\n      spr = new Sprite(Texture.WHITE);\n      spr.anchor.set(0, 0);\n      entitiesLayer.addChild(spr);\n      entitySpritesMap.set(key, spr);\n      spr._lastFrameIndex = -1;\n    }\n\n    // Atjaunojam tekstru no spritesheet, ja nepiecieams\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    const isTextureReady = source && source.width > 1;\n\n    if (def.spriteSheet && def.spriteSheet.enabled && isTextureReady) {\n      const columns = def.spriteSheet.columns || 1;\n      const frameIndex = ent.currentSpriteIndex !== undefined ? ent.currentSpriteIndex : 0;\n      \n      if (spr._lastFrameIndex !== frameIndex) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const totalSprites = def.spriteSheet.totalSprites || 1;\n\n        // Ja kolonnu skaits JSON ir nepareizs vai trkst, minm to aprint\n        let effectiveColumns = columns;\n        if (!effectiveColumns || effectiveColumns <= 0) {\n            effectiveColumns = Math.floor(texWidth / (def.spriteSheet.frameWidth || 32)) || 1;\n        }\n\n        const frameWidth = texWidth / effectiveColumns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / effectiveColumns);\n        \n        const col = frameIndex % effectiveColumns;\n        const row = Math.floor(frameIndex / effectiveColumns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        try {\n            spr.texture = new Texture({\n              source: source,\n              frame: rect\n            });\n            spr._lastFrameIndex = frameIndex;\n        } catch (e) {\n            console.warn(`Failed to create texture for entity ${key} frame ${frameIndex}`, e);\n            spr.texture = baseTexture;\n        }\n      }\n    } else if (isTextureReady) {\n      if (spr.texture !== baseTexture) {\n        spr.texture = baseTexture;\n        spr._lastFrameIndex = -1;\n      }\n    } else if (def.editorIcon) {\n        // Ja nav tekstras, bet ir ikona (piemram, bultia, kaut gan ts te nevajadztu bt k enttijai)\n        if (spr.texture !== Texture.WHITE) spr.texture = Texture.WHITE;\n    }\n\n    // Pozcija un izmrs\n    const targetWidth = ent.width || tileSize;\n    const targetHeight = ent.height || tileSize;\n    \n    spr.width = targetWidth;\n    spr.height = targetHeight;\n    \n    // Nodroinm, ka scale nav 0 vai NaN (ja tekstra bija dvaina skum)\n    if (!spr.scale.x || isNaN(spr.scale.x)) spr.scale.x = 1;\n    if (!spr.scale.y || isNaN(spr.scale.y)) spr.scale.y = 1;\n\n    // Virziens (flipping)\n    const direction = ent.direction !== undefined ? ent.direction : 1;\n    const flipY = !!ent.flipY;\n    const alpha = Number.isFinite(ent.alpha) ? ent.alpha : 1;\n    \n    // Ja ir definta rotcija (piem. akmeiem), izmantojam centru k enkuru\n    if (ent.rotation !== undefined) {\n        spr.anchor.set(0.5, 0.5);\n        spr.x = ent.x + targetWidth / 2;\n        spr.y = ent.y + targetHeight / 2;\n        spr.rotation = ent.rotation;\n        spr.alpha = alpha;\n        \n        // Flipping ar centru enkuru\n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n    } else {\n        // Standarta enkurs (augjais kreisais stris)\n        spr.anchor.set(0, 0);\n        spr.rotation = 0;\n        spr.alpha = alpha;\n        \n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n        \n        // Pozicionana emot vr flipping pie enkura (0,0)\n        spr.x = ent.x + (direction < 0 ? targetWidth : 0);\n        spr.y = ent.y + (flipY ? targetHeight : 0);\n    }\n  }\n\n  // Noemam spraitus enttijm, kas vairs neeksist\n  for (const [key, spr] of entitySpritesMap.entries()) {\n    if (!seen.has(key)) {\n      if (spr.parent) spr.parent.removeChild(spr);\n      spr.destroy({ children: true, texture: false }); // Tekstras koplietoanas d ts neizncinm\n      entitySpritesMap.delete(key);\n    }\n  }\n};\n\n/**\n * Attra visus enttiju spraitus.\n */\nexport const cleanupEntities = (entitySpritesMap) => {\n  for (const spr of entitySpritesMap.values()) {\n    if (spr.parent) spr.parent.removeChild(spr);\n    spr.destroy({ children: true, texture: false });\n  }\n  entitySpritesMap.clear();\n};\n","// Item collection extracted from useGameEngine.js\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata: mainMetadata, secretMapData, activeMapId } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  // --- ROOM OVERLAY LOGIC ---\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && mainMetadata) {\n    if (!gameState.current.collectedItems) {\n      gameState.current.collectedItems = new Set();\n    }\n\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          // Inside a room!\n          const localX = centerX - rx;\n          const localY = centerY - ry;\n          const rWidth = roomMap.mapWidth || roomMap.width || 20;\n          const rgX = Math.floor(localX / TILE_SIZE);\n          const rgY = Math.floor(localY / TILE_SIZE);\n          const rIndex = rgY * rWidth + rgX;\n          \n          const itemKey = `${meta.linkedMapId}:${rIndex}`;\n          if (gameState.current.collectedItems.has(itemKey)) return;\n\n          const rObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          if (rObjectData && rObjectData[rIndex]) {\n            // Call collectItem recursively or just handle it here\n            const rItemId = rObjectData[rIndex];\n            const rItemDef = getDefById(registryItems, rItemId);\n            \n            if (rItemDef && rItemDef.pickup && !rItemId.includes('player')) {\n               if (rItemDef.name && rItemDef.name.startsWith('interactable.')) return;\n\n               // Pick it up\n               let pickedUp = false;\n               if (rItemDef.effect && rItemDef.effect.health) {\n                 const healthBonus = parseInt(rItemDef.effect.health, 10);\n                 if (gameState.current.health < MAX_HEALTH) {\n                   gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n                   pickedUp = true;\n                 }\n               } else if (rItemDef.effect && rItemDef.effect.fireball) {\n                 const ammoBonus = parseInt(rItemDef.effect.fireball, 10) || 0;\n                 gameState.current.ammo = (gameState.current.ammo || 0) + ammoBonus;\n                 pickedUp = true;\n               }\n\n               if (pickedUp) {\n                 gameState.current.collectedItems.add(itemKey);\n                 try {\n                   playShotSfx(rItemDef?.sfx, Math.max(0, Math.min(1, rItemDef?.sfxVolume ?? 1)));\n                 } catch {}\n                 if (onStateUpdate) {\n                   onStateUpdate('collectItem', { index: rIndex, mapId: meta.linkedMapId });\n                 }\n                 return;\n               }\n            }\n          }\n          // If we are in a room, we don't pick up items from the main map below\n          return;\n        }\n      }\n    }\n  }\n  // --- END ROOM OVERLAY LOGIC ---\n\n  if (!gameState.current.collectedItems) {\n    gameState.current.collectedItems = new Set();\n  }\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const mapKey = activeMapId || 'main';\n  const itemKey = `${mapKey}:${index}`;\n  if (gameState.current.collectedItems.has(itemKey)) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = getDefById(registryItems, itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n}\n","export function resolveInteractableContext({\n  mapData,\n  mapWidth,\n  mapHeight,\n  objectLayerData,\n  mainObjectMetadata,\n  secretMapData,\n  activeRoomIds: activeRoomIdsProp,\n  centerX,\n  centerY,\n  TILE_SIZE\n}) {\n  const hasMainMetadata = mainObjectMetadata && Object.keys(mainObjectMetadata).length > 0;\n  let activeTargetMap = mapData;\n  let activeObjectData = objectLayerData;\n  let activeMetadata = hasMainMetadata\n    ? mainObjectMetadata\n    : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n  let activeMapWidth = mapWidth;\n  let activeMapHeight = mapHeight;\n  let offsetX = 0;\n  let offsetY = 0;\n  let currentMapId = mapData?.id || 'main';\n\n  const projectMaps = mapData?.maps || mapData?.projectMaps || {};\n  const activeRoomIds = activeRoomIdsProp || mapData?.meta?.activeRoomIds || [];\n\n  if (activeRoomIds.length > 0) {\n    const mainMetadata = hasMainMetadata\n      ? mainObjectMetadata\n      : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = projectMaps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          activeTargetMap = roomMap;\n          activeMapWidth = roomMap.mapWidth || roomMap.width || 20;\n          activeMapHeight = roomMap.mapHeight || roomMap.height || 15;\n          activeObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          activeMetadata = roomMap.objectMetadata || {};\n          offsetX = rx;\n          offsetY = ry;\n          currentMapId = meta.linkedMapId;\n          break;\n        }\n      }\n    }\n  }\n\n  return {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps,\n    activeRoomIds\n  };\n}\n\nexport default { resolveInteractableContext };\n","/**\n * Finds spawn position in a map by trigger ID or player start\n */\nexport function findSpawnPosition(map, triggerId, tileSize) {\n  if (!map) return null;\n\n  const mapW = map.width || map.mapWidth || map.meta?.width || 20;\n  const metadata = map.objectMetadata || map.meta?.objectMetadata || {};\n\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data;\n\n  if (!objData) return null;\n\n  let spawnIdx = -1;\n\n  const triggerRequested = triggerId !== undefined && triggerId !== null && triggerId !== '';\n  if (triggerRequested) {\n    for (let i = 0; i < objData.length; i++) {\n      if (!objData[i]) continue;\n      if (metadata[i] && metadata[i].triggerId === triggerId) {\n        spawnIdx = i;\n        break;\n      }\n    }\n  }\n\n  if (spawnIdx === -1 && !triggerRequested) {\n    spawnIdx = objData.findIndex(id => id && id.includes('player'));\n  }\n\n  if (spawnIdx !== -1) {\n    return {\n      x: (spawnIdx % mapW) * tileSize,\n      y: Math.floor(spawnIdx / mapW) * tileSize\n    };\n  }\n\n  return null;\n}\n\nexport default { findSpawnPosition };\n","import { findSpawnPosition } from './spawn';\n\nconst resolveMapObjects = (map) => {\n  if (!map) return { mapW: 20, objData: [], metadata: {} };\n  const mapW = map.mapWidth || map.width || map.meta?.width || 20;\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data || [];\n  const metadata = map.objectMetadata || map.meta?.objectMetadata || {};\n  return { mapW, objData, metadata };\n};\n\nconst findExitDoorSpawn = ({ map, targetRoomId, roomMeta, tileSize }) => {\n  const { mapW, objData, metadata } = resolveMapObjects(map);\n  if (!Array.isArray(objData) || objData.length === 0) return null;\n\n  const matchIds = [];\n  if (roomMeta?.spawnTriggerId !== undefined && roomMeta?.spawnTriggerId !== null && roomMeta?.spawnTriggerId !== '') {\n    matchIds.push(roomMeta.spawnTriggerId);\n  }\n  if (roomMeta?.triggerId !== undefined && roomMeta?.triggerId !== null && roomMeta?.triggerId !== '') {\n    if (!matchIds.includes(roomMeta.triggerId)) {\n      matchIds.push(roomMeta.triggerId);\n    }\n  }\n  let candidateIdx = -1;\n  let matchedIdx = -1;\n\n  for (let i = 0; i < objData.length; i++) {\n    const id = objData[i];\n    if (!id || !String(id).includes('door')) continue;\n    const meta = metadata[i];\n    if (!meta || meta.targetMapId !== targetRoomId) continue;\n    if (candidateIdx === -1) candidateIdx = i;\n    if (matchIds.length) {\n      if (matchIds.some(id => meta.spawnTriggerId === id || meta.triggerId === id)) {\n        matchedIdx = i;\n        break;\n      }\n    }\n  }\n\n  const doorIdx = matchedIdx !== -1 ? matchedIdx : candidateIdx;\n  if (doorIdx === -1) return null;\n  return {\n    index: doorIdx,\n    x: (doorIdx % mapW) * tileSize,\n    y: Math.floor(doorIdx / mapW) * tileSize,\n    meta: metadata[doorIdx] || {}\n  };\n};\n\nexport function handleDoorInteraction({\n  objDef,\n  currentMeta,\n  actualIndex,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  mapData,\n  mapWidth,\n  TILE_SIZE,\n  activeTargetMap,\n  projectMaps\n}) {\n  if (!objDef || objDef.subtype !== 'door') return false;\n  if (!keys?.e) return true;\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 600) return true;\n  gameState.current.lastETime = now;\n\n  const sound = currentMeta?.sound || objDef.interaction?.sound;\n  if (sound) {\n    try { playShotSfx(sound, objDef.sfxVolume || 0.5); } catch {}\n  }\n\n  if (onStateUpdate) {\n    onStateUpdate('setObjectFrame', {\n      index: actualIndex,\n      frame: objDef.interaction?.frames?.opening || 1,\n      mapId: activeTargetMap === mapData ? null : activeTargetMap.id\n    });\n  }\n\n  const delayS = currentMeta?.delaySeconds !== undefined ? currentMeta.delaySeconds : (objDef.interaction?.delaySeconds || 0.5);\n  const targetMapId = currentMeta?.targetMapId;\n\n  if (onStateUpdate && targetMapId) {\n    setTimeout(() => {\n      const targetMap = projectMaps[targetMapId];\n      const isRoom = targetMap && targetMap.type === 'room';\n      const isExitingRoom = !isRoom && activeTargetMap !== mapData && targetMapId === 'main';\n\n      if (isRoom || isExitingRoom) {\n        let newX = gameState.current.x;\n        let newY = gameState.current.y;\n        let exitTriggerId = currentMeta?.spawnTriggerId;\n        if (exitTriggerId === undefined || exitTriggerId === null || exitTriggerId === '') {\n          exitTriggerId = currentMeta?.triggerId;\n        }\n\n        if (isRoom) {\n          const roomAreaMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {};\n          const roomAreaEntry = Object.entries(roomAreaMeta)\n            .find(([, m]) => m.linkedMapId === targetMapId);\n          let rx = 0;\n          let ry = 0;\n          if (roomAreaEntry) {\n            const raIdx = parseInt(roomAreaEntry[0], 10);\n            rx = (raIdx % mapWidth) * TILE_SIZE;\n            ry = Math.floor(raIdx / mapWidth) * TILE_SIZE;\n          }\n          const spawn = findSpawnPosition(targetMap, currentMeta.spawnTriggerId, TILE_SIZE);\n          if (spawn) {\n            newX = rx + spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n            newY = ry + spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n          }\n        } else {\n          const roomAreaMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {};\n          const roomAreaEntry = Object.entries(roomAreaMeta)\n            .find(([, m]) => m.linkedMapId === activeTargetMap.id);\n          if (roomAreaEntry) {\n            let spawnFound = false;\n            if (exitTriggerId !== undefined && exitTriggerId !== null && exitTriggerId !== '') {\n              const spawn = findSpawnPosition(mapData, exitTriggerId, TILE_SIZE);\n              if (spawn) {\n                newX = spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n                newY = spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n                spawnFound = true;\n              }\n            }\n            if (!spawnFound) {\n              const fallback = findExitDoorSpawn({\n                map: mapData,\n                targetRoomId: activeTargetMap.id,\n                roomMeta: currentMeta,\n                tileSize: TILE_SIZE\n              });\n              if (fallback) {\n                newX = fallback.x + (TILE_SIZE - gameState.current.width) / 2;\n                newY = fallback.y + (TILE_SIZE - gameState.current.height) / 2;\n                spawnFound = true;\n                if (exitTriggerId === undefined || exitTriggerId === null || exitTriggerId === '') {\n                  if (fallback.meta?.triggerId !== undefined) {\n                    exitTriggerId = fallback.meta.triggerId;\n                  } else if (fallback.meta?.spawnTriggerId !== undefined) {\n                    exitTriggerId = fallback.meta.spawnTriggerId;\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        gameState.current.x = newX;\n        gameState.current.y = newY;\n        gameState.current.vx = 0;\n        gameState.current.vy = 0;\n        const triggerId = isExitingRoom ? exitTriggerId : currentMeta.spawnTriggerId;\n        onStateUpdate('switchMap', { targetMapId, triggerId });\n      } else {\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      }\n    }, delayS * 1000);\n  }\n\n  return true;\n}\n\nexport default { handleDoorInteraction };\n","export function handleTeleportInteraction({\n  objId,\n  objDef,\n  currentMeta,\n  actualIndex,\n  activeObjectData,\n  activeMetadata,\n  activeMapWidth,\n  offsetX,\n  offsetY,\n  projectMaps,\n  onStateUpdate,\n  playShotSfx,\n  gameState,\n  TILE_SIZE\n}) {\n  if (!objId || !objId.includes('portal')) return false;\n  if (!currentMeta || currentMeta.triggerId === undefined || currentMeta.triggerId === null) return true;\n\n  const targetMapId = currentMeta.targetMapId;\n  if (targetMapId && projectMaps && projectMaps[targetMapId]) {\n    if (onStateUpdate) {\n      onStateUpdate('switchMap', {\n        targetMapId,\n        triggerId: currentMeta.triggerId\n      });\n      try {\n        const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n        playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n      } catch {}\n    }\n    return true;\n  }\n\n  for (let i = 0; i < (activeObjectData?.length || 0); i++) {\n    if (i === actualIndex) continue;\n    const destId = activeObjectData[i];\n    if (destId && (destId.includes('target') || destId === 'portal_target')) {\n      const destMeta = activeMetadata?.[i];\n      if (destMeta && destMeta.triggerId === currentMeta.triggerId) {\n        const tx = offsetX + (i % activeMapWidth) * TILE_SIZE;\n        const ty = offsetY + Math.floor(i / activeMapWidth) * TILE_SIZE;\n\n        gameState.current.x = tx;\n        gameState.current.y = ty;\n\n        try {\n          const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n          playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n        } catch {}\n        return true;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport default { handleTeleportInteraction };\n","export function applyInteractableEffects({\n  objDef,\n  actualIndex,\n  currentMapId,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  MAX_HEALTH\n}) {\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return false;\n  if (!objDef.effect) return true;\n\n  const interactableKey = currentMapId === 'main' ? `${actualIndex}` : `${currentMapId}:${actualIndex}`;\n  if (gameState.current.usedInteractables.has(interactableKey)) return true;\n\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return true;\n\n    gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  return true;\n}\n\nexport default { applyInteractableEffects };\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = getDefById(registryItems, startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n  const revealedSet = (revealedSecrets instanceof Set)\n    ? revealedSecrets\n    : new Set(revealedSecrets || []);\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSet.has(idx)) continue;\n\n      const def = getDefById(registryItems, secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSet.has(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","import i18n from './i18n';\nimport enMessages from './translations/en/tutorial_messages.json';\nimport lvMessages from './translations/lv/tutorial_messages.json';\nimport noMessages from './translations/no/tutorial_messages.json';\nimport ruMessages from './translations/ru/tutorial_messages.json';\nimport jaMessages from './translations/ja/tutorial_messages.json';\n\nconst MESSAGES = {\n  en: enMessages,\n  lv: lvMessages,\n  no: noMessages,\n  ru: ruMessages,\n  ja: jaMessages\n};\n\nconst getLang = (lang) => {\n  const raw = lang || i18n?.language || 'en';\n  const base = raw.includes('-') ? raw.split('-')[0] : raw;\n  return MESSAGES[base] ? base : 'en';\n};\n\nexport const getTutorialChapters = (lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  return Array.from(new Set([...Object.keys(fallback), ...Object.keys(data)])).sort();\n};\n\nexport const getTutorialItems = (chapter, lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  const chapterData = (data[chapter] && Object.keys(data[chapter]).length)\n    ? data[chapter]\n    : (fallback[chapter] || {});\n  return Object.keys(chapterData)\n    .sort((a, b) => Number(a) - Number(b))\n    .map((id) => ({ id, text: chapterData[id] }));\n};\n\nexport const getTutorialText = (chapter, id, lang) => {\n  if (!chapter || id === undefined || id === null) return '';\n  const l = getLang(lang);\n  const data = MESSAGES[l] || MESSAGES.en || {};\n  const fallback = (MESSAGES.en || {})[chapter]?.[String(id)] || '';\n  return data[chapter]?.[String(id)] || fallback;\n};\n\nexport default {\n  getTutorialChapters,\n  getTutorialItems,\n  getTutorialText\n};\n","// Secret-related trigger handlers (weather, messages)\nimport { getTutorialText } from '../../../i18n/tutorialMessages';\n\nexport function handleWeatherTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx\n}) {\n  if (!objDef || objDef.type !== 'weather_trigger') return false;\n\n  const weatherType = objDef.weatherType; // rain, snow, clouds, fog, thunder\n  const action = objDef.weatherAction; // on, off, set\n  let value = 0;\n\n  if (action === 'set' || action === 'on') {\n    value = currentMeta?.intensity !== undefined ? currentMeta.intensity : (action === 'on' ? 100 : 50);\n  } else if (action === 'off') {\n    value = 0;\n  }\n\n  if (!gameState.current.lastWeatherTrigger) {\n    gameState.current.lastWeatherTrigger = {};\n  }\n\n  const lastVal = gameState.current.lastWeatherTrigger[index];\n  if (lastVal !== value) {\n    if (onStateUpdate) {\n      onStateUpdate('updateWeather', { type: weatherType, value });\n    }\n    gameState.current.lastWeatherTrigger[index] = value;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport function handleMessageTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  keys\n}) {\n  if (!objDef || objDef.type !== 'message_trigger') return false;\n\n  const requiresActionKey = !!(objDef.requiresActionKey || objDef.interaction?.requiresKey);\n  if (requiresActionKey && !keys?.e) {\n    return false;\n  }\n\n  const i18nChapter = currentMeta?.i18nChapter;\n  const i18nId = currentMeta?.i18nId;\n  const message = (currentMeta?.message && String(currentMeta.message).trim())\n    ? currentMeta.message\n    : (i18nChapter && i18nId ? getTutorialText(i18nChapter, i18nId) : null);\n  if (!message) return true;\n\n  if (!gameState.current.lastMessageTrigger) {\n    gameState.current.lastMessageTrigger = {};\n  }\n\n  const lastMsg = gameState.current.lastMessageTrigger[index];\n  if (lastMsg !== message) {\n    if (onStateUpdate) {\n      onStateUpdate('showMessage', { text: message, duration: 8000 });\n    }\n    gameState.current.lastMessageTrigger[index] = message;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport default { handleWeatherTrigger, handleMessageTrigger };\n","// Wolfenstein-style secret triggers and movement handling\n\nexport function triggerWolfSecret({\n  objDef,\n  index,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  playerCenterX,\n  playerCenterY,\n  objCenterX,\n  objCenterY,\n  playerGridX,\n  playerGridY,\n  objGridX,\n  objGridY\n}) {\n  if (!objDef || objDef.type !== 'wolf_secret') return false;\n  if (!keys?.e) return true;\n\n  const moveX = objDef.moveX || 0;\n  const moveY = objDef.moveY || 0;\n  if (moveX !== 0 || moveY !== 0) {\n    const hasGrid = Number.isFinite(playerGridX) && Number.isFinite(playerGridY) && Number.isFinite(objGridX) && Number.isFinite(objGridY);\n    if (hasGrid) {\n      if (moveX < 0 && !(playerGridX > objGridX)) return true;\n      if (moveX > 0 && !(playerGridX < objGridX)) return true;\n      if (moveY < 0) {\n        if (!keys?.w) return true;\n        if (!(playerGridY > objGridY)) return true;\n      }\n      if (moveY > 0) {\n        if (!keys?.s) return true;\n        if (!(playerGridY < objGridY)) return true;\n      }\n    } else {\n      const eps = 0.01;\n      if (moveX < 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX > objCenterX + eps)) return true;\n      }\n      if (moveX > 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX < objCenterX - eps)) return true;\n      }\n      if (moveY < 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.w) return true;\n        if (!(playerCenterY > objCenterY + eps)) return true;\n      }\n      if (moveY > 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.s) return true;\n        if (!(playerCenterY < objCenterY - eps)) return true;\n      }\n    }\n  }\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 1000) return true;\n  gameState.current.lastETime = now;\n\n  if (onStateUpdate) {\n    const dx = moveX;\n    const dy = moveY;\n    onStateUpdate('shiftTile', { index, dx, dy });\n\n    if (objDef.sfx) {\n      try { playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5); } catch {}\n    }\n  }\n  return true;\n}\n\nexport function applyWolfSecretShift({\n  index,\n  dx,\n  dy,\n  mapWidth,\n  mapHeight,\n  getObjectId,\n  getObjectDef,\n  moveTile,\n  moveObject,\n  moveMetadata,\n  removeObject,\n  stepDelayMs = 250,\n  setTimeoutFn = setTimeout,\n  shouldCancel\n}) {\n  let currentIdx = index;\n  let remainingDx = dx;\n  let remainingDy = dy;\n  const originId = getObjectId(currentIdx);\n  if (!originId) return;\n\n  const moveStep = () => {\n    if (shouldCancel && shouldCancel()) return;\n    const currentId = getObjectId(currentIdx);\n    if (!currentId || currentId !== originId) return;\n    if (remainingDx === 0 && remainingDy === 0) {\n      if (removeObject) removeObject(currentIdx);\n      return;\n    }\n\n    const stepX = remainingDx > 0 ? 1 : (remainingDx < 0 ? -1 : 0);\n    const stepY = remainingDy > 0 ? 1 : (remainingDy < 0 ? -1 : 0);\n\n    const tx = (currentIdx % mapWidth) + stepX;\n    const ty = Math.floor(currentIdx / mapWidth) + stepY;\n\n    if (tx >= 0 && tx < mapWidth && ty >= 0 && ty < mapHeight) {\n      const targetIndex = ty * mapWidth + tx;\n\n      const isLastStepOfBatch = (Math.abs(remainingDx) === 1 && remainingDy === 0) ||\n        (Math.abs(remainingDy) === 1 && remainingDx === 0);\n      if (isLastStepOfBatch) {\n        const targetObjId = getObjectId(targetIndex);\n        const targetDef = getObjectDef(targetObjId);\n        if (targetDef && targetDef.type === 'wolf_secret') {\n          const extraX = Math.abs(targetDef.moveX || 3);\n          const extraY = Math.abs(targetDef.moveY || 3);\n          if (remainingDx !== 0) remainingDx += (remainingDx > 0 ? extraX : -extraX);\n          if (remainingDy !== 0) remainingDy += (remainingDy > 0 ? extraY : -extraY);\n        }\n      }\n\n      if (moveTile) moveTile(currentIdx, targetIndex);\n      if (moveObject) moveObject(currentIdx, targetIndex);\n      if (moveMetadata) moveMetadata(currentIdx, targetIndex);\n\n      currentIdx = targetIndex;\n      remainingDx -= stepX;\n      remainingDy -= stepY;\n\n      if (remainingDx !== 0 || remainingDy !== 0) {\n        setTimeoutFn(moveStep, stepDelayMs);\n      } else {\n        if (removeObject) removeObject(currentIdx);\n      }\n    } else {\n      if (removeObject) removeObject(currentIdx);\n    }\n  };\n\n  moveStep();\n}\n\nexport default { triggerWolfSecret, applyWolfSecretShift };\n","// Helpers for crack_block secret behavior\n\nexport function shouldRemoveCrackBlock(def, newHealth) {\n  if (!def || def.type !== 'crack_block') return false;\n  const threshold = def.passableHealthThreshold || 0;\n  return newHealth <= threshold;\n}\n\nexport default { shouldRemoveCrackBlock };\n","import { resolveInteractableContext } from './context';\nimport { handleDoorInteraction } from './doors';\nimport { handleTeleportInteraction } from './teleport';\nimport { applyInteractableEffects } from './effects';\nimport { handleWeatherTrigger, handleMessageTrigger, triggerWolfSecret } from '../secrets';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, mapHeight, objectLayerData) {\n  const {\n    registryItems,\n    TILE_SIZE,\n    MAX_HEALTH,\n    playShotSfx,\n    onStateUpdate,\n    gameState,\n    mapData,\n    activeRoomIds: activeRoomIdsProp,\n    objectMetadata: mainObjectMetadata,\n    secretMapData\n  } = ctx;\n  if (!objectLayerData) return;\n\n  const keys = ctx.input?.current || {};\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps\n  } = resolveInteractableContext({\n    mapData,\n    mapWidth,\n    mapHeight,\n    objectLayerData,\n    mainObjectMetadata,\n    secretMapData,\n    activeRoomIds: activeRoomIdsProp,\n    centerX,\n    centerY,\n    TILE_SIZE\n  });\n\n  const localX = centerX - offsetX;\n  const localY = centerY - offsetY;\n\n  const gridX = Math.floor(localX / TILE_SIZE);\n  const gridY = Math.floor(localY / TILE_SIZE);\n  let index = gridY * activeMapWidth + gridX;\n\n  if (keys.e) {\n    let targetIndex = null;\n\n    if (keys.w) {\n        const upIndex = (gridY - 1) * activeMapWidth + gridX;\n        if (gridY - 1 >= 0) {\n          const upObjId = activeObjectData?.[upIndex];\n          const upDef = getDefById(registryItems, upObjId);\n          if (upDef && upDef.type === 'wolf_secret') {\n            targetIndex = upIndex;\n          }\n        }\n      }\n\n    if (targetIndex === null && keys.s) {\n      const downIndex = (gridY + 1) * activeMapWidth + gridX;\n      const limitHeight = activeMapHeight || mapHeight || 0;\n      if (gridY + 1 < limitHeight) {\n        const downObjId = activeObjectData?.[downIndex];\n        const downDef = getDefById(registryItems, downObjId);\n        if (downDef && downDef.type === 'wolf_secret') {\n          targetIndex = downIndex;\n        }\n      }\n    }\n\n    if (targetIndex === null) {\n      const dir = keys.d ? 1 : (keys.a ? -1 : (gameState.current.direction || 1));\n      const frontX = localX + dir * (TILE_SIZE * 0.8);\n      const frontGridX = Math.floor(frontX / TILE_SIZE);\n      const frontIndex = gridY * activeMapWidth + frontGridX;\n\n      if (frontIndex >= 0 && frontIndex < (activeObjectData?.length || 0)) {\n        const frontObjId = activeObjectData[frontIndex];\n        if (frontObjId) {\n          const frontDef = getDefById(registryItems, frontObjId);\n          if (frontDef && (\n            frontDef.type === 'wolf_secret' ||\n            frontDef.subtype === 'door' ||\n            frontDef.name?.startsWith('interactable.') ||\n            (frontDef.type === 'message_trigger' && (frontDef.requiresActionKey || frontDef.interaction?.requiresKey))\n          )) {\n            targetIndex = frontIndex;\n          }\n        }\n      }\n    }\n\n    if (targetIndex !== null) {\n      index = targetIndex;\n    }\n  }\n\n  let foundIndex = -1;\n  const directObjId = activeObjectData ? activeObjectData[index] : null;\n  if (directObjId) {\n    foundIndex = index;\n  } else if (activeMetadata) {\n    for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      const w = meta.width || 1;\n      const h = meta.height || 1;\n      if (w > 1 || h > 1) {\n        const ox = idx % activeMapWidth;\n        const oy = Math.floor(idx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          if (activeObjectData && activeObjectData[idx]) {\n            foundIndex = idx;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (foundIndex === -1) return;\n  const actualIndex = foundIndex;\n\n  let currentMeta = activeMetadata?.[actualIndex];\n  if (!currentMeta && mapData) {\n    const fromMap = mapData?.maps?.[currentMapId]?.objectMetadata;\n    const fromMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata;\n    currentMeta = (fromMap && fromMap[actualIndex]) || (fromMeta && fromMeta[actualIndex]) || currentMeta;\n  }\n  const objId = activeObjectData[actualIndex];\n  if (!objId) return;\n\n  const objDef = getDefById(registryItems, objId);\n  if (!objDef) return;\n\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (handleWeatherTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx })) return;\n  if (handleMessageTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx, keys })) return;\n  if (triggerWolfSecret({\n    objDef,\n    index: actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    playerCenterX: localX,\n    playerCenterY: localY,\n    objCenterX: ((actualIndex % activeMapWidth) + 0.5) * TILE_SIZE,\n    objCenterY: (Math.floor(actualIndex / activeMapWidth) + 0.5) * TILE_SIZE,\n    playerGridX: gridX,\n    playerGridY: gridY,\n    objGridX: actualIndex % activeMapWidth,\n    objGridY: Math.floor(actualIndex / activeMapWidth)\n  })) return;\n\n  if (handleDoorInteraction({\n    objDef,\n    currentMeta,\n    actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    mapData,\n    mapWidth,\n    TILE_SIZE,\n    activeTargetMap,\n    projectMaps\n  })) return;\n\n  if (handleTeleportInteraction({\n    objId,\n    objDef,\n    currentMeta,\n    actualIndex,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    offsetX,\n    offsetY,\n    projectMaps,\n    onStateUpdate,\n    playShotSfx,\n    gameState,\n    TILE_SIZE\n  })) return;\n\n  if (objDef.subtype === 'end' && !gameState.current.isWinning) {\n    gameState.current.isWinning = true;\n    gameState.current.winCounter = 0;\n    gameState.current.winCountSpeed = objDef.winCountSpeed || 10;\n    return;\n  }\n\n  applyInteractableEffects({\n    objDef,\n    actualIndex,\n    currentMapId,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    MAX_HEALTH\n  });\n}\n\nexport default { checkInteractables };\n","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor(playerRight / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor(playerBottom / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = getDefById(registryItems, objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight >= tileLeft && playerLeft <= tileRight;\n      const overlapsVertically = playerBottom >= tileTop && playerTop <= tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const overlapTop = playerBottom - tileTop;\n        const overlapBottom = tileBottom - playerTop;\n        const overlapLeft = playerRight - tileLeft;\n        const overlapRight = tileRight - playerLeft;\n        const min = Math.min(overlapTop, overlapBottom, overlapLeft, overlapRight);\n        touchingTop = (min === overlapTop);\n        touchingBottom = (!touchingTop && min === overlapBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === overlapLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","import meteorBreakEffectsConfig from '../../assets/json/system/meteor_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst clamp01 = (v) => Math.max(0, Math.min(1, v));\n\nconst getConfig = () => {\n  if (!meteorBreakEffectsConfig || meteorBreakEffectsConfig.enabled === false) return null;\n  return meteorBreakEffectsConfig;\n};\n\nconst lerp = (a, b, t) => a + (b - a) * t;\n\nconst scaleFromRange = (range, fallback, t) => {\n  if (!Array.isArray(range) || range.length < 2) return fallback;\n  const a = Number(range[0]);\n  const b = Number(range[1]);\n  if (!Number.isFinite(a) || !Number.isFinite(b)) return fallback;\n  return lerp(a, b, t);\n};\n\nconst readNumber = (value, fallback) => {\n  const n = Number(value);\n  return Number.isFinite(n) ? n : fallback;\n};\n\nexport const getMeteorBreakEffectConfig = ({ size, surfaceType }) => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n\n  const defaults = cfg.defaults || {};\n  const sizeScale = cfg.sizeScale || {};\n  const minSize = readNumber(sizeScale.min, 4);\n  const maxSize = readNumber(sizeScale.max, 12);\n  const denom = Math.max(1, maxSize - minSize);\n  const t = clamp01((readNumber(size, minSize) - minSize) / denom);\n\n  let count = scaleFromRange(sizeScale.count, defaults.count, t);\n  let speed = scaleFromRange(sizeScale.speed, defaults.speed, t);\n  let lifeMs = scaleFromRange(sizeScale.lifeMs, defaults.lifeMs, t);\n  let particleSize = scaleFromRange(sizeScale.size, defaults.size, t);\n  let gravity = readNumber(defaults.gravity, 0.02);\n  let shape = defaults.shape || 'square';\n  let angleRange = Array.isArray(defaults.angleRange) ? defaults.angleRange : null;\n\n  const surfaces = cfg.surfaces || {};\n  const surface = surfaceType && surfaces[surfaceType] ? surfaces[surfaceType] : surfaces.ground;\n  if (surface) {\n    count = readNumber(surface.count, count);\n    speed = readNumber(surface.speed, speed);\n    lifeMs = readNumber(surface.lifeMs, lifeMs);\n    particleSize = readNumber(surface.size, particleSize);\n    gravity = readNumber(surface.gravity, gravity);\n    shape = surface.shape || shape;\n    angleRange = Array.isArray(surface.angleRange) ? surface.angleRange : angleRange;\n  }\n\n  const colorsRaw = (surface && Array.isArray(surface.colors)) ? surface.colors : defaults.colors;\n  const colors = Array.isArray(colorsRaw) && colorsRaw.length ? colorsRaw.map(normalizeColor) : [0xffffff];\n\n  return {\n    count: readNumber(count, 12),\n    speed: readNumber(speed, 2.4),\n    lifeMs: readNumber(lifeMs, 700),\n    size: readNumber(particleSize, 3),\n    colors,\n    gravity,\n    shape,\n    angleRange\n  };\n};\n\nexport default {\n  getMeteorBreakEffectConfig\n};\n","import biologicalBreakEffectsConfig from '../../assets/json/system/biological_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!biologicalBreakEffectsConfig || biologicalBreakEffectsConfig.enabled === false) return null;\n  return biologicalBreakEffectsConfig;\n};\n\nexport const getBiologicalBreakEffectConfig = () => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const base = cfg.default || {};\n  const chunks = cfg.chunks && typeof cfg.chunks === 'object' ? cfg.chunks : null;\n  const colors = Array.isArray(base.colors) && base.colors.length ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 18,\n    speed: Number(base.speed) || 2.4,\n    lifeMs: Number(base.lifeMs) || 700,\n    size: Number(base.size) || 2,\n    gravity: Number.isFinite(Number(base.gravity)) ? Number(base.gravity) : 0.02,\n    shape: base.shape || 'circle',\n    angleRange: Array.isArray(base.angleRange) ? base.angleRange : null,\n    colors,\n    chunks: chunks || null\n  };\n};\n\nexport default {\n  getBiologicalBreakEffectConfig\n};\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef, isInsideRoom } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    \n    let vol = Math.max(0, Math.min(1, volume ?? 1));\n    let muffled = !!isInsideRoom;\n\n    if (muffled) {\n        vol *= 0.5; // Reduce volume if inside\n    }\n\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        \n        // If we wanted a filter for SFX, we'd need to set up Web Audio context for each sound,\n        // which might be heavy for many sounds. Let's stick to volume reduction for simplicity \n        // unless Web Audio context is already available and passed in.\n\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return audio;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol, muffled);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol, muffled = false) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    \n    // Lowpass filter if muffled\n    let lastNode = osc;\n    if (muffled) {\n        const filter = audioCtx.createBiquadFilter();\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(600, now);\n        osc.connect(filter);\n        lastNode = filter;\n    }\n\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(muffled ? 260 : 520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    \n    lastNode.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  friction = 0.8,\n  acceleration = 0.2,\n  deltaMs = 16.67\n}) {\n  let { x, vx, width, direction, y, height } = state;\n  \n  const timeScale = deltaMs / 16.67;\n  const targetVx = keys?.a ? -MOVE_SPEED : (keys?.d ? MOVE_SPEED : 0);\n  \n  if (targetVx !== 0) {\n    // Accelerate\n    vx += targetVx * acceleration * timeScale;\n    if (Math.abs(vx) > MOVE_SPEED) vx = Math.sign(vx) * MOVE_SPEED;\n    direction = Math.sign(targetVx);\n  } else {\n    // Apply friction (time-scaled)\n    const effectiveFriction = Math.pow(friction, timeScale);\n    vx *= effectiveFriction;\n    if (Math.abs(vx) < 0.1) vx = 0;\n  }\n\n  const proposedX = x + vx * timeScale;\n  const py = y ?? 0;\n  if (checkCollision(proposedX, py, mapWidth, mapHeight, width, height)) {\n    // Precza apstans pie ra\n    const step = 0.05;\n    const sign = Math.sign(vx);\n    let safeX = x;\n    const moveDist = Math.abs(vx * timeScale);\n    \n    for (let d = step; d <= moveDist; d += step) {\n      const nextX = x + d * sign;\n      if (!checkCollision(nextX, py, mapWidth, mapHeight, width, height)) {\n        safeX = nextX;\n      } else {\n        break;\n      }\n    }\n    x = safeX;\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  // Sanitize coordinates to avoid sub-pixel noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  x = Math.round(x * 1000) / 1000;\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isLiquidAt(wx, wy): optional helper to detect liquid type at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isLiquidAt,\n  prevInWater,\n  deltaMs = 16.67\n}) {\n  const timeScale = deltaMs / 16.67;\n  \n  // Liquid defaults\n  let liqBuoyancy = 0.5; // reduces effective gravity by 50%\n  let liqDragY = 0.88;  // vertical damping per frame when in liquid\n  let liqTerminal = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n  let swimImpulseMult = 0.55;\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  let activeLiquidType = null;\n\n  if (typeof isLiquidAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    \n    const feetLiq = isLiquidAt(cx, feetY);\n    const chestLiq = isLiquidAt(cx, chestY);\n    const headLiq = isLiquidAt(cx, headY);\n    \n    activeLiquidType = feetLiq || chestLiq;\n    inWater = !!activeLiquidType;\n    headUnderWater = !!headLiq;\n    atSurface = inWater && !headUnderWater;\n\n    // Apply per-liquid physics overrides\n    if (activeLiquidType === 'quicksand') {\n      liqBuoyancy = -0.15; // Negative buoyancy makes player sink!\n      liqDragY = 0.85;     // Higher drag\n      liqTerminal = 1.2;   // Very slow terminal velocity for sinking\n      swimImpulseMult = 0.35; // Harder to jump/swim\n    } else if (activeLiquidType === 'lava') {\n      liqBuoyancy = 0.3;\n      liqDragY = 0.82;\n    } else if (activeLiquidType === 'waterfall') {\n      liqBuoyancy = -0.5; // Acts like extra gravity\n      liqDragY = 0.95;     // Very low resistance\n      liqTerminal = TERMINAL_VELOCITY * 1.5; // Allow falling faster than usual terminal velocity\n    } else if (activeLiquidType === 'lava_waterfall') {\n      liqBuoyancy = -0.4; // Slightly more viscous than water\n      liqDragY = 0.92;\n      liqTerminal = TERMINAL_VELOCITY * 1.3;\n    } else if (activeLiquidType === 'radioactive_waterfall') {\n      liqBuoyancy = -0.2; // Slower fall than normal waterfall\n      liqDragY = 0.94;\n      liqTerminal = TERMINAL_VELOCITY * 0.7; // Slower speed\n    } else if (activeLiquidType === 'radioactive_water') {\n      liqBuoyancy = 0.45; // Slightly less buoyant than water\n      liqDragY = 0.86;\n    }\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * swimImpulseMult));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5 * timeScale; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - liqBuoyancy) * timeScale;\n    vy *= Math.pow(liqDragY, timeScale);\n    if (vy > liqTerminal) vy = liqTerminal;\n  } else {\n    vy += GRAVITY * timeScale;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  const proposedY = y + vy * timeScale;\n  if (checkCollision(x, proposedY, mapWidth, mapHeight, width, height)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      // Snapping to the pixel above the tile - use a small offset consistent with collision inset\n      y = Math.floor((proposedY + height - 0.1) / TILE_SIZE) * TILE_SIZE - height;\n      \n      if (Math.abs(vx || 0) > 0.1) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((proposedY + 0.1) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y = proposedY;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  // Sanitize coordinates to prevent floating point noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  y = Math.round(y * 1000) / 1000;\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Collision helpers (migrated from GameEngine/collision.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile or an object)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve definitions\n// - secretData: secret layer array (ids)\n// - objectData: object layer array (ids)\n// - objectMetadata: metadata for objects (e.g. health)\n// - entities: array of active entities (optional)\n// - ignoreEntityId: ID of the entity to ignore in check (optional)\n// - maps: all project maps (optional, for room overlays)\n// - activeRoomIds: IDs of currently active/open rooms (optional)\n// - isRoom: boolean, whether we are checking collision for a room sub-map\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds, isRoom = false) {\n  try {\n    const gx = Math.floor(wx / TILE_SIZE);\n    const gy = Math.floor(wy / TILE_SIZE);\n\n    // Boundary check\n    if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n        // Rooms have strict boundaries. Main map allows falling off the bottom.\n        // checkCollision handles top/left/right boundaries for main map.\n        return isRoom; \n    }\n\n    // Allow movement above the map (already handled by gx,gy check usually, but just in case)\n    if (wy < 0) return false;\n\n    // 0. Check for active rooms (sub-maps) - Priority check\n    if (!isRoom && maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n      let insideAnyRoom = false;\n      \n      for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n        const idx = parseInt(idxStr);\n        if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n          const roomMap = maps[meta.linkedMapId];\n          if (!roomMap) continue;\n\n          const rx = (idx % mapWidthTiles) * TILE_SIZE;\n          const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n          const rw = (meta.width || 1) * TILE_SIZE;\n          const rh = (meta.height || 1) * TILE_SIZE;\n\n          // Boundary check with pixel precision\n          // Pievienojam nelielu pielaidi (0.2px) apak, lai snapping loika vertical.js \n          // (kas izmanto y + height - 0.1) nepalaistu garm istabas grdu.\n          if (wx >= rx && wx < rx + rw && wy >= ry && wy < ry + rh + 0.2) {\n            insideAnyRoom = true;\n            \n            const localWx = wx - rx;\n            const localWy = wy - ry;\n            \n            const roomTileW = roomMap.mapWidth || roomMap.width;\n            const roomTileH = roomMap.mapHeight || roomMap.height;\n            \n            const roomTiles = roomMap.tileMapData || roomMap.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data;\n            const roomObjects = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            const roomSecrets = roomMap.secretMapData || roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data;\n\n            const solidInRoom = isSolidAtPixel(\n              localWx, localWy, \n              roomTileW, roomTileH, TILE_SIZE, \n              roomTiles, \n              registryItems, \n              roomSecrets, \n              roomObjects, \n              roomMap.objectMetadata, \n              null, \n              ignoreEntityId,\n              null,\n              null,\n              true // WE ARE IN A ROOM\n            );\n\n            if (solidInRoom) return true;\n            \n            // If the room map has NO content at this spot, it's a window/open area.\n            // The recursive call with isRoom=true already blocked the boundaries of the room map.\n            return false;\n          }\n        }\n      }\n      \n      if (!insideAnyRoom) {\n        // Izmums: aujam atrasties uz durvm, kas ir atvrtas, pat ja ts ir rpus room_area.\n        // Tas ir nepiecieams, lai spltjs neiestrgtu teleportcijas brd, izejot no istabas.\n        const index = gy * mapWidthTiles + gx;\n        const objId = objectData && objectData[index];\n        if (objId) {\n        const objDef = getDefById(registryItems, objId);\n          if (objDef && objDef.subtype === 'door') {\n            const meta = (objectMetadata && objectMetadata[index]) || {};\n            let frame = meta.currentFrame;\n            if (frame === undefined) frame = 0;\n            \n            const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n            if (frame !== closedFrame) {\n              return false; // Durvis ir atvrtas, aujam te atrasties\n            }\n          }\n        }\n        return true; \n      }\n    }\n\n    const index = gy * mapWidthTiles + gx;\n    \n    // 0. Check entities first (dynamic obstacles)\n    if (entities) {\n      for (const ent of entities) {\n        if (ent.id === ignoreEntityId) continue;\n        if (ent.health <= 0 || ent.isExploding) continue;\n        // Platforms are stand-on-able but not usually \"solid\" for other entities' horizontal physics\n        if (ent.subtype === 'platform') continue;\n        // Fish should not block movement (player or other entities)\n        if (ent.subtype === 'fish' || ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish) continue;\n\n        if (wx >= ent.x && wx < ent.x + ent.width && wy >= ent.y && wy < ent.y + ent.height) {\n          return true;\n        }\n      }\n    }\n\n    // Check if this tile has a secret - secrets make tiles passable\n    if (secretData && secretData[index]) {\n      return false;\n    }\n\n    // 1. Check objects layer first (like the wooden box)\n    if (objectData && objectData[index]) {\n      const objId = objectData[index];\n      const objDef = getDefById(registryItems, objId);\n      \n      const isEntity = objDef && (\n        objDef.type === 'entity' || \n        objDef.subtype === 'tank' || \n        objDef.subtype === 'platform' ||\n        objDef.subtype === 'pushable' ||\n        objDef.isPushable ||\n        (objDef.name && objDef.name.toLowerCase().includes('entities.'))\n      );\n\n      if (objDef && objDef.collision && !isEntity) {\n        // Durvju specil loika: atvrtas/lietotas durvis nav cietas\n        if (objDef.subtype === 'door') {\n          const meta = (objectMetadata && objectMetadata[index]) || {};\n          let frame = meta.currentFrame;\n          \n          if (frame === undefined) {\n              // Default frame for rooms is 'inside' (open)\n              if (isRoom) {\n                  frame = objDef.interaction?.frames?.inside ?? 0;\n              } else {\n                  frame = 0; // Default for main map is closed\n              }\n          }\n\n          const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n          \n          // Ja durvis nav aizvrtas (ir atvrans fz vai atvrtas), ts nav cietas\n          if (frame !== closedFrame) {\n            return false;\n          }\n        }\n\n        // Special logic for destructible objects like the wooden box\n        if (objDef.isDestructible && objectMetadata && objectMetadata[index]) {\n          const health = objectMetadata[index].health !== undefined ? objectMetadata[index].health : objDef.maxHealth;\n          const threshold = objDef.passableHealthThreshold || 0;\n          if (health <= threshold) {\n            return false; // Box is broken, can pass through\n          }\n        }\n        return true;\n      }\n    }\n\n    // 2. Check tiles layer\n    const tileId = tileData[index];\n    if (!tileId) return false;\n    const tileDef = getDefById(registryItems, tileId);\n    if (!tileDef || !tileDef.collision) return false;\n    if (tileDef.collision === true) return true;\n    if (typeof tileDef.collision === 'object') {\n      return !!(\n        tileDef.collision.top ||\n        tileDef.collision.bottom ||\n        tileDef.collision.left ||\n        tileDef.collision.right\n      );\n    }\n    return false;\n  } catch (error) {\n    console.error('Error in isSolidAtPixel:', error);\n    return false;\n  }\n}\n\n// AABB collision check for player rectangle at (newX, newY)\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds) {\n  // Insets and epsilon values to prevent \"sticking\" and ensure stable grounding.\n  // inset: distance from corners for edge-mid points to avoid catching perpendicular walls.\n  // eps: small offset from the actual edge to ensure we stay within the intended tile/boundary.\n  const inset = 1.0; \n  const eps = 0.1;\n  \n  const points = [\n    // Vertical checks (Top/Bottom)\n    { x: newX + inset, y: newY + eps }, \n    { x: newX + width - inset, y: newY + eps },\n    { x: newX + width / 2, y: newY + eps },\n    \n    { x: newX + inset, y: newY + height - eps },\n    { x: newX + width - inset, y: newY + height - eps },\n    { x: newX + width / 2, y: newY + height - eps },\n\n    // Horizontal checks (Left/Right)\n    { x: newX + eps, y: newY + inset },\n    { x: newX + eps, y: newY + height - inset },\n    { x: newX + eps, y: newY + height / 2 },\n\n    { x: newX + width - eps, y: newY + inset },\n    { x: newX + width - eps, y: newY + height - inset },\n    { x: newX + width - eps, y: newY + height / 2 }\n  ];\n\n  for (let p of points) {\n    const gx = Math.floor(p.x / TILE_SIZE);\n    const gy = Math.floor(p.y / TILE_SIZE);\n    \n    // Boundary checks: block left, right, and top edges of the world.\n    // Allow falling off the bottom (gy >= mapHeightTiles).\n    if (gx < 0 || gx >= mapWidthTiles || gy < 0) return true;\n\n    if (isSolidAtPixel(p.x, p.y, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Gets physical properties of the surface below the player (friction, acceleration)\n */\nexport function getSurfaceProperties(x, y, width, height, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectMetadata, maps, activeRoomIds) {\n  const cx = x + width / 2;\n  const feetY = y + height + 1; // 1 pixel below feet\n\n  // Check for active rooms (sub-maps) - Priority check\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n    for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidthTiles) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (cx >= rx && cx < rx + rw && feetY >= ry && feetY < ry + rh + 2) {\n          // Point is inside an active room!\n          const localCx = cx - rx;\n          const localFeetY = feetY - ry;\n          \n          const roomTileW = roomMap.mapWidth || roomMap.width;\n          const roomTileH = roomMap.mapHeight || roomMap.height;\n          \n          return getSurfaceProperties(\n            localCx - width/2, localFeetY - height - 1, width, height,\n            roomTileW, roomTileH, TILE_SIZE,\n            roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data),\n            registryItems,\n            roomMap.secretMapData,\n            roomMap.objectMetadata,\n            null,\n            null\n          );\n        }\n      }\n    }\n  }\n\n  const gx = Math.floor(cx / TILE_SIZE);\n  const gy = Math.floor(feetY / TILE_SIZE);\n  \n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n    return { friction: 0.8, acceleration: 0.2 };\n  }\n  \n  const index = gy * mapWidthTiles + gx;\n  const tileId = tileData ? tileData[index] : null;\n  if (!tileId) return { friction: 0.8, acceleration: 0.2 };\n  \n    const tileDef = getDefById(registryItems, tileId);\n  if (!tileDef) return { friction: 0.8, acceleration: 0.2 };\n  \n  // If block has slipperiness, use it. Default friction is 0.8.\n  const slipperiness = tileDef.slipperiness !== undefined ? tileDef.slipperiness : 0.8;\n  \n  return {\n    friction: slipperiness,\n    // When slippery, acceleration is lower (harder to start/change direction)\n    acceleration: tileDef.slipperiness !== undefined ? (1 - slipperiness) * 2 + 0.05 : 0.2\n  };\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n  getSurfaceProperties\n};\n","import weatherDamageConfig from '../../assets/json/system/weather_damage.json';\n\nconst clampIntensity = (v) => {\n  const n = Number(v) || 0;\n  return Math.max(0, Math.min(100, n));\n};\n\nconst getWeatherConfig = (type) => {\n  return weatherDamageConfig?.weather?.[type] || null;\n};\n\nexport const getMapWeather = (mapData) => {\n  if (!mapData) return {};\n  let base = {};\n  if (mapData.weather) base = mapData.weather;\n  else {\n    const metaWeather = mapData.meta?.weather;\n    if (metaWeather && Object.keys(metaWeather).length > 0) {\n      base = metaWeather;\n    } else {\n      const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap;\n      if (activeId && mapData.maps && mapData.maps[activeId] && mapData.maps[activeId].weather) {\n        base = mapData.maps[activeId].weather;\n      } else {\n        base = mapData.meta?.weather || {};\n      }\n    }\n  }\n  let runtime = {};\n  try {\n    const rt = window.__GAME_RUNTIME_SETTINGS__ || {};\n    runtime = {\n      rain: rt.weatherRain,\n      snow: rt.weatherSnow,\n      clouds: rt.weatherClouds,\n      fog: rt.weatherFog,\n      thunder: rt.weatherThunder,\n      lavaRain: rt.weatherLavaRain,\n      radioactiveFog: rt.weatherRadioactiveFog,\n      meteorRain: rt.weatherMeteorRain\n    };\n  } catch {}\n  const merged = { ...base };\n  Object.keys(runtime).forEach(key => {\n    if (runtime[key] !== undefined && runtime[key] !== null) {\n      merged[key] = runtime[key];\n    }\n  });\n  return merged;\n};\n\nexport const getWeatherDps = (type, intensity) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return 0;\n  const pct = clampIntensity(intensity);\n  if (pct <= 0) return 0;\n  const maxDps = Number(cfg.maxDps) || 0;\n  const minDps = Number(cfg.minDps) || 0;\n  const dps = (pct / 100) * maxDps;\n  return Math.max(minDps, dps);\n};\n\nexport const getRadioactivityRates = () => {\n  const cfg = getWeatherConfig('radioactiveFog') || {};\n  const inc = Number(cfg.radioactivityPerSecond);\n  const dec = Number(cfg.radioactivityRegenPerSecond);\n  return {\n    increase: Number.isFinite(inc) ? inc : 0,\n    decay: Number.isFinite(dec) ? dec : 0\n  };\n};\n\nexport const weatherAffectsPlayer = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  return !!cfg.affects?.player;\n};\n\nexport const weatherAffectsEnemy = (type, enemyId, enemyName) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  const enemies = cfg.affects?.enemies;\n  if (enemies === 'true') return true;\n  if (enemies === true || enemies === 'all') return true;\n  if (enemies && typeof enemies === 'object' && enemies.mode === 'all') {\n    const excluded = Array.isArray(enemies.exclude) ? enemies.exclude : [];\n    const isExcluded = (value) => value && excluded.some(ex => value === ex || value.includes(ex));\n    if (isExcluded(enemyId)) return false;\n    if (isExcluded(enemyName)) return false;\n    return true;\n  }\n  if (Array.isArray(enemies)) {\n    if (enemyId && enemies.some(ex => enemyId === ex || enemyId.includes(ex))) return true;\n    if (enemyName && enemies.some(ex => enemyName === ex || enemyName.includes(ex))) return true;\n    return false;\n  }\n  return false;\n};\n\nexport const weatherBlockedByCover = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg) return false;\n  return !!cfg.blockedByCover;\n};\n","import { isSolidAtPixel } from '../physics/collision';\n\nconst isInsideActiveRoom = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  secretData,\n  objectMetadata,\n  activeRoomIds\n}) => {\n  if (!activeRoomIds || !activeRoomIds.length) return false;\n  if (!secretData || !objectMetadata) return false;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false;\n  for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n    const idx = parseInt(idxStr, 10);\n    if (secretData[idx] !== 'room_area') continue;\n    if (!meta?.linkedMapId || !activeRoomIds.includes(meta.linkedMapId)) continue;\n    const rx = idx % mapWidth;\n    const ry = Math.floor(idx / mapWidth);\n    const rw = meta.width || 1;\n    const rh = meta.height || 1;\n    if (gx >= rx && gx < rx + rw && gy >= ry && gy < ry + rh) return true;\n  }\n  return false;\n};\n\nexport const isCoveredFromAbove = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  tileData,\n  registryItems,\n  secretData,\n  objectData,\n  objectMetadata,\n  maps,\n  activeRoomIds\n}) => {\n  if (!Number.isFinite(x) || !Number.isFinite(y)) return false;\n  if (isInsideActiveRoom({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectMetadata, activeRoomIds })) {\n    return true;\n  }\n  const gridX = Math.floor(x / TILE_SIZE);\n  if (gridX < 0 || gridX >= mapWidth) return false;\n  let gridY = Math.floor(y / TILE_SIZE) - 1;\n  for (; gridY >= 0; gridY--) {\n    const wx = gridX * TILE_SIZE + TILE_SIZE / 2;\n    const wy = gridY * TILE_SIZE + TILE_SIZE / 2;\n    if (isSolidAtPixel(wx, wy, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, null, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n};\n","import { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { isSolidAtPixel } from '../physics';\nimport { getWeatherDps, getMapWeather, weatherAffectsEnemy, weatherBlockedByCover } from './weatherDamage';\nimport { isCoveredFromAbove } from './weatherCover';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nconst getTileLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.tileMapData)) return mapData.tileMapData;\n  const layer = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile');\n  return layer?.data || [];\n};\n\nconst getSecretLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.secretMapData)) return mapData.secretMapData;\n  const layer = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret');\n  return layer?.data || [];\n};\n\nconst liquidTypeToHabitat = (liquidType) => {\n  if (!liquidType) return 'none';\n  if (liquidType.includes('radioactive')) return 'radioactive';\n  if (liquidType.includes('lava')) return 'lava';\n  if (liquidType.includes('quicksand')) return 'quicksand';\n  if (liquidType.includes('water')) return 'water';\n  return 'none';\n};\n\nconst isFishEntity = (ent) => {\n  if (!ent) return false;\n  const def = ent.def || {};\n  return ent.subtype === 'fish' || def.subtype === 'fish' || def.ai?.type === 'fish' || !!def.fish;\n};\n\nconst getFishTriggerAt = ({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectData, registryItems }) => {\n  if (!registryItems) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return null;\n  const idx = gy * mapWidth + gx;\n  const secretId = secretData ? secretData[idx] : null;\n  const objectId = objectData ? objectData[idx] : null;\n  const def = getDefById(registryItems, secretId) || getDefById(registryItems, objectId);\n  if (!def) return null;\n  if (def.type === 'secret' && def.subtype === 'animal_trigger' && def.triggerType === 'fish') return def;\n  return null;\n};\n\nconst getWaterSurfaceY = ({ x, mapWidth, mapHeight, tileData, registryItems, TILE_SIZE }) => {\n  if (!tileData || mapWidth <= 0 || mapHeight <= 0) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  if (gx < 0 || gx >= mapWidth) return null;\n  for (let gy = 0; gy < mapHeight; gy++) {\n    const idx = gy * mapWidth + gx;\n    const id = tileData[idx];\n    if (!id) continue;\n    const def = getDefById(registryItems, id);\n    if (!def || !def.flags || !def.flags.liquid) continue;\n    if (def.flags.water || def.flags.waterfall) {\n      return gy * TILE_SIZE;\n    }\n  }\n  return null;\n};\n\n/**\n * Atjaunina visas aktvs enttijas (piemram, tankus).\n * @param {Object} ctx Konteksts ar nepiecieamajiem datiem un funkcijm\n * @param {number} deltaMs Laiks kop pdj kadra\n */\nexport function updateEntities(ctx, deltaMs) {\n  const {\n    entitiesRef,\n    gameState,\n    mapWidth,\n    mapHeight,\n    TILE_SIZE,\n    checkCollision,\n    isLiquidAt,\n    getLiquidSample,\n    spawnProjectile,\n    playSfx,\n    constants,\n    objectData,\n    mapData,\n    registryItems,\n    onStateUpdate,\n    activeRoomIds\n  } = ctx;\n\n  if (!entitiesRef.current || entitiesRef.current.length === 0) return;\n\n  const { GRAVITY, TERMINAL_VELOCITY } = constants;\n  const playerX = gameState.current.x;\n  const playerY = gameState.current.y;\n  const weatherNow = getMapWeather(mapData);\n  const lavaRainInt = Number(weatherNow.lavaRain || 0);\n  const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n\n  // Ms modificjam enttijas pa tieo ref\n  const entities = entitiesRef.current;\n  const activeMapId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n  const activeMap = mapData.maps ? mapData.maps[activeMapId] : mapData;\n  const isSeaRescue = activeMap?.type === 'sea_rescue';\n\n  for (let i = entities.length - 1; i >= 0; i--) {\n    const entity = entities[i];\n    const def = entity.def || {};\n    const isFish = def?.subtype === 'fish' || def?.ai?.type === 'fish' || !!def?.fish;\n    // 1. Ja enttija ir mirusi, apstrdjam sprdzienu vai noemanu\n    if (entity.health <= 0 && !isFish) {\n      if (!entity.isExploding) {\n        entity.isExploding = true;\n        entity.animation = 'explode';\n        entity.animFrame = 0;\n        entity.animTimer = 0;\n        entity.vx = 0; // Apstjamies sprdziena laik\n        entity.vy = 0;\n        entity.isGrounded = true; // Sprgst uz zemes\n      }\n      \n      const explodeAnim = def.spriteSheet?.animations?.explode || [];\n      const totalFrames = explodeAnim.length;\n      const frameDuration = 100; // ms uz kadru\n      \n      entity.animTimer += deltaMs;\n      if (entity.animTimer >= frameDuration) {\n        entity.animTimer = 0;\n        entity.animFrame++;\n        if (entity.animFrame >= totalFrames) {\n          entity.shouldRemove = true;\n        }\n      }\n      if (entity.shouldRemove) {\n        entities.splice(i, 1);\n      }\n      continue;\n    }\n\n    // 1.2. Liquid damage (e.g. lava, radioactive water)\n    const liquidSample = getLiquidSample ? getLiquidSample({\n      x: entity.x,\n      y: entity.y,\n      width: entity.width,\n      height: entity.height,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight\n    }) : { inLiquid: false };\n\n    if (isFish) {\n      const { projectilesRef } = ctx;\n      const cfg = def.fish || {};\n      const activeRadiusPx = (Number(cfg.activeRadius) || 18) * TILE_SIZE;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      \n      // 0. Attached to projectile logic (Sea Rescue)\n      if (entity.attachedToProjectileId) {\n          const projectiles = projectilesRef?.current || [];\n          const target = projectiles.find(p => p.id === entity.attachedToProjectileId);\n          if (target && !target.floating) {\n              entity.x = target.x - entity.width / 2;\n              entity.y = target.y - entity.height / 2;\n              entity.vx = target.vx;\n              entity.vy = target.vy;\n              entity.animation = 'panic';\n              entity.fishState = entity.fishState || {};\n              entity.fishState.isAttached = true;\n              \n              const anims = def.spriteSheet?.animations || {};\n              const currentAnim = anims['panic'] || anims['swim'] || [0];\n              entity.currentSpriteIndex = currentAnim[Math.floor(Date.now() / 100) % currentAnim.length];\n              continue;\n          } else {\n              if (target) {\n                  entity.fishState = entity.fishState || {};\n                  entity.fishState.isJumping = true;\n                  entity.fishState.jumpVx = -target.vx * 0.5;\n                  entity.fishState.jumpVy = -500;\n                  entity.fishState.jumpGravity = 800;\n              }\n              entity.attachedToProjectileId = null;\n              if (entity.fishState) entity.fishState.isAttached = false;\n          }\n      }\n\n      const dxView = (playerX + gameState.current.width / 2) - ex;\n      const dyView = (playerY + gameState.current.height / 2) - ey;\n      const distView = Math.sqrt(dxView * dxView + dyView * dyView);\n      const isActive = distView <= activeRadiusPx || isSeaRescue;\n\n      if (!isActive && entity.health > 0) {\n        entity.isDormant = true;\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.animation = 'idle';\n        const idleAnim = def.spriteSheet?.animations?.idle || [0];\n        entity.currentSpriteIndex = idleAnim[0] || 0;\n        continue;\n      }\n      entity.isDormant = false;\n    }\n\n    if (liquidSample.inLiquid && liquidSample.params && liquidSample.params.dps > 0) {\n      entity.liquidDamageAcc = (entity.liquidDamageAcc || 0) + deltaMs;\n      while (entity.liquidDamageAcc >= 1000) {\n        entity.liquidDamageAcc -= 1000;\n        const dmg = liquidSample.params.dps;\n        entity.health = Math.max(0, entity.health - dmg);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: dmg\n          });\n        }\n      }\n    } else {\n      entity.liquidDamageAcc = 0;\n    }\n\n    // 1.3. Weather damage (Lava Rain, Radioactive Fog)\n    const enemyId = entity.defId || def?.id;\n    const enemyName = def?.name;\n    let lavaDps = weatherAffectsEnemy('lavaRain', enemyId, enemyName) ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    if (lavaDps > 0 && liquidSample.inLiquid && liquidSample.type && liquidSample.type.includes('water')) {\n      lavaDps = 0;\n    }\n    const radioDps = weatherAffectsEnemy('radioactiveFog', enemyId, enemyName) ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data || [];\n        const secretData = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n        const objectMetadata = mapData.meta?.objectMetadata || {};\n        const covered = isCoveredFromAbove({\n          x: entity.x + entity.width / 2,\n          y: entity.y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIds || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const totalWeatherDps = lavaDps + radioDps;\n\n    if (totalWeatherDps > 0) {\n      entity.weatherDamageAcc = (entity.weatherDamageAcc || 0) + deltaMs;\n      if (entity.weatherDamageAcc >= 1000) {\n        entity.weatherDamageAcc -= 1000;\n        entity.health = Math.max(0, entity.health - totalWeatherDps);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: totalWeatherDps\n          });\n        }\n      }\n    } else {\n      entity.weatherDamageAcc = 0;\n    }\n\n    if (isFish) {\n      const cfg = def.fish || {};\n      const habitat = cfg.habitat || {};\n      const now = Number(gameState.current.timeMs) || 0;\n      const dt = Math.max(0, Number(deltaMs) || 0) / 1000;\n      const liquidType = liquidSample?.type || null;\n      const habitatKey = liquidTypeToHabitat(liquidType);\n      const isAllowed = !!(liquidSample?.inLiquid && habitatKey && habitat[habitatKey] !== false);\n      const requireLiquid = cfg.requireLiquid !== false;\n      const inWaterNow = !!(liquidSample?.inLiquid && habitatKey === 'water');\n\n      entity.fishState = entity.fishState || {};\n      const fs = entity.fishState;\n\n      if (!fs.initialized) {\n        fs.initialized = true;\n        entity.direction = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.animFrame = 0;\n        fs.animTimer = 0;\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health > 0) {\n        const prevInWater = !!fs.prevInWater;\n        if (prevInWater && !inWaterNow && def.sounds?.water_out) {\n          playSfx(def.sounds.water_out, 0.35);\n        } else if (!prevInWater && inWaterNow && def.sounds?.water_in) {\n          playSfx(def.sounds.water_in, 0.35);\n        }\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health <= 0) {\n        const player = gameState.current;\n        const hit = (\n          player.x < entity.x + entity.width &&\n          player.x + player.width > entity.x &&\n          player.y < entity.y + entity.height &&\n          player.y + player.height > entity.y\n        );\n        if (hit) {\n          gameState.current.fishCount = Math.max(0, (Number(gameState.current.fishCount) || 0) + 1);\n          entities.splice(i, 1);\n          continue;\n        }\n        if (entity.fishState?.removeOnNext) {\n          entities.splice(i, 1);\n          continue;\n        }\n        const tileData = getTileLayerData(mapData);\n        const secretData = getSecretLayerData(mapData);\n        const objectMetadata = mapData?.meta?.objectMetadata;\n        const cx = entity.x + entity.width / 2;\n        const headY = entity.y + Math.min(4, entity.height * 0.125);\n        const chestY = entity.y + entity.height * 0.45;\n        const feetY = entity.y + entity.height - 2;\n        const solidAtSample = isSolidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds);\n        const canFloat = !!(liquidSample?.inLiquid && liquidSample?.type && liquidSample.type.includes('water') && !solidAtSample);\n        if (canFloat) {\n          const surfaceY = getWaterSurfaceY({\n            x: entity.x + entity.width / 2,\n            mapWidth,\n            mapHeight,\n            tileData,\n            registryItems,\n            TILE_SIZE\n          });\n          const surfaceOffset = Number.isFinite(cfg.deathSurfaceOffset) ? cfg.deathSurfaceOffset : 0.5;\n          if (Number.isFinite(surfaceY)) {\n            const targetY = surfaceY - entity.height * surfaceOffset;\n            const floatSpeed = (Number(cfg.deathFloatSpeed) || 0.25) * TILE_SIZE;\n            if (entity.y > targetY) {\n              entity.y = Math.max(targetY, entity.y - floatSpeed * dt);\n            } else {\n              entity.y = targetY;\n            }\n          }\n        }\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.isGrounded = canFloat ? false : checkCollision(entity.x, entity.y + 1, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n        entity.flipY = true;\n        entity.animation = 'dead';\n        const deadAnim = def.spriteSheet?.animations?.dead || [];\n        entity.currentSpriteIndex = deadAnim.length ? deadAnim[0] : (cfg.meteorShockFrame || 2);\n        continue;\n      }\n\n      entity.flipY = false;\n      entity.alpha = 1;\n\n      if (requireLiquid && !isAllowed && !fs.isJumping) {\n        entities.splice(i, 1);\n        continue;\n      }\n\n      const panicRadiusPx = (Number(cfg.panicRadius) || 6) * TILE_SIZE;\n      const panicSpeed = (Number(cfg.panicSpeed) || 2.2) * TILE_SIZE;\n      const baseSpeed = (Number(cfg.swimSpeed) || 0.6) * TILE_SIZE;\n      const verticalDrift = (Number(cfg.verticalDrift) || 0.25) * TILE_SIZE;\n      const isWaterfall = !!(liquidType && liquidType.includes('waterfall'));\n      const waterfallDriftMultiplier = Number.isFinite(cfg.waterfallDriftMultiplier) ? cfg.waterfallDriftMultiplier : 0.4;\n      const waterfallSpeedMultiplier = Number.isFinite(cfg.waterfallSpeedMultiplier) ? cfg.waterfallSpeedMultiplier : 0.7;\n\n      const triggerDef = getFishTriggerAt({\n        x: entity.x + entity.width / 2,\n        y: entity.y + entity.height / 2,\n        mapWidth,\n        mapHeight,\n        TILE_SIZE,\n        secretData: getSecretLayerData(mapData),\n        objectData,\n        registryItems\n      });\n      const triggerCfg = triggerDef?.fishTrigger || {};\n      const fishJumpCfg = cfg.jump || {};\n      const mergedJumpCfg = { ...triggerCfg, ...fishJumpCfg };\n      const nowMs = Number(gameState.current.timeMs) || 0;\n      const nextJumpAt = Number(fs.nextJumpAt) || 0;\n      const canJump = !fs.isJumping && nowMs >= nextJumpAt && triggerDef && liquidSample?.inLiquid && liquidTypeToHabitat(liquidType) === 'water';\n\n      if (canJump) {\n        const chance = Math.max(0, Math.min(1, Number(mergedJumpCfg.chance ?? 1)));\n        if (Math.random() <= chance) {\n          const jumpDir = Math.random() < 0.5 ? -1 : 1;\n          entity.direction = jumpDir;\n          fs.isJumping = true;\n          fs.jumpVx = (Number(mergedJumpCfg.speedX) || 3.5) * TILE_SIZE * jumpDir;\n          fs.jumpVy = -(Number(mergedJumpCfg.speedY) || 6) * TILE_SIZE;\n          fs.jumpGravity = (Number(mergedJumpCfg.gravity) || 18) * TILE_SIZE;\n          fs.jumpBounce = Number.isFinite(mergedJumpCfg.bounce) ? Number(mergedJumpCfg.bounce) : 0.35;\n          fs.nextJumpAt = nowMs + (Number(mergedJumpCfg.cooldownMs) || 1400);\n        }\n      }\n\n      if (fs.isJumping) {\n        const dtSec = Math.max(0, Number(deltaMs) || 0) / 1000;\n        fs.jumpVy = (Number(fs.jumpVy) || 0) + (Number(fs.jumpGravity) || (GRAVITY * 60)) * dtSec;\n        let nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        let nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n\n        if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          fs.jumpVx = -(Number(fs.jumpVx) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        }\n\n        if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          if ((Number(fs.jumpVy) || 0) > 0) {\n            entity.health = 0;\n            fs.isJumping = false;\n            entity.vx = 0;\n            entity.vy = 0;\n            entity.isGrounded = true;\n            entity.x = nextX;\n            entity.y = Math.floor((nextY + entity.height - 0.1) / TILE_SIZE) * TILE_SIZE - entity.height;\n            continue;\n          }\n          fs.jumpVy = Math.abs(Number(fs.jumpVy) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n        }\n\n        const landingSample = getLiquidSample ? getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        }) : { inLiquid: false };\n\n        if (landingSample?.inLiquid && liquidTypeToHabitat(landingSample?.type) === 'water' && (Number(fs.jumpVy) || 0) > 0) {\n          fs.isJumping = false;\n          entity.vx = 0;\n          entity.vy = 0;\n        } else {\n          entity.vx = Number(fs.jumpVx) || 0;\n          entity.vy = Number(fs.jumpVy) || 0;\n        }\n\n        entity.x = nextX;\n        entity.y = nextY;\n        entity.isGrounded = false;\n        continue;\n      }\n\n      const px = playerX + gameState.current.width / 2;\n      const py = playerY + gameState.current.height / 2;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      const dx = px - ex;\n      const dy = py - ey;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (fs.shockUntil && fs.shockUntil > now) {\n        const shockFrame = Number(cfg.meteorShockFrame) || 2;\n        entity.animation = 'shock';\n        entity.currentSpriteIndex = shockFrame;\n      }\n\n      const lastWaterEnter = gameState.current.lastWaterEnter;\n      if (lastWaterEnter && Number(lastWaterEnter.time) && now - Number(lastWaterEnter.time) < 1200) {\n        const waveRadiusPx = (Number(cfg.playerWaveRadius) || 10) * TILE_SIZE;\n        if (dist <= waveRadiusPx) {\n          fs.waveImpulse = Number(cfg.playerWaveImpulse) || 0.35;\n          fs.waveUntil = now + 400;\n        }\n        if (dist <= panicRadiusPx) {\n          fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n        }\n      }\n      if (gameState.current.inWater && dist <= panicRadiusPx) {\n        fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n      }\n\n      // Sea Rescue Ship reaction\n      if (isSeaRescue) {\n        const shipDef = getDefById(registryItems, 'minispill_sea_rescue_ship');\n        const shipReactionRadius = (shipDef?.fishReactionRadius || 15) * TILE_SIZE;\n        if (dist <= shipReactionRadius) {\n          fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n        }\n\n        // Engine panic logic (fishes under moving ship)\n        const isShipMoving = Math.abs(gameState.current.vx) > 5;\n        if (isShipMoving) {\n          const shipX = gameState.current.x;\n          const shipW = (shipDef?.width || 27) * TILE_SIZE;\n          const shipBottomY = gameState.current.y + (shipDef?.height || 7) * TILE_SIZE;\n          const enginePanicRadius = (shipDef?.enginePanicRadius || 10) * TILE_SIZE;\n\n          if (ex >= shipX && ex <= shipX + shipW && ey >= shipBottomY && ey <= shipBottomY + enginePanicRadius) {\n            fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n          }\n        }\n      }\n\n      const isPanicking = fs.panicUntil && fs.panicUntil > now;\n      let dir = entity.direction || 1;\n      if (isPanicking) {\n        dir = dx >= 0 ? -1 : 1;\n      } else if (now >= (fs.nextTurnAt || 0)) {\n        dir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n      }\n      entity.direction = dir;\n\n      if (now >= (fs.nextVerticalAt || 0)) {\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n      }\n\n      let vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n      let vy = (fs.verticalDir || 1) * verticalDrift;\n      if (isWaterfall) {\n        vx *= waterfallSpeedMultiplier;\n        vy *= waterfallDriftMultiplier;\n        const downSpeed = (Number(cfg.waterfallDownSpeed) || 2.4) * TILE_SIZE;\n        vy = Math.max(Math.abs(vy), downSpeed);\n        entity.alpha = Number.isFinite(cfg.waterfallAlpha) ? cfg.waterfallAlpha : 1;\n      }\n\n      if (fs.waveUntil && fs.waveUntil > now) {\n        const impulse = Math.max(0, Number(fs.waveImpulse) || 0.35) * TILE_SIZE;\n        vx += (Math.random() - 0.5) * impulse;\n        vy += (Math.random() - 0.5) * impulse * 0.5;\n      }\n\n      let nextX = entity.x + vx * dt;\n      let nextY = entity.y + vy * dt;\n\n      if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        dir *= -1;\n        entity.direction = dir;\n        vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n        nextX = entity.x + vx * dt;\n      }\n\n      if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        fs.verticalDir *= -1;\n        vy = fs.verticalDir * verticalDrift;\n        nextY = entity.y + vy * dt;\n      }\n\n      if (typeof getLiquidSample === 'function') {\n        const sampleNext = getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        });\n        const nextType = liquidTypeToHabitat(sampleNext?.type);\n        const nextAllowed = !!(sampleNext?.inLiquid && nextType && habitat[nextType] !== false);\n        if (!nextAllowed) {\n          fs.verticalDir *= -1;\n          dir *= -1;\n          entity.direction = dir;\n          vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n          vy = fs.verticalDir * verticalDrift;\n          nextX = entity.x + vx * dt;\n          nextY = entity.y + vy * dt;\n        }\n      }\n\n      if (entitiesRef?.current?.length) {\n        const cx = nextX + entity.width / 2;\n        const cy = nextY + entity.height / 2;\n        const gx = Math.floor(cx / TILE_SIZE);\n        const gy = Math.floor(cy / TILE_SIZE);\n        for (const other of entitiesRef.current) {\n          if (other.id === entity.id) continue;\n          if (!isFishEntity(other) || other.health <= 0) continue;\n          const ocx = other.x + other.width / 2;\n          const ocy = other.y + other.height / 2;\n          if (Math.floor(ocx / TILE_SIZE) !== gx || Math.floor(ocy / TILE_SIZE) !== gy) continue;\n          const dir = String(entity.id) < String(other.id) ? -1 : 1;\n          const nudge = dir * TILE_SIZE * 0.25;\n          const tryX = nextX + nudge;\n          if (!checkCollision(tryX, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextX = tryX;\n            entity.direction = dir;\n            break;\n          }\n          const tryY = nextY + nudge;\n          if (!checkCollision(nextX, tryY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextY = tryY;\n            break;\n          }\n        }\n      }\n\n      entity.x = nextX;\n      entity.y = nextY;\n      entity.vx = vx;\n      entity.vy = vy;\n      entity.isGrounded = false;\n\n      const anims = def.spriteSheet?.animations || {};\n      let animKey = 'swim';\n      if (isPanicking && anims.panic) animKey = 'panic';\n      if (Math.abs(vx) < 0.02 && anims.idle) animKey = 'idle';\n\n      if (!(fs.shockUntil && fs.shockUntil > now)) {\n        const currentAnim = anims[animKey] || anims.swim || anims.idle || [0];\n        fs.animTimer = (fs.animTimer || 0) + deltaMs;\n        const frameDur = 180;\n        if (fs.animTimer >= frameDur) {\n          fs.animTimer = 0;\n          fs.animFrame = (fs.animFrame || 0) + 1;\n          if (fs.animFrame >= currentAnim.length) fs.animFrame = 0;\n        }\n        entity.currentSpriteIndex = currentAnim[fs.animFrame % currentAnim.length];\n      }\n\n      continue;\n    }\n\n    // 1.5. Pushable objektu (Akmeu) fizika\n    if (entity.subtype === 'pushable' || def?.isPushable) {\n      const inLiquid = liquidSample.inLiquid;\n      const liquidType = liquidSample.type;\n\n      // Skaas, ja iekrt idrum\n      if (inLiquid && !entity.prevInLiquid) {\n        if (liquidType === 'water' && def.sounds?.water_splash) {\n          playSfx(def.sounds.water_splash, 0.4);\n        } else if (liquidType === 'lava' && def.sounds?.lava_splash) {\n          playSfx(def.sounds.lava_splash, 0.4);\n        }\n      }\n      entity.prevInLiquid = inLiquid;\n\n        // Horizontl kustba ar berzi\n        const mh = moveHorizontal({\n          keys: {}, \n          state: { x: entity.x, y: entity.y, vx: entity.vx || 0, width: entity.width, height: entity.height, direction: entity.direction },\n          MOVE_SPEED: 6.0, // Palielints max trums akmeiem (Supaplex stil)\n          TILE_SIZE,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) return true;\n            \n            // Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            return (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n          },\n          friction: inLiquid ? 0.7 : 0.85,\n          acceleration: 0.2\n        });\n        entity.x = mh.x;\n        entity.vx = mh.vx;\n        entity.direction = mh.direction;\n\n      // Vertikl fizika\n      if (inLiquid && liquidType === 'lava') {\n        // Lna slkana lav\n        const sinkingSpeed = def.sinkingSpeed || 0.2;\n        entity.vy = sinkingSpeed;\n        entity.y += entity.vy;\n        entity.isGrounded = false;\n        \n        // Prbaudm vai neesam izgjui cauri zemei lav\n        if (checkCollision(entity.x, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n           // Atstumjam atpaka, ja atduras pret dibenu\n           entity.y -= entity.vy;\n           entity.vy = 0;\n           entity.isGrounded = true;\n        }\n      } else {\n        // Fall distance tracking: if falling, accumulate distance\n        if (entity.isGrounded) {\n          entity.fallDistance = 0;\n        } else if ((entity.vy || 0) > 0) {\n          entity.fallDistance = (entity.fallDistance || 0) + (entity.vy || 0);\n        }\n\n        // Standarta gravitcija (den lnka)\n        const vp = applyVerticalPhysics({\n          keys: {}, \n          x: entity.x,\n          y: entity.y,\n          vy: entity.vy || 0,\n          isGrounded: entity.isGrounded,\n          animation: 'idle',\n          GRAVITY: inLiquid ? GRAVITY * 0.3 : GRAVITY,\n          TERMINAL_VELOCITY,\n          JUMP_FORCE: 0,\n          TILE_SIZE,\n          width: entity.width,\n          height: entity.height,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // 1. Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) {\n              // Ja ms kaut kam uzkrtam un esam kritui pietiekami ilgi\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                // Atrodam kuru enttiju ms aizskrm (lai nogalintu ienaidniekus)\n                if (entitiesRef.current) {\n                  for (const other of entitiesRef.current) {\n                    if (other.id === entity.id || other.health <= 0 || other.subtype === 'platform' || other.subtype === 'pushable') continue;\n                    \n                    const hitOther = (\n                      nx < other.x + other.width &&\n                      nx + (w || entity.width) > other.x &&\n                      ny < other.y + other.height &&\n                      ny + (h || entity.height) > other.y\n                    );\n                    \n                    if (hitOther) {\n                      other.health = 0; // Nogalinm ienaidnieku\n                      // Vartu atskaot skau, ja tda definta\n                      if (def.sounds?.kill_enemy) {\n                        playSfx(def.sounds.kill_enemy, 0.5);\n                      }\n                    }\n                  }\n                }\n              }\n              return true;\n            }\n            \n            // 2. Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            const hitPlayer = (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n            \n            if (hitPlayer) {\n              // Ja akmens uzkrt spltjam pc brva kritiena (vismaz 1 tuks bloks)\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                gameState.current.health = 0; // Fatal impact\n              }\n              return true;\n            }\n            \n            return false;\n          },\n          isLiquidAt,\n          vx: entity.vx\n        });\n        entity.y = vp.y;\n        entity.vy = vp.vy;\n        entity.isGrounded = vp.isGrounded;\n\n        // --- ROLLING LOGIC (Supaplex style) ---\n        // Akmei ripo lej no citiem apaiem objektiem vai pakpieniem, ja ir brva vieta sn un pa diagonli\n        if (entity.isGrounded && Math.abs(entity.vx) < 0.1 && def.isRound) {\n          const checkEmpty = (tx, ty) => !checkCollision(tx, ty, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n          \n          // Minm ripot pa KREISI\n          const leftX = entity.x - TILE_SIZE;\n          // canRollLeft: vai flze pa kreisi ir brva UN vai flze pa kreisi uz leju ir brva (tukums/pakpiens)\n          const canRollLeft = checkEmpty(leftX, entity.y) && checkEmpty(leftX, entity.y + TILE_SIZE);\n          \n          if (canRollLeft) {\n            // Ripojam pa kreisi. Palielints trums (6.0), lai \"veas\" trk\n            entity.vx = -6.0; \n          } else {\n            // Minm ripot pa LABI\n            const rightX = entity.x + TILE_SIZE;\n            const canRollRight = checkEmpty(rightX, entity.y) && checkEmpty(rightX, entity.y + TILE_SIZE);\n            if (canRollRight) {\n              entity.vx = 6.0;\n            }\n          }\n        }\n\n        // Atjaunojam rotciju, ja akmens veas (horizontal movement while grounded)\n      if (entity.isGrounded && Math.abs(entity.vx) > 0.1 && def.isRound) {\n        // Rotcija proporcionla trumam (0.07 rad/px * vx)\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.07);\n        if (def.sounds?.roll) {\n          const nowMs = Number(gameState.current.timeMs) || 0;\n          const lastAt = Number(entity.lastRollSfxAt) || 0;\n          if (!lastAt || nowMs - lastAt >= 450) {\n            playSfx(def.sounds.roll, 0.35);\n            entity.lastRollSfxAt = nowMs;\n          }\n        }\n      } else if (!entity.isGrounded && def.isRound) {\n        // Ar krtot var nedaudz rott, ja ir bijis horizontls trums\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.03);\n      }\n      }\n\n      // Animcija akmenim parasti ir statiska\n      entity.animation = 'idle';\n      entity.currentSpriteIndex = def.spriteSheet?.animations?.idle?.[0] || 0;\n\n      continue;\n    }\n\n    // Platformu loika\n    if (entity.subtype === 'platform') {\n      const speed = def.speed || 1.5;\n      const mapW = mapWidth;\n      const mapH = mapHeight;\n      \n      // Mekljam bultias vairkos punktos (centr un mals), lai nepalaistu garm\n      const points = [\n        { x: entity.x + entity.width / 2, y: entity.y + entity.height / 2 }, // Centrs\n        { x: entity.x + 5, y: entity.y + entity.height / 2 },                // Kreis mala\n        { x: entity.x + entity.width - 5, y: entity.y + entity.height / 2 }  // Lab mala\n      ];\n      \n      let arrowId = null;\n      let foundArrowDef = null;\n\n      for (const p of points) {\n        const tx = Math.floor(p.x / TILE_SIZE);\n        const ty = Math.floor(p.y / TILE_SIZE);\n        \n        if (tx < 0 || tx >= mapW || ty < 0 || ty >= mapH) continue;\n        const idx = ty * mapW + tx;\n\n        // 1. Specilais arrows slnis\n        const arrowsLayer = ctx.mapData?.layers?.find(l => l.name === 'arrows' || l.name === 'Arrows')?.data;\n        let id = arrowsLayer ? arrowsLayer[idx] : null;\n        \n        // 2. Objektu slnis\n        if (!id && ctx.objectData) {\n          id = ctx.objectData[idx];\n        }\n\n        if (id) {\n          const aDef = getDefById(ctx.registryItems, id);\n          if (aDef && aDef.subtype === 'arrow') {\n            arrowId = id;\n            foundArrowDef = aDef;\n            break; \n          }\n        }\n      }\n      \n      if (foundArrowDef) {\n        // Mainm kustbas virzienu atbilstoi bultiai\n        if (foundArrowDef.direction === 'up') { entity.vx = 0; entity.vy = -speed; }\n        else if (foundArrowDef.direction === 'down') { entity.vx = 0; entity.vy = speed; }\n        else if (foundArrowDef.direction === 'left') { entity.vx = -speed; entity.vy = 0; }\n        else if (foundArrowDef.direction === 'right') { entity.vx = speed; entity.vy = 0; }\n      }\n\n      // Ja platforma vl nekustas, iedodam tai skuma impulsu\n      if (entity.vx === 0 && entity.vy === 0) {\n        entity.vx = speed;\n      }\n\n      // Kustba\n      let nextX = entity.x + entity.vx * (deltaMs / 16.6);\n      let nextY = entity.y + entity.vy * (deltaMs / 16.6);\n      \n      // Robeu prbaude (neaujam aizbraukt aiz kartes)\n      const worldW = mapWidth * TILE_SIZE;\n      const worldH = mapHeight * TILE_SIZE;\n      \n      if (nextX < 0) { \n        nextX = 0; \n        entity.vx = Math.abs(entity.vx); // Move Right\n      } else if (nextX + entity.width > worldW) { \n        nextX = worldW - entity.width; \n        entity.vx = -Math.abs(entity.vx); // Move Left\n      }\n      \n      if (nextY < 0) { \n        nextY = 0; \n        entity.vy = Math.abs(entity.vy); // Move Down\n      } else if (nextY + entity.height > worldH) { \n        nextY = worldH - entity.height; \n        entity.vy = -Math.abs(entity.vy); // Move Up\n      }\n      \n      entity.x = nextX;\n      entity.y = nextY;\n\n      // Spltja \"prveana\"\n      const player = gameState.current;\n      const onPlatform = (\n        player.x + player.width > entity.x &&\n        player.x < entity.x + entity.width &&\n        Math.abs((player.y + player.height) - entity.y) < 5 &&\n        player.vy >= 0\n      );\n\n      if (onPlatform) {\n        player.x += entity.vx * (deltaMs / 16.6);\n        player.y = entity.y - player.height;\n        player.vy = 0;\n        player.isGrounded = true;\n        \n        // Atjauninam animciju, lai nebtu \"fall\" uz platformas\n        if (Math.abs(player.vx) > 0.1) {\n          player.animation = 'run';\n        } else {\n          player.animation = 'idle';\n        }\n      }\n\n      continue;\n    }\n\n    const ai = def.ai || {};\n    const reactionDist = (ai.reactionDistance || 10) * TILE_SIZE;\n    const shootDist = (ai.shootDistance || 8) * TILE_SIZE;\n    const speed = def.speed || 1.2;\n\n    const dx = playerX - entity.x;\n    const dy = playerY - entity.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let keys = { a: false, d: false, w: false };\n\n    // 2. AI Uzvedba\n    if (dist < reactionDist) {\n      // Sekojam spltjam\n      if (dx > TILE_SIZE * 0.5) {\n          keys.d = true;\n          entity.direction = 1;\n      } else if (dx < -TILE_SIZE * 0.5) {\n          keys.a = true;\n          entity.direction = -1;\n      }\n\n      // Lkana, ja AI to atbalsta un priek ir rslis\n      if (ai.canJump && entity.isGrounded) {\n          const nextX = entity.x + entity.direction * 10;\n          if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n              keys.w = true;\n          }\n      }\n\n      // auana\n      if (dist < shootDist) {\n        if (entity.shootCooldown <= 0) {\n           const facingPlayer = (dx > 0 && entity.direction > 0) || (dx < 0 && entity.direction < 0);\n           // Tanks auj, ja skats uz spltju vai ja tas ir pietiekami tuvu\n           if (facingPlayer || dist < TILE_SIZE * 2) {\n             entity.isShooting = true;\n             entity.shootCooldown = ai.shootCooldown || 2000;\n             \n             // Izsaucam via izveidi\n             if (typeof spawnProjectile === 'function') {\n                // Novietojam viu rpus tanka korpusa (atkarb no virziena)\n                const spawnX = entity.x + (entity.width / 2) + (entity.direction * (entity.width / 2 + 10));\n                const spawnY = entity.y + (entity.height * 0.4); // Nedaudz augstk par centru (stobrs)\n                \n                spawnProjectile(\n                  spawnX, \n                  spawnY, \n                  entity.direction,\n                  entity.id\n                );\n             }\n           }\n        }\n      }\n    } else if (ai.patrol) {\n      // Patruanas rems\n      if (entity.direction > 0) keys.d = true;\n      else keys.a = true;\n\n    // Sienas un ru prbaude, lai grieztos atpaka\n    const nextX = entity.x + entity.direction * 10;\n    let hitSomething = checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height);\n\n    // Tanku specifisk kolzija (ar spltju un citiem tankiem)\n    if (!hitSomething && entity.subtype === 'tank') {\n      // 1. Prbaude ar spltju\n      const p = gameState.current;\n      if (nextX < p.x + p.width && nextX + entity.width > p.x && entity.y < p.y + p.height && entity.y + entity.height > p.y) {\n        hitSomething = true;\n      }\n\n      // 2. Prbaude ar citiem tankiem\n      if (!hitSomething) {\n        for (const other of entitiesRef.current) {\n          if (other === entity || other.health <= 0 || other.isExploding) continue;\n          if (other.subtype !== 'tank') continue;\n\n          if (nextX < other.x + other.width && nextX + entity.width > other.x && entity.y < other.y + other.height && entity.y + entity.height > other.y) {\n            hitSomething = true;\n            // Liekam ar otram tankam maint virzienu, ja tie brauc viens otram virs\n            if ((entity.direction > 0 && other.direction < 0) || (entity.direction < 0 && other.direction > 0)) {\n               other.direction *= -1;\n            }\n            break;\n          }\n        }\n      }\n    }\n\n    if (hitSomething) {\n      entity.direction *= -1;\n    }\n    \n    // Platformas malas prbaude\n      if (ai.stayOnPlatform && entity.isGrounded) {\n          const groundX = entity.x + (entity.direction > 0 ? entity.width : 0) + entity.direction * 5;\n          const groundY = entity.y + entity.height + 5;\n          if (!checkCollision(groundX, groundY, mapWidth, mapHeight, 2, 2)) {\n              entity.direction *= -1;\n          }\n      }\n    }\n\n    // Cooldown atjaunoana\n    if (entity.shootCooldown > 0) {\n      entity.shootCooldown -= deltaMs;\n      // Pc 300ms prtraucam auanas animciju\n      if (entity.shootCooldown < (ai.shootCooldown || 2000) - 300) {\n        entity.isShooting = false;\n      }\n    }\n\n    // 3. Fizika un kustba\n    const frameSpeed = speed * (deltaMs / 16.67);\n    \n    const checkEntityCollision = (nx, ny) => {\n        // Statisk pasaule\n        if (checkCollision(nx, ny, mapWidth, mapHeight, entity.width, entity.height)) return true;\n        \n        // Tankiem blojam ceu, ja priek ir spltjs vai cits tanks\n        if (entity.subtype === 'tank') {\n            const p = gameState.current;\n            if (nx < p.x + p.width && nx + entity.width > p.x && ny < p.y + p.height && ny + entity.height > p.y) return true;\n            \n            for (const other of entitiesRef.current) {\n                if (other === entity || other.health <= 0 || other.isExploding) continue;\n                if (other.subtype !== 'tank') continue;\n                if (nx < other.x + other.width && nx + entity.width > other.x && ny < other.y + other.height && ny + entity.height > other.y) return true;\n            }\n        }\n        return false;\n    };\n\n    const mh = moveHorizontal({\n      keys,\n      state: { \n        x: entity.x, \n        y: entity.y, \n        vx: entity.vx || 0,\n        width: entity.width, \n        direction: entity.direction \n      },\n      MOVE_SPEED: frameSpeed,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision\n    });\n    entity.x = mh.x;\n    entity.vx = mh.vx;\n    entity.direction = mh.direction;\n\n    const vp = applyVerticalPhysics({\n      keys,\n      x: entity.x,\n      y: entity.y,\n      vy: entity.vy,\n      isGrounded: entity.isGrounded,\n      animation: entity.animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE: ai.canJump ? 8 : 0,\n      TILE_SIZE,\n      width: entity.width,\n      height: entity.height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision,\n      isLiquidAt: ctx.isLiquidAt,\n      vx: entity.vx\n    });\n    entity.y = vp.y;\n    entity.vy = vp.vy;\n    entity.isGrounded = vp.isGrounded;\n\n    // 4. Animcijas stvoka noteikana\n    if (entity.isShooting) {\n      entity.animation = 'shoot';\n    } else if (entity.health <= (def.maxHealth || 100) * 0.5) {\n      entity.animation = 'move_damaged';\n    } else if (entity.vx === 0 && entity.isGrounded) {\n      entity.animation = 'idle';\n    } else {\n      entity.animation = 'move';\n    }\n\n    // Atjaunojam animcijas rmi, ja tas nav sprdziens\n    if (!entity.isExploding) {\n        const anims = def.spriteSheet?.animations || {};\n        let currentAnim = anims[entity.animation];\n        \n        // Rezerves varianti, ja specifisk animcija nav atrasta\n        if (!currentAnim || !Array.isArray(currentAnim) || currentAnim.length === 0) {\n            currentAnim = anims['move'] || anims['idle'] || [0];\n        }\n        \n        entity.animTimer = (entity.animTimer || 0) + deltaMs;\n        const frameDur = 100; // ms\n        if (entity.animTimer >= frameDur) {\n            entity.animTimer = 0;\n            entity.animFrame = (entity.animFrame || 0) + 1;\n            if (entity.animFrame >= currentAnim.length) {\n                entity.animFrame = 0;\n            }\n        }\n        entity.currentSpriteIndex = currentAnim[entity.animFrame % currentAnim.length];\n    } else {\n        const explodeAnim = def.spriteSheet?.animations?.explode || [39];\n        // Sprdziena animcija tiek vadta augstk (death sekcij)\n        entity.currentSpriteIndex = explodeAnim[Math.min(entity.animFrame, explodeAnim.length - 1)];\n    }\n\n    if (entity.shouldRemove) {\n      entities.splice(i, 1);\n    }\n  }\n}\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { resolveInteractableContext } from '../gameplay/interactables/context';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\nimport { updateEntities } from '../gameplay/entities';\nimport { updateSeaRescue } from '../gameplay/seaRescue';\nimport { getWeatherDps, getMapWeather, getRadioactivityRates, weatherAffectsPlayer, weatherBlockedByCover } from '../gameplay/weatherDamage';\nimport { isCoveredFromAbove } from '../gameplay/weatherCover';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isLiquidAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions,\n    registryItems\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isLiquidAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, playSfx, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n  const activeMap = mapData.maps ? mapData.maps[activeId] : mapData;\n  const mapType = activeMap?.type;\n\n  const mapWidth = activeMap?.width || mapData.meta?.width || mapData.width || 20;\n  const mapHeight = activeMap?.height || mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo,\n    iceResist,\n    maxIceResist\n  } = gameState.current;\n\n  const dt = Math.max(0, deltaMs || 0);\n  const physicsDt = Math.min(dt, 100);\n\n    // Sea Rescue logic\n  if (mapType === 'sea_rescue') {\n    updateSeaRescue(ctx, dt);\n    \n    // Update projectiles in sea rescue too\n    if (actions.updateProjectiles) {\n      actions.updateProjectiles(physicsDt, mapWidth, mapHeight);\n    }\n\n    // Update entities (fishes) in sea rescue\n    try {\n      updateEntities({\n        entitiesRef,\n        projectilesRef: refs.projectilesRef,\n        gameState,\n        mapData,\n        objectData,\n        mapWidth,\n        mapHeight,\n        TILE_SIZE,\n        checkCollision,\n        isLiquidAt,\n        getLiquidSample,\n        spawnProjectile,\n        playSfx,\n        constants,\n        registryItems: ctx.registryItems,\n        onStateUpdate: actions.onStateUpdate,\n        activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n      }, Math.min(dt, 100));\n    } catch (e) {\n      console.error(\"Sea Rescue Entity update failed:\", e);\n    }\n\n    // Ship control (A/D)\n    const shipAccel = 400;\n    const shipFriction = 0.95;\n    const maxShipSpeed = 250;\n    \n    if (keys.a || keys.ArrowLeft) {\n        vx -= shipAccel * (dt / 1000);\n    } else if (keys.d || keys.ArrowRight) {\n        vx += shipAccel * (dt / 1000);\n    } else {\n        vx *= shipFriction;\n        if (Math.abs(vx) < 1) vx = 0;\n    }\n    \n    vx = Math.max(-maxShipSpeed, Math.min(maxShipSpeed, vx));\n    x += vx * (dt / 1000);\n    \n    // Constrain ship within map\n    x = Math.max(0, Math.min(x, (mapWidth - 27) * TILE_SIZE)); // Ship width is 27 tiles\n\n    // Update state and exit early (no normal player physics)\n    gameState.current = {\n        ...gameState.current,\n        x, vx, y, vy, \n        isGrounded: true, \n        animation: 'idle',\n        timeMs: Number(timestamp) || 0\n    };\n    setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n    return { continue: true };\n  }\n\n  // 0.5) Resources update (before physics to affect them)\n  // Ice resistance depletion: drains while on slippery surface; regenerates otherwise\n  const layers = ctx.mapData.layers || [];\n  const backgroundLayer = layers.find(l => l.name === 'background')?.data || [];\n  const secretLayer = layers.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n  const objectMetadata = mapData.meta?.objectMetadata || {};\n  const surface = helpers.getSurfaceProperties ? helpers.getSurfaceProperties(x, y, width, height, mapWidth, mapHeight, TILE_SIZE, backgroundLayer, ctx.registryItems) : { friction: 0.8, acceleration: 0.2 };\n  \n  const isSlippery = surface.friction >= 0.9;\n  let currentIceRes = Number(iceResist);\n  const maxIce = Math.max(1, Number(maxIceResist || 100));\n  if (!Number.isFinite(currentIceRes)) currentIceRes = maxIce;\n\n  if (isSlippery) {\n    currentIceRes -= (20 * dt) / 1000;\n  } else {\n    currentIceRes += (35 * dt) / 1000;\n  }\n  currentIceRes = Math.max(0, Math.min(maxIce, currentIceRes));\n  gameState.current.iceResist = currentIceRes;\n\n  let effectiveFriction = surface.friction;\n  if (isSlippery && currentIceRes > 0) {\n      const ratio = currentIceRes / maxIce;\n      const targetFriction = 0.8;\n      effectiveFriction = surface.friction - (surface.friction - targetFriction) * ratio;\n  }\n\n  // 1) Horizontal movement\n  const checkCollisionExtended = (nx, ny, mw, mh, w, h) => {\n    return checkCollision(nx, ny, mw, mh, w, h);\n  };\n\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, vx, width, direction, height },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    friction: effectiveFriction,\n    acceleration: isSlippery ? (currentIceRes > 0 ? 0.15 : surface.acceleration) : surface.acceleration,\n    deltaMs: physicsDt\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 1.1) Pushable objects logic (Stone pushing)\n  let isPushing = false;\n  let pushTarget = null;\n  \n  const currentStrength = gameState.current.strength || 30;\n  const isAlreadyAtMax = currentStrength >= 99;\n  const lastPushTime = gameState.current.lastPushTime || 0;\n  const gracePeriod = 300; // ms, kur strength nesamazins pat ja kontakts pazd uz brdi\n\n  if (entitiesRef.current) {\n    // Ja jau stumjam ar pilnu jaudu, esam pielaidgki pret attlumu (histerze), \n    // lai kompenstu nelielas fizikas dzinja nobdes.\n    const pushDist = isAlreadyAtMax ? 15 : 5;\n    const overlapDist = isAlreadyAtMax ? 12 : 5;\n\n    for (const ent of entitiesRef.current) {\n      if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n        // Prbaudm vai spltjs ir blakus akmenim\n        const isNextToLeft = (x + width + pushDist > ent.x) && (x + width <= ent.x + overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n        const isNextToRight = (x - pushDist < ent.x + ent.width) && (x >= ent.x + ent.width - overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n\n        if ((isNextToLeft && keys.d) || (isNextToRight && keys.a)) {\n          isPushing = true;\n          pushTarget = ent;\n          break;\n        }\n      }\n    }\n  }\n\n  if (isPushing) {\n    gameState.current.strength = Math.min(100, currentStrength + (65 * dt) / 1000); // Aug par ~65% sekund\n    if (gameState.current.strength >= 100 && pushTarget) {\n      // Pastumjam akmeni\n      const pushForce = 2.0;\n      pushTarget.vx = (x < pushTarget.x ? 1 : -1) * pushForce;\n      gameState.current.lastPushTime = timestamp; \n      \n      // Atskaojam skau\n      if (pushTarget.def?.sounds?.push && (!pushTarget.lastPushSoundTime || timestamp - pushTarget.lastPushSoundTime > 450)) {\n        playSfx(pushTarget.def.sounds.push, 0.3);\n        pushTarget.lastPushSoundTime = timestamp;\n      }\n    }\n  } else {\n    // Prbaudm grace periodu pirms skam samazint spku\n    const timeSincePush = timestamp - lastPushTime;\n    if (timeSincePush > gracePeriod) {\n      if (currentStrength > 30) {\n        gameState.current.strength = Math.max(30, currentStrength - (35 * dt) / 1000);\n      } else {\n        gameState.current.strength = 30;\n      }\n    }\n  }\n\n  // 1.9) Ladder check (allow climbing when overlapping ladder objects)\n  const getDefById = (id) => {\n    if (!id) return null;\n    const map = registryItems && registryItems.__byId;\n    if (map && typeof map.get === 'function') return map.get(id) || null;\n    return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n  };\n\n  const findLadderAtPlayer = () => {\n    if (!objectData || !registryItems) return null;\n    const centerX = x + width / 2;\n    const centerY = y + height / 2;\n    const ctxResolved = resolveInteractableContext({\n      mapData,\n      mapWidth,\n      mapHeight,\n      objectLayerData: objectData,\n      mainObjectMetadata: objectMetadata,\n      secretMapData: secretLayer,\n      activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n      centerX,\n      centerY,\n      TILE_SIZE\n    });\n    const { activeObjectData, activeMetadata, activeMapWidth, activeMapHeight, offsetX, offsetY } = ctxResolved;\n    if (!activeObjectData) return null;\n    const localX = centerX - offsetX;\n    const localY = centerY - offsetY;\n    const gridX = Math.floor(localX / TILE_SIZE);\n    const gridY = Math.floor(localY / TILE_SIZE);\n    if (gridX < 0 || gridY < 0 || gridX >= activeMapWidth || gridY >= activeMapHeight) return null;\n    let idx = gridY * activeMapWidth + gridX;\n    let objId = activeObjectData[idx];\n    if (!objId && activeMetadata) {\n      for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n        const baseIdx = parseInt(idxStr, 10);\n        const w = meta.width || 1;\n        const h = meta.height || 1;\n        if (w <= 1 && h <= 1) continue;\n        const ox = baseIdx % activeMapWidth;\n        const oy = Math.floor(baseIdx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          objId = activeObjectData[baseIdx];\n          idx = baseIdx;\n          break;\n        }\n      }\n    }\n    if (!objId) return null;\n    const def = getDefById(objId);\n    if (!def) return null;\n    const isLadder = !!(def.flags?.ladder || def.subtype === 'ladder' || def.type === 'ladder');\n    if (!isLadder) return null;\n    return { def, index: idx };\n  };\n\n  const ladderInfo = findLadderAtPlayer();\n\n  // 2) Vertical physics\n  let vp = null;\n  let remaining = physicsDt;\n  let steps = 0;\n  const prevInWaterFrame = !!gameState.current.inWater;\n  let prevInWater = prevInWaterFrame;\n  if (ladderInfo && !keys?.space) {\n    const ladderSpeed = Math.max(40, Number(ladderInfo.def?.ladder?.speed) || 120);\n    const climbDir = (keys.w ? -1 : 0) + (keys.s ? 1 : 0);\n    if (climbDir !== 0) {\n      const proposedY = y + (climbDir * ladderSpeed) * (physicsDt / 1000);\n      if (!checkCollisionExtended(x, proposedY, mapWidth, mapHeight, width, height)) {\n        y = proposedY;\n      }\n      animation = 'climb';\n    }\n    vy = 0;\n    isGrounded = false;\n    vp = { y, vy, isGrounded, animation, inWater: false, headUnderWater: false, atSurface: false };\n  } else {\n    while (remaining > 0 && steps < 10) {\n      const stepMs = Math.min(16.67, remaining);\n      vp = applyVerticalPhysics({\n        keys,\n        x,\n        y,\n        vy,\n        isGrounded,\n        animation,\n        GRAVITY,\n        TERMINAL_VELOCITY,\n        JUMP_FORCE,\n        TILE_SIZE,\n        width,\n        height,\n        mapWidth,\n        mapHeight,\n        checkCollision: checkCollisionExtended,\n        vx,\n        isLiquidAt: (wx, wy) => {\n          try { return typeof isLiquidAt === 'function' ? isLiquidAt(wx, wy) : null; } catch { return null; }\n        },\n        prevInWater,\n        deltaMs: stepMs\n      });\n      y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n      prevInWater = !!vp.inWater;\n      remaining -= stepMs;\n      steps++;\n    }\n  }\n  const inWater = !!(vp ? vp.inWater : gameState.current.inWater);\n  const headUnderWater = !!(vp ? vp.headUnderWater : gameState.current.headUnderWater);\n  const atSurface = !!(vp ? vp.atSurface : gameState.current.atSurface);\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else if (liquidType === 'quicksand') {\n      vx *= 0.72; // Quicksand is very thick\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n    const resourceParams = liquidParams?.resources || {};\n    const parseNumber = (v) => (v === null || v === undefined || v === '') ? null : Number(v);\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = resourceParams.oxygen || liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = resourceParams.lavaResist || liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n    const iceParams = resourceParams.iceResist;\n    const strengthParams = resourceParams.strength;\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    const oxygenApplies = !!(resourceParams.oxygen || liquidType === 'water' || liquidType === 'quicksand' || liquidType === 'radioactive_water' || liquidType === 'waterfall' || liquidType === 'radioactive_waterfall');\n    const oxygenEnabled = oxyParams?.enabled !== false;\n    const oxyDrain = parseNumber(oxyParams?.drainPerSecond);\n    const oxyRegen = parseNumber(oxyParams?.regenPerSecond);\n    if (oxygenEnabled && headUnderWater && oxygenApplies && Number.isFinite(oxyDrain)) {\n      oxy -= (Math.max(0, oxyDrain) * dt) / 1000;\n    } else if (oxygenEnabled) {\n      oxy += (Math.max(0, Number.isFinite(oxyRegen) ? oxyRegen : 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resist depletion while in lava; regenerates outside\n    const lavaApplies = !!(resourceParams.lavaResist || liquidType === 'lava' || liquidType === 'lava_waterfall');\n    const lavaEnabled = lavaParams?.enabled !== false;\n    const lavaDrain = parseNumber(lavaParams?.drainPerSecond);\n    const lavaRegen = parseNumber(lavaParams?.regenPerSecond);\n    if (lavaEnabled && lavaApplies && liquidType && liquidType.includes('lava') && Number.isFinite(lavaDrain)) {\n      lavaRes -= (Math.max(0, lavaDrain) * dt) / 1000;\n    } else if (lavaEnabled) {\n      lavaRes += (Math.max(0, Number.isFinite(lavaRegen) ? lavaRegen : 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Ice resist & strength can be optionally affected by liquids\n    const applyResource = (key, maxKey, params) => {\n      if (!params || params.enabled === false) return;\n      const drain = parseNumber(params.drainPerSecond);\n      const regen = parseNumber(params.regenPerSecond);\n      if (!Number.isFinite(drain) && !Number.isFinite(regen)) return;\n      const maxVal = Math.max(1, Number(gameState.current[maxKey] || 100));\n      let cur = Number(gameState.current[key]);\n      if (!Number.isFinite(cur)) cur = maxVal;\n      if (inWater || liquidType) {\n        if (Number.isFinite(drain)) cur -= (Math.max(0, drain) * dt) / 1000;\n      } else if (Number.isFinite(regen)) {\n        cur += (Math.max(0, regen) * dt) / 1000;\n      }\n      cur = Math.max(0, Math.min(maxVal, cur));\n      gameState.current[key] = cur;\n      gameState.current[maxKey] = maxVal;\n    };\n\n    applyResource('iceResist', 'maxIceResist', iceParams);\n    applyResource('strength', 'maxStrength', strengthParams);\n\n    // Radioactivity: fills up in radioactive liquid; slowly returns to 20% outside\n    const weatherNow = getMapWeather(mapData);\n    const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n    const fogActive = weatherAffectsPlayer('radioactiveFog') && radioFogInt > 0;\n    const maxRadio = Math.max(1, Number(gameState.current.maxRadioactivity || 100));\n    let radio = Number(gameState.current.radioactivity);\n    if (!Number.isFinite(radio)) radio = maxRadio * 0.2;\n\n    const radioParams = resourceParams.radioactivity;\n    const radioEnabled = radioParams?.enabled !== false;\n    const radioBaseline = Number.isFinite(parseNumber(radioParams?.baselinePercent)) ? Math.max(0, Math.min(1, parseNumber(radioParams?.baselinePercent))) : 0.2;\n    const radioGain = Number.isFinite(parseNumber(radioParams?.gainPerSecond)) ? Math.max(0, parseNumber(radioParams?.gainPerSecond)) : (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall' ? 15 : 0);\n    const radioDecay = Number.isFinite(parseNumber(radioParams?.decayPerSecond)) ? Math.max(0, parseNumber(radioParams?.decayPerSecond)) : 5;\n    const radioRecover = Number.isFinite(parseNumber(radioParams?.recoverPerSecond)) ? Math.max(0, parseNumber(radioParams?.recoverPerSecond)) : 2;\n    const radioApplies = !!(radioParams || liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall');\n\n    if (radioEnabled && radioApplies && (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall')) {\n      radio += (radioGain * dt) / 1000; \n    } else if (radioEnabled && !fogActive) {\n      const baseline = maxRadio * radioBaseline;\n      if (radio > baseline) {\n        radio -= (radioDecay * dt) / 1000;\n      } else if (radio < baseline) {\n        radio += (radioRecover * dt) / 1000;\n      }\n    }\n\n    // Radioactivity resource changes from fog (deplete while fog is active)\n    if (weatherAffectsPlayer('radioactiveFog')) {\n      const rates = getRadioactivityRates();\n      if (radioFogInt > 0 && rates.increase > 0) {\n        const dec = (radioFogInt / 100) * rates.increase * (dt / 1000);\n        radio -= dec;\n      } else if (radioFogInt <= 0 && rates.decay > 0 && !fogActive) {\n        const inc = rates.decay * (dt / 1000);\n        radio += inc;\n      }\n    }\n\n    radio = Math.max(0, Math.min(maxRadio, radio));\n    gameState.current.radioactivity = radio;\n    gameState.current.maxRadioactivity = maxRadio;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && oxygenApplies) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if ((liquidType === 'lava' || liquidType === 'lava_waterfall') && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n\n    // Weather damage (Lava Rain, Radioactive Fog)\n    const weather = weatherNow || getMapWeather(mapData);\n    const lavaRainInt = Number(weather.lavaRain || 0);\n\n    let lavaDps = weatherAffectsPlayer('lavaRain') ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    const radioDps = weatherAffectsPlayer('radioactiveFog') ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && (inWater || (liquidType && liquidType.includes('water')))) {\n      lavaDps = 0;\n    }\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = backgroundLayer;\n        const secretData = secretLayer;\n        const covered = isCoveredFromAbove({\n          x: x + width / 2,\n          y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems: ctx.registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const effectiveRadioDps = (radioDps > 0 && Number(radio) <= 0) ? radioDps : 0;\n    const totalWeatherDps = lavaDps + effectiveRadioDps;\n\n    if (totalWeatherDps > 0) {\n      weatherDamageAccRef.current += dt;\n      if (weatherDamageAccRef.current >= 1000) {\n        weatherDamageAccRef.current -= 1000;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - totalWeatherDps);\n        const HIT_FLASH_MS = 500;\n        gameState.current.hitTimerMs = Math.max(Number(gameState.current.hitTimerMs) || 0, HIT_FLASH_MS);\n        if (actions.onStateUpdate) {\n          actions.onStateUpdate('playerDamage', {\n            damage: totalWeatherDps,\n            x: x + width / 2,\n            y\n          });\n        }\n      }\n    } else {\n      weatherDamageAccRef.current = 0;\n    }\n\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  const healthEnabled = resourceParams?.health?.enabled !== false;\n  const healthDpsOverride = (healthEnabled && resourceParams?.health && resourceParams.health.damagePerSecond !== null && resourceParams.health.damagePerSecond !== undefined)\n    ? Number(resourceParams.health.damagePerSecond)\n    : null;\n  const effectiveDps = Number.isFinite(healthDpsOverride) ? Math.max(0, healthDpsOverride) : Number(liquidParams?.dps);\n  if (liquidType && liquidParams && Number(effectiveDps) > 0) {\n    try {\n      if (liquidType && liquidType.includes('lava')) {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection and triggers\n  // Sync moved state to Ref so triggers can see it and modify it (Teleport, Knockback, etc.)\n  gameState.current.x = x;\n  gameState.current.y = y;\n  gameState.current.vx = vx;\n  gameState.current.vy = vy;\n  gameState.current.isGrounded = isGrounded;\n  gameState.current.animation = animation;\n\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, mapHeight, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // Sync back from Ref in case triggers changed something\n  x = gameState.current.x;\n  y = gameState.current.y;\n  vx = gameState.current.vx;\n  vy = gameState.current.vy;\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0 && mapType !== 'sea_rescue') {\n    const originX = x + (direction >= 0 ? width + 4 : -4);\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1, 'player');\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 5.5) Update entities (tanks etc.)\n  try {\n    updateEntities({\n      entitiesRef,\n      projectilesRef: refs.projectilesRef,\n      gameState,\n      mapData,\n      objectData,\n      mapWidth,\n      mapHeight,\n      TILE_SIZE,\n      checkCollision,\n      isLiquidAt,\n      getLiquidSample,\n      spawnProjectile,\n      playSfx,\n      constants,\n      registryItems: ctx.registryItems,\n      onStateUpdate: actions.onStateUpdate,\n      activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n    }, Math.min(dt, 100)); // Ierobeojam deltaMs uz 100ms, lai izvairtos no milzgiem lcieniem\n    \n    // Sinhronizjam loklos maingos pc enttiju (platformu) ietekmes\n    x = gameState.current.x;\n    y = gameState.current.y;\n    vx = gameState.current.vx;\n    vy = gameState.current.vy;\n    isGrounded = gameState.current.isGrounded;\n    animation = gameState.current.animation;\n\n    if (checkSecrets && entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n          try { checkSecrets(ent.x, ent.y, ent.width, ent.height, mapWidth, mapHeight); } catch {}\n        }\n      }\n    }\n    \n    // Kontaktbojjumi no enttijm\n    const player = gameState.current;\n    if (entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        \n        // AABB prbaude\n        const hit = (\n          player.x < ent.x + ent.width &&\n          player.x + player.width > ent.x &&\n          player.y < ent.y + ent.height &&\n          player.y + player.height > ent.y\n        );\n        \n        if (hit && Number(player.hitTimerMs) <= 0) {\n          // Pievienojam nelielu atgrdienu (knockback)\n          const knockbackDir = player.x + player.width / 2 < ent.x + ent.width / 2 ? -1 : 1;\n          gameState.current.vx = knockbackDir * 5;\n          gameState.current.vy = -3;\n          \n          // Iestatm bezsmertbas periodu un vizulo flash\n          gameState.current.hitTimerMs = 500;\n          \n          // Samazinm spltja veselbu\n          gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - 10);\n          \n          if (actions.onStateUpdate) {\n            actions.onStateUpdate('playerDamage', { damage: 10, x: player.x + player.width / 2, y: player.y });\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"Entity update failed:\", e);\n  }\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Win and Death check\n  if (gameState.current.isWinning) {\n    gameState.current.winCounter = (gameState.current.winCounter || 0) + (gameState.current.winCountSpeed || 10) * (deltaMs / 100);\n    if (gameState.current.winCounter >= 100) {\n      gameState.current.winCounter = 100;\n      // Trigger level win event if needed\n      if (actions.onStateUpdate) actions.onStateUpdate('levelWin');\n    }\n  }\n\n  if ((Number(gameState.current.health) || 0) <= 0 || y > mapHeight * TILE_SIZE + 300) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  if (!prevInWaterFrame && inWater) {\n    gameState.current.lastWaterEnter = {\n      x: x + width / 2,\n      y: y + height / 2,\n      time: Number(timestamp) || 0\n    };\n  }\n\n  if (actions.playSfx) {\n    const playerDef = getDefById('player');\n    if (playerDef?.sounds?.water_out && prevInWaterFrame && !inWater) {\n      try { actions.playSfx(playerDef.sounds.water_out, 0.35); } catch {}\n    } else if (playerDef?.sounds?.water_in && !prevInWaterFrame && inWater) {\n      try { actions.playSfx(playerDef.sounds.water_in, 0.35); } catch {}\n    }\n  }\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    timeMs: Number(timestamp) || 0,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null,\n    liquidOverlay: liquidParams?.overlay || null,\n    onIce: isSlippery\n  };\n\n  // Floating text deltas for player resources\n  if (actions.onStateUpdate) {\n    const floatState = gameState.current.floatingText || { prev: {}, acc: {} };\n    const resources = [\n      { key: 'health', color: '#ff3b3b' },\n      { key: 'oxygen', color: '#2ecdf1' },\n      { key: 'lavaResist', color: '#ffcc00' },\n      { key: 'iceResist', color: '#a5f3fc' },\n      { key: 'strength', color: '#8b5a2b' },\n      { key: 'radioactivity', color: '#32cd32' }\n    ];\n    const baseX = x + width / 2;\n    const baseY = y - 6;\n\n    resources.forEach((res, idx) => {\n      const cur = Number(gameState.current[res.key]) || 0;\n      if (!Number.isFinite(floatState.prev[res.key])) {\n        floatState.prev[res.key] = cur;\n        floatState.acc[res.key] = 0;\n        return;\n      }\n      const diff = cur - floatState.prev[res.key];\n      if (diff !== 0) {\n        floatState.acc[res.key] = (floatState.acc[res.key] || 0) + diff;\n        if (Math.abs(floatState.acc[res.key]) >= 1) {\n          const amt = Math.round(floatState.acc[res.key]);\n          floatState.acc[res.key] -= amt;\n          const sign = amt > 0 ? '+' : '';\n          actions.onStateUpdate('floatingText', {\n            x: baseX + (idx - 2.5) * 6,\n            y: baseY,\n            text: `${sign}${amt}`,\n            color: res.color,\n            amount: amt\n          });\n        }\n      }\n      floatState.prev[res.key] = cur;\n    });\n\n    gameState.current.floatingText = floatState;\n  }\n\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\nexport const MAX_ICE_RESIST = 100;\nexport const MAX_RADIOACTIVITY = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles, handleWeatherEffectHit } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal, getSurfaceProperties } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST,\n    MAX_ICE_RESIST,\n    MAX_RADIOACTIVITY\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret, objectMetadata\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret, objectMetadata, activeRoomIds, mapWidth, mapHeight) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        fishCount: 0,\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        iceResist: MAX_ICE_RESIST,\n        maxIceResist: MAX_ICE_RESIST,\n        radioactivity: MAX_RADIOACTIVITY * 0.2, // 20% default\n        maxRadioactivity: MAX_RADIOACTIVITY,\n        strength: 30,\n        maxStrength: 100,\n        lastPushTime: 0,\n        isWinning: false,\n        winCounter: 0,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n    const weatherDamageAccRef = useRef(0);                // Weather damage DPS accumulator\n    const entitiesRef = useRef([]);                        // Active moving entities (tanks, etc.)\n\n    // Refs for props to avoid stale closures in the game loop\n    const onStateUpdateRef = useRef(onStateUpdate);\n    const onRevealSecretRef = useRef(onRevealSecret);\n    const onGameOverRef = useRef(onGameOver);\n    const objectMetadataRef = useRef(objectMetadata);\n    const revealedSecretsRef = useRef(revealedSecrets);\n    const activeRoomIdsRef = useRef(activeRoomIds);\n    const mapWidthRef = useRef(mapWidth);\n    const mapHeightRef = useRef(mapHeight);\n    const tileDataRef = useRef(tileData);\n    const objectDataRef = useRef(objectData);\n    const secretDataRef = useRef(secretData);\n\n    useEffect(() => { onStateUpdateRef.current = onStateUpdate; }, [onStateUpdate]);\n    useEffect(() => { onRevealSecretRef.current = onRevealSecret; }, [onRevealSecret]);\n    useEffect(() => { onGameOverRef.current = onGameOver; }, [onGameOver]);\n    useEffect(() => { objectMetadataRef.current = objectMetadata; }, [objectMetadata]);\n    useEffect(() => { revealedSecretsRef.current = revealedSecrets; }, [revealedSecrets]);\n    useEffect(() => { activeRoomIdsRef.current = activeRoomIds; }, [activeRoomIds]);\n    useEffect(() => { mapWidthRef.current = mapWidth; }, [mapWidth]);\n    useEffect(() => { mapHeightRef.current = mapHeight; }, [mapHeight]);\n    useEffect(() => { tileDataRef.current = tileData; }, [tileData]);\n    useEffect(() => { objectDataRef.current = objectData; }, [objectData]);\n    useEffect(() => { secretDataRef.current = secretData; }, [secretData]);\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        const isInsideRoom = activeRoomIdsRef.current && activeRoomIdsRef.current.length > 0;\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume);\n    };\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Weather effects impact handling (meteors, etc.)\n    const handleWeatherEffectHitWrapper = (type, data) => {\n        handleWeatherEffectHit(type, data, {\n            gameState,\n            entitiesRef,\n            TILE_SIZE,\n            onBreakEffect: (detail) => {\n                window.dispatchEvent(new CustomEvent('game-break-effect', { detail }));\n            }\n        });\n    };\n\n    // Listen for weather effect hits from the UI/Renderer\n    useEffect(() => {\n        const onHit = (e) => {\n            if (e && e.detail) {\n                handleWeatherEffectHitWrapper(e.detail.type, e.detail.data);\n            }\n        };\n        window.addEventListener('weather-effect-hit', onHit);\n        return () => window.removeEventListener('weather-effect-hit', onHit);\n    }, []);\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecretRef.current) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecretsRef.current || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecretRef.current(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    const lastMapIdRef = useRef(null);\n\n    // Initialize player at starting position\n    useEffect(() => {\n        if (!mapData) {\n            isInitialized.current = false;\n            lastMapIdRef.current = null;\n            return;\n        }\n\n        // Unique identifier for the map session\n        // We include projectName and timestamps to distinguish between different projects \n        // that might use the same activeMapId (like \"main\")\n        const meta = mapData.meta || {};\n        const projectName = meta.projectName || '';\n        const mapId = meta.activeMapId || mapData.name || 'default';\n        const timestamp = meta.date_map_last_updated || meta.date_map_created_at || '';\n        \n        // Use a unique ID that changes on map load or restart\n        const currentMapId = `${projectName}|${mapId}|${timestamp}`;\n        const isNewMapLoad = currentMapId !== lastMapIdRef.current;\n\n        // Ja sple jau ir inicializta UN t ir t pati karte, nemainm spltja pozciju\n        // Tas novr \"reset\" uz skumu, kad spltjs pace itemu vai mains laikapstki\n        if (isInitialized.current && !isNewMapLoad) return;\n\n        lastMapIdRef.current = currentMapId;\n\n        // Reset state for new initialization\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        entitiesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapWidth || mapData.meta?.width || mapData.width || 20;\n            const mapH = mapHeight || mapData.meta?.height || mapData.height || 15;\n            \n            // Search for entities in objectData\n            const initialEntities = [];\n            if (objectData && Array.isArray(objectData)) {\n                objectData.forEach((id, idx) => {\n                    if (id && !id.includes('player')) {\n                        const def = findItemById(id) || registryItems.find(r => r.id === id);\n                        const isEntity = def && (\n                            def.type === 'entity' || \n                            def.subtype === 'tank' || \n                            def.subtype === 'platform' ||\n                            def.isPushable ||\n                            (def.name && def.name.toLowerCase().includes('entities.'))\n                        );\n\n                        if (isEntity) {\n                            initialEntities.push({\n                                id: `entity_${idx}_${Date.now()}_${idx}`,\n                                defId: id,\n                                def: def,\n                                x: (idx % mapW) * TILE_SIZE,\n                                y: Math.floor(idx / mapW) * TILE_SIZE,\n                                width: (Number(def.width) || 1) * TILE_SIZE,\n                                height: (Number(def.height) || 1) * TILE_SIZE,\n                                vx: 0,\n                                vy: 0,\n                                health: def.maxHealth || 100,\n                                direction: def.subtype === 'platform' ? 1 : (def.isPushable ? 1 : -1),\n                                animation: (def.subtype === 'platform' || def.isPushable) ? 'idle' : 'move',\n                                animFrame: 0,\n                                animTimer: 0,\n                                isGrounded: false,\n                                shootCooldown: 0,\n                                currentSpriteIndex: 0,\n                                subtype: def.subtype || (def.isPushable ? 'pushable' : null),\n                                rotation: def.isRound ? 0 : undefined\n                            });\n                        }\n                    }\n                });\n            }\n            entitiesRef.current = initialEntities;\n\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // 1. Priority: spawnTriggerId hint (from inter-map teleport)\n                const spawnTriggerId = mapData.meta?.spawnTriggerId;\n                let startIndex = -1;\n\n                if (spawnTriggerId !== undefined && spawnTriggerId !== null) {\n                    startIndex = objLayer.data.findIndex((id, idx) => {\n                        if (!id || (!id.includes('target') && id !== 'portal_target')) return false;\n                        const meta = objectMetadataRef.current?.[idx] || mapData.meta?.objectMetadata?.[idx];\n                        return meta && meta.triggerId === spawnTriggerId;\n                    });\n                }\n\n                // 2. Fallback: Search for player (anything containing 'player')\n                if (startIndex === -1) {\n                    startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n                }\n\n                if (startIndex !== -1 || mapData.meta?.activeMapType === 'sea_rescue') {\n                    let startX = startIndex !== -1 ? (startIndex % mapW) * TILE_SIZE : 0;\n                    let startY = startIndex !== -1 ? Math.floor(startIndex / mapW) * TILE_SIZE : 0;\n\n                    // Get data from registry\n                    const playerId = startIndex !== -1 ? objLayer.data[startIndex] : \"player\";\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    \n                    if (mapData.meta?.activeMapType === 'sea_rescue') {\n                        // For sea rescue, we might want a different starting position or dummy player\n                        // Let's use the playerPosition from meta if available\n                        if (mapData.meta?.playerPosition) {\n                            startX = mapData.meta.playerPosition.x * TILE_SIZE;\n                            startY = mapData.meta.playerPosition.y * TILE_SIZE;\n                        }\n                    }\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    const prevAmmo = Math.max(0, Number(gameState.current?.ammo) || 0);\n                    const prevFishCount = Math.max(0, Number(gameState.current?.fishCount) || 0);\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: prevAmmo,\n                        fishCount: prevFishCount,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: Number(registryPlayer?.strength) || 30,\n                        maxStrength: Number(registryPlayer?.maxStrength) || 100,\n                        lastPushTime: 0,\n                        isWinning: false,\n                        winCounter: 0\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    const pW = gameState.current.width || TILE_SIZE;\n                    const pH = gameState.current.height || TILE_SIZE;\n                    while (checkCollision(gameState.current.x, gameState.current.y, undefined, undefined, pW, pH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: 30,\n                        maxStrength: 100,\n                        lastPushTime: 0\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST,\n                    radioactivity: MAX_RADIOACTIVITY * 0.2,\n                    maxRadioactivity: MAX_RADIOACTIVITY,\n                    strength: 30,\n                    maxStrength: 100,\n                    lastPushTime: 0\n                };\n                setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]); // objectData removed - item collection shouldn't trigger re-initialization\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mw, mh, w, h, ignoreEntityId) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE,\n            tileDataRef.current || tileData,\n            registryItems,\n            w !== undefined ? w : gameState.current.width,\n            h !== undefined ? h : gameState.current.height,\n            secretDataRef.current || secretData,\n            objectDataRef.current || objectData,\n            objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreEntityId || null,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mw, mh, TILE_SIZE_OVERRIDE, tileDataOverride, registryItemsOverride, secretDataOverride, objectDataOverride, objectMetadataOverride, ignoreId) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE_OVERRIDE || TILE_SIZE,\n            tileDataOverride || tileDataRef.current || tileData,\n            registryItemsOverride || registryItems,\n            secretDataOverride || secretDataRef.current || secretData,\n            objectDataOverride || objectDataRef.current || objectData,\n            objectMetadataOverride || objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreId,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // New: liquid type check at a world pixel\n    const getLiquidTypeAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        const liq = getLiquidAtPixel(wx, wy, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileData, registryItems);\n        return liq ? liq.type : null;\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthRef.current || 20,\n            mapHeight: mapHeightRef.current || 15,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction, ownerId = 'player') => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction, ownerId);\n    };\n\n    const engineRefs = useRef({ \n        gameState, \n        isInitialized, \n        lastTimeRef, \n        projectilesRef, \n        entitiesRef, \n        shootCooldownRef, \n        liquidDamageAccumulatorRef, \n        oxygenDepleteAccRef, \n        lavaDepleteAccRef, \n        weatherDamageAccRef, \n        activeRoomIdsRef,\n        projectileIdRef,\n        objectMetadata: objectMetadataRef,\n        cameraRef: { x: 0, y: 0 },\n        seaRescueRef: null,\n        fx: {\n            triggerSplash: null,\n            triggerBubbles: null\n        },\n        helpers: { findItemById, isSolidAtPixel }\n    });\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData: objectDataRef.current,\n            input,\n            refs: engineRefs.current,\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            registryItems,\n            helpers: {\n                checkCollision,\n                isSolidAtPixel,\n                findItemById,\n                getSurfaceProperties: (x, y, w, h) => getSurfaceProperties(x, y, w, h, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileDataRef.current, registryItems, secretDataRef.current, objectMetadataRef.current || mapData?.meta?.objectMetadata, mapData?.maps, activeRoomIdsRef.current || mapData?.meta?.activeRoomIds),\n                isLiquidAt: (wx, wy) => getLiquidTypeAtPixel(wx, wy),\n                getLiquidSample: ({ x, y, width, height }) =>\n                    sampleLiquid({ x, y, width, height })\n            },\n            actions: {\n                collectItem: (x, y, mw, objectLayer) =>\n                collectItem({\n                    registryItems,\n                    TILE_SIZE,\n                    MAX_HEALTH,\n                    playShotSfx,\n                    onStateUpdate: onStateUpdateRef.current,\n                    gameState,\n                    maps: mapData?.maps,\n                    activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n                    objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata,\n                    secretMapData: secretDataRef.current || secretData,\n                    activeMapId: mapData?.meta?.activeMapId || mapData?.meta?.activeMap || 'main'\n                }, x, y, mapWidthRef.current || 20, objectDataRef.current),\n                checkInteractables: (x, y, mw, mh, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState, mapData, input, activeRoomIds: activeRoomIdsRef.current, objectMetadata: objectMetadataRef.current, secretMapData: secretDataRef.current || secretData }, x, y, mapWidthRef.current || 20, mapHeightRef.current || 15, objectDataRef.current),\n                checkHazardDamage: (x, y, mw, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidthRef.current || 20, objectDataRef.current, deltaMs),\n                checkSecrets: (x, y, width, height, mw, mh) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                spawnProjectile: (originX, originY, direction, ownerId) =>\n                    spawnProjectile(originX, originY, direction, ownerId),\n                playSfx: (url, volume) => playShotSfx(url, volume),\n                updateProjectiles: (deltaMs, mw, mh) =>\n                    updateProjectiles({ \n                        projectilesRef, \n                        entitiesRef,\n                        playerState: gameState.current,\n                        TILE_SIZE, \n                        isSolidAtPixel, \n                        findItemById, \n                        objectData: objectDataRef.current, \n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata, \n                        tileData: tileDataRef.current || tileData,\n                        secretData: secretDataRef.current || secretData,\n                        registryItems,\n                        onStateUpdate: onStateUpdateRef.current,\n                        playSfx: playShotSfx,\n                        getLiquidSample: (args) => sampleLiquid(args),\n                        refs: engineRefs.current,\n                        mapData\n                    }, deltaMs, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                onStateUpdate: onStateUpdateRef.current,\n                setPlayer: (next) => setPlayer(next),\n                onGameOver: onGameOverRef.current\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        if (!mapData) return;\n        requestRef.current = requestAnimationFrame(update);\n        return () => {\n            if (requestRef.current) cancelAnimationFrame(requestRef.current);\n        };\n    }, [mapData]); // Restart loop ONLY if map changes, not objects\n\n    return { player, input, engineRefs: engineRefs.current };\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false,\n        mousePos: { x: 0, y: 0 },\n        e: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n            keys.current.e = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'KeyE':\n                    keys.current.e = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'KeyE':\n                    keys.current.e = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const handleMouseMove = (e) => {\n            keys.current.mousePos.x = e.clientX;\n            keys.current.mousePos.y = e.clientY;\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n        window.addEventListener('mousemove', handleMouseMove, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n            window.removeEventListener('mousemove', handleMouseMove, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","import { getMeteorBreakEffectConfig } from './meteorBreakEffects';\nimport { getBiologicalBreakEffectConfig } from './biologicalBreakEffects';\n\n/**\n * Handles weather effect impacts like meteor strikes, lightning, etc.\n * This logic is decoupled from useGameEngine to allow for easier expansion.\n */\nexport const handleWeatherEffectHit = (type, data, context) => {\n    if (!type || !data || !context) return;\n    const { gameState, entitiesRef, onBreakEffect } = context;\n\n    if (type === 'meteor') {\n        const { x, y, size, isLarge, surfaceType } = data;\n        const damage = isLarge ? 40 : 20;\n        const radius = size * 1.5;\n\n        // 1. Check player impact\n        if (gameState && gameState.current) {\n            const p = gameState.current;\n            const dx = (p.x + p.width / 2) - x;\n            const dy = (p.y + p.height / 2) - y;\n            const dist = Math.sqrt(dx * dx + dy * dy);\n\n            if (dist < radius + p.width / 2) {\n                gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - damage);\n                gameState.current.hitTimerMs = 500;\n                // Add knockback\n                if (dist > 0) {\n                    gameState.current.vx += (dx / dist) * 10;\n                    gameState.current.vy -= 5;\n                } else {\n                    gameState.current.vy -= 10; // direct hit\n                }\n            }\n        }\n\n        // 2. Check entities impact\n        if (entitiesRef && entitiesRef.current) {\n            entitiesRef.current.forEach(ent => {\n                const isFish = ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish;\n                const edx = (ent.x + ent.width / 2) - x;\n                const edy = (ent.y + ent.height / 2) - y;\n                const edist = Math.sqrt(edx * edx + edy * edy);\n\n                const prevHealth = Number(ent.health) || 0;\n                const inDamageRadius = edist < radius + ent.width / 2;\n                if (inDamageRadius) {\n                    ent.health = Math.max(0, prevHealth - damage);\n                    // Platforms don't take knockback, but others might\n                    if (ent.subtype !== 'platform') {\n                        if (edist > 0) {\n                            ent.vx += (edx / edist) * 8;\n                            ent.vy -= 3;\n                        } else {\n                            ent.vy -= 6;\n                        }\n                    }\n                }\n\n                if (isFish) {\n                    const cfg = ent.def?.fish || {};\n                    const shockRadius = (Number(cfg.meteorShockRadius) || 0) * (context?.TILE_SIZE || 32);\n                    if (shockRadius > 0 && edist <= shockRadius) {\n                        ent.fishState = ent.fishState || {};\n                        ent.fishState.shockUntil = (Number(gameState?.current?.timeMs) || 0) + (Number(cfg.meteorShockDurationMs) || 1800);\n                    }\n                    const wasDead = prevHealth <= 0;\n                    if (wasDead && ent.health <= 0 && inDamageRadius) {\n                        const now = Number(gameState?.current?.timeMs) || 0;\n                        ent.fishState = ent.fishState || {};\n                        const lastFx = Number(ent.fishState.lastBioFxAt) || 0;\n                        const alreadyQueued = !!ent.fishState.removeOnNext;\n                        if (!alreadyQueued && now - lastFx > 200) {\n                            const bioConfig = getBiologicalBreakEffectConfig();\n                            if (bioConfig && typeof onBreakEffect === 'function') {\n                                onBreakEffect({ x: ent.x + ent.width / 2, y: ent.y + ent.height / 2, config: bioConfig });\n                            }\n                            ent.fishState.lastBioFxAt = now;\n                            ent.fishState.removeOnNext = true;\n                        }\n                    }\n                }\n            });\n        }\n\n        const breakConfig = getMeteorBreakEffectConfig({ size, surfaceType });\n        if (breakConfig && typeof onBreakEffect === 'function') {\n            onBreakEffect({ x, y, config: breakConfig });\n        }\n    }\n\n    // Future weather types can be added here\n    // e.g., if (type === 'lightning') { ... }\n};\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction, ownerId = 'player') {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    ownerId, // Tagad ms zinm, kur izva\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag,\n    dmg: pDef?.damage || 10\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx, getLiquidSample, refs, mapData }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx, getLiquidSample, refs, mapData } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n  const nowMs = Number(playerState?.timeMs) || 0;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n\n    const shipOffset = (playerState && (mapData?.meta?.activeMapType === 'sea_rescue' || \n                         (mapData?.maps && mapData.maps[mapData.meta?.activeMapId || 'main']?.type === 'sea_rescue'))) \n                       ? (playerState.x || 0) : 0;\n\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n      \n      if (shipOffset !== 0) {\n        if (isSolidAtPixel(pt.x - shipOffset, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n      }\n    }\n    return false;\n  };\n\n  const checkObjectHit = (cx, cy, hw, hh, isSeaRescueBox = false) => {\n    if (!objectData) return null;\n    const pts = [\n        { x: cx - hw, y: cy - hh },\n        { x: cx + hw, y: cy - hh },\n        { x: cx - hw, y: cy + hh },\n        { x: cx + hw, y: cy + hh },\n        { x: cx, y: cy }\n    ];\n\n    const shipOffset = (playerState && (mapData.meta?.activeMapType === 'sea_rescue' || \n                         (mapData.maps && mapData.maps[mapData.meta?.activeMapId || 'main']?.type === 'sea_rescue'))) \n                       ? (playerState.x || 0) : 0;\n\n    for (const pt of pts) {\n        // 1. Check static objects (Boxes in water)\n        const gx = Math.floor(pt.x / TILE_SIZE);\n        const gy = Math.floor(pt.y / TILE_SIZE);\n        if (gx >= 0 && gy >= 0 && gx < mapWidth && gy < mapHeight) {\n            const index = gy * mapWidth + gx;\n            const objId = objectData[index];\n            if (objId && objId.startsWith('minispill_sea_rescue_box')) {\n                const def = findItemById(objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata?.[index] || {};\n                    const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                    if (health > (def.passableHealthThreshold || 0)) return index;\n                }\n            }\n        }\n\n        // 2. Check moving objects (Ship & Triggers)\n        const sgx = Math.floor((pt.x - shipOffset) / TILE_SIZE);\n        const sgy = Math.floor(pt.y / TILE_SIZE);\n        if (sgx >= 0 && sgy >= 0 && sgx < mapWidth && sgy < mapHeight) {\n            const sindex = sgy * mapWidth + sgx;\n            const sobjId = objectData[sindex];\n            if (sobjId === 'minispill_sea_rescue_trigger' || sobjId === 'minispill_sea_rescue_ship') {\n                if (isSeaRescueBox && sobjId === 'minispill_sea_rescue_trigger') {\n                    return sindex;\n                }\n                const def = findItemById(sobjId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata?.[sindex] || {};\n                    const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                    if (health > (def.passableHealthThreshold || 0)) return sindex;\n                }\n            }\n        }\n    }\n    return null;\n  };\n\n  const checkEntityHit = (cx, cy, hw, hh, p) => {\n    if (!entitiesRef?.current) return null;\n    for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.id === p.ownerId) continue; // Ignorjam izvju\n\n        const ex = ent.x;\n        const ey = ent.y;\n        const ew = ent.width;\n        const eh = ent.height;\n        if (cx + hw > ex && cx - hw < ex + ew &&\n            cy + hh > ey && cy - hh < ey + eh) {\n            return ent;\n        }\n    }\n    return null;\n  };\n\n  const checkPlayerHit = (cx, cy, hw, hh, p) => {\n    if (!playerState || p.ownerId === 'player') return false; // Ignorjam, ja izva spltjs\n    \n    const ex = playerState.x;\n    const ey = playerState.y;\n    const ew = playerState.width || TILE_SIZE;\n    const eh = playerState.height || TILE_SIZE;\n    if (cx + hw > ex && cx - hw < ex + ew &&\n        cy + hh > ey && cy - hh < ey + eh) {\n        return true;\n    }\n    return false;\n  };\n\n  const getWaterSurfaceY = (x) => {\n    if (!tileData || mapWidth <= 0 || mapHeight <= 0) return null;\n    const gx = Math.floor(x / TILE_SIZE);\n    if (gx < 0 || gx >= mapWidth) return null;\n    for (let gy = 0; gy < mapHeight; gy++) {\n      const idx = gy * mapWidth + gx;\n      const id = tileData[idx];\n      if (!id) continue;\n      const def = findItemById(id);\n      if (!def || !def.flags || !def.flags.liquid) continue;\n      if (def.flags.water || def.flags.waterfall) {\n        return gy * TILE_SIZE;\n      }\n    }\n    return null;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    let removed = false;\n\n    if (p.isSeaRescueBox) {\n      const settings = findItemById('sea_rescue_settings')?.physics || {};\n      const maxHeight = settings.maxFlightHeight || -10000;\n      // Boundaries check for sea rescue boxes - allow much more space\n      if (cx < -p.w - 1000 || cx > worldW + p.w + 1000 || cy < maxHeight || cy > worldH + 2000) {\n        removed = true;\n        projectilesRef.current.splice(i, 1);\n        continue;\n      }\n      if (p.floating) {\n        // Floating/Sinking logic\n        p.floatTime = (p.floatTime || 0) + deltaMs;\n        const boxDef = findItemById(p.defId);\n        const floatMax = boxDef?.floatingDurationMs || 4000;\n        \n        const driftSettings = findItemById('sea_rescue_settings')?.drift || {};\n        const driftSpeed = driftSettings.speed || 0.002;\n        const driftAmp = driftSettings.amplitude || 5;\n\n        if (p.floatTime < floatMax) { // Float for configurable time\n            if (p.baseY === undefined) p.baseY = p.y;\n            const targetY = p.baseY + Math.sin(p.floatTime * driftSpeed) * driftAmp;\n            p.vy = (targetY - p.y) / dtProj;\n            p.vx *= 0.92; // Slow down horizontal movement\n            p.rotation = Math.sin(p.floatTime * driftSpeed * 0.5) * 0.1; // Balanced tilt\n        } else {\n            p.vy = 60; // Start sinking\n            p.vx *= 0.98;\n            p.rotation = (p.rotation || 0) + 0.02;\n        }\n        p.x += p.vx * dtProj;\n        p.y += p.vy * dtProj;\n        \n        p.life -= deltaMs;\n\n        // Remove if off-map or expired\n        if (p.y > worldH + 2000 || p.life <= 0) removed = true;\n        if (removed) {\n            projectilesRef.current.splice(i, 1);\n        }\n        continue; // Skip standard movement\n      }\n\n      if (p.useSimplePhysics) {\n        // Simple physics matching trajectory preview (no friction, constant G)\n        const settings = findItemById('sea_rescue_settings')?.physics || {};\n        const G = p.gravity || settings.gravity || 1600;\n        p.vy += G * dtProj; // Use dtProj here for gravity step\n      } else {\n        p.vy += (p.gravity || 0.5) * 60 * dtProj;\n        p.vx *= (p.friction || 0.98);\n        p.vy *= (p.friction || 0.98);\n      }\n    }\n\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    const isFishEntity = (ent) => {\n      if (!ent) return false;\n      const subtype = ent.subtype || ent.def?.subtype;\n      const aiType = ent.def?.ai?.type;\n      return subtype === 'fish' || aiType === 'fish' || !!ent.def?.fish;\n    };\n\n    for (let s = 0; s < steps; s++) {\n      // Check if entering water (for Sea Rescue Boxes)\n      if (p.isSeaRescueBox && getLiquidSample && !p.floating && p.vy > 0) {\n          const sample = getLiquidSample({ x: cx, y: cy, width: p.w, height: p.h });\n          if (sample?.inLiquid && sample?.type?.includes('water')) {\n              p.floating = true;\n              p.floatTime = 0;\n\n              // Snap to surface for 50/50 visual effect\n              const surfaceY = getWaterSurfaceY(cx);\n              if (surfaceY !== null) {\n                  p.y = surfaceY;\n                  p.baseY = surfaceY;\n                  cy = surfaceY;\n              }\n\n              const inSound = findItemById(p.defId)?.sounds?.water_in || \"/assets/sound/sfx/water/out_splash-4-46870.ogg\";\n              if (playSfx) playSfx(inSound, 0.6);\n              if (refs?.fx?.triggerSplash) refs.fx.triggerSplash(cx, cy);\n              // Stop stepping, but DON'T set removed=true\n              break;\n          }\n      }\n      // Sea Rescue hit detection\n      if (p.isSeaRescueBox) {\n          const objIdx = checkObjectHit(cx, cy, hw, hh, true);\n          if (objIdx !== null) {\n              const hitObjId = objectData[objIdx];\n              if (hitObjId === 'minispill_sea_rescue_trigger' && p.vy > 0) {\n                  const boxDef = findItemById(p.defId);\n                  const points = boxDef?.points || 10;\n                  \n                  if (typeof onStateUpdate === 'function') {\n                      onStateUpdate('SEA_RESCUE_SCORE', { points, triggerIndex: objIdx, boxId: p.defId });\n                  }\n                  \n                  if (typeof playSfx === 'function') {\n                      const collectSfx = \"/assets/sound/sfx/zzox-fx_nite-hit-item.ogg\";\n                      playSfx(collectSfx, 0.7);\n                  }\n                  \n                  removed = true;\n                  break;\n              }\n          }\n      }\n\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n\n      const hitEntX = checkEntityHit(nextX, cy, hw, hh, p);\n      if (hitEntX) {\n        const isFish = isFishEntity(hitEntX);\n        \n        if (p.isSeaRescueBox) {\n            if (isFish) {\n                hitEntX.fishState = hitEntX.fishState || {};\n                const hitCooldown = 500;\n                const canPlaySound = !hitEntX.fishState.lastHitAt || (nowMs - hitEntX.fishState.lastHitAt > hitCooldown);\n                const settings = findItemById('sea_rescue_settings')?.physics || {};\n                const fishJumpImpulse = settings.fishJumpImpulse || -600;\n\n                if (p.vy > 0 && p.y < hitEntX.y) {\n                    hitEntX.health = 0;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntX.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\", 0.5);\n                        hitEntX.fishState.lastHitAt = nowMs;\n                    }\n                } else if (p.vy < 0) {\n                    hitEntX.attachedToProjectileId = p.id;\n                    hitEntX.fishState.isAttached = true;\n                    hitEntX.fishState.isJumping = false; // Stop jumping if attached\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntX.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntX.fishState.lastHitAt = nowMs;\n                    }\n                } else {\n                    hitEntX.fishState.isJumping = true;\n                    hitEntX.fishState.jumpVx = -p.vx * 0.5;\n                    hitEntX.fishState.jumpVy = -Math.abs(p.vy) * 0.5 + fishJumpImpulse;\n                    hitEntX.fishState.jumpGravity = 900;\n                    hitEntX.fishState.panicUntil = nowMs + 5000;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntX.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntX.fishState.lastHitAt = nowMs;\n                    }\n                }\n            }\n            // Sea Rescue boxes should NOT disappear when hitting entities\n            cx = nextX;\n            continue; \n        }\n\n        hitEntX.health -= p.dmg || 10;\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntX.x + hitEntX.width / 2,\n            y: hitEntX.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxX = !p.isSeaRescueBox ? checkObjectHit(nextX, cy, hw, hh) : null;\n      if (hitIdxX !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxX, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      \n      const hitPlayerY = checkPlayerHit(cx, nextY, hw, hh, p);\n      if (hitPlayerY) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntY = checkEntityHit(cx, nextY, hw, hh, p);\n      if (hitEntY) {\n        const isFish = isFishEntity(hitEntY);\n        \n        if (p.isSeaRescueBox) {\n            if (isFish) {\n                hitEntY.fishState = hitEntY.fishState || {};\n                const hitCooldown = 500;\n                const canPlaySound = !hitEntY.fishState.lastHitAt || (nowMs - hitEntY.fishState.lastHitAt > hitCooldown);\n                const settings = findItemById('sea_rescue_settings')?.physics || {};\n                const fishJumpImpulse = settings.fishJumpImpulse || -600;\n\n                if (p.vy > 0 && p.y < hitEntY.y) {\n                    hitEntY.health = 0;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntY.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\", 0.5);\n                        hitEntY.fishState.lastHitAt = nowMs;\n                    }\n                } else if (p.vy < 0) {\n                    hitEntY.attachedToProjectileId = p.id;\n                    hitEntY.fishState.isAttached = true;\n                    hitEntY.fishState.isJumping = false; // Stop jumping if attached\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntY.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntY.fishState.lastHitAt = nowMs;\n                    }\n                } else {\n                    hitEntY.fishState.isJumping = true;\n                    hitEntY.fishState.jumpVx = -p.vx * 0.5;\n                    hitEntY.fishState.jumpVy = -Math.abs(p.vy) * 0.5 + fishJumpImpulse;\n                    hitEntY.fishState.jumpGravity = 900;\n                    hitEntY.fishState.panicUntil = nowMs + 5000;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntY.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntY.fishState.lastHitAt = nowMs;\n                    }\n                }\n            }\n            // Sea Rescue boxes should NOT disappear when hitting entities\n            cy = nextY;\n            continue; \n        }\n\n        hitEntY.health -= p.dmg || 10;\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntY.x + hitEntY.width / 2,\n            y: hitEntY.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxY = !p.isSeaRescueBox ? checkObjectHit(cx, nextY, hw, hh) : null;\n      if (hitIdxY !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxY, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    if (p.isSeaRescueBox) {\n        p.life -= deltaMs;\n        if (removed || p.life <= 0) {\n            projectilesRef.current.splice(i, 1);\n        }\n        continue;\n    }\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className, spriteSheet, frameIndex }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    // Ja ir spraitts, rdm tikai pirmo kadru (vai citu, ja nordts)\n    if (spriteSheet && spriteSheet.enabled) {\n        const columns = spriteSheet.columns || 1;\n        const total = spriteSheet.totalSprites || 1;\n        const rows = Math.ceil(total / columns);\n        \n        // Editor parasti rdm pirmo kadru (index 0) vai nordto kadru\n        const fallbackFrame = spriteSheet && Number.isFinite(Number(spriteSheet.frameIndex)) ? Number(spriteSheet.frameIndex) : 0;\n        const currentFrame = frameIndex !== undefined ? frameIndex : fallbackFrame;\n        const col = currentFrame % columns;\n        const row = Math.floor(currentFrame / columns);\n\n        return (\n            <div className={className} style={{\n                ...style,\n                overflow: 'hidden',\n                display: 'inline-block',\n                width: style?.width || '32px',\n                height: style?.height || '32px',\n                position: 'relative'\n            }}>\n                <img\n                    src={imgSrc}\n                    alt={alt || ''}\n                    style={{\n                        position: 'absolute',\n                        width: `${columns * 100}%`,\n                        height: `${rows * 100}%`,\n                        left: `-${col * 100}%`,\n                        top: `-${row * 100}%`,\n                        maxWidth: 'none',\n                        maxHeight: 'none',\n                        display: 'block'\n                    }}\n                    draggable={false}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false}\n        />\n    );\n};\n\nexport default AnimatedItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport fireballA from '../../../assets/images/items/fireball_basic_A.png';\nimport fireballB from '../../../assets/images/items/fireball_basic_B.png';\nimport fireballC from '../../../assets/images/items/fireball_basic_C.png';\nimport fireballD from '../../../assets/images/items/fireball_basic_D.png';\nimport fishSprite from '../../../assets/images/entities/animals/fish_01.png';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: auto;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nconst FishDisplay = styled(AmmoDisplay)`\n    color: rgba(140, 230, 255, 0.95);\n`;\n\nconst SeaRescueDisplay = styled(AmmoDisplay)`\n    color: #00ff00;\n`;\n\nconst AmmoIcon = styled.span`\n    width: 22px;\n    height: 22px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    image-rendering: pixelated;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    //gap: 8px;\n`;\n\nconst BarsContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    //gap: 1px;\n    width: 250px;\n    padding-top: 5px;\n    padding-bottom: 5px;\n   // border: solid 1px red;\n`;\n\nconst BarRow = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n`;\n\nconst BarWrapper = styled.div`\n    flex: 1;\n    height: 6px;\n    background-color: rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.4);\n    position: relative;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\n`;\n\nconst BarFill = styled.div.attrs(props => ({\n    style: {\n        width: `${props.$percent}%`,\n        backgroundColor: props.$color,\n    },\n}))`\n    height: 100%;\n    transition: width 0.3s ease;\n`;\n\nconst BarLabel = styled.div`\n    width: 60px;\n    font-size: 8px;\n    color: white;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px black;\n    pointer-events: none;\n    white-space: nowrap;\n    text-transform: uppercase;\n    text-align: right;\n`;\n\nconst GameHeader = ({ \n    health, \n    maxHealth = 100, \n    ammo = 0, \n    fishCount = 0,\n    seaRescuePoints = 0,\n    mapType = 'overworld',\n    oxygen = 100, \n    maxOxygen = 100, \n    lavaResist = 100, \n    maxLavaResist = 100,\n    iceResist = 100,\n    maxIceResist = 100,\n    strength = 30,\n    maxStrength = 100,\n    radioactivity = 20,\n    maxRadioactivity = 100,\n    inWater = false,\n    liquidType = null,\n    onIce = false\n}) => {\n    const hpPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));\n    const oxyPercent = Math.max(0, Math.min(100, (oxygen / maxOxygen) * 100));\n    const lavaPercent = Math.max(0, Math.min(100, (lavaResist / maxLavaResist) * 100));\n    const icePercent = Math.max(0, Math.min(100, (iceResist / maxIceResist) * 100));\n    const strengthPercent = Math.max(0, Math.min(100, (strength / maxStrength) * 100));\n    const radioPercent = Math.max(0, Math.min(100, (radioactivity / maxRadioactivity) * 100));\n    const fireballFrames = [fireballA, fireballB, fireballC, fireballD, fireballC, fireballB];\n\n    return (\n        <HeaderContainer>\n            <div style={{ display: 'flex', gap: '14px', alignItems: 'center' }}>\n                <AmmoDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            textures={fireballFrames}\n                            speed={300}\n                            alt=\"Fireball ammo\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {ammo || 0}\n                </AmmoDisplay>\n                <FishDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            texture={fishSprite}\n                            spriteSheet={{ enabled: true, columns: 2, totalSprites: 3, frameIndex: 0 }}\n                            alt=\"Fish\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {fishCount || 0}\n                </FishDisplay>\n                {mapType === 'sea_rescue' && (\n                    <SeaRescueDisplay style={{ marginLeft: '15px' }}>\n                        Points: {seaRescuePoints}\n                    </SeaRescueDisplay>\n                )}\n            </div>\n\n            <RightSection>\n                <BarsContainer>\n                    {/* HP Bar */}\n                    <BarRow>\n                        <BarLabel>HP</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={hpPercent} $color=\"#ff3232\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Oxygen Bar */}\n                    <BarRow>\n                        <BarLabel>OZ</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={oxyPercent} $color=\"#2ecdf1\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Lava Bar */}\n                    <BarRow>\n                        <BarLabel>LAVA</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={lavaPercent} $color=\"#ffcc00\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Ice Bar */}\n                    <BarRow>\n                        <BarLabel>ICE</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={icePercent} $color=\"#a5f3fc\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Strength Bar */}\n                    <BarRow>\n                        <BarLabel>STRNGTH</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={strengthPercent} $color=\"#8b5a2b\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Radioactivity Bar */}\n                    <BarRow>\n                        <BarLabel>RADIO</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={radioPercent} $color=\"#32cd32\" />\n                        </BarWrapper>\n                    </BarRow>\n                </BarsContainer>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    maxHealth: PropTypes.number,\n    ammo: PropTypes.number,\n    fishCount: PropTypes.number,\n    oxygen: PropTypes.number,\n    maxOxygen: PropTypes.number,\n    lavaResist: PropTypes.number,\n    maxLavaResist: PropTypes.number,\n    iceResist: PropTypes.number,\n    maxIceResist: PropTypes.number,\n    strength: PropTypes.number,\n    maxStrength: PropTypes.number,\n    radioactivity: PropTypes.number,\n    maxRadioactivity: PropTypes.number,\n    inWater: PropTypes.bool,\n    liquidType: PropTypes.string,\n    onIce: PropTypes.bool\n};\n\nexport default GameHeader;\n","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\n// Built-in: debug overlay toggle\nregister({\n  name: 'debug',\n  description: \"Toggle debug overlay: debug [on|off|toggle]\",\n  handler({ args }) {\n    const mode = (args && args[0]) ? String(args[0]).toLowerCase() : 'toggle';\n    const current = !!(window.__GAME_RUNTIME_SETTINGS__ && window.__GAME_RUNTIME_SETTINGS__.debugOverlayEnabled);\n    const next = (mode === 'on') ? true : (mode === 'off' ? false : !current);\n    try {\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        debugOverlayEnabled: next\n      };\n      try { localStorage.setItem('game_debug_overlay', next ? '1' : '0'); } catch {}\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: { debugOverlayEnabled: next } }));\n    } catch {}\n    return `Debug overlay ${next ? 'enabled' : 'disabled'}.`;\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Lava Rain (0..100)\n  const [lavaRain, setLavaRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_lavarain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherLavaRain === 'number') return Math.max(0, Math.min(100, g.weatherLavaRain));\n    } catch {}\n    return 0;\n  });\n  // New: Radioactive Fog (0..100)\n  const [radioactiveFog, setRadioactiveFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_radioactivefog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRadioactiveFog === 'number') return Math.max(0, Math.min(100, g.weatherRadioactiveFog));\n    } catch {}\n    return 0;\n  });\n  // New: Meteor Rain (0..100)\n  const [meteorRain, setMeteorRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_meteorrain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherMeteorRain === 'number') return Math.max(0, Math.min(100, g.weatherMeteorRain));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [debugOverlayEnabled, setDebugOverlayEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_debug_overlay');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.debugOverlayEnabled === 'boolean') return g.debugOverlayEnabled;\n    } catch {}\n    return false;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [roomBlurEnabled, setRoomBlurEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_graphics_room_blur');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.roomBlurEnabled === 'boolean') return g.roomBlurEnabled;\n    } catch {}\n    return true;\n  });\n  const [showCoordinates, setShowCoordinates] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_show_coords');\n      return ls === '1';\n    } catch {}\n    return false;\n  });\n\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Listen for runtime settings updates from game engine or other sources\n  useEffect(() => {\n    const onSettingsUpdate = (e) => {\n      const patch = (e && e.detail) || {};\n      if (patch.weatherRain !== undefined) setRain(patch.weatherRain);\n      if (patch.weatherSnow !== undefined) setSnow(patch.weatherSnow);\n      if (patch.weatherClouds !== undefined) setClouds(patch.weatherClouds);\n      if (patch.weatherFog !== undefined) setFog(patch.weatherFog);\n      if (patch.weatherThunder !== undefined) setThunder(patch.weatherThunder);\n      if (patch.weatherLavaRain !== undefined) setLavaRain(patch.weatherLavaRain);\n      if (patch.weatherRadioactiveFog !== undefined) setRadioactiveFog(patch.weatherRadioactiveFog);\n      if (patch.weatherMeteorRain !== undefined) setMeteorRain(patch.weatherMeteorRain);\n      if (patch.backgroundParallaxFactor !== undefined) setParallax(patch.backgroundParallaxFactor);\n      if (patch.roomBlurEnabled !== undefined) setRoomBlurEnabled(!!patch.roomBlurEnabled);\n      if (patch.healthBarEnabled !== undefined) setHealthBarEnabled(!!patch.healthBarEnabled);\n      if (patch.oxygenBarEnabled !== undefined) setOxygenBarEnabled(!!patch.oxygenBarEnabled);\n      if (patch.lavaBarEnabled !== undefined) setLavaBarEnabled(!!patch.lavaBarEnabled);\n      if (patch.waterSplashesEnabled !== undefined) setWaterSplashesEnabled(!!patch.waterSplashesEnabled);\n      if (patch.lavaEmbersEnabled !== undefined) setLavaEmbersEnabled(!!patch.lavaEmbersEnabled);\n      if (patch.debugOverlayEnabled !== undefined) setDebugOverlayEnabled(!!patch.debugOverlayEnabled);\n    };\n    window.addEventListener('game-settings-update', onSettingsUpdate);\n    return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.roomBlurEnabled === 'boolean') {\n          setRoomBlurEnabled(g.roomBlurEnabled);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.weatherLavaRain === 'number') setLavaRain(Math.max(0, Math.min(100, g.weatherLavaRain)));\n        if (typeof g.weatherRadioactiveFog === 'number') setRadioactiveFog(Math.max(0, Math.min(100, g.weatherRadioactiveFog)));\n        if (typeof g.weatherMeteorRain === 'number') setMeteorRain(Math.max(0, Math.min(100, g.weatherMeteorRain)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n        if (typeof g.debugOverlayEnabled === 'boolean') setDebugOverlayEnabled(!!g.debugOverlayEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  useEffect(() => {\n    try { localStorage.setItem('game_ui_show_coords', showCoordinates ? '1' : '0'); } catch {}\n  }, [showCoordinates]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Blur in Room</label>\n          <input\n            type=\"checkbox\"\n            checked={!!roomBlurEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setRoomBlurEnabled(v);\n              try { localStorage.setItem('game_graphics_room_blur', v ? '1' : '0'); } catch {}\n              emitUpdate({ roomBlurEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Coordinates</label>\n          <input\n            type=\"checkbox\"\n            checked={!!showCoordinates}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setShowCoordinates(v);\n              emitUpdate({ showCoordinates: v });\n            }}\n          />\n        </div>\n        {showCoordinates && (\n          <div style={{ marginTop: 8, padding: '4px 8px', background: 'rgba(0,0,0,0.3)', borderRadius: 4, fontSize: 11, fontFamily: 'monospace', color: '#4ec9b0' }}>\n            Pos: X={Math.round(window.__PLAYER_POS__?.x || 0)}, Y={Math.round(window.__PLAYER_POS__?.y || 0)}\n          </div>\n        )}\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lavas lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(lavaRain) ? lavaRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setLavaRain(v);\n            try { localStorage.setItem('game_weather_lavarain', String(v)); } catch {}\n            emitUpdate({ weatherLavaRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(lavaRain) ? lavaRain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Radioakt. migla</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(radioactiveFog) ? radioactiveFog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRadioactiveFog(v);\n            try { localStorage.setItem('game_weather_radioactivefog', String(v)); } catch {}\n            emitUpdate({ weatherRadioactiveFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(radioactiveFog) ? radioactiveFog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Meteortu lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(meteorRain) ? meteorRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setMeteorRain(v);\n            try { localStorage.setItem('game_weather_meteorrain', String(v)); } catch {}\n            emitUpdate({ weatherMeteorRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(meteorRain) ? meteorRain : 0}</span>\n      </div>\n    </section>\n  );\n\n  const renderDebug = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Debug</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 160 }}>Show Debug Overlay</label>\n        <input\n          type=\"checkbox\"\n          checked={!!debugOverlayEnabled}\n          onChange={(e) => {\n            const v = !!e.target.checked;\n            setDebugOverlayEnabled(v);\n            try { localStorage.setItem('game_debug_overlay', v ? '1' : '0'); } catch {}\n            emitUpdate({ debugOverlayEnabled: v });\n          }}\n        />\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather','Debug'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n        {activeTab === 'Debug' && renderDebug()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import breakEffectsConfig from '../../assets/json/system/object_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!breakEffectsConfig || breakEffectsConfig.enabled === false) return null;\n  return breakEffectsConfig;\n};\n\nexport const getBreakEffectParams = (def) => {\n  if (!def) return null;\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const id = def.id;\n  const type = def.type;\n  const subtype = def.subtype;\n  const name = def.name;\n  const ids = Array.isArray(cfg.objectIds) ? cfg.objectIds : [];\n  const types = Array.isArray(cfg.objectTypes) ? cfg.objectTypes : [];\n  const matchesValue = (value, list) => {\n    if (!value) return false;\n    return list.some(item => item === value || value.includes(item));\n  };\n  const matched = matchesValue(id, ids) || matchesValue(name, ids) || matchesValue(type, types) || matchesValue(subtype, types);\n  if (!matched) return null;\n  const base = cfg.default || {};\n  const colors = Array.isArray(base.colors) ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 12,\n    speed: Number(base.speed) || 2,\n    lifeMs: Number(base.lifeMs) || 600,\n    size: Number(base.size) || 2,\n    colors\n  };\n};\n\nexport const shouldTriggerBreakEffect = (def, newHealth) => {\n  if (!def) return false;\n  const params = getBreakEffectParams(def);\n  if (!params) return false;\n  const threshold = Number(def.passableHealthThreshold ?? 0);\n  const hp = Number(newHealth);\n  if (!Number.isFinite(hp)) return false;\n  return hp <= threshold;\n};\n\nexport default {\n  getBreakEffectParams,\n  shouldTriggerBreakEffect\n};\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\n// - isInsideRoom: boolean  apply muffled effect\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6, isInsideRoom = false }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n  const audioCtxRef = useRef(null);\n  const sourceNodeRef = useRef(null);\n  const filterNodeRef = useRef(null);\n  const gainNodeRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n      if (audioCtxRef.current) {\n        audioCtxRef.current.close().catch(() => {});\n        audioCtxRef.current = null;\n        sourceNodeRef.current = null;\n        filterNodeRef.current = null;\n        gainNodeRef.current = null;\n      }\n    } catch {}\n  };\n\n  const setupWebAudio = (audio) => {\n    try {\n      const AudioContext = window.AudioContext || window.webkitAudioContext;\n      if (!AudioContext) return;\n\n      const ctx = new AudioContext();\n      const source = ctx.createMediaElementSource(audio);\n      const filter = ctx.createBiquadFilter();\n      const gain = ctx.createGain();\n\n      filter.type = 'lowpass';\n      filter.frequency.value = isInsideRoom ? 800 : 22000;\n      gain.gain.value = isInsideRoom ? 0.5 : 1.0;\n\n      source.connect(filter);\n      filter.connect(gain);\n      gain.connect(ctx.destination);\n\n      audioCtxRef.current = ctx;\n      sourceNodeRef.current = source;\n      filterNodeRef.current = filter;\n      gainNodeRef.current = gain;\n    } catch (e) {\n      console.warn('Web Audio setup failed:', e);\n    }\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Web Audio setup for filters\n    setupWebAudio(audio);\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume/room changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    // Direct audio volume (without Web Audio or as fallback)\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    \n    // Web Audio updates\n    if (audioCtxRef.current) {\n      if (filterNodeRef.current) {\n        filterNodeRef.current.frequency.setTargetAtTime(isInsideRoom ? 800 : 22000, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.gain.setTargetAtTime(isInsideRoom ? 0.4 : 1.0, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (audioCtxRef.current.state === 'suspended' && enabled) {\n        audioCtxRef.current.resume().catch(() => {});\n      }\n    }\n\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume, isInsideRoom]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst Overlay = styled.div`\n    position: absolute;\n    top: 70px;\n    left: 10%;\n    transform: none;\n    width: 80%;\n    text-align: left;\n    pointer-events: none;\n    z-index: 1500;\n    \n    h2 {\n        font-size: 22px;\n        color: white;\n        text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);\n        margin: 0;\n        padding: 12px 14px;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-weight: 800;\n        letter-spacing: 0.5px;\n        white-space: pre-line;\n        line-height: 1;\n        background: rgba(0, 0, 0, 0.45);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 6px;\n        opacity: ${props => props.$isVisible ? 1 : 0};\n        transition: opacity 2s ease-in-out;\n    }\n`;\n\nexport const MessageOverlay = ({ text, isVisible }) => {\n    if (!text) return null;\n    return (\n        <Overlay $isVisible={isVisible}>\n            <h2>{text}</h2>\n        </Overlay>\n    );\n};\n\nMessageOverlay.propTypes = {\n    text: PropTypes.string,\n    isVisible: PropTypes.bool\n};\n\nMessageOverlay.defaultProps = {\n    text: '',\n    isVisible: false\n};\n\nexport default MessageOverlay;\n","import map1 from '../assets/maps/template.json';\nimport map2 from '../assets/maps/exampel_liquids.json';\nimport map3 from '../assets/maps/exampel_sectors_01.json';\nimport map4 from '../assets/maps/exampel_sectors_02.json';\nimport map5 from '../assets/maps/exampel_m2room.json';\nimport map6 from '../assets/maps/exampel_weather_01.json';\nimport map7 from '../assets/maps/Ports.json';\nimport map8 from '../assets/maps/fish.json';\nimport map9 from '../assets/maps/minigame_sea.json';\n\n\nexport const BUILT_IN_MAPS = [\n    map1,\n    map2,\n    map3,\n    map4,\n    map5,\n    map6,\n    map7,\n    map8,\n    map9\n];\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport { findSpawnPosition } from '../../../engine/gameplay/interactables';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../engine/gameplay/breakEffects';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, removeTileAtIndex, moveTileInMap, moveObjectInMap, updateObjectAtIndex, updateObjectMetadata, setObjectTextureIndex, revealSecretZone, resetGame, setGameOver, addSeaRescuePoints, captureSeaRescueBox, toggleRoom, clearRooms } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\nimport { BUILT_IN_MAPS } from '../../../constants/builtInMaps';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nconst WinCounterOverlay = styled.div`\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 120px;\n    font-weight: bold;\n    color: #fff;\n    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,255,255,0.5);\n    z-index: 2000;\n    pointer-events: none;\n    font-family: 'Courier New', Courier, monospace;\n`;\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    overflow: hidden;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nexport default function Game() {\n    const { t } = useTranslation('game');\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n\n    // Redux state\n    const gameState = useSelector(state => state.game) || {};\n    const uiState = useSelector(state => state.ui) || {};\n    const {\n        activeMapData = null,\n        tileMapData = [],\n        objectMapData = [],\n        secretMapData = [],\n        objectMetadata = {},\n        revealedSecrets = [],\n        objectTextureIndices = {},\n        mapWidth = 20,\n        mapHeight = 15,\n        isGameOver = false,\n        activeRoomIds = [],\n        seaRescuePoints = 0,\n        projectMaps = {}\n    } = gameState;\n    const {\n        isMapModalOpen = true,\n        cameraScrollX = 0,\n        shouldCenterMap = false\n    } = uiState;\n\n    const effectiveMapType = useMemo(() => {\n        if (!activeMapData) return 'overworld';\n        const activeId = activeMapData.meta?.activeMapId || activeMapData.meta?.activeMap || 'main';\n        \n        // Check for Project V2.0 structure\n        if (activeMapData.meta?.version === \"2.0\" && activeMapData.maps) {\n            const activeMap = activeMapData.maps[activeId] || Object.values(activeMapData.maps)[0];\n            return activeMap?.type || 'overworld';\n        }\n        \n        // Fallback to root type or overworld\n        return activeMapData.type || 'overworld';\n    }, [activeMapData]);\n\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    // In-game messages\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n\n    useEffect(() => {\n        const onToggle = (e) => {\n            const enabled = !!(e?.detail?.enabled);\n            setSoundEnabled(enabled);\n            try { localStorage.setItem('game_sound_enabled', enabled ? '1' : '0'); } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        return () => window.removeEventListener('game-sound-toggle', onToggle);\n    }, []);\n\n    useEffect(() => {\n        if (messageTimerRef.current) {\n            clearTimeout(messageTimerRef.current);\n            messageTimerRef.current = null;\n        }\n        setGameMessage({ text: '', isVisible: false });\n    }, [activeMapData]);\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        dispatch(setGameOver(true));\n    };\n\n    const handleReplay = () => {\n        if (activeMapData) {\n            console.log(\"Replaying map...\");\n            const mapToLoad = {\n                ...activeMapData,\n                meta: {\n                    ...activeMapData.meta,\n                    date_map_last_updated: new Date().toISOString()\n                }\n            };\n            loadMapData(mapToLoad);\n            dispatch(setGameOver(false));\n        }\n    };\n\n    const playerStateRef = useRef(null);\n    const activeMapIdRef = useRef(null);\n    const isGameOverRef = useRef(false);\n\n    useEffect(() => {\n        const id = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n        activeMapIdRef.current = id;\n    }, [activeMapData]);\n\n    useEffect(() => {\n        isGameOverRef.current = !!isGameOver;\n    }, [isGameOver]);\n\n    const handleStateUpdate = useCallback((action, payload) => {\n        if (action === 'collectItem') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            dispatch(removeObjectAtIndex({ index, mapId }));\n        } else if (action === 'interactable') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            \n            const targetObjectData = (!mapId || mapId === 'main') ? objectMapData : (activeMapData?.maps?.[mapId]?.objectMapData || []);\n            const currentId = targetObjectData[index];\n            \n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used', mapId }));\n            }\n        } else if (action === 'setObjectFrame') {\n            const { index, frame, mapId } = payload;\n            dispatch(updateObjectMetadata({ index, metadata: { currentFrame: frame }, mapId }));\n        } else if (action === 'switchMap') {\n            const { targetMapId, triggerId } = payload;\n            const projectMapsResolved = Object.keys(projectMaps || {}).length\n                ? projectMaps\n                : (activeMapData?.maps || activeMapData?.projectMaps || {});\n            const targetMap = projectMapsResolved[targetMapId];\n            \n            if (targetMap && targetMap.type === 'room') {\n                if (!activeRoomIds.includes(targetMapId)) {\n                    dispatch(toggleRoom(targetMapId));\n                }\n                return;\n            } else if (targetMapId === 'main' && activeRoomIds.length > 0) {\n                dispatch(clearRooms());\n                \n                // Open the door at the exit target position to prevent getting stuck\n                const spawn = findSpawnPosition(activeMapData, triggerId, 32);\n                if (spawn) {\n                    const spawnIdx = (Math.floor(spawn.y / 32) * mapWidth) + Math.floor(spawn.x / 32);\n                    const spawnObjId = objectMapData[spawnIdx];\n                    const spawnDef = registryItems.find(r => r.id === spawnObjId);\n                    if (spawnDef && spawnDef.subtype === 'door') {\n                        dispatch(updateObjectMetadata({ \n                            index: spawnIdx, \n                            metadata: { currentFrame: spawnDef.interaction?.frames?.opening || 1 } \n                        }));\n                    }\n                }\n                return;\n            }\n            \n            if (targetMap) {\n                console.log(`Switching to map: ${targetMapId}, looking for trigger: ${triggerId}`);\n                \n                // Ms varam vienkri nodot visu projektu un pielikt spawnTriggerId\n                const projectToLoad = {\n                    ...activeMapData,\n                    maps: projectMapsResolved,\n                    meta: {\n                        ...activeMapData.meta,\n                        activeMapId: targetMapId,\n                        spawnTriggerId: triggerId\n                    }\n                };\n                \n                loadMapData(projectToLoad);\n            }\n        } else if (action === 'objectDamage') {\n            const { index, damage } = payload;\n            const objId = objectMapData[index];\n            if (objId) {\n                const def = registryItems.find(r => r.id === objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata[index] || {};\n                    const maxH = def.maxHealth || 100;\n                    const newHealth = Math.max(0, (currentMeta.health !== undefined ? currentMeta.health : maxH) - damage);\n                    const metaPatch = { health: newHealth };\n                    if (shouldTriggerBreakEffect(def, newHealth) && !currentMeta.breakFxPlayed) {\n                        metaPatch.breakFxPlayed = true;\n                        const cfg = getBreakEffectParams(def);\n                        if (cfg) {\n                            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            window.dispatchEvent(new CustomEvent('game-break-effect', {\n                                detail: { x, y, config: cfg }\n                            }));\n                        }\n                    }\n                    dispatch(updateObjectMetadata({ index, metadata: metaPatch }));\n\n                    if (shouldRemoveCrackBlock(def, newHealth)) {\n                        dispatch(removeTileAtIndex(index));\n                    }\n\n                    const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                    const y = Math.floor(index / mapWidth) * TILE_SIZE;\n                    window.dispatchEvent(new CustomEvent('game-floating-text', {\n                        detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n                    }));\n                }\n            }\n        } else if (action === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (action === 'SEA_RESCUE_SCORE' && payload) {\n            const { points, triggerIndex, boxId } = payload;\n            dispatch(addSeaRescuePoints(points));\n            dispatch(captureSeaRescueBox({ triggerIndex, boxId, mapWidth }));\n            \n            // Show floating text at the trigger location (might need adjustment if captured index changed, but for now we show at hit location)\n            const x = (triggerIndex % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(triggerIndex / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `+${points}`, color: '#00ff00', amount: points }\n            }));\n        } else if (action === 'shiftTile' && payload) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapIdRef.current;\n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => objectMapData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => dispatch(moveTileInMap({ fromIndex: from, toIndex: to })),\n                moveObject: (from, to) => dispatch(moveObjectInMap({ fromIndex: from, toIndex: to })),\n                removeObject: idx => dispatch(removeObjectAtIndex(idx)),\n                shouldCancel: () => isGameOverRef.current || activeMapIdRef.current !== mapIdAtStart\n            });\n        } else if (action === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            const ps = playerStateRef.current;\n            const px = Number.isFinite(x) ? x : (ps?.x || 0) + (ps?.width || TILE_SIZE) / 2;\n            const py = Number.isFinite(y) ? y : (ps?.y || 0);\n            if (Number.isFinite(px) && Number.isFinite(py) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x: px, y: py, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        } else if (action === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (action === 'levelWin') {\n            console.log(\"Level Win! Returning to map selection.\");\n            setTimeout(() => {\n                alert(\"Level Complete!\");\n                dispatch(setMapModalOpen(true));\n            }, 500);\n        } else if (action === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1); // e.g., weatherRain\n            setRuntimeSettings(prev => ({ ...prev, [settingKey]: value }));\n            \n            // Dispatch event so UI components like GameSettings can update their state\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (action === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            // o darbbu ms izmantosim, lai nodotu informciju dzinjam caur ref vai eventu\n            // Bet labk ir tiei izsaukt dzinja funkciju, ja tda ir.\n            // T k useGameEngine ir hook, ms nevaram viegli izsaukt t iekjo funkciju.\n            // Tomr ms varam izmantot window eventu vai ref.\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (action === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        }\n    }, [activeMapData, activeRoomIds, dispatch, mapHeight, mapWidth, objectMapData, objectMetadata, projectMaps, registryItems]);\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const { player: playerState, input: engineInput, engineRefs } = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        activeRoomIds,\n        mapWidth,\n        mapHeight\n    );\n    useEffect(() => {\n        playerStateRef.current = playerState;\n    }, [playerState]);\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => {\n            dispatch(setMapModalOpen(true));\n            dispatch(setGameOver(false)); // Reset game over when opening new game modal\n        };\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherLavaRain: (runtimeSettings.weatherLavaRain ?? 0),\n                weatherRadioactiveFog: (runtimeSettings.weatherRadioactiveFog ?? 0),\n                weatherMeteorRain: (runtimeSettings.weatherMeteorRain ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                roomBlurEnabled: (runtimeSettings.roomBlurEnabled ?? true),\n                debugOverlayEnabled: (runtimeSettings.debugOverlayEnabled ?? false),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const cloneMapData = (data) => {\n        if (!data) return data;\n        try {\n            if (typeof structuredClone === 'function') {\n                return structuredClone(data);\n            }\n        } catch {}\n        try {\n            return JSON.parse(JSON.stringify(data));\n        } catch {\n            return data;\n        }\n    };\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            const sourceMapData = cloneMapData(mapData);\n            let effectiveMapData = sourceMapData;\n            \n            // Atbalsts Version 2.0 (Multi-map project)\n            if (sourceMapData.meta?.version === \"2.0\" && sourceMapData.maps) {\n                const activeId = sourceMapData.meta.activeMapId || Object.keys(sourceMapData.maps)[0];\n                const activeMap = sourceMapData.maps[activeId];\n                \n                if (activeMap) {\n                    const activeLayers = activeMap.layers || [];\n                    const bgLayer = activeLayers.find(l => l.name === 'background' || l.type === 'tile');\n                    const objLayer = activeLayers.find(l => l.name === 'entities' || l.type === 'object');\n                    const secretLayer = activeLayers.find(l => l.name === 'secrets' || l.type === 'secret');\n                    const mapTileData = activeMap.tileMapData || bgLayer?.data;\n                    const mapObjectData = activeMap.objectMapData || objLayer?.data;\n                    const mapSecretData = activeMap.secretMapData || secretLayer?.data;\n\n                    // Konvertjam uz formtu, ko saprot dzinjs un setActiveMap\n                    effectiveMapData = {\n                        ...sourceMapData, // Saglabjam visu projektu\n                        meta: {\n                            ...sourceMapData.meta,\n                            width: activeMap.width,\n                            height: activeMap.height,\n                            name: activeMap.name,\n                            backgroundImage: activeMap.backgroundImage,\n                            backgroundColor: activeMap.backgroundColor,\n                            backgroundMusic: activeMap.backgroundMusic,\n                            backgroundParallaxFactor: activeMap.backgroundParallaxFactor,\n                            weather: activeMap.weather,\n                            objectMetadata: activeMap.objectMetadata || {},\n                            playerPosition: activeMap.playerPosition\n                        },\n                        layers: [\n                            { name: 'background', data: mapTileData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'entities', data: mapObjectData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'secrets', data: mapSecretData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) }\n                        ]\n                    };\n                }\n            }\n\n            const nowIso = new Date().toISOString();\n            if (!effectiveMapData.meta) effectiveMapData.meta = {};\n            effectiveMapData.meta.date_map_last_updated = nowIso;\n\n            const w = effectiveMapData.meta?.width || effectiveMapData.width || 20;\n            const h = effectiveMapData.meta?.height || effectiveMapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (effectiveMapData.layers) {\n                const bgLayer = effectiveMapData.layers.find(l => l.name === 'background' || l.type === 'tile');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = effectiveMapData.layers.find(l => l.name === 'entities' || l.type === 'object');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = effectiveMapData.layers.find(l => l.name === 'secrets' || l.type === 'secret');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = effectiveMapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData: effectiveMapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n            dispatch(setGameOver(false)); // Ensure game over is reset on map load\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: effectiveMapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    const debugOverlayEnabled = !!(runtimeSettings.debugOverlayEnabled);\n    const debugMapId = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n\n    return (\n        <GameContainer onClick={() => {\n            window.dispatchEvent(new CustomEvent('game-sound-user-gesture'));\n        }}>\n        \n            {/* Game Header */}\n            {/* UI Overlays */}\n            {playerState?.isWinning && (\n                <WinCounterOverlay>\n                    {Math.floor(playerState.winCounter || 0)}\n                </WinCounterOverlay>\n            )}\n\n            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n\n            <GameHeader \n                health={playerState.health} \n                maxHealth={playerState.maxHealth}\n                ammo={playerState.ammo || 0} \n                fishCount={playerState.fishCount || 0}\n                seaRescuePoints={seaRescuePoints}\n                mapType={effectiveMapType}\n                oxygen={playerState.oxygen}\n                maxOxygen={playerState.maxOxygen}\n                lavaResist={playerState.lavaResist}\n                maxLavaResist={playerState.maxLavaResist}\n                iceResist={playerState.iceResist}\n                maxIceResist={playerState.maxIceResist}\n                strength={playerState.strength}\n                maxStrength={playerState.maxStrength}\n                radioactivity={playerState.radioactivity}\n                maxRadioactivity={playerState.maxRadioactivity}\n                inWater={playerState.inWater}\n                liquidType={playerState.liquidType}\n                onIce={playerState.onIce}\n            />\n\n            {debugOverlayEnabled && (\n                <div style={{\n                    position: 'absolute',\n                    top: 70,\n                    left: 70,\n                    background: 'rgba(0,0,0,0.6)',\n                    color: '#eaeaea',\n                    padding: '8px 10px',\n                    fontSize: 11,\n                    lineHeight: 1.4,\n                    borderRadius: 4,\n                    zIndex: 2100,\n                    pointerEvents: 'none',\n                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace'\n                }}>\n                    <div>Map: {debugMapId}</div>\n                    <div>Pos: {Math.round(playerState.x || 0)}, {Math.round(playerState.y || 0)}</div>\n                    <div>Room: {Array.isArray(activeRoomIds) && activeRoomIds.length ? activeRoomIds.join(', ') : 'none'}</div>\n                    <div>Weather: rain {runtimeSettings.weatherRain ?? 0} | snow {runtimeSettings.weatherSnow ?? 0} | fog {runtimeSettings.weatherFog ?? 0}</div>\n                    <div>Weather: lava {runtimeSettings.weatherLavaRain ?? 0} | radio {runtimeSettings.weatherRadioactiveFog ?? 0}</div>\n                    <div>HP {Math.round(playerState.health || 0)} / {Math.round(playerState.maxHealth || 0)}</div>\n                    <div>O2 {Math.round(playerState.oxygen || 0)} | Lava {Math.round(playerState.lavaResist || 0)} | Rad {Math.round(playerState.radioactivity || 0)}</div>\n                </div>\n            )}\n\n\n            {isGameOver && (\n                <GameOverOverlay>\n                    <GameOverTitle>Game Over</GameOverTitle>\n                    <ReplayButton onClick={handleReplay}>\n                        REPLAY \n                    </ReplayButton>\n                </GameOverOverlay>\n            )}\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>{t('GAME_MAP_SELECT_TITLE')}</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => {\n                                const isV2 = map.meta?.version === \"2.0\";\n                                const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                                const author = map.meta?.author || \"Unknown\";\n                                \n                                let sizeInfo = \"\";\n                                let subMapInfo = \"\";\n\n                                if (isV2 && map.maps) {\n                                    const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                                    if (mainMap) {\n                                        sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                                    }\n                                    \n                                    const mapValues = Object.values(map.maps);\n                                    const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                                    const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                                    \n                                    subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                                } else {\n                                    sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                                }\n\n                                return (\n                                    <MapCard key={index} onClick={() => loadMapData(map)}>\n                                        <div>\n                                            <MapTitle>{projectName}</MapTitle>\n                                            <MapAuthor>{t('GAME_MAP_BY', { author })}</MapAuthor>\n                                        </div>\n                                        {map.meta?.description && (\n                                            <MapDescription title={map.meta.description}>\n                                                {map.meta.description}\n                                            </MapDescription>\n                                        )}\n                                        <MapInfo>\n                                            <div>{t('GAME_MAP_SIZE', { size: `${sizeInfo}${subMapInfo}` })}</div>\n                                        </MapInfo>\n                                    </MapCard>\n                                );\n                            })}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 {t('GAME_MAP_LOAD_CUSTOM')}\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherLavaRain={runtimeSettings.weatherLavaRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherMeteorRain={runtimeSettings.weatherMeteorRain ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherRadioactiveFog={runtimeSettings.weatherRadioactiveFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                            roomBlurEnabled={runtimeSettings.roomBlurEnabled ?? true}\n                            debugOverlayEnabled={runtimeSettings.debugOverlayEnabled ?? false}\n                            isEditor={false}\n                            mapType={effectiveMapType}\n                            engineInput={engineInput}\n                            engineRefs={engineRefs}\n                            activeRoomIds={activeRoomIds}\n                            maps={projectMaps}\n                            mapData={activeMapData}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer \n                metaPath={activeMapData?.meta?.backgroundMusic} \n                enabled={soundEnabled} \n                volume={0.6} \n                isInsideRoom={activeRoomIds.length > 0}\n            />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","import saveFile from '../../../../utilities/saveFile';\nimport errorHandler from '../../../../services/errorHandler';\n\nexport const saveMap = async ({\n    maps,\n    activeMapId,\n    mapName,\n    creatorName,\n    mapDescription,\n    createdAt,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    const projectData = {\n        meta: {\n            version: \"2.0\",\n            projectName: mapName,\n            author: creatorName,\n            description: mapDescription,\n            date_created: createdDate,\n            date_last_updated: currentDate,\n            activeMapId: activeMapId\n        },\n        maps: {}\n    };\n\n    // Serialize all maps\n    Object.values(maps).forEach(map => {\n        const filledBlocks = map.tileMapData.filter(t => t !== null).length;\n        const objectsCount = map.objectMapData.filter(o => o !== null).length;\n        \n        projectData.maps[map.id] = {\n            id: map.id,\n            name: map.name,\n            description: map.description || '',\n            type: map.type,\n            width: map.mapWidth,\n            height: map.mapHeight,\n            backgroundImage: map.selectedBackgroundImage || null,\n            backgroundColor: map.selectedBackgroundColor || null,\n            backgroundParallaxFactor: map.backgroundParallaxFactor || 0.3,\n            backgroundMusic: map.selectedBackgroundMusic || null,\n            weather: map.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n            objectMetadata: map.objectMetadata || {},\n            playerPosition: map.playerPosition || null,\n            worldX: map.worldX || 0,\n            worldY: map.worldY || 0,\n            statistics: {\n                total_tiles: map.mapWidth * map.mapHeight,\n                filled_tiles: filledBlocks,\n                total_objects: objectsCount\n            },\n            layers: [\n                { type: \"tile\", name: \"background\", data: map.tileMapData },\n                { type: \"object\", name: \"entities\", data: map.objectMapData },\n                { type: \"secret\", name: \"secrets\", data: map.secretMapData || Array(map.mapWidth * map.mapHeight).fill(null) }\n            ]\n        };\n    });\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(projectData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Project saved successfully', {\n                component: 'Editor',\n                projectName: mapName,\n                fileName,\n                mapsCount: Object.keys(maps).length\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save project. Check console for details.');\n    }\n};\n\nexport const applyMapData = (loaded, {\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setPlayerPosition,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData,\n    setObjectMetadata,\n    setWeatherRain,\n    setWeatherSnow,\n    setWeatherClouds,\n    setWeatherFog,\n    setWeatherThunder,\n    setWeatherLavaRain,\n    setWeatherRadioactiveFog,\n    setWeatherMeteorRain,\n    // Multi-map setters\n    setMaps,\n    setActiveMapId\n}) => {\n    try {\n        // Check for multi-map format (version 2.0)\n        if (loaded.meta && loaded.meta.version === \"2.0\" && loaded.maps) {\n            const projectMaps = {};\n            \n            Object.keys(loaded.maps).forEach(mapId => {\n                const m = loaded.maps[mapId];\n                const bgLayer = m.layers.find(l => l.type === 'tile');\n                const objLayer = m.layers.find(l => l.type === 'object');\n                const secretLayer = m.layers.find(l => l.type === 'secret');\n                \n                projectMaps[mapId] = {\n                    id: mapId,\n                    name: m.name,\n                    description: m.description || '',\n                    type: m.type || 'overworld',\n                    mapWidth: m.width,\n                    mapHeight: m.height,\n                    tileMapData: bgLayer ? bgLayer.data : Array(m.width * m.height).fill(null),\n                    objectMapData: objLayer ? objLayer.data : Array(m.width * m.height).fill(null),\n                    secretMapData: secretLayer ? secretLayer.data : Array(m.width * m.height).fill(null),\n                    objectMetadata: m.objectMetadata || {},\n                    selectedBackgroundImage: m.backgroundImage,\n                    selectedBackgroundColor: m.backgroundColor,\n                    backgroundParallaxFactor: m.backgroundParallaxFactor || 0.3,\n                    selectedBackgroundMusic: m.backgroundMusic,\n                    weather: m.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                    playerPosition: m.playerPosition || null,\n                    worldX: m.worldX || 0,\n                    worldY: m.worldY || 0\n                };\n            });\n            \n            setMaps(projectMaps);\n            setMapName(loaded.meta.projectName || \"Loaded Project\");\n            setCreatorName(loaded.meta.author || \"Anonymous\");\n            setMapDescription(loaded.meta.description || \"\");\n            setCreatedAt(loaded.meta.date_created || new Date().toISOString());\n            \n            const activeId = loaded.meta.activeMapId || Object.keys(projectMaps)[0];\n            setActiveMapId(activeId);\n            \n            const activeMap = projectMaps[activeId];\n            if (activeMap) {\n                setMapWidth(activeMap.mapWidth);\n                setMapHeight(activeMap.mapHeight);\n                setTileMapData(activeMap.tileMapData);\n                setObjectMapData(activeMap.objectMapData);\n                setSecretMapData(activeMap.secretMapData);\n                setObjectMetadata(activeMap.objectMetadata);\n                setSelectedBackgroundImage(activeMap.selectedBackgroundImage);\n                setSelectedBackgroundColor(activeMap.selectedBackgroundColor);\n                setBackgroundParallaxFactor(activeMap.backgroundParallaxFactor);\n                setSelectedBackgroundMusic(activeMap.selectedBackgroundMusic);\n                \n                setWeatherRain(activeMap.weather.rain);\n                setWeatherSnow(activeMap.weather.snow);\n                setWeatherClouds(activeMap.weather.clouds);\n                setWeatherFog(activeMap.weather.fog);\n                setWeatherThunder(activeMap.weather.thunder);\n                setWeatherLavaRain(activeMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(activeMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(activeMap.weather.meteorRain || 0);\n\n                if (activeMap.playerPosition) setPlayerPosition(activeMap.playerPosition);\n            }\n            \n            errorHandler.info('Project loaded successfully', {\n                component: 'Editor',\n                projectName: loaded.meta.projectName\n            });\n        } else if (loaded.meta) {\n            // Legacy 1.0 format\n            setMapWidth(loaded.meta.width);\n            setMapHeight(loaded.meta.height);\n\n            if (loaded.meta.name) setMapName(loaded.meta.name);\n            if (loaded.meta.author) setCreatorName(loaded.meta.author);\n            if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n            const bgLayer = loaded.layers.find(l => l.name === 'background');\n            const objLayer = loaded.layers.find(l => l.name === 'entities');\n            const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n            \n            const singleMap = {\n                id: 'main',\n                name: loaded.meta.name || \"Main Map\",\n                type: 'overworld',\n                mapWidth: loaded.meta.width,\n                mapHeight: loaded.meta.height,\n                tileMapData: bgLayer ? bgLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMapData: objLayer ? objLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                secretMapData: secretLayer ? secretLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMetadata: loaded.meta.objectMetadata || {},\n                selectedBackgroundImage: loaded.meta.backgroundImage,\n                selectedBackgroundColor: loaded.meta.backgroundColor,\n                backgroundParallaxFactor: loaded.meta.backgroundParallaxFactor || 0.3,\n                selectedBackgroundMusic: loaded.meta.backgroundMusic,\n                weather: loaded.meta.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                playerPosition: null\n            };\n\n            setMaps({ 'main': singleMap });\n            setActiveMapId('main');\n\n            if (bgLayer) setTileMapData(bgLayer.data);\n            if (objLayer) setObjectMapData(objLayer.data);\n            if (secretLayer) setSecretMapData(secretLayer.data);\n            \n            // Set other states\n            if (loaded.meta.backgroundImage) setSelectedBackgroundImage(loaded.meta.backgroundImage);\n            if (loaded.meta.backgroundColor) setSelectedBackgroundColor(loaded.meta.backgroundColor);\n            if (loaded.meta.backgroundParallaxFactor !== undefined) setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n            if (loaded.meta.backgroundMusic) setSelectedBackgroundMusic(loaded.meta.backgroundMusic);\n            if (loaded.meta.objectMetadata) setObjectMetadata(loaded.meta.objectMetadata);\n            if (loaded.meta.weather) {\n                setWeatherRain(loaded.meta.weather.rain || 0);\n                setWeatherSnow(loaded.meta.weather.snow || 0);\n                setWeatherClouds(loaded.meta.weather.clouds || 0);\n                setWeatherFog(loaded.meta.weather.fog || 0);\n                setWeatherThunder(loaded.meta.weather.thunder || 0);\n                setWeatherLavaRain(loaded.meta.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(loaded.meta.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(loaded.meta.weather.meteorRain || 0);\n            }\n            if (loaded.meta.playerPosition) setPlayerPosition(loaded.meta.playerPosition);\n\n            errorHandler.info('Map loaded successfully (Converted to Project)', {\n                component: 'Editor',\n                mapName: loaded.meta.name\n            });\n        } else {\n            // Oldest format\n            if (loaded.width) setMapWidth(loaded.width);\n            if (loaded.height) setMapHeight(loaded.height);\n            if (loaded.tiles) setTileMapData(loaded.tiles);\n            setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n            errorHandler.warn('Loaded map in legacy format', {\n                component: 'Editor'\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'applyMapData'\n        });\n        alert('Error applying map data. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    ...setters\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                applyMapData(loaded, setters);\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const loadBuiltInMap = ({\n    mapData,\n    ...setters\n}) => {\n    try {\n        applyMapData(mapData, setters);\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'loadBuiltInMap'\n        });\n        alert('Error loading built-in map.');\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets, objectMetadata: oldMeta } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        if (!oldArr) return newArr;\n        const offsetY = newHeight - oldH;\n        for (let y = 0; y < newHeight; y++) {\n            const oldY = y - offsetY;\n            if (oldY < 0 || oldY >= oldH) continue;\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[oldY * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    const resizeMetadata = (oldM) => {\n        const newM = {};\n        if (!oldM) return newM;\n        const offsetY = newHeight - oldH;\n        for (let y = 0; y < newHeight; y++) {\n            const oldY = y - offsetY;\n            if (oldY < 0 || oldY >= oldH) continue;\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                const oldIdx = oldY * oldW + x;\n                const newIdx = y * newWidth + x;\n                if (oldM[oldIdx]) {\n                    newM[newIdx] = oldM[oldIdx];\n                }\n            }\n        }\n        return newM;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets));\n    setObjectMetadata(resizeMetadata(oldMeta));\n};\n","import React from 'react';\n\nexport const ObjectLinks = React.memo(({ mapWidth, mapHeight, objectMapData, objectMetadata }) => {\n    const links = [];\n    const portals = [];\n    const targets = [];\n\n    // Collect all portals and targets with Trigger IDs\n    objectMapData.forEach((id, index) => {\n        if (!id) return;\n        const metadata = objectMetadata?.[index];\n        if (!metadata || metadata.triggerId === undefined || metadata.triggerId === null) return;\n\n        const x = (index % mapWidth) * 32 + 16;\n        const y = Math.floor(index / mapWidth) * 32 + 16;\n\n        if (id.includes('portal') && !id.includes('target')) {\n            portals.push({ x, y, id: metadata.triggerId });\n        } else if (id.includes('target') || id === 'portal_target') {\n            targets.push({ x, y, id: metadata.triggerId });\n        }\n    });\n\n    // Draw lines between matching IDs\n    portals.forEach(p => {\n        targets.forEach(t => {\n            if (p.id === t.id) {\n                links.push(\n                    <line\n                        key={`link-${p.x}-${p.y}-${t.x}-${t.y}`}\n                        x1={p.x} y1={p.y}\n                        x2={t.x} y2={t.y}\n                        stroke=\"#fff\"\n                        strokeWidth=\"2\"\n                        strokeDasharray=\"5,5\"\n                    />\n                );\n            }\n        });\n    });\n\n    return (\n        <svg style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: mapWidth * 32,\n            height: mapHeight * 32, // Note: mapHeight must be available\n            zIndex: 10,\n            pointerEvents: 'none',\n            opacity: 0.6\n        }}>\n            {links}\n        </svg>\n    );\n});\n","import React from 'react';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const EditorTile = React.memo(({\n    index,\n    x, y,\n    activeTool,\n    tileObj,\n    objObj,\n    secretObj,\n    objectMetadata,\n    isHighlighted,\n    parentRegionIndex,\n    borderStyle,\n    bgStyle,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleResizeStart,\n    handleMoveStart,\n    filter,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages\n}) => {\n    const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n    const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n    const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n    const isQuicksandTile = !!(tileObj && tileObj.flags && tileObj.flags.quicksand);\n    const isWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.waterfall);\n    const isLavaWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.lava_waterfall);\n    const isRadioactiveWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_water);\n    const isRadioactiveWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_waterfall);\n\n    const actualIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n    const triggerId = objectMetadata?.[actualIndex]?.triggerId;\n    const intensity = objectMetadata?.[actualIndex]?.intensity;\n    const messageText = objectMetadata?.[actualIndex]?.message;\n    const i18nChapter = objectMetadata?.[actualIndex]?.i18nChapter;\n    const i18nId = objectMetadata?.[actualIndex]?.i18nId;\n    const i18nText = objObj?.type === 'message_trigger' ? getTutorialText(i18nChapter, i18nId) : '';\n    const resolvedMessageText = messageText || i18nText;\n    \n    // Dimensijas emam no tie indeksa, lai izvairtos no citu objektu (piem. Room Area) \n    // ietekmes uz 1x1 objektiem, kas atrodas to robes.\n    const width = Number(objectMetadata?.[index]?.width ?? objObj?.width ?? secretObj?.width ?? 1);\n    const height = Number(objectMetadata?.[index]?.height ?? objObj?.height ?? secretObj?.height ?? 1);\n\n    const handleMouseDown = (e) => {\n        // If we're clicking a tile that's part of a region, we should interact with the anchor\n        const targetIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n        \n        if (activeTool === 'move') {\n            const hasMovable = objectMetadata[targetIndex] || objObj || secretObj;\n            if (hasMovable) {\n                e.stopPropagation();\n                handleMoveStart(targetIndex);\n                return;\n            }\n        }\n        handleGridMouseDown(index, e);\n    };\n\n    const isResizable = React.useMemo(() => {\n        if (!objObj && !secretObj) return false;\n        \n        // Room areas (windows) on room maps are NOT resizable\n        if (secretObj && secretObj.subtype === 'room' && mapType === 'room') return false;\n\n        // Specifically requested to disable for these types, except Room Areas which MUST be resizable\n        if (secretObj && secretObj.type === 'secret' && secretObj.subtype !== 'room') return false;\n        if (objObj && (objObj.type === 'crack_block' || objObj.type === 'wolf_secret')) return false;\n        return true;\n    }, [objObj, secretObj, mapType]);\n\n    const hasObjectOrSecret = objObj || secretObj || (parentRegionIndex !== null);\n\n    return (\n        <div\n            onMouseDown={handleMouseDown}\n            onMouseEnter={() => handleGridMouseEnter(index)}\n            style={{\n                width: '32px',\n                height: '32px',\n                border: borderStyle,\n                backgroundColor: bgStyle,\n                position: 'relative',\n                boxSizing: 'border-box',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                overflow: 'visible',\n                cursor: (activeTool === 'move' && hasObjectOrSecret) ? 'grab' : 'default'\n            }}>\n            \n            {isHighlighted && parentRegionIndex === null && isResizable && (\n                <>\n                    {/* Resize Handles */}\n                    {/* Right */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'right'); }}\n                        style={{ position: 'absolute', right: `${-(width-1)*32 - 6}px`, top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Left */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'left'); }}\n                        style={{ position: 'absolute', left: '-6px', top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Bottom */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'bottom'); }}\n                        style={{ position: 'absolute', bottom: `${-(height-1)*32 - 6}px`, left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                    {/* Top */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'top'); }}\n                        style={{ position: 'absolute', top: '-6px', left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                </>\n            )}\n\n            {/* Tile Layer */}\n            {tileObj && (\n                <div style={{ filter: filter ? filter('tile') : 'none', transition: 'filter 0.3s ease' }}>\n                    {isLiquidTile ? (\n                        <div style={{\n                            width: '32px', height: '32px',\n                            background: isLavaWaterfallTile ? 'rgba(255, 204, 0, 0.7)' : (isLavaTile ? 'rgba(255, 204, 0, 0.7)' : (isWaterTile || isWaterfallTile ? 'rgba(58, 127, 184, 0.7)' : (isQuicksandTile ? 'rgba(218, 165, 32, 0.7)' : (isRadioactiveWaterTile || isRadioactiveWaterfallTile ? 'rgba(50, 205, 50, 0.7)' : 'rgba(0, 255, 255, 0.3)')))),\n                            display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: '8px'\n                        }}>\n                            {isLavaWaterfallTile ? 'L.FALL' : (isLavaTile ? 'LAVA' : (isRadioactiveWaterfallTile ? 'RADFALL' : (isRadioactiveWaterTile ? 'RAD' : (isWaterTile ? 'WATER' : (isWaterfallTile ? 'FALL' : (isQuicksandTile ? 'QUICK' : 'LIQ'))))))}\n                        </div>\n                    ) : (\n                        <AnimatedItem\n                            textures={tileObj.textures}\n                            texture={tileObj.texture}\n                            speed={tileObj.animationSpeed}\n                            spriteSheet={tileObj.spriteSheet}\n                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\n                        />\n                    )}\n                </div>\n            )}\n\n            {/* Secret Layer */}\n            {secretObj && (secretObj.subtype !== 'room' || isRoomAreaVisible || showRoomMapContent || activeTool === 'area' || mapType === 'room') && (\n                <div style={{\n                    position: 'absolute', \n                    top: '0', left: '0',\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: secretObj.filterColorInEditor || secretObj.filterColor || 'rgba(128, 0, 128, 0.4)',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    color: '#fff', fontSize: '10px', fontWeight: 'bold', zIndex: 2,\n                    filter: filter ? filter('secret') : 'none', transition: 'filter 0.3s ease',\n                    border: '1px dashed rgba(255,255,255,0.5)',\n                    boxSizing: 'border-box',\n                    pointerEvents: 'none'\n                }}>\n                    {mapType !== 'room' && (secretObj.editorIcon || 'SECRET')}\n                </div>\n            )}\n\n            {/* Object Layer */}\n            {objObj && (() => {\n                const renderOffsetX = Number(objObj?.render?.offsetX) || 0;\n                const renderOffsetY = Number(objObj?.render?.offsetY) || 0;\n                const overlapX = Number(objObj?.render?.overlapX) || 0;\n                const overlapY = Number(objObj?.render?.overlapY) || 0;\n                const isLargeDecoration = objObj.type === 'decoration' && (width > 1 || height > 1);\n                const isTree = objObj.editor?.group === 'trees';\n                const renderAboveOverride = objectMetadata?.[actualIndex]?.renderAbovePlayer;\n                const resolvedRenderAbove = renderAboveOverride !== undefined ? renderAboveOverride : objObj.renderAbovePlayer;\n                const treeLayerLabel = resolvedRenderAbove ? 'TREE: ABOVE PLAYER' : 'TREE: BEHIND PLAYER';\n                const anchorOffsetX = isLargeDecoration ? -Math.floor(width / 2) * 32 : 0;\n                const anchorOffsetY = isLargeDecoration ? -(height - 1) * 32 : 0;\n                const baseTop = objObj.type === 'decoration' ? 0 : 2;\n                const baseLeft = objObj.type === 'decoration' ? 0 : 2;\n                const baseWidth = objObj.type === 'decoration' ? (width * 32) : (width * 32 - 4);\n                const baseHeight = objObj.type === 'decoration' ? (height * 32) : (height * 32 - 4);\n                return (\n                <div style={{\n                    position: 'absolute', \n                    top: `${baseTop + renderOffsetY + anchorOffsetY - overlapY / 2}px`,\n                    left: `${baseLeft + renderOffsetX + anchorOffsetX - overlapX / 2}px`,\n                    width: `${baseWidth + overlapX}px`,\n                    height: `${baseHeight + overlapY}px`,\n                    zIndex: 3,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    filter: filter ? filter('object') : 'none', transition: 'filter 0.3s ease',\n                    pointerEvents: 'none' // Let clicks pass through to the tile for resizing handles\n                }}>\n                    {objObj.editorIcon ? (\n                        <span style={{\n                            fontSize: objObj.editorIcon === 'i18n' ? '12px' : '20px',\n                            width: '100%',\n                            height: '100%',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            backgroundColor: 'rgba(255,255,255,0.1)',\n                            border: '1px dashed rgba(255,255,255,0.3)',\n                            color: '#222',\n                            fontWeight: 700\n                        }}>{objObj.editorIcon}</span>\n                    ) : (\n                        <AnimatedItem\n                            textures={objObj.textures}\n                            texture={objObj.texture}\n                            speed={objObj.animationSpeed}\n                            spriteSheet={objObj.spriteSheet}\n                            frameIndex={objectMetadata?.[actualIndex]?.currentFrame !== undefined ? objectMetadata[actualIndex].currentFrame : (objObj.subtype === 'door' && mapType === 'room' ? (objObj.interaction?.frames?.inside || 2) : undefined)}\n                            style={{ \n                                width: '100%', \n                                height: '100%', \n                                objectFit: objObj.type === 'decoration' ? 'cover' : 'contain', \n                                backgroundColor: objObj.type === 'decoration' ? 'transparent' : 'rgba(255,255,255,0.1)', \n                                border: objObj.type === 'decoration' ? 'none' : '1px dashed rgba(255,255,255,0.3)' \n                            }}\n                        />\n                    )}\n\n                    {isTree && (\n                        <div style={{\n                            position: 'absolute',\n                            top: '-28px',\n                            left: '50%',\n                            transform: 'translateX(-50%)',\n                            backgroundColor: 'rgba(0,0,0,0.7)',\n                            color: '#fff',\n                            padding: '1px 6px',\n                            borderRadius: '3px',\n                            fontSize: '10px',\n                            whiteSpace: 'nowrap',\n                            zIndex: 12,\n                            border: '1px solid #fff'\n                        }}>\n                            {treeLayerLabel}\n                        </div>\n                    )}\n\n                    {objObj.type === 'message_trigger' && (\n                        <div style={{\n                            position: 'absolute',\n                            inset: '2px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            background: '#fff9c4',\n                            border: '1px solid #fbc02d',\n                            color: '#333',\n                            fontWeight: 700,\n                            fontSize: (objObj.editorIcon === 'i18n' || objObj.i18nMessage) ? '12px' : '18px'\n                        }}>\n                            {objObj.editorIcon || (objObj.i18nMessage ? 'i18n' : '')}\n                        </div>\n                    )}\n\n                    {/* Trigger ID */}\n                    {triggerId !== undefined && triggerId !== null && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', left: '0',\n                            backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 10, border: '1px solid #fff'\n                        }}>\n                            ID: {triggerId}\n                        </div>\n                    )}\n\n                    {/* Intensity */}\n                    {intensity !== undefined && intensity !== null && objObj && (objObj.type === 'weather_trigger' || objObj.hasIntensity) && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', right: '0',\n                            backgroundColor: 'rgba(0,100,200,0.8)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 11, border: '1px solid #fff'\n                        }}>\n                            {intensity}%\n                        </div>\n                    )}\n\n                    {/* Message Bubble */}\n                    {showMessages && objObj && objObj.type === 'message_trigger' && resolvedMessageText && (\n                        <div style={{\n                            position: 'absolute',\n                            left: '50%',\n                            bottom: '100%',\n                            transform: 'translateX(-50%)',\n                            marginBottom: '8px',\n                            maxWidth: '140px',\n                            backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                            color: '#222',\n                            border: '1px solid rgba(0,0,0,0.6)',\n                            borderRadius: '8px',\n                            padding: '4px 6px',\n                            fontSize: '10px',\n                            lineHeight: 1.2,\n                            textAlign: 'center',\n                            zIndex: 12,\n                            pointerEvents: 'none'\n                        }}>\n                            {resolvedMessageText}\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-6px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '6px solid transparent',\n                                borderRight: '6px solid transparent',\n                                borderTop: '6px solid rgba(255, 255, 255, 0.95)'\n                            }} />\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-7px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '7px solid transparent',\n                                borderRight: '7px solid transparent',\n                                borderTop: '7px solid rgba(0,0,0,0.6)',\n                                zIndex: -1\n                            }} />\n                        </div>\n                    )}\n                </div>\n                );\n            })()}\n\n            {/* Room Area Visibility Overlay */}\n            {(isRoomAreaVisible || showRoomMapContent || activeTool === 'area') && secretObj && secretObj.subtype === 'room' && mapType !== 'room' && (\n                <div style={{\n                    position: 'absolute',\n                    top: 0, left: 0,\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: 'rgba(255, 255, 0, 0.2)',\n                    border: '2px solid gold',\n                    boxSizing: 'border-box',\n                    zIndex: 4,\n                    pointerEvents: 'none',\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#000',\n                    fontSize: '10px',\n                    fontWeight: 'bold',\n                    textShadow: '0 0 2px #fff'\n                }}>\n                    <span style={{ fontSize: '14px' }}></span>\n                    <span style={{ whiteSpace: 'nowrap' }}>{objectMetadata?.[actualIndex]?.roomName || 'Unnamed'}</span>\n                    <span style={{ fontSize: '9px' }}>{width}x{height}m</span>\n                </div>\n            )}\n        </div>\n    );\n});\n","import React, { useCallback, useRef, useState } from 'react';\nimport { ObjectLinks } from './viewport/ObjectLinks';\nimport { EditorTile } from './viewport/EditorTile';\nimport PixiStage from '../game/PixiStage';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    registryItems,\n    hoverIndex,\n    highlightedIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    handleResizeStart,\n    handleMoveStart,\n    setIsDragging,\n    selectedTile,\n    weatherRain,\n    weatherSnow,\n    weatherClouds,\n    weatherFog,\n    weatherThunder,\n    weatherLavaRain,\n    weatherRadioactiveFog,\n    weatherMeteorRain,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages,\n    maps\n}) => {\n    const isEraserActive = activeTool === 'brush' && selectedTile === null;\n    const isBrushActive = activeTool === 'brush';\n    const isBucketActive = activeTool === 'bucket';\n    const tileSize = 32;\n    const gridRef = useRef(null);\n    const [cursorIndex, setCursorIndex] = useState(null);\n\n    const regions = React.useMemo(() => {\n        const res = [];\n        if (!objectMetadata) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            if (meta.width > 1 || meta.height > 1) {\n                const idx = parseInt(idxStr);\n                res.push({ \n                    idx, \n                    x: idx % mapWidth, \n                    y: Math.floor(idx / mapWidth), \n                    w: meta.width || 1, \n                    h: meta.height || 1 \n                });\n            }\n        }\n        return res;\n    }, [objectMetadata, mapWidth]);\n\n    const roomAreas = React.useMemo(() => {\n        const res = [];\n        if (!secretMapData || !objectMetadata || !showRoomMapContent) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                res.push({\n                    id: meta.linkedMapId,\n                    x: idx % mapWidth,\n                    y: Math.floor(idx / mapWidth),\n                    width: meta.width || 1,\n                    height: meta.height || 1,\n                    mapData: maps[meta.linkedMapId]\n                });\n            }\n        }\n        return res;\n    }, [secretMapData, objectMetadata, showRoomMapContent, maps, mapWidth]);\n\n    const getLayerColor = (layer, alpha = 0.5) => {\n        if (layer === 'tile') return `rgba(24, 144, 255, ${alpha})`;\n        if (layer === 'object') return `rgba(245, 34, 45, ${alpha})`;\n        if (layer === 'secret') return `rgba(114, 46, 209, ${alpha})`;\n        return `rgba(255, 255, 255, ${alpha})`;\n    };\n\n    const getGridStyles = () => {\n        let color = 'rgba(255, 255, 255, 0.15)';\n        let visible = showGrid;\n\n        if (isEraserActive) {\n            color = getLayerColor(activeLayer, 0.4);\n            visible = true;\n        } else if (isBrushActive || isBucketActive) {\n            color = getLayerColor(activeLayer, 0.25);\n            visible = true; // Auto-show grid when using drawing tools\n        }\n\n        return {\n            backgroundImage: visible ? `\n                linear-gradient(to right, ${color} 1px, transparent 1px),\n                linear-gradient(to bottom, ${color} 1px, transparent 1px)\n            ` : 'none',\n            backgroundSize: '32px 32px'\n        };\n    };\n\n    const getLayerFilter = useCallback((layer) => {\n        if (!isEraserActive) return 'none';\n        return activeLayer === layer ? 'none' : 'grayscale(100%) opacity(0.2) blur(2px)';\n    }, [isEraserActive, activeLayer]);\n\n    const getPlacementAnchor = useCallback((tile, layer) => {\n        if (!tile) return { x: 0, y: 0 };\n        if (layer !== 'object' && layer !== 'props') return { x: 0, y: 0 };\n        const width = Number(tile.width ?? 1);\n        const height = Number(tile.height ?? 1);\n        if (tile.type === 'decoration' && (width > 1 || height > 1)) {\n            return { x: Math.floor(width / 2), y: height - 1 };\n        }\n        return { x: 0, y: 0 };\n    }, []);\n\n    const handleGridMouseMove = useCallback((event) => {\n        const rect = gridRef.current ? gridRef.current.getBoundingClientRect() : event.currentTarget.getBoundingClientRect();\n        const localX = event.clientX - rect.left;\n        const localY = event.clientY - rect.top;\n        if (localX < 0 || localY < 0 || localX >= mapWidth * tileSize || localY >= mapHeight * tileSize) {\n            handleGridMouseLeave();\n            setCursorIndex(null);\n            return;\n        }\n        const gridX = Math.floor(localX / tileSize);\n        const gridY = Math.floor(localY / tileSize);\n        if (gridX < 0 || gridY < 0 || gridX >= mapWidth || gridY >= mapHeight) return;\n        const nextIndex = gridY * mapWidth + gridX;\n        setCursorIndex(prev => (prev === nextIndex ? prev : nextIndex));\n        handleGridMouseEnter(nextIndex);\n    }, [handleGridMouseEnter, handleGridMouseLeave, mapWidth, mapHeight, tileSize]);\n\n    const getOverlayColor = () => {\n        if (!isEraserActive) return 'transparent';\n        if (activeLayer === 'tile') return 'rgba(24, 144, 255, 0.25)'; // Blueish for blocks\n        if (activeLayer === 'object') return 'rgba(245, 34, 45, 0.25)'; // Reddish for objects\n        if (activeLayer === 'secret') return 'rgba(114, 46, 209, 0.25)'; // Purplish for secrets\n        return 'transparent';\n    };\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => handleGridMouseUp(hoverIndex)}\n            onMouseMove={handleGridMouseMove}\n            onContextMenu={(e) => e.preventDefault()}>\n            <div\n                style={{\n                    position: 'relative',\n                    width: mapWidth * tileSize,\n                    height: mapHeight * tileSize,\n                    overflow: 'hidden'\n                }}\n                onMouseLeave={() => {\n                    handleGridMouseLeave();\n                    setCursorIndex(null);\n                }}\n            >\n                \n                <ObjectLinks \n                    mapWidth={mapWidth} \n                    mapHeight={mapHeight} \n                    objectMapData={objectMapData} \n                    objectMetadata={objectMetadata} \n                />\n\n                {/* Room Map Content Overlay */}\n                {showRoomMapContent && roomAreas.map(room => (\n                    <div\n                        key={room.id}\n                        style={{\n                            position: 'absolute',\n                            left: room.x * 32,\n                            top: room.y * 32,\n                            width: room.width * 32,\n                            height: room.height * 32,\n                            zIndex: 6,\n                            pointerEvents: 'none',\n                            overflow: 'hidden',\n                            boxShadow: '0 0 15px rgba(0,0,0,0.5)',\n                            border: '2px solid #f39c12'\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={room.mapData.mapWidth}\n                            mapHeight={room.mapData.mapHeight}\n                            tileSize={32}\n                            tileMapData={room.mapData.tileMapData || []}\n                            objectMapData={room.mapData.objectMapData || []}\n                            secretMapData={room.mapData.secretMapData || []}\n                            objectMetadata={room.mapData.objectMetadata || {}}\n                            registryItems={registryItems}\n                            backgroundColor={room.mapData.selectedBackgroundColor}\n                            backgroundImage={room.mapData.selectedBackgroundImage}\n                            backgroundParallaxFactor={room.mapData.backgroundParallaxFactor}\n                            isEditor={true}\n                            mapType={room.mapData.type || 'room'}\n                        />\n                    </div>\n                ))}\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        backgroundImage: (selectedBackgroundUrl && showBackgroundImage && !isEraserActive) ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: (isEraserActive || !showBackgroundImage || !selectedBackgroundUrl) ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x', backgroundSize: 'auto 100%',\n                        zIndex: 0, pointerEvents: 'none'\n                    }}\n                />\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        backgroundColor: getOverlayColor(),\n                        zIndex: 5, pointerEvents: 'none',\n                        transition: 'background-color 0.3s ease'\n                    }}\n                />\n\n                {/* Top Grid Overlay */}\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        zIndex: 10, pointerEvents: 'none',\n                        ...getGridStyles()\n                    }}\n                />\n\n                {isBrushActive && selectedTile && (activeLayer === 'object' || activeLayer === 'props') && (cursorIndex !== null || hoverIndex !== null) && (\n                    (() => {\n                        const previewIndex = cursorIndex !== null ? cursorIndex : hoverIndex;\n                        const anchor = getPlacementAnchor(selectedTile, activeLayer);\n                        const gridX = previewIndex % mapWidth;\n                        const gridY = Math.floor(previewIndex / mapWidth);\n                        const previewX = (gridX - anchor.x) * tileSize;\n                        const previewY = (gridY - anchor.y) * tileSize;\n                        const previewW = Number(selectedTile.width ?? 1) * tileSize;\n                        const previewH = Number(selectedTile.height ?? 1) * tileSize;\n                        const renderOffsetX = Number(selectedTile?.render?.offsetX) || 0;\n                        const renderOffsetY = Number(selectedTile?.render?.offsetY) || 0;\n                        const overlapX = Number(selectedTile?.render?.overlapX) || 0;\n                        const overlapY = Number(selectedTile?.render?.overlapY) || 0;\n\n                        return (\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    top: 0,\n                                    left: 0,\n                                    width: mapWidth * tileSize,\n                                    height: mapHeight * tileSize,\n                                    overflow: 'hidden',\n                                    pointerEvents: 'none',\n                                    zIndex: 9\n                                }}\n                            >\n                                <div\n                                    style={{\n                                        position: 'absolute',\n                                        left: previewX + renderOffsetX - overlapX / 2,\n                                        top: previewY + renderOffsetY - overlapY / 2,\n                                        width: previewW + overlapX,\n                                        height: previewH + overlapY,\n                                        opacity: 0.6,\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center'\n                                    }}\n                                >\n                                    <AnimatedItem\n                                        textures={selectedTile.textures}\n                                        texture={selectedTile.texture}\n                                        speed={selectedTile.animationSpeed}\n                                        spriteSheet={selectedTile.spriteSheet}\n                                        style={{\n                                            width: '100%',\n                                            height: '100%',\n                                            objectFit: selectedTile.type === 'decoration' ? 'cover' : 'contain'\n                                        }}\n                                        alt={selectedTile.name}\n                                    />\n                                </div>\n                            </div>\n                        );\n                    })()\n                )}\n\n                {/* Weather Effects Overlay */}\n                {(weatherRain > 0 || weatherSnow > 0 || weatherClouds > 0 || weatherFog > 0 || weatherThunder > 0 || weatherLavaRain > 0 || weatherRadioactiveFog > 0 || weatherMeteorRain > 0) && (\n                    <div\n                        style={{\n                            position: 'absolute', top: 0, left: 0,\n                            width: mapWidth * 32, height: mapHeight * 32,\n                            zIndex: 15, pointerEvents: 'none',\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={[]}\n                            objectMapData={[]}\n                            registryItems={registryItems}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            renderLayers={['weather']}\n                            pointerEvents=\"none\"\n                        />\n                    </div>\n                )}\n\n                <div className=\"grid\"\n                    ref={gridRef}\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px', border: '1px solid #444', backgroundColor: 'transparent',\n                        position: 'relative', cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}\n                    onMouseMove={handleGridMouseMove}\n                    onContextMenu={(e) => e.preventDefault()}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        let dTileId = tileMapData[index];\n                        let dObjId = objectMapData[index];\n                        let dSecId = secretMapData?.[index];\n\n                        if (selection && previewPosition) {\n                            const { w, h } = selection;\n                            const px = previewPosition.x;\n                            const py = previewPosition.y;\n                            if (x >= px && x < px + w && y >= py && y < py + h) {\n                                const idx = (y - py) * w + (x - px);\n                                dTileId = selection.tileData[idx];\n                                dObjId = selection.objectData[idx];\n                                dSecId = selection.secretData?.[idx];\n                            }\n                        }\n\n                        const tileObj = dTileId ? registryItems.find(r => r.id === dTileId) : null;\n                        const objObj = dObjId ? registryItems.find(r => r.id === dObjId) : null;\n                        const secretObj = dSecId ? registryItems.find(r => r.id === dSecId) : null;\n\n                        let borderStyle = 'none';\n                        let bgStyle = 'transparent';\n\n                        const layerColor = getLayerColor(activeLayer, 1);\n\n                        if (activeTool === 'brush' && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) {\n                                borderStyle = `1px dashed ${layerColor}`;\n                                if (isEraserActive) bgStyle = 'rgba(255, 0, 0, 0.1)';\n                            }\n                        } else if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                            else if (hoverIndex === index) borderStyle = '2px solid orange';\n                        } else if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid blue';\n                        } else if (activeTool === 'area') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { \n                                    borderStyle = '1px dashed gold'; \n                                    bgStyle = 'rgba(255, 255, 0, 0.2)'; \n                                }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid gold';\n                        }\n\n                        if (highlightedIndex === index) { borderStyle = '3px solid gold'; bgStyle = 'rgba(255, 215, 0, 0.4)'; }\n                        \n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                borderStyle = '2px solid cyan'; bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red'; bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n\n                        const parentRegion = regions.find(r => x >= r.x && x < r.x + r.w && y >= r.y && y < r.y + r.h);\n\n                        return (\n                            <EditorTile \n                                key={index}\n                                index={index}\n                                x={x} y={y}\n                                activeTool={activeTool}\n                                tileObj={tileObj}\n                                objObj={objObj}\n                                secretObj={secretObj}\n                                objectMetadata={objectMetadata}\n                                isHighlighted={highlightedIndex === index || (parentRegion && highlightedIndex === parentRegion.idx)}\n                                parentRegionIndex={parentRegion ? parentRegion.idx : null}\n                                borderStyle={borderStyle}\n                                bgStyle={bgStyle}\n                                handleGridMouseDown={handleGridMouseDown}\n                                handleGridMouseEnter={handleGridMouseEnter}\n                                handleResizeStart={handleResizeStart}\n                                handleMoveStart={handleMoveStart}\n                                filter={getLayerFilter}\n                                mapType={mapType}\n                                isRoomAreaVisible={isRoomAreaVisible}\n                                showRoomMapContent={showRoomMapContent}\n                                showMessages={showMessages}\n                            />\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const EditorToolsContainer = styled.div`\n    display: contents;\n`;\n\nexport const HeaderBar = styled.div`\n    padding: 0 15px;\n    background-color: #222;\n    border-bottom: none;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 60px;\n    box-sizing: border-box;\n    color: #fff;\n    z-index: 1105;\n    position: relative;\n\n    &::after {\n        content: \"\";\n        position: absolute;\n        left: 60px;\n        right: 0;\n        bottom: 0;\n        height: 1px;\n        background-color: #000;\n        pointer-events: none;\n    }\n`;\n\nexport const ToolsSection = styled.div`\n    display: flex;\n    gap: 15px;\n    align-items: center;\n`;\n\nexport const ToolsGroup = styled.div`\n    display: flex;\n    gap: 10px;\n    align-items: center;\n`;\n\nexport const ToolsInnerGroup = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsRow = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsEditorButton = styled.button`\n    min-width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : (props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : (props.$variant === 'danger' ? '#dc3545' : (props.$variant === 'secondary' ? '#f0f0f0' : '#333'))))};\n    color: ${props => props.$variant === 'secondary' ? '#333' : '#fff'};\n    border: 1px solid ${props => props.$active ? '#1E88E5' : (props.$variant === 'play' ? '#388E3C' : (props.$variant === 'pause' ? '#F57C00' : (props.$variant === 'danger' ? '#c82333' : (props.$variant === 'secondary' ? '#ccc' : '#fff'))))};\n    border-radius: 4px;\n    font-size: ${props => props.$small ? '14px' : '20px'};\n    font-weight: ${props => props.$variant === 'play' || props.$variant === 'pause' ? 'bold' : 'normal'};\n    line-height: 1;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: ${props => props.$square ? '0' : '0 15px'};\n    width: ${props => props.$square ? '40px' : 'auto'};\n    outline: none;\n    user-select: none;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : (props.$variant === 'play' ? '#45a049' : (props.$variant === 'pause' ? '#fb8c00' : (props.$variant === 'danger' ? '#bd2130' : (props.$variant === 'secondary' ? '#e0e0e0' : '#444'))))};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n\n    span {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n`;\n\nexport const StrikeThrough = styled.div`\n    position: absolute;\n    width: 100%;\n    height: 2px;\n    background-color: #f5222d;\n    transform: rotate(-45deg);\n    top: 50%;\n    left: 0;\n    z-index: 2;\n    pointer-events: none;\n`;\n\nexport const LayerIndicator = styled.div`\n    padding: 0 12px;\n    height: 40px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    font-size: 11px;\n    font-weight: 800;\n    text-transform: uppercase;\n    margin-right: 15px;\n    margin-left: 15px;\n    white-space: nowrap;\n    border: 1px solid;\n    box-sizing: border-box;\n    background-color: ${props => props.$bgColor || '#e6f7ff'};\n    border-color: ${props => props.$borderColor || '#91d5ff'};\n    color: ${props => props.$textColor || '#1890ff'};\n`;\n\nexport const BgColorContainer = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n`;\n\nexport const BgColorInputWrapper = styled.div`\n    position: relative;\n    display: flex;\n    align-items: center;\n`;\n\nexport const BgColorInput = styled.input`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    opacity: ${props => props.disabled ? 0.4 : 1};\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n`;\n\nexport const BgTransparentButton = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &::after {\n        content: \"\";\n        width: 100%;\n        height: 100%;\n        background-image: \n            linear-gradient(45deg, #ccc 25%, transparent 25%), \n            linear-gradient(-45deg, #ccc 25%, transparent 25%), \n            linear-gradient(45deg, transparent 75%, #ccc 75%), \n            linear-gradient(-45deg, transparent 75%, #ccc 75%);\n        background-size: 8px 8px;\n        background-position: 0 0, 0 4px, 4px 4px, 4px 0;\n        background-color: #fff;\n        opacity: 0.8;\n        border-radius: 2px;\n    }\n`;\n\nexport const PlayButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const PlayButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : '#333')};\n    color: #fff;\n    font-size: 18px;\n    box-sizing: border-box;\n`;\n\nexport const InfoContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    align-items: flex-start;\n    color: #bbb;\n    margin-left: auto;\n`;\n\nexport const InfoItem = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nexport const InfoLabel = styled.span`\n    font-size: 11px;\n    text-transform: uppercase;\n    opacity: 0.8;\n`;\n\nexport const InfoValue = styled.span`\n    color: #fff;\n    font-size: 12px;\n`;\n\nexport const EraserButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    //cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const EraserButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$active ? (props.$textColor || '#1890ff') : (props.$bgColor || '#f0f0f0')};\n    color: ${props => props.$active ? '#fff' : (props.$textColor || '#000')};\n    font-size: 11px;\n    font-weight: bold;\n    border: ${props => props.$active ? '1px solid #fff' : 'none'};\n    box-sizing: border-box;\n`;\n\nexport const SelectionActions = styled.div`\n    display: flex;\n    gap: 5px;\n    margin-left: 5px;\n    border-left: 1px solid #ccc;\n    padding-left: 5px;\n`;\n\nexport const ConfirmButton = styled(ToolsEditorButton)`\n    background-color: #e6f7ff;\n    color: #1890ff;\n    \n    &:hover {\n        background-color: #bae7ff;\n    }\n`;\n\nexport const CancelButton = styled(ToolsEditorButton)`\n    background-color: #fff1f0;\n    color: #f5222d;\n\n    &:hover {\n        background-color: #ffccc7;\n    }\n`;\n\nexport const GridIcon = styled.span`\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n`;\n","import styled from 'styled-components';\n\n/*\n* Container*/\nexport const SidebarContainer = styled.div`\n    width: 60px;\n    height: 100%;\n    background-color: #222;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding-top: 10px;\n    z-index: 1100;\n    border-right: 1px solid #000;\n    flex-shrink: 0;\n    overflow-y: auto;\n\n    &::-webkit-scrollbar {\n        width: 0px;\n        background: transparent;\n    }\n    \n    -ms-overflow-style: none;\n    scrollbar-width: none;\n`;\n\nexport const ElementEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const PanelContainer = styled.div`\n    position: absolute;\n    left: 60px;\n    top: 60px;\n    width: 320px;\n    height: calc(100% - 60px);\n    background-color: #fff;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    z-index: 1090;\n    box-shadow: 4px 0 10px rgba(0,0,0,0.2);\n    \n    /* Animation settings */\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;\n    transform: ${props => props.$isOpen ? 'translateX(0)' : 'translateX(-110%)'};\n    opacity: ${props => props.$isOpen ? '1' : '0'};\n    pointer-events: ${props => props.$isOpen ? 'all' : 'none'};\n`;\n\nexport const PanelHeader = styled.div`\n    padding: 8px 15px;\n    background-color: #f0f0f0;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 32px;\n    box-sizing: border-box;\n    color: #333;\n\n    span {\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n`;\n\nexport const PanelBody = styled.div`\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n`;\n\nexport const CloseButton = styled.button`\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 16px;\n    padding: 0 5px;\n    color: #666;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    outline: none;\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nexport const OperationButton = styled.button`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: ${props => props.$danger ? '#d32f2f' : '#000'};\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n    outline: none;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n\n// Also exporting as a label for file input usage in OperationsPanel\nexport const OperationLabel = styled.label`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: #000;\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n","import React from 'react';\nimport { ToolsEditorButton } from '../styles/EditorToolsButton';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    tempMapDescription,\n    setTempMapDescription,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', borderRadius: '8px',\n                boxShadow: '0 8px 24px rgba(0,0,0,0.2)', width: '320px',\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\n            }}>\n                <div style={{\n                    padding: '12px 15px',\n                    borderBottom: '2px solid #eee',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                }}>\n                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 'bold', color: '#333' }}>Create New Map</h3>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </div>\n\n                <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Map Name:</label>\n                        <input\n                            type=\"text\"\n                            value={tempMapName}\n                            onChange={(e) => setTempMapName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Creator Nickname:</label>\n                        <input\n                            type=\"text\"\n                            value={tempCreatorName}\n                            onChange={(e) => setTempCreatorName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Description:</label>\n                        <textarea\n                            value={tempMapDescription}\n                            onChange={(e) => setTempMapDescription(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box', minHeight: '60px', resize: 'vertical' }}\n                        />\n                    </div>\n\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                        <ToolsEditorButton onClick={onClose} $variant=\"secondary\" $small>\n                            Cancel\n                        </ToolsEditorButton>\n                        <ToolsEditorButton onClick={() => confirmNewMap(tempMapName, tempCreatorName, tempMapDescription)} $variant=\"play\" $small>\n                            Create\n                        </ToolsEditorButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { BUILT_IN_MAPS } from '../../../../constants/builtInMaps';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalHeader = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    font-size: 24px;\n    color: #333;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nexport const BuiltInMapsModal = ({ isOpen, onClose, onSelect }) => {\n    if (!isOpen) return null;\n\n    return (\n        <ModalOverlay onClick={onClose}>\n            <ModalContent onClick={e => e.stopPropagation()}>\n                <ModalHeader>\n                    <ModalTitle>Select a Built-in Map to Edit</ModalTitle>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </ModalHeader>\n                \n                <MapList>\n                    {BUILT_IN_MAPS.map((map, index) => {\n                        const isV2 = map.meta?.version === \"2.0\";\n                        const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                        const author = map.meta?.author || \"Unknown\";\n                        const description = map.meta?.description || \"\";\n                        \n                        let sizeInfo = \"\";\n                        let subMapInfo = \"\";\n\n                        if (isV2 && map.maps) {\n                            const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                            if (mainMap) {\n                                sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                            }\n                            \n                            const mapValues = Object.values(map.maps);\n                            const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                            const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                            \n                            subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                        } else {\n                            sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                        }\n\n                        return (\n                            <MapCard key={index} onClick={() => {\n                                onSelect(map);\n                                onClose();\n                            }}>\n                                <div>\n                                    <MapTitle>{projectName}</MapTitle>\n                                    <MapAuthor>By: {author}</MapAuthor>\n                                </div>\n                                {description && (\n                                    <MapDescription title={description}>\n                                        {description}\n                                    </MapDescription>\n                                )}\n                                <MapInfo>\n                                    <div>Size: {sizeInfo}{subMapInfo}</div>\n                                </MapInfo>\n                            </MapCard>\n                        );\n                    })}\n                </MapList>\n            </ModalContent>\n        </ModalOverlay>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nlet topZIndex = 1002;\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [position] = useState(defaultPosition);\n    const [zIndex, setZIndex] = useState(() => {\n        topZIndex += 1;\n        return topZIndex;\n    });\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    const lastHeightRef = useRef(0);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            if (height !== lastHeightRef.current) {\n                lastHeightRef.current = height;\n                onHeightChange(height);\n            }\n        }\n    });\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            topZIndex += 1;\n            setZIndex(topZIndex);\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#fff',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n                zIndex: zIndex,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh',\n                overflow: 'hidden'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '12px 15px',\n                    backgroundColor: '#fff',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '18px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '2px solid #eee',\n                    color: '#333'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0,\n                            color: '#333'\n                        }}\n                        title={isMinimized ? t('EDITOR_SCENE_WINDOW_MAXIMIZE') : t('EDITOR_SCENE_WINDOW_MINIMIZE')}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            color: '#333',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title={t('EDITOR_SCENE_WINDOW_CLOSE')}\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '15px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const EditorMapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const MIN_SIZE = 5;\n    const MAX_WIDTH = 300;\n    const MAX_HEIGHT = 100;\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n    const [inputSize, setInputSize] = useState({ width: String(mapWidth), height: String(mapHeight) });\n\n    useEffect(() => {\n        setInputSize({ width: String(mapWidth), height: String(mapHeight) });\n    }, [mapWidth, mapHeight]);\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(MIN_SIZE, Math.min(MAX_WIDTH, startSize.width + blocksX));\n            const newHeight = Math.max(MIN_SIZE, Math.min(MAX_HEIGHT, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    const parseSize = (value) => {\n        const parsed = Number(value);\n        if (!Number.isFinite(parsed)) return null;\n        return Math.round(parsed);\n    };\n\n    const applyInputResize = () => {\n        const widthValue = parseSize(inputSize.width);\n        const heightValue = parseSize(inputSize.height);\n\n        if (widthValue === null || heightValue === null) {\n            setInputSize({ width: String(mapWidth), height: String(mapHeight) });\n            return;\n        }\n\n        const newWidth = Math.max(MIN_SIZE, Math.min(MAX_WIDTH, widthValue));\n        const newHeight = Math.max(MIN_SIZE, Math.min(MAX_HEIGHT, heightValue));\n\n        setInputSize({ width: String(newWidth), height: String(newHeight) });\n        if (newWidth !== mapWidth || newHeight !== mapHeight) {\n            onResize(newWidth, newHeight);\n        }\n    };\n\n    const handleInputKeyDown = (e) => {\n        if (e.key === 'Enter') {\n            e.preventDefault();\n            applyInputResize();\n        }\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                {t('EDITOR_SCENE_RESIZER_LABEL')}{' '}\n                <span style={{ color: '#4CAF50' }}>{mapWidth} x {mapHeight}</span>{' '}\n                {t('EDITOR_SCENE_RESIZER_BLOCKS')}\n            </div>\n\n            <div style={{ display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: '8px' }}>\n                <label style={{ display: 'flex', flexDirection: 'column', gap: '4px', fontSize: '11px', color: '#555' }}>\n                    {t('EDITOR_SCENE_RESIZER_WIDTH')}\n                    <input\n                        type=\"number\"\n                        min={MIN_SIZE}\n                        max={MAX_WIDTH}\n                        step=\"1\"\n                        value={inputSize.width}\n                        onChange={(e) => setInputSize(prev => ({ ...prev, width: e.target.value }))}\n                        onKeyDown={handleInputKeyDown}\n                        style={{ width: '72px', padding: '4px 6px', borderRadius: '4px', border: '1px solid #ccc' }}\n                    />\n                </label>\n                <span style={{ fontSize: '14px', color: '#666', paddingBottom: '6px' }}></span>\n                <label style={{ display: 'flex', flexDirection: 'column', gap: '4px', fontSize: '11px', color: '#555' }}>\n                    {t('EDITOR_SCENE_RESIZER_HEIGHT')}\n                    <input\n                        type=\"number\"\n                        min={MIN_SIZE}\n                        max={MAX_HEIGHT}\n                        step=\"1\"\n                        value={inputSize.height}\n                        onChange={(e) => setInputSize(prev => ({ ...prev, height: e.target.value }))}\n                        onKeyDown={handleInputKeyDown}\n                        style={{ width: '72px', padding: '4px 6px', borderRadius: '4px', border: '1px solid #ccc' }}\n                    />\n                </label>\n                <button\n                    type=\"button\"\n                    onClick={applyInputResize}\n                    style={{\n                        padding: '6px 10px',\n                        borderRadius: '4px',\n                        border: '1px solid #4CAF50',\n                        backgroundColor: '#4CAF50',\n                        color: '#fff',\n                        cursor: 'pointer',\n                        fontSize: '11px',\n                        fontWeight: 'bold'\n                    }}\n                >\n                    {t('EDITOR_SCENE_RESIZER_APPLY')}\n                </button>\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: 2,\n                        right: 2,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 {t('EDITOR_SCENE_RESIZER_HINT_LINE1')}<br/>\n                {t('EDITOR_SCENE_RESIZER_HINT_LINE2')}\n            </div>\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundColor\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = backgroundColor || '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.lava_waterfall) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.radioactive_waterfall) {\n                                ctx.fillStyle = '#32cd32';\n                            } else if (tile.flags.waterfall) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.water) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.quicksand) {\n                                ctx.fillStyle = '#a6915b';\n                            } else if (tile.flags.radioactive_water) {\n                                ctx.fillStyle = '#32cd32';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n        // Draw connections between portals and targets\n        if (objectMetadata) {\n            const portals = [];\n            const targets = [];\n\n            for (let i = 0; i < mapWidth * mapHeight; i++) {\n                const id = objectMapData[i];\n                if (!id) continue;\n                const metadata = objectMetadata[i];\n                if (!metadata || metadata.triggerId === null || metadata.triggerId === undefined) continue;\n\n                const pos = {\n                    x: (i % mapWidth) * tileWidth + tileWidth / 2,\n                    y: Math.floor(i / mapWidth) * tileHeight + tileHeight / 2\n                };\n\n                if (id.includes('portal') && !id.includes('target')) {\n                    portals.push({ triggerId: metadata.triggerId, pos });\n                } else if (id.includes('target') || id === 'portal_target') {\n                    targets.push({ triggerId: metadata.triggerId, pos });\n                }\n            }\n\n            portals.forEach(portal => {\n                const target = targets.find(t => t.triggerId === portal.triggerId);\n                if (target) {\n                    ctx.beginPath();\n                    ctx.setLineDash([5, 3]);\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.moveTo(portal.pos.x, portal.pos.y);\n                    ctx.lineTo(target.pos.x, target.pos.y);\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n                }\n            });\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, objectMetadata, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useRef, useEffect, useMemo, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WorldView = ({\n    maps,\n    activeMapId,\n    switchMap,\n    registryItems,\n    currentMapData,\n    createMap,\n    deleteMap,\n    updateMapData,\n    onAddRoomArea,\n    showRoomMapContent\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const canvasRef = useRef(null);\n    const containerRef = useRef(null);\n    const mapLayoutsRef = useRef({});\n    const dragRef = useRef(null); // { id, startX, startY, mapStartX, mapStartY }\n\n    // Prepare all maps data, using live data for the active map\n    const allMaps = useMemo(() => {\n        const result = { ...maps };\n        if (currentMapData && currentMapData.id && result[currentMapData.id]) {\n            result[currentMapData.id] = {\n                ...result[currentMapData.id],\n                mapWidth: currentMapData.mapWidth,\n                mapHeight: currentMapData.mapHeight,\n                tileMapData: currentMapData.tileMapData,\n                objectMapData: currentMapData.objectMapData,\n                objectMetadata: currentMapData.objectMetadata,\n                selectedBackgroundColor: currentMapData.selectedBackgroundColor\n            };\n        }\n        return Object.values(result);\n    }, [maps, currentMapData]);\n\n    // Draw function\n    const draw = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        \n        // Settings\n        const baseTileSize = 4; // Each tile in world view\n        \n        // Sync mapLayoutsRef with allMaps, but preserve positions for maps being dragged\n        const layouts = mapLayoutsRef.current;\n        \n        // Remove layouts for deleted maps\n        const currentIds = new Set(allMaps.map(m => m.id));\n        Object.keys(layouts).forEach(id => {\n            if (!currentIds.has(id)) {\n                delete layouts[id];\n            }\n        });\n\n        allMaps.forEach(map => {\n            const isDragging = dragRef.current && dragRef.current.id === map.id;\n            const w = map.mapWidth * baseTileSize;\n            const h = map.mapHeight * baseTileSize;\n\n            if (!layouts[map.id]) {\n                layouts[map.id] = { x: map.worldX || 0, y: map.worldY || 0, w, h, map };\n            } else {\n                layouts[map.id].w = w;\n                layouts[map.id].h = h;\n                layouts[map.id].map = map;\n                // Update position from props ONLY if not currently dragging this map\n                if (!isDragging) {\n                    layouts[map.id].x = map.worldX || 0;\n                    layouts[map.id].y = map.worldY || 0;\n                }\n            }\n        });\n\n        // Clear\n        ctx.fillStyle = '#222';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Grid (optional but helpful)\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 1;\n        for (let x = 0; x < canvas.width; x += 50) {\n            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();\n        }\n        for (let y = 0; y < canvas.height; y += 50) {\n            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();\n        }\n\n        // 1. Draw Maps\n        Object.values(layouts).forEach(layout => {\n            const { x, y, w, h, map } = layout;\n            const tileW = w / map.mapWidth;\n            const tileH = h / map.mapHeight;\n\n            // Background\n            ctx.fillStyle = map.selectedBackgroundColor || '#87CEEB';\n            ctx.fillRect(x, y, w, h);\n\n            // Active indicator\n            if (map.id === activeMapId) {\n                ctx.strokeStyle = '#e3de0a';\n                ctx.lineWidth = 3;\n                ctx.strokeRect(x - 4, y - 4, w + 8, h + 8);\n            } else {\n                ctx.strokeStyle = '#555';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, w, h);\n            }\n\n            // Name\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px Arial';\n            ctx.fillText(map.name, x, y - 10);\n            ctx.font = '10px Arial';\n            ctx.fillStyle = '#aaa';\n            ctx.fillText(map.type, x, y + h + 12);\n\n            // Delete button (X)\n            if (map.id !== 'main') {\n                ctx.fillStyle = '#ff4d4f';\n                ctx.fillRect(x + w - 15, y - 25, 15, 15);\n                ctx.fillStyle = '#fff';\n                ctx.font = 'bold 12px Arial';\n                ctx.fillText('', x + w - 11, y - 13);\n            }\n\n            // Draw Tiles & Objects (simplified)\n            for (let i = 0; i < map.mapWidth * map.mapHeight; i++) {\n                const tx = (i % map.mapWidth) * tileW + x;\n                const ty = Math.floor(i / map.mapWidth) * tileH + y;\n\n                const tileId = map.tileMapData[i];\n                const objId = map.objectMapData[i];\n                const secretId = map.secretMapData ? map.secretMapData[i] : null;\n                const meta = map.objectMetadata ? map.objectMetadata[i] : null;\n\n                // If it's a room area and we want to show content\n                if (showRoomMapContent && secretId === 'room_area' && meta?.linkedMapId && layouts[meta.linkedMapId]) {\n                    const roomMap = layouts[meta.linkedMapId].map;\n                    const rW = meta.width || 1;\n                    const rH = meta.height || 1;\n                    const rAreaW = rW * tileW;\n                    const rAreaH = rH * tileH;\n                    const rTileW = rAreaW / roomMap.mapWidth;\n                    const rTileH = rAreaH / roomMap.mapHeight;\n\n                    // Room Background\n                    ctx.fillStyle = roomMap.selectedBackgroundColor || '#1a1a1a';\n                    ctx.fillRect(tx, ty, rAreaW, rAreaH);\n                    \n                    // Room Tiles (very simplified)\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n                    for (let ri = 0; ri < roomMap.mapWidth * roomMap.mapHeight; ri++) {\n                        if (roomMap.tileMapData[ri]) {\n                            ctx.fillRect(\n                                tx + (ri % roomMap.mapWidth) * rTileW,\n                                ty + Math.floor(ri / roomMap.mapWidth) * rTileH,\n                                Math.ceil(rTileW), Math.ceil(rTileH)\n                            );\n                        }\n                    }\n                    \n                    // Room Border\n                    ctx.strokeStyle = '#f39c12';\n                    ctx.lineWidth = 0.5;\n                    ctx.strokeRect(tx, ty, rAreaW, rAreaH);\n                } else {\n                    if (tileId) {\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (objId) {\n                        if (objId.includes('portal') && !objId.includes('target')) {\n                            ctx.fillStyle = '#007bff';\n                        } else if (objId.includes('target') || objId === 'portal_target') {\n                            ctx.fillStyle = '#ffc107';\n                        } else {\n                            ctx.fillStyle = '#dc3545';\n                        }\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (secretId === 'room_area') {\n                        ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                        ctx.strokeStyle = 'gold';\n                        ctx.lineWidth = 1;\n                        ctx.strokeRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                    }\n                }\n            }\n        });\n\n        // 2. Draw Connections\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 2;\n\n        Object.values(layouts).forEach(sourceLayout => {\n            const { map: sourceMap, x: sx, y: sy, w: sw, h: sh } = sourceLayout;\n            const tileW = sw / sourceMap.mapWidth;\n            const tileH = sh / sourceMap.mapHeight;\n\n            const metadata = sourceMap.objectMetadata || {};\n            \n            for (let i = 0; i < sourceMap.mapWidth * sourceMap.mapHeight; i++) {\n                const objId = sourceMap.objectMapData[i];\n                if (!objId) continue;\n                \n                const meta = metadata[i];\n                if (!meta) continue;\n\n                // Identify if this is a connection source\n                const isPortalSource = objId.includes('portal') && !objId.includes('target');\n                const objDef = registryItems.find(r => r.id === objId);\n                const isDoorSource = objDef && objDef.subtype === 'door';\n\n                if (!isPortalSource && !isDoorSource) continue;\n\n                // For portals we match by triggerId, for doors by spawnTriggerId\n                const linkId = isPortalSource ? meta.triggerId : meta.spawnTriggerId;\n                if (linkId === null || linkId === undefined) continue;\n\n                const targetMapId = meta.targetMapId || sourceMap.id;\n                const targetLayout = layouts[targetMapId];\n\n                if (targetLayout) {\n                    const { map: targetMap, x: tx, y: ty, w: tw, h: th } = targetLayout;\n                    const tTileW = tw / targetMap.mapWidth;\n                    const tTileH = th / targetMap.mapHeight;\n\n                    // Find target object in target map\n                    for (let j = 0; j < targetMap.mapWidth * targetMap.mapHeight; j++) {\n                        const tObjId = targetMap.objectMapData[j];\n                        if (!tObjId) continue;\n\n                        const tObjDef = registryItems.find(r => r.id === tObjId);\n                        const isTarget = tObjId.includes('target') || tObjId === 'portal_target';\n                        const isDoorTarget = tObjDef && tObjDef.subtype === 'door';\n\n                        if (!isTarget && !isDoorTarget) continue;\n\n                        const tMeta = targetMap.objectMetadata?.[j];\n                        if (tMeta && tMeta.triggerId === linkId) {\n                            // Link found!\n                            const startX = sx + (i % sourceMap.mapWidth) * tileW + tileW / 2;\n                            const startY = sy + Math.floor(i / sourceMap.mapWidth) * tileH + tileH / 2;\n                            const endX = tx + (j % targetMap.mapWidth) * tTileW + tTileW / 2;\n                            const endY = ty + Math.floor(j / targetMap.mapWidth) * tTileH + tTileH / 2;\n\n                            // Draw line\n                            ctx.beginPath();\n                            ctx.strokeStyle = (sourceMap.id === targetMap.id) ? '#fff' : '#00ff00';\n                            ctx.moveTo(startX, startY);\n                            \n                            if (sourceMap.id !== targetMap.id) {\n                                // Calculate mid points for a nicer curve\n                                const cp1X = startX + (endX - startX) * 0.25;\n                                const cp1Y = Math.min(startY, endY) - 100;\n                                const cp2X = startX + (endX - startX) * 0.75;\n                                const cp2Y = Math.min(startY, endY) - 100;\n                                ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, endX, endY);\n                            } else {\n                                ctx.lineTo(endX, endY);\n                            }\n                            ctx.stroke();\n\n                            // Arrow head\n                            const angle = Math.atan2(endY - startY, endX - startX);\n                            ctx.save();\n                            ctx.setLineDash([]);\n                            ctx.translate(endX, endY);\n                            ctx.rotate(angle);\n                            ctx.beginPath();\n                            ctx.moveTo(0, 0);\n                            ctx.lineTo(-10, -5);\n                            ctx.lineTo(-10, 5);\n                            ctx.closePath();\n                            ctx.fillStyle = ctx.strokeStyle;\n                            ctx.fill();\n                            ctx.restore();\n                            \n                            break;\n                        }\n                    }\n                }\n            }\n        });\n    }, [allMaps, activeMapId, showRoomMapContent]);\n\n    useEffect(() => {\n        draw();\n    }, [allMaps, activeMapId, draw, showRoomMapContent]);\n\n    const handleMouseDown = (e) => {\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const layouts = Object.values(mapLayoutsRef.current || {});\n        \n        // Check for delete button first\n        for (const layout of layouts) {\n            if (layout.map.id !== 'main') {\n                const btnX = layout.x + layout.w - 15;\n                const btnY = layout.y - 25;\n                if (x >= btnX && x <= btnX + 15 && y >= btnY && y <= btnY + 15) {\n                    if (window.confirm(t('EDITOR_SCENE_WORLD_DELETE_CONFIRM', { name: layout.map.name }))) {\n                        deleteMap(layout.map.id);\n                    }\n                    return;\n                }\n            }\n        }\n\n        // Check for map drag/select\n        for (const layout of layouts) {\n            if (x >= layout.x && x <= layout.x + layout.w &&\n                y >= layout.y && y <= layout.y + layout.h) {\n                \n                if (e.detail === 2) { // Double click to switch\n                    switchMap(layout.map.id);\n                } else {\n                    dragRef.current = {\n                        id: layout.map.id,\n                        startX: x,\n                        startY: y,\n                        mapStartX: layout.x,\n                        mapStartY: layout.y\n                    };\n                }\n                return;\n            }\n        }\n    };\n\n    const handleMouseMove = (e) => {\n        if (!dragRef.current) return;\n\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const dx = x - dragRef.current.startX;\n        const dy = y - dragRef.current.startY;\n\n        const newX = Math.max(0, dragRef.current.mapStartX + dx);\n        const newY = Math.max(0, dragRef.current.mapStartY + dy);\n\n        // Update local layout for immediate visual feedback\n        if (mapLayoutsRef.current[dragRef.current.id]) {\n            mapLayoutsRef.current[dragRef.current.id].x = newX;\n            mapLayoutsRef.current[dragRef.current.id].y = newY;\n            draw();\n        }\n    };\n\n    const handleMouseUp = (e) => {\n        if (!dragRef.current) return;\n\n        const layout = mapLayoutsRef.current[dragRef.current.id];\n        if (layout) {\n            updateMapData(dragRef.current.id, {\n                worldX: layout.x,\n                worldY: layout.y\n            });\n        }\n        \n        dragRef.current = null;\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '10px' }}>\n            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n                <button\n                    onClick={() => switchMap('main')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#1e88e5', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_MAIN')}\n                </button>\n                <button \n                    onClick={() => createMap('overworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_OVERWORLD')}\n                </button>\n                <button \n                    onClick={() => createMap('sea_rescue')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#00bcd4', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_SEA_RESCUE')}\n                </button>\n                <button \n                    onClick={() => createMap('underworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#5D4037', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_UNDERWORLD')}\n                </button>\n                <button \n                    onClick={onAddRoomArea}\n                    title={t('EDITOR_SCENE_WORLD_ADD_ROOM_TITLE')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#f39c12', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + m<sup>2</sup>\n                </button>\n                <div style={{ marginLeft: 'auto', color: '#ccc', fontSize: '11px' }}>\n                    {t('EDITOR_SCENE_WORLD_HELP')}\n                </div>\n            </div>\n\n            <div ref={containerRef} style={{ width: '100%', height: '500px', backgroundColor: '#333', overflow: 'auto', borderRadius: '4px', position: 'relative', border: '1px solid #555' }}>\n                <canvas\n                    ref={canvasRef}\n                    width={2000}\n                    height={2000}\n                    style={{ display: 'block', cursor: dragRef.current ? 'grabbing' : 'grab' }}\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseLeave={handleMouseUp}\n                />\n                <div style={{ position: 'absolute', bottom: '10px', right: '10px', backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '5px 10px', borderRadius: '4px', fontSize: '11px', pointerEvents: 'none' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#fff', border: '1px dashed #fff' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTRA')}</div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#00ff00', border: '1px dashed #00ff00' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTER')}</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const BackgroundPanel = ({ \n    backgroundOptions, \n    selectedBackgroundImage, \n    setSelectedBackgroundImage, \n    selectedBackgroundColor, \n    backgroundParallaxFactor, \n    setBackgroundParallaxFactor \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '12px' }}>{t('EDITOR_SCENE_BACKGROUND_IMAGE')}</span>\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>\n                    <div onClick={() => setSelectedBackgroundImage(null)}\n                        style={{\n                            border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #2196F3',\n                            borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                            boxShadow: !selectedBackgroundImage ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                        }}\n                        title={t('EDITOR_SCENE_BACKGROUND_SOLID')}>\n                        <div style={{ width: '100%', height: '60px', background: selectedBackgroundColor, display: 'block', borderRadius: '4px' }} />\n                        <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: !selectedBackgroundImage ? 'bold' : 'normal' }}>{t('EDITOR_SCENE_BACKGROUND_SOLID')}</div>\n                    </div>\n                    {backgroundOptions.map((bg) => (\n                        <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                            style={{\n                                border: selectedBackgroundImage === bg.metaPath ? '2px solid #2196F3' : '1px solid #ccc',\n                                borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                boxShadow: selectedBackgroundImage === bg.metaPath ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                            }}\n                            title={bg.name}>\n                            <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '60px', objectFit: 'cover', display: 'block', borderRadius: '4px' }} />\n                            <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: selectedBackgroundImage === bg.metaPath ? 'bold' : 'normal' }}>{bg.name}</div>\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            <section style={{ backgroundColor: '#f9f9f9', padding: '15px', borderRadius: '8px', border: '1px solid #ddd' }}>\n                <div style={{ marginBottom: '0px' }}>\n                    <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>{t('EDITOR_SCENE_BACKGROUND_PARALLAX')}</label>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                            onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))}\n                            style={{ flex: 1 }} />\n                        <span style={{ fontSize: '13px', fontWeight: 'bold', minWidth: '35px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                    </div>\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nexport const MusicPanel = ({ \n    musicOptions, \n    selectedBackgroundMusic, \n    setSelectedBackgroundMusic \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>{t('EDITOR_SCENE_MUSIC_TITLE')}</span>\n                <select\n                    value={selectedBackgroundMusic || ''}\n                    onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                    style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ccc', fontSize: '13px', marginBottom: '10px' }}>\n                    <option value=\"\">{t('EDITOR_SCENE_MUSIC_NONE')}</option>\n                    {musicOptions.map(m => (\n                        <option key={m.name} value={m.metaPath}>{m.name}</option>\n                    ))}\n                </select>\n                <div style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\n                    {t('EDITOR_SCENE_MUSIC_STATUS', {\n                        status: selectedBackgroundMusic ? t('EDITOR_SCENE_MUSIC_STATUS_SELECTED') : t('EDITOR_SCENE_MUSIC_STATUS_SILENCE')\n                    })}\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WeatherPanel = ({\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const weatherItems = [\n        { label: t('EDITOR_SCENE_WEATHER_RAIN'), value: weatherRain, setter: setWeatherRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_LAVA_RAIN'), value: weatherLavaRain, setter: setWeatherLavaRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_SNOW'), value: weatherSnow, setter: setWeatherSnow, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_METEOR_RAIN'), value: weatherMeteorRain, setter: setWeatherMeteorRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_CLOUDS'), value: weatherClouds, setter: setWeatherClouds, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_FOG'), value: weatherFog, setter: setWeatherFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_RADIO_FOG'), value: weatherRadioactiveFog, setter: setWeatherRadioactiveFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_THUNDER'), value: weatherThunder, setter: setWeatherThunder, icon: '' },\n    ];\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px', padding: '5px' }}>\n            {weatherItems.map((item) => (\n                <div key={item.label} style={{ \n                    backgroundColor: '#f9f9f9', \n                    padding: '12px', \n                    borderRadius: '8px', \n                    border: '1px solid #ddd' \n                }}>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\n                        <span style={{ fontSize: '13px', fontWeight: 'bold' }}>\n                            {item.icon} {item.label}\n                        </span>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', color: '#2196F3' }}>\n                            {item.value}%\n                        </span>\n                    </div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input \n                            type=\"range\" \n                            min=\"0\" \n                            max=\"100\" \n                            step=\"1\" \n                            value={item.value}\n                            onChange={(e) => item.setter(parseInt(e.target.value))}\n                            style={{ flex: 1, cursor: 'pointer' }} \n                        />\n                    </div>\n                </div>\n            ))}\n            <div style={{ fontSize: '11px', color: '#888', fontStyle: 'italic', textAlign: 'center', marginTop: '5px' }}>\n                {t('EDITOR_SCENE_WEATHER_HINT')}\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const SceneEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const RightSidebarContainer = styled.div`\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    z-index: 1100;\n`;\n","import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { DraggableWindow } from './editorScene/DraggableWindow';\nimport { EditorMapResizer } from './editorScene/EditorMapResizer';\nimport { Minimap } from './editorScene/Minimap';\nimport { WorldView } from './editorScene/WorldView';\nimport { BackgroundPanel } from './editorScene/BackgroundPanel';\nimport { MusicPanel } from './editorScene/MusicPanel';\nimport { WeatherPanel } from './editorScene/WeatherPanel';\nimport { SceneEditorButton, RightSidebarContainer } from './styles/EditorSceneButtonStyle';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\n\nexport const EditorScene = ({\n    handleMapResize,\n    isResizeWindowOpen,\n    setIsResizeWindowOpen,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain,\n    // New props for multi-map\n    maps,\n    activeMapId,\n    switchMap,\n    createMap,\n    deleteMap,\n    updateMapData,\n    isWorldViewOpen,\n    setIsWorldViewOpen,\n    onAddRoomArea,\n    showRoomMapContent,\n    activeRoomIds\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [isMinimapOpen, setIsMinimapOpen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isBackgroundOpen, setIsBackgroundOpen] = useState(false);\n    const [isMusicOpen, setIsMusicOpen] = useState(false);\n\n    return (\n        <div style={{ display: 'contents' }}>\n            <BackgroundMusicPlayer \n                metaPath={selectedBackgroundMusic} \n                enabled={true} \n                volume={0.4} \n                isInsideRoom={activeRoomIds?.length > 0}\n            />\n            {/* Right side buttons */}\n            <RightSidebarContainer>\n                <SceneEditorButton onClick={() => setIsMinimapOpen(!isMinimapOpen)} $active={isMinimapOpen} title={t('EDITOR_SCENE_BUTTON_MAPS_MINIMAP')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsWorldViewOpen(!isWorldViewOpen)} $active={isWorldViewOpen} title={t('EDITOR_SCENE_BUTTON_WORLD_VIEW')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsBackgroundOpen(!isBackgroundOpen)} $active={isBackgroundOpen} title={t('EDITOR_SCENE_BUTTON_BACKGROUND')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsMusicOpen(!isMusicOpen)} $active={isMusicOpen} title={t('EDITOR_SCENE_BUTTON_MUSIC')}>\n                    <span style={{ color: '#fff' }}></span>\n                </SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsSettingsOpen(!isSettingsOpen)} $active={isSettingsOpen} title={t('EDITOR_SCENE_BUTTON_SETTINGS')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} $active={isResizeWindowOpen} title={t('EDITOR_SCENE_BUTTON_RESIZE')}></SceneEditorButton>\n            </RightSidebarContainer>\n\n            {/* Floating Windows */}\n            {isMinimapOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MINIMAP')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsMinimapOpen(false)}\n                >\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '5px' }}>\n                        <Minimap\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            backgroundColor={selectedBackgroundColor}\n                        />\n                        <div style={{ fontSize: '12px', color: '#ccc', textAlign: 'center' }}>\n                            {maps[activeMapId]?.name || t('EDITOR_SCENE_MINIMAP_CURRENT_MAP')}\n                        </div>\n                    </div>\n                </DraggableWindow>\n            )}\n\n            {isWorldViewOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_WORLD_VIEW')}\n                    defaultPosition={{ x: 100, y: 100 }}\n                    defaultWidth={800}\n                    isOpenDefault={true}\n                    onClose={() => setIsWorldViewOpen(false)}\n                >\n                    <WorldView \n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        registryItems={registryItems}\n                        createMap={createMap}\n                        deleteMap={deleteMap}\n                        updateMapData={updateMapData}\n                        onAddRoomArea={onAddRoomArea}\n                        showRoomMapContent={showRoomMapContent}\n                        // Current map live data\n                        currentMapData={{\n                            id: activeMapId,\n                            mapWidth,\n                            mapHeight,\n                            tileMapData,\n                            objectMapData,\n                            objectMetadata,\n                            selectedBackgroundColor\n                        }}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isBackgroundOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_BACKGROUND')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsBackgroundOpen(false)}\n                >\n                    <BackgroundPanel \n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isMusicOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MUSIC')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 300 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsMusicOpen(false)}\n                >\n                    <MusicPanel \n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isSettingsOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_SETTINGS')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 400 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsSettingsOpen(false)}\n                >\n                    <WeatherPanel \n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_RESIZE')}\n                    defaultPosition={{ x: 400, y: 100 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsResizeWindowOpen(false)}\n                >\n                    <EditorMapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={handleMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { OperationButton, OperationLabel } from '../styles/EditorElementsButtonStyle';\n\nexport const OperationsPanel = ({ \n    openNewMapModal, \n    saveMap, \n    loadMap, \n    openBuiltInModal,\n    clearMap, \n    mapName, \n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    mapType,\n    updateMapData,\n    activeMapId\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const inputStyle = {\n        width: '100%',\n        border: '1px solid transparent',\n        background: 'transparent',\n        padding: '4px 6px',\n        fontSize: '13px',\n        fontWeight: 'bold',\n        outline: 'none',\n        borderRadius: '4px',\n        boxSizing: 'border-box',\n        transition: 'all 0.2s ease',\n        cursor: 'pointer'\n    };\n\n    const handleFocus = (e) => {\n        e.target.style.borderColor = '#2196F3';\n        e.target.style.backgroundColor = '#fff';\n        e.target.style.cursor = 'text';\n    };\n\n    const handleBlur = (e) => {\n        e.target.style.borderColor = 'transparent';\n        e.target.style.backgroundColor = 'transparent';\n        e.target.style.cursor = 'pointer';\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\n            <div style={{ \n                padding: '15px', \n                backgroundColor: '#f9f9f9', \n                borderRadius: '8px', \n                border: '1px solid #ddd', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px' \n            }}>\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\n                    <OperationButton onClick={openNewMapModal} title={t('EDITOR_ELEMENTS_OP_NEW_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_NEW')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={saveMap} title={t('EDITOR_ELEMENTS_OP_SAVE_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_SAVE')}</span>\n                    </OperationButton>\n                    <OperationLabel title={t('EDITOR_ELEMENTS_OP_LOAD_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_LOAD')}</span>\n                        <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} />\n                    </OperationLabel>\n                    <OperationButton onClick={openBuiltInModal} title={t('EDITOR_ELEMENTS_OP_BUILT_IN_MAPS_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_BUILT_IN')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={clearMap} $danger title={t('EDITOR_ELEMENTS_OP_CLEAR_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_CLEAR')}</span>\n                    </OperationButton>\n                </div>\n            </div>\n\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '4px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_MAP_TYPE_LABEL')}</label>\n                    <div style={{ display: 'flex', gap: '15px', padding: '4px 6px' }}>\n                        <label style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px', cursor: 'pointer', fontWeight: mapType !== 'sea_rescue' ? 'bold' : 'normal' }}>\n                            <input \n                                type=\"radio\" \n                                name=\"mapType\" \n                                checked={mapType !== 'sea_rescue'} \n                                onChange={() => updateMapData(activeMapId, { type: 'overworld' })}\n                                style={{ cursor: 'pointer' }}\n                            />\n                            {t('EDITOR_ELEMENTS_OP_MAP_TYPE_DEFAULT')}\n                        </label>\n                        <label style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px', cursor: 'pointer', fontWeight: mapType === 'sea_rescue' ? 'bold' : 'normal' }}>\n                            <input \n                                type=\"radio\" \n                                name=\"mapType\" \n                                checked={mapType === 'sea_rescue'} \n                                onChange={() => updateMapData(activeMapId, { type: 'sea_rescue' })}\n                                style={{ cursor: 'pointer' }}\n                            />\n                            {t('EDITOR_ELEMENTS_OP_MAP_TYPE_SEA_RESCUE')}\n                        </label>\n                    </div>\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_MAP_NAME_LABEL')}</label>\n                    <input \n                        value={mapName} \n                        onChange={(e) => setMapName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_MAP_NAME_TITLE')}\n                    />\n                </div>\n                \n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_AUTHOR_LABEL')}</label>\n                    <input \n                        value={creatorName} \n                        onChange={(e) => setCreatorName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_AUTHOR_TITLE')}\n                    />\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_DESCRIPTION_LABEL')}</label>\n                    <textarea \n                        value={mapDescription} \n                        onChange={(e) => setMapDescription(e.target.value)}\n                        style={{ ...inputStyle, fontWeight: 'normal', minHeight: '60px', resize: 'vertical' }}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_DESCRIPTION_TITLE')}\n                    />\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const CollapsiblePanel = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '4px 6px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none', lineHeight: 1.1, minHeight: '20px' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { CollapsiblePanel } from './CollapsiblePanel';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport i18n from '../../../../i18n/i18n';\nimport { getTutorialChapters, getTutorialItems } from '../../../../i18n/tutorialMessages';\n\nexport const PalettePanel = ({ \n    isPlayMode, \n    category,\n    blocks, \n    liquids, \n    entities, \n    decorations, \n    items, \n    interactables, \n    hazards, \n    secrets, \n    miniGames,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    objectMetadata,\n    setObjectMetadata,\n    objectMapData,\n    highlightedIndex,\n    setHighlightedIndex,\n    registryItems,\n    handlePaletteSelect, \n    selectedTile \n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [selectedChapter, setSelectedChapter] = useState('');\n    const [selectedMiniGame, setSelectedMiniGame] = useState('');\n\n    const currentLang = i18n?.language || 'en';\n    const tutorialChapters = useMemo(() => getTutorialChapters(currentLang), [currentLang]);\n    const tutorialItems = useMemo(\n        () => (selectedChapter ? getTutorialItems(selectedChapter, currentLang) : []),\n        [selectedChapter, currentLang]\n    );\n\n    const miniGameGroups = useMemo(() => {\n        if (!miniGames || miniGames.length === 0) return [];\n        const groupOrder = new Map();\n        miniGames.forEach(item => {\n            const key = item.editor?.group || 'other';\n            const order = item.editor?.groupOrder ?? item.editor?.order ?? 0;\n            if (!groupOrder.has(key) || order < groupOrder.get(key)) {\n                groupOrder.set(key, order);\n            }\n        });\n        return Array.from(groupOrder.entries())\n            .sort((a, b) => a[1] - b[1])\n            .map(([key]) => key);\n    }, [miniGames]);\n\n    const miniGameItems = useMemo(() => {\n        if (!miniGames || !selectedMiniGame) return [];\n        return miniGames\n            .filter(item => (item.editor?.group || 'other') === selectedMiniGame)\n            .sort((a, b) => {\n                const ao = a.editor?.order ?? 0;\n                const bo = b.editor?.order ?? 0;\n                if (ao !== bo) return ao - bo;\n                return (a.displayName || a.name || '').localeCompare(b.displayName || b.name || '');\n            });\n    }, [miniGames, selectedMiniGame]);\n\n    const getMiniGameLabel = (key) => {\n        if (key === 'sea_rescue') return t('EDITOR_ELEMENTS_MINI_GAMES_GROUP_SEA_RESCUE');\n        if (key === 'other') return t('EDITOR_ELEMENTS_GROUP_OTHER');\n        return key;\n    };\n\n    const getMiniGameLayer = (item) => {\n        if (item.editor?.layer) return item.editor.layer;\n        if (item.type === 'secret') return 'secret';\n        if (item.id === 'minispill_sea_rescue_trigger') return 'object';\n        return 'object';\n    };\n\n    useEffect(() => {\n        if (!selectedChapter && tutorialChapters.length > 0) {\n            setSelectedChapter(tutorialChapters[0]);\n        } else if (selectedChapter && !tutorialChapters.includes(selectedChapter)) {\n            setSelectedChapter(tutorialChapters[0] || '');\n        }\n    }, [tutorialChapters, selectedChapter]);\n\n    useEffect(() => {\n        if (!selectedMiniGame && miniGameGroups.length > 0) {\n            setSelectedMiniGame(miniGameGroups[0]);\n        } else if (selectedMiniGame && !miniGameGroups.includes(selectedMiniGame)) {\n            setSelectedMiniGame(miniGameGroups[0] || '');\n        }\n    }, [miniGameGroups, selectedMiniGame]);\n\n    const getLiquidLabel = ({\n        isLavaWaterfall,\n        isLava,\n        isRadioactiveWaterfall,\n        isRadioactive,\n        isWater,\n        isWaterfall,\n        isQuicksand\n    }) => {\n        if (isLavaWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LFALL');\n        if (isLava) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LAVA');\n        if (isRadioactiveWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RADFALL');\n        if (isRadioactive) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RAD');\n        if (isWater) return t('EDITOR_ELEMENTS_LIQUID_LABEL_WATER');\n        if (isWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_FALL');\n        if (isQuicksand) return t('EDITOR_ELEMENTS_LIQUID_LABEL_QUICK');\n        return t('EDITOR_ELEMENTS_LIQUID_LABEL_LIQ');\n    };\n\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const editorIcon = item.editorIcon;\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isQuicksand = !!(item.flags && item.flags.quicksand);\n        const isWaterfall = !!(item.flags && item.flags.waterfall);\n        const isLavaWaterfall = !!(item.flags && item.flags.lava_waterfall);\n        const isRadioactive = !!(item.flags && item.flags.radioactive);\n        const isRadioactiveWaterfall = !!(item.flags && item.flags.radioactive_waterfall);\n        const isSecret = item.type === 'secret';\n        const isWeatherTrigger = item.type === 'weather_trigger';\n        const isMessageTrigger = item.type === 'message_trigger';\n        \n        const swatchStyle = isLavaWaterfall\n            ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isWater || isWaterfall ? { background: 'linear-gradient(180deg,#3a7fb8,#5ba3d9)' }\n            : (isQuicksand ? { background: 'linear-gradient(180deg,#a6915b,#7d6d42)' }\n            : (isRadioactive || isRadioactiveWaterfall ? { background: 'linear-gradient(180deg,#1a5c1a,#32cd32)' }\n            : { background: '#eee' }))));\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.displayName || item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColorInEditor || item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.editorIcon || (item.subtype === 'above' ? t('EDITOR_ELEMENTS_SECRET_ABOVE') : t('EDITOR_ELEMENTS_SECRET_BELOW'))}\n                    </div>\n                ) : (isWeatherTrigger || isMessageTrigger) ? (\n                    hasImage ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            spriteSheet={item.spriteSheet}\n                            style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                            alt={item.name}\n                        />\n                    ) : (\n                        (() => {\n                            const iconText = item.editorIcon || (item.i18nMessage ? 'i18n' : '');\n                            return (\n                        <div style={{\n                            width: '100%', height: '100%', borderRadius: 2,\n                            display: 'flex', alignItems: 'center', justifyContent: 'center',\n                            background: isMessageTrigger ? '#fff9c4' : '#f0f4f8', \n                            border: isMessageTrigger ? '1px solid #fbc02d' : '1px solid #d1d9e6',\n                            color: '#333', fontSize: (iconText === 'i18n' ? '12px' : '18px'), fontWeight: 700\n                        }}>\n                            {iconText}\n                        </div>\n                            );\n                        })()\n                    )\n                ) : editorIcon ? (\n                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>\n                        {editorIcon}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        spriteSheet={item.spriteSheet}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid\n                            ? getLiquidLabel({\n                                isLavaWaterfall,\n                                isLava,\n                                isRadioactiveWaterfall,\n                                isRadioactive,\n                                isWater,\n                                isWaterfall,\n                                isQuicksand\n                            })\n                            : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    if (isPlayMode) {\n        return (\n            <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                {t('EDITOR_ELEMENTS_PALETTE_DISABLED')}\n            </div>\n        );\n    }\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            {category === 'blocks' && (() => {\n                const getBlockGroup = (b) => {\n                    if (b.editor?.group) return b.editor.group;\n                    const name = (b.id || b.name || '').toLowerCase();\n                    if (name.includes('brick')) return 'bricks';\n                    if (name.includes('diorite') || name.includes('stone')) return 'stone';\n                    if (name.includes('metal')) return 'metal';\n                    if (name.includes('wood')) return 'wood';\n                    return 'ground';\n                };\n\n                const groupOrder = [\n                    { key: 'ground', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_GROUND'), color: 'blue', open: true },\n                    { key: 'bricks', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_BRICKS'), color: 'blue', open: true },\n                    { key: 'stone', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_STONE'), color: 'blue', open: true },\n                    { key: 'metal', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_METAL'), color: 'blue', open: true },\n                    { key: 'wood', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_WOOD'), color: 'blue', open: true }\n                ];\n\n                const withGroups = blocks.map(b => ({\n                    item: b,\n                    group: getBlockGroup(b)\n                }));\n\n                const sortBlocks = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(b => b.group === group.key).sort(sortBlocks);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(b => renderPaletteItem(b.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(b => !groupOrder.some(g => g.key === b.group)).sort(sortBlocks);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(b => renderPaletteItem(b.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'liquids' && (() => {\n                const getLiquidGroup = (li) => {\n                    if (li.editor?.group) return li.editor.group;\n                    if (li.flags?.quicksand) return 'quicksand';\n                    if (li.flags?.lava || li.flags?.lava_waterfall) return 'lava';\n                    if (li.flags?.radioactive || li.flags?.radioactive_waterfall) return 'radiation';\n                    if (li.flags?.water || li.flags?.waterfall) return 'water';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'quicksand', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_QUICKSAND'), color: 'goldenrod', open: true },\n                    { key: 'water', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_WATER'), color: 'blue', open: true },\n                    { key: 'lava', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_LAVA'), color: 'orange', open: true },\n                    { key: 'radiation', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_RADIATION'), color: 'green', open: true }\n                ];\n\n                const withGroups = liquids.map(li => ({\n                    item: li,\n                    group: getLiquidGroup(li)\n                }));\n\n                const sortLiquids = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(li => li.group === group.key).sort(sortLiquids);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(li => renderPaletteItem(li.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(li => !groupOrder.some(g => g.key === li.group)).sort(sortLiquids);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_LIQUIDS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_LIQUIDS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(li => renderPaletteItem(li.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'decorations' && (() => {\n                const getDecorationGroup = (d) => {\n                    if (d.editor?.group) return d.editor.group;\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'trees', title: t('EDITOR_ELEMENTS_DECORATIONS_GROUP_TREES'), color: 'green', open: true }\n                ];\n\n                const withGroups = decorations.map(d => ({\n                    item: d,\n                    group: getDecorationGroup(d)\n                }));\n\n                const sortDecorations = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(d => d.group === group.key).sort(sortDecorations);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(d => renderPaletteItem(d.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(d => !groupOrder.some(g => g.key === d.group)).sort(sortDecorations);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(d => renderPaletteItem(d.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'entities' && (() => {\n                const getEntityGroup = (e) => {\n                    if (e.editor?.group) return e.editor.group;\n                    const name = (e.id || e.name || '').toLowerCase();\n                    if (name.includes('player')) return 'player';\n                    if (name.includes('fish') || name.includes('animal')) return 'animals';\n                    return 'enemies';\n                };\n\n                const groupOrder = [\n                    { key: 'player', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_PLAYER'), color: 'red', open: true },\n                    { key: 'animals', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ANIMALS'), color: 'red', open: true },\n                    { key: 'enemies', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ENEMIES'), color: 'red', open: true }\n                ];\n\n                const withGroups = entities.map(e => ({\n                    item: e,\n                    group: getEntityGroup(e)\n                }));\n\n                const sortEntities = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(e => e.group === group.key).sort(sortEntities);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(e => renderPaletteItem(e.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(e => !groupOrder.some(g => g.key === e.group)).sort(sortEntities);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ENTITIES_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ENTITIES_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(e => renderPaletteItem(e.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'items' && (() => {\n                const getItemGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.effect?.health) return 'health';\n                    if (i.effect?.fireball) return 'ammunition';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'health', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_HEALTH'), color: 'green', open: true },\n                    { key: 'ammunition', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_AMMUNITION'), color: 'green', open: true }\n                ];\n\n                const withGroups = items.map(i => ({\n                    item: i,\n                    group: getItemGroup(i)\n                }));\n\n                const sortItems = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(i => i.group === group.key).sort(sortItems);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortItems);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ITEMS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ITEMS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'interactables' && (() => {\n                const getInteractableGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.subtype === 'door') return 'entrances';\n                    if (i.subtype === 'ladder') return 'ledders';\n                    if (i.subtype === 'platform' || i.subtype === 'arrow') return 'platforms';\n                    if ((i.id || '').includes('portal') || (i.name || '').includes('portal')) return 'ports';\n                    if (i.subtype === 'end') return 'ends';\n                    const name = (i.id || i.name || '').toLowerCase();\n                    if (name.includes('berry')) return 'harvestables';\n                    if (name.includes('stone') || name.includes('wooden_box')) return 'physics';\n                    if (name.includes('ice')) return 'blocks';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'harvestables', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_HARVESTABLES'), color: 'purple', open: true },\n                    { key: 'physics', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PHYSIC'), color: 'purple', open: true },\n                    { key: 'entrances', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENTRANCES'), color: 'purple', open: true },\n                    { key: 'platforms', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PLATFORMS'), color: 'purple', open: true },\n                    { key: 'ledders', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_LEDDERS'), color: 'purple', open: true },\n                    { key: 'ports', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PORTS'), color: 'purple', open: true },\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_BLOCKS'), color: 'purple', open: true },\n                    { key: 'ends', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENDS'), color: 'purple', open: true }\n                ];\n\n                const withGroups = interactables.map(i => ({\n                    item: i,\n                    group: getInteractableGroup(i)\n                }));\n\n                const sortInteractables = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(i => i.group === group.key).sort(sortInteractables);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortInteractables);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'hazards' && (() => {\n                const getHazardGroup = (h) => {\n                    if (h.editor?.group) return h.editor.group;\n                    if (h.collision) return 'blocks';\n                    return 'obstacles';\n                };\n\n                const groupOrder = [\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_BLOCKS'), color: 'orange', open: true },\n                    { key: 'obstacles', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_OBSTACLES'), color: 'brown', open: true }\n                ];\n\n                const withGroups = hazards.map(h => ({\n                    item: h,\n                    group: getHazardGroup(h)\n                }));\n\n                const sortHazards = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(h => h.group === group.key).sort(sortHazards);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(h => renderPaletteItem(h.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(h => !groupOrder.some(g => g.key === h.group)).sort(sortHazards);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_HAZARDS_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(h => renderPaletteItem(h.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'secrets' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_OPEN_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'open').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n                    \n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_SECRET_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype !== 'open' && s.subtype !== 'room' && s.subtype !== 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_CRACKABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {crackableWalls && crackableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_PUSHABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {pushableWalls && pushableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_ANIMAL_TRIGGERS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'weather' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'rain').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_SNOW')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'snow').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_CLOUDS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'clouds').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'fog').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_THUNDER')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'thunder').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_LAVA_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'lavaRain').map(w => renderPaletteItem(w, 'red', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RADIO_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'radioactiveFog').map(w => renderPaletteItem(w, 'green', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_METEOR_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'meteorRain').map(w => renderPaletteItem(w, 'orange', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'messages' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_MESSAGES_TITLE')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {messages && messages.map(m => renderPaletteItem(m, 'gold', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n                    {selectedTile && (selectedTile.i18nMessage || selectedTile.type === 'message_trigger') && (\n                        <CollapsiblePanel title={t('EDITOR_ELEMENTS_I18N_TITLE')} isOpenDefault={true}>\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>\n                                    {tutorialChapters.map(ch => (\n                                        <button\n                                            key={ch}\n                                            onClick={() => setSelectedChapter(ch)}\n                                            style={{\n                                                padding: '4px 8px',\n                                                fontSize: '11px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ccc',\n                                                background: ch === selectedChapter ? '#f4c542' : '#f0f0f0',\n                                                cursor: 'pointer'\n                                            }}\n                                        >\n                                            {ch}\n                                        </button>\n                                    ))}\n                                </div>\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '6px', maxHeight: '200px', overflowY: 'auto' }}>\n                                    {tutorialItems.map(item => (\n                                        <button\n                                            key={`${selectedChapter}_${item.id}`}\n                                            onClick={() => {\n                                                let targetIndex = highlightedIndex;\n                                                if ((targetIndex === null || targetIndex === undefined) && selectedTile?.id && objectMapData) {\n                                                    const idx = objectMapData.findIndex(id => id === selectedTile.id);\n                                                    if (idx >= 0) {\n                                                        targetIndex = idx;\n                                                        if (setHighlightedIndex) setHighlightedIndex(idx);\n                                                    }\n                                                }\n                                                if (targetIndex === null || targetIndex === undefined) return;\n                                                const objId = objectMapData?.[targetIndex];\n                                                const objDef = registryItems?.find(r => r.id === objId);\n                                                if (!objDef || objDef.type !== 'message_trigger') return;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [targetIndex]: {\n                                                        ...prev[targetIndex],\n                                                        i18nChapter: selectedChapter,\n                                                        i18nId: item.id,\n                                                        message: ''\n                                                    }\n                                                }));\n                                            }}\n                                            style={{\n                                                display: 'flex',\n                                                alignItems: 'center',\n                                                justifyContent: 'space-between',\n                                                gap: '8px',\n                                                padding: '6px 8px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ddd',\n                                                background: '#fff',\n                                                cursor: 'pointer',\n                                                textAlign: 'left'\n                                            }}\n                                        >\n                                            <span style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_I18N_ID', { id: item.id })}</span>\n                                            <span style={{ fontSize: '11px', color: '#222', flex: 1 }}>{item.text}</span>\n                                        </button>\n                                    ))}\n                                </div>\n                                {(highlightedIndex === null || highlightedIndex === undefined) && (\n                                    <div style={{ fontSize: '11px', color: '#888' }}>\n                                        {t('EDITOR_ELEMENTS_I18N_SELECT_HINT')}\n                                    </div>\n                                )}\n                            </div>\n                        </CollapsiblePanel>\n                    )}\n                </div>\n            )}\n\n            {category === 'minigames' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n                    <div style={{ \n                        padding: '12px', \n                        backgroundColor: '#f9f9f9', \n                        borderRadius: '8px', \n                        border: '1px solid #ddd', \n                        display: 'flex', \n                        flexDirection: 'column', \n                        gap: '6px' \n                    }}>\n                        <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '2px', display: 'block', textTransform: 'uppercase' }}>\n                            {t('EDITOR_ELEMENTS_MINI_GAMES_SELECT_LABEL')}\n                        </label>\n                        <select\n                            value={selectedMiniGame}\n                            onChange={(e) => setSelectedMiniGame(e.target.value)}\n                            style={{\n                                width: '100%',\n                                padding: '6px 8px',\n                                border: '1px solid #ccc',\n                                borderRadius: '4px',\n                                fontSize: '13px',\n                                backgroundColor: '#fff',\n                                outline: 'none',\n                                cursor: 'pointer',\n                                fontWeight: 'bold'\n                            }}\n                        >\n                            {miniGameGroups.map(group => (\n                                <option key={group} value={group}>\n                                    {getMiniGameLabel(group)}\n                                </option>\n                            ))}\n                        </select>\n                    </div>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', padding: '0 4px' }}>\n                        {miniGameItems.length > 0 ? (\n                            miniGameItems.map(item => renderPaletteItem(item, 'teal', getMiniGameLayer(item)))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                {t('EDITOR_ELEMENTS_MINI_GAMES_EMPTY')}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n\n            {category === 'obstacles' && (\n                <CollapsiblePanel title={t('EDITOR_ELEMENTS_OBSTACLES_TITLE')} isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {obstacles && obstacles.length > 0 ? (\n                            obstacles.map(o => renderPaletteItem(o, 'brown', 'object'))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                {t('EDITOR_ELEMENTS_OBSTACLES_EMPTY')}\n                            </div>\n                        )}\n                    </div>\n                </CollapsiblePanel>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\n\nexport const StatisticsPanel = ({ \n    totalTiles, \n    mapWidth, \n    mapHeight, \n    filledBlocks, \n    objectsCount, \n    emptyBlocks,\n    objectMapData,\n    registryItems,\n    maps\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const registryMap = registryItems && registryItems.__byId;\n    const getDef = (id) => {\n        if (!id) return null;\n        if (registryMap && typeof registryMap.get === 'function') return registryMap.get(id) || null;\n        return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    let itemsCount = 0;\n    let entitiesCount = 0;\n\n    if (Array.isArray(objectMapData)) {\n        objectMapData.forEach((id) => {\n            if (!id) return;\n            const def = getDef(id);\n            if (!def) return;\n            const name = (def.name || '').toLowerCase();\n            if (name.startsWith('item.')) itemsCount += 1;\n            if (def.type === 'entity' || def.subtype === 'tank' || def.subtype === 'platform' || name.includes('entities.')) {\n                entitiesCount += 1;\n            }\n        });\n    }\n\n    const mapList = maps ? Object.values(maps) : [];\n    const mapsTotal = mapList.length;\n    const mapsOverworld = mapList.filter(m => m.type === 'overworld').length;\n    const mapsUnderworld = mapList.filter(m => m.type === 'underworld').length;\n    const mapsRooms = mapList.filter(m => m.type === 'room').length;\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n            <div style={{ padding: '15px', backgroundColor: '#e6f7ff', borderRadius: '8px', border: '1px solid #91d5ff' }}>\n                <div style={{ fontSize: '14px', marginBottom: '8px' }}>\n                    <Trans i18nKey=\"EDITOR_ELEMENTS_STATS_TOTAL_AREA\" t={t} values={{ count: totalTiles }} components={[<strong key=\"count\" />]} />\n                </div>\n                <div style={{ fontSize: '13px', color: '#0050b3' }}>{t('EDITOR_ELEMENTS_STATS_DIMENSIONS', { width: mapWidth, height: mapHeight })}</div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#f6ffed', borderRadius: '8px', border: '1px solid #b7eb8f', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#389e0d' }}>{filledBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_FILLED_BLOCKS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#fff7e6', borderRadius: '8px', border: '1px solid #ffd591', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#d46b08' }}>{objectsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_OBJECTS')}</div>\n                </div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#eef7ff', borderRadius: '8px', border: '1px solid #b3d8ff', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#1565c0' }}>{itemsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ITEMS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#f3e8ff', borderRadius: '8px', border: '1px solid #d1c4e9', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#5e35b1' }}>{entitiesCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ENTITIES')}</div>\n                </div>\n            </div>\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#666' }}>{emptyBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_EMPTY_SPACE')}</div>\n            </div>\n            {mapsTotal > 0 && (\n                <div style={{ padding: '12px', backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #ddd' }}>\n                    <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#444', marginBottom: '6px' }}>\n                        {t('EDITOR_ELEMENTS_STATS_MAPS_TOTAL', { count: mapsTotal })}\n                    </div>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: '#666' }}>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_OVERWORLD', { count: mapsOverworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_UNDERWORLD', { count: mapsUnderworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_ROOMS', { count: mapsRooms })}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const ObjectPropsPanel = ({ \n    objectMapData, \n    secretMapData,\n    registryItems, \n    mapWidth, \n    objectMetadata, \n    highlightedIndex, \n    setHighlightedIndex, \n    setObjectMetadata,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const mapType = maps[activeMapId]?.type || 'overworld';\n    const mapList = Object.values(maps || {});\n    const listRef = React.useRef(null);\n\n    // Auto-scroll to highlighted item\n    React.useEffect(() => {\n        if (highlightedIndex !== null && listRef.current) {\n            const highlightedElement = listRef.current.querySelector(`[data-index=\"${highlightedIndex}\"]`);\n            if (highlightedElement) {\n                highlightedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n        }\n    }, [highlightedIndex]);\n\n    return (\n        <div style={{ padding: '0' }}>\n            <p style={{ fontSize: '12px', color: '#666', lineHeight: '1.4' }}>\n                {t('EDITOR_ELEMENTS_PROPS_INTRO_LINE1')}\n                <br />\n                <strong>1.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE2\"\n                    t={t}\n                    components={[<strong key=\"portal\" />, <strong key=\"target\" />, <strong key=\"weather\" />, <strong key=\"message\" />]}\n                />\n                <br />\n                <strong>2.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE3\"\n                    t={t}\n                    components={[<strong key=\"trigger\" />, <strong key=\"intensity\" />, <strong key=\"messageText\" />]}\n                />\n            </p>\n            <div ref={listRef} style={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}>\n                {Array.from({ length: objectMapData.length }).map((_, index) => {\n                    const objId = objectMapData[index];\n                    const secretId = secretMapData ? secretMapData[index] : null;\n                    \n                    if (!objId && !secretId) return null;\n\n                    const objDef = objId ? registryItems.find(r => r.id === objId) : null;\n                    const secretDef = secretId ? registryItems.find(r => r.id === secretId) : null;\n                    \n                    const isWeather = objDef && objDef.type === 'weather_trigger';\n                    const isMessage = objDef && objDef.type === 'message_trigger';\n                    const isPortalOrTarget = objId && (objId.includes('portal') || objId.includes('target') || objId === 'portal_target');\n                    const isDoor = objDef && objDef.subtype === 'door';\n                    const isRoomArea = secretDef && secretDef.subtype === 'room' && mapType !== 'room';\n                    const isTree = objDef && objDef.type === 'decoration' && objDef.editor?.group === 'trees';\n\n                    if (!isPortalOrTarget && !isWeather && !isMessage && !isRoomArea && !isDoor && !isTree) return null;\n\n                    const def = objDef || secretDef;\n                    const id = objId || secretId;\n\n                    const x = index % mapWidth;\n                    const y = Math.floor(index / mapWidth);\n                    const metadata = objectMetadata[index] || {};\n                    const i18nPreview = metadata.i18nChapter && metadata.i18nId\n                        ? getTutorialText(metadata.i18nChapter, metadata.i18nId)\n                        : '';\n                    const isHighlighted = highlightedIndex === index;\n\n                    return (\n                        <div key={index} \n                            data-index={index}\n                            onMouseEnter={() => setHighlightedIndex(index)}\n                            onMouseLeave={() => setHighlightedIndex(null)}\n                            style={{\n                                padding: '10px',\n                                border: isHighlighted ? '1px solid gold' : '1px solid #eee',\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '5px',\n                                backgroundColor: isHighlighted ? '#fffde7' : '#f9f9f9',\n                                marginBottom: '5px',\n                                borderRadius: '4px',\n                                transition: 'all 0.2s ease'\n                            }}\n                        >\n                            <div style={{ fontWeight: 'bold', fontSize: '13px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                                <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    {isRoomArea ? '' : (isTree ? '' : ((isWeather || isMessage) ? def.editorIcon : (id.includes('portal') && !id.includes('target') ? '' : '')))} {def.displayName || def.name}\n                                </span>\n                                <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                    <span style={{ color: '#666', fontSize: '11px' }}>({x}, {y})</span>\n                                    <button \n                                        onClick={() => {\n                                            const el = document.querySelector(`.viewport`);\n                                            if (el) {\n                                                const scrollX = x * 32 - el.clientWidth / 2 + 16;\n                                                const scrollY = y * 32 - el.clientHeight / 2 + 16;\n                                                el.scrollTo({ left: scrollX, top: scrollY, behavior: 'smooth' });\n                                            }\n                                        }}\n                                        style={{ \n                                            padding: '2px 6px', fontSize: '10px', cursor: 'pointer',\n                                            backgroundColor: '#eee', border: '1px solid #ccc', borderRadius: '3px'\n                                        }}\n                                        title={t('EDITOR_ELEMENTS_PROPS_LOCATE_TITLE')}\n                                    >\n                                        {t('EDITOR_ELEMENTS_PROPS_LOCATE_LABEL')}\n                                    </button>\n                                </div>\n                            </div>\n\n                            {isRoomArea && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_ROOM_NAME')}</label>\n                                        <input\n                                            type=\"text\"\n                                            value={metadata.roomName || ''}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_ROOM_NAME_PLACEHOLDER')}\n                                            onChange={(e) => {\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], roomName: e.target.value }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                            }}\n                                        />\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE')}</label>\n                                        <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.width || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], width: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                            <span>x</span>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.height || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], height: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                        </div>\n                                    </div>\n                                    {metadata.linkedMapId ? (\n                                        <div style={{ fontSize: '11px', color: 'green' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_LINKED_MAP', { id: metadata.linkedMapId })}\n                                        </div>\n                                    ) : (\n                                        <button\n                                            onClick={() => {\n                                                if (createMap) {\n                                                    const mapId = createMap('room', metadata.roomName || 'Room Area', metadata.width || 1, metadata.height || 1);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], linkedMapId: mapId }\n                                                    }));\n                                                }\n                                            }}\n                                            style={{\n                                                padding: '6px',\n                                                backgroundColor: '#4CAF50',\n                                                color: 'white',\n                                                border: 'none',\n                                                borderRadius: '4px',\n                                                cursor: 'pointer',\n                                                fontWeight: 'bold'\n                                            }}\n                                        >\n                                            {t('EDITOR_ELEMENTS_PROPS_CONFIRM')}\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n\n                            {(!isWeather && !isMessage && !isRoomArea && !isTree) && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID')}</label>\n                                    <input\n                                        type=\"number\"\n                                        value={metadata.triggerId || ''}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], triggerId: isNaN(val) ? null : val }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                        placeholder={t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {isTree && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_TREE_LAYER_LABEL')}</label>\n                                    <select\n                                        value={(metadata.renderAbovePlayer !== undefined ? metadata.renderAbovePlayer : def.renderAbovePlayer) ? 'above' : 'behind'}\n                                        onChange={(e) => {\n                                            const nextAbove = e.target.value === 'above';\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], renderAbovePlayer: nextAbove }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    >\n                                        <option value=\"behind\">{t('EDITOR_ELEMENTS_TREE_LAYER_BEHIND')}</option>\n                                        <option value=\"above\">{t('EDITOR_ELEMENTS_TREE_LAYER_ABOVE')}</option>\n                                    </select>\n                                </div>\n                            )}\n\n                            {isWeather && def.hasIntensity && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_INTENSITY')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        max=\"100\"\n                                        value={metadata.intensity !== undefined ? metadata.intensity : 50}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], intensity: isNaN(val) ? 0 : Math.min(100, Math.max(0, val)) }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    />\n                                </div>\n                            )}\n\n                            {isMessage && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\n                                    {(metadata.i18nChapter || metadata.i18nId) && (\n                                        <div style={{ fontSize: '11px', color: '#666' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_I18N_LABEL', {\n                                                chapter: metadata.i18nChapter || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY'),\n                                                id: metadata.i18nId || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY')\n                                            })}\n                                            {i18nPreview && (\n                                                <div style={{ marginTop: '4px', color: '#333' }}>\n                                                    {i18nPreview}\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_MESSAGE_TEXT')}</label>\n                                    <textarea\n                                        value={metadata.message || ''}\n                                        onChange={(e) => {\n                                            const val = e.target.value;\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], message: val }\n                                            }));\n                                        }}\n                                        rows={3}\n                                        style={{\n                                            width: '100%',\n                                            padding: '6px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0',\n                                            resize: 'vertical',\n                                            fontFamily: 'inherit'\n                                        }}\n                                        placeholder={i18nPreview || t('EDITOR_ELEMENTS_PROPS_MESSAGE_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {( (id.includes('portal') && !id.includes('target')) || isDoor ) && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px', marginTop: '5px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TARGET_MAP')}</label>\n                                        <select\n                                            value={metadata.targetMapId || ''}\n                                            onChange={(e) => {\n                                                const val = e.target.value;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], targetMapId: val === '' ? null : val }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        >\n                                            <option value=\"\">{t('EDITOR_ELEMENTS_PROPS_CURRENT_MAP_OPTION')}</option>\n                                            {mapList.map(m => (\n                                                <option key={m.id} value={m.id}>{m.name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SPAWN_ID')}</label>\n                                        <input\n                                            type=\"number\"\n                                            value={metadata.spawnTriggerId !== undefined ? metadata.spawnTriggerId : ''}\n                                            onChange={(e) => {\n                                                const val = parseInt(e.target.value);\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], spawnTriggerId: isNaN(val) ? null : val }\n                                                }));\n                                            }}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_SPAWN_ID_PLACEHOLDER')}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        />\n                                    </div>\n                                    {isDoor && (\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                            <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_DELAY')}</label>\n                                            <input\n                                                type=\"number\"\n                                                step=\"0.1\"\n                                                value={metadata.delaySeconds !== undefined ? metadata.delaySeconds : (objDef.interaction?.delaySeconds || 0.5)}\n                                                onChange={(e) => {\n                                                    const val = parseFloat(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], delaySeconds: isNaN(val) ? 0.5 : val }\n                                                    }));\n                                                }}\n                                                style={{\n                                                    flex: 1,\n                                                    padding: '4px 8px',\n                                                    border: '1px solid #ccc',\n                                                    borderRadius: '4px',\n                                                    fontSize: '13px',\n                                                    backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                                }}\n                                            />\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                            {/* Size Configuration */}\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px', paddingTop: '5px', borderTop: '1px solid #eee' }}>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_W')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.width || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], width: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_H')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.height || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], height: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <span style={{ fontSize: '10px', color: '#999' }}>{t('EDITOR_ELEMENTS_PROPS_RESIZE_HINT')}</span>\n                            </div>\n                        </div>\n                    );\n                })}\n                {objectMapData.filter(id => {\n                    if (!id) return false;\n                    const def = registryItems.find(r => r.id === id);\n                    const isWeather = def && def.type === 'weather_trigger';\n                    const isMessage = def && def.type === 'message_trigger';\n                    const isPortalOrTarget = id.includes('portal') || id.includes('target') || id === 'portal_target';\n                    const isTree = def && def.type === 'decoration' && def.editor?.group === 'trees';\n                    return isPortalOrTarget || isWeather || isMessage || isTree;\n                }).length === 0 && (\n                    <p style={{ textAlign: 'center', color: '#999', marginTop: '20px', fontSize: '14px' }}>\n                        {t('EDITOR_ELEMENTS_PROPS_NO_CONFIGURABLE')}\n                    </p>\n                )}\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    SidebarContainer,\n    ElementEditorButton,\n    PanelContainer,\n    PanelHeader,\n    PanelBody,\n    CloseButton\n} from './styles/EditorElementsButtonStyle';\n\n// Panels\nimport { OperationsPanel } from './editorElements/OperationsPanel';\nimport { PalettePanel } from './editorElements/PalettePanel';\nimport { StatisticsPanel } from './editorElements/StatisticsPanel';\nimport { ObjectPropsPanel } from './editorElements/ObjectPropsPanel';\n\nexport const EditorElements = ({\n    mapName,\n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    openNewMapModal,\n    openBuiltInModal,\n    saveMap,\n    loadMap,\n    clearMap,\n    isPlayMode,\n    handlePaletteSelect,\n    selectedTile,\n    blocks,\n    liquids,\n    entities,\n    items,\n    decorations,\n    interactables,\n    hazards,\n    secrets,\n    miniGames,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    setObjectMetadata,\n    registryItems,\n    highlightedIndex,\n    setHighlightedIndex,\n    activePanel,\n    setActivePanel,\n    togglePanel,\n    maps,\n    activeMapId,\n    createMap,\n    mapType,\n    updateMapData\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [lastPanel, setLastPanel] = React.useState(null);\n    const [pinnedPanel, setPinnedPanel] = React.useState(null);\n    const hoverTimerRef = React.useRef(null);\n\n    React.useEffect(() => {\n        if (activePanel) {\n            setLastPanel(activePanel);\n        }\n    }, [activePanel]);\n\n    const displayPanel = activePanel || lastPanel;\n\n    const clearHoverTimer = () => {\n        if (hoverTimerRef.current) {\n            clearTimeout(hoverTimerRef.current);\n            hoverTimerRef.current = null;\n        }\n    };\n\n    const handleIconClick = (panel) => {\n        clearHoverTimer();\n        if (pinnedPanel === panel) {\n            setPinnedPanel(null);\n            setActivePanel(null);\n            return;\n        }\n        setPinnedPanel(panel);\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseEnter = (panel) => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        hoverTimerRef.current = setTimeout(() => {\n            setActivePanel(null);\n        }, 120);\n    };\n\n    const handlePanelMouseEnter = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n    };\n\n    const handlePanelMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(null);\n    };\n\n    const panelTitles = {\n        map: t('EDITOR_ELEMENTS_PANEL_OPERATIONS'),\n        blocks: t('EDITOR_ELEMENTS_PANEL_BLOCKS'),\n        liquids: t('EDITOR_ELEMENTS_PANEL_LIQUIDS'),\n        decorations: t('EDITOR_ELEMENTS_PANEL_DECORATIONS'),\n        entities: t('EDITOR_ELEMENTS_PANEL_ENTITIES'),\n        items: t('EDITOR_ELEMENTS_PANEL_ITEMS'),\n        interactables: t('EDITOR_ELEMENTS_PANEL_INTERACTABLES'),\n        hazards: t('EDITOR_ELEMENTS_PANEL_HAZARDS'),\n        secrets: t('EDITOR_ELEMENTS_PANEL_SECTORS'),\n        weather: t('EDITOR_ELEMENTS_PANEL_WEATHER'),\n        minigames: t('EDITOR_ELEMENTS_PANEL_MINI_GAMES'),\n        messages: t('EDITOR_ELEMENTS_PANEL_MESSAGES'),\n        obstacles: t('EDITOR_ELEMENTS_PANEL_OBSTACLES'),\n        stats: t('EDITOR_ELEMENTS_PANEL_STATISTICS'),\n        props: t('EDITOR_ELEMENTS_PANEL_PROPERTIES')\n    };\n\n    return (\n        <div style={{ display: 'flex', height: '100%', position: 'relative', zIndex: 1001 }}>\n            {/* Sidebar Left Icons */}\n            <SidebarContainer>\n                <ElementEditorButton onClick={() => handleIconClick('map')} onMouseEnter={() => handleIconMouseEnter('map')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'map'} title={t('EDITOR_ELEMENTS_ICON_MAP_CONTROLS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('blocks')} onMouseEnter={() => handleIconMouseEnter('blocks')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'blocks'} title={t('EDITOR_ELEMENTS_ICON_BLOCKS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('liquids')} onMouseEnter={() => handleIconMouseEnter('liquids')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'liquids'} title={t('EDITOR_ELEMENTS_ICON_LIQUIDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('decorations')} onMouseEnter={() => handleIconMouseEnter('decorations')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'decorations'} title={t('EDITOR_ELEMENTS_ICON_DECORATIONS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('obstacles')} onMouseEnter={() => handleIconMouseEnter('obstacles')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'obstacles'} title={t('EDITOR_ELEMENTS_ICON_OBSTACLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('items')} onMouseEnter={() => handleIconMouseEnter('items')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'items'} title={t('EDITOR_ELEMENTS_ICON_ITEMS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('entities')} onMouseEnter={() => handleIconMouseEnter('entities')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'entities'} title={t('EDITOR_ELEMENTS_ICON_ENTITIES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('interactables')} onMouseEnter={() => handleIconMouseEnter('interactables')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'interactables'} title={t('EDITOR_ELEMENTS_ICON_INTERACTABLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('hazards')} onMouseEnter={() => handleIconMouseEnter('hazards')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'hazards'} title={t('EDITOR_ELEMENTS_ICON_HAZARDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('secrets')} onMouseEnter={() => handleIconMouseEnter('secrets')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'secrets'} title={t('EDITOR_ELEMENTS_ICON_SECTORS')}>2</ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('weather')} onMouseEnter={() => handleIconMouseEnter('weather')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'weather'} title={t('EDITOR_ELEMENTS_ICON_WEATHER')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('minigames')} onMouseEnter={() => handleIconMouseEnter('minigames')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'minigames'} title={t('EDITOR_ELEMENTS_ICON_MINI_GAMES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('messages')} onMouseEnter={() => handleIconMouseEnter('messages')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'messages'} title={t('EDITOR_ELEMENTS_ICON_MESSAGES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('stats')} onMouseEnter={() => handleIconMouseEnter('stats')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'stats'} title={t('EDITOR_ELEMENTS_ICON_STATISTICS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('props')} onMouseEnter={() => handleIconMouseEnter('props')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'props'} title={t('EDITOR_ELEMENTS_ICON_PROPERTIES')}></ElementEditorButton>\n            </SidebarContainer>\n\n            {/* Sidebar Fixed Panel Content */}\n            <PanelContainer $isOpen={!!activePanel} onMouseEnter={handlePanelMouseEnter} onMouseLeave={handlePanelMouseLeave}>\n                {displayPanel && (\n                    <>\n                        {/* Panel Header */}\n                        <PanelHeader>\n                            <span>{panelTitles[displayPanel]}</span>\n                            <CloseButton onClick={() => { setPinnedPanel(null); setActivePanel(null); }}></CloseButton>\n                        </PanelHeader>\n\n                        {/* Panel Body */}\n                        <PanelBody>\n                            {displayPanel === 'map' && (\n                                <OperationsPanel \n                                    openNewMapModal={openNewMapModal}\n                                    openBuiltInModal={openBuiltInModal}\n                                    saveMap={saveMap}\n                                    loadMap={loadMap}\n                                    clearMap={clearMap}\n                                    mapName={mapName}\n                                    creatorName={creatorName}\n                                    mapDescription={mapDescription}\n                                    setMapName={setMapName}\n                                    setCreatorName={setCreatorName}\n                                    setMapDescription={setMapDescription}\n                                    mapType={mapType}\n                                    updateMapData={updateMapData}\n                                    activeMapId={activeMapId}\n                                />\n                            )}\n\n                            {(displayPanel === 'blocks' || \n                              displayPanel === 'liquids' || \n                              displayPanel === 'decorations' || \n                              displayPanel === 'entities' || \n                              displayPanel === 'items' || \n                              displayPanel === 'interactables' || \n                              displayPanel === 'hazards' || \n                              displayPanel === 'secrets' ||\n                              displayPanel === 'weather' ||\n                              displayPanel === 'minigames' ||\n                              displayPanel === 'messages' ||\n                              displayPanel === 'obstacles') && (\n                                <PalettePanel \n                                    isPlayMode={isPlayMode}\n                                    category={displayPanel}\n                                    blocks={blocks}\n                                    liquids={liquids}\n                                    entities={entities}\n                                    decorations={decorations}\n                                    items={items}\n                                    interactables={interactables}\n                                    hazards={hazards}\n                                    secrets={secrets}\n                                    miniGames={miniGames}\n                                    weather={weather}\n                                    messages={messages}\n                                    crackableWalls={crackableWalls}\n                                    pushableWalls={pushableWalls}\n                                    obstacles={obstacles}\n                                    handlePaletteSelect={handlePaletteSelect}\n                                    selectedTile={selectedTile}\n                                    objectMetadata={objectMetadata}\n                                    setObjectMetadata={setObjectMetadata}\n                                    objectMapData={objectMapData}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    registryItems={registryItems}\n                                />\n                            )}\n\n\n                            {displayPanel === 'stats' && (\n                                <StatisticsPanel \n                                    totalTiles={totalTiles}\n                                    mapWidth={mapWidth}\n                                    mapHeight={mapHeight}\n                                    filledBlocks={filledBlocks}\n                                    objectsCount={objectsCount}\n                                    emptyBlocks={emptyBlocks}\n                                    objectMapData={objectMapData}\n                                    registryItems={registryItems}\n                                    maps={maps}\n                                />\n                            )}\n\n                            {displayPanel === 'props' && (\n                                <ObjectPropsPanel \n                                    objectMapData={objectMapData}\n                                    secretMapData={secretMapData}\n                                    registryItems={registryItems}\n                                    mapWidth={mapWidth}\n                                    objectMetadata={objectMetadata}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    setObjectMetadata={setObjectMetadata}\n                                    maps={maps}\n                                    activeMapId={activeMapId}\n                                    createMap={createMap}\n                                />\n                            )}\n                        </PanelBody>\n                    </>\n                )}\n            </PanelContainer>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    EditorToolsContainer,\n    HeaderBar,\n    ToolsSection,\n    ToolsGroup,\n    ToolsInnerGroup,\n    ToolsRow,\n    ToolsEditorButton,\n    StrikeThrough,\n    LayerIndicator,\n    BgColorContainer,\n    BgColorInputWrapper,\n    BgColorInput,\n    BgTransparentButton,\n    PlayButtonContainer,\n    PlayButtonInner,\n    InfoContainer,\n    InfoItem,\n    InfoLabel,\n    InfoValue,\n    EraserButtonContainer,\n    EraserButtonInner,\n    SelectionActions,\n    ConfirmButton,\n    CancelButton,\n    GridIcon\n} from './styles/EditorToolsButton';\n\nexport const EditorTools = (props) => {\n    const { t } = useTranslation('editor_tools');\n    const {\n        mapName, \n        creatorName, \n        activePanel, \n        togglePanel,\n        showGrid, \n        setShowGrid,\n        isPlayMode,\n        handlePlay,\n        handlePause,\n        handleReset,\n        activeTool,\n        setActiveTool,\n        brushSize,\n        setBrushSize,\n        activeLayer,\n        selection,\n        moveSelection,\n        selectionMode,\n        setSelectionMode,\n        commitSelection,\n        cancelSelection,\n        selectedTile,\n        handlePaletteSelect,\n        selectedBackgroundColor,\n        setSelectedBackgroundColor,\n        showBackgroundImage,\n        setShowBackgroundImage,\n        showMessages,\n        setShowMessages,\n        isRoomAreaVisible,\n        setIsRoomAreaVisible,\n        showRoomMapContent,\n        setShowRoomMapContent\n    } = props;\n    const getEraserData = (layer) => {\n        const isLayerBrushActive = activeLayer === layer\n            && activeTool === 'brush'\n            && selectedTile !== null;\n        const isLayerBucketActive = activeLayer === layer\n            && activeTool === 'bucket'\n            && selectedTile !== null;\n        const isActive = (selectedTile === null && activeLayer === layer) || isLayerBrushActive || isLayerBucketActive;\n        const colors = {\n            tile: { bg: '#e6f7ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', text: '#722ed1' },\n            props: { bg: '#fffbe6', text: '#faad14' }\n        };\n        const active = colors[layer] || colors.tile;\n        return {\n            isActive,\n            bgColor: active.bg,\n            textColor: active.text\n        };\n    };\n\n    const getLayerIndicatorData = () => {\n        const colors = {\n            tile: { bg: '#e6f7ff', border: '#91d5ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', border: '#ffa39e', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', border: '#d3adf7', text: '#722ed1' },\n            props: { bg: '#fffbe6', border: '#ffe58f', text: '#faad14' }\n        };\n        const active = colors[activeLayer] || colors.tile;\n        return {\n            $bgColor: active.bg,\n            $borderColor: active.border,\n            $textColor: active.text\n        };\n    };\n\n    return (\n        <EditorToolsContainer>\n            {/* Main Header Bar */}\n            <HeaderBar>\n                <ToolsSection>\n                    <ToolsGroup>\n\n                        {/* Brush - Bucket - Move - Area */}\n                        <ToolsRow>\n                            {[\n                                { id: 'brush', icon: '', title: t('EDITOR_TOOLS_BRUSH_TITLE') },\n                                { id: 'bucket', icon: '', title: t('EDITOR_TOOLS_BUCKET_TITLE') },\n                                { id: 'move', icon: '', title: t('EDITOR_TOOLS_MOVE_TITLE') },\n                            ].map(tool => (\n                                <ToolsEditorButton\n                                    key={tool.id}\n                                    onClick={() => !isPlayMode && setActiveTool(tool.id)}\n                                    $active={activeTool === tool.id && !isPlayMode}\n                                    $square\n                                    $disabled={isPlayMode}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : tool.title}\n                                >\n                                    {tool.icon}\n                                    {isPlayMode && <StrikeThrough />}\n                                </ToolsEditorButton>\n                            ))}\n                        </ToolsRow>\n\n                        {/* Cut - Copy - Paste */}\n                        <ToolsInnerGroup>\n                            {['cut', 'copy'].map(mode => {\n                                const isDisabled = isPlayMode || activeTool !== 'move';\n                                return (\n                                    <ToolsEditorButton\n                                        key={mode}\n                                        onClick={() => !isDisabled && setSelectionMode(mode)}\n                                        $active={selectionMode === mode && !isDisabled}\n                                        $square\n                                        $disabled={isDisabled}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? (mode === 'cut' ? t('EDITOR_TOOLS_CUT_ONLY_MOVE') : t('EDITOR_TOOLS_COPY_ONLY_MOVE')) : (mode === 'cut' ? t('EDITOR_TOOLS_CUT_SELECTION') : t('EDITOR_TOOLS_COPY_SELECTION')))}\n                                    >\n                                        {mode === 'cut' ? '' : ''}\n                                        {isDisabled && <StrikeThrough />}\n                                    </ToolsEditorButton>\n                                );\n                            })}\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && activeTool === 'move' && commitSelection()}\n                                $square\n                                $disabled={isPlayMode || activeTool !== 'move'}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (activeTool !== 'move' ? t('EDITOR_TOOLS_PASTE_ONLY_MOVE') : t('EDITOR_TOOLS_PASTE_SELECTION'))}\n                            >\n                                \n                                {(isPlayMode || activeTool !== 'move') && <StrikeThrough />}\n                            </ToolsEditorButton>\n                            {selection && !isPlayMode && (\n                                <SelectionActions>\n                                    <ConfirmButton onClick={commitSelection} $square title={t('EDITOR_TOOLS_CONFIRM_SELECTION')}></ConfirmButton>\n                                    <CancelButton onClick={cancelSelection} $square title={t('EDITOR_TOOLS_CANCEL_SELECTION')}></CancelButton>\n                                </SelectionActions>\n                            )}\n                        </ToolsInnerGroup>\n\n                        {/* Size */}\n                        <ToolsInnerGroup>\n                            {['I', 'II', 'III', 'IV', 'V'].map((roman, idx) => {\n                                const size = idx + 1;\n                                const isDisabled = isPlayMode || activeTool !== 'brush';\n                                return (\n                                    <ToolsEditorButton \n                                        key={size} \n                                    onClick={() => !isDisabled && setBrushSize(size)} \n                                    $active={brushSize === size && !isDisabled} \n                                    $square \n                                    $disabled={isDisabled}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? t('EDITOR_TOOLS_BRUSH_SIZE_ONLY') : t('EDITOR_TOOLS_BRUSH_SIZE', { size }))}\n                                >\n                                    {roman}\n                                    {isDisabled && <StrikeThrough />}\n                                </ToolsEditorButton>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        {/* Background Immage */}\n                        <ToolsRow>\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && setShowBackgroundImage(!showBackgroundImage)}\n                                $active={showBackgroundImage && !isPlayMode}\n                                $square\n                                $disabled={isPlayMode}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (showBackgroundImage ? t('EDITOR_TOOLS_BACKGROUND_IMAGE_HIDE') : t('EDITOR_TOOLS_BACKGROUND_IMAGE_SHOW'))}\n                            >\n                                \n                                {isPlayMode && <StrikeThrough />}\n                            </ToolsEditorButton>\n\n                            {/* Grid */}\n                            <ToolsEditorButton\n                                onClick={() => setShowGrid(!showGrid)}\n                                $active={showGrid}\n                                $square\n                                title={showGrid ? t('EDITOR_TOOLS_GRID_HIDE') : t('EDITOR_TOOLS_GRID_SHOW')}\n                            >\n                                <GridIcon>\n                                    {showGrid ? '' : ''}\n                                </GridIcon>\n                            </ToolsEditorButton>\n\n                            {/* Messages Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowMessages(!showMessages)}\n                                $active={showMessages}\n                                $square\n                                title={showMessages ? t('EDITOR_TOOLS_MESSAGES_HIDE') : t('EDITOR_TOOLS_MESSAGES_SHOW')}\n                            >\n                                \n                            </ToolsEditorButton>\n\n                            {/* Room Area Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setIsRoomAreaVisible(!isRoomAreaVisible)}\n                                $active={isRoomAreaVisible}\n                                $square\n                                title={isRoomAreaVisible ? t('EDITOR_TOOLS_ROOM_AREA_HIDE') : t('EDITOR_TOOLS_ROOM_AREA_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Room Map Content Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowRoomMapContent(!showRoomMapContent)}\n                                $active={showRoomMapContent}\n                                $square\n                                title={showRoomMapContent ? t('EDITOR_TOOLS_ROOM_CONTENT_HIDE') : t('EDITOR_TOOLS_ROOM_CONTENT_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Background Color Picker */}\n                            <BgColorContainer>\n                                <BgColorInputWrapper>\n                                    <BgColorInput\n                                        type=\"color\"\n                                        value={selectedBackgroundColor && selectedBackgroundColor !== 'transparent' ? selectedBackgroundColor : '#000000'}\n                                        onChange={(e) => !isPlayMode && setSelectedBackgroundColor(e.target.value)}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_COLOR')}\n                                        disabled={isPlayMode}\n                                    />\n                                    {isPlayMode && <StrikeThrough />}\n                                </BgColorInputWrapper>\n                                <BgTransparentButton \n                                    $active={selectedBackgroundColor === 'transparent'}\n                                    onClick={() => !isPlayMode && setSelectedBackgroundColor('transparent')}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_TRANSPARENT')}\n                                />\n                            </BgColorContainer>\n                        </ToolsRow>\n\n\n\n                        {/* Active Layer Indicator */}\n                        <ToolsInnerGroup>\n                            <LayerIndicator {...getLayerIndicatorData()}>\n                                {t('EDITOR_TOOLS_LAYER_LABEL', {\n                                    layer: activeLayer === 'tile'\n                                        ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                        : (activeLayer === 'object'\n                                            ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                            : (activeLayer === 'secret'\n                                                ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                })}\n                            </LayerIndicator>\n                        </ToolsInnerGroup>\n\n                        {/* Layers: Block - Object - Sector - Props */}\n                        <ToolsInnerGroup>\n                            {['tile', 'object', 'secret', 'props'].map(layer => {\n                                const { isActive, bgColor, textColor } = getEraserData(layer);\n                                const isDisabled = isPlayMode;\n                                return (\n                                    <EraserButtonContainer\n                                        key={layer}\n                                        onClick={() => !isDisabled && handlePaletteSelect(null, layer)}\n                                        $active={isActive && !isDisabled}\n                                        $disabled={isDisabled}\n                                        title={isDisabled ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_ERASE_LABEL', {\n                                            layer: layer === 'tile'\n                                                ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                                : (layer === 'object'\n                                                    ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                                    : (layer === 'secret'\n                                                        ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                        : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                        })}\n                                    >\n                                        <EraserButtonInner $bgColor={bgColor} $textColor={textColor} $active={isActive && !isDisabled}>\n                                            {layer === 'tile' ? 'B' : (layer === 'object' ? 'O' : (layer === 'secret' ? 'S' : 'P'))}\n                                        </EraserButtonInner>\n                                        {isDisabled && <StrikeThrough />}\n                                    </EraserButtonContainer>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        <ToolsInnerGroup>\n                            <ToolsRow>\n                                <PlayButtonContainer onClick={isPlayMode ? handlePause : handlePlay} title={isPlayMode ? t('EDITOR_TOOLS_PAUSE_TITLE') : t('EDITOR_TOOLS_PLAY_TITLE')}>\n                                    <PlayButtonInner $variant={isPlayMode ? 'pause' : 'play'}>\n                                        <span>{isPlayMode ? '' : ''}</span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n\n                                <PlayButtonContainer onClick={handleReset} title={t('EDITOR_TOOLS_RESET_TITLE')}>\n                                    <PlayButtonInner>\n                                        <span></span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n                            </ToolsRow>\n                        </ToolsInnerGroup>\n                    </ToolsGroup>\n                </ToolsSection>\n\n\n                <ToolsSection>\n                    <InfoContainer>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_MAP')}</InfoLabel>\n                            <InfoValue>{mapName}</InfoValue>\n                        </InfoItem>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_BY')}</InfoLabel>\n                            <InfoValue>{creatorName}</InfoValue>\n                        </InfoItem>\n                    </InfoContainer>\n                </ToolsSection>\n            </HeaderBar>\n        </EditorToolsContainer>\n    );\n};\n","import { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { TILE_SIZE } from '../../../../constants/gameConstants';\nimport { useGameEngine } from '../../../../utilities/useGameEngine';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../../engine/gameplay/breakEffects';\n\nconst EMPTY_ARRAY = [];\n\nexport const useEditorPlayMode = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n    selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n    registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    maps, activeMapId, switchMap, spawnTriggerId,\n    setTileMapData, updateMapData\n) => {\n    const [isPlayMode, setIsPlayMode] = useState(false);\n    const [isGameOver, setIsGameOver] = useState(false);\n    const [restartCounter, setRestartCounter] = useState(0);\n    const [editorSnapshot, setEditorSnapshot] = useState(null);\n    const [revealedSecrets, setRevealedSecrets] = useState([]);\n    const [activeRoomIds, setActiveRoomIds] = useState(new Set());\n    const [playModeObjectData, setPlayModeObjectData] = useState([]);\n    const [playModeSecretData, setPlayModeSecretData] = useState([]);\n    const [playModeWeather, setPlayModeWeather] = useState({\n        rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0,\n        lavaRain: 0, radioactiveFog: 0, meteorRain: 0\n    });\n    const [playModeMapsVersion, setPlayModeMapsVersion] = useState(0);\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n    const lastSyncedMapIdRef = useRef(null);\n    const isPlayModeRef = useRef(isPlayMode);\n    const playModeMapsRef = useRef({});\n\n    useEffect(() => {\n        isPlayModeRef.current = isPlayMode;\n    }, [isPlayMode]);\n\n    // Stability for engine initialization - only changes when map changes or play mode is toggled\n    const engineInitId = useMemo(() => {\n        return isPlayMode ? `${activeMapId}_${restartCounter}_${Date.now()}` : null;\n    }, [isPlayMode, activeMapId, restartCounter]);\n\n    // Derived data to ensure useGameEngine gets fresh data even before useEffect syncs state.\n    // This prevents the engine from using old map data during initialization.\n    const currentPlayObjectData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) {\n            const playData = [...objectMapData];\n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n            return playData;\n        }\n        return playModeObjectData;\n    }, [isPlayMode, activeMapId, playModeObjectData, objectMapData, spawnTriggerId, mapWidth, mapHeight]);\n\n    const currentPlaySecretData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) return [...secretMapData];\n        return playModeSecretData;\n    }, [isPlayMode, activeMapId, playModeSecretData, secretMapData]);\n\n    const playModeMaps = useMemo(() => {\n        if (!isPlayMode) return maps;\n        const overrides = playModeMapsRef.current || {};\n        const merged = { ...maps };\n        Object.keys(overrides).forEach(id => {\n            if (!merged[id]) return;\n            merged[id] = {\n                ...merged[id],\n                objectMapData: overrides[id].objectMapData || merged[id].objectMapData,\n                secretMapData: overrides[id].secretMapData || merged[id].secretMapData,\n                objectMetadata: overrides[id].objectMetadata || merged[id].objectMetadata\n            };\n        });\n        return merged;\n    }, [isPlayMode, maps, playModeMapsVersion]);\n\n    const mapDataForGame = useMemo(() => ({\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: TILE_SIZE,\n            activeMapId: activeMapId,\n            spawnTriggerId: spawnTriggerId,\n            backgroundImage: selectedBackgroundImage,\n            backgroundColor: selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            objectMetadata: objectMetadata,\n            activeRoomIds: Array.from(activeRoomIds),\n            date_map_last_updated: engineInitId, \n            weather: {\n                rain: isPlayMode ? playModeWeather.rain : weatherRain,\n                lavaRain: isPlayMode ? playModeWeather.lavaRain : weatherLavaRain,\n                snow: isPlayMode ? playModeWeather.snow : weatherSnow,\n                meteorRain: isPlayMode ? playModeWeather.meteorRain : weatherMeteorRain,\n                clouds: isPlayMode ? playModeWeather.clouds : weatherClouds,\n                fog: isPlayMode ? playModeWeather.fog : weatherFog,\n                radioactiveFog: isPlayMode ? playModeWeather.radioactiveFog : weatherRadioactiveFog,\n                thunder: isPlayMode ? playModeWeather.thunder : weatherThunder\n            }\n        },\n        maps: playModeMaps, // Project maps for inter-map teleports\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: currentPlayObjectData },\n            { type: \"secret\", name: \"secrets\", data: currentPlaySecretData }\n        ]\n    }), [\n        mapWidth, mapHeight, activeMapId, spawnTriggerId, selectedBackgroundImage, selectedBackgroundColor, \n        backgroundParallaxFactor, tileMapData, currentPlayObjectData, objectMetadata, activeRoomIds,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playModeWeather,\n        isPlayMode, playModeMaps, engineInitId\n    ]);\n\n    // Synchronize play mode state when map changes (e.g., during inter-map teleport)\n    useEffect(() => {\n        if (isPlayMode && lastSyncedMapIdRef.current !== activeMapId) {\n            const saved = playModeMapsRef.current?.[activeMapId];\n            if (saved) {\n                setPlayModeObjectData([...saved.objectMapData]);\n                setPlayModeSecretData([...(saved.secretMapData || [])]);\n                if (saved.objectMetadata) {\n                    setObjectMetadata({ ...saved.objectMetadata });\n                }\n                setRevealedSecrets([]);\n                if (messageTimerRef.current) {\n                    clearTimeout(messageTimerRef.current);\n                    messageTimerRef.current = null;\n                }\n                setGameMessage({ text: '', isVisible: false });\n                lastSyncedMapIdRef.current = activeMapId;\n                return;\n            }\n            const playData = [...objectMapData];\n            \n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(playData);\n            setPlayModeSecretData([...secretMapData]);\n            setRevealedSecrets([]);\n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n                messageTimerRef.current = null;\n            }\n            setGameMessage({ text: '', isVisible: false });\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    }, [activeMapId, isPlayMode, objectMapData, secretMapData, mapWidth, mapHeight, spawnTriggerId]);\n\n    const handleGameOver = useCallback(() => {\n        setIsGameOver(true);\n    }, []);\n\n    const handleReplay = useCallback(() => {\n        setIsGameOver(false);\n        setRestartCounter(prev => prev + 1);\n        setRevealedSecrets([]);\n        if (editorSnapshot) {\n            setPlayModeObjectData([...editorSnapshot.objectMapData]);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n        }\n    }, [editorSnapshot, setObjectMetadata]);\n\n    const handleStateUpdate = useCallback((newState, payload) => {\n        if (newState && typeof newState === 'object' && newState.x !== undefined && newState.y !== undefined) {\n            setPlayerPosition({ x: newState.x, y: newState.y });\n        } else if (newState === 'collectItem' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const newData = [...prev];\n                    newData[index] = null;\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newData = [...(playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [])];\n                newData[index] = null;\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMapData: newData\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'interactable' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const currentId = prev[index];\n                    if (!currentId) return prev;\n                    const newData = [...prev];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const mapObj = playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [];\n                const currentId = mapObj[index];\n                if (currentId) {\n                    const newData = [...mapObj];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[mapId] = {\n                        ...(playModeMapsRef.current[mapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                }\n            }\n        } else if (newState === 'setObjectFrame' && payload !== undefined) {\n            const { index, frame, mapId } = payload;\n            if (!mapId || mapId === activeMapId) {\n                setObjectMetadata(prev => {\n                    const next = {\n                        ...prev,\n                        [index]: { ...prev[index], currentFrame: frame }\n                    };\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMetadata: next\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return next;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newMeta = { ...((playModeMapsRef.current?.[mapId]?.objectMetadata) || maps[mapId].objectMetadata || {}) };\n                newMeta[index] = { ...(newMeta[index] || {}), currentFrame: frame };\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMetadata: newMeta\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'switchMap' && payload !== undefined) {\n            const { targetMapId, triggerId } = payload;\n            \n            // Check if target is a room\n            const targetMap = maps[targetMapId];\n            if (targetMap && targetMap.type === 'room') {\n                setActiveRoomIds(prev => {\n                    const next = new Set(prev);\n                    if (next.has(targetMapId)) next.delete(targetMapId);\n                    else next.add(targetMapId);\n                    return next;\n                });\n            } else if (targetMapId === 'main' && activeRoomIds.size > 0) {\n                setActiveRoomIds(new Set());\n            } else if (switchMap && targetMapId) {\n                playModeMapsRef.current[activeMapId] = {\n                    objectMapData: [...playModeObjectData],\n                    secretMapData: [...playModeSecretData],\n                    objectMetadata: { ...objectMetadata }\n                };\n                setPlayModeMapsVersion(v => v + 1);\n                // We keep play mode active when switching maps via teleport\n                switchMap(targetMapId, triggerId);\n            }\n        } else if (newState === 'objectDamage' && payload !== undefined) {\n            const { index, damage } = payload;\n            const objId = playModeObjectData[index];\n            const def = registryItems.find(r => r.id === objId);\n            if (!def) return;\n\n            setObjectMetadata(prev => {\n                const current = prev[index] || {};\n                const maxH = def.maxHealth || 100;\n                const newHealth = Math.max(0, (current.health !== undefined ? current.health : maxH) - damage);\n                \n                if (shouldRemoveCrackBlock(def, newHealth)) {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[index] = null;\n                            return newTiles;\n                        });\n                    }\n                }\n\n                if (shouldTriggerBreakEffect(def, newHealth) && !current.breakFxPlayed) {\n                    const cfg = getBreakEffectParams(def);\n                    if (cfg) {\n                        const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        window.dispatchEvent(new CustomEvent('game-break-effect', {\n                            detail: { x, y, config: cfg }\n                        }));\n                    }\n                }\n\n                return {\n                    ...prev,\n                    [index]: { ...current, health: newHealth, breakFxPlayed: current.breakFxPlayed || shouldTriggerBreakEffect(def, newHealth) }\n                };\n            });\n            const nextMeta = {\n                ...(objectMetadata || {}),\n                [index]: {\n                    ...(objectMetadata?.[index] || {}),\n                    health: Math.max(0, ((objectMetadata?.[index]?.health ?? (def.maxHealth || 100)) - damage))\n                }\n            };\n            playModeMapsRef.current[activeMapId] = {\n                ...(playModeMapsRef.current[activeMapId] || {}),\n                objectMetadata: nextMeta\n            };\n            setPlayModeMapsVersion(v => v + 1);\n\n            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(index / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n            }));\n        } else if (newState === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (newState === 'shiftTile' && payload !== undefined) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapId;\n            \n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => playModeObjectData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[to] = newTiles[from];\n                            newTiles[from] = null;\n                            return newTiles;\n                        });\n                    }\n                },\n                moveObject: (from, to) => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[to] = newObjs[from];\n                        newObjs[from] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                moveMetadata: (from, to) => {\n                    setObjectMetadata(prevMeta => {\n                        const newMeta = { ...prevMeta };\n                        if (newMeta[from]) {\n                            newMeta[to] = newMeta[from];\n                            delete newMeta[from];\n                        }\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMetadata: newMeta\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newMeta;\n                    });\n                },\n                removeObject: idx => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[idx] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                shouldCancel: () => !isPlayModeRef.current || activeMapId !== mapIdAtStart\n            });\n        } else if (newState === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            setPlayModeWeather(prev => ({\n                ...prev,\n                [type]: value\n            }));\n            \n            // Dispatch event for any UI components that might be listening\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1);\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (newState === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        } else if (newState === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (newState === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (newState === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        }\n    }, [activeMapId, maps, updateMapData, activeRoomIds, playModeObjectData, registryItems, setPlayerPosition, setObjectMetadata, switchMap, playModeSecretData, objectMetadata, mapWidth, mapHeight]);\n\n    const handleRevealSecret = useCallback((secretIndices) => {\n        const next = Array.isArray(secretIndices) ? secretIndices : [secretIndices];\n        if (next.length === 0) return;\n        setRevealedSecrets(prev => [...prev, ...next]);\n    }, []);\n\n    const gameEngineState = useGameEngine(\n        isPlayMode ? mapDataForGame : null,\n        isPlayMode ? tileMapData : EMPTY_ARRAY,\n        isPlayMode ? currentPlayObjectData : EMPTY_ARRAY,\n        isPlayMode ? currentPlaySecretData : EMPTY_ARRAY,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        Array.from(activeRoomIds),\n        mapWidth,\n        mapHeight\n    );\n\n    const handlePlay = () => {\n        setEditorSnapshot({\n            tileMapData: [...tileMapData],\n            objectMapData: [...objectMapData],\n            secretMapData: [...secretMapData],\n            objectMetadata: { ...objectMetadata },\n            playerPosition: { ...playerPosition }\n        });\n\n        const playData = [...objectMapData];\n        let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n        if (spawnIndex === -1) {\n            const spawnX = Math.min(3, mapWidth - 1);\n            const spawnY = Math.min(3, mapHeight - 1);\n            spawnIndex = spawnY * mapWidth + spawnX;\n            playData[spawnIndex] = 'player';\n        }\n\n        setPlayModeObjectData(playData);\n        setPlayModeSecretData([...secretMapData]);\n        playModeMapsRef.current = {\n            [activeMapId]: {\n                objectMapData: playData,\n                secretMapData: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            }\n        };\n        setPlayModeMapsVersion(v => v + 1);\n        setPlayModeWeather({\n            rain: weatherRain,\n            snow: weatherSnow,\n            clouds: weatherClouds,\n            fog: weatherFog,\n            thunder: weatherThunder,\n            lavaRain: weatherLavaRain,\n            radioactiveFog: weatherRadioactiveFog,\n            meteorRain: weatherMeteorRain\n        });\n        setRevealedSecrets([]);\n        lastSyncedMapIdRef.current = activeMapId;\n        setIsPlayMode(true);\n        setIsGameOver(false); // Reset game over when starting play mode\n    };\n\n    const handlePause = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false); // Reset game over when exiting play mode\n        playModeMapsRef.current = {};\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    const handleReset = () => {\n        if (editorSnapshot) {\n            if (setTileMapData) {\n                setTileMapData([...editorSnapshot.tileMapData]);\n            }\n\n            const resetData = [...editorSnapshot.objectMapData];\n            let spawnIndex = resetData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                resetData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(resetData);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n            setRevealedSecrets([]);\n            playModeMapsRef.current = {\n                [activeMapId]: {\n                    objectMapData: resetData,\n                    secretMapData: [...editorSnapshot.secretMapData],\n                    objectMetadata: { ...editorSnapshot.objectMetadata }\n                }\n            };\n            setPlayModeMapsVersion(v => v + 1);\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    };\n\n    const handleForceStop = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false);\n        setEditorSnapshot(null);\n        setPlayModeObjectData([]);\n        setPlayModeSecretData([]);\n        setRevealedSecrets([]);\n        playModeMapsRef.current = {};\n        lastSyncedMapIdRef.current = null;\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    return {\n        isPlayMode,\n        setIsPlayMode,\n        isGameOver,\n        handlePlay,\n        handlePause,\n        handleReset,\n        handleForceStop,\n        handleReplay,\n        handleStateUpdate,\n        playModeObjectData: currentPlayObjectData,\n        playModeSecretData: currentPlaySecretData,\n        playModeWeather,\n        playModeMaps,\n        gameMessage,\n        revealedSecrets,\n        activeRoomIds: Array.from(activeRoomIds),\n        gameEngineState\n    };\n};\n","import { useCallback } from 'react';\nimport { saveMap, loadMap, loadBuiltInMap, clearMap } from '../editorTools/mapOperations';\n\nexport const useEditorOperations = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    mapName, creatorName, mapDescription, createdAt,\n    selectedBackgroundImage, selectedBackgroundColor,\n    backgroundParallaxFactor, selectedBackgroundMusic, playerPosition,\n    registryItems, setCreatedAt,\n    setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n    setSelectedBackgroundImage, setSelectedBackgroundColor,\n    setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n    setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n    // Multi-map props\n    maps, setMaps, activeMapId, setActiveMapId\n) => {\n    const handleSaveMap = useCallback(() => {\n        // Construct the updated maps object with current active map data\n        // to ensure latest changes are saved even if debounce hasn't run\n        const currentMapData = {\n            ...maps[activeMapId],\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weather: {\n                rain: weatherRain,\n                snow: weatherSnow,\n                clouds: weatherClouds,\n                fog: weatherFog,\n                thunder: weatherThunder,\n                lavaRain: weatherLavaRain,\n                radioactiveFog: weatherRadioactiveFog,\n                meteorRain: weatherMeteorRain\n            },\n            playerPosition\n        };\n\n        const updatedMaps = {\n            ...maps,\n            [activeMapId]: currentMapData\n        };\n\n        saveMap({\n            maps: updatedMaps, \n            activeMapId,\n            mapName, creatorName, mapDescription, createdAt,\n            registryItems, setCreatedAt\n        });\n    }, [\n        maps, activeMapId, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain\n    ]);\n\n    const handleLoadMap = useCallback((event) => {\n        loadMap({\n            event, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleLoadBuiltInMap = useCallback((mapData) => {\n        loadBuiltInMap({\n            mapData, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleClearMap = useCallback(() => {\n        clearMap({ \n            mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata \n        });\n    }, [mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    const openNewMapModal = () => {\n        setTempMapName(mapName);\n        setTempCreatorName(creatorName);\n        setTempMapDescription(mapDescription);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = (tempMapName, tempCreatorName, tempMapDescription) => {\n        setMapName(tempMapName || \"New Map\");\n        setCreatorName(tempCreatorName || \"Anonymous\");\n        setMapDescription(tempMapDescription || \"\");\n        setCreatedAt(new Date().toISOString());\n        \n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n        \n        setIsNewMapModalOpen(false);\n    };\n\n    return {\n        handleSaveMap,\n        handleLoadMap,\n        handleLoadBuiltInMap,\n        handleClearMap,\n        openNewMapModal,\n        confirmNewMap\n    };\n};\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = new Set();\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.add(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    if (startId === targetId) return currentData;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    return newData;\n};\n\nexport const paintTile = ({\n    index, brushSize, activeLayer, selectedTile,\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    isRoomAreaVisible, activeTool\n}) => {\n    const isPropsLayer = activeLayer === 'props';\n    const targetLayer = isPropsLayer ? 'object' : activeLayer;\n\n    const targetData = targetLayer === 'tile' ? tileMapData : (targetLayer === 'object' ? objectMapData : secretMapData);\n    const setTargetData = targetLayer === 'tile' ? setTileMapData : (targetLayer === 'object' ? setObjectMapData : setSecretMapData);\n    \n    const newData = [...targetData];\n    let newMetadata = objectMetadata ? { ...objectMetadata } : null;\n    let metadataChanged = false;\n\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                \n                // Protection for Room Areas\n                if (targetLayer === 'secret' && secretMapData[targetIndex] === 'room_area') {\n                    const isRoomAreaTool = activeTool === 'area' || selectedTile?.id === 'room_area';\n                    const isEraser = selectedTile === null;\n                    if (!isRoomAreaVisible && !isRoomAreaTool && !isEraser) {\n                        continue; // Skip overwriting room_area if not visible and not using room tool\n                    }\n                }\n\n                if (isPropsLayer && selectedTile === null) {\n                    // In props layer eraser mode, remove object + metadata.\n                    newData[targetIndex] = null;\n                    if (newMetadata && newMetadata[targetIndex]) {\n                        delete newMetadata[targetIndex];\n                        metadataChanged = true;\n                    }\n                } else {\n                    newData[targetIndex] = selectedTile ? selectedTile.id : null;\n                    // If we are painting/erasing in object layer, we should also handle metadata\n                    if (targetLayer === 'object' && selectedTile === null) {\n                        if (newMetadata && newMetadata[targetIndex]) {\n                            delete newMetadata[targetIndex];\n                            metadataChanged = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    setTargetData(newData);\n    if (metadataChanged && setObjectMetadata) {\n        setObjectMetadata(newMetadata);\n    }\n};\n","import { useState, useRef, useEffect, useCallback } from 'react';\nimport { getFloodFillIndices, floodFill, paintTile as paintTileUtil } from '../editorTools/paintingTools';\n\nexport const useEditorPainting = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n    setTileMapData, setObjectMapData, setSecretMapData,\n    activeTool, brushSize, activeLayer, selectedTile, selection, \n    setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n    setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n    objectMetadata, setObjectMetadata,\n    maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n) => {\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [resizeState, setResizeState] = useState(null); // { index, edge, startX, startY, startW, startH }\n    const [moveState, setMoveState] = useState(null); // { index, startX, startY, objId, secretId, meta }\n    const bucketTimerRef = useRef(null);\n    const rightEraseRef = useRef(false);\n\n    const getLinkedRoomAt = useCallback((index) => {\n        if (!showRoomMapContent || !secretMapData || !objectMetadata) return null;\n        \n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n\n        // Scan for room areas\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                const rx = idx % mapWidth;\n                const ry = Math.floor(idx / mapWidth);\n                const rw = meta.width || 1;\n                const rh = meta.height || 1;\n\n                if (x >= rx && x < rx + rw && y >= ry && y < ry + rh) {\n                    return {\n                        mapId: meta.linkedMapId,\n                        roomX: rx,\n                        roomY: ry,\n                        roomWidth: rw,\n                        roomHeight: rh,\n                        localX: x - rx,\n                        localY: y - ry,\n                        map: maps[meta.linkedMapId]\n                    };\n                }\n            }\n        }\n        return null;\n    }, [showRoomMapContent, secretMapData, objectMetadata, maps, mapWidth]);\n\n    const paintTile = useCallback((index, overrideSelectedTile) => {\n        const effectiveTile = overrideSelectedTile !== undefined ? overrideSelectedTile : selectedTile;\n        const linkedRoom = getLinkedRoomAt(index);\n        \n        if (linkedRoom && showRoomMapContent) {\n            const { mapId, localX, localY, map } = linkedRoom;\n            const rWidth = map.mapWidth;\n            const rHeight = map.mapHeight;\n            const roomIndex = localY * rWidth + localX;\n\n            const setRoomData = (layer, newData) => {\n                updateMapData(mapId, { [layer]: newData });\n            };\n\n            const setRoomMetadata = (newMeta) => {\n                updateMapData(mapId, { objectMetadata: newMeta });\n            };\n\n            paintTileUtil({\n            index: roomIndex,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile: effectiveTile,\n                mapWidth: rWidth,\n                mapHeight: rHeight,\n                tileMapData: map.tileMapData || [],\n                objectMapData: map.objectMapData || [],\n                secretMapData: map.secretMapData || [],\n                objectMetadata: map.objectMetadata || {},\n                setTileMapData: (data) => setRoomData('tileMapData', data),\n                setObjectMapData: (data) => setRoomData('objectMapData', data),\n                setSecretMapData: (data) => setRoomData('secretMapData', data),\n                setObjectMetadata: setRoomMetadata,\n                isRoomAreaVisible\n            });\n            return;\n        }\n\n        paintTileUtil({\n            index,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile: effectiveTile,\n            mapWidth,\n            mapHeight,\n            tileMapData,\n            objectMapData,\n            secretMapData,\n            objectMetadata,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData,\n            setObjectMetadata,\n            isRoomAreaVisible\n        });\n    }, [getLinkedRoomAt, showRoomMapContent, updateMapData, activeTool, brushSize, activeLayer, selectedTile, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, isRoomAreaVisible]);\n\n    const handleResizeStart = useCallback((index, edge) => {\n        const meta = objectMetadata[index] || {};\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setResizeState({\n            index,\n            edge,\n            startX: x,\n            startY: y,\n            startW: meta.width || 1,\n            startH: meta.height || 1\n        });\n        setIsDragging(true);\n    }, [objectMetadata, mapWidth, setIsDragging]);\n\n    const handleMoveStart = useCallback((index) => {\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setMoveState({\n            index,\n            startX: x,\n            startY: y,\n            objId: objectMapData[index],\n            secretId: secretMapData[index],\n            meta: objectMetadata[index] ? { ...objectMetadata[index] } : null\n        });\n        setIsDragging(true);\n        setHighlightedIndex(index);\n    }, [objectMapData, secretMapData, objectMetadata, mapWidth, setIsDragging, setHighlightedIndex]);\n\n    const handleGridMouseDown = useCallback((index, e) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n        const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n        const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n        \n        const mTileMapData = useLinked ? linkedRoom.map.tileMapData : tileMapData;\n        const mObjectMapData = useLinked ? linkedRoom.map.objectMapData : objectMapData;\n        const mSecretMapData = useLinked ? linkedRoom.map.secretMapData : secretMapData;\n        const mObjectMetadata = useLinked ? linkedRoom.map.objectMetadata : objectMetadata;\n\n        const mSetTileMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { tileMapData: data }) : setTileMapData;\n        const mSetObjectMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMapData: data }) : setObjectMapData;\n        const mSetSecretMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { secretMapData: data }) : setSecretMapData;\n        const mSetObjectMetadata = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMetadata: data }) : setObjectMetadata;\n\n        // Quick select for configurable objects\n        const existingObjId = mObjectMapData[mIndex];\n        const existingSecretId = mSecretMapData[mIndex];\n        const isEraser = selectedTile === null && activeTool === 'brush';\n        const isRoomMap = maps[activeMapId]?.type === 'room';\n\n        if (!isEraser && (existingObjId || existingSecretId) && setActivePanel && setHighlightedIndex) {\n            const objDef = existingObjId ? registryItems?.find(r => r.id === existingObjId) : null;\n            const secretDef = existingSecretId ? registryItems?.find(r => r.id === existingSecretId) : null;\n\n            const isWeather = objDef && objDef.type === 'weather_trigger';\n            const isMessage = objDef && objDef.type === 'message_trigger';\n            const isPortalOrTarget = existingObjId && (existingObjId.includes('portal') || existingObjId.includes('target') || existingObjId === 'portal_target');\n            const isDoor = objDef && objDef.subtype === 'door';\n            const isRoomArea = secretDef && secretDef.subtype === 'room' && !isRoomMap;\n\n            if (isWeather || isMessage || isPortalOrTarget || isDoor || isRoomArea) {\n                setActivePanel('props');\n                setHighlightedIndex(useLinked ? index : mIndex);\n            }\n        }\n\n        if (activeTool === 'brush') {\n            const isRightErase = e.button === 2;\n            rightEraseRef.current = isRightErase;\n            if (isRightErase) {\n                e.preventDefault();\n                setIsDragging(true);\n                paintTile(index, null);\n                return;\n            }\n            setIsDragging(true);\n            paintTile(index);\n        } else if (activeTool === 'area') {\n            setIsDragging(true);\n            setDragStart({ x: index % mapWidth, y: Math.floor(index / mapWidth) });\n        } else if (activeTool === 'bucket') {\n            const isPropsLayer = activeLayer === 'props';\n            const targetLayer = isPropsLayer ? 'object' : activeLayer;\n            const targetData = targetLayer === 'tile' ? mTileMapData : (targetLayer === 'object' ? mObjectMapData : mSecretMapData);\n            const targetValue = targetData[mIndex];\n            const newValue = selectedTile ? selectedTile.id : null;\n            if (targetValue === newValue) return;\n\n            const newData = floodFill(mIndex, newValue, targetData, mWidth, mHeight);\n            \n            if (targetLayer === 'tile') mSetTileMapData(newData);\n            else if (targetLayer === 'object') {\n                mSetObjectMapData(newData);\n                // Clean up metadata for all affected indices if erasing\n                if (newValue === null && mObjectMetadata && mSetObjectMetadata) {\n                    const affectedIndices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                    let metaChanged = false;\n                    const newMeta = { ...mObjectMetadata };\n                    affectedIndices.forEach(idx => {\n                        if (newMeta[idx]) {\n                            delete newMeta[idx];\n                            metaChanged = true;\n                        }\n                    });\n                    if (metaChanged) mSetObjectMetadata(newMeta);\n                }\n            }\n            else mSetSecretMapData(newData);\n        } else if (activeTool === 'move') {\n            if (selection) return;\n\n            // If we clicked on an object/secret, start moving it\n            if (existingObjId || existingSecretId) {\n                handleMoveStart(mIndex); // Note: move/resize on linked rooms might still be buggy\n            } else {\n                const x = index % mapWidth;\n                const y = Math.floor(index / mapWidth);\n                setDragStart({ x, y });\n                setIsDragging(true);\n            }\n        }\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, setActivePanel, setHighlightedIndex, registryItems, activeTool, setIsDragging, paintTile, activeLayer, selectedTile, selection, handleMoveStart, setDragStart, getLinkedRoomAt, showRoomMapContent, updateMapData]);\n\n    const handleGridMouseMove = useCallback((index) => {\n        setHoverIndex(index);\n        const curX = index % mapWidth;\n        const curY = Math.floor(index / mapWidth);\n\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        if (resizeState) {\n            // Resize logic - keep on active map for now as it's complex\n            const dx = curX - resizeState.startX;\n            const dy = curY - resizeState.startY;\n            let newW = resizeState.startW;\n            let newH = resizeState.startH;\n            let newIndex = resizeState.index;\n\n            if (resizeState.edge === 'right') newW = Math.max(1, resizeState.startW + dx);\n            if (resizeState.edge === 'bottom') newH = Math.max(1, resizeState.startH + dy);\n            \n            if (resizeState.edge === 'left') {\n                const shift = Math.min(resizeState.startW - 1, dx);\n                newW = resizeState.startW - shift;\n                newIndex = resizeState.startY * mapWidth + (resizeState.startX + shift);\n            }\n            if (resizeState.edge === 'top') {\n                const shift = Math.min(resizeState.startH - 1, dy);\n                newH = resizeState.startH - shift;\n                newIndex = (resizeState.startY + shift) * mapWidth + resizeState.startX;\n            }\n\n            if (newW !== (objectMetadata[resizeState.index]?.width || 1) || \n                newH !== (objectMetadata[resizeState.index]?.height || 1) ||\n                newIndex !== resizeState.index) {\n                \n                const meta = { ...objectMetadata[resizeState.index] };\n                meta.width = newW;\n                meta.height = newH;\n                \n                setObjectMetadata(prev => {\n                    const next = { ...prev };\n                    delete next[resizeState.index];\n                    next[newIndex] = meta;\n                    return next;\n                });\n\n                if (newIndex !== resizeState.index) {\n                    const objId = objectMapData[resizeState.index];\n                    const secretId = secretMapData[resizeState.index];\n                    setObjectMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = objId;\n                        return next;\n                    });\n                    setSecretMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = secretId;\n                        return next;\n                    });\n                    setResizeState(prev => ({ ...prev, index: newIndex, startX: newIndex % mapWidth, startY: Math.floor(newIndex / mapWidth), startW: newW, startH: newH }));\n                    setHighlightedIndex(newIndex);\n                }\n            }\n        } else if (moveState) {\n            if (index === moveState.index) return;\n            \n            // Perform move\n            setObjectMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.objId;\n                return next;\n            });\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.secretId;\n                return next;\n            });\n            setObjectMetadata(prev => {\n                const next = { ...prev };\n                delete next[moveState.index];\n                if (moveState.meta) next[index] = moveState.meta;\n                return next;\n            });\n            setMoveState(prev => ({ ...prev, index, startX: curX, startY: curY }));\n            setHighlightedIndex(index);\n\n        } else if (activeTool === 'brush' && isDragging) {\n            const shouldErase = rightEraseRef.current;\n            paintTile(index, shouldErase ? null : undefined);\n        } else if (activeTool === 'bucket') {\n            if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = setTimeout(() => {\n                const targetLayer = activeLayer === 'props' ? 'object' : activeLayer;\n                \n                const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n                const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n                const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n                const mData = useLinked ? linkedRoom.map : { tileMapData, objectMapData, secretMapData };\n                \n                const targetData = targetLayer === 'tile' ? mData.tileMapData : (targetLayer === 'object' ? mData.objectMapData : mData.secretMapData);\n                const indices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                \n                if (useLinked) {\n                    // We need to convert linked room indices back to main map indices for preview?\n                    // Or just skip preview for linked rooms for now to keep it simple.\n                    setBucketPreviewIndices(new Set()); \n                } else {\n                    setBucketPreviewIndices(indices);\n                }\n            }, 10);\n        }\n    }, [setHoverIndex, activeTool, isDragging, paintTile, activeLayer, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight, setBucketPreviewIndices, resizeState, moveState, objectMetadata, setObjectMetadata, setObjectMapData, setSecretMapData, setHighlightedIndex, getLinkedRoomAt, showRoomMapContent]);\n\n    const handleGridMouseUp = useCallback((index) => {\n        if (activeTool === 'area' && isDragging && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n            const baseIndex = y1 * mapWidth + x1;\n\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[baseIndex] = 'room_area';\n                return next;\n            });\n            setObjectMetadata(prev => ({\n                ...prev,\n                [baseIndex]: { ...prev[baseIndex], width: w, height: h, roomName: 'New Room' }\n            }));\n            setHighlightedIndex(baseIndex);\n            if (setActivePanel) setActivePanel('props');\n            setIsDragging(false);\n            setDragStart(null);\n            return;\n        }\n\n        if (activeTool === 'move' && isDragging && !resizeState && !moveState && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const tileData = [];\n            const objectData = [];\n            const secretData = [];\n            const selectionMetadata = {};\n\n            for (let y = y1; y <= y2; y++) {\n                for (let x = x1; x <= x2; x++) {\n                    const idx = y * mapWidth + x;\n                    tileData.push(tileMapData[idx]);\n                    objectData.push(objectMapData[idx]);\n                    secretData.push(secretMapData[idx]);\n                    if (objectMetadata[idx]) {\n                        selectionMetadata[`${x - x1},${y - y1}`] = { ...objectMetadata[idx] };\n                    }\n                }\n            }\n\n            setSelection({\n                x: x1, y: y1, w, h,\n                originalX: x1, originalY: y1,\n                tileData, objectData, secretData,\n                metadata: selectionMetadata\n            });\n            setPreviewPosition({ x: x1, y: y1 });\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            });\n            setDragStart(null);\n        }\n\n        rightEraseRef.current = false;\n        setIsDragging(false);\n        setResizeState(null);\n        setMoveState(null);\n    }, [activeTool, isDragging, resizeState, moveState, dragStart, mapWidth, tileMapData, objectMapData, secretMapData, setSelection, setPreviewPosition, setOriginalMapData, setDragStart, setIsDragging]);\n\n    return {\n        hoverIndex,\n        setHoverIndex,\n        bucketPreviewIndices,\n        setBucketPreviewIndices,\n        handleGridMouseDown,\n        handleGridMouseMove,\n        handleGridMouseUp,\n        handleResizeStart,\n        handleMoveStart,\n        paintTile\n    };\n};\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { resizeMapData } from './editorTools/mapOperations';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './editorTools/NewMapModal';\nimport { BuiltInMapsModal } from './editorTools/BuiltInMapsModal';\nimport { EditorScene } from './EditorScene';\nimport { EditorElements } from './EditorElements';\nimport { EditorTools } from './EditorTools';\nimport PixiStage from '../game/PixiStage';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\n// Custom Hooks\nimport { useEditorRegistry } from './hooks/useEditorRegistry';\nimport { useEditorSelection } from './hooks/useEditorSelection';\nimport { useEditorPlayMode } from './hooks/useEditorPlayMode';\nimport { useEditorOperations } from './hooks/useEditorOperations';\nimport { useEditorPainting } from './hooks/useEditorPainting';\nimport { useEditorMaps } from './hooks/useEditorMaps';\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nexport const Editor = () => {\n    const registryItems = useMemo(() => getRegistry() || [], []);\n    const playerVisuals = useMemo(() => registryItems.find(item => item.id === 'player') || EMPTY_OBJECT, [registryItems]);\n\n    // Basic Map State\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [objectMetadata, setObjectMetadata] = useState({});\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n    const [showBackgroundImage, setShowBackgroundImage] = useState(true);\n    const [showMessages, setShowMessages] = useState(() => {\n        try {\n            const v = localStorage.getItem('editor_show_messages');\n            if (v === null) return true;\n            return v !== '0';\n        } catch {\n            return true;\n        }\n    });\n\n    // Tools & Modes State\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [isRoomAreaVisible, setIsRoomAreaVisible] = useState(false);\n    const [showRoomMapContent, setShowRoomMapContent] = useState(false);\n    const [isWorldViewOpen, setIsWorldViewOpen] = useState(false);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata });\n\n    // Metadata State\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [mapDescription, setMapDescription] = useState(\"\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [highlightedIndex, setHighlightedIndex] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [isBuiltInMapsModalOpen, setIsBuiltInMapsModalOpen] = useState(false);\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n    const [tempMapDescription, setTempMapDescription] = useState(\"\");\n    const [activePanel, setActivePanel] = useState(null);\n\n    // Asset Options\n    const backgroundOptions = useMemo(() => loadBackgroundOptions(), []);\n    const musicOptions = useMemo(() => loadMusicOptions(), []);\n\n    // Background State\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#99C1F1');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    // Weather State\n    const [weatherRain, setWeatherRain] = useState(0);\n    const [weatherSnow, setWeatherSnow] = useState(0);\n    const [weatherClouds, setWeatherClouds] = useState(0);\n    const [weatherFog, setWeatherFog] = useState(0);\n    const [weatherThunder, setWeatherThunder] = useState(0);\n    const [weatherLavaRain, setWeatherLavaRain] = useState(0);\n    const [weatherRadioactiveFog, setWeatherRadioactiveFog] = useState(0);\n    const [weatherMeteorRain, setWeatherMeteorRain] = useState(0);\n\n    const [playerPosition, setPlayerPosition] = useState({ x: 100, y: 100 });\n\n    useEffect(() => {\n        try { localStorage.setItem('editor_show_messages', showMessages ? '1' : '0'); } catch {}\n    }, [showMessages]);\n\n    // Multi-map state\n    const { \n        maps, setMaps, activeMapId, setActiveMapId, createMap: createNewMap, updateMapData, deleteMap \n    } = useEditorMaps();\n\n    const lastActiveMapIdRef = useRef(activeMapId);\n\n    const switchMap = useCallback((newMapId, spawnTriggerId = null) => {\n        if (newMapId === activeMapId) return;\n\n        // 1. Save current map data to store\n        updateMapData(activeMapId, {\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n            weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n            playerPosition\n        });\n\n        // 2. Load new map data\n        const nextMap = maps[newMapId];\n        if (nextMap) {\n            setMapWidth(nextMap.mapWidth);\n            setMapHeight(nextMap.mapHeight);\n            setTileMapData(nextMap.tileMapData);\n            setObjectMapData(nextMap.objectMapData);\n            setSecretMapData(nextMap.secretMapData);\n            setObjectMetadata(nextMap.objectMetadata || {});\n            setCreatedAt(nextMap.createdAt || new Date().toISOString());\n            setSelectedBackgroundImage(nextMap.selectedBackgroundImage);\n            setSelectedBackgroundColor(nextMap.selectedBackgroundColor);\n            setBackgroundParallaxFactor(nextMap.backgroundParallaxFactor || 0.3);\n            setSelectedBackgroundMusic(nextMap.selectedBackgroundMusic);\n            \n            if (nextMap.weather) {\n                setWeatherRain(nextMap.weather.rain || 0);\n                setWeatherSnow(nextMap.weather.snow || 0);\n                setWeatherClouds(nextMap.weather.clouds || 0);\n                setWeatherFog(nextMap.weather.fog || 0);\n                setWeatherThunder(nextMap.weather.thunder || 0);\n                setWeatherLavaRain(nextMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(nextMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(nextMap.weather.meteorRain || 0);\n            }\n            \n            if (nextMap.playerPosition) {\n                setPlayerPosition(nextMap.playerPosition);\n            }\n            \n            // If we have a spawnTriggerId, we might want to store it temporarily\n            // so useEditorPlayMode can include it in mapDataForGame.meta\n            // But actually, we can just update the map data in the store with this triggerId.\n            if (spawnTriggerId !== null) {\n                updateMapData(newMapId, { ...nextMap, spawnTriggerId });\n            }\n\n            setActiveMapId(newMapId);\n        }\n    }, [\n        activeMapId, maps, updateMapData, setActiveMapId,\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const handleCreateMap = useCallback((type, name, width, height) => {\n        const finalName = name || prompt(`Enter ${type} map name:`, `New ${type.charAt(0).toUpperCase() + type.slice(1)}`);\n        if (finalName) {\n            const finalWidth = width || mapWidth;\n            const finalHeight = height || mapHeight;\n            const newId = createNewMap(type, finalName, finalWidth, finalHeight);\n            return newId;\n        }\n    }, [createNewMap, mapWidth, mapHeight]);\n\n    // Update store when current map data changes (for minimap preview)\n    useEffect(() => {\n        // Skip update if activeMapId just changed to prevent overwriting new map data with old map state\n        if (lastActiveMapIdRef.current !== activeMapId) {\n            lastActiveMapIdRef.current = activeMapId;\n            return;\n        }\n\n        const timeout = setTimeout(() => {\n            updateMapData(activeMapId, {\n                mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n                selectedBackgroundImage, selectedBackgroundColor,\n                selectedBackgroundMusic, backgroundParallaxFactor,\n                weather: {\n                    rain: weatherRain,\n                    snow: weatherSnow,\n                    clouds: weatherClouds,\n                    fog: weatherFog,\n                    thunder: weatherThunder,\n                    lavaRain: weatherLavaRain,\n                    radioactiveFog: weatherRadioactiveFog,\n                    meteorRain: weatherMeteorRain\n                },\n                playerPosition\n            });\n        }, 1000); // Debounce store updates\n        return () => clearTimeout(timeout);\n    }, [\n        activeMapId, updateMapData, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, selectedBackgroundMusic, backgroundParallaxFactor,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    // Use Custom Hooks\n    const { \n        blocks, liquids, entities, decorations, items, interactables, hazards, secrets, miniGames, weather, messages, crackableWalls, pushableWalls, obstacles \n    } = useEditorRegistry(registryItems);\n\n    const { \n        selection, setSelection, selectionMode, setSelectionMode, previewPosition, setPreviewPosition,\n        originalMapData, setOriginalMapData, moveSelection, commitSelection, cancelSelection \n    } = useEditorSelection(mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata);\n\n    const {\n        isPlayMode, handlePlay, handlePause, handleReset, handleReplay, handleStateUpdate, handleForceStop,\n        playModeObjectData, playModeSecretData, playModeWeather, playModeMaps, gameMessage, revealedSecrets, \n        activeRoomIds, gameEngineState, isGameOver\n    } = useEditorPlayMode(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n        registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        maps, activeMapId, switchMap, maps[activeMapId]?.spawnTriggerId,\n        setTileMapData, updateMapData\n    );\n\n    const {\n        handleSaveMap, handleLoadMap, handleLoadBuiltInMap, handleClearMap, openNewMapModal, confirmNewMap\n    } = useEditorOperations(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        maps, setMaps, activeMapId, setActiveMapId\n    );\n\n    const handleLoadMapWrapped = useCallback((event) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadMap(event);\n    }, [isPlayMode, handleForceStop, handleLoadMap]);\n\n    const handleLoadBuiltInMapWrapped = useCallback((mapData) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadBuiltInMap(mapData);\n    }, [isPlayMode, handleForceStop, handleLoadBuiltInMap]);\n\n    const {\n        hoverIndex, setHoverIndex, bucketPreviewIndices, setBucketPreviewIndices,\n        handleGridMouseDown, handleGridMouseMove, handleGridMouseUp,\n        handleResizeStart, handleMoveStart, paintTile\n    } = useEditorPainting(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n        setTileMapData, setObjectMapData, setSecretMapData,\n        activeTool, brushSize, activeLayer, selectedTile, selection, \n        setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n        setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n        objectMetadata, setObjectMetadata,\n        maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n    );\n\n    // Side Effects\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    useEffect(() => {\n        if (!secretMapData || !objectMapData || secretMapData.length === 0) return;\n        const toMove = [];\n        for (let i = 0; i < secretMapData.length; i++) {\n            const secretId = secretMapData[i];\n            if (secretId && typeof secretId === 'string' && secretId.startsWith('minispill_sea_rescue_box') && !objectMapData[i]) {\n                toMove.push({ index: i, id: secretId === 'minispill_sea_rescue_box' ? 'minispill_sea_rescue_box0' : secretId });\n            }\n        }\n        if (toMove.length === 0) return;\n        setObjectMapData(prev => {\n            const next = [...prev];\n            toMove.forEach(item => {\n                next[item.index] = item.id;\n            });\n            return next;\n        });\n        setSecretMapData(prev => {\n            const next = [...prev];\n            toMove.forEach(item => {\n                next[item.index] = null;\n            });\n            return next;\n        });\n    }, [secretMapData, objectMapData, setObjectMapData, setSecretMapData]);\n\n    const togglePanel = (panel) => {\n        setActivePanel(prev => prev === panel ? null : panel);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n        resizeMapData({\n            newWidth, newHeight, stateRef, setMapWidth, setMapHeight,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata\n        });\n    };\n\n    const handlePaletteSelect = useCallback((item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    }, []);\n\n    // Grid Event Handlers\n    \n    const handleGridMouseLeave = useCallback(() => {\n        setHoverIndex(null);\n        setBucketPreviewIndices(new Set());\n    }, [setHoverIndex, setBucketPreviewIndices]);\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    const onAddRoomArea = useCallback(() => {\n        setIsWorldViewOpen(false);\n        setActiveTool('area');\n        setActiveLayer('secret');\n    }, []);\n\n    const handleDeleteMap = useCallback((id) => {\n        if (id === activeMapId) {\n            switchMap('main');\n        }\n        deleteMap(id);\n    }, [activeMapId, switchMap, deleteMap]);\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\n            <NewMapModal \n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                tempMapDescription={tempMapDescription}\n                setTempMapDescription={setTempMapDescription}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <BuiltInMapsModal \n                isOpen={isBuiltInMapsModalOpen}\n                onClose={() => setIsBuiltInMapsModalOpen(false)}\n                onSelect={handleLoadBuiltInMapWrapped}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', flex: 1, flexDirection: 'row',\n                filter: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'none' : 'auto',\n                overflow: 'hidden'\n            }}>\n                <EditorElements \n                    mapName={mapName}\n                    creatorName={creatorName}\n                    mapDescription={mapDescription}\n                    setMapName={setMapName}\n                    setCreatorName={setCreatorName}\n                    setMapDescription={setMapDescription}\n                    openNewMapModal={openNewMapModal}\n                    openBuiltInModal={() => setIsBuiltInMapsModalOpen(true)}\n                    saveMap={handleSaveMap}\n                    loadMap={handleLoadMapWrapped}\n                    clearMap={handleClearMap}\n                    isPlayMode={isPlayMode}\n                    handlePaletteSelect={handlePaletteSelect}\n                    selectedTile={selectedTile}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    decorations={decorations}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    miniGames={miniGames}\n                    weather={weather}\n                    messages={messages}\n                    crackableWalls={crackableWalls}\n                    pushableWalls={pushableWalls}\n                    obstacles={obstacles}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    objectMapData={objectMapData}\n                    secretMapData={secretMapData}\n                    objectMetadata={objectMetadata}\n                    setObjectMetadata={setObjectMetadata}\n                    registryItems={registryItems}\n                    highlightedIndex={highlightedIndex}\n                    setHighlightedIndex={setHighlightedIndex}\n                    activePanel={activePanel}\n                    setActivePanel={setActivePanel}\n                    togglePanel={togglePanel}\n                    maps={maps}\n                    activeMapId={activeMapId}\n                    createMap={handleCreateMap}\n                    mapType={maps[activeMapId]?.type || 'overworld'}\n                    updateMapData={updateMapData}\n                />\n\n                <div style={{ display: 'flex', flex: 1, flexDirection: 'column', overflow: 'hidden' }}>\n                    <EditorTools\n                        mapName={mapName}\n                        creatorName={creatorName}\n                        activePanel={activePanel}\n                        togglePanel={togglePanel}\n                        showGrid={showGrid}\n                        setShowGrid={setShowGrid}\n                        isPlayMode={isPlayMode}\n                        handlePlay={handlePlay}\n                        handlePause={handlePause}\n                        handleReset={handleReset}\n                        activeTool={activeTool}\n                        setActiveTool={setActiveTool}\n                        brushSize={brushSize}\n                        setBrushSize={setBrushSize}\n                        activeLayer={activeLayer}\n                        selection={selection}\n                        moveSelection={moveSelection}\n                        selectionMode={selectionMode}\n                        setSelectionMode={setSelectionMode}\n                        commitSelection={commitSelection}\n                        cancelSelection={cancelSelection}\n                        selectedTile={selectedTile}\n                        handlePaletteSelect={handlePaletteSelect}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        showBackgroundImage={showBackgroundImage}\n                        setShowBackgroundImage={setShowBackgroundImage}\n                        showMessages={showMessages}\n                        setShowMessages={setShowMessages}\n                        isRoomAreaVisible={isRoomAreaVisible}\n                        setIsRoomAreaVisible={setIsRoomAreaVisible}\n                        showRoomMapContent={showRoomMapContent}\n                        setShowRoomMapContent={setShowRoomMapContent}\n                    />\n                    \n                    <div style={{ display: 'flex', flex: 1, flexDirection: 'row', overflow: 'hidden', position: 'relative' }}>\n\n                    <EditorScene \n                        handleMapResize={handleMapResize}\n                        isResizeWindowOpen={isResizeWindowOpen}\n                        setIsResizeWindowOpen={setIsResizeWindowOpen}\n                        isWorldViewOpen={isWorldViewOpen}\n                        setIsWorldViewOpen={setIsWorldViewOpen}\n                        onAddRoomArea={onAddRoomArea}\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                        // Multi-map props\n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        createMap={handleCreateMap}\n                        deleteMap={handleDeleteMap}\n                        updateMapData={updateMapData}\n                        showRoomMapContent={showRoomMapContent}\n                        activeRoomIds={activeRoomIds}\n                    />\n\n                    {!isPlayMode ? (\n                        <Viewport\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            selectedBackgroundUrl={selectedBackgroundUrl}\n                            selectedBackgroundColor={selectedBackgroundColor}\n                            selectedBackgroundImage={selectedBackgroundImage}\n                            showBackgroundImage={showBackgroundImage}\n                            showGrid={showGrid}\n                            activeLayer={activeLayer}\n                            activeTool={activeTool}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            hoverIndex={hoverIndex}\n                            highlightedIndex={highlightedIndex}\n                            brushSize={brushSize}\n                            bucketPreviewIndices={bucketPreviewIndices}\n                            selection={selection}\n                            previewPosition={previewPosition}\n                            dragStart={dragStart}\n                            isDragging={isDragging}\n                            selectedTile={selectedTile}\n                            handleGridMouseDown={handleGridMouseDown}\n                            handleGridMouseEnter={handleGridMouseMove}\n                            handleGridMouseUp={handleGridMouseUp}\n                            handleGridMouseLeave={handleGridMouseLeave}\n                            handleResizeStart={handleResizeStart}\n                            handleMoveStart={handleMoveStart}\n                            setIsDragging={setIsDragging}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            mapType={maps[activeMapId]?.type || 'overworld'}\n                            isRoomAreaVisible={isRoomAreaVisible}\n                            showRoomMapContent={showRoomMapContent}\n                            showMessages={showMessages}\n                            maps={maps}\n                        />\n                    ) : (\n                        <div style={{ flex: 1, position: 'relative', backgroundColor: '#000' }}>\n                            <PixiStage\n                                mapWidth={mapWidth}\n                                mapHeight={mapHeight}\n                                tileSize={TILE_SIZE}\n                                tileMapData={tileMapData}\n                                objectMapData={playModeObjectData}\n                                secretMapData={playModeSecretData}\n                                revealedSecrets={revealedSecrets || []}\n                                registryItems={registryItems}\n                                playerState={gameEngineState}\n                                playerVisuals={playerVisuals}\n                                projectiles={gameEngineState?.projectiles || []}\n                                objectMetadata={objectMetadata}\n                                backgroundImage={showBackgroundImage ? selectedBackgroundImage : null}\n                                backgroundColor={selectedBackgroundColor}\n                                backgroundParallaxFactor={backgroundParallaxFactor}\n                                weatherRain={playModeWeather.rain}\n                                weatherLavaRain={playModeWeather.lavaRain}\n                                weatherSnow={playModeWeather.snow}\n                                weatherMeteorRain={playModeWeather.meteorRain}\n                                weatherClouds={playModeWeather.clouds}\n                                weatherFog={playModeWeather.fog}\n                                weatherRadioactiveFog={playModeWeather.radioactiveFog}\n                                weatherThunder={playModeWeather.thunder}\n                                onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                                isEditor={false}\n                                isEditorPlayMode={true}\n                                showGrid={showGrid}\n                            mapType={(playModeMaps?.[activeMapId]?.type || maps[activeMapId]?.type) || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={playModeMaps || maps}\n                        />\n                            {isGameOver && (\n                                <GameOverOverlay>\n                                    <GameOverTitle>Game Over</GameOverTitle>\n                                    <ReplayButton onClick={handleReplay}>\n                                        REPLAY \n                                    </ReplayButton>\n                                </GameOverOverlay>\n                            )}\n                            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    </div>\n);\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import { useState, useCallback } from 'react';\n\nexport const useEditorMaps = () => {\n    const [maps, setMaps] = useState({\n        'main': {\n            id: 'main',\n            name: 'Main',\n            description: '',\n            type: 'overworld',\n            mapWidth: 20,\n            mapHeight: 15,\n            tileMapData: Array(20 * 15).fill(null),\n            objectMapData: Array(20 * 15).fill(null),\n            secretMapData: Array(20 * 15).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: '#99C1F1',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: { x: 100, y: 100 },\n            worldX: 50,\n            worldY: 50\n        }\n    });\n    const [activeMapId, setActiveMapId] = useState('main');\n\n    const createMap = useCallback((type, name, width = 20, height = 15) => {\n        const id = `map_${Date.now()}`;\n        \n        // Find a good spot for new map\n        const existingMaps = Object.values(maps);\n        const maxY = Math.max(...existingMaps.map(m => m.worldY || 0), 0);\n        \n        const newMap = {\n            id,\n            name: name || (type === 'overworld' ? 'New Overworld' : (type === 'sea_rescue' ? 'Sea Rescue' : 'New Underworld')),\n            description: '',\n            type,\n            mapWidth: width,\n            mapHeight: height,\n            tileMapData: Array(width * height).fill(null),\n            objectMapData: Array(width * height).fill(null),\n            secretMapData: Array(width * height).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: type === 'overworld' ? '#99C1F1' : (type === 'sea_rescue' ? '#99C1F1' : '#1a1a1a'),\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: null, // Only one map should have player eventually\n            worldX: 50,\n            worldY: maxY + 150\n        };\n\n        setMaps(prev => ({\n            ...prev,\n            [id]: newMap\n        }));\n        return id;\n    }, []);\n\n    const updateMapData = useCallback((id, data) => {\n        setMaps(prev => ({\n            ...prev,\n            [id]: {\n                ...prev[id],\n                ...data\n            }\n        }));\n    }, []);\n\n    const deleteMap = useCallback((id) => {\n        if (id === 'main') return; // Cannot delete main map\n        setMaps(prev => {\n            const newMaps = { ...prev };\n            delete newMaps[id];\n            return newMaps;\n        });\n        if (activeMapId === id) {\n            setActiveMapId('main');\n        }\n    }, [activeMapId]);\n\n    return {\n        maps,\n        setMaps,\n        activeMapId,\n        setActiveMapId,\n        createMap,\n        updateMapData,\n        deleteMap\n    };\n};\n","import { useMemo } from 'react';\n\nexport const useEditorRegistry = (registryItems) => {\n    const blocks = useMemo(() => \n        registryItems.filter(item => {\n            if (!item.name || !item.name.startsWith('block.')) return false;\n            if (item.flags && item.flags.liquid) return false;\n            if (item.editor && item.editor.panel && item.editor.panel !== 'blocks') return false;\n            return true;\n        }), \n    [registryItems]);\n\n    const liquids = useMemo(() => \n        registryItems.filter(item => item.flags && item.flags.liquid), \n    [registryItems]);\n\n    const entities = useMemo(() => {\n        const baseEntities = registryItems.filter(item => {\n            if (!item.name || !item.name.toLowerCase().includes('entities.')) return false;\n            if (item.isHiddenInEditor) return false;\n            return !item.type || item.type === 'default' || item.type === 'entity' || item.subtype === 'tank';\n        });\n\n        const itemsToMove = registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            item.id !== 'hertz_item' && \n            item.id !== 'fireball_ammo'\n        );\n\n        return [...baseEntities, ...itemsToMove];\n    }, [registryItems]);\n\n    const decorations = useMemo(() => \n        registryItems.filter(item => {\n            if (item.type === 'decoration') return true;\n            if (item.name && item.name.toLowerCase().includes('decoration.')) return true;\n            if (item.id && item.id.includes('stone_pack')) return true;\n            return false;\n        }), \n    [registryItems]);\n\n    const items = useMemo(() => \n        registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            (item.id === 'hertz_item' || item.id === 'fireball_ammo')\n        ), \n    [registryItems]);\n\n    const interactables = useMemo(() => \n        registryItems.filter(item => {\n            if (item.editor && item.editor.panel) return item.editor.panel === 'interactables';\n            return item.type === 'interactable' || (item.name && item.name.startsWith('interactable.'));\n        }), \n    [registryItems]);\n\n    const hazards = useMemo(() => \n        registryItems.filter(item => item.type === 'hazard' || (item.name && item.name.startsWith('hazard.'))), \n    [registryItems]);\n\n    const secrets = useMemo(() => \n        registryItems.filter(item => item.type === 'secret' && item.editor?.panel !== 'minigames'), \n    [registryItems]);\n\n    const miniGames = useMemo(() =>\n        registryItems.filter(item => item.editor?.panel === 'minigames'),\n    [registryItems]);\n\n    const weather = useMemo(() => \n        registryItems.filter(item => item.type === 'weather_trigger'), \n    [registryItems]);\n\n    const messages = useMemo(() => \n        registryItems.filter(item => item.type === 'message_trigger'), \n    [registryItems]);\n\n    const crackableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'crack_block'),\n    [registryItems]);\n\n    const pushableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'wolf_secret'),\n    [registryItems]);\n\n    const obstacles = useMemo(() => \n        registryItems.filter(item => item.type === 'obstacle' || (item.name && item.name.startsWith('obstacle.'))), \n    [registryItems]);\n\n    return {\n        blocks,\n        liquids,\n        entities,\n        decorations,\n        items,\n        interactables,\n        hazards,\n        secrets,\n        miniGames,\n        weather,\n        messages,\n        crackableWalls,\n        pushableWalls,\n        obstacles\n    };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nexport const useEditorSelection = (mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata) => {\n    const [selection, setSelection] = useState(null);\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n\n    const moveSelection = useCallback((dx, dy) => {\n        if (!selection || !previewPosition) return;\n        setPreviewPosition({ \n            x: previewPosition.x + dx, \n            y: previewPosition.y + dy \n        });\n    }, [selection, previewPosition]);\n\n    const cancelSelection = useCallback(() => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, []);\n\n    const commitSelection = useCallback(() => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n        const newObjectMetadata = { ...originalMapData.objectMetadata };\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                        delete newObjectMetadata[idx];\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                    \n                    if (selection.metadata && selection.metadata[`${px},${py}`]) {\n                        newObjectMetadata[destIdx] = { ...selection.metadata[`${px},${py}`] };\n                    }\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setObjectMetadata(newObjectMetadata);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, [selection, previewPosition, originalMapData, selectionMode, mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode, commitSelection, cancelSelection]);\n\n    return {\n        selection,\n        setSelection,\n        selectionMode,\n        setSelectionMode,\n        previewPosition,\n        setPreviewPosition,\n        originalMapData,\n        setOriginalMapData,\n        moveSelection,\n        commitSelection,\n        cancelSelection\n    };\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/Editor\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n","var map = {\n\t\"./blocks/block_pack_01/block_pack_01.png\": 8473,\n\t\"./blocks/block_pack_01/ice_block_0001.png\": 9745,\n\t\"./blocks/brick_block_0001.png\": 3611,\n\t\"./blocks/desert_pack_01/desert_pack_0001.png\": 7741,\n\t\"./blocks/desert_pack_01/desert_pack_0002.png\": 182,\n\t\"./blocks/desert_pack_01/desert_pack_0003.png\": 1727,\n\t\"./blocks/desert_pack_01/desert_pack_0004.png\": 6352,\n\t\"./blocks/desert_pack_01/desert_pack_0005.png\": 2601,\n\t\"./blocks/desert_pack_01/desert_pack_0006.png\": 6018,\n\t\"./blocks/desert_pack_01/desert_pack_0007.png\": 6523,\n\t\"./blocks/desert_pack_01/desert_pack_0008.png\": 5132,\n\t\"./blocks/desert_pack_01/desert_pack_0009.png\": 1045,\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 9538,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./decorations/stone_pack_01/stone_pack_01_001.png\": 1978,\n\t\"./decorations/stone_pack_01/stone_pack_01_002.png\": 4526,\n\t\"./decorations/stone_pack_01/stone_pack_01_003.png\": 7928,\n\t\"./decorations/stone_pack_01/stone_pack_01_004.png\": 9447,\n\t\"./decorations/stone_pack_01/stone_pack_01_005.png\": 1134,\n\t\"./decorations/stone_pack_01/stone_pack_01_006.png\": 8485,\n\t\"./decorations/stone_pack_01/stone_pack_01_007.png\": 3036,\n\t\"./decorations/stone_pack_01/stone_pack_01_008.png\": 7195,\n\t\"./decorations/stone_pack_01/stone_pack_01_009.png\": 9330,\n\t\"./decorations/stone_pack_01/stone_pack_01_010.png\": 2952,\n\t\"./decorations/trees/01_umbrella_acacia_544x544.png\": 3353,\n\t\"./entities/animals/fish_01.png\": 6781,\n\t\"./entities/animals/fish_catfish.png\": 5756,\n\t\"./entities/animals/fish_clownfish.png\": 2287,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 8905,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./entities/tanks/tank_0000.png\": 2386,\n\t\"./entities/tanks/tank_0001.png\": 3563,\n\t\"./entities/tanks/tank_0002.png\": 5232,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./hazards/death_block_0001.png\": 3527,\n\t\"./interactables/arrows/arrow_down.png\": 7152,\n\t\"./interactables/arrows/arrow_left.png\": 8047,\n\t\"./interactables/arrows/arrow_right.png\": 592,\n\t\"./interactables/arrows/arrow_up.png\": 7263,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./interactables/doors/door_0001.png\": 175,\n\t\"./interactables/ends/end_0001.png\": 8597,\n\t\"./interactables/ledders/ledder_steel_01.png\": 5227,\n\t\"./interactables/ledders/ledder_wooden_01.png\": 3368,\n\t\"./interactables/platforms/platform_0001.png\": 9427,\n\t\"./interactables/portals/portal_01/portal_A_001.png\": 8518,\n\t\"./interactables/portals/portal_01/portal_A_002.png\": 3933,\n\t\"./interactables/portals/portal_01/portal_A_003.png\": 692,\n\t\"./interactables/portals/portal_01/portal_A_004.png\": 5499,\n\t\"./interactables/portals/portal_01/portal_A_005.png\": 3954,\n\t\"./interactables/portals/portal_01/portal_A_006.png\": 8489,\n\t\"./interactables/portals/portal_01/portal_A_007.png\": 4288,\n\t\"./interactables/portals/portal_01/portal_A_008.png\": 8519,\n\t\"./interactables/portals/portal_01/portal_A_009.png\": 2734,\n\t\"./interactables/portals/portal_01/portal_A_010.png\": 3124,\n\t\"./interactables/portals/portal_01/portal_A_011.png\": 4253,\n\t\"./interactables/portals/portal_01/portal_A_012.png\": 6838,\n\t\"./interactables/portals/portal_01/portal_A_013.png\": 5583,\n\t\"./interactables/portals/portal_01/portal_A_014.png\": 9712,\n\t\"./interactables/portals/portal_01/portal_A_015.png\": 5465,\n\t\"./interactables/portals/portal_01/portal_A_016.png\": 1458,\n\t\"./interactables/stone_0001.png\": 1020,\n\t\"./interactables/wooden_box_0001.png\": 1169,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box.png\": 9003,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_ship.png\": 1580,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205,\n\t\"./secrets/crack_block.png\": 2789,\n\t\"./signs/sign01.png\": 9784\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","var map = {\n\t\"./City.png\": 3676,\n\t\"./Forest.png\": 6370,\n\t\"./Preview_143.png\": 574,\n\t\"./UndergroundCave.png\": 2445,\n\t\"./lv8kgjusouta1.png\": 3789,\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719,\n\t\"./seamless_07.png\": 6390\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 2201;","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./background/calm-shoreline-waves-baltic-sea-427923.ogg\": 4662,\n\t\"./sfx/dammage/hit-flesh-03-266308.ogg\": 7808,\n\t\"./sfx/mini_spill/ship-engine-32705.ogg\": 8795,\n\t\"./sfx/mini_spill/ship-horn-352063.ogg\": 4682,\n\t\"./sfx/stones/rolling-24b-100544.ogg\": 1835,\n\t\"./sfx/target/seagulls-3-34057.ogg\": 8583,\n\t\"./sfx/water/in_fish-splashing-release-1-96870.ogg\": 3700,\n\t\"./sfx/water/out_splash-4-46870.ogg\": 5923,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/brick_block_0001.json\": 544,\n\t\"./blocks/desert_block_0001.json\": 6918,\n\t\"./blocks/desert_block_0002.json\": 8359,\n\t\"./blocks/desert_block_0003.json\": 324,\n\t\"./blocks/desert_block_0004.json\": 2149,\n\t\"./blocks/desert_block_0005.json\": 5418,\n\t\"./blocks/desert_block_0006.json\": 5531,\n\t\"./blocks/desert_block_0007.json\": 4136,\n\t\"./blocks/desert_block_0008.json\": 329,\n\t\"./blocks/desert_block_0009.json\": 9518,\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/dirt_block_0002.json\": 5655,\n\t\"./blocks/dirt_block_0003.json\": 4932,\n\t\"./blocks/dirt_block_0004.json\": 5653,\n\t\"./blocks/dirt_block_0005.json\": 8970,\n\t\"./blocks/dirt_block_0006.json\": 2251,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/hazard/death_block_0001.json\": 698,\n\t\"./blocks/liquids/lava_block.json\": 9649,\n\t\"./blocks/liquids/lava_waterfall_block.json\": 9104,\n\t\"./blocks/liquids/quicksand_block.json\": 1924,\n\t\"./blocks/liquids/radioactive_water_block.json\": 1408,\n\t\"./blocks/liquids/radioactive_waterfall_block.json\": 8317,\n\t\"./blocks/liquids/water_block.json\": 8606,\n\t\"./blocks/liquids/waterfall_block.json\": 119,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./decorations/stone_pack_01_001.json\": 5247,\n\t\"./decorations/stone_pack_01_002.json\": 5134,\n\t\"./decorations/stone_pack_01_003.json\": 9593,\n\t\"./decorations/stone_pack_01_004.json\": 9840,\n\t\"./decorations/stone_pack_01_005.json\": 2867,\n\t\"./decorations/stone_pack_01_006.json\": 7618,\n\t\"./decorations/stone_pack_01_007.json\": 9069,\n\t\"./decorations/stone_pack_01_008.json\": 9588,\n\t\"./decorations/stone_pack_01_009.json\": 3975,\n\t\"./decorations/trees/01_umbrella_acacia.json\": 5669,\n\t\"./entities/animals/fish_01.json\": 2174,\n\t\"./entities/animals/fish_catfish.json\": 6865,\n\t\"./entities/animals/fish_clownfish.json\": 2204,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./entities/tank_0000.json\": 9381,\n\t\"./entities/tank_0001.json\": 8938,\n\t\"./entities/tank_0002.json\": 9179,\n\t\"./interactables/arrows/arrow_down.json\": 3741,\n\t\"./interactables/arrows/arrow_left.json\": 4636,\n\t\"./interactables/arrows/arrow_right.json\": 9821,\n\t\"./interactables/arrows/arrow_up.json\": 7852,\n\t\"./interactables/blocks/ice_block_0001.json\": 5742,\n\t\"./interactables/doors/door_0001.json\": 6332,\n\t\"./interactables/ends/end_0001.json\": 9318,\n\t\"./interactables/harvestables/berry_bush_01.json\": 7562,\n\t\"./interactables/harvestables/berry_bush_01_used.json\": 3614,\n\t\"./interactables/ledders/ledder_0001.json\": 8668,\n\t\"./interactables/ledders/ledder_0002.json\": 3097,\n\t\"./interactables/physics/stone_0001.json\": 9095,\n\t\"./interactables/physics/wooden_box_0001.json\": 1116,\n\t\"./interactables/platforms/platform_0001.json\": 2008,\n\t\"./interactables/portals/portal_001.json\": 2190,\n\t\"./interactables/portals/portal_target.json\": 5206,\n\t\"./items/ammunition/fireball_ammo.json\": 7289,\n\t\"./items/health/hertz_item.json\": 3321,\n\t\"./messages/message_i18n_0001.json\": 5217,\n\t\"./messages/sign_0001.json\": 7046,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box0.json\": 8440,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box1.json\": 4139,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box2.json\": 6426,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box3.json\": 9653,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_seagull.json\": 7734,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_ship.json\": 1729,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_trigger.json\": 3709,\n\t\"./mini_spill/sea_rescue/sea_rescue_settings.json\": 9378,\n\t\"./obstacles/hazards/bushes_001.json\": 6447,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/crack_block.json\": 6854,\n\t\"./secrets/fish_trigger.json\": 2475,\n\t\"./secrets/message_trigger.json\": 3746,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/room_area.json\": 4547,\n\t\"./secrets/secret_area_a.json\": 1866,\n\t\"./secrets/secret_area_b.json\": 3227,\n\t\"./secrets/secret_area_c.json\": 3880,\n\t\"./secrets/wolf_secret_down.json\": 7716,\n\t\"./secrets/wolf_secret_left.json\": 7157,\n\t\"./secrets/wolf_secret_right.json\": 9950,\n\t\"./secrets/wolf_secret_up.json\": 8577,\n\t\"./system/biological_break_effects.json\": 2346,\n\t\"./system/floating_text.json\": 7794,\n\t\"./system/meteor_break_effects.json\": 6643,\n\t\"./system/object_break_effects.json\": 3764,\n\t\"./system/weather_damage.json\": 6234,\n\t\"./weather/weather_clouds_off.json\": 8264,\n\t\"./weather/weather_clouds_on.json\": 9138,\n\t\"./weather/weather_clouds_value.json\": 6592,\n\t\"./weather/weather_fog_off.json\": 4870,\n\t\"./weather/weather_fog_on.json\": 9560,\n\t\"./weather/weather_fog_value.json\": 1374,\n\t\"./weather/weather_lava_rain_off.json\": 4159,\n\t\"./weather/weather_lava_rain_on.json\": 7795,\n\t\"./weather/weather_meteor_rain_off.json\": 8421,\n\t\"./weather/weather_meteor_rain_on.json\": 2097,\n\t\"./weather/weather_radioactive_fog_off.json\": 8304,\n\t\"./weather/weather_radioactive_fog_on.json\": 6298,\n\t\"./weather/weather_rain_off.json\": 8312,\n\t\"./weather/weather_rain_on.json\": 914,\n\t\"./weather/weather_rain_value.json\": 7664,\n\t\"./weather/weather_snow_off.json\": 8445,\n\t\"./weather/weather_snow_on.json\": 969,\n\t\"./weather/weather_snow_value.json\": 5409,\n\t\"./weather/weather_thunder_off.json\": 628,\n\t\"./weather/weather_thunder_on.json\": 1006,\n\t\"./weather/weather_thunder_value.json\": 6756\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./calm-shoreline-waves-baltic-sea-427923.ogg\": 4662\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8815;"],"names":["initialState","activeMapData","tileMapData","objectMapData","secretMapData","objectMetadata","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","projectMaps","isLoading","error","isPaused","isGameOver","activeRoomIds","seaRescuePoints","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","migrateBoxes","data","Array","isArray","i","length","maps","Object","values","forEach","m","mapObjectData","layers","find","l","type","meta","updateObjectMap","updateObjectMetadata","index","metadata","mapId","activeId","activeMapId","activeMap","targetId","removeObjectAtIndex","undefined","room","layerData","removeTileAtIndex","moveTileInMap","fromIndex","toIndex","len","moveObjectInMap","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","idx","includes","push","toggleRoom","roomId","filter","id","clearRooms","setLoading","setError","setPaused","setGameOver","addSeaRescuePoints","captureSeaRescueBox","triggerIndex","boxId","col","targetIndex","y","capturedBoxId","finalIndex","resetGame","actions","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","ui","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","lv_navigation_home","no_navigation","no_navigation_home","en_navigation","en_navigation_home","ru_navigation","ru_navigation_home","ja_navigation","ja_navigation_home","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","tutorial","lv_tutorial_messages","lv_game_map_selector","editor_elements","lv_editor_elements","editor_scene","lv_editor_scene","editor_tools","lv_editor_tools","no","no_tutorial_messages","no_game_map_selector","no_editor_elements","no_editor_scene","no_editor_tools","en","en_tutorial_messages","en_game_map_selector","en_editor_elements","en_editor_scene","en_editor_tools","ru","ru_tutorial_messages","ru_game_map_selector","ru_editor_elements","ru_editor_scene","ru_editor_tools","ja","ja_tutorial_messages","ja_game_map_selector","ja_editor_elements","ja_editor_scene","ja_editor_tools","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","SettingsButton","props","$soundOff","DropdownContainer","div","DropdownMenu","MenuItem","ToggleSwitch","$active","SectionHeaderNavigationLanguages","dropdownRef","useRef","isMenuOpen","setIsMenuOpen","useState","soundEnabled","setSoundEnabled","v","localStorage","getItem","currentLang","language","handleLanguageChange","newLang","changeLanguage","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","ref","title","toggleSound","next","setItem","CustomEvent","detail","enabled","height","backgroundColor","margin","padding","color","StyledLogo","p","SectionHeaderNavigationLogo","tag","trim","toLowerCase","StyledSectionHeaderNavigation","StyledSectionContent","_registry","_registryMap","initRegistry","console","time","jsonContext","require","imageContext","soundContext","e","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","resolveSoundsMap","sounds","k","entries","keys","map","key","item","resolvedTexture","texture","resolvedTextures","textures","path","sfx","sfxResolved","defaultAnimation","animItem","r","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","Map","set","__byId","log","timeEnd","getRegistry","findItemById","get","items","flexDirection","justifyContent","alignItems","width","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","apiUrl","env","REACT_APP_API_URL","logo","URL_LOGO_01","URL_LOGO_02","URL_LOGO_03","URL_LOGO_04","URL_LOGO_05","HomeContainer","Home","LOGO_01","config","LOGO_02","LOGO_03","LOGO_04","LOGO_05","src","alt","TextureCache","constructor","this","_map","url","has","tex","Texture","from","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","maxParticles","resize","area","Math","max","floor","setIntensity","min","Number","spawnOne","g","Graphics","rect","fill","alpha","viewport","getViewport","x","random","speed","vx","vy","rotation","addChild","bounces","alive","update","dtMs","targetIntensity","abs","lerpFactor","exp","norm","scaled","pow","deficit","maxPerFrame","smooth","ceil","toSpawn","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","strength","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","vY","vH","j","splice","WeatherSnow","flakes","seeded","maxFlakes","options","circle","minY","maxY","drift","settled","life","phase","restMs","viewportH","viewportY","seedCount","f","sin","sYwater","sYlava","gAcc","WeatherClouds","bandHeight","patches","windDirection","filters","BlurFilter","quality","rebuild","isInitial","w","h","vX","vW","range","rx","ry","circles","baseR","PI","dist","cx","cos","cy","targetAlpha","currentAlpha","dying","targetCount","W","bandTop","bandBottom","activePatches","_spawnTimer","toKill","osc","leftBound","rightBound","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","nv","_applyAlphas","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","moveTo","lineTo","stroke","alignment","cap","join","branchCount","ang","bx","by","worldX","maxH","isSolid","WeatherLavaRain","waterY","WeatherRadioactiveFog","WeatherMeteorRain","size","isLarge","atan2","waterTouched","playerState","getPlayerState","hitEntity","px","py","pr","dx","dy","entities","ent","ex","ey","er","edx","edy","onMeteorHit","surfaceType","liquidType","getLiquidTypeAt","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","count","spd","d","BubbleFX","bubbles","maxBubbles","rise","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","cur","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","bgContainer","_regions","_waterTex","_lavaTex","_quicksandTex","_waterfallTex","_lavaWaterfallTex","_radioactiveWaterTex","_radioactiveWaterfallTex","_time","_noiseTex","_lavaDetailTex","_waterDetailTex","_quicksandDetailTex","_playerState","setPlayerState","_checkPlayerInRegion","region","pw","ph","pt","tileIndicesSet","getSurfaceY","X","topEdges","bgNode","_gradTextures","mw","mh","ts","changed","waterDrift","lavaDrift","quicksandDrift","waterfallDrift","lavaWaterfallDrift","radioactiveWaterDrift","radioactiveWaterfallDrift","sprite","alphaDiff","splashG","bottomEdges","F","splashHeight","splashColor","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","ampNow","amp","capG","centerX","sigma","gauss","maxDisp","build","typeAt","liquid","lava_waterfall","radioactive_waterfall","waterfall","radioactive_water","quicksand","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","Set","bleed","_createLavaTexture","_createQuicksandTexture","_createWaterfallTexture","_createLavaWaterfallTexture","_createRadioactiveWaterfallTexture","_createRadioactiveWaterTexture","_createWaterTexture","source","addressMode","tiling","detailTex1","detailTex2","_createLavaDetailTexture","_createQuicksandDetailTexture","_createWaterDetailTexture","bgMask","bottomColor","_createGradientTexture","bgSprite","Sprite","_computeTopEdgeSpans","_computeBottomEdgeSpans","topColor","createLinearGradient","addColorStop","fillStyle","fillRect","globalAlpha","beginPath","arc","sw","sh","tilesByRow","above","rowList","cols","sort","start","prev","below","addWave","HealthBar","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","visible","c","pct","_redrawFill","roundRect","innerW","freeze","parallax","tiles","tilesAnim","liquidBackground","objBehind","secretsBelow","player","liquids","liquidFx","projectiles","objFront","secretsAbove","weather","fog","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","isWaterfallDef","isLavaWaterfallDef","isRadioactiveWaterDef","isRadioactiveWaterfallDef","ParallaxBackground","textureCache","cache","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","minWidth","minHeight","hex","parseInt","slice","solid","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","spriteSheet","frameIndex","totalSprites","columns","rows","frameWidth","frameHeight","row","Rectangle","frame","editorIcon","Text","dropShadow","dropShadowColor","dropShadowBlur","dropShadowDistance","anchor","createPlayerContainer","playerVisuals","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","hit","renderMapContent","refs","secretOverlays","targetBg","targetObjBehind","targetObjFront","isEditor","isEditorPlayMode","mapType","secretLayerRef","activeRoomIndices","roomWindowIndices","idxStr","linkedMapId","roomMap","rw","rh","rMapW","worldIdx","localIdx","roomTiles","roomObjs","add","bgColorStr","bgColorHex","substring","roomBg","objId","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","filterColor","filterColorInGame","renderAbove","renderAbovePlayer","renderOnSecretLayer","backingSprite","backing","isPushable","maxHealth","health","visualElement","healthPercent","currentFrame","interaction","inside","renderOffsetX","render","renderOffsetY","overlapX","overlapY","tileW","tileH","objWidth","objHeight","isLargeDecoration","anchorOffsetX","anchorOffsetY","isRoomContent","isSeaRescueShipPart","baseX","baseY","isSeaRescueBox","boxWidth","boxHeight","isWeatherTrigger","isMessageTrigger","isWolfSecret","shouldShowAnyway","isHiddenInGame","boxDef","boxSprite","bBaseTexture","bSource","bCols","bTotal","bFrameIndex","bFrameWidth","bFrameHeight","bCol","bRow","bRect","isDestructible","hb","renderSecretOverlays","overlays","drawOverlay","split","match","parseFloat","createBreakEffectLayer","layer","sortableChildren","createBreakEffectManager","lifeMs","gravity","shape","angleRange","chunks","angle","sp","maxLife","chunkCount","chunkSpeed","chunkLife","chunkSize","chunkGravity","chunkShape","chunkAngle","chunkColors","delta","getLiquidAtPixel","wx","wy","mapWidthTiles","mapHeightTiles","TILE_SIZE","tileData","getDefById","overlayColorRaw","overlayColor","tintBelowSurface","overlayAlphaRaw","overlayAlpha","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","oxygen","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","headY","chestY","feet","chest","head","candidate","inLiquid","headUnder","atSurface","defaultOverlay","rawOverlayColor","rawOverlayAlpha","tickLiquidDamage","deltaMs","accRef","gameState","HIT_FLASH_MS","hitTimerMs","setPreferences","skipCacheIdWarning","preferCreateImageBitmap","EMPTY_ARRAY","EMPTY_OBJECT","LIQUID_SURFACE_MAP","PixiStage","backgroundImage","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherLavaRain","weatherRadioactiveFog","weatherMeteorRain","healthBarEnabled","weatherFog","weatherThunder","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","showGrid","renderLayers","pointerEvents","onWeatherEffectHit","roomBlurEnabled","debugOverlayEnabled","engineInput","engineRefs","isPixiReady","setIsPixiReady","mountRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","cameraPosRef","bgRef","bgAnimRef","bgImageRef","bgColorRef","objBehindRef","objFrontRef","roomBgRef","roomObjBehindRef","roomObjFrontRef","playerRef","playerLayerRef","playerSpriteRefs","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidBgLayerRef","trajectoryLayerRef","liquidSystemRef","engineInputRef","engineRefsRef","mapTypeRef","mapDataRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","lavaRain","radioactiveFog","meteorRain","weatherPropsRef","tileMapDataRef","registryItemsRef","projectilesLayerRef","projectileSpritesRef","entitiesLayerRef","entitySpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","driftSettingsRef","amplitude","overlayLayerRef","underwaterRef","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","bubbleFxRef","fishBubbleStateRef","entityWaterStateRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","inWater","gridRef","showGridRef","roomBlurEnabledRef","blurFilterRef","darkenFilterRef","ColorMatrixFilter","roomBrightnessFilterRef","vignetteRef","floatingLayerRef","debugLayerRef","debugEnabledRef","floatingManagerRef","breakFxLayerRef","breakFxManagerRef","fetch","json","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","createSolidChecker","collision","top","bottom","left","right","rebuildParallax","useCallback","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","screen","destroyed","async","app","Application","resizeTo","backgroundAlpha","antialias","autoDensity","stage","eventMode","hitArea","renderer","bg","bgAnim","roomObjBehind","roomObjFront","secretBelowLayer","secretAboveLayer","playerLayer","entitiesLayer","weatherLayer","liquidBgLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","vignetteLayer","overlayLayer","floatingLayer","breakFxLayer","LAYERS","cfg","floatConfig","defaultCfg","critCfg","crit","ttlMs","amount","amountValue","critThreshold","threshold","isCrit","baseColor","finalColor","finalFontSize","finalTtl","riseSpeed","jitterY","finalText","prefix","suffix","label","String","fontFamily","strokeThickness","jitterXValue","jitterYValue","position","ttl","total","createFloatingTextManager","gridGraphics","trajectoryGraphics","debugGraphics","allLayersMap","objects","layerName","urlSet","addUrl","urls","playerComponents","innerHTML","appendChild","hbOverlay","oxyColors","oxyBar","lavaColors","lvBar","preventDefault","fx","triggerSplash","triggerBubbles","ticker","updatePlayerSprite","inLava","effectiveWidth","isHit","dir","direction","mag","scale","camX","camY","lastCam","rawX","rawY","smoothing","nextRawX","nextRawY","cameraRef","mouseData","events","pointer","global","worldMouse","toLocal","mouseWorldPos","pivot","__PLAYER_POS__","lastTime","driftY","graphics","sr","seaRescueRef","draggedBox","startX","startY","currentStartY","mousePos","input","cameraY","worldMouseX","worldMouseY","helpers","settings","physics","G","POWER","power","MAX_DRAG","maxDrag","STEPS","trajectorySteps","DT","sqrt","ratio","beginFill","mapWidthPx","mapHeightPx","drawCircle","endFill","drawSeaRescueTrajectory","updateSeaRescueVisuals","shipOffset","child","lastBubbleTime","intervalMs","deltaMS","systems","swNow","shNow","sNow","overlayL","headUnderWater","overlayCfg","liquidOverlay","showOverlay","maxTargetAlpha","pulseBase","fadeSpeed","lastLiquidType","fadeOutSpeed","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","hbO","show","nextBarY","maxOxy","maxOxygen","curOxy","maxLv","maxLavaResist","curLv","lavaResist","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","anim","mainVisual","floating","splitContainer","topPart","bottomPart","topMask","bottomMask","pWidth","pHeight","maskW","maskH","isNaN","mx","my","syncEntities","entitySpritesMap","entitiesList","_lastFrameIndex","isTextureReady","currentSpriteIndex","texWidth","texHeight","effectiveColumns","targetWidth","targetHeight","flipY","absScaleX","absScaleY","ents","regs","liq","isFish","ai","fish","isAlive","isDormant","interval","bubbleIntervalMs","jitter","bubbleJitter","appToDestroy","cleanupProjectiles","cleanupEntities","handler","isInsideRoom","targetBlur","roomBrightness","reset","desaturate","brightness","grad","createRadialGradient","_vignetteSprite","tileCount","tileId","isLiquid","isRadio","radioactive","hasCollision","active","rebuildLayers","safeDestroy","removeChildren","roomAreaIndex","ox","oy","roomSecrets","roomOptions","selectedBackgroundColor","pLayer","tileDataString","JSON","stringify","prevTileDataString","_lastTileData","prepare","upload","runRebuild","tmd","entry","toSurfaceType","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","getFogIntensity","getLavaRainIntensity","getRadioactiveFogIntensity","getMeteorRainIntensity","propTypes","PropTypes","isRequired","resolveInteractableContext","objectLayerData","mainObjectMetadata","activeRoomIdsProp","centerY","hasMainMetadata","activeTargetMap","activeObjectData","activeMetadata","activeMapWidth","activeMapHeight","currentMapId","mainMetadata","findSpawnPosition","triggerId","mapW","objLayer","objData","spawnIdx","triggerRequested","findIndex","handleDoorInteraction","objDef","currentMeta","actualIndex","onStateUpdate","playShotSfx","lastETime","sound","sfxVolume","opening","delayS","delaySeconds","targetMapId","setTimeout","targetMap","isRoom","isExitingRoom","newX","newY","exitTriggerId","spawnTriggerId","roomAreaMeta","roomAreaEntry","raIdx","spawn","spawnFound","fallback","findExitDoorSpawn","targetRoomId","roomMeta","resolveMapObjects","matchIds","candidateIdx","matchedIdx","some","doorIdx","handleTeleportInteraction","vol","destId","destMeta","tx","ty","applyInteractableEffects","MAX_HEALTH","effect","interactableKey","usedInteractables","healthBonus","fireball","ammoBonus","ammo","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","revealedSet","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","MESSAGES","enMessages","lvMessages","noMessages","ruMessages","jaMessages","getLang","lang","raw","getTutorialChapters","getTutorialItems","chapter","chapterData","getTutorialText","handleWeatherTrigger","weatherType","weatherAction","value","lastWeatherTrigger","handleMessageTrigger","requiresActionKey","requiresKey","i18nChapter","i18nId","message","lastMessageTrigger","duration","triggerWolfSecret","playerCenterX","playerCenterY","objCenterX","objCenterY","playerGridX","playerGridY","objGridX","objGridY","moveX","moveY","eps","applyWolfSecretShift","getObjectId","getObjectDef","moveTile","moveObject","moveMetadata","removeObject","stepDelayMs","setTimeoutFn","shouldCancel","currentIdx","remainingDx","remainingDy","originId","moveStep","currentId","stepX","stepY","targetObjId","extraX","extraY","shouldRemoveCrackBlock","newHealth","passableHealthThreshold","checkInteractables","localX","localY","gridX","gridY","upIndex","upObjId","upDef","downIndex","downObjId","downDef","frontX","frontIndex","frontObjId","frontDef","foundIndex","fromMap","fromMeta","isWinning","winCounter","winCountSpeed","normalizeColor","scaleFromRange","readNumber","getMeteorBreakEffectConfig","meteorBreakEffectsConfig","defaults","sizeScale","minSize","maxSize","denom","particleSize","ground","colorsRaw","getBiologicalBreakEffectConfig","biologicalBreakEffectsConfig","beepFallback","muffled","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","lastNode","createBiquadFilter","frequency","setValueAtTime","connect","exponentialRampToValueAtTime","destination","stop","moveHorizontal","MOVE_SPEED","checkCollision","friction","acceleration","timeScale","targetVx","sign","proposedX","step","safeX","moveDist","nextX","applyVerticalPhysics","isGrounded","animation","GRAVITY","TERMINAL_VELOCITY","JUMP_FORCE","isLiquidAt","prevInWater","liqBuoyancy","liqDragY","liqTerminal","swimImpulseMult","activeLiquidType","feetLiq","chestLiq","space","swimImpulse","proposedY","isSolidAtPixel","secretData","objectData","ignoreEntityId","insideAnyRoom","localWx","localWy","roomTileW","roomTileH","roomObjects","closed","isExploding","isEntity","tileDef","getSurfaceProperties","feetY","slipperiness","getWeatherConfig","weatherDamageConfig","getMapWeather","metaWeather","runtime","rt","__GAME_RUNTIME_SETTINGS__","merged","getWeatherDps","clampIntensity","maxDps","minDps","weatherAffectsPlayer","affects","weatherAffectsEnemy","enemyId","enemyName","enemies","mode","excluded","exclude","isExcluded","weatherBlockedByCover","blockedByCover","isCoveredFromAbove","isInsideActiveRoom","getTileLayerData","getSecretLayerData","liquidTypeToHabitat","isFishEntity","getFishTriggerAt","objectId","triggerType","getWaterSurfaceY","updateEntities","entitiesRef","getLiquidSample","spawnProjectile","playSfx","constants","playerX","playerY","weatherNow","lavaRainInt","radioFogInt","isSeaRescue","entity","animFrame","animTimer","totalFrames","animations","explode","frameDuration","shouldRemove","liquidSample","projectilesRef","activeRadiusPx","activeRadius","attachedToProjectileId","fishState","isAttached","anims","currentAnim","isJumping","jumpVx","jumpVy","jumpGravity","dxView","dyView","idleAnim","idle","liquidDamageAcc","dmg","lavaDps","radioDps","totalWeatherDps","weatherDamageAcc","habitat","timeMs","habitatKey","isAllowed","requireLiquid","inWaterNow","fs","initialized","nextTurnAt","turnMinMs","turnMaxMs","nextVerticalAt","verticalDir","water_out","water_in","fishCount","removeOnNext","solidAtSample","canFloat","surfaceY","surfaceOffset","deathSurfaceOffset","floatSpeed","deathFloatSpeed","deadAnim","dead","meteorShockFrame","panicRadiusPx","panicRadius","panicSpeed","baseSpeed","swimSpeed","verticalDrift","isWaterfall","waterfallDriftMultiplier","waterfallSpeedMultiplier","triggerDef","mergedJumpCfg","fishTrigger","jump","nowMs","nextJumpAt","chance","jumpDir","speedX","speedY","jumpBounce","bounce","cooldownMs","dtSec","nextY","landingSample","shockUntil","shockFrame","lastWaterEnter","playerWaveRadius","waveImpulse","playerWaveImpulse","waveUntil","panicUntil","panicDurationMs","shipDef","fishReactionRadius","shipX","shipW","shipBottomY","enginePanicRadius","isPanicking","downSpeed","waterfallDownSpeed","waterfallAlpha","impulse","sampleNext","nextType","other","ocx","ocy","nudge","tryX","tryY","animKey","panic","swim","frameDur","prevInLiquid","water_splash","lava_splash","ew","eh","sinkingSpeed","fallDistance","vp","kill_enemy","isRound","checkEmpty","leftX","rightX","roll","lastAt","lastRollSfxAt","mapH","arrowId","foundArrowDef","arrowsLayer","aDef","reactionDist","reactionDistance","shootDist","shootDistance","canJump","shootCooldown","isShooting","patrol","hitSomething","stayOnPlatform","groundX","groundY","frameSpeed","checkEntityCollision","explodeAnim","updateFrame","isInitialized","lastTimeRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","weatherDamageAccRef","activeRoomIdsRef","collectItem","checkHazardDamage","checkSecrets","updateProjectiles","setPlayer","onGameOver","continue","iceResist","maxIceResist","physicsDt","projectileIdRef","objMetaRef","isMouseDown","mouseLeft","triggeredSeagulls","soundState","isMoving","engineSoundTimer","shipY","shipH","ArrowLeft","ArrowRight","ss","hornSound","horn","audio","stopTime","pause","once","engineSound","engine","shipGridXStart","shipGridXEnd","shipGridYStart","shipGridYEnd","seagullDef","rIdx","rId","proj","ownerId","useSimplePhysics","updateSeaRescue","shipAccel","shipFriction","maxShipSpeed","backgroundLayer","secretLayer","isSlippery","currentIceRes","maxIce","effectiveFriction","targetFriction","checkCollisionExtended","isPushing","pushTarget","currentStrength","isAlreadyAtMax","lastPushTime","pushDist","overlapDist","isNextToLeft","isNextToRight","pushForce","lastPushSoundTime","ladderInfo","findLadderAtPlayer","ctxResolved","baseIdx","ladder","remaining","steps","prevInWaterFrame","ladderSpeed","climbDir","stepMs","liquidParams","sample","resourceParams","parseNumber","maxLava","oxy","lavaRes","oxyParams","lavaParams","iceParams","strengthParams","oxygenApplies","oxygenEnabled","oxyDrain","oxyRegen","lavaApplies","lavaEnabled","lavaDrain","lavaRegen","applyResource","maxKey","drain","regen","maxVal","fogActive","maxRadio","maxRadioactivity","radio","radioactivity","radioParams","radioEnabled","radioBaseline","baselinePercent","radioGain","gainPerSecond","radioDecay","decayPerSecond","radioRecover","recoverPerSecond","baseline","rates","getRadioactivityRates","inc","radioactivityPerSecond","dec","radioactivityRegenPerSecond","increase","tickDepleteDps","dpsValue","damage","healthDpsOverride","effectiveDps","currentAmmo","knockbackDir","maxX","playerDef","onIce","floatState","floatingText","acc","res","diff","amt","MAX_OXYGEN","MAX_LAVA_RESIST","MAX_RADIOACTIVITY","errorHandler","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","Error","logData","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","useGameEngine","onRevealSecret","useInput","clearKeys","handleKeyDown","tagName","typing","isContentEditable","code","repeat","handleMouseDown","handleMouseUp","handleKeyUp","handleMouseMove","clientX","clientY","onToggleTerminal","passive","maxStrength","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","soundEnabledRef","audioCtxUnlockedRef","onStateUpdateRef","onRevealSecretRef","onGameOverRef","objectMetadataRef","revealedSecretsRef","mapWidthRef","mapHeightRef","tileDataRef","objectDataRef","secretDataRef","onToggle","onUserGesture","volume","Audio","checkHazardDamageWrapper","candidates","pushCandidate","touch","damageDirections","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","overlapTop","overlapBottom","overlapLeft","overlapRight","sideScore","chosen","prevIndex","damageOnce","baseDamage","immediate","TICK_MS","component","function","playerPosition","damageType","localRevealedRef","handleWeatherEffectHitWrapper","handleWeatherEffectHit","onBreakEffect","edist","prevHealth","inDamageRadius","shockRadius","meteorShockRadius","meteorShockDurationMs","lastFx","lastBioFxAt","bioConfig","breakConfig","onHit","lastMapIdRef","projectName","date_map_last_updated","date_map_created_at","isNewMapLoad","initialEntities","activeMapType","playerId","registryPlayer","prevAmmo","prevFishCount","pW","pH","maxXAtStart","checkCollisionExternal","TILE_SIZE_OVERRIDE","tileDataOverride","registryItemsOverride","secretDataOverride","objectDataOverride","objectMetadataOverride","ignoreId","isSolidAtPixelExternal","sampleLiquid","aabb","originX","originY","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","cwt","collisionWithTiles","hbs","hitboxScale","ric","spawnProjectileExternal","getLiquidTypeAtPixel","objectLayer","collectedItems","rWidth","rgX","rIndex","itemKey","rObjectData","rItemId","rItemDef","pickup","pickedUp","mapKey","itemId","itemDef","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","checkObjectHit","sgx","sgy","sindex","sobjId","checkEntityHit","checkPlayerHit","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","stepTime","removed","maxHeight","maxFlightHeight","floatTime","floatMax","floatingDurationMs","driftSettings","driftSpeed","driftAmp","aiType","inSound","objIdx","hitEntX","hitCooldown","canPlaySound","lastHitAt","fishJumpImpulse","hitIdxX","hypot","hitEntY","hitIdxY","requestAnimationFrame","cancelAnimationFrame","AnimatedItem","setIndex","setInterval","clearInterval","imgSrc","fallbackFrame","maxWidth","draggable","HeaderContainer","AmmoDisplay","FishDisplay","SeaRescueDisplay","AmmoIcon","span","RightSection","BarsContainer","BarRow","BarWrapper","BarFill","attrs","$percent","$color","BarLabel","GameHeader","hpPercent","oxyPercent","lavaPercent","icePercent","strengthPercent","radioPercent","fireballFrames","fireballA","fireballB","fireballC","fireballD","imageRendering","fishSprite","marginLeft","commands","register","cmd","listCommands","description","executeCommand","panelStyleBase","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","focus","onKey","scrollTop","scrollHeight","transform","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setLavaRain","setRadioactiveFog","setMeteorRain","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setDebugOverlayEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","setRoomBlurEnabled","showCoordinates","setShowCoordinates","minimized","setMinimized","pos","setPos","parse","setSize","draggingRef","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onSettingsUpdate","patch","onOpen","onMove","onUp","onResize","emitUpdate","panelStyle","userSelect","contentStyle","buttonStyle","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","defaultValue","_Fragment","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","getBreakEffectParams","breakEffectsConfig","ids","objectIds","types","objectTypes","matchesValue","shouldTriggerBreakEffect","hp","BackgroundMusicPlayer","audioRef","currentSrcRef","sourceNodeRef","filterNodeRef","gainNodeRef","musicContext","cleanup","close","resolveUrl","loop","createMediaElementSource","setupWebAudio","setTargetAtTime","onGesture","val","Overlay","$isVisible","MessageOverlay","isVisible","defaultProps","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapDescription","MapInfo","WinCounterOverlay","GameOverOverlay","GameOverTitle","h1","ReplayButton","ModalDivider","FileUploadLabel","HiddenFileInput","Viewport","$blurred","GameCanvas","PlaceholderMessage","Game","dispatch","useDispatch","viewportRef","useSelector","uiState","effectiveMapType","version","runtimeSettings","setRuntimeSettings","gameMessage","setGameMessage","messageTimerRef","clearTimeout","activeMapIdRef","isGameOverRef","handleStateUpdate","projectMapsResolved","spawnObjId","spawnDef","projectToLoad","loadMapData","metaPatch","breakFxPlayed","mapIdAtStart","ps","alert","settingKey","charAt","handleGameOver","indices","handleOpenModalEvent","weatherFogLegacy","sourceMapData","structuredClone","cloneMapData","effectiveMapData","activeLayers","bgLayer","mapTileData","mapSecretData","backgroundMusic","nowIso","mapName","dimensions","debugMapId","handleReplay","mapToLoad","isV2","author","sizeInfo","subMapInfo","mainMap","mapValues","accept","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","contents","suggestedName","mimeType","showSaveFilePicker","writable","createWritable","blob","Blob","write","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","applyMapData","setMapWidth","setMapHeight","setMapName","setCreatorName","setMapDescription","setCreatedAt","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","setSelectedBackgroundMusic","setPlayerPosition","setTileMapData","setObjectMapData","setSecretMapData","setObjectMetadata","setWeatherRain","setWeatherSnow","setWeatherClouds","setWeatherFog","setWeatherThunder","setWeatherLavaRain","setWeatherRadioactiveFog","setWeatherMeteorRain","setMaps","setActiveMapId","selectedBackgroundImage","selectedBackgroundMusic","worldY","date_created","ObjectLinks","React","links","portals","targets","x1","y1","x2","y2","strokeWidth","strokeDasharray","opacity","EditorTile","activeTool","tileObj","objObj","secretObj","isHighlighted","parentRegionIndex","borderStyle","bgStyle","handleGridMouseDown","handleGridMouseEnter","handleResizeStart","handleMoveStart","isRoomAreaVisible","showRoomMapContent","showMessages","isLiquidTile","isWaterTile","isLavaTile","isQuicksandTile","isWaterfallTile","isLavaWaterfallTile","isRadioactiveWaterTile","isRadioactiveWaterfallTile","messageText","i18nText","resolvedMessageText","isResizable","hasObjectOrSecret","onMouseEnter","boxSizing","objectFit","filterColorInEditor","isTree","editor","group","renderAboveOverride","treeLayerLabel","baseTop","baseLeft","baseWidth","baseHeight","inset","i18nMessage","hasIntensity","borderLeft","borderRight","textShadow","roomName","selectedBackgroundUrl","showBackgroundImage","activeLayer","hoverIndex","highlightedIndex","brushSize","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseUp","handleGridMouseLeave","setIsDragging","selectedTile","isEraserActive","isBrushActive","isBucketActive","cursorIndex","setCursorIndex","regions","roomAreas","getLayerColor","getLayerFilter","getPlacementAnchor","tile","handleGridMouseMove","getBoundingClientRect","currentTarget","nextIndex","onMouseUp","onMouseMove","onContextMenu","onMouseLeave","backgroundRepeat","backgroundSize","getGridStyles","previewIndex","previewX","previewY","previewW","previewH","gridTemplateColumns","gridTemplateRows","_","dTileId","dObjId","dSecId","layerColor","hx","hy","minX","selX","selY","originalX","originalY","parentRegion","EditorToolsContainer","HeaderBar","ToolsSection","ToolsGroup","ToolsInnerGroup","ToolsRow","ToolsEditorButton","$variant","$small","$square","$disabled","StrikeThrough","LayerIndicator","$bgColor","$borderColor","$textColor","BgColorContainer","BgColorInputWrapper","BgColorInput","disabled","BgTransparentButton","PlayButtonContainer","PlayButtonInner","InfoContainer","InfoItem","InfoLabel","InfoValue","EraserButtonContainer","EraserButtonInner","SelectionActions","ConfirmButton","CancelButton","GridIcon","SidebarContainer","ElementEditorButton","PanelContainer","$isOpen","PanelHeader","PanelBody","CloseButton","OperationButton","$danger","OperationLabel","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","tempMapDescription","setTempMapDescription","confirmNewMap","ModalHeader","BuiltInMapsModal","onSelect","topZIndex","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","setZIndex","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","lastHeightRef","offsetHeight","EditorMapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","inputSize","setInputSize","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","parseSize","parsed","applyInputResize","widthValue","heightValue","handleInputKeyDown","paddingBottom","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","obj","strokeStyle","lineWidth","portal","setLineDash","WorldView","switchMap","currentMapData","createMap","deleteMap","updateMapData","onAddRoomArea","mapLayoutsRef","dragRef","allMaps","draw","layouts","currentIds","layout","strokeRect","font","fillText","rAreaW","rAreaH","rTileW","rTileH","ri","sourceLayout","sourceMap","sx","isPortalSource","isDoorSource","linkId","targetLayout","tw","th","tTileW","tTileH","tObjId","tObjDef","isTarget","isDoorTarget","tMeta","endX","cp1X","cp1Y","cp2X","cp2Y","bezierCurveTo","save","translate","rotate","closePath","restore","btnX","btnY","confirm","mapStartX","mapStartY","BackgroundPanel","backgroundOptions","paddingTop","MusicPanel","musicOptions","fontStyle","status","WeatherPanel","weatherItems","setter","icon","SceneEditorButton","RightSidebarContainer","EditorScene","handleMapResize","isResizeWindowOpen","setIsResizeWindowOpen","isWorldViewOpen","setIsWorldViewOpen","isMinimapOpen","setIsMinimapOpen","setIsSettingsOpen","isBackgroundOpen","setIsBackgroundOpen","isMusicOpen","setIsMusicOpen","OperationsPanel","openNewMapModal","saveMap","loadMap","openBuiltInModal","clearMap","creatorName","mapDescription","inputStyle","handleFocus","handleBlur","onFocus","onBlur","CollapsiblePanel","setIsOpen","PalettePanel","isPlayMode","category","blocks","decorations","interactables","hazards","secrets","miniGames","messages","crackableWalls","pushableWalls","obstacles","setHighlightedIndex","handlePaletteSelect","selectedChapter","setSelectedChapter","selectedMiniGame","setSelectedMiniGame","tutorialChapters","tutorialItems","miniGameGroups","groupOrder","order","miniGameItems","ao","bo","displayName","localeCompare","getLiquidLabel","isLavaWaterfall","isRadioactiveWaterfall","isRadioactive","isWater","isQuicksand","renderPaletteItem","hasImage","isSecret","swatchStyle","iconText","getBlockGroup","withGroups","sortBlocks","groupPanels","flexWrap","otherItems","getLiquidGroup","li","sortLiquids","getDecorationGroup","sortDecorations","getEntityGroup","sortEntities","groupItems","getItemGroup","sortItems","getInteractableGroup","sortInteractables","getHazardGroup","sortHazards","ch","textTransform","getMiniGameLayer","o","StatisticsPanel","totalTiles","filledBlocks","objectsCount","emptyBlocks","registryMap","itemsCount","entitiesCount","mapList","mapsTotal","mapsOverworld","mapsUnderworld","mapsRooms","Trans","i18nKey","components","ObjectPropsPanel","listRef","highlightedElement","querySelector","scrollIntoView","behavior","block","isWeather","isMessage","isPortalOrTarget","isDoor","isRoomArea","i18nPreview","el","scrollX","clientWidth","scrollY","clientHeight","scrollTo","nextAbove","EditorElements","activePanel","setActivePanel","togglePanel","lastPanel","setLastPanel","pinnedPanel","setPinnedPanel","hoverTimerRef","displayPanel","clearHoverTimer","handleIconClick","panel","handleIconMouseEnter","handleIconMouseLeave","panelTitles","minigames","stats","handlePanelMouseEnter","handlePanelMouseLeave","EditorTools","setShowGrid","handlePlay","handlePause","handleReset","setActiveTool","setBrushSize","moveSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","setShowBackgroundImage","setShowMessages","setIsRoomAreaVisible","setShowRoomMapContent","tool","isDisabled","roman","getLayerIndicatorData","object","secret","textColor","getEraserData","useEditorOperations","createdAt","setIsNewMapModalOpen","handleSaveMap","currentDate","projectData","date_last_updated","statistics","total_tiles","filled_tiles","total_objects","saveFile","mapsCount","handleLoadMap","setters","handleLoadBuiltInMap","loadBuiltInMap","handleClearMap","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","isPropsLayer","targetLayer","setTargetData","newData","newMetadata","metadataChanged","targetX","useEditorPainting","setSelection","setPreviewPosition","setOriginalMapData","setDragStart","setHoverIndex","setBucketPreviewIndices","resizeState","setResizeState","moveState","setMoveState","bucketTimerRef","rightEraseRef","getLinkedRoomAt","roomX","roomY","roomWidth","roomHeight","overrideSelectedTile","effectiveTile","linkedRoom","rHeight","setRoomData","setRoomMetadata","newMeta","paintTileUtil","edge","useLinked","mWidth","mHeight","mIndex","mTileMapData","mObjectMapData","mSecretMapData","mObjectMetadata","mSetTileMapData","mSetObjectMapData","mSetSecretMapData","mSetObjectMetadata","existingObjId","existingSecretId","isEraser","isRoomMap","isRightErase","targetData","targetValue","newValue","floodFill","affectedIndices","metaChanged","curX","curY","newW","newH","newIndex","shouldErase","mData","baseIndex","selectionMetadata","tileMap","objectMap","secretMap","Editor","setSelectedTile","setActiveLayer","stateRef","isNewMapModalOpen","isBuiltInMapsModalOpen","setIsBuiltInMapsModalOpen","loadBackgroundOptions","loadMusicOptions","createNewMap","useEditorMaps","existingMaps","newMap","newMaps","lastActiveMapIdRef","newMapId","nextMap","handleCreateMap","finalName","prompt","timeout","selectedBgOption","useEditorRegistry","originalMapData","useEditorSelection","newTileMap","newObjectMap","newSecretMap","newObjectMetadata","destX","destY","destIdx","srcDataIdx","handleForceStop","playModeObjectData","playModeSecretData","playModeWeather","playModeMaps","gameEngineState","useEditorPlayMode","setIsPlayMode","setIsGameOver","restartCounter","setRestartCounter","editorSnapshot","setEditorSnapshot","setRevealedSecrets","setActiveRoomIds","setPlayModeObjectData","setPlayModeSecretData","setPlayModeWeather","playModeMapsVersion","setPlayModeMapsVersion","lastSyncedMapIdRef","isPlayModeRef","playModeMapsRef","engineInitId","currentPlayObjectData","playData","spawnIndex","spawnX","currentPlaySecretData","overrides","mapDataForGame","saved","newState","mapObj","prevTiles","newTiles","nextMeta","prevObjs","newObjs","prevMeta","handleRevealSecret","secretIndices","resetData","handleLoadMapWrapped","handleLoadBuiltInMapWrapped","toMove","handleDeleteMap","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","oldMeta","resizeArray","oldArr","newArr","oldY","oldM","newM","oldIdx","newIdx","resizeMetadata","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App","webpackContext","req","webpackContextResolve","__webpack_require__","resolve","module","exports"],"ignoreList":[],"sourceRoot":""}