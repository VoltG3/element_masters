{"version":3,"file":"static/js/main.2a78ba2b.js","mappings":"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","sources":["webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.(ogg%7Cmp3%7Cwav%7Cm4a)$i","webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/config.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/weather/LavaRain.js","webpack://element_masters/./src/Pixi/effects/weather/RadioactiveFog.js","webpack://element_masters/./src/Pixi/effects/weather/MeteorRain.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/BubbleFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/floatingTextManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/breakEffectManager.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/entityManager.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables/context.js","webpack://element_masters/./src/engine/gameplay/interactables/spawn.js","webpack://element_masters/./src/engine/gameplay/interactables/doors.js","webpack://element_masters/./src/engine/gameplay/interactables/teleport.js","webpack://element_masters/./src/engine/gameplay/interactables/effects.js","webpack://element_masters/./src/engine/gameplay/secrets/reveal.js","webpack://element_masters/./src/i18n/tutorialMessages.js","webpack://element_masters/./src/engine/gameplay/secrets/triggers.js","webpack://element_masters/./src/engine/gameplay/secrets/wolfSecret.js","webpack://element_masters/./src/engine/gameplay/secrets/crackBlock.js","webpack://element_masters/./src/engine/gameplay/interactables/checkInteractables.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/gameplay/meteorBreakEffects.js","webpack://element_masters/./src/engine/gameplay/biologicalBreakEffects.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/engine/gameplay/weatherDamage.js","webpack://element_masters/./src/engine/gameplay/weatherCover.js","webpack://element_masters/./src/engine/gameplay/entities.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/weatherEffects.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/engine/gameplay/breakEffects.js","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/sections/chapters/shared/MessageOverlay.jsx","webpack://element_masters/./src/constants/builtInMaps.js","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/mapOperations.js","webpack://element_masters/./src/sections/chapters/editor/viewport/ObjectLinks.jsx","webpack://element_masters/./src/sections/chapters/editor/viewport/EditorTile.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorToolsButton.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorElementsButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorTools/BuiltInMapsModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/EditorMapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WorldView.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/BackgroundPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/MusicPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WeatherPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorSceneButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/EditorScene.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/OperationsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/CollapsiblePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/PalettePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/StatisticsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/ObjectPropsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorElements.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorTools.jsx","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPlayMode.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorOperations.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/paintingTools.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPainting.js","webpack://element_masters/./src/sections/chapters/editor/Editor.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorMaps.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorRegistry.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorSelection.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js"],"sourcesContent":["var map = {\n\t\"./blocks/block_pack_01/block_pack_01.png\": 8473,\n\t\"./blocks/block_pack_01/ice_block_0001.png\": 9745,\n\t\"./blocks/brick_block_0001.png\": 3611,\n\t\"./blocks/desert_pack_01/desert_pack_0001.png\": 7741,\n\t\"./blocks/desert_pack_01/desert_pack_0002.png\": 182,\n\t\"./blocks/desert_pack_01/desert_pack_0003.png\": 1727,\n\t\"./blocks/desert_pack_01/desert_pack_0004.png\": 6352,\n\t\"./blocks/desert_pack_01/desert_pack_0005.png\": 2601,\n\t\"./blocks/desert_pack_01/desert_pack_0006.png\": 6018,\n\t\"./blocks/desert_pack_01/desert_pack_0007.png\": 6523,\n\t\"./blocks/desert_pack_01/desert_pack_0008.png\": 5132,\n\t\"./blocks/desert_pack_01/desert_pack_0009.png\": 1045,\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 9538,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./decorations/stone_pack_01/stone_pack_01_001.png\": 1978,\n\t\"./decorations/stone_pack_01/stone_pack_01_002.png\": 4526,\n\t\"./decorations/stone_pack_01/stone_pack_01_003.png\": 7928,\n\t\"./decorations/stone_pack_01/stone_pack_01_004.png\": 9447,\n\t\"./decorations/stone_pack_01/stone_pack_01_005.png\": 1134,\n\t\"./decorations/stone_pack_01/stone_pack_01_006.png\": 8485,\n\t\"./decorations/stone_pack_01/stone_pack_01_007.png\": 3036,\n\t\"./decorations/stone_pack_01/stone_pack_01_008.png\": 7195,\n\t\"./decorations/stone_pack_01/stone_pack_01_009.png\": 9330,\n\t\"./decorations/stone_pack_01/stone_pack_01_010.png\": 2952,\n\t\"./entities/animals/fish_01.png\": 6781,\n\t\"./entities/animals/fish_catfish.png\": 5756,\n\t\"./entities/animals/fish_clownfish.png\": 2287,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 1286,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./entities/tanks/tank_0000.png\": 2386,\n\t\"./entities/tanks/tank_0001.png\": 3563,\n\t\"./entities/tanks/tank_0002.png\": 5232,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./hazards/death_block_0001.png\": 3527,\n\t\"./interactables/arrows/arrow_down.png\": 7152,\n\t\"./interactables/arrows/arrow_left.png\": 8047,\n\t\"./interactables/arrows/arrow_right.png\": 592,\n\t\"./interactables/arrows/arrow_up.png\": 7263,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./interactables/doors/door_0001.png\": 175,\n\t\"./interactables/ends/end_0001.png\": 8597,\n\t\"./interactables/ledders/ledder_steel_01.png\": 5227,\n\t\"./interactables/ledders/ledder_wooden_01.png\": 3368,\n\t\"./interactables/platforms/platform_0001.png\": 9427,\n\t\"./interactables/portals/portal_01/portal_A_001.png\": 8518,\n\t\"./interactables/portals/portal_01/portal_A_002.png\": 3933,\n\t\"./interactables/portals/portal_01/portal_A_003.png\": 692,\n\t\"./interactables/portals/portal_01/portal_A_004.png\": 5499,\n\t\"./interactables/portals/portal_01/portal_A_005.png\": 3954,\n\t\"./interactables/portals/portal_01/portal_A_006.png\": 8489,\n\t\"./interactables/portals/portal_01/portal_A_007.png\": 4288,\n\t\"./interactables/portals/portal_01/portal_A_008.png\": 8519,\n\t\"./interactables/portals/portal_01/portal_A_009.png\": 2734,\n\t\"./interactables/portals/portal_01/portal_A_010.png\": 3124,\n\t\"./interactables/portals/portal_01/portal_A_011.png\": 4253,\n\t\"./interactables/portals/portal_01/portal_A_012.png\": 6838,\n\t\"./interactables/portals/portal_01/portal_A_013.png\": 5583,\n\t\"./interactables/portals/portal_01/portal_A_014.png\": 9712,\n\t\"./interactables/portals/portal_01/portal_A_015.png\": 5465,\n\t\"./interactables/portals/portal_01/portal_A_016.png\": 1458,\n\t\"./interactables/stone_0001.png\": 1020,\n\t\"./interactables/wooden_box_0001.png\": 1169,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205,\n\t\"./secrets/crack_block.png\": 2789,\n\t\"./signs/sign01.png\": 9784\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","var map = {\n\t\"./City.png\": 3676,\n\t\"./Forest.png\": 6370,\n\t\"./UndergroundCave.png\": 2445,\n\t\"./lv8kgjusouta1.png\": 3789,\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719,\n\t\"./seamless_07.png\": 6390\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 2201;","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./sfx/dammage/hit-flesh-03-266308.ogg\": 7808,\n\t\"./sfx/stones/rolling-24b-100544.ogg\": 1835,\n\t\"./sfx/water/in_fish-splashing-release-1-96870.ogg\": 3700,\n\t\"./sfx/water/out_splash-4-46870.ogg\": 5923,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/brick_block_0001.json\": 544,\n\t\"./blocks/desert_block_0001.json\": 6918,\n\t\"./blocks/desert_block_0002.json\": 8359,\n\t\"./blocks/desert_block_0003.json\": 324,\n\t\"./blocks/desert_block_0004.json\": 2149,\n\t\"./blocks/desert_block_0005.json\": 5418,\n\t\"./blocks/desert_block_0006.json\": 5531,\n\t\"./blocks/desert_block_0007.json\": 4136,\n\t\"./blocks/desert_block_0008.json\": 329,\n\t\"./blocks/desert_block_0009.json\": 9518,\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/dirt_block_0002.json\": 5655,\n\t\"./blocks/dirt_block_0003.json\": 4932,\n\t\"./blocks/dirt_block_0004.json\": 5653,\n\t\"./blocks/dirt_block_0005.json\": 8970,\n\t\"./blocks/dirt_block_0006.json\": 2251,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/hazard/death_block_0001.json\": 698,\n\t\"./blocks/liquids/lava_block.json\": 9649,\n\t\"./blocks/liquids/lava_waterfall_block.json\": 9104,\n\t\"./blocks/liquids/quicksand_block.json\": 1924,\n\t\"./blocks/liquids/radioactive_water_block.json\": 1408,\n\t\"./blocks/liquids/radioactive_waterfall_block.json\": 8317,\n\t\"./blocks/liquids/water_block.json\": 8606,\n\t\"./blocks/liquids/waterfall_block.json\": 119,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./decorations/stone_pack_01_001.json\": 5247,\n\t\"./decorations/stone_pack_01_002.json\": 5134,\n\t\"./decorations/stone_pack_01_003.json\": 9593,\n\t\"./decorations/stone_pack_01_004.json\": 9840,\n\t\"./decorations/stone_pack_01_005.json\": 2867,\n\t\"./decorations/stone_pack_01_006.json\": 7618,\n\t\"./decorations/stone_pack_01_007.json\": 9069,\n\t\"./decorations/stone_pack_01_008.json\": 9588,\n\t\"./decorations/stone_pack_01_009.json\": 3975,\n\t\"./entities/animals/fish_01.json\": 2174,\n\t\"./entities/animals/fish_catfish.json\": 6865,\n\t\"./entities/animals/fish_clownfish.json\": 2204,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./entities/tank_0000.json\": 9381,\n\t\"./entities/tank_0001.json\": 8938,\n\t\"./entities/tank_0002.json\": 9179,\n\t\"./interactables/arrows/arrow_down.json\": 3741,\n\t\"./interactables/arrows/arrow_left.json\": 4636,\n\t\"./interactables/arrows/arrow_right.json\": 9821,\n\t\"./interactables/arrows/arrow_up.json\": 7852,\n\t\"./interactables/blocks/ice_block_0001.json\": 5742,\n\t\"./interactables/doors/door_0001.json\": 6332,\n\t\"./interactables/ends/end_0001.json\": 9318,\n\t\"./interactables/harvestables/berry_bush_01.json\": 7562,\n\t\"./interactables/harvestables/berry_bush_01_used.json\": 3614,\n\t\"./interactables/ledders/ledder_0001.json\": 8668,\n\t\"./interactables/ledders/ledder_0002.json\": 3097,\n\t\"./interactables/physics/stone_0001.json\": 9095,\n\t\"./interactables/physics/wooden_box_0001.json\": 1116,\n\t\"./interactables/platforms/platform_0001.json\": 2008,\n\t\"./interactables/portals/portal_001.json\": 2190,\n\t\"./interactables/portals/portal_target.json\": 5206,\n\t\"./items/ammunition/fireball_ammo.json\": 7289,\n\t\"./items/health/hertz_item.json\": 3321,\n\t\"./messages/message_i18n_0001.json\": 5217,\n\t\"./messages/sign_0001.json\": 7046,\n\t\"./obstacles/hazards/bushes_001.json\": 6447,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/crack_block.json\": 6854,\n\t\"./secrets/fish_trigger.json\": 2475,\n\t\"./secrets/message_trigger.json\": 3746,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/room_area.json\": 4547,\n\t\"./secrets/secret_area_a.json\": 1866,\n\t\"./secrets/secret_area_b.json\": 3227,\n\t\"./secrets/secret_area_c.json\": 3880,\n\t\"./secrets/wolf_secret_down.json\": 7716,\n\t\"./secrets/wolf_secret_left.json\": 7157,\n\t\"./secrets/wolf_secret_right.json\": 9950,\n\t\"./secrets/wolf_secret_up.json\": 8577,\n\t\"./system/biological_break_effects.json\": 2346,\n\t\"./system/floating_text.json\": 7794,\n\t\"./system/meteor_break_effects.json\": 6643,\n\t\"./system/object_break_effects.json\": 3764,\n\t\"./system/weather_damage.json\": 6234,\n\t\"./weather/weather_clouds_off.json\": 8264,\n\t\"./weather/weather_clouds_on.json\": 9138,\n\t\"./weather/weather_clouds_value.json\": 6592,\n\t\"./weather/weather_fog_off.json\": 4870,\n\t\"./weather/weather_fog_on.json\": 9560,\n\t\"./weather/weather_fog_value.json\": 1374,\n\t\"./weather/weather_lava_rain_off.json\": 4159,\n\t\"./weather/weather_lava_rain_on.json\": 7795,\n\t\"./weather/weather_meteor_rain_off.json\": 8421,\n\t\"./weather/weather_meteor_rain_on.json\": 2097,\n\t\"./weather/weather_radioactive_fog_off.json\": 8304,\n\t\"./weather/weather_radioactive_fog_on.json\": 6298,\n\t\"./weather/weather_rain_off.json\": 8312,\n\t\"./weather/weather_rain_on.json\": 914,\n\t\"./weather/weather_rain_value.json\": 7664,\n\t\"./weather/weather_snow_off.json\": 8445,\n\t\"./weather/weather_snow_on.json\": 969,\n\t\"./weather/weather_snow_value.json\": 5409,\n\t\"./weather/weather_thunder_off.json\": 628,\n\t\"./weather/weather_thunder_on.json\": 1006,\n\t\"./weather/weather_thunder_value.json\": 6756\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8815;","/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  objectMetadata: {}, // Track metadata per object position { index: { health: 100, etc } }\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  projectMaps: {}, // For Project v2.0 (multi-map)\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n  activeRoomIds: [], // IDs of currently active rooms (overlays)\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      const { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.objectMetadata = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {}; // Load initial metadata from map\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.activeRoomIds = []; // Reset active rooms on new map load\n      state.isGameOver = false;\n\n      // If this is a project (v2.0) with multiple maps\n      if (mapData?.maps) {\n        state.projectMaps = mapData.maps;\n      }\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    updateObjectMetadata: (state, action) => {\n      const { index, metadata, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        state.objectMetadata[index] = {\n          ...(state.objectMetadata[index] || {}),\n          ...metadata\n        };\n        if (state.projectMaps[targetId]) {\n          if (!state.projectMaps[targetId].objectMetadata) {\n            state.projectMaps[targetId].objectMetadata = {};\n          }\n          state.projectMaps[targetId].objectMetadata[index] = {\n            ...(state.projectMaps[targetId].objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          state.objectMetadata[index] = {\n            ...(state.objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n        if (!state.projectMaps[mapId].objectMetadata) {\n          state.projectMaps[mapId].objectMetadata = {};\n        }\n        state.projectMaps[mapId].objectMetadata[index] = {\n          ...(state.projectMaps[mapId].objectMetadata[index] || {}),\n          ...metadata\n        };\n      }\n    },\n    removeObjectAtIndex: (state, action) => {\n      const { index, mapId } = typeof action.payload === 'object' ? action.payload : { index: action.payload, mapId: null };\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = null;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = null;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = null;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          // Make sure we are working with a fresh array if we want to trigger changes reliably\n          room.objectMapData = [...room.objectMapData];\n        }\n        \n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = null;\n        }\n      }\n    },\n    removeTileAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.tileMapData[index] !== undefined) {\n        state.tileMapData[index] = null;\n      }\n    },\n    moveTileInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.tileMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.tileMapData[fromIndex] === undefined) return;\n      state.tileMapData[toIndex] = state.tileMapData[fromIndex];\n      state.tileMapData[fromIndex] = null;\n    },\n    moveObjectInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.objectMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.objectMapData[fromIndex] === undefined) return;\n      state.objectMapData[toIndex] = state.objectMapData[fromIndex];\n      state.objectMapData[fromIndex] = null;\n      \n      // Move metadata as well\n      if (state.objectMetadata[fromIndex]) {\n        state.objectMetadata[toIndex] = state.objectMetadata[fromIndex];\n        delete state.objectMetadata[fromIndex];\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = newId;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = newId;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = newId;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          room.objectMapData = [...room.objectMapData];\n        }\n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = newId;\n        }\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    toggleRoom: (state, action) => {\n      const roomId = action.payload;\n      if (state.activeRoomIds.includes(roomId)) {\n        state.activeRoomIds = state.activeRoomIds.filter(id => id !== roomId);\n      } else {\n        state.activeRoomIds.push(roomId);\n      }\n    },\n    clearRooms: (state) => {\n      state.activeRoomIds = [];\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  updateObjectMetadata,\n  removeObjectAtIndex,\n  removeTileAtIndex,\n  moveTileInMap,\n  moveObjectInMap,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  toggleRoom,\n  clearRooms,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\nimport lv_tutorial_messages from \"./translations/lv/tutorial_messages.json\"\nimport no_tutorial_messages from \"./translations/no/tutorial_messages.json\"\nimport en_tutorial_messages from \"./translations/en/tutorial_messages.json\"\nimport ru_tutorial_messages from \"./translations/ru/tutorial_messages.json\"\nimport ja_tutorial_messages from \"./translations/ja/tutorial_messages.json\"\nimport en_game_map_selector from \"./translations/en/game_map_selector.json\"\nimport en_editor_elements from \"./translations/en/editor_elements.json\"\nimport en_editor_scene from \"./translations/en/editor_scene.json\"\nimport en_editor_tools from \"./translations/en/editor_tools.json\"\nimport lv_game_map_selector from \"./translations/lv/game_map_selector.json\"\nimport no_game_map_selector from \"./translations/no/game_map_selector.json\"\nimport ru_game_map_selector from \"./translations/ru/game_map_selector.json\"\nimport ja_game_map_selector from \"./translations/ja/game_map_selector.json\"\nimport lv_editor_elements from \"./translations/lv/editor_elements.json\"\nimport no_editor_elements from \"./translations/no/editor_elements.json\"\nimport ru_editor_elements from \"./translations/ru/editor_elements.json\"\nimport ja_editor_elements from \"./translations/ja/editor_elements.json\"\nimport lv_editor_scene from \"./translations/lv/editor_scene.json\"\nimport no_editor_scene from \"./translations/no/editor_scene.json\"\nimport ru_editor_scene from \"./translations/ru/editor_scene.json\"\nimport ja_editor_scene from \"./translations/ja/editor_scene.json\"\nimport lv_editor_tools from \"./translations/lv/editor_tools.json\"\nimport no_editor_tools from \"./translations/no/editor_tools.json\"\nimport ru_editor_tools from \"./translations/ru/editor_tools.json\"\nimport ja_editor_tools from \"./translations/ja/editor_tools.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"en\",\n        fallbackLng: \"en\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\", \"tutorial\", \"game\", \"editor_elements\", \"editor_scene\", \"editor_tools\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation,\n                tutorial: lv_tutorial_messages,\n                game: lv_game_map_selector,\n                editor_elements: lv_editor_elements,\n                editor_scene: lv_editor_scene,\n                editor_tools: lv_editor_tools\n            },\n            no: {\n                navigation: no_navigation,\n                tutorial: no_tutorial_messages,\n                game: no_game_map_selector,\n                editor_elements: no_editor_elements,\n                editor_scene: no_editor_scene,\n                editor_tools: no_editor_tools\n            },\n            en: {\n                navigation: en_navigation,\n                tutorial: en_tutorial_messages,\n                game: en_game_map_selector,\n                editor_elements: en_editor_elements,\n                editor_scene: en_editor_scene,\n                editor_tools: en_editor_tools\n            },\n            ru: {\n                navigation: ru_navigation,\n                tutorial: ru_tutorial_messages,\n                game: ru_game_map_selector,\n                editor_elements: ru_editor_elements,\n                editor_scene: ru_editor_scene,\n                editor_tools: ru_editor_tools\n            },\n            ja: {\n                navigation: ja_navigation,\n                tutorial: ja_tutorial_messages,\n                game: ja_game_map_selector,\n                editor_elements: ja_editor_elements,\n                editor_scene: ja_editor_scene,\n                editor_tools: ja_editor_tools\n            },\n        },\n    })\n\nexport default i18n\n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n\n        </nav>\n    )\n}\n\n/*\n<NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n* */","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\nimport { useState, useRef, useEffect } from \"react\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    height: 36px;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nconst SettingsButton = styled(NavButton)`\n    ${props => props.$soundOff ? `\n        animation: soundOffPulse 2s ease-in-out infinite;\n        @keyframes soundOffPulse {\n            0% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n            50% { box-shadow: 0 0 12px rgba(86, 255, 138, 0.5); border-color: rgba(86, 255, 138, 0.9); color: #e8fff2; }\n            100% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n        }\n    ` : ''}\n`;\n\nconst DropdownContainer = styled.div`\n    position: relative;\n    display: flex;\n`\n\nconst DropdownMenu = styled.div`\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background-color: #333;\n    border: 1px solid #444;\n    border-radius: 4px;\n    padding: 10px;\n    z-index: 2000;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n    min-width: 150px;\n    margin-top: 5px;\n`\n\nconst MenuItem = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px;\n    color: white;\n    font-size: 12px;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &:hover {\n        background-color: #444;\n    }\n`\n\nconst ToggleSwitch = styled.div`\n    width: 34px;\n    height: 18px;\n    background-color: ${props => props.$active ? '#f4c542' : '#666'};\n    border-radius: 9px;\n    position: relative;\n    transition: background-color 0.3s;\n\n    &::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        left: ${props => props.$active ? '18px' : '2px'};\n        width: 14px;\n        height: 14px;\n        background-color: white;\n        border-radius: 50%;\n        transition: left 0.3s;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const dropdownRef = useRef(null);\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    const currentLang = i18n.language || 'en'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    const toggleSound = () => {\n        const next = !soundEnabled;\n        setSoundEnabled(next);\n        try { localStorage.setItem('game_sound_enabled', next ? '1' : '0'); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n    };\n\n    useEffect(() => {\n        const handleClickOutside = (event) => {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n                setIsMenuOpen(false);\n            }\n        };\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n\n            <DropdownContainer ref={dropdownRef}>\n                <SettingsButton\n                    onClick={() => setIsMenuOpen(!isMenuOpen)}\n                    title=\"Settings\"\n                    $soundOff={!soundEnabled}\n                >\n                    \n                </SettingsButton>\n                {isMenuOpen && (\n                    <DropdownMenu>\n                        <MenuItem onClick={toggleSound}>\n                            <span>Sound Effects</span>\n                            <ToggleSwitch $active={soundEnabled} />\n                        </MenuItem>\n                        <div style={{ height: '1px', backgroundColor: '#444', margin: '5px 0' }} />\n                        <div style={{ padding: '5px 8px', fontSize: '10px', color: '#888' }}>\n                            GAME SETTINGS\n                        </div>\n                    </DropdownMenu>\n                )}\n            </DropdownContainer>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    text-transform: uppercase;\n    margin: 0;\n    line-height: 1.1;\n\n    .tagline {\n        font-size: 0.7rem;\n        letter-spacing: 0.04em;\n        text-transform: lowercase;\n        opacity: 0.7;\n    }\n`\n\nexport function SectionHeaderNavigationLogo() {\n    const tag = (process.env.APP_GIT_TAG || '').trim();\n\n    return (\n        <StyledLogo>\n            <span>Element Masters</span>\n            {tag ? <span className=\"tagline\">{tag.toLowerCase()}</span> : null}\n        </StyledLogo>\n    )\n}\n","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\nlet _registryMap = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        const resolveSoundsMap = (sounds) => {\n            if (!sounds || typeof sounds !== 'object') return sounds;\n            const out = Array.isArray(sounds) ? [] : {};\n            for (const [k, v] of Object.entries(sounds)) {\n                if (typeof v === 'string') {\n                    out[k] = resolveSound(v);\n                } else if (v && typeof v === 'object') {\n                    out[k] = resolveSoundsMap(v);\n                } else {\n                    out[k] = v;\n                }\n            }\n            return out;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null),\n                sounds: resolveSoundsMap(item.sounds)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        _registryMap = new Map();\n        _registry.forEach(item => {\n            if (item && item.id) _registryMap.set(item.id, item);\n        });\n        _registry.__byId = _registryMap;\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    if (!_registry) return null;\n    if (_registryMap) return _registryMap.get(id) || null;\n    return _registry.find(item => item.id === id);\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n\n        </div>\n      )\n    }\n\nexport default App\n/*\n <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n* */","import Logo1 from './assets/logo/Logo1.png';\nimport Logo2 from './assets/logo/Logo2.png';\nimport Logo3 from './assets/logo/Logo3.png';\nimport Logo4 from './assets/logo/Logo4.png';\nimport Logo5 from './assets/logo/Logo5.png';\n\nconst config = {\n    apiUrl: (typeof process !== 'undefined' && process.env?.REACT_APP_API_URL) || 'http://localhost:8000',\n\n    logo: {\n        URL_LOGO_01: Logo1,\n        URL_LOGO_02: Logo2,\n        URL_LOGO_03: Logo3,\n        URL_LOGO_04: Logo4,\n        URL_LOGO_05: Logo5,\n    },\n\n};\n\nexport default config\n","import React from 'react'\nimport styled from 'styled-components'\nimport config from '../../config'\n\nconst HomeContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    //background-color: darkred;\n    \n    .logoRow{\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        width: 100%;\n        height: auto;\n        margin: 10px;\n        //border: solid 1px red;\n        \n        & img {\n            width: 350px;\n        }\n    }\n`\n\nexport default function Home() {\n    const LOGO_01 = config.logo.URL_LOGO_01\n    const LOGO_02 = config.logo.URL_LOGO_02\n    const LOGO_03 = config.logo.URL_LOGO_03\n    const LOGO_04 = config.logo.URL_LOGO_04\n    const LOGO_05 = config.logo.URL_LOGO_05\n    console.log(LOGO_01, LOGO_02, LOGO_03, LOGO_04, LOGO_05)\n\n    return (\n        <HomeContainer>\n           <div className={\"logoRow\"}>\n               <img src={LOGO_01} alt=\"logo\" />\n               <img src={LOGO_02} alt=\"logo\" />\n               <img src={LOGO_03} alt=\"logo\" />\n               <img src={LOGO_04} alt=\"logo\" />\n\n           </div>\n        </HomeContainer>\n    )\n}\n","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on viewport area to keep FPS stable\n    this.maxParticles = 400; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(160, Math.floor(area / 2300));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.rect(0, 0, 1.3, 9);\n    g.fill({ color: 0x4aa3ff, alpha: 0.92 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus a small margin for slanted fall\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 100 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    this.seeded = false;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = 300; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxFlakes = Math.max(120, Math.floor(area / 3000));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(options = null) {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.circle(0, 0, r);\n    g.fill({ color: 0xffffff, alpha: 0.97 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus margin\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      const minY = options && Number.isFinite(options.minY) ? options.minY : (viewport.y - 10);\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : (viewport.y - 40);\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    } else {\n      x = Math.random() * this.width;\n      const minY = options && Number.isFinite(options.minY) ? options.minY : -10;\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : -40;\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    }\n\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    if (target === 0) {\n      this.seeded = false;\n    }\n\n    const deficit = target - this.flakes.length;\n    if (!this.seeded && target > 0) {\n      const viewportH = viewport ? viewport.height : this.height;\n      const viewportY = viewport ? viewport.y : 0;\n      const seedCount = Math.min(target, Math.max(24, Math.floor(this.maxFlakes * 0.35)));\n      for (let i = 0; i < seedCount; i++) {\n        this.spawnOne({\n          minY: viewportY - viewportH * 0.35,\n          maxY: viewportY + viewportH * 0.9\n        });\n      }\n      this.seeded = true;\n    }\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40 || (viewport && f.y > viewport.y + viewport.height + 100)) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n    this.windDirection = 1; // 1: from left to right, -1: from right to left\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(isInitial = false) {\n    const g = new Graphics();\n    const w = 140 + Math.random() * 300; // cloud size\n    const h = 80 + Math.random() * 160;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : this.width;\n\n    let x;\n    if (isInitial) {\n      // Initial scatter across the whole viewport (or map if no viewport)\n      const range = Math.max(vW, this.width) + 800;\n      const startX = viewport ? vX - 400 : -400;\n      x = startX + Math.random() * range;\n    } else if (viewport) {\n      // Dynamic spawn: place in or near viewport so the user sees results quickly\n      // We scatter them in a wider area around viewport [x-400, x+width+400]\n      x = viewport.x - 400 + Math.random() * (viewport.width + 800);\n    } else {\n      // Fallback to edges\n      x = (Math.random() < 0.5 ? -180 : this.width + 180);\n    }\n    \n    const y = vY - 40 + Math.random() * (this.bandHeight - 20); // only in band\n    const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n    const speed = 8 + Math.random() * 22; // horizontal drift speed\n    const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n    // Draw an organic cloud using overlapping circles (soft edges)\n    const rx = w * 0.5;\n    const ry = h * 0.5;\n    const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n    const baseR = Math.min(rx, ry) * 0.55;\n    for (let k = 0; k < circles; k++) {\n      const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n      const dist = 0.2 + Math.random() * 0.35;\n      const cx = Math.cos(t) * rx * dist;\n      const cy = Math.sin(t) * ry * dist;\n      const r = baseR * (0.7 + Math.random() * 0.7);\n      g.circle(cx, cy, r);\n    }\n    // central mass\n    g.circle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n    g.fill({ color: 0xffffff, alpha: 1.0 });\n    g.alpha = 0; // Start invisible for fade-in\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.patches.push({ \n      g, w, h, \n      vx: speed * this.windDirection, \n      vy, \n      targetAlpha: alpha, \n      currentAlpha: 0,\n      phase: Math.random() * Math.PI * 2,\n      dying: false\n    });\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    // We don't change this.width/height here as they are map bounds,\n    // but we can update bandHeight if the screen height changed significantly.\n    this.bandHeight = Math.max(1, Math.floor(h * 0.3)); \n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vW = viewport ? viewport.width : 1280;\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    for (let i = 0; i < targetCount; i++) {\n      this.spawnOne(true);\n      // For initial ones, set alpha immediately\n      if (this.patches.length > 0) {\n        const p = this.patches[this.patches.length - 1];\n        p.currentAlpha = p.targetAlpha;\n        p.g.alpha = p.currentAlpha;\n      }\n    }\n  }\n\n  update(dtMs) {\n    // Live intensity update with smoothing\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : 1280;\n    const vH = viewport ? viewport.height : 720;\n\n    const bandTop = vY - 100;\n    const bandBottom = vY + this.bandHeight;\n\n    // Adjust cloud count gradually\n    // We scale target count based on viewport width (default 18 for 1280px)\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    const activePatches = this.patches.filter(p => {\n      if (p.dying) return false;\n      if (!viewport) return true;\n      // Only count patches that are within a reasonable distance of the viewport\n      return p.g.x > vX - 1000 && p.g.x < vX + vW + 1000;\n    });\n    \n    if (activePatches.length < targetCount) {\n      // Spawn one cloud per ~300ms if needed, to avoid sudden pops\n      this._spawnTimer = (this._spawnTimer || 0) + dtMs;\n      if (this._spawnTimer > 300 || activePatches.length === 0) {\n        this.spawnOne(activePatches.length === 0);\n        this._spawnTimer = 0;\n      }\n    } else if (activePatches.length > targetCount) {\n      // Mark one for death\n      const toKill = activePatches[0];\n      if (toKill) toKill.dying = true;\n    }\n\n    const toRemove = [];\n    for (let i = 0; i < this.patches.length; i++) {\n      const p = this.patches[i];\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // Alpha handling\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      \n      // Cleanup if too far from viewport (e.g. teleport)\n      if (viewport && !p.dying && (p.g.x < vX - 2500 || p.g.x > vX + vW + 2500)) {\n        p.dying = true;\n      }\n\n      if (p.dying) {\n        p.currentAlpha -= dt * 0.1; // Fade out slowly\n        if (p.currentAlpha <= 0) {\n          toRemove.push(i);\n          continue;\n        }\n      } else if (p.currentAlpha < p.targetAlpha) {\n        p.currentAlpha += dt * 0.05; // Fade in slowly\n        if (p.currentAlpha > p.targetAlpha) p.currentAlpha = p.targetAlpha;\n      }\n\n      p.g.alpha = Math.max(0, Math.min(0.55, p.currentAlpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      const margin = 800; // Increased margin to ensure they don't pop out visibly\n      if (viewport) {\n          const leftBound = vX - margin;\n          const rightBound = vX + vW + margin;\n          if (p.g.x < leftBound) p.g.x = rightBound;\n          if (p.g.x > rightBound) p.g.x = leftBound;\n      } else {\n          if (p.g.x < -margin) p.g.x = W + margin;\n          if (p.g.x > W + margin) p.g.x = -margin;\n      }\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n\n    // Remove dead patches\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.patches[idx];\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n      this.patches.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    // We draw a large rectangle to cover the viewport\n    g.rect(0, 0, w, h);\n    g.fill({ color: 0x9fb7c9, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      // Follow camera\n      if (this.g) this.g.x = viewport.x;\n      if (this.layer1) this.layer1.x = viewport.x;\n      if (this.layer2) this.layer2.x = viewport.x;\n      \n      // We also need to follow Y if the map is tall\n      if (this.g) this.g.y = viewport.y;\n      if (this.layer1) this.layer1.y = viewport.y;\n      if (this.layer2) this.layer2.y = viewport.y;\n    }\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.25, 0.9, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.8, 1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    \n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      g.x = viewport.x;\n      g.y = viewport.y;\n      g.rect(0, 0, viewport.width, viewport.height);\n    } else {\n      g.rect(0, 0, this.width, this.height);\n    }\n    g.fill({ color: 0xffffff, alpha: this.flashAlpha });\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, topY;\n    if (viewport) {\n      // Strike within viewport\n      x = Math.floor(viewport.x + this._rand(8, viewport.width - 8));\n      topY = viewport.y - Math.floor(this._rand(10, 40));\n    } else {\n      x = Math.floor(this._rand(8, W - 8));\n      topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    }\n\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2, 5, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xCCEEFF;\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n    g.stroke({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n      g.stroke({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Graphics } from 'pixi.js';\n\n// Lava rain system: similar to rain but red/orange and potentially deals damage (handled by engine)\nexport default class WeatherLavaRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 300; \n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(120, Math.floor(area / 3000));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Lava drops are slightly thicker and more glowing\n    g.rect(0, 0, 2, 10);\n    // Glowing yellow/orange color\n    const color = Math.random() > 0.3 ? 0xffaa00 : 0xffcc00;\n    g.fill({ color, alpha: 0.95 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 400 + Math.random() * 400; // slightly slower/heavier than water rain\n    const vx = (Math.random() * 40 - 20); \n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.1; \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, alive: true });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    let target = Math.floor(this.maxParticles * norm);\n    if (norm > 0 && target < 5) target = 5;\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      const toSpawn = Math.min(deficit, Math.max(1, Math.ceil(target * 0.02)), 30);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    \n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (p) {\n          try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n        }\n      }\n    }\n\n    const dt = dtMs / 1000;\n    const gAcc = 1200; \n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.vy += gAcc * dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Interaction with surfaces / water\n      if (this.api.getLiquidSurfaceY) {\n        const waterY = this.api.getLiquidSurfaceY('water', p.x);\n        if (Number.isFinite(waterY) && p.y >= waterY) {\n          if (typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: waterY, strength: 0.9 });\n          }\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Interaction with solid surfaces\n      if (this.api.isSolidAt(p.x, p.y)) {\n         // Lava drops just vanish on hit with a tiny \"ember\" effect (optional)\n         if (typeof this.api.onLavaImpact === 'function' && Math.random() > 0.5) {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: 0.2 });\n         }\n         p.alive = false;\n         toRemove.push(i);\n         continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 50 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Radioactive fog overlay: similar to fog but toxic green\nexport default class WeatherRadioactiveFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0;\n\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    this.noiseTex = WeatherRadioactiveFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    this.layer2 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    \n    this.layer1.tileScale.set(1.2, 1.2);\n    this.layer2.tileScale.set(0.7, 0.9);\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100;\n    return Math.max(0, Math.min(0.75, t * 0.75));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0);\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    g.rect(0, 0, w, h);\n    // Toxic green tint\n    g.fill({ color: 0x1a5c1a, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      if (this.g) { this.g.x = viewport.x; this.g.y = viewport.y; }\n      if (this.layer1) { this.layer1.x = viewport.x; this.layer1.y = viewport.y; }\n      if (this.layer2) { this.layer2.x = viewport.x; this.layer2.y = viewport.y; }\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    const pulse = 1 + 0.06 * Math.sin(this.time * 0.001);\n    this._applyAlphas(pulse);\n\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    if (this.layer1) { try { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); } catch {} }\n    if (this.layer2) { try { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); } catch {} }\n    this.layer1 = null; this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.3 + 0.4 * t);\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.7;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    this.speed1 = { x: lerp(0.004, 0.02, t), y: lerp(0.0, 0.01, t) };\n    this.speed2 = { x: lerp(-0.005, -0.015, t), y: lerp(0.003, 0.015, t) };\n  }\n\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 180 + Math.floor(Math.random() * 75); \n      img.data[i] = v * 0.4;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v * 0.4;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Meteor rain system: large falling fireballs that can deal damage via API callback\nexport default class WeatherMeteorRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 15; // Meteors are rare and large\n  }\n\n  resize(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n  spawnOne() {\n    const size = 4 + Math.random() * 8; // Meteor radius\n    const isLarge = size > 9;\n    \n    const g = new Graphics();\n    g.clear();\n    \n    // Core\n    g.circle(0, 0, size);\n    g.fill({ color: 0x555555, alpha: 1 });\n    \n    // Glow/Fire\n    g.circle(0, 0, size * 1.5);\n    g.fill({ color: 0xff4500, alpha: 0.4 });\n    \n    // Tail\n    g.moveTo(-size, 0);\n    g.lineTo(0, -size * 4);\n    g.lineTo(size, 0);\n    g.fill({ color: 0xff8c00, alpha: 0.6 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 200 + Math.random() * (viewport.width + 400);\n      y = viewport.y - 100 - Math.random() * 200;\n    } else {\n      x = Math.random() * this.width;\n      y = -100 - Math.random() * 200;\n    }\n\n    const vx = 100 + Math.random() * 100; // slanted fall\n    const vy = 400 + Math.random() * 300;\n    \n    g.x = x;\n    g.y = y;\n    // Rotate towards fall direction\n    g.rotation = Math.atan2(vy, vx) - Math.PI/2;\n    \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, size, isLarge, alive: true, waterTouched: false });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0005 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = this.intensity / 100;\n    const target = Math.floor(this.maxParticles * norm);\n\n    if (this.particles.length < target && Math.random() < 0.02 * norm) {\n      this.spawnOne();\n    }\n\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      const playerState = typeof this.api.getPlayerState === 'function'\n        ? this.api.getPlayerState()\n        : null;\n      let hitEntity = false;\n      if (playerState) {\n        const px = (playerState.x || 0) + (playerState.width || 0) / 2;\n        const py = (playerState.y || 0) + (playerState.height || 0) / 2;\n        const pr = Math.max(6, Math.max(playerState.width || 0, playerState.height || 0) / 2);\n        const dx = px - p.x;\n        const dy = py - p.y;\n        if ((dx * dx + dy * dy) <= Math.pow(p.size + pr, 2)) {\n          hitEntity = true;\n        } else if (Array.isArray(playerState.entities)) {\n          for (const ent of playerState.entities) {\n            const ex = (ent.x || 0) + (ent.width || 0) / 2;\n            const ey = (ent.y || 0) + (ent.height || 0) / 2;\n            const er = Math.max(6, Math.max(ent.width || 0, ent.height || 0) / 2);\n            const edx = ex - p.x;\n            const edy = ey - p.y;\n            if ((edx * edx + edy * edy) <= Math.pow(p.size + er, 2)) {\n              hitEntity = true;\n              break;\n            }\n          }\n        }\n      }\n\n      if (hitEntity) {\n        if (typeof this.api.onMeteorHit === 'function') {\n          this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'air' });\n        }\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const liquidType = typeof this.api.getLiquidTypeAt === 'function'\n        ? this.api.getLiquidTypeAt(p.x, p.y)\n        : null;\n\n      if (liquidType) {\n        if (liquidType === 'water' && typeof this.api.onWaterImpact === 'function') {\n          if (!p.waterTouched) {\n            this.api.onWaterImpact({ x: p.x, strength: p.isLarge ? 1.4 : 0.8 });\n            p.waterTouched = true;\n          }\n          // Meteors pass through water until hitting solid ground\n        } else {\n          if (liquidType === 'lava' && typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.6 : 0.9 });\n          }\n\n          if (typeof this.api.onMeteorHit === 'function') {\n            this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: liquidType });\n          }\n\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Check collision with solid world\n      if (this.api.isSolidAt(p.x, p.y)) {\n        // Explosion effect\n        if (typeof this.api.onLavaImpact === 'function') {\n           this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.5 : 0.8 });\n        }\n        \n        // Notify engine about meteor hit for damage\n        if (typeof this.api.onMeteorHit === 'function') {\n           this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'ground' });\n        }\n\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      if (viewport && (p.y > viewport.y + viewport.height + 100 || p.x > viewport.x + viewport.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      } else if (!viewport && (p.y > this.height + 100 || p.x > this.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.circle(d.x, d.y, size);\n      g.fill({ color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.circle(r.x, r.y, r.r);\n      g.stroke({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// BubbleFX: lightweight bubble particles for underwater ambience\nexport default class BubbleFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.bubbles = [];\n    this.maxBubbles = 120;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.bubbles = [];\n  }\n\n  trigger({ x = 0, y = 0, size = 2, rise = 0.03, life = 1200, drift = 0.02 } = {}) {\n    if (this.bubbles.length >= this.maxBubbles) return;\n    const g = new Graphics();\n    g.x = 0;\n    g.y = 0;\n    this.node.addChild(g);\n    this.bubbles.push({\n      g,\n      x,\n      y,\n      size,\n      rise,\n      drift,\n      life: 0,\n      max: life\n    });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.bubbles.length - 1; i >= 0; i--) {\n      const b = this.bubbles[i];\n      b.life += dt;\n      b.y -= b.rise * dt;\n      b.x += (Math.random() - 0.5) * b.drift * dt;\n      const t = Math.min(1, b.life / b.max);\n      const alpha = 0.7 * (1 - t);\n      const size = Math.max(0.5, b.size * (1 - t * 0.2));\n      const g = b.g;\n      g.clear();\n      g.circle(b.x, b.y, size);\n      g.stroke({ width: 1, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (b.life >= b.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.bubbles.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      g.stroke({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n\n      // glowing ember\n      g.circle(e.x, e.y, emberSize);\n      g.fill({ color: 0xffa229, alpha: 0.9 * emberAlpha });\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.circle(p.x, p.y, radius);\n      g.fill({ color: 0xdfdad2, alpha: Math.max(0, alpha) });\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite, Sprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.bgContainer = opts.bgContainer || null;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n\n    // Use multiple sample points for better precision\n    // 1. Center\n    const points = [\n      { x: px + pw * 0.5, y: py + ph * 0.5 },\n      { x: px + pw * 0.5, y: py + ph * 0.1 }, // Top\n      { x: px + pw * 0.5, y: py + ph * 0.9 }, // Bottom\n    ];\n\n    for (const pt of points) {\n      const gx = Math.floor(pt.x / this.tileSize);\n      const gy = Math.floor(pt.y / this.tileSize);\n      const idx = gy * this.mapWidth + gx;\n      if (region.tileIndicesSet && region.tileIndicesSet.has(idx)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { if (r.bgNode && r.bgNode.parent) r.bgNode.parent.removeChild(r.bgNode); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n        try { r.bgNode?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._quicksandTex?.destroy(true); } catch {}\n    try { this._waterfallTex?.destroy(true); } catch {}\n    try { this._lavaWaterfallTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    try { this._lavaDetailTex?.destroy(true); } catch {}\n    try { this._waterDetailTex?.destroy(true); } catch {}\n    try { this._quicksandDetailTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    if (this._gradTextures) {\n      for (const k in this._gradTextures) {\n        try { this._gradTextures[k].destroy(true); } catch {}\n      }\n      this._gradTextures = null;\n    }\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.bgNode?.parent && r.bgNode.parent.removeChild(r.bgNode); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n      try { r.bgNode?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      try { this._quicksandTex?.destroy(true); } catch {}\n      try { this._waterfallTex?.destroy(true); } catch {}\n      try { this._lavaWaterfallTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n      try { this._lavaDetailTex?.destroy(true); } catch {}\n      try { this._waterDetailTex?.destroy(true); } catch {}\n      try { this._quicksandDetailTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null; this._quicksandTex = null; this._waterfallTex = null;\n      this._lavaWaterfallTex = null;\n      this._radioactiveWaterTex = null; this._radioactiveWaterfallTex = null;\n      this._lavaDetailTex = null; this._waterDetailTex = null; this._quicksandDetailTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0, y: 0 }; // Static (bubbles added via texture/noise)\n    const lavaDrift = { x: 0, y: 0 }; // Static (floating pieces added via noise/texture)\n    const quicksandDrift = { x: 0, y: 0 }; // Static (pixels fade via noise)\n    const waterfallDrift = { x: 0, y: 0.15 }; // Fast vertical drift\n    const lavaWaterfallDrift = { x: 0, y: 0.12 }; // Lava falls a bit slower/thicker\n    const radioactiveWaterDrift = { x: 0, y: 0 }; // Static\n    const radioactiveWaterfallDrift = { x: 0, y: 0.12 }; // Match lava waterfall speed or similar\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : (r.type === 'quicksand' ? quicksandDrift : (r.type === 'waterfall' ? waterfallDrift : (r.type === 'lava_waterfall' ? lavaWaterfallDrift : (r.type === 'radioactive_waterfall' ? radioactiveWaterfallDrift : (r.type === 'radioactive_water' ? radioactiveWaterDrift : waterDrift)))));\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly with smooth transitions)\n      let targetAlpha = 0.95;\n      if (r.type === 'water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.50 : 0.95;\n      } else if (r.type === 'quicksand') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.70 : 1.0;\n      } else if (r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.40 : 0.65;\n      } else if (r.type === 'radioactive_water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.55 : 0.90;\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.60 : 0.98;\n      }\n\n      // Smooth transition (lerp)\n      if (r.currentAlpha === undefined) r.currentAlpha = sprite.alpha;\n      const lerpFactor = 0.005; // Adjust for speed of transition\n      const alphaDiff = targetAlpha - r.currentAlpha;\n      r.currentAlpha += alphaDiff * Math.min(1, dt * lerpFactor);\n      sprite.alpha = r.currentAlpha;\n\n      // Splash animation for waterfalls\n      if ((r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') && r.splashG && Array.isArray(r.bottomEdges)) {\n        const g = r.splashG;\n        g.clear();\n        const thickness = Math.max(2, Math.floor(this.tileSize * 0.25));\n        const F = 1000;\n        const cycle = (this._time % F) / F;\n        \n        for (const e of r.bottomEdges) {\n          // Animated foam/splash at the bottom\n          const splashHeight = thickness * (0.8 + Math.sin(this._time * 0.01 + e.x) * 0.2);\n          g.rect(e.x, e.y + this.tileSize - splashHeight, e.w, splashHeight);\n          \n          // Bubbles\n          for (let k = 0; k < 5; k++) {\n             const bx = e.x + ((e.x * 13 + k * 37 + this._time * 0.05) % e.w);\n             const by = e.y + this.tileSize - (Math.random() * thickness * 2);\n             g.circle(bx, by, 1 + Math.random() * 2);\n          }\n        }\n        const splashColor = r.type === 'lava_waterfall' ? 0xffcc00 : (r.type === 'radioactive_waterfall' ? 0xadff2f : 0xffffff);\n        g.fill({ color: splashColor, alpha: 0.5 + Math.sin(this._time * 0.02) * 0.2 });\n      }\n\n      // Animate noise/detail overlays\n      if (r.noise1) {\n        if (r.type === 'water') {\n          r.noise1.tilePosition.y -= 0.015 * dt; // Bubbles go UP\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.001) * 0.005 * dt; \n        } else if (r.type === 'lava') {\n          r.noise1.tilePosition.x += 0.004 * dt; \n          r.noise1.tilePosition.y += 0.002 * dt;\n        } else if (r.type === 'quicksand') {\n          // Fade effect for pixels\n          r.noise1.alpha = 0.4 + Math.sin(this._time * 0.001) * 0.2;\n          r.noise1.tilePosition.x += 0.001 * dt;\n        } else if (r.type.includes('waterfall')) {\n          r.noise1.tilePosition.y += drift.y * 0.8 * dt;\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.002) * 0.02 * dt;\n        } else {\n          r.noise1.tilePosition.x += 0.008 * dt;\n          r.noise1.tilePosition.y += 0.004 * dt;\n        }\n      }\n      if (r.noise2) {\n        if (r.type === 'quicksand') {\n          r.noise2.alpha = 0.2 + Math.cos(this._time * 0.0015) * 0.1;\n        } else if (r.type.includes('waterfall')) {\n          r.noise2.tilePosition.y += drift.y * 1.2 * dt;\n        } else {\n          r.noise2.tilePosition.x -= 0.005 * dt;\n          r.noise2.tilePosition.y += 0.003 * dt;\n        }\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.rect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.fill({ color: 0xc9ecff, alpha: 0.35 });\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.lava_waterfall) return 'lava_waterfall';\n      if (def.flags.radioactive_waterfall) return 'radioactive_waterfall';\n      if (def.flags.waterfall) return 'waterfall';\n      if (def.flags.radioactive_water) return 'radioactive_water';\n      if (def.flags.quicksand) return 'quicksand';\n      if (def.flags.lava) return 'lava';\n      if (def.flags.water) return 'water';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n      _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n        const node = new Container();\n        const mask = new Graphics();\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        const tileIndicesSet = new Set(tileIndices);\n\n        mask.clear();\n        const bleed = 1; // Palielints bleed, lai nosegtu spraugas\n        for (let k = 0; k < tileIndices.length; k++) {\n          const idx = tileIndices[k];\n          const gx = (idx % mapWidth);\n          const gy = Math.floor(idx / mapWidth);\n          mask.rect(\n            gx * tileSize - bleed,\n            gy * tileSize - bleed,\n            tileSize + bleed * 2,\n            tileSize + bleed * 2\n          );\n        }\n        mask.fill({ color: 0xffffff, alpha: 1 });\n\n        const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                     : (type === 'quicksand' ? (this._quicksandTex || (this._quicksandTex = this._createQuicksandTexture(tileSize)))\n                                     : (type === 'waterfall' ? (this._waterfallTex || (this._waterfallTex = this._createWaterfallTexture(tileSize)))\n                                     : (type === 'lava_waterfall' ? (this._lavaWaterfallTex || (this._lavaWaterfallTex = this._createLavaWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_waterfall' ? (this._radioactiveWaterfallTex || (this._radioactiveWaterfallTex = this._createRadioactiveWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_water' ? (this._radioactiveWaterTex || (this._radioactiveWaterTex = this._createRadioactiveWaterTexture(tileSize)))\n                                     : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize))))))));\n        \n        // v8 addressMode iestatana\n        if (tex.source && tex.source.style) {\n          tex.source.style.addressMode = 'repeat';\n        }\n\n        const tiling = new TilingSprite({\n          texture: tex,\n          width: worldW,\n          height: worldH\n        });\n        \n        tiling.tileScale.set(1, 1);\n        tiling.alpha = type === 'lava' ? 0.98 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.6 : 0.92);\n        node.addChild(tiling);\n\n        // Noise/Detail sli\n        let detailTex1, detailTex2;\n        if (type.includes('lava')) {\n          detailTex1 = this._lavaDetailTex || (this._lavaDetailTex = this._createLavaDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type === 'quicksand') {\n          detailTex1 = this._quicksandDetailTex || (this._quicksandDetailTex = this._createQuicksandDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type.includes('radioactive')) {\n          detailTex1 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n          detailTex2 = this._noiseTex;\n        } else {\n          // water, waterfall\n          detailTex1 = this._waterDetailTex || (this._waterDetailTex = this._createWaterDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        }\n\n        if (detailTex1.source && detailTex1.source.style) detailTex1.source.style.addressMode = 'repeat';\n        if (detailTex2.source && detailTex2.source.style) detailTex2.source.style.addressMode = 'repeat';\n\n        const noise1 = new TilingSprite({ texture: detailTex1, width: worldW, height: worldH });\n        const noise2 = new TilingSprite({ texture: detailTex2, width: worldW, height: worldH });\n        \n        if (type === 'water' || type === 'radioactive_water') {\n          noise1.alpha = 0.25; noise2.alpha = 0.15;\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          noise1.alpha = 0.2; noise2.alpha = 0.15;\n        } else if (type === 'lava') {\n          noise1.alpha = 0.4; noise2.alpha = 0.2;\n        } else if (type === 'quicksand') {\n          noise1.alpha = 0.6; noise2.alpha = 0.3;\n        } else {\n          noise1.alpha = 0.12; noise2.alpha = 0.15;\n        }\n        node.addChild(noise1, noise2);\n\n        // LABOJUMS: Maska tiek pievienota k brns, lai t sekotu ldzi node koordintm\n        node.addChild(mask);\n        node.mask = mask;\n\n        // Background slnis (zIndex 28) - lai aizsegtu fonu caur deni\n        let bgNode = null;\n        if (this.bgContainer) {\n          bgNode = new Container();\n          const bgMask = new Graphics();\n          bgMask.clear();\n          for (let k = 0; k < tileIndices.length; k++) {\n            const idx = tileIndices[k];\n            const gx = (idx % mapWidth);\n            const gy = Math.floor(idx / mapWidth);\n            bgMask.rect(gx * tileSize - bleed, gy * tileSize - bleed, tileSize + bleed * 2, tileSize + bleed * 2);\n          }\n          bgMask.fill({ color: 0xffffff, alpha: 1 });\n          bgNode.addChild(bgMask);\n          bgNode.mask = bgMask;\n\n          const bgG = new Graphics();\n          let minY = Infinity, maxY = -Infinity;\n          for (let k = 0; k < tileIndices.length; k++) {\n            const gy = Math.floor(tileIndices[k] / mapWidth) * tileSize;\n            if (gy < minY) minY = gy;\n            if (gy + tileSize > maxY) maxY = gy + tileSize;\n          }\n\n          if (!this._gradTextures) this._gradTextures = {};\n          if (!this._gradTextures[type]) {\n            let color, bottomColor;\n            if (type.includes('lava')) {\n              color = '#ffaa00'; bottomColor = '#884400';\n            } else if (type.includes('radioactive')) {\n              color = '#004400'; bottomColor = '#001100';\n            } else if (type === 'quicksand') {\n              color = '#5d4037'; bottomColor = '#2d1d19';\n            } else { \n              color = '#3a7fb8'; bottomColor = '#0b1d2e';\n            }\n            this._gradTextures[type] = this._createGradientTexture(color, bottomColor);\n          }\n\n          const bgSprite = new Sprite(this._gradTextures[type]);\n          bgSprite.width = worldW;\n          bgSprite.height = worldH;\n          bgSprite.y = 0;\n          \n          bgNode.addChild(bgSprite);\n          this.bgContainer.addChild(bgNode);\n        }\n\n        const baseAlpha = type === 'lava' ? 0.98 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.6 : 0.92);\n\n        if (type === 'water' || type === 'radioactive_water') {\n          const capG = new Graphics();\n          node.addChild(capG);\n          const topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n          // Saglabjam atsauces uz r reistr\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          const splashG = new Graphics();\n          node.addChild(splashG);\n          const bottomEdges = this._computeBottomEdgeSpans(tileIndices, mapWidth, tileSize);\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, splashG, bottomEdges, tileIndicesSet, currentAlpha: baseAlpha });\n        } else {\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        }\n\n        this.container.addChild(node);\n      }\n\n      _createGradientTexture(topColor, bottomColor) {\n        const canvas = document.createElement('canvas');\n        const size = 64; \n        canvas.width = 2; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, topColor);\n        g.addColorStop(1, bottomColor);\n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, 2, size);\n        return Texture.from(canvas);\n      }\n\n  _createWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient to remove horizontal bars\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // No horizontal gradient to remove bars\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    // Lava pieces/streaks (vertical) - these go down\n    ctx.fillStyle = '#ffed8a';\n    for (let k = 0; k < 10; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 15;\n      const w = 3 + Math.random() * 4; // Wider \"chunks\"\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid sand color\n    ctx.fillStyle = '#a6915b';\n    ctx.fillRect(0, 0, size, size);\n\n    // grainy texture (static here, will animate pixels via noise)\n    ctx.globalAlpha = 0.3;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 25; k++) {\n      ctx.fillRect(Math.random() * size, Math.random() * size, 1, 1);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Background color\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 15; k++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.4;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 25;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid toxic green\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Some mini bubbles (static here, noise provides movement)\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random() * 1.5, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.15 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 8 + Math.random() * 15;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n    \n    // Pievienojam burbuus (prasba: \"var pieveinot burbuus kuri iet uzleju k radioactive water\")\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 6; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random(), 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ff8800'; \n    for (let i = 0; i < 10; i++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      const sw = 12 + Math.random() * 24;\n      const sh = 10 + Math.random() * 20;\n      ctx.fillRect(Math.random() * w, Math.random() * h, sw, sh);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createWaterDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < 12; i++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * w, Math.random() * h, 1 + Math.random() * 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#5c5031';\n    for (let i = 0; i < 100; i++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.5;\n      ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 256, h = 256) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = '#ffffff';\n    for(let i=0; i<500; i++) {\n      ctx.globalAlpha = Math.random() * 0.05;\n      ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its bottom boundary per row.\n  _computeBottomEdgeSpans(tileIndices, mapWidth, tileSize) {\n    const set = new Set(tileIndices);\n    const spans = [];\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const below = idx + mapWidth;\n      if (!set.has(below)) {\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.roundRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.fill({ color: this._trackColor, alpha: 0.85 });\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.roundRect(0, 0, innerW, h, radius);\n    this._fill.fill({ color: this._color, alpha: 1 });\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  tiles: 20,\n  tilesAnim: 25,\n  liquidBackground: 28,\n  objBehind: 30,\n  secretsBelow: 35,\n  player: 40,\n  projectiles: 50,\n  objFront: 60,\n  secretsAbove: 65,\n  weather: 70,\n  fog: 80,\n  liquids: 90,\n  liquidFx: 100,\n  overlay: 110,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#3a7fb8');\n    g.addColorStop(0.5, '#5ba3d9');\n    g.addColorStop(1, '#3a7fb8');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (yellow to golden)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#ffaa00');\n    g.addColorStop(1, '#ffcc00');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffff00');\n      grad.addColorStop(1, '#ffaa00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffffff';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\nexport const isQuicksandDef = (def) => !!(def && def.flags && def.flags.quicksand);\nexport const isWaterfallDef = (def) => !!(def && def.flags && def.flags.waterfall);\nexport const isLavaWaterfallDef = (def) => !!(def && def.flags && def.flags.lava_waterfall);\nexport const isRadioactiveWaterDef = (def) => !!(def && def.flags && def.flags.radioactive_water);\nexport const isRadioactiveWaterfallDef = (def) => !!(def && def.flags && def.flags.radioactive_waterfall);\n\n// Generate procedural quicksand frames (cached per tile size)\nexport const createQuicksandFrames = (tileSize) => {\n  const frames = [];\n  const F = 12; // slightly more frames for smoother slow movement\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base sand color (brownish yellow)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#a6915b');\n    g.addColorStop(1, '#7d6d42');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // grainy texture / swirling patterns\n    const t = i / F;\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 4; k++) {\n       const y = Math.floor((tileSize / 4) * k + (t * tileSize)) % tileSize;\n       ctx.fillRect(0, y, tileSize, 1);\n    }\n    \n    // random grains\n    ctx.globalAlpha = 0.15;\n    ctx.fillStyle = '#d1ba7d';\n    const count = Math.max(5, Math.floor(tileSize * 0.25));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 43 + i * 7) % tileSize);\n      const ry = Math.floor((k * 61 + i * 11) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural waterfall frames\nexport const createWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent blue (izmantojam dens krsas)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(42, 93, 143, 0.5)');\n    g.addColorStop(0.5, 'rgba(91, 163, 217, 0.5)');\n    g.addColorStop(1, 'rgba(42, 93, 143, 0.5)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // sas vertiklas svtrias\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    const count = 6;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.3);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava waterfall frames\nexport const createLavaWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent lava colors\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(255, 170, 0, 0.6)');\n    g.addColorStop(0.5, 'rgba(255, 204, 0, 0.6)');\n    g.addColorStop(1, 'rgba(255, 170, 0, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated lava streaks\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';\n    const count = 5;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.4);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive water frames\nexport const createRadioactiveWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 12;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient (toxic green)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#1a5c1a');\n    g.addColorStop(1, '#0d2e0d');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    \n    // Bubbles\n    ctx.globalAlpha = 0.6;\n    ctx.fillStyle = '#32cd32';\n    const bubbleCount = 4;\n    for (let k = 0; k < bubbleCount; k++) {\n      const bx = Math.floor((k * 137 + i * 2) % tileSize);\n      const by = Math.floor((tileSize + k * 43 - (t * tileSize + k * 10)) % tileSize);\n      const size = 1 + (Math.sin(t * Math.PI + k) * 0.5 + 0.5) * 2;\n      ctx.beginPath();\n      ctx.arc(bx, by, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Glow streaks\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#adff2f';\n    for (let b = 0; b < 2; b++) {\n      const y = Math.floor((tileSize / 2) * b + Math.sin((t + b * 0.5) * Math.PI * 2) * (tileSize * 0.1));\n      ctx.fillRect(0, y, tileSize, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive waterfall frames\nexport const createRadioactiveWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 16; // more frames for slower motion\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(26, 92, 26, 0.6)');\n    g.addColorStop(0.5, 'rgba(50, 205, 50, 0.6)');\n    g.addColorStop(1, 'rgba(26, 92, 26, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    ctx.fillStyle = 'rgba(173, 255, 47, 0.5)';\n    const count = 4; // fewer streaks\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.2);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3, minWidth = 0, minHeight = 0 }) {\n    if (!this.container) return;\n    this.clear();\n\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = w;\n    solid.height = h;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: w, height: h });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = h / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight, minWidth = 0, minHeight = 0) {\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = w;\n      this.bgSprite.height = h;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = w;\n      this.imgSprite.height = h;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = h / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl, minWidth = 0, minHeight = 0 } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n      minWidth,\n      minHeight\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const resize = (worldWidth, worldHeight, minWidth = 0, minHeight = 0) => {\n    if (parallaxHelper) {\n      parallaxHelper.resize(worldWidth, worldHeight, minWidth, minHeight);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    resize,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container, Text, Rectangle } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n\n  // Static sprite sheet frame (grid-based)\n  if (!spr && def.spriteSheet && def.spriteSheet.enabled && def.texture && Number.isFinite(Number(def.spriteSheet.frameIndex))) {\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    if (source && source.width > 1 && source.height > 1) {\n      const totalSprites = Math.max(1, Number(def.spriteSheet.totalSprites) || 1);\n      const columns = Math.max(1, Number(def.spriteSheet.columns) || 1);\n      const rows = Math.ceil(totalSprites / columns);\n      const frameWidth = Number(def.spriteSheet.frameWidth) || (source.width / columns);\n      const frameHeight = Number(def.spriteSheet.frameHeight) || (source.height / rows);\n      const frameIndex = Math.max(0, Math.min(totalSprites - 1, Number(def.spriteSheet.frameIndex)));\n      const col = frameIndex % columns;\n      const row = Math.floor(frameIndex / columns);\n      const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n      spr = new Sprite(new Texture({ source, frame: rect }));\n    }\n  }\n\n  // Ja nav tekstru masva vai tas ir tuks, minm parasto tekstru\n  if (!spr && def.texture) {\n    const tex = getTexture(def.texture);\n    if (tex) {\n      spr = new Sprite(tex);\n    }\n  }\n\n  // Ja joprojm nav spr (piemram, nav tekstras), prbaudm editorIcon\n  if (!spr && def.editorIcon) {\n    spr = new Text({\n        text: def.editorIcon,\n        style: {\n            fontSize: 24,\n            fill: 0xffffff,\n            fontWeight: 'bold',\n            dropShadow: true,\n            dropShadowColor: 0x000000,\n            dropShadowBlur: 4,\n            dropShadowDistance: 2\n        }\n    });\n    // Centrjam tekstu tile ietvaros\n    spr.anchor.set(0.5, 0.5);\n    // T k ms lietojam anchor 0.5, mums bs jpielgo pozcija vlk vai eit\n    // Bet buildSpriteFromDef parasti atgrie objektu, kura anchor ir (0,0) pc noklusjuma\n    // lai tas atbilstu tileSize pozicionanai.\n    // Tpc iestatsim anchor uz 0, bet nedaudz nobdsim?\n    // Labk lietot anchor 0.5 un layerBuilder- pieskaitt tileSize/2.\n  }\n\n  if (!spr) {\n    spr = new Sprite(Texture.WHITE);\n  }\n\n  if (spr instanceof Sprite) {\n    spr.anchor.set(0, 0);\n  } else if (spr instanceof Text) {\n    // Tekstam ms gribam, lai tas btu centr, tpc atstjam 0.5\n  }\n  \n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = Math.round(dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth));\n  container.y = Math.round(playerState.y || 0);\n};\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef, isQuicksandDef, isWaterfallDef, isLavaWaterfallDef, isRadioactiveWaterDef, isRadioactiveWaterfallDef, createWaterFrames, createLavaFrames, createQuicksandFrames } from './liquidRendering';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const { bgRef, objBehindRef, objFrontRef, roomBgRef, roomObjBehindRef, roomObjFrontRef, secretLayerRef } = refs;\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous and destroy old children to prevent memory leaks/ticker buildup\n  const safeDestroy = (container) => {\n    if (!container) return;\n    const children = container.removeChildren();\n    children.forEach(child => {\n      try {\n        // Destroy child but KEEP textures in cache\n        child.destroy({ children: true, texture: false });\n      } catch (e) {}\n    });\n  };\n\n  safeDestroy(bgRef);\n  safeDestroy(objBehindRef);\n  safeDestroy(objFrontRef);\n  safeDestroy(roomBgRef);\n  safeDestroy(roomObjBehindRef);\n  safeDestroy(roomObjFrontRef);\n  safeDestroy(secretLayerRef?.below);\n  safeDestroy(secretLayerRef?.above);\n\n  const secretOverlays = {\n    below: new Map(),\n    above: new Map()\n  };\n\n  // 1. Render main map\n  renderMapContent(refs, options, 0, 0, secretOverlays, bgRef, objBehindRef, objFrontRef);\n\n  // 2. Render active rooms\n  const { activeRoomIds, maps, objectMetadata, secretMapData, mapWidth, tileSize } = options;\n  if (activeRoomIds && activeRoomIds.length > 0 && maps && objectMetadata && secretMapData) {\n    activeRoomIds.forEach(roomId => {\n      const roomMap = maps[roomId];\n      if (!roomMap) return;\n\n      // Find the room_area on the current map that links to this room\n      const roomAreaIndex = Object.keys(objectMetadata).find(idx => \n        secretMapData[idx] === 'room_area' && objectMetadata[idx].linkedMapId === roomId\n      );\n\n      if (roomAreaIndex !== undefined) {\n        const idx = parseInt(roomAreaIndex);\n        const ox = Math.round((idx % mapWidth) * tileSize);\n        const oy = Math.round(Math.floor(idx / mapWidth) * tileSize);\n        \n        const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n        \n        const roomOptions = {\n          ...options,\n          mapWidth: roomMap.mapWidth || roomMap.width,\n          mapHeight: roomMap.mapHeight || roomMap.height,\n          tileMapData: roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [],\n          objectMapData: roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [],\n          secretMapData: roomSecrets,\n          objectMetadata: roomMap.objectMetadata || {},\n          mapType: 'room',\n          backgroundColor: roomMap.selectedBackgroundColor,\n          activeRoomIds: [] // Avoid recursion\n        };\n\n        renderMapContent(refs, roomOptions, ox, oy, secretOverlays, roomBgRef, roomObjBehindRef, roomObjFrontRef);\n      }\n    });\n  }\n\n  // 3. Render collected secret overlays\n  renderSecretOverlays(refs, options, secretOverlays);\n};\n\nconst renderMapContent = (refs, options, offsetX, offsetY, secretOverlays, targetBg, targetObjBehind, targetObjFront) => {\n  const {\n    mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData,\n    revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType,\n    activeRoomIds, maps\n  } = options;\n\n  const { secretLayerRef } = refs;\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Pre-calculate indices covered by active rooms to hide main map content under them\n  const activeRoomIndices = new Set();\n  const roomWindowIndices = new Set(); // Store indices where rooms have windows\n\n  if (mapType !== 'room' && activeRoomIds && activeRoomIds.length > 0 && maps) {\n      Object.entries(objectMetadata || {}).forEach(([idxStr, meta]) => {\n          const idx = parseInt(idxStr);\n          if (secretMapData?.[idx] === 'room_area' && meta?.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n              const roomMap = maps[meta.linkedMapId];\n              if (!roomMap) return;\n\n              const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n              const rw = meta.width || 1;\n              const rh = meta.height || 1;\n              const rx = idx % mapWidth;\n              const ry = Math.floor(idx / mapWidth);\n              const rMapW = roomMap.mapWidth || roomMap.width || rw;\n\n              for (let dy = 0; dy < rh; dy++) {\n                  for (let dx = 0; dx < rw; dx++) {\n                      const worldIdx = (ry + dy) * mapWidth + (rx + dx);\n                      const localIdx = dy * rMapW + dx;\n                      \n                      // In the main map context, roomWindowIndices are spots where we DON'T hide the main map\n                      // because the room has a \"hole\" (window) there.\n                      // A \"hole\" is defined as no tile AND no object in the room map.\n                      const roomTiles = roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [];\n                      const roomObjs = roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [];\n                      \n                      if (!roomTiles[localIdx] && !roomObjs[localIdx]) {\n                          roomWindowIndices.add(worldIdx);\n                          activeRoomIndices.add(worldIdx); // Also hide main map tiles here to see background through windows\n                      } else {\n                          activeRoomIndices.add(worldIdx);\n                      }\n                  }\n              }\n          }\n      });\n  }\n\n  // Add background color for rooms\n  if (mapType === 'room') {\n    const bgColorStr = options.backgroundColor || '#1a1a1a';\n    const bgColorHex = bgColorStr.startsWith('#') ? \n        parseInt(bgColorStr.substring(1), 16) : \n        0x1a1a1a;\n    \n    const roomBg = new Graphics();\n    const floorTileIds = new Set(tileMapData.filter(id => id));\n    const floorObjIds = new Set(objectMapData.filter(id => id && !id.includes('player')));\n\n    for (let i = 0; i < mapWidth * mapHeight; i++) {\n        const id = tileMapData[i];\n        const objId = objectMapData[i];\n        \n        // Window logic: if there is no tile AND no object, it's a window (transparent)\n        // Be very strict about what counts as content\n        const hasContent = (id && id !== \"0\") || (objId && objId !== \"0\" && !objId.includes('player'));\n\n        if (hasContent) {\n            const tx = i % mapWidth;\n            const ty = Math.floor(i / mapWidth);\n            const x = offsetX + tx * tileSize;\n            const y = offsetY + ty * tileSize;\n            \n            // Use a slightly larger rect (0.5px) to prevent gaps/bleeding between tiles\n            // but keep the overall room boundary sharp\n            roomBg.rect(x - 0.25, y - 0.25, tileSize + 0.5, tileSize + 0.5);\n        }\n    }\n    roomBg.fill({ color: bgColorHex, alpha: 1 });\n    targetBg.addChild(roomBg);\n  }\n\n  // Background tiles\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    const secretId = secretMapData?.[i];\n\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    // Hide content if it's under an active room\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area'; // Don't treat room_area as a classic secret filter if it's used as a window\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n\n    if (isInSecretArea && isSecretRevealed) {\n      const filterColor = secretDef?.filterColorInGame || secretDef?.filterColor || 'rgba(0, 0, 0, 0.6)';\n      const renderAbove = secretDef?.renderAbovePlayer;\n      const key = `${x},${y}`;\n      if (renderAbove) {\n        secretOverlays.above.set(key, filterColor);\n      } else {\n        secretOverlays.below.set(key, filterColor);\n      }\n    }\n\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      renderOnSecretLayer = true;\n    } else if (isInSecretArea && isSecretRevealed) {\n      renderOnSecretLayer = true;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def) || isWaterfallDef(def) || isLavaWaterfallDef(def) || isRadioactiveWaterDef(def) || isRadioactiveWaterfallDef(def) || def.type === 'entity' || def.subtype === 'platform') {\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    if (renderOnSecretLayer) {\n      let backingSprite;\n      if (frames && frames.length > 0) {\n        backingSprite = new AnimatedSprite(frames);\n        backingSprite.animationSpeed = sprite.animationSpeed;\n        backingSprite.play();\n      } else if (sprite.texture) {\n        backingSprite = new Sprite(sprite.texture);\n      }\n\n      if (backingSprite) {\n        backingSprite.x = x;\n        backingSprite.y = y;\n        backingSprite.width = tileSize;\n        backingSprite.height = tileSize;\n        targetBg.addChild(backingSprite);\n      }\n\n      const backing = new Graphics();\n      backing.rect(x, y, tileSize, tileSize);\n      backing.fill({ color: 0x000000, alpha: 0.7 });\n      targetBg.addChild(backing);\n\n      sprite.alpha = 0.4;\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        targetBg.addChild(sprite);\n      }\n    } else {\n      targetBg.addChild(sprite);\n    }\n  }\n\n  // Objects\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n\n    const secretId = secretMapData?.[i];\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    const def = getDef(id);\n    if (!def || def.type === 'entity' || def.subtype === 'platform' || def.subtype === 'pushable' || def.isPushable) continue;\n\n    const meta = (objectMetadata && objectMetadata[i]) || {};\n    const maxH = def.maxHealth || 100;\n    const health = meta.health !== undefined ? meta.health : maxH;\n\n    let visualElement;\n    if (def.spriteSheet && def.spriteSheet.enabled) {\n      const totalSprites = def.spriteSheet.totalSprites || 1;\n      const columns = def.spriteSheet.columns || totalSprites;\n      \n      const healthPercent = Math.max(0, Math.min(100, (health / maxH) * 100));\n      let frameIndex = 0;\n      \n      if (meta.currentFrame !== undefined) {\n        frameIndex = meta.currentFrame;\n      } else if (def.subtype === 'door' && mapType === 'room') {\n        frameIndex = def.interaction?.frames?.inside || 2;\n      } else if (Number.isFinite(Number(def.spriteSheet?.frameIndex))) {\n        frameIndex = Number(def.spriteSheet.frameIndex);\n      } else {\n        frameIndex = Math.floor((1 - healthPercent / 100) * (totalSprites - 1));\n      }\n      \n      frameIndex = Math.max(0, Math.min(totalSprites - 1, frameIndex));\n\n      const baseTexture = getTexture(def.texture);\n      const source = baseTexture?.source;\n      if (source && source.width > 1) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const frameWidth = texWidth / columns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / columns);\n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        visualElement = new Sprite(new Texture({ source: source, frame: rect }));\n      } else {\n        visualElement = buildSpriteFromDef(def);\n      }\n    } else {\n      visualElement = buildSpriteFromDef(def);\n    }\n\n    if (!visualElement) continue;\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n    \n    const renderOffsetX = Number(def.render?.offsetX) || 0;\n    const renderOffsetY = Number(def.render?.offsetY) || 0;\n    const overlapX = Number(def.render?.overlapX) || 0;\n    const overlapY = Number(def.render?.overlapY) || 0;\n    if (visualElement.anchor && visualElement.anchor.x === 0.5) {\n      visualElement.x = tileSize / 2 + renderOffsetX - overlapX / 2;\n      visualElement.y = tileSize / 2 + renderOffsetY - overlapY / 2;\n    } else {\n      visualElement.x = renderOffsetX - overlapX / 2;\n      visualElement.y = renderOffsetY - overlapY / 2;\n    }\n    \n    const objWidth = (meta.width || def.width || 1) * tileSize;\n    const objHeight = (meta.height || def.height || 1) * tileSize;\n    visualElement.width = objWidth + overlapX;\n    visualElement.height = objHeight + overlapY;\n\n    const container = new Container();\n    container.x = x;\n    container.y = y;\n    container.isRoomContent = mapType === 'room';\n    \n    const isWeatherTrigger = def.type === 'weather_trigger';\n    const isMessageTrigger = def.type === 'message_trigger';\n    const isWolfSecret = def.type === 'wolf_secret';\n    const shouldShowAnyway = (isWeatherTrigger || isMessageTrigger || isWolfSecret) && (isEditor || isEditorPlayMode);\n    \n    if (def.isHiddenInGame && !isEditor && !shouldShowAnyway) {\n        container.visible = false;\n    }\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    if (isInSecretArea && !isSecretRevealed && !isEditor) {\n      container.visible = false;\n    }\n\n    container.addChild(visualElement);\n\n    if (def.isDestructible && health < maxH && health > 0) {\n      try {\n        const hb = new HealthBar({\n          width: objWidth,\n          height: 4,\n          offsetX: 0,\n          offsetY: -5\n        });\n        hb.update(health, maxH);\n        container.addChild(hb);\n      } catch (e) {}\n    }\n\n    if (!!def.renderAbovePlayer) {\n      targetObjFront.addChild(container);\n    } else {\n      targetObjBehind.addChild(container);\n    }\n  }\n};\n\nconst renderSecretOverlays = (refs, options, overlays) => {\n  const { tileSize } = options;\n  const { secretLayerRef } = refs;\n\n  const drawOverlay = (map, container) => {\n    if (!container || map.size === 0) return;\n    const overlay = new Graphics();\n    map.forEach((filterColor, key) => {\n      const [x, y] = key.split(',').map(Number);\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    container.addChild(overlay);\n  };\n\n  drawOverlay(overlays.below, secretLayerRef?.below);\n  drawOverlay(overlays.above, secretLayerRef?.above);\n};\n","import { Container, Text } from 'pixi.js';\nimport floatConfig from '../../../../assets/json/system/floating_text.json';\n\nexport const createFloatingTextManager = (layer) => {\n  const items = [];\n  const cfg = floatConfig || {};\n  const defaultCfg = cfg.default || {};\n  const critCfg = cfg.crit || {};\n\n  const add = ({\n    x,\n    y,\n    text,\n    color = '#ff3b3b',\n    fontSize = 14,\n    ttlMs = 900,\n    amount,\n    crit\n  }) => {\n    if (!layer || !Number.isFinite(x) || !Number.isFinite(y) || !text) return;\n\n    const amountValue = Number.isFinite(amount) ? amount : null;\n    const critThreshold = Number.isFinite(critCfg.threshold) ? critCfg.threshold : null;\n    const isCrit = !!crit || (amountValue !== null && critThreshold !== null && Math.abs(amountValue) >= critThreshold);\n\n    const baseColor = defaultCfg.color || color;\n    const finalColor = isCrit ? (critCfg.color || baseColor) : baseColor;\n    const finalFontSize = isCrit ? (critCfg.fontSize || Math.round((defaultCfg.fontSize || fontSize) * 1.2)) : (defaultCfg.fontSize || fontSize);\n    const finalTtl = isCrit ? (critCfg.ttlMs || defaultCfg.ttlMs || ttlMs) : (defaultCfg.ttlMs || ttlMs);\n    const riseSpeed = isCrit ? (critCfg.riseSpeed || defaultCfg.riseSpeed || 0.04) : (defaultCfg.riseSpeed || 0.04);\n    const jitterX = Number.isFinite(defaultCfg.jitterX) ? defaultCfg.jitterX : 6;\n    const jitterY = Number.isFinite(defaultCfg.jitterY) ? defaultCfg.jitterY : 2;\n    const prefix = isCrit && typeof critCfg.prefix === 'string' ? critCfg.prefix : '';\n    const suffix = isCrit && typeof critCfg.suffix === 'string' ? critCfg.suffix : '';\n    const finalText = `${prefix}${text}${suffix}`;\n\n    const label = new Text({\n      text: String(finalText),\n      style: {\n        fontFamily: 'monospace',\n        fontSize: finalFontSize,\n        fill: finalColor,\n        stroke: '#000000',\n        strokeThickness: 2,\n        dropShadow: true,\n        dropShadowColor: '#000000',\n        dropShadowBlur: 2,\n        dropShadowDistance: 1\n      }\n    });\n\n    label.anchor.set(0.5, 1);\n    const jitterXValue = (Math.random() * 2 - 1) * jitterX;\n    const jitterYValue = (Math.random() * 2 - 1) * jitterY;\n    label.position.set(x + jitterXValue, y + jitterYValue);\n    layer.addChild(label);\n\n    items.push({\n      label,\n      ttl: finalTtl,\n      total: finalTtl,\n      vy: -riseSpeed\n    });\n  };\n\n  const update = (deltaMs) => {\n    if (!items.length) return;\n    for (let i = items.length - 1; i >= 0; i--) {\n      const item = items[i];\n      item.ttl -= deltaMs;\n      if (item.ttl <= 0) {\n        try { item.label.destroy(); } catch {}\n        items.splice(i, 1);\n        continue;\n      }\n      item.label.y += item.vy * deltaMs;\n      item.label.alpha = Math.max(0, item.ttl / item.total);\n    }\n  };\n\n  return { add, update };\n};\n\nexport const createFloatingTextLayer = () => new Container();\n","import { Container, Graphics } from 'pixi.js';\n\nexport const createBreakEffectLayer = () => {\n  const layer = new Container();\n  layer.sortableChildren = true;\n  return layer;\n};\n\nexport const createBreakEffectManager = (layer) => {\n  const particles = [];\n\n  const add = ({ x, y, config }) => {\n    if (!layer || !config) return;\n    const count = Math.max(1, Number(config.count) || 12);\n    const speed = Math.max(0.2, Number(config.speed) || 2);\n    const lifeMs = Math.max(120, Number(config.lifeMs) || 600);\n    const size = Math.max(1, Number(config.size) || 2);\n    const gravity = Number.isFinite(Number(config.gravity)) ? Number(config.gravity) : 0.02;\n    const shape = config.shape === 'circle' ? 'circle' : 'square';\n    const angleRange = Array.isArray(config.angleRange) && config.angleRange.length >= 2 ? config.angleRange : null;\n    const colors = Array.isArray(config.colors) && config.colors.length ? config.colors : [0xffffff];\n    const chunks = config.chunks && typeof config.chunks === 'object' ? config.chunks : null;\n\n    for (let i = 0; i < count; i++) {\n      const angle = angleRange\n        ? (Number(angleRange[0]) + Math.random() * (Number(angleRange[1]) - Number(angleRange[0])))\n        : (Math.random() * Math.PI * 2);\n      const sp = speed * (0.5 + Math.random() * 0.9);\n      const g = new Graphics();\n      if (shape === 'circle') {\n        g.circle(0, 0, size * 0.6);\n      } else {\n        g.rect(-size / 2, -size / 2, size, size);\n      }\n      g.fill({ color: colors[i % colors.length], alpha: 1 });\n      g.x = x;\n      g.y = y;\n      layer.addChild(g);\n      particles.push({\n        g,\n        x,\n        y,\n        vx: Math.cos(angle) * sp,\n        vy: Math.sin(angle) * sp,\n        life: lifeMs,\n        maxLife: lifeMs,\n        gravity\n      });\n    }\n\n    if (chunks) {\n      const chunkCount = Math.max(0, Number(chunks.count) || 0);\n      const chunkSpeed = Math.max(0.3, Number(chunks.speed) || speed * 1.2);\n      const chunkLife = Math.max(160, Number(chunks.lifeMs) || lifeMs * 1.1);\n      const chunkSize = Math.max(size, Number(chunks.size) || size * 1.6);\n      const chunkGravity = Number.isFinite(Number(chunks.gravity)) ? Number(chunks.gravity) : gravity;\n      const chunkShape = chunks.shape === 'square' ? 'square' : 'circle';\n      const chunkAngle = Array.isArray(chunks.angleRange) && chunks.angleRange.length >= 2 ? chunks.angleRange : angleRange;\n      const chunkColors = Array.isArray(chunks.colors) && chunks.colors.length ? chunks.colors : colors;\n\n      for (let i = 0; i < chunkCount; i++) {\n        const angle = chunkAngle\n          ? (Number(chunkAngle[0]) + Math.random() * (Number(chunkAngle[1]) - Number(chunkAngle[0])))\n          : (Math.random() * Math.PI * 2);\n        const sp = chunkSpeed * (0.6 + Math.random() * 0.9);\n        const g = new Graphics();\n        if (chunkShape === 'circle') {\n          g.circle(0, 0, chunkSize * 0.6);\n        } else {\n          g.rect(-chunkSize / 2, -chunkSize / 2, chunkSize, chunkSize);\n        }\n        g.fill({ color: chunkColors[i % chunkColors.length], alpha: 1 });\n        g.x = x;\n        g.y = y;\n        layer.addChild(g);\n        particles.push({\n          g,\n          x,\n          y,\n          vx: Math.cos(angle) * sp,\n          vy: Math.sin(angle) * sp,\n          life: chunkLife,\n          maxLife: chunkLife,\n          gravity: chunkGravity\n        });\n      }\n    }\n  };\n\n  const update = (dt) => {\n    if (!particles.length) return;\n    const delta = Math.max(0, Number(dt) || 0);\n    for (let i = particles.length - 1; i >= 0; i--) {\n      const p = particles[i];\n      p.life -= delta;\n      if (p.life <= 0) {\n        if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n        particles.splice(i, 1);\n        continue;\n      }\n      p.x = (p.x || 0) + p.vx * (delta / 16.67);\n      p.y = (p.y || 0) + p.vy * (delta / 16.67);\n      p.vy += (Number(p.gravity) || 0.02) * (delta / 16.67);\n      if (p.g) {\n        p.g.x = p.x;\n        p.g.y = p.y;\n        p.g.alpha = Math.max(0, p.life / p.maxLife);\n      }\n    }\n  };\n\n  const clear = () => {\n    for (const p of particles) {\n      if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n    }\n    particles.length = 0;\n  };\n\n  return { add, update, clear };\n};\n\nexport default {\n  createBreakEffectLayer,\n  createBreakEffectManager\n};\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = getDefById(registryItems, id);\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.lava_waterfall ? 'lava_waterfall' :\n               (def.flags.radioactive_waterfall ? 'radioactive_waterfall' :\n               (def.flags.waterfall ? 'waterfall' :\n               (def.flags.radioactive_water ? 'radioactive_water' :\n               (def.flags.quicksand ? 'quicksand' :\n               (def.flags.lava ? 'lava' :\n               (def.flags.water ? 'water' : 'liquid'))))));\n  const overlayColorRaw = def?.liquid?.overlay?.color ?? def?.liquid?.overlayColor ?? def?.tintBelowSurface;\n  const overlayAlphaRaw = def?.liquid?.overlay?.alpha ?? def?.liquid?.overlayAlpha;\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    overlay: {\n      color: Number(overlayColorRaw),\n      alpha: Number(overlayAlphaRaw)\n    },\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    },\n    resources: def?.liquid?.resources || {}\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  const defaultOverlay = (() => {\n    if (type.includes('lava')) return { color: 10914816, alpha: 0.25 };\n    if (type === 'quicksand') return { color: 10916187, alpha: 0.2 };\n    if (type === 'radioactive_water' || type === 'radioactive_waterfall') return { color: 1727514, alpha: 0.18 };\n    return { color: 1919093, alpha: 0.15 };\n  })();\n  const rawOverlayColor = candidate.params?.overlay?.color;\n  const rawOverlayAlpha = candidate.params?.overlay?.alpha;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    overlay: {\n      color: Number.isFinite(rawOverlayColor) ? rawOverlayColor : defaultOverlay.color,\n      alpha: Number.isFinite(rawOverlayAlpha) ? rawOverlayAlpha : defaultOverlay.alpha\n    },\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    },\n    resources: candidate.params?.resources || {}\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","import React, { useEffect, useRef, useMemo, useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets, BlurFilter, ColorMatrixFilter, Texture, Sprite } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder, LavaRain as WeatherLavaRain, RadioactiveFog as WeatherRadioactiveFog, MeteorRain as WeatherMeteorRain } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, BubbleFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { syncEntities, cleanupEntities } from './entityManager';\nimport { rebuildLayers } from './layerBuilder';\nimport { createFloatingTextLayer, createFloatingTextManager } from './floatingTextManager';\nimport { createBreakEffectLayer, createBreakEffectManager } from './breakEffectManager';\nimport { getLiquidAtPixel } from '../../../../engine/liquids/liquidUtils';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({\n  skipCacheIdWarning: true,\n  preferCreateImageBitmap: false, // Prevents WebGL warning: texImage: Alpha-premult and y-flip are deprecated\n});\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\nconst LIQUID_SURFACE_MAP = [\n  { key: 'lava', surface: 'lava' },\n  { key: 'radioactive', surface: 'radiation' },\n  { key: 'quicksand', surface: 'quicksand' },\n  { key: 'water', surface: 'water' },\n];\n\nconst toSurfaceType = (liquidType) => {\n  if (!liquidType) return null;\n  for (const entry of LIQUID_SURFACE_MAP) {\n    if (liquidType.includes(entry.key)) return entry.surface;\n  }\n  return null;\n};\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = EMPTY_ARRAY,\n  objectMapData = EMPTY_ARRAY,\n  secretMapData = EMPTY_ARRAY,\n  revealedSecrets = EMPTY_ARRAY,\n  registryItems = EMPTY_ARRAY,\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  weatherLavaRain = 0,\n  weatherRadioactiveFog = 0,\n  weatherMeteorRain = 0,\n  projectiles = EMPTY_ARRAY,\n  healthBarEnabled = true,\n  objectMetadata = EMPTY_OBJECT,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n  isEditor = false,\n  isEditorPlayMode = false,\n  mapType = 'overworld',\n  activeRoomIds = EMPTY_ARRAY,\n  maps = EMPTY_OBJECT,\n  showGrid = false,\n  renderLayers = null, // null means all layers, otherwise an array of layer names to show\n  pointerEvents = 'auto',\n  onWeatherEffectHit = null,\n  roomBlurEnabled = true,\n  debugOverlayEnabled = false,\n}) => {\n  const [isPixiReady, setIsPixiReady] = useState(false);\n\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const cameraPosRef = useRef({ x: 0, y: 0 });\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const roomBgRef = useRef(null);\n  const roomObjBehindRef = useRef(null);\n  const roomObjFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerLayerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidBgLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null, fog: null, lavaRain: null, radioactiveFog: null, meteorRain: null });\n  const weatherPropsRef = useRef({ rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0, lavaRain: 0, radioactiveFog: 0, meteorRain: 0 });\n  const tileMapDataRef = useRef(tileMapData);\n  const registryItemsRef = useRef(registryItems);\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const entitiesLayerRef = useRef(null);\n  const entitySpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef(EMPTY_ARRAY);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0, targetAlpha: 0, currentAlpha: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const bubbleFxRef = useRef(null);\n  const fishBubbleStateRef = useRef(new Map());\n  const entityWaterStateRef = useRef(new Map());\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n  const gridRef = useRef(null);\n  const showGridRef = useRef(showGrid);\n  const roomBlurEnabledRef = useRef(roomBlurEnabled);\n  const blurFilterRef = useRef(new BlurFilter({ strength: 0 }));\n  const darkenFilterRef = useRef(new ColorMatrixFilter());\n  const roomBrightnessFilterRef = useRef(new ColorMatrixFilter());\n  const vignetteRef = useRef(null);\n  const floatingLayerRef = useRef(null);\n  const debugLayerRef = useRef(null);\n  const debugEnabledRef = useRef(!!debugOverlayEnabled);\n  const floatingManagerRef = useRef(null);\n  const breakFxLayerRef = useRef(null);\n  const breakFxManagerRef = useRef(null);\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { showGridRef.current = showGrid; }, [showGrid]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { roomBlurEnabledRef.current = roomBlurEnabled; }, [roomBlurEnabled]);\n  useEffect(() => { debugEnabledRef.current = !!debugOverlayEnabled; }, [debugOverlayEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n  useEffect(() => { tileMapDataRef.current = tileMapData; }, [tileMapData]);\n  useEffect(() => { registryItemsRef.current = registryItems; }, [registryItems]);\n\n  // Sync weather props to ref for systems to read live\n  useEffect(() => {\n    weatherPropsRef.current = {\n      rain: Number(weatherRain) || 0,\n      snow: Number(weatherSnow) || 0,\n      clouds: Number(weatherClouds) || 0,\n      fog: Number(weatherFog) || 0,\n      thunder: Number(weatherThunder) || 0,\n      lavaRain: Number(weatherLavaRain) || 0,\n      radioactiveFog: Number(weatherRadioactiveFog) || 0,\n      meteorRain: Number(weatherMeteorRain) || 0,\n    };\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl,\n      minWidth: appRef.current?.screen?.width || 0,\n      minHeight: appRef.current?.screen?.height || 0\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      if (appRef.current) return;\n\n      const app = new Application();\n      try {\n        await app.init({\n          resizeTo: mountRef.current,\n          backgroundAlpha: 0,\n          antialias: false,\n          autoDensity: true,\n        });\n\n        // Enable z-index sorting for the main stage\n        app.stage.sortableChildren = true;\n\n        if (destroyed) {\n          app.destroy(true, { children: true, texture: true });\n          return;\n        }\n\n        if (!app.renderer) return;\n\n        appRef.current = app;\n        app.stage.sortableChildren = true;\n\n        // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const roomBg = new Container();\n      const roomObjBehind = new Container();\n      const roomObjFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const entitiesLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidBgLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const vignetteLayer = new Container();\n      const overlayLayer = new Container();\n      const floatingLayer = createFloatingTextLayer();\n      const breakFxLayer = createBreakEffectLayer();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      roomBg.zIndex = LAYERS.tiles + 1;\n      objBehind.zIndex = LAYERS.objBehind;\n      roomObjBehind.zIndex = LAYERS.objBehind + 1;\n      objFront.zIndex = LAYERS.objFront;\n      roomObjFront.zIndex = LAYERS.objFront + 1;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      entitiesLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidBgLayer.zIndex = LAYERS.liquidBackground;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      vignetteLayer.zIndex = LAYERS.overlay - 1;\n      overlayLayer.zIndex = LAYERS.overlay;\n      floatingLayer.zIndex = LAYERS.overlay + 1;\n      breakFxLayer.zIndex = LAYERS.overlay + 2;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      roomBgRef.current = roomBg;\n      roomObjBehindRef.current = roomObjBehind;\n      roomObjFrontRef.current = roomObjFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      playerLayerRef.current = playerLayer;\n      liquidBgLayerRef.current = liquidBgLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      entitiesLayerRef.current = entitiesLayer;\n      vignetteRef.current = vignetteLayer;\n      overlayLayerRef.current = overlayLayer;\n      floatingLayerRef.current = floatingLayer;\n      floatingManagerRef.current = createFloatingTextManager(floatingLayer);\n      breakFxLayerRef.current = breakFxLayer;\n      breakFxManagerRef.current = createBreakEffectManager(breakFxLayer);\n    \n      const gridGraphics = new Graphics();\n      gridRef.current = gridGraphics;\n      overlayLayer.addChild(gridGraphics);\n      overlayLayer.addChild(breakFxLayer);\n\n      const debugGraphics = new Graphics();\n      debugLayerRef.current = debugGraphics;\n      overlayLayer.addChild(debugGraphics);\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      const allLayersMap = {\n        background: [bg, bgAnim],\n        parallax: [parallaxLayer],\n        tiles: [bg, bgAnim], // Aliased for convenience\n        objects: [objBehind, objFront, secretBelowLayer, secretAboveLayer, entitiesLayer, projLayer],\n        player: [playerLayer],\n        weather: [weatherLayer, fogLayer],\n        liquids: [liquidBgLayer, liquidLayer, liquidFxLayer],\n        overlay: [overlayLayer]\n      };\n\n      if (renderLayers) {\n        renderLayers.forEach(layerName => {\n          const layers = allLayersMap[layerName];\n          if (layers) layers.forEach(l => {\n            if (!app.stage.children.includes(l)) app.stage.addChild(l);\n          });\n        });\n      } else {\n        // Add layers in z-order priority (back to front) for stability\n        app.stage.addChild(\n          parallaxLayer,\n          bg, bgAnim, \n          roomBg,\n          liquidBgLayer, \n          objBehind, \n          roomObjBehind,\n          secretBelowLayer, \n          playerLayer, \n          entitiesLayer, \n          projLayer, \n          objFront, \n          roomObjFront,\n          secretAboveLayer, \n          weatherLayer, \n          fogLayer, \n          liquidLayer, \n          liquidFxLayer,\n          vignetteLayer,\n          overlayLayer,\n          floatingLayer\n        );\n      }\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas - DROA PIEVIENOANA\n      if (mountRef.current && app.renderer && app.canvas) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.rect(0, 0, W, H);\n      g.fill({ color: 0x1d4875, alpha: 1 });\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffcc00, warn: 0xffaa00, danger: 0xff8800 };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas && app.renderer) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          // No need to manually rebuild here as the main useEffect will catch app state or we can just trigger a state change if needed.\n          // But Pixi v8 often recovers automatically. To be safe, we can force a rebuild by just waiting for next tick.\n        });\n      }\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n            mapWidth, \n            mapHeight, \n            tileSize,\n            bgContainer: liquidBgLayerRef.current\n          });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { bubbleFxRef.current = new BubbleFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n      } catch {}\n\n      rebuildParallax();\n\n      // Finalize initialization by setting appRef\n      // This will trigger the second useEffect to build layers and player\n      appRef.current = app;\n      setIsPixiReady(true);\n      app.ticker.add(() => {\n        if (gridRef.current) {\n          gridRef.current.clear();\n          if (showGridRef.current) {\n            for (let x = 0; x <= mapWidth; x++) {\n              gridRef.current.moveTo(x * tileSize, 0);\n              gridRef.current.lineTo(x * tileSize, mapHeight * tileSize);\n            }\n            for (let y = 0; y <= mapHeight; y++) {\n              gridRef.current.moveTo(0, y * tileSize);\n              gridRef.current.lineTo(mapWidth * tileSize, y * tileSize);\n            }\n            gridRef.current.stroke({ width: 0.5, color: 0xffffff, alpha: 0.2 });\n          }\n        }\n\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          updatePlayerSprite(\n            { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n            s,\n            tileSize,\n            hbEnabledRef.current\n          );\n        }\n\n        // Camera Follow\n        const sw = app.screen.width;\n        const sh = app.screen.height;\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        if (s) {\n          const targetX = (s.x || 0) + (s.width || tileSize) / 2;\n          const targetY = (s.y || 0) + (s.height || tileSize) / 2;\n\n          let camX = targetX - sw / 2;\n          let camY = targetY - sh / 2;\n\n          // Constraints with centering for small maps\n          if (worldW < sw) {\n            camX = (worldW - sw) / 2;\n          } else {\n            camX = Math.max(0, Math.min(camX, worldW - sw));\n          }\n\n          if (worldH < sh) {\n            camY = (worldH - sh) / 2;\n          } else {\n            camY = Math.max(0, Math.min(camY, worldH - sh));\n          }\n\n          // Use a small dead-zone/smooth follow to prevent 1px jitter from sub-pixel player movement\n          const lastCam = cameraPosRef.current || { x: camX, y: camY, rawX: camX, rawY: camY };\n          const smoothing = 0.2; // Lerp factor (0 to 1, higher is faster)\n          const rawX = lastCam.rawX !== undefined ? lastCam.rawX : camX;\n          const rawY = lastCam.rawY !== undefined ? lastCam.rawY : camY;\n          \n          const nextRawX = rawX + (camX - rawX) * smoothing;\n          const nextRawY = rawY + (camY - rawY) * smoothing;\n\n          cameraPosRef.current = { \n            x: Math.round(nextRawX), \n            y: Math.round(nextRawY),\n            rawX: nextRawX,\n            rawY: nextRawY\n          };\n          \n          app.stage.pivot.set(Math.round(nextRawX), Math.round(nextRawY));\n          \n          window.__PLAYER_POS__ = { x: s.x, y: s.y };\n\n          if (parallaxRef.current) {\n            parallaxRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          if (vignetteRef.current && vignetteRef.current.visible) {\n            vignetteRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          const f = parallaxFactorRef.current;\n          if (parallaxManagerRef.current) {\n            parallaxManagerRef.current.resize(worldW, worldH, sw, sh);\n            parallaxManagerRef.current.setScroll(nextRawX, f);\n          }\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        const swNow = app.screen.width;\n        const shNow = app.screen.height;\n\n        if (systems.rain) {\n          if (systems.rain.resize) systems.rain.resize(swNow, shNow);\n          systems.rain.update(dt);\n        }\n        if (systems.lavaRain) {\n          if (systems.lavaRain.resize) systems.lavaRain.resize(swNow, shNow);\n          systems.lavaRain.update(dt);\n        }\n        if (systems.snow) {\n          if (systems.snow.resize) systems.snow.resize(swNow, shNow);\n          systems.snow.update(dt);\n        }\n        if (systems.meteorRain) {\n          if (systems.meteorRain.resize) systems.meteorRain.resize(swNow, shNow);\n          systems.meteorRain.update(dt);\n        }\n        if (systems.clouds) {\n          if (systems.clouds.resize) systems.clouds.resize(swNow, shNow);\n          systems.clouds.update(dt);\n        }\n        if (systems.fog) {\n          if (systems.fog.resize) systems.fog.resize(swNow, shNow);\n          systems.fog.update(dt);\n        }\n        if (systems.radioactiveFog) {\n          if (systems.radioactiveFog.resize) systems.radioactiveFog.resize(swNow, shNow);\n          systems.radioactiveFog.update(dt);\n        }\n        if (systems.thunder) {\n          if (systems.thunder.resize) systems.thunder.resize(swNow, shNow);\n          systems.thunder.update(dt);\n        }\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { bubbleFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater/lava overlay with smooth fade-in/out\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n\n          // Safety check: ensure graphics object exists and is attached\n          if (u && (!u.g || u.g.destroyed)) {\n            const overlayL = overlayLayerRef.current;\n            if (overlayL) {\n              const g = new Graphics();\n              overlayL.addChild(g);\n              u.g = g;\n              u.currentAlpha = 0;\n              u.targetAlpha = 0;\n              u.time = 0;\n            }\n          }\n\n          if (u && u.g) {\n            // Check if player's head is in water/lava for full overlay\n            // If only body is in liquid, use a much subtler effect or none\n            const liquidType = sNow.liquidType;\n            const headUnder = !!(sNow && sNow.headUnderWater);\n            const inLiquid = !!(sNow && sNow.inWater);\n            \n            const overlayCfg = sNow.liquidOverlay || null;\n            const showOverlay = headUnder && !!overlayCfg;\n\n            let overlayColor = 0x1d4875;\n            let maxTargetAlpha = 0.15;\n\n            if (overlayCfg) {\n              if (Number.isFinite(overlayCfg.color)) overlayColor = overlayCfg.color;\n              if (Number.isFinite(overlayCfg.alpha)) maxTargetAlpha = overlayCfg.alpha;\n            }\n\n            if (showOverlay) {\n              u.time += dt;\n              // Target alpha with pulse effect\n              const pulseBase = (maxTargetAlpha * 0.8) + (maxTargetAlpha * 0.2) * Math.sin(u.time * 0.0025);\n              u.targetAlpha = pulseBase;\n\n              // Smooth fade-in: gradually approach target alpha\n              const fadeSpeed = 0.01; // Faster fade-in for immediate visibility\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeSpeed);\n\n              // Update color if liquid type changed (only when needed to avoid constant redraw)\n              if (!u.g.visible || u.lastLiquidType !== liquidType) {\n                u.g.clear();\n                u.g.rect(0, 0, mapWidth * tileSize, mapHeight * tileSize);\n                u.g.fill({ color: overlayColor, alpha: 1 });\n                u.lastLiquidType = liquidType;\n              }\n\n              u.g.visible = true;\n              u.g.alpha = u.currentAlpha;\n            } else {\n              // Smooth fade-out\n              u.targetAlpha = 0;\n              const fadeOutSpeed = 0.008; // Faster fade-out\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeOutSpeed);\n              u.g.alpha = u.currentAlpha;\n\n              if (u.currentAlpha < 0.01) {\n                u.currentAlpha = 0;\n                u.g.alpha = 0;\n                u.g.visible = false;\n                u.time = 0; // Reset time for next submersion\n              }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n\n        // Entities\n        const sNow = playerStateRef.current || {};\n        syncEntities(entitiesLayerRef.current, entitySpritesRef.current, sNow.entities, registryItems, tileSize);\n\n        try {\n          const ents = sNow.entities || [];\n          const tileData = tileMapDataRef.current;\n          const regs = registryItemsRef.current;\n          const seen = new Set();\n\n          for (const ent of ents) {\n            if (!ent) continue;\n            const id = ent.id;\n            seen.add(id);\n            const def = ent.def || {};\n            const cx = (ent.x || 0) + (ent.width || tileSize) * 0.5;\n            const cy = (ent.y || 0) + (ent.height || tileSize) * 0.5;\n            const liq = (tileData && regs)\n              ? getLiquidAtPixel(cx, cy, mapWidth, mapHeight, tileSize, tileData, regs)\n              : null;\n            const inWater = !!(liq && (liq.type === 'water' || liq.type === 'waterfall'));\n\n            const prev = entityWaterStateRef.current.get(id) || { inWater: false };\n            if (inWater && !prev.inWater && waterFxRef.current && liquidSystemRef.current) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', cx);\n              const strength = Math.min(2, Math.max(0.3, Math.abs(ent.vy || 0) * 0.08 + 0.4));\n              if (Number.isFinite(sy)) {\n                waterFxRef.current?.trigger({ x: cx, y: sy, strength, upward: false });\n                try { liquidSystemRef.current?.addWave?.('water', cx, Math.min(2.2, strength)); } catch {}\n              }\n            }\n            entityWaterStateRef.current.set(id, { inWater });\n\n            const isFish = def.subtype === 'fish' || def.ai?.type === 'fish' || def.fish;\n            const isAlive = Number(ent.health) > 0;\n            if (isFish && isAlive && !ent.isDormant && inWater && bubbleFxRef.current) {\n              const cfg = def.fish || {};\n              const interval = Math.max(200, Number(cfg.bubbleIntervalMs) || 900);\n              const jitter = Math.max(0, Number(cfg.bubbleJitter) || 0.4);\n              const state = fishBubbleStateRef.current.get(id) || { t: 0 };\n              state.t += dt;\n              if (state.t >= interval) {\n                state.t = 0;\n                const bx = cx + (Math.random() - 0.5) * tileSize * jitter;\n                const by = cy + (Math.random() - 0.5) * tileSize * jitter;\n                bubbleFxRef.current.trigger({\n                  x: bx,\n                  y: by,\n                  size: 2,\n                  rise: 0.025 + Math.random() * 0.02,\n                  life: 1000 + Math.random() * 400,\n                  drift: 0.015 + Math.random() * 0.02\n                });\n              }\n              fishBubbleStateRef.current.set(id, state);\n            } else if (isFish) {\n              fishBubbleStateRef.current.delete(id);\n            }\n          }\n\n          for (const key of fishBubbleStateRef.current.keys()) {\n            if (!seen.has(key)) fishBubbleStateRef.current.delete(key);\n          }\n          for (const key of entityWaterStateRef.current.keys()) {\n            if (!seen.has(key)) entityWaterStateRef.current.delete(key);\n          }\n        } catch {}\n\n        // Floating texts\n        floatingManagerRef.current?.update(dt);\n        // Break FX\n        breakFxManagerRef.current?.update(dt);\n      });\n    } catch (error) {\n      console.error('PixiStage init failed:', error);\n    }\n  };\n\n  init();\n\n  return () => {\n    destroyed = true;\n    if (appRef.current) {\n      const appToDestroy = appRef.current;\n      appRef.current = null;\n      appToDestroy.destroy(true, { children: true, texture: true });\n    }\n    try { liquidSystemRef.current?.destroy(); } catch {}\n    try { waterFxRef.current?.destroy(); } catch {}\n    try { bubbleFxRef.current?.destroy(); } catch {}\n    try { lavaEmbersRef.current?.destroy(); } catch {}\n    try { lavaSteamRef.current?.destroy(); } catch {}\n    try { parallaxManagerRef.current?.destroy(); } catch {}\n    parallaxManagerRef.current = null;\n    try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n    try {\n      weatherSystemsRef.current.rain?.destroy();\n      weatherSystemsRef.current.snow?.destroy();\n      weatherSystemsRef.current.fog?.destroy();\n    } catch {}\n    cleanupProjectiles(projectileSpritesRef.current);\n    cleanupEntities(entitySpritesRef.current);\n    clearTextureCache();\n  };\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      floatingManagerRef.current?.add(detail);\n    };\n    window.addEventListener('game-floating-text', handler);\n    return () => window.removeEventListener('game-floating-text', handler);\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      if (Number.isFinite(detail.x) && Number.isFinite(detail.y) && detail.config) {\n        breakFxManagerRef.current?.add(detail);\n      }\n    };\n    window.addEventListener('game-break-effect', handler);\n    return () => window.removeEventListener('game-break-effect', handler);\n  }, []);\n\n  useEffect(() => {\n    const isInsideRoom = activeRoomIds && activeRoomIds.length > 0;\n    const targetBlur = (isInsideRoom && roomBlurEnabled) ? 4 : 0;\n    const roomBrightness = isInsideRoom ? 1.25 : 1.0; // Slightly brighter interior\n    \n    if (blurFilterRef.current) {\n      blurFilterRef.current.strength = targetBlur;\n    }\n\n    if (darkenFilterRef.current) {\n      darkenFilterRef.current.reset();\n      if (isInsideRoom) {\n        // Desaturate and darken background when inside\n        darkenFilterRef.current.desaturate();\n        darkenFilterRef.current.brightness(0.75, true);\n      }\n    }\n\n    if (roomBrightnessFilterRef.current) {\n      roomBrightnessFilterRef.current.reset();\n      roomBrightnessFilterRef.current.brightness(roomBrightness, false);\n    }\n\n    if (vignetteRef.current) {\n      vignetteRef.current.visible = isInsideRoom;\n      if (isInsideRoom && !vignetteRef.current.children.length) {\n        const sw = appRef.current?.screen?.width || 800;\n        const sh = appRef.current?.screen?.height || 600;\n        \n        // Create programmatic vignette texture using canvas\n        const canvas = document.createElement('canvas');\n        canvas.width = 512;\n        canvas.height = 512;\n        const ctx = canvas.getContext('2d');\n        const grad = ctx.createRadialGradient(256, 256, 100, 256, 256, 360);\n        grad.addColorStop(0, 'rgba(0,0,0,0)');\n        grad.addColorStop(1, 'rgba(0,0,0,0.6)');\n        ctx.fillStyle = grad;\n        ctx.fillRect(0, 0, 512, 512);\n        \n        const tex = Texture.from(canvas);\n        const sprite = new Sprite(tex);\n        sprite.width = sw;\n        sprite.height = sh;\n        vignetteRef.current.addChild(sprite);\n        \n        // Also update sprite size on resize\n        vignetteRef.current._vignetteSprite = sprite;\n      }\n      \n      // Sync vignette position to camera (it should be screen-space)\n      if (isInsideRoom && vignetteRef.current._vignetteSprite) {\n        vignetteRef.current.x = cameraPosRef.current.x;\n        vignetteRef.current.y = cameraPosRef.current.y;\n        vignetteRef.current._vignetteSprite.width = appRef.current?.screen?.width || 800;\n        vignetteRef.current._vignetteSprite.height = appRef.current?.screen?.height || 600;\n      }\n    }\n\n    const layersToBlur = [\n      bgRef.current,\n      bgAnimRef.current,\n      objBehindRef.current,\n      objFrontRef.current,\n      secretLayerRef.current?.below,\n      secretLayerRef.current?.above,\n      liquidBgLayerRef.current,\n      liquidLayerRef.current,\n      parallaxRef.current\n    ];\n\n    layersToBlur.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        \n        // Blur filter\n        if (targetBlur > 0) {\n          if (!layer.filters.includes(blurFilterRef.current)) {\n            layer.filters = [...layer.filters, blurFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== blurFilterRef.current);\n        }\n\n        // Darken/Desaturate filter (Background only)\n        if (isInsideRoom) {\n          if (!layer.filters.includes(darkenFilterRef.current)) {\n            layer.filters = [...layer.filters, darkenFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== darkenFilterRef.current);\n        }\n\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n\n    // Apply brightness to room layers\n    const roomLayers = [\n      roomBgRef.current,\n      roomObjBehindRef.current,\n      roomObjFrontRef.current\n    ];\n\n    roomLayers.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        if (isInsideRoom) {\n          if (!layer.filters.includes(roomBrightnessFilterRef.current)) {\n            layer.filters = [...layer.filters, roomBrightnessFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== roomBrightnessFilterRef.current);\n        }\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n  }, [activeRoomIds, roomBlurEnabled]);\n\n  useEffect(() => {\n    const g = debugLayerRef.current;\n    if (!g) return;\n    g.clear();\n    if (!debugEnabledRef.current) {\n      g.visible = false;\n      return;\n    }\n    g.visible = true;\n\n    const getDefById = (id) => {\n      if (!id) return null;\n      const map = registryItems && registryItems.__byId;\n      if (map && typeof map.get === 'function') return map.get(id) || null;\n      return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    const tileCount = mapWidth * mapHeight;\n    for (let i = 0; i < tileCount; i++) {\n      const tileId = tileMapData[i];\n      if (!tileId) continue;\n      const def = getDefById(tileId);\n      if (!def) continue;\n      const x = (i % mapWidth) * tileSize;\n      const y = Math.floor(i / mapWidth) * tileSize;\n      const isLiquid = !!def.flags?.liquid;\n      const isLava = !!def.flags?.lava || !!def.flags?.lava_waterfall;\n      const isRadio = !!def.flags?.radioactive || !!def.flags?.radioactive_waterfall;\n      const hasCollision = !!def.collision;\n\n      if (isLiquid) {\n        const color = isLava ? 0xffa500 : (isRadio ? 0x32cd32 : 0x2ecdf1);\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color, alpha: 0.18 });\n      } else if (hasCollision) {\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color: 0xff3b3b, alpha: 0.12 });\n      }\n    }\n\n    if (Array.isArray(secretMapData) && secretMapData.length) {\n      g.stroke({ width: 1, color: 0xb57bff, alpha: 0.6 });\n      for (let i = 0; i < secretMapData.length; i++) {\n        if (secretMapData[i] !== 'room_area') continue;\n        const x = (i % mapWidth) * tileSize;\n        const y = Math.floor(i / mapWidth) * tileSize;\n        g.rect(x, y, tileSize, tileSize);\n      }\n    }\n  }, [debugOverlayEnabled, tileMapData, secretMapData, mapWidth, mapHeight, tileSize, registryItems]);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n\n    let active = true;\n\n    const runRebuild = async () => {\n        // Collect all textures to preload\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n            addUrl(def?.texture);\n            if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n            addUrl(playerVisuals.texture);\n            if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n            await Assets.load(urls);\n        }\n\n        if (!active || !appRef.current) return;\n\n        if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n            rebuildLayers(\n                { \n                  bgRef: bgRef.current, \n                  objBehindRef: objBehindRef.current, \n                  objFrontRef: objFrontRef.current, \n                  roomBgRef: roomBgRef.current,\n                  roomObjBehindRef: roomObjBehindRef.current,\n                  roomObjFrontRef: roomObjFrontRef.current,\n                  secretLayerRef: secretLayerRef.current \n                },\n                { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType, backgroundColor, activeRoomIds, maps }\n            );\n\n            // Rebuild player visuals if visuals changed or player not created yet\n            const pLayer = playerLayerRef.current;\n            if (pLayer) {\n                if (playerRef.current) {\n                    pLayer.removeChild(playerRef.current);\n                    try { playerRef.current.destroy({ children: true }); } catch {}\n                }\n                \n                const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerStateRef.current, tileSize);\n                pLayer.addChild(playerComponents.container);\n                playerRef.current = playerComponents.container;\n                playerSpriteRefs.current = playerComponents.sprites;\n                playerHealthBarRef.current = playerComponents.healthBar;\n            }\n\n            // Rebuild liquid regions only if tileMapData changed (not just revealedSecrets)\n            // This prevents liquid \"jumping\" when revealing secrets\n            const tileDataString = JSON.stringify(tileMapData);\n            const prevTileDataString = liquidSystemRef.current?._lastTileData;\n            if (tileDataString !== prevTileDataString) {\n                try {\n                    if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n                    if (liquidLayerRef.current) {\n                        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n                            mapWidth, \n                            mapHeight, \n                            tileSize,\n                            bgContainer: liquidBgLayerRef.current\n                        });\n                        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n                        liquidSystemRef.current._lastTileData = tileDataString; // Track what we built\n                    }\n                } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n                try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n            }\n\n            // Upload to GPU to avoid lazy initialization warnings\n            if (app.renderer && app.renderer.prepare) {\n                try {\n                    await app.renderer.prepare.upload(app.stage);\n                } catch (e) {\n                    // Prepare might fail in some edge cases or context loss\n                }\n            }\n        }\n    };\n\n    runRebuild();\n\n    return () => { active = false; };\n  }, [tileMapData, objectMapData, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets, objectMetadata, playerVisuals, isPixiReady, activeRoomIds, maps, mapType, backgroundColor]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer || !isPixiReady) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getPlayerState: () => playerStateRef.current,\n      getLiquidTypeAt: (x, y) => {\n        const tmd = tileMapDataRef.current;\n        const regs = registryItemsRef.current;\n        if (!tmd || !regs) return null;\n        const liq = getLiquidAtPixel(x, y, mapWidth, mapHeight, tileSize, tmd, regs);\n        if (!liq) return null;\n        return toSurfaceType(liq.type);\n      },\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      },\n      onMeteorHit: (data) => {\n        if (typeof onWeatherEffectHit === 'function') {\n          onWeatherEffectHit('meteor', data);\n        }\n      },\n      getViewport: () => ({\n        x: cameraPosRef.current.x,\n        y: cameraPosRef.current.y,\n        width: app.screen?.width || 800,\n        height: app.screen?.height || 600\n      })\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.rain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.snow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.clouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.thunder) || 0));\n    const getFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.fog) || 0));\n    const getLavaRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.lavaRain) || 0));\n    const getRadioactiveFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.radioactiveFog) || 0));\n    const getMeteorRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.meteorRain) || 0));\n\n    // Initialize systems if they don't exist\n    if (!weatherSystemsRef.current.rain) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n    }\n    if (!weatherSystemsRef.current.lavaRain) {\n      weatherSystemsRef.current.lavaRain = new WeatherLavaRain(weatherLayer, api, getLavaRainIntensity);\n    }\n    if (!weatherSystemsRef.current.snow) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n    }\n    if (!weatherSystemsRef.current.meteorRain) {\n      weatherSystemsRef.current.meteorRain = new WeatherMeteorRain(weatherLayer, api, getMeteorRainIntensity);\n    }\n    if (!weatherSystemsRef.current.clouds) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n    }\n    if (!weatherSystemsRef.current.fog) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, getFogIntensity);\n    }\n    if (!weatherSystemsRef.current.radioactiveFog) {\n      weatherSystemsRef.current.radioactiveFog = new WeatherRadioactiveFog(fogLayer, api, getRadioactiveFogIntensity);\n    }\n    if (!weatherSystemsRef.current.thunder) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n    }\n\n    // Return cleanup to destroy all when stage unmounts or map changes\n    return () => {\n      try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.lavaRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n      try { weatherSystemsRef.current.meteorRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n      try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.radioactiveFog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n      weatherSystemsRef.current = { rain: null, lavaRain: null, snow: null, meteorRain: null, clouds: null, thunder: null, fog: null, radioactiveFog: null };\n    };\n  }, [mapWidth, mapHeight, tileSize, isSolidAt, isPixiReady]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%', pointerEvents }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  objectMetadata: PropTypes.object,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  weatherLavaRain: PropTypes.number,\n  weatherRadioactiveFog: PropTypes.number,\n  weatherMeteorRain: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n  roomBlurEnabled: PropTypes.bool,\n  debugOverlayEnabled: PropTypes.bool,\n  renderLayers: PropTypes.arrayOf(PropTypes.string),\n  pointerEvents: PropTypes.string,\n  onWeatherEffectHit: PropTypes.func,\n};\n\nexport default PixiStage;\n","import { Sprite, AnimatedSprite, Texture } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Create new sprite\n      const def = getRegItem(registryItems, p.defId);\n      if (def && Array.isArray(def.textures) && def.textures.length > 1) {\n        const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n        if (frames.length > 0) {\n          spr = new AnimatedSprite(frames);\n          spr.animationSpeed = msToSpeed(def.animationSpeed);\n          spr.play();\n        }\n      }\n      if (!spr) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        spr = new Sprite(tex);\n      }\n      spr.anchor.set(0.5, 0.5);\n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x + (p.dir >= 0 ? 0 : 0);\n    spr.y = p.y;\n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = p.dir >= 0 ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","import { Sprite, Texture, Rectangle } from 'pixi.js';\nimport { getTexture } from './helpers';\n\n/**\n * Sinhroniz un atjaunina kustgo enttiju (piem. tanku) spraitus.\n * @param {Container} entitiesLayer PixiJS konteiners enttijm\n * @param {Map} entitySpritesMap Map, kur glabjas esoie spraiti (pc ID)\n * @param {Array} entitiesList Enttiju saraksts no dzinja\n * @param {Array} registryItems Reistra elementi\n * @param {number} tileSize Flzes izmrs pikseos\n */\nexport const syncEntities = (entitiesLayer, entitySpritesMap, entitiesList, registryItems, tileSize) => {\n  if (!entitiesLayer) return;\n\n  const seen = new Set();\n  const list = entitiesList || [];\n\n  for (const ent of list) {\n    const key = ent.id;\n    seen.add(key);\n\n    let spr = entitySpritesMap.get(key);\n    const def = ent.def || {};\n\n    if (!spr) {\n      // Izveidojam jaunu spraitu ar baltu tekstru k aizvietotju, kamr ldjas st\n      spr = new Sprite(Texture.WHITE);\n      spr.anchor.set(0, 0);\n      entitiesLayer.addChild(spr);\n      entitySpritesMap.set(key, spr);\n      spr._lastFrameIndex = -1;\n    }\n\n    // Atjaunojam tekstru no spritesheet, ja nepiecieams\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    const isTextureReady = source && source.width > 1;\n\n    if (def.spriteSheet && def.spriteSheet.enabled && isTextureReady) {\n      const columns = def.spriteSheet.columns || 1;\n      const frameIndex = ent.currentSpriteIndex !== undefined ? ent.currentSpriteIndex : 0;\n      \n      if (spr._lastFrameIndex !== frameIndex) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const totalSprites = def.spriteSheet.totalSprites || 1;\n\n        // Ja kolonnu skaits JSON ir nepareizs vai trkst, minm to aprint\n        let effectiveColumns = columns;\n        if (!effectiveColumns || effectiveColumns <= 0) {\n            effectiveColumns = Math.floor(texWidth / (def.spriteSheet.frameWidth || 32)) || 1;\n        }\n\n        const frameWidth = texWidth / effectiveColumns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / effectiveColumns);\n        \n        const col = frameIndex % effectiveColumns;\n        const row = Math.floor(frameIndex / effectiveColumns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        try {\n            spr.texture = new Texture({\n              source: source,\n              frame: rect\n            });\n            spr._lastFrameIndex = frameIndex;\n        } catch (e) {\n            console.warn(`Failed to create texture for entity ${key} frame ${frameIndex}`, e);\n            spr.texture = baseTexture;\n        }\n      }\n    } else if (isTextureReady) {\n      if (spr.texture !== baseTexture) {\n        spr.texture = baseTexture;\n        spr._lastFrameIndex = -1;\n      }\n    } else if (def.editorIcon) {\n        // Ja nav tekstras, bet ir ikona (piemram, bultia, kaut gan ts te nevajadztu bt k enttijai)\n        if (spr.texture !== Texture.WHITE) spr.texture = Texture.WHITE;\n    }\n\n    // Pozcija un izmrs\n    const targetWidth = ent.width || tileSize;\n    const targetHeight = ent.height || tileSize;\n    \n    spr.width = targetWidth;\n    spr.height = targetHeight;\n    \n    // Nodroinm, ka scale nav 0 vai NaN (ja tekstra bija dvaina skum)\n    if (!spr.scale.x || isNaN(spr.scale.x)) spr.scale.x = 1;\n    if (!spr.scale.y || isNaN(spr.scale.y)) spr.scale.y = 1;\n\n    // Virziens (flipping)\n    const direction = ent.direction !== undefined ? ent.direction : 1;\n    const flipY = !!ent.flipY;\n    const alpha = Number.isFinite(ent.alpha) ? ent.alpha : 1;\n    \n    // Ja ir definta rotcija (piem. akmeiem), izmantojam centru k enkuru\n    if (ent.rotation !== undefined) {\n        spr.anchor.set(0.5, 0.5);\n        spr.x = ent.x + targetWidth / 2;\n        spr.y = ent.y + targetHeight / 2;\n        spr.rotation = ent.rotation;\n        spr.alpha = alpha;\n        \n        // Flipping ar centru enkuru\n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n    } else {\n        // Standarta enkurs (augjais kreisais stris)\n        spr.anchor.set(0, 0);\n        spr.rotation = 0;\n        spr.alpha = alpha;\n        \n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n        \n        // Pozicionana emot vr flipping pie enkura (0,0)\n        spr.x = ent.x + (direction < 0 ? targetWidth : 0);\n        spr.y = ent.y + (flipY ? targetHeight : 0);\n    }\n  }\n\n  // Noemam spraitus enttijm, kas vairs neeksist\n  for (const [key, spr] of entitySpritesMap.entries()) {\n    if (!seen.has(key)) {\n      if (spr.parent) spr.parent.removeChild(spr);\n      spr.destroy({ children: true, texture: false }); // Tekstras koplietoanas d ts neizncinm\n      entitySpritesMap.delete(key);\n    }\n  }\n};\n\n/**\n * Attra visus enttiju spraitus.\n */\nexport const cleanupEntities = (entitySpritesMap) => {\n  for (const spr of entitySpritesMap.values()) {\n    if (spr.parent) spr.parent.removeChild(spr);\n    spr.destroy({ children: true, texture: false });\n  }\n  entitySpritesMap.clear();\n};\n","// Item collection extracted from useGameEngine.js\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata: mainMetadata, secretMapData, activeMapId } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  // --- ROOM OVERLAY LOGIC ---\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && mainMetadata) {\n    if (!gameState.current.collectedItems) {\n      gameState.current.collectedItems = new Set();\n    }\n\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          // Inside a room!\n          const localX = centerX - rx;\n          const localY = centerY - ry;\n          const rWidth = roomMap.mapWidth || roomMap.width || 20;\n          const rgX = Math.floor(localX / TILE_SIZE);\n          const rgY = Math.floor(localY / TILE_SIZE);\n          const rIndex = rgY * rWidth + rgX;\n          \n          const itemKey = `${meta.linkedMapId}:${rIndex}`;\n          if (gameState.current.collectedItems.has(itemKey)) return;\n\n          const rObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          if (rObjectData && rObjectData[rIndex]) {\n            // Call collectItem recursively or just handle it here\n            const rItemId = rObjectData[rIndex];\n            const rItemDef = getDefById(registryItems, rItemId);\n            \n            if (rItemDef && rItemDef.pickup && !rItemId.includes('player')) {\n               if (rItemDef.name && rItemDef.name.startsWith('interactable.')) return;\n\n               // Pick it up\n               let pickedUp = false;\n               if (rItemDef.effect && rItemDef.effect.health) {\n                 const healthBonus = parseInt(rItemDef.effect.health, 10);\n                 if (gameState.current.health < MAX_HEALTH) {\n                   gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n                   pickedUp = true;\n                 }\n               } else if (rItemDef.effect && rItemDef.effect.fireball) {\n                 const ammoBonus = parseInt(rItemDef.effect.fireball, 10) || 0;\n                 gameState.current.ammo = (gameState.current.ammo || 0) + ammoBonus;\n                 pickedUp = true;\n               }\n\n               if (pickedUp) {\n                 gameState.current.collectedItems.add(itemKey);\n                 try {\n                   playShotSfx(rItemDef?.sfx, Math.max(0, Math.min(1, rItemDef?.sfxVolume ?? 1)));\n                 } catch {}\n                 if (onStateUpdate) {\n                   onStateUpdate('collectItem', { index: rIndex, mapId: meta.linkedMapId });\n                 }\n                 return;\n               }\n            }\n          }\n          // If we are in a room, we don't pick up items from the main map below\n          return;\n        }\n      }\n    }\n  }\n  // --- END ROOM OVERLAY LOGIC ---\n\n  if (!gameState.current.collectedItems) {\n    gameState.current.collectedItems = new Set();\n  }\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const mapKey = activeMapId || 'main';\n  const itemKey = `${mapKey}:${index}`;\n  if (gameState.current.collectedItems.has(itemKey)) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = getDefById(registryItems, itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n}\n","export function resolveInteractableContext({\n  mapData,\n  mapWidth,\n  mapHeight,\n  objectLayerData,\n  mainObjectMetadata,\n  secretMapData,\n  activeRoomIds: activeRoomIdsProp,\n  centerX,\n  centerY,\n  TILE_SIZE\n}) {\n  const hasMainMetadata = mainObjectMetadata && Object.keys(mainObjectMetadata).length > 0;\n  let activeTargetMap = mapData;\n  let activeObjectData = objectLayerData;\n  let activeMetadata = hasMainMetadata\n    ? mainObjectMetadata\n    : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n  let activeMapWidth = mapWidth;\n  let activeMapHeight = mapHeight;\n  let offsetX = 0;\n  let offsetY = 0;\n  let currentMapId = mapData?.id || 'main';\n\n  const projectMaps = mapData?.maps || mapData?.projectMaps || {};\n  const activeRoomIds = activeRoomIdsProp || mapData?.meta?.activeRoomIds || [];\n\n  if (activeRoomIds.length > 0) {\n    const mainMetadata = hasMainMetadata\n      ? mainObjectMetadata\n      : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = projectMaps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          activeTargetMap = roomMap;\n          activeMapWidth = roomMap.mapWidth || roomMap.width || 20;\n          activeMapHeight = roomMap.mapHeight || roomMap.height || 15;\n          activeObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          activeMetadata = roomMap.objectMetadata || {};\n          offsetX = rx;\n          offsetY = ry;\n          currentMapId = meta.linkedMapId;\n          break;\n        }\n      }\n    }\n  }\n\n  return {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps,\n    activeRoomIds\n  };\n}\n\nexport default { resolveInteractableContext };\n","/**\n * Finds spawn position in a map by trigger ID or player start\n */\nexport function findSpawnPosition(map, triggerId, tileSize) {\n  if (!map) return null;\n\n  const mapW = map.width || map.mapWidth || 20;\n  const metadata = map.objectMetadata || {};\n\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data;\n\n  if (!objData) return null;\n\n  let spawnIdx = -1;\n\n  const triggerRequested = triggerId !== undefined && triggerId !== null && triggerId !== '';\n  if (triggerRequested) {\n    for (let i = 0; i < objData.length; i++) {\n      if (!objData[i]) continue;\n      if (metadata[i] && metadata[i].triggerId === triggerId) {\n        spawnIdx = i;\n        break;\n      }\n    }\n  }\n\n  if (spawnIdx === -1 && !triggerRequested) {\n    spawnIdx = objData.findIndex(id => id && id.includes('player'));\n  }\n\n  if (spawnIdx !== -1) {\n    return {\n      x: (spawnIdx % mapW) * tileSize,\n      y: Math.floor(spawnIdx / mapW) * tileSize\n    };\n  }\n\n  return null;\n}\n\nexport default { findSpawnPosition };\n","import { findSpawnPosition } from './spawn';\n\nexport function handleDoorInteraction({\n  objDef,\n  currentMeta,\n  actualIndex,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  mapData,\n  mapWidth,\n  TILE_SIZE,\n  activeTargetMap,\n  projectMaps\n}) {\n  if (!objDef || objDef.subtype !== 'door') return false;\n  if (!keys?.e) return true;\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 600) return true;\n  gameState.current.lastETime = now;\n\n  const sound = currentMeta?.sound || objDef.interaction?.sound;\n  if (sound) {\n    try { playShotSfx(sound, objDef.sfxVolume || 0.5); } catch {}\n  }\n\n  if (onStateUpdate) {\n    onStateUpdate('setObjectFrame', {\n      index: actualIndex,\n      frame: objDef.interaction?.frames?.opening || 1,\n      mapId: activeTargetMap === mapData ? null : activeTargetMap.id\n    });\n  }\n\n  const delayS = currentMeta?.delaySeconds !== undefined ? currentMeta.delaySeconds : (objDef.interaction?.delaySeconds || 0.5);\n  const targetMapId = currentMeta?.targetMapId;\n\n  if (onStateUpdate && targetMapId) {\n    setTimeout(() => {\n      const targetMap = projectMaps[targetMapId];\n      const isRoom = targetMap && targetMap.type === 'room';\n      const isExitingRoom = !isRoom && activeTargetMap !== mapData && targetMapId === 'main';\n\n      if (isRoom || isExitingRoom) {\n        let newX = gameState.current.x;\n        let newY = gameState.current.y;\n\n        if (isRoom) {\n          const roomAreaEntry = Object.entries(mapData?.meta?.objectMetadata || {})\n            .find(([, m]) => m.linkedMapId === targetMapId);\n          let rx = 0;\n          let ry = 0;\n          if (roomAreaEntry) {\n            const raIdx = parseInt(roomAreaEntry[0], 10);\n            rx = (raIdx % mapWidth) * TILE_SIZE;\n            ry = Math.floor(raIdx / mapWidth) * TILE_SIZE;\n          }\n          const spawn = findSpawnPosition(targetMap, currentMeta.spawnTriggerId, TILE_SIZE);\n          if (spawn) {\n            newX = rx + spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n            newY = ry + spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n          }\n        } else {\n          const roomAreaEntry = Object.entries(mapData?.meta?.objectMetadata || {})\n            .find(([, m]) => m.linkedMapId === activeTargetMap.id);\n          if (roomAreaEntry) {\n            const spawn = findSpawnPosition(mapData, currentMeta.spawnTriggerId, TILE_SIZE);\n            if (spawn) {\n              newX = spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n              newY = spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n            }\n          }\n        }\n\n        gameState.current.x = newX;\n        gameState.current.y = newY;\n        gameState.current.vx = 0;\n        gameState.current.vy = 0;\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      } else {\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      }\n    }, delayS * 1000);\n  }\n\n  return true;\n}\n\nexport default { handleDoorInteraction };\n","export function handleTeleportInteraction({\n  objId,\n  objDef,\n  currentMeta,\n  actualIndex,\n  activeObjectData,\n  activeMetadata,\n  activeMapWidth,\n  offsetX,\n  offsetY,\n  projectMaps,\n  onStateUpdate,\n  playShotSfx,\n  gameState,\n  TILE_SIZE\n}) {\n  if (!objId || !objId.includes('portal')) return false;\n  if (!currentMeta || currentMeta.triggerId === undefined || currentMeta.triggerId === null) return true;\n\n  const targetMapId = currentMeta.targetMapId;\n  if (targetMapId && projectMaps && projectMaps[targetMapId]) {\n    if (onStateUpdate) {\n      onStateUpdate('switchMap', {\n        targetMapId,\n        triggerId: currentMeta.triggerId\n      });\n      try {\n        const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n        playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n      } catch {}\n    }\n    return true;\n  }\n\n  for (let i = 0; i < (activeObjectData?.length || 0); i++) {\n    if (i === actualIndex) continue;\n    const destId = activeObjectData[i];\n    if (destId && (destId.includes('target') || destId === 'portal_target')) {\n      const destMeta = activeMetadata?.[i];\n      if (destMeta && destMeta.triggerId === currentMeta.triggerId) {\n        const tx = offsetX + (i % activeMapWidth) * TILE_SIZE;\n        const ty = offsetY + Math.floor(i / activeMapWidth) * TILE_SIZE;\n\n        gameState.current.x = tx;\n        gameState.current.y = ty;\n\n        try {\n          const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n          playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n        } catch {}\n        return true;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport default { handleTeleportInteraction };\n","export function applyInteractableEffects({\n  objDef,\n  actualIndex,\n  currentMapId,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  MAX_HEALTH\n}) {\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return false;\n  if (!objDef.effect) return true;\n\n  const interactableKey = currentMapId === 'main' ? `${actualIndex}` : `${currentMapId}:${actualIndex}`;\n  if (gameState.current.usedInteractables.has(interactableKey)) return true;\n\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return true;\n\n    gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  return true;\n}\n\nexport default { applyInteractableEffects };\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = getDefById(registryItems, startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n  const revealedSet = (revealedSecrets instanceof Set)\n    ? revealedSecrets\n    : new Set(revealedSecrets || []);\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSet.has(idx)) continue;\n\n      const def = getDefById(registryItems, secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSet.has(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","import i18n from './i18n';\nimport enMessages from './translations/en/tutorial_messages.json';\nimport lvMessages from './translations/lv/tutorial_messages.json';\nimport noMessages from './translations/no/tutorial_messages.json';\nimport ruMessages from './translations/ru/tutorial_messages.json';\nimport jaMessages from './translations/ja/tutorial_messages.json';\n\nconst MESSAGES = {\n  en: enMessages,\n  lv: lvMessages,\n  no: noMessages,\n  ru: ruMessages,\n  ja: jaMessages\n};\n\nconst getLang = (lang) => {\n  const raw = lang || i18n?.language || 'en';\n  const base = raw.includes('-') ? raw.split('-')[0] : raw;\n  return MESSAGES[base] ? base : 'en';\n};\n\nexport const getTutorialChapters = (lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  return Array.from(new Set([...Object.keys(fallback), ...Object.keys(data)])).sort();\n};\n\nexport const getTutorialItems = (chapter, lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  const chapterData = (data[chapter] && Object.keys(data[chapter]).length)\n    ? data[chapter]\n    : (fallback[chapter] || {});\n  return Object.keys(chapterData)\n    .sort((a, b) => Number(a) - Number(b))\n    .map((id) => ({ id, text: chapterData[id] }));\n};\n\nexport const getTutorialText = (chapter, id, lang) => {\n  if (!chapter || id === undefined || id === null) return '';\n  const l = getLang(lang);\n  const data = MESSAGES[l] || MESSAGES.en || {};\n  const fallback = (MESSAGES.en || {})[chapter]?.[String(id)] || '';\n  return data[chapter]?.[String(id)] || fallback;\n};\n\nexport default {\n  getTutorialChapters,\n  getTutorialItems,\n  getTutorialText\n};\n","// Secret-related trigger handlers (weather, messages)\nimport { getTutorialText } from '../../../i18n/tutorialMessages';\n\nexport function handleWeatherTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx\n}) {\n  if (!objDef || objDef.type !== 'weather_trigger') return false;\n\n  const weatherType = objDef.weatherType; // rain, snow, clouds, fog, thunder\n  const action = objDef.weatherAction; // on, off, set\n  let value = 0;\n\n  if (action === 'set' || action === 'on') {\n    value = currentMeta?.intensity !== undefined ? currentMeta.intensity : (action === 'on' ? 100 : 50);\n  } else if (action === 'off') {\n    value = 0;\n  }\n\n  if (!gameState.current.lastWeatherTrigger) {\n    gameState.current.lastWeatherTrigger = {};\n  }\n\n  const lastVal = gameState.current.lastWeatherTrigger[index];\n  if (lastVal !== value) {\n    if (onStateUpdate) {\n      onStateUpdate('updateWeather', { type: weatherType, value });\n    }\n    gameState.current.lastWeatherTrigger[index] = value;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport function handleMessageTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  keys\n}) {\n  if (!objDef || objDef.type !== 'message_trigger') return false;\n\n  const requiresActionKey = !!(objDef.requiresActionKey || objDef.interaction?.requiresKey);\n  if (requiresActionKey && !keys?.e) {\n    return false;\n  }\n\n  const i18nChapter = currentMeta?.i18nChapter;\n  const i18nId = currentMeta?.i18nId;\n  const message = (currentMeta?.message && String(currentMeta.message).trim())\n    ? currentMeta.message\n    : (i18nChapter && i18nId ? getTutorialText(i18nChapter, i18nId) : null);\n  if (!message) return true;\n\n  if (!gameState.current.lastMessageTrigger) {\n    gameState.current.lastMessageTrigger = {};\n  }\n\n  const lastMsg = gameState.current.lastMessageTrigger[index];\n  if (lastMsg !== message) {\n    if (onStateUpdate) {\n      onStateUpdate('showMessage', { text: message, duration: 8000 });\n    }\n    gameState.current.lastMessageTrigger[index] = message;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport default { handleWeatherTrigger, handleMessageTrigger };\n","// Wolfenstein-style secret triggers and movement handling\n\nexport function triggerWolfSecret({\n  objDef,\n  index,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  playerCenterX,\n  playerCenterY,\n  objCenterX,\n  objCenterY,\n  playerGridX,\n  playerGridY,\n  objGridX,\n  objGridY\n}) {\n  if (!objDef || objDef.type !== 'wolf_secret') return false;\n  if (!keys?.e) return true;\n\n  const moveX = objDef.moveX || 0;\n  const moveY = objDef.moveY || 0;\n  if (moveX !== 0 || moveY !== 0) {\n    const hasGrid = Number.isFinite(playerGridX) && Number.isFinite(playerGridY) && Number.isFinite(objGridX) && Number.isFinite(objGridY);\n    if (hasGrid) {\n      if (moveX < 0 && !(playerGridX > objGridX)) return true;\n      if (moveX > 0 && !(playerGridX < objGridX)) return true;\n      if (moveY < 0) {\n        if (!keys?.w) return true;\n        if (!(playerGridY > objGridY)) return true;\n      }\n      if (moveY > 0) {\n        if (!keys?.s) return true;\n        if (!(playerGridY < objGridY)) return true;\n      }\n    } else {\n      const eps = 0.01;\n      if (moveX < 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX > objCenterX + eps)) return true;\n      }\n      if (moveX > 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX < objCenterX - eps)) return true;\n      }\n      if (moveY < 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.w) return true;\n        if (!(playerCenterY > objCenterY + eps)) return true;\n      }\n      if (moveY > 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.s) return true;\n        if (!(playerCenterY < objCenterY - eps)) return true;\n      }\n    }\n  }\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 1000) return true;\n  gameState.current.lastETime = now;\n\n  if (onStateUpdate) {\n    const dx = moveX;\n    const dy = moveY;\n    onStateUpdate('shiftTile', { index, dx, dy });\n\n    if (objDef.sfx) {\n      try { playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5); } catch {}\n    }\n  }\n  return true;\n}\n\nexport function applyWolfSecretShift({\n  index,\n  dx,\n  dy,\n  mapWidth,\n  mapHeight,\n  getObjectId,\n  getObjectDef,\n  moveTile,\n  moveObject,\n  moveMetadata,\n  removeObject,\n  stepDelayMs = 250,\n  setTimeoutFn = setTimeout,\n  shouldCancel\n}) {\n  let currentIdx = index;\n  let remainingDx = dx;\n  let remainingDy = dy;\n  const originId = getObjectId(currentIdx);\n  if (!originId) return;\n\n  const moveStep = () => {\n    if (shouldCancel && shouldCancel()) return;\n    const currentId = getObjectId(currentIdx);\n    if (!currentId || currentId !== originId) return;\n    if (remainingDx === 0 && remainingDy === 0) {\n      if (removeObject) removeObject(currentIdx);\n      return;\n    }\n\n    const stepX = remainingDx > 0 ? 1 : (remainingDx < 0 ? -1 : 0);\n    const stepY = remainingDy > 0 ? 1 : (remainingDy < 0 ? -1 : 0);\n\n    const tx = (currentIdx % mapWidth) + stepX;\n    const ty = Math.floor(currentIdx / mapWidth) + stepY;\n\n    if (tx >= 0 && tx < mapWidth && ty >= 0 && ty < mapHeight) {\n      const targetIndex = ty * mapWidth + tx;\n\n      const isLastStepOfBatch = (Math.abs(remainingDx) === 1 && remainingDy === 0) ||\n        (Math.abs(remainingDy) === 1 && remainingDx === 0);\n      if (isLastStepOfBatch) {\n        const targetObjId = getObjectId(targetIndex);\n        const targetDef = getObjectDef(targetObjId);\n        if (targetDef && targetDef.type === 'wolf_secret') {\n          const extraX = Math.abs(targetDef.moveX || 3);\n          const extraY = Math.abs(targetDef.moveY || 3);\n          if (remainingDx !== 0) remainingDx += (remainingDx > 0 ? extraX : -extraX);\n          if (remainingDy !== 0) remainingDy += (remainingDy > 0 ? extraY : -extraY);\n        }\n      }\n\n      if (moveTile) moveTile(currentIdx, targetIndex);\n      if (moveObject) moveObject(currentIdx, targetIndex);\n      if (moveMetadata) moveMetadata(currentIdx, targetIndex);\n\n      currentIdx = targetIndex;\n      remainingDx -= stepX;\n      remainingDy -= stepY;\n\n      if (remainingDx !== 0 || remainingDy !== 0) {\n        setTimeoutFn(moveStep, stepDelayMs);\n      } else {\n        if (removeObject) removeObject(currentIdx);\n      }\n    } else {\n      if (removeObject) removeObject(currentIdx);\n    }\n  };\n\n  moveStep();\n}\n\nexport default { triggerWolfSecret, applyWolfSecretShift };\n","// Helpers for crack_block secret behavior\n\nexport function shouldRemoveCrackBlock(def, newHealth) {\n  if (!def || def.type !== 'crack_block') return false;\n  const threshold = def.passableHealthThreshold || 0;\n  return newHealth <= threshold;\n}\n\nexport default { shouldRemoveCrackBlock };\n","import { resolveInteractableContext } from './context';\nimport { handleDoorInteraction } from './doors';\nimport { handleTeleportInteraction } from './teleport';\nimport { applyInteractableEffects } from './effects';\nimport { handleWeatherTrigger, handleMessageTrigger, triggerWolfSecret } from '../secrets';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, mapHeight, objectLayerData) {\n  const {\n    registryItems,\n    TILE_SIZE,\n    MAX_HEALTH,\n    playShotSfx,\n    onStateUpdate,\n    gameState,\n    mapData,\n    activeRoomIds: activeRoomIdsProp,\n    objectMetadata: mainObjectMetadata,\n    secretMapData\n  } = ctx;\n  if (!objectLayerData) return;\n\n  const keys = ctx.input?.current || {};\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps\n  } = resolveInteractableContext({\n    mapData,\n    mapWidth,\n    mapHeight,\n    objectLayerData,\n    mainObjectMetadata,\n    secretMapData,\n    activeRoomIds: activeRoomIdsProp,\n    centerX,\n    centerY,\n    TILE_SIZE\n  });\n\n  const localX = centerX - offsetX;\n  const localY = centerY - offsetY;\n\n  const gridX = Math.floor(localX / TILE_SIZE);\n  const gridY = Math.floor(localY / TILE_SIZE);\n  let index = gridY * activeMapWidth + gridX;\n\n  if (keys.e) {\n    let targetIndex = null;\n\n    if (keys.w) {\n        const upIndex = (gridY - 1) * activeMapWidth + gridX;\n        if (gridY - 1 >= 0) {\n          const upObjId = activeObjectData?.[upIndex];\n          const upDef = getDefById(registryItems, upObjId);\n          if (upDef && upDef.type === 'wolf_secret') {\n            targetIndex = upIndex;\n          }\n        }\n      }\n\n    if (targetIndex === null && keys.s) {\n      const downIndex = (gridY + 1) * activeMapWidth + gridX;\n      const limitHeight = activeMapHeight || mapHeight || 0;\n      if (gridY + 1 < limitHeight) {\n        const downObjId = activeObjectData?.[downIndex];\n        const downDef = getDefById(registryItems, downObjId);\n        if (downDef && downDef.type === 'wolf_secret') {\n          targetIndex = downIndex;\n        }\n      }\n    }\n\n    if (targetIndex === null) {\n      const dir = keys.d ? 1 : (keys.a ? -1 : (gameState.current.direction || 1));\n      const frontX = localX + dir * (TILE_SIZE * 0.8);\n      const frontGridX = Math.floor(frontX / TILE_SIZE);\n      const frontIndex = gridY * activeMapWidth + frontGridX;\n\n      if (frontIndex >= 0 && frontIndex < (activeObjectData?.length || 0)) {\n        const frontObjId = activeObjectData[frontIndex];\n        if (frontObjId) {\n          const frontDef = getDefById(registryItems, frontObjId);\n          if (frontDef && (\n            frontDef.type === 'wolf_secret' ||\n            frontDef.subtype === 'door' ||\n            frontDef.name?.startsWith('interactable.') ||\n            (frontDef.type === 'message_trigger' && (frontDef.requiresActionKey || frontDef.interaction?.requiresKey))\n          )) {\n            targetIndex = frontIndex;\n          }\n        }\n      }\n    }\n\n    if (targetIndex !== null) {\n      index = targetIndex;\n    }\n  }\n\n  let foundIndex = -1;\n  const directObjId = activeObjectData ? activeObjectData[index] : null;\n  if (directObjId) {\n    foundIndex = index;\n  } else if (activeMetadata) {\n    for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      const w = meta.width || 1;\n      const h = meta.height || 1;\n      if (w > 1 || h > 1) {\n        const ox = idx % activeMapWidth;\n        const oy = Math.floor(idx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          if (activeObjectData && activeObjectData[idx]) {\n            foundIndex = idx;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (foundIndex === -1) return;\n  const actualIndex = foundIndex;\n\n  let currentMeta = activeMetadata?.[actualIndex];\n  if (!currentMeta && mapData) {\n    const fromMap = mapData?.maps?.[currentMapId]?.objectMetadata;\n    const fromMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata;\n    currentMeta = (fromMap && fromMap[actualIndex]) || (fromMeta && fromMeta[actualIndex]) || currentMeta;\n  }\n  const objId = activeObjectData[actualIndex];\n  if (!objId) return;\n\n  const objDef = getDefById(registryItems, objId);\n  if (!objDef) return;\n\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (handleWeatherTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx })) return;\n  if (handleMessageTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx, keys })) return;\n  if (triggerWolfSecret({\n    objDef,\n    index: actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    playerCenterX: localX,\n    playerCenterY: localY,\n    objCenterX: ((actualIndex % activeMapWidth) + 0.5) * TILE_SIZE,\n    objCenterY: (Math.floor(actualIndex / activeMapWidth) + 0.5) * TILE_SIZE,\n    playerGridX: gridX,\n    playerGridY: gridY,\n    objGridX: actualIndex % activeMapWidth,\n    objGridY: Math.floor(actualIndex / activeMapWidth)\n  })) return;\n\n  if (handleDoorInteraction({\n    objDef,\n    currentMeta,\n    actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    mapData,\n    mapWidth,\n    TILE_SIZE,\n    activeTargetMap,\n    projectMaps\n  })) return;\n\n  if (handleTeleportInteraction({\n    objId,\n    objDef,\n    currentMeta,\n    actualIndex,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    offsetX,\n    offsetY,\n    projectMaps,\n    onStateUpdate,\n    playShotSfx,\n    gameState,\n    TILE_SIZE\n  })) return;\n\n  if (objDef.subtype === 'end' && !gameState.current.isWinning) {\n    gameState.current.isWinning = true;\n    gameState.current.winCounter = 0;\n    gameState.current.winCountSpeed = objDef.winCountSpeed || 10;\n    return;\n  }\n\n  applyInteractableEffects({\n    objDef,\n    actualIndex,\n    currentMapId,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    MAX_HEALTH\n  });\n}\n\nexport default { checkInteractables };\n","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor(playerRight / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor(playerBottom / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = getDefById(registryItems, objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight >= tileLeft && playerLeft <= tileRight;\n      const overlapsVertically = playerBottom >= tileTop && playerTop <= tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const overlapTop = playerBottom - tileTop;\n        const overlapBottom = tileBottom - playerTop;\n        const overlapLeft = playerRight - tileLeft;\n        const overlapRight = tileRight - playerLeft;\n        const min = Math.min(overlapTop, overlapBottom, overlapLeft, overlapRight);\n        touchingTop = (min === overlapTop);\n        touchingBottom = (!touchingTop && min === overlapBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === overlapLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","import meteorBreakEffectsConfig from '../../assets/json/system/meteor_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst clamp01 = (v) => Math.max(0, Math.min(1, v));\n\nconst getConfig = () => {\n  if (!meteorBreakEffectsConfig || meteorBreakEffectsConfig.enabled === false) return null;\n  return meteorBreakEffectsConfig;\n};\n\nconst lerp = (a, b, t) => a + (b - a) * t;\n\nconst scaleFromRange = (range, fallback, t) => {\n  if (!Array.isArray(range) || range.length < 2) return fallback;\n  const a = Number(range[0]);\n  const b = Number(range[1]);\n  if (!Number.isFinite(a) || !Number.isFinite(b)) return fallback;\n  return lerp(a, b, t);\n};\n\nconst readNumber = (value, fallback) => {\n  const n = Number(value);\n  return Number.isFinite(n) ? n : fallback;\n};\n\nexport const getMeteorBreakEffectConfig = ({ size, surfaceType }) => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n\n  const defaults = cfg.defaults || {};\n  const sizeScale = cfg.sizeScale || {};\n  const minSize = readNumber(sizeScale.min, 4);\n  const maxSize = readNumber(sizeScale.max, 12);\n  const denom = Math.max(1, maxSize - minSize);\n  const t = clamp01((readNumber(size, minSize) - minSize) / denom);\n\n  let count = scaleFromRange(sizeScale.count, defaults.count, t);\n  let speed = scaleFromRange(sizeScale.speed, defaults.speed, t);\n  let lifeMs = scaleFromRange(sizeScale.lifeMs, defaults.lifeMs, t);\n  let particleSize = scaleFromRange(sizeScale.size, defaults.size, t);\n  let gravity = readNumber(defaults.gravity, 0.02);\n  let shape = defaults.shape || 'square';\n  let angleRange = Array.isArray(defaults.angleRange) ? defaults.angleRange : null;\n\n  const surfaces = cfg.surfaces || {};\n  const surface = surfaceType && surfaces[surfaceType] ? surfaces[surfaceType] : surfaces.ground;\n  if (surface) {\n    count = readNumber(surface.count, count);\n    speed = readNumber(surface.speed, speed);\n    lifeMs = readNumber(surface.lifeMs, lifeMs);\n    particleSize = readNumber(surface.size, particleSize);\n    gravity = readNumber(surface.gravity, gravity);\n    shape = surface.shape || shape;\n    angleRange = Array.isArray(surface.angleRange) ? surface.angleRange : angleRange;\n  }\n\n  const colorsRaw = (surface && Array.isArray(surface.colors)) ? surface.colors : defaults.colors;\n  const colors = Array.isArray(colorsRaw) && colorsRaw.length ? colorsRaw.map(normalizeColor) : [0xffffff];\n\n  return {\n    count: readNumber(count, 12),\n    speed: readNumber(speed, 2.4),\n    lifeMs: readNumber(lifeMs, 700),\n    size: readNumber(particleSize, 3),\n    colors,\n    gravity,\n    shape,\n    angleRange\n  };\n};\n\nexport default {\n  getMeteorBreakEffectConfig\n};\n","import biologicalBreakEffectsConfig from '../../assets/json/system/biological_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!biologicalBreakEffectsConfig || biologicalBreakEffectsConfig.enabled === false) return null;\n  return biologicalBreakEffectsConfig;\n};\n\nexport const getBiologicalBreakEffectConfig = () => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const base = cfg.default || {};\n  const chunks = cfg.chunks && typeof cfg.chunks === 'object' ? cfg.chunks : null;\n  const colors = Array.isArray(base.colors) && base.colors.length ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 18,\n    speed: Number(base.speed) || 2.4,\n    lifeMs: Number(base.lifeMs) || 700,\n    size: Number(base.size) || 2,\n    gravity: Number.isFinite(Number(base.gravity)) ? Number(base.gravity) : 0.02,\n    shape: base.shape || 'circle',\n    angleRange: Array.isArray(base.angleRange) ? base.angleRange : null,\n    colors,\n    chunks: chunks || null\n  };\n};\n\nexport default {\n  getBiologicalBreakEffectConfig\n};\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef, isInsideRoom } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    \n    let vol = Math.max(0, Math.min(1, volume ?? 1));\n    let muffled = !!isInsideRoom;\n\n    if (muffled) {\n        vol *= 0.5; // Reduce volume if inside\n    }\n\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        \n        // If we wanted a filter for SFX, we'd need to set up Web Audio context for each sound,\n        // which might be heavy for many sounds. Let's stick to volume reduction for simplicity \n        // unless Web Audio context is already available and passed in.\n\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol, muffled);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol, muffled = false) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    \n    // Lowpass filter if muffled\n    let lastNode = osc;\n    if (muffled) {\n        const filter = audioCtx.createBiquadFilter();\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(600, now);\n        osc.connect(filter);\n        lastNode = filter;\n    }\n\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(muffled ? 260 : 520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    \n    lastNode.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  friction = 0.8,\n  acceleration = 0.2,\n  deltaMs = 16.67\n}) {\n  let { x, vx, width, direction, y, height } = state;\n  \n  const timeScale = deltaMs / 16.67;\n  const targetVx = keys?.a ? -MOVE_SPEED : (keys?.d ? MOVE_SPEED : 0);\n  \n  if (targetVx !== 0) {\n    // Accelerate\n    vx += targetVx * acceleration * timeScale;\n    if (Math.abs(vx) > MOVE_SPEED) vx = Math.sign(vx) * MOVE_SPEED;\n    direction = Math.sign(targetVx);\n  } else {\n    // Apply friction (time-scaled)\n    const effectiveFriction = Math.pow(friction, timeScale);\n    vx *= effectiveFriction;\n    if (Math.abs(vx) < 0.1) vx = 0;\n  }\n\n  const proposedX = x + vx * timeScale;\n  const py = y ?? 0;\n  if (checkCollision(proposedX, py, mapWidth, mapHeight, width, height)) {\n    // Precza apstans pie ra\n    const step = 0.05;\n    const sign = Math.sign(vx);\n    let safeX = x;\n    const moveDist = Math.abs(vx * timeScale);\n    \n    for (let d = step; d <= moveDist; d += step) {\n      const nextX = x + d * sign;\n      if (!checkCollision(nextX, py, mapWidth, mapHeight, width, height)) {\n        safeX = nextX;\n      } else {\n        break;\n      }\n    }\n    x = safeX;\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  // Sanitize coordinates to avoid sub-pixel noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  x = Math.round(x * 1000) / 1000;\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isLiquidAt(wx, wy): optional helper to detect liquid type at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isLiquidAt,\n  prevInWater,\n  deltaMs = 16.67\n}) {\n  const timeScale = deltaMs / 16.67;\n  \n  // Liquid defaults\n  let liqBuoyancy = 0.5; // reduces effective gravity by 50%\n  let liqDragY = 0.88;  // vertical damping per frame when in liquid\n  let liqTerminal = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n  let swimImpulseMult = 0.55;\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  let activeLiquidType = null;\n\n  if (typeof isLiquidAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    \n    const feetLiq = isLiquidAt(cx, feetY);\n    const chestLiq = isLiquidAt(cx, chestY);\n    const headLiq = isLiquidAt(cx, headY);\n    \n    activeLiquidType = feetLiq || chestLiq;\n    inWater = !!activeLiquidType;\n    headUnderWater = !!headLiq;\n    atSurface = inWater && !headUnderWater;\n\n    // Apply per-liquid physics overrides\n    if (activeLiquidType === 'quicksand') {\n      liqBuoyancy = -0.15; // Negative buoyancy makes player sink!\n      liqDragY = 0.85;     // Higher drag\n      liqTerminal = 1.2;   // Very slow terminal velocity for sinking\n      swimImpulseMult = 0.35; // Harder to jump/swim\n    } else if (activeLiquidType === 'lava') {\n      liqBuoyancy = 0.3;\n      liqDragY = 0.82;\n    } else if (activeLiquidType === 'waterfall') {\n      liqBuoyancy = -0.5; // Acts like extra gravity\n      liqDragY = 0.95;     // Very low resistance\n      liqTerminal = TERMINAL_VELOCITY * 1.5; // Allow falling faster than usual terminal velocity\n    } else if (activeLiquidType === 'lava_waterfall') {\n      liqBuoyancy = -0.4; // Slightly more viscous than water\n      liqDragY = 0.92;\n      liqTerminal = TERMINAL_VELOCITY * 1.3;\n    } else if (activeLiquidType === 'radioactive_waterfall') {\n      liqBuoyancy = -0.2; // Slower fall than normal waterfall\n      liqDragY = 0.94;\n      liqTerminal = TERMINAL_VELOCITY * 0.7; // Slower speed\n    } else if (activeLiquidType === 'radioactive_water') {\n      liqBuoyancy = 0.45; // Slightly less buoyant than water\n      liqDragY = 0.86;\n    }\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * swimImpulseMult));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5 * timeScale; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - liqBuoyancy) * timeScale;\n    vy *= Math.pow(liqDragY, timeScale);\n    if (vy > liqTerminal) vy = liqTerminal;\n  } else {\n    vy += GRAVITY * timeScale;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  const proposedY = y + vy * timeScale;\n  if (checkCollision(x, proposedY, mapWidth, mapHeight, width, height)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      // Snapping to the pixel above the tile - use a small offset consistent with collision inset\n      y = Math.floor((proposedY + height - 0.1) / TILE_SIZE) * TILE_SIZE - height;\n      \n      if (Math.abs(vx || 0) > 0.1) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((proposedY + 0.1) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y = proposedY;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  // Sanitize coordinates to prevent floating point noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  y = Math.round(y * 1000) / 1000;\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Collision helpers (migrated from GameEngine/collision.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile or an object)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve definitions\n// - secretData: secret layer array (ids)\n// - objectData: object layer array (ids)\n// - objectMetadata: metadata for objects (e.g. health)\n// - entities: array of active entities (optional)\n// - ignoreEntityId: ID of the entity to ignore in check (optional)\n// - maps: all project maps (optional, for room overlays)\n// - activeRoomIds: IDs of currently active/open rooms (optional)\n// - isRoom: boolean, whether we are checking collision for a room sub-map\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds, isRoom = false) {\n  try {\n    const gx = Math.floor(wx / TILE_SIZE);\n    const gy = Math.floor(wy / TILE_SIZE);\n\n    // Boundary check\n    if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n        // Rooms have strict boundaries. Main map allows falling off the bottom.\n        // checkCollision handles top/left/right boundaries for main map.\n        return isRoom; \n    }\n\n    // Allow movement above the map (already handled by gx,gy check usually, but just in case)\n    if (wy < 0) return false;\n\n    // 0. Check for active rooms (sub-maps) - Priority check\n    if (!isRoom && maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n      let insideAnyRoom = false;\n      \n      for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n        const idx = parseInt(idxStr);\n        if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n          const roomMap = maps[meta.linkedMapId];\n          if (!roomMap) continue;\n\n          const rx = (idx % mapWidthTiles) * TILE_SIZE;\n          const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n          const rw = (meta.width || 1) * TILE_SIZE;\n          const rh = (meta.height || 1) * TILE_SIZE;\n\n          // Boundary check with pixel precision\n          // Pievienojam nelielu pielaidi (0.2px) apak, lai snapping loika vertical.js \n          // (kas izmanto y + height - 0.1) nepalaistu garm istabas grdu.\n          if (wx >= rx && wx < rx + rw && wy >= ry && wy < ry + rh + 0.2) {\n            insideAnyRoom = true;\n            \n            const localWx = wx - rx;\n            const localWy = wy - ry;\n            \n            const roomTileW = roomMap.mapWidth || roomMap.width;\n            const roomTileH = roomMap.mapHeight || roomMap.height;\n            \n            const roomTiles = roomMap.tileMapData || roomMap.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data;\n            const roomObjects = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            const roomSecrets = roomMap.secretMapData || roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data;\n\n            const solidInRoom = isSolidAtPixel(\n              localWx, localWy, \n              roomTileW, roomTileH, TILE_SIZE, \n              roomTiles, \n              registryItems, \n              roomSecrets, \n              roomObjects, \n              roomMap.objectMetadata, \n              null, \n              ignoreEntityId,\n              null,\n              null,\n              true // WE ARE IN A ROOM\n            );\n\n            if (solidInRoom) return true;\n            \n            // If the room map has NO content at this spot, it's a window/open area.\n            // The recursive call with isRoom=true already blocked the boundaries of the room map.\n            return false;\n          }\n        }\n      }\n      \n      if (!insideAnyRoom) {\n        // Izmums: aujam atrasties uz durvm, kas ir atvrtas, pat ja ts ir rpus room_area.\n        // Tas ir nepiecieams, lai spltjs neiestrgtu teleportcijas brd, izejot no istabas.\n        const index = gy * mapWidthTiles + gx;\n        const objId = objectData && objectData[index];\n        if (objId) {\n        const objDef = getDefById(registryItems, objId);\n          if (objDef && objDef.subtype === 'door') {\n            const meta = (objectMetadata && objectMetadata[index]) || {};\n            let frame = meta.currentFrame;\n            if (frame === undefined) frame = 0;\n            \n            const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n            if (frame !== closedFrame) {\n              return false; // Durvis ir atvrtas, aujam te atrasties\n            }\n          }\n        }\n        return true; \n      }\n    }\n\n    const index = gy * mapWidthTiles + gx;\n    \n    // 0. Check entities first (dynamic obstacles)\n    if (entities) {\n      for (const ent of entities) {\n        if (ent.id === ignoreEntityId) continue;\n        if (ent.health <= 0 || ent.isExploding) continue;\n        // Platforms are stand-on-able but not usually \"solid\" for other entities' horizontal physics\n        if (ent.subtype === 'platform') continue;\n        // Fish should not block movement (player or other entities)\n        if (ent.subtype === 'fish' || ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish) continue;\n\n        if (wx >= ent.x && wx < ent.x + ent.width && wy >= ent.y && wy < ent.y + ent.height) {\n          return true;\n        }\n      }\n    }\n\n    // Check if this tile has a secret - secrets make tiles passable\n    if (secretData && secretData[index]) {\n      return false;\n    }\n\n    // 1. Check objects layer first (like the wooden box)\n    if (objectData && objectData[index]) {\n      const objId = objectData[index];\n      const objDef = getDefById(registryItems, objId);\n      \n      const isEntity = objDef && (\n        objDef.type === 'entity' || \n        objDef.subtype === 'tank' || \n        objDef.subtype === 'platform' ||\n        objDef.subtype === 'pushable' ||\n        objDef.isPushable ||\n        (objDef.name && objDef.name.toLowerCase().includes('entities.'))\n      );\n\n      if (objDef && objDef.collision && !isEntity) {\n        // Durvju specil loika: atvrtas/lietotas durvis nav cietas\n        if (objDef.subtype === 'door') {\n          const meta = (objectMetadata && objectMetadata[index]) || {};\n          let frame = meta.currentFrame;\n          \n          if (frame === undefined) {\n              // Default frame for rooms is 'inside' (open)\n              if (isRoom) {\n                  frame = objDef.interaction?.frames?.inside ?? 0;\n              } else {\n                  frame = 0; // Default for main map is closed\n              }\n          }\n\n          const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n          \n          // Ja durvis nav aizvrtas (ir atvrans fz vai atvrtas), ts nav cietas\n          if (frame !== closedFrame) {\n            return false;\n          }\n        }\n\n        // Special logic for destructible objects like the wooden box\n        if (objDef.isDestructible && objectMetadata && objectMetadata[index]) {\n          const health = objectMetadata[index].health !== undefined ? objectMetadata[index].health : objDef.maxHealth;\n          const threshold = objDef.passableHealthThreshold || 0;\n          if (health <= threshold) {\n            return false; // Box is broken, can pass through\n          }\n        }\n        return true;\n      }\n    }\n\n    // 2. Check tiles layer\n    const tileId = tileData[index];\n    if (!tileId) return false;\n    const tileDef = getDefById(registryItems, tileId);\n    if (!tileDef || !tileDef.collision) return false;\n    if (tileDef.collision === true) return true;\n    if (typeof tileDef.collision === 'object') {\n      return !!(\n        tileDef.collision.top ||\n        tileDef.collision.bottom ||\n        tileDef.collision.left ||\n        tileDef.collision.right\n      );\n    }\n    return false;\n  } catch (error) {\n    console.error('Error in isSolidAtPixel:', error);\n    return false;\n  }\n}\n\n// AABB collision check for player rectangle at (newX, newY)\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds) {\n  // Insets and epsilon values to prevent \"sticking\" and ensure stable grounding.\n  // inset: distance from corners for edge-mid points to avoid catching perpendicular walls.\n  // eps: small offset from the actual edge to ensure we stay within the intended tile/boundary.\n  const inset = 1.0; \n  const eps = 0.1;\n  \n  const points = [\n    // Vertical checks (Top/Bottom)\n    { x: newX + inset, y: newY + eps }, \n    { x: newX + width - inset, y: newY + eps },\n    { x: newX + width / 2, y: newY + eps },\n    \n    { x: newX + inset, y: newY + height - eps },\n    { x: newX + width - inset, y: newY + height - eps },\n    { x: newX + width / 2, y: newY + height - eps },\n\n    // Horizontal checks (Left/Right)\n    { x: newX + eps, y: newY + inset },\n    { x: newX + eps, y: newY + height - inset },\n    { x: newX + eps, y: newY + height / 2 },\n\n    { x: newX + width - eps, y: newY + inset },\n    { x: newX + width - eps, y: newY + height - inset },\n    { x: newX + width - eps, y: newY + height / 2 }\n  ];\n\n  for (let p of points) {\n    const gx = Math.floor(p.x / TILE_SIZE);\n    const gy = Math.floor(p.y / TILE_SIZE);\n    \n    // Boundary checks: block left, right, and top edges of the world.\n    // Allow falling off the bottom (gy >= mapHeightTiles).\n    if (gx < 0 || gx >= mapWidthTiles || gy < 0) return true;\n\n    if (isSolidAtPixel(p.x, p.y, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Gets physical properties of the surface below the player (friction, acceleration)\n */\nexport function getSurfaceProperties(x, y, width, height, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectMetadata, maps, activeRoomIds) {\n  const cx = x + width / 2;\n  const feetY = y + height + 1; // 1 pixel below feet\n\n  // Check for active rooms (sub-maps) - Priority check\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n    for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidthTiles) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (cx >= rx && cx < rx + rw && feetY >= ry && feetY < ry + rh + 2) {\n          // Point is inside an active room!\n          const localCx = cx - rx;\n          const localFeetY = feetY - ry;\n          \n          const roomTileW = roomMap.mapWidth || roomMap.width;\n          const roomTileH = roomMap.mapHeight || roomMap.height;\n          \n          return getSurfaceProperties(\n            localCx - width/2, localFeetY - height - 1, width, height,\n            roomTileW, roomTileH, TILE_SIZE,\n            roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data),\n            registryItems,\n            roomMap.secretMapData,\n            roomMap.objectMetadata,\n            null,\n            null\n          );\n        }\n      }\n    }\n  }\n\n  const gx = Math.floor(cx / TILE_SIZE);\n  const gy = Math.floor(feetY / TILE_SIZE);\n  \n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n    return { friction: 0.8, acceleration: 0.2 };\n  }\n  \n  const index = gy * mapWidthTiles + gx;\n  const tileId = tileData ? tileData[index] : null;\n  if (!tileId) return { friction: 0.8, acceleration: 0.2 };\n  \n    const tileDef = getDefById(registryItems, tileId);\n  if (!tileDef) return { friction: 0.8, acceleration: 0.2 };\n  \n  // If block has slipperiness, use it. Default friction is 0.8.\n  const slipperiness = tileDef.slipperiness !== undefined ? tileDef.slipperiness : 0.8;\n  \n  return {\n    friction: slipperiness,\n    // When slippery, acceleration is lower (harder to start/change direction)\n    acceleration: tileDef.slipperiness !== undefined ? (1 - slipperiness) * 2 + 0.05 : 0.2\n  };\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n  getSurfaceProperties\n};\n","import weatherDamageConfig from '../../assets/json/system/weather_damage.json';\n\nconst clampIntensity = (v) => {\n  const n = Number(v) || 0;\n  return Math.max(0, Math.min(100, n));\n};\n\nconst getWeatherConfig = (type) => {\n  return weatherDamageConfig?.weather?.[type] || null;\n};\n\nexport const getMapWeather = (mapData) => {\n  if (!mapData) return {};\n  let base = {};\n  if (mapData.weather) base = mapData.weather;\n  else {\n    const metaWeather = mapData.meta?.weather;\n    if (metaWeather && Object.keys(metaWeather).length > 0) {\n      base = metaWeather;\n    } else {\n      const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap;\n      if (activeId && mapData.maps && mapData.maps[activeId] && mapData.maps[activeId].weather) {\n        base = mapData.maps[activeId].weather;\n      } else {\n        base = mapData.meta?.weather || {};\n      }\n    }\n  }\n  let runtime = {};\n  try {\n    const rt = window.__GAME_RUNTIME_SETTINGS__ || {};\n    runtime = {\n      rain: rt.weatherRain,\n      snow: rt.weatherSnow,\n      clouds: rt.weatherClouds,\n      fog: rt.weatherFog,\n      thunder: rt.weatherThunder,\n      lavaRain: rt.weatherLavaRain,\n      radioactiveFog: rt.weatherRadioactiveFog,\n      meteorRain: rt.weatherMeteorRain\n    };\n  } catch {}\n  const merged = { ...base };\n  Object.keys(runtime).forEach(key => {\n    if (runtime[key] !== undefined && runtime[key] !== null) {\n      merged[key] = runtime[key];\n    }\n  });\n  return merged;\n};\n\nexport const getWeatherDps = (type, intensity) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return 0;\n  const pct = clampIntensity(intensity);\n  if (pct <= 0) return 0;\n  const maxDps = Number(cfg.maxDps) || 0;\n  const minDps = Number(cfg.minDps) || 0;\n  const dps = (pct / 100) * maxDps;\n  return Math.max(minDps, dps);\n};\n\nexport const getRadioactivityRates = () => {\n  const cfg = getWeatherConfig('radioactiveFog') || {};\n  const inc = Number(cfg.radioactivityPerSecond);\n  const dec = Number(cfg.radioactivityRegenPerSecond);\n  return {\n    increase: Number.isFinite(inc) ? inc : 0,\n    decay: Number.isFinite(dec) ? dec : 0\n  };\n};\n\nexport const weatherAffectsPlayer = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  return !!cfg.affects?.player;\n};\n\nexport const weatherAffectsEnemy = (type, enemyId, enemyName) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  const enemies = cfg.affects?.enemies;\n  if (enemies === 'true') return true;\n  if (enemies === true || enemies === 'all') return true;\n  if (enemies && typeof enemies === 'object' && enemies.mode === 'all') {\n    const excluded = Array.isArray(enemies.exclude) ? enemies.exclude : [];\n    const isExcluded = (value) => value && excluded.some(ex => value === ex || value.includes(ex));\n    if (isExcluded(enemyId)) return false;\n    if (isExcluded(enemyName)) return false;\n    return true;\n  }\n  if (Array.isArray(enemies)) {\n    if (enemyId && enemies.some(ex => enemyId === ex || enemyId.includes(ex))) return true;\n    if (enemyName && enemies.some(ex => enemyName === ex || enemyName.includes(ex))) return true;\n    return false;\n  }\n  return false;\n};\n\nexport const weatherBlockedByCover = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg) return false;\n  return !!cfg.blockedByCover;\n};\n","import { isSolidAtPixel } from '../physics/collision';\n\nconst isInsideActiveRoom = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  secretData,\n  objectMetadata,\n  activeRoomIds\n}) => {\n  if (!activeRoomIds || !activeRoomIds.length) return false;\n  if (!secretData || !objectMetadata) return false;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false;\n  for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n    const idx = parseInt(idxStr, 10);\n    if (secretData[idx] !== 'room_area') continue;\n    if (!meta?.linkedMapId || !activeRoomIds.includes(meta.linkedMapId)) continue;\n    const rx = idx % mapWidth;\n    const ry = Math.floor(idx / mapWidth);\n    const rw = meta.width || 1;\n    const rh = meta.height || 1;\n    if (gx >= rx && gx < rx + rw && gy >= ry && gy < ry + rh) return true;\n  }\n  return false;\n};\n\nexport const isCoveredFromAbove = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  tileData,\n  registryItems,\n  secretData,\n  objectData,\n  objectMetadata,\n  maps,\n  activeRoomIds\n}) => {\n  if (!Number.isFinite(x) || !Number.isFinite(y)) return false;\n  if (isInsideActiveRoom({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectMetadata, activeRoomIds })) {\n    return true;\n  }\n  const gridX = Math.floor(x / TILE_SIZE);\n  if (gridX < 0 || gridX >= mapWidth) return false;\n  let gridY = Math.floor(y / TILE_SIZE) - 1;\n  for (; gridY >= 0; gridY--) {\n    const wx = gridX * TILE_SIZE + TILE_SIZE / 2;\n    const wy = gridY * TILE_SIZE + TILE_SIZE / 2;\n    if (isSolidAtPixel(wx, wy, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, null, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n};\n","import { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { isSolidAtPixel } from '../physics';\nimport { getWeatherDps, getMapWeather, weatherAffectsEnemy, weatherBlockedByCover } from './weatherDamage';\nimport { isCoveredFromAbove } from './weatherCover';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nconst getTileLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.tileMapData)) return mapData.tileMapData;\n  const layer = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile');\n  return layer?.data || [];\n};\n\nconst getSecretLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.secretMapData)) return mapData.secretMapData;\n  const layer = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret');\n  return layer?.data || [];\n};\n\nconst liquidTypeToHabitat = (liquidType) => {\n  if (!liquidType) return 'none';\n  if (liquidType.includes('radioactive')) return 'radioactive';\n  if (liquidType.includes('lava')) return 'lava';\n  if (liquidType.includes('quicksand')) return 'quicksand';\n  if (liquidType.includes('water')) return 'water';\n  return 'none';\n};\n\nconst isFishEntity = (ent) => {\n  if (!ent) return false;\n  const def = ent.def || {};\n  return ent.subtype === 'fish' || def.subtype === 'fish' || def.ai?.type === 'fish' || !!def.fish;\n};\n\nconst getFishTriggerAt = ({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectData, registryItems }) => {\n  if (!registryItems) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return null;\n  const idx = gy * mapWidth + gx;\n  const secretId = secretData ? secretData[idx] : null;\n  const objectId = objectData ? objectData[idx] : null;\n  const def = getDefById(registryItems, secretId) || getDefById(registryItems, objectId);\n  if (!def) return null;\n  if (def.type === 'secret' && def.subtype === 'animal_trigger' && def.triggerType === 'fish') return def;\n  return null;\n};\n\nconst getWaterSurfaceY = ({ x, mapWidth, mapHeight, tileData, registryItems, TILE_SIZE }) => {\n  if (!tileData || mapWidth <= 0 || mapHeight <= 0) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  if (gx < 0 || gx >= mapWidth) return null;\n  for (let gy = 0; gy < mapHeight; gy++) {\n    const idx = gy * mapWidth + gx;\n    const id = tileData[idx];\n    if (!id) continue;\n    const def = getDefById(registryItems, id);\n    if (!def || !def.flags || !def.flags.liquid) continue;\n    if (def.flags.water || def.flags.waterfall) {\n      return gy * TILE_SIZE;\n    }\n  }\n  return null;\n};\n\n/**\n * Atjaunina visas aktvs enttijas (piemram, tankus).\n * @param {Object} ctx Konteksts ar nepiecieamajiem datiem un funkcijm\n * @param {number} deltaMs Laiks kop pdj kadra\n */\nexport function updateEntities(ctx, deltaMs) {\n  const {\n    entitiesRef,\n    gameState,\n    mapWidth,\n    mapHeight,\n    TILE_SIZE,\n    checkCollision,\n    isLiquidAt,\n    getLiquidSample,\n    spawnProjectile,\n    playSfx,\n    constants,\n    objectData,\n    mapData,\n    registryItems,\n    onStateUpdate,\n    activeRoomIds\n  } = ctx;\n\n  if (!entitiesRef.current || entitiesRef.current.length === 0) return;\n\n  const { GRAVITY, TERMINAL_VELOCITY } = constants;\n  const playerX = gameState.current.x;\n  const playerY = gameState.current.y;\n  const weatherNow = getMapWeather(mapData);\n  const lavaRainInt = Number(weatherNow.lavaRain || 0);\n  const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n\n  // Ms modificjam enttijas pa tieo ref\n  const entities = entitiesRef.current;\n  for (let i = entities.length - 1; i >= 0; i--) {\n    const entity = entities[i];\n    const def = entity.def || {};\n    const isFish = def?.subtype === 'fish' || def?.ai?.type === 'fish' || !!def?.fish;\n    // 1. Ja enttija ir mirusi, apstrdjam sprdzienu vai noemanu\n    if (entity.health <= 0 && !isFish) {\n      if (!entity.isExploding) {\n        entity.isExploding = true;\n        entity.animation = 'explode';\n        entity.animFrame = 0;\n        entity.animTimer = 0;\n        entity.vx = 0; // Apstjamies sprdziena laik\n        entity.vy = 0;\n        entity.isGrounded = true; // Sprgst uz zemes\n      }\n      \n      const explodeAnim = def.spriteSheet?.animations?.explode || [];\n      const totalFrames = explodeAnim.length;\n      const frameDuration = 100; // ms uz kadru\n      \n      entity.animTimer += deltaMs;\n      if (entity.animTimer >= frameDuration) {\n        entity.animTimer = 0;\n        entity.animFrame++;\n        if (entity.animFrame >= totalFrames) {\n          entity.shouldRemove = true;\n        }\n      }\n      if (entity.shouldRemove) {\n        entities.splice(i, 1);\n      }\n      continue;\n    }\n\n    // 1.2. Liquid damage (e.g. lava, radioactive water)\n    const liquidSample = getLiquidSample ? getLiquidSample({\n      x: entity.x,\n      y: entity.y,\n      width: entity.width,\n      height: entity.height,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight\n    }) : { inLiquid: false };\n\n    if (isFish) {\n      const cfg = def.fish || {};\n      const activeRadiusPx = (Number(cfg.activeRadius) || 18) * TILE_SIZE;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      const dxView = (playerX + gameState.current.width / 2) - ex;\n      const dyView = (playerY + gameState.current.height / 2) - ey;\n      const distView = Math.sqrt(dxView * dxView + dyView * dyView);\n      const isActive = distView <= activeRadiusPx;\n\n      if (!isActive && entity.health > 0) {\n        entity.isDormant = true;\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.animation = 'idle';\n        const idleAnim = def.spriteSheet?.animations?.idle || [0];\n        entity.currentSpriteIndex = idleAnim[0] || 0;\n        continue;\n      }\n      entity.isDormant = false;\n    }\n\n    if (liquidSample.inLiquid && liquidSample.params && liquidSample.params.dps > 0) {\n      entity.liquidDamageAcc = (entity.liquidDamageAcc || 0) + deltaMs;\n      while (entity.liquidDamageAcc >= 1000) {\n        entity.liquidDamageAcc -= 1000;\n        const dmg = liquidSample.params.dps;\n        entity.health = Math.max(0, entity.health - dmg);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: dmg\n          });\n        }\n      }\n    } else {\n      entity.liquidDamageAcc = 0;\n    }\n\n    // 1.3. Weather damage (Lava Rain, Radioactive Fog)\n    const enemyId = entity.defId || def?.id;\n    const enemyName = def?.name;\n    let lavaDps = weatherAffectsEnemy('lavaRain', enemyId, enemyName) ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    if (lavaDps > 0 && liquidSample.inLiquid && liquidSample.type && liquidSample.type.includes('water')) {\n      lavaDps = 0;\n    }\n    const radioDps = weatherAffectsEnemy('radioactiveFog', enemyId, enemyName) ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data || [];\n        const secretData = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n        const objectMetadata = mapData.meta?.objectMetadata || {};\n        const covered = isCoveredFromAbove({\n          x: entity.x + entity.width / 2,\n          y: entity.y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIds || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const totalWeatherDps = lavaDps + radioDps;\n\n    if (totalWeatherDps > 0) {\n      entity.weatherDamageAcc = (entity.weatherDamageAcc || 0) + deltaMs;\n      if (entity.weatherDamageAcc >= 1000) {\n        entity.weatherDamageAcc -= 1000;\n        entity.health = Math.max(0, entity.health - totalWeatherDps);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: totalWeatherDps\n          });\n        }\n      }\n    } else {\n      entity.weatherDamageAcc = 0;\n    }\n\n    if (isFish) {\n      const cfg = def.fish || {};\n      const habitat = cfg.habitat || {};\n      const now = Number(gameState.current.timeMs) || 0;\n      const dt = Math.max(0, Number(deltaMs) || 0) / 1000;\n      const liquidType = liquidSample?.type || null;\n      const habitatKey = liquidTypeToHabitat(liquidType);\n      const isAllowed = !!(liquidSample?.inLiquid && habitatKey && habitat[habitatKey] !== false);\n      const requireLiquid = cfg.requireLiquid !== false;\n      const inWaterNow = !!(liquidSample?.inLiquid && habitatKey === 'water');\n\n      entity.fishState = entity.fishState || {};\n      const fs = entity.fishState;\n\n      if (!fs.initialized) {\n        fs.initialized = true;\n        entity.direction = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.animFrame = 0;\n        fs.animTimer = 0;\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health > 0) {\n        const prevInWater = !!fs.prevInWater;\n        if (prevInWater && !inWaterNow && def.sounds?.water_out) {\n          playSfx(def.sounds.water_out, 0.35);\n        } else if (!prevInWater && inWaterNow && def.sounds?.water_in) {\n          playSfx(def.sounds.water_in, 0.35);\n        }\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health <= 0) {\n        const player = gameState.current;\n        const hit = (\n          player.x < entity.x + entity.width &&\n          player.x + player.width > entity.x &&\n          player.y < entity.y + entity.height &&\n          player.y + player.height > entity.y\n        );\n        if (hit) {\n          gameState.current.fishCount = Math.max(0, (Number(gameState.current.fishCount) || 0) + 1);\n          entities.splice(i, 1);\n          continue;\n        }\n        if (entity.fishState?.removeOnNext) {\n          entities.splice(i, 1);\n          continue;\n        }\n        const tileData = getTileLayerData(mapData);\n        const secretData = getSecretLayerData(mapData);\n        const objectMetadata = mapData?.meta?.objectMetadata;\n        const cx = entity.x + entity.width / 2;\n        const headY = entity.y + Math.min(4, entity.height * 0.125);\n        const chestY = entity.y + entity.height * 0.45;\n        const feetY = entity.y + entity.height - 2;\n        const solidAtSample = isSolidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds);\n        const canFloat = !!(liquidSample?.inLiquid && liquidSample?.type && liquidSample.type.includes('water') && !solidAtSample);\n        if (canFloat) {\n          const surfaceY = getWaterSurfaceY({\n            x: entity.x + entity.width / 2,\n            mapWidth,\n            mapHeight,\n            tileData,\n            registryItems,\n            TILE_SIZE\n          });\n          const surfaceOffset = Number.isFinite(cfg.deathSurfaceOffset) ? cfg.deathSurfaceOffset : 0.5;\n          if (Number.isFinite(surfaceY)) {\n            const targetY = surfaceY - entity.height * surfaceOffset;\n            const floatSpeed = (Number(cfg.deathFloatSpeed) || 0.25) * TILE_SIZE;\n            if (entity.y > targetY) {\n              entity.y = Math.max(targetY, entity.y - floatSpeed * dt);\n            } else {\n              entity.y = targetY;\n            }\n          }\n        }\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.isGrounded = canFloat ? false : checkCollision(entity.x, entity.y + 1, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n        entity.flipY = true;\n        entity.animation = 'dead';\n        const deadAnim = def.spriteSheet?.animations?.dead || [];\n        entity.currentSpriteIndex = deadAnim.length ? deadAnim[0] : (cfg.meteorShockFrame || 2);\n        continue;\n      }\n\n      entity.flipY = false;\n      entity.alpha = 1;\n\n      if (requireLiquid && !isAllowed && !fs.isJumping) {\n        entities.splice(i, 1);\n        continue;\n      }\n\n      const panicRadiusPx = (Number(cfg.panicRadius) || 6) * TILE_SIZE;\n      const panicSpeed = (Number(cfg.panicSpeed) || 2.2) * TILE_SIZE;\n      const baseSpeed = (Number(cfg.swimSpeed) || 0.6) * TILE_SIZE;\n      const verticalDrift = (Number(cfg.verticalDrift) || 0.25) * TILE_SIZE;\n      const isWaterfall = !!(liquidType && liquidType.includes('waterfall'));\n      const waterfallDriftMultiplier = Number.isFinite(cfg.waterfallDriftMultiplier) ? cfg.waterfallDriftMultiplier : 0.4;\n      const waterfallSpeedMultiplier = Number.isFinite(cfg.waterfallSpeedMultiplier) ? cfg.waterfallSpeedMultiplier : 0.7;\n\n      const triggerDef = getFishTriggerAt({\n        x: entity.x + entity.width / 2,\n        y: entity.y + entity.height / 2,\n        mapWidth,\n        mapHeight,\n        TILE_SIZE,\n        secretData: getSecretLayerData(mapData),\n        objectData,\n        registryItems\n      });\n      const triggerCfg = triggerDef?.fishTrigger || {};\n      const fishJumpCfg = cfg.jump || {};\n      const mergedJumpCfg = { ...triggerCfg, ...fishJumpCfg };\n      const nowMs = Number(gameState.current.timeMs) || 0;\n      const nextJumpAt = Number(fs.nextJumpAt) || 0;\n      const canJump = !fs.isJumping && nowMs >= nextJumpAt && triggerDef && liquidSample?.inLiquid && liquidTypeToHabitat(liquidType) === 'water';\n\n      if (canJump) {\n        const chance = Math.max(0, Math.min(1, Number(mergedJumpCfg.chance ?? 1)));\n        if (Math.random() <= chance) {\n          const jumpDir = Math.random() < 0.5 ? -1 : 1;\n          entity.direction = jumpDir;\n          fs.isJumping = true;\n          fs.jumpVx = (Number(mergedJumpCfg.speedX) || 3.5) * TILE_SIZE * jumpDir;\n          fs.jumpVy = -(Number(mergedJumpCfg.speedY) || 6) * TILE_SIZE;\n          fs.jumpGravity = (Number(mergedJumpCfg.gravity) || 18) * TILE_SIZE;\n          fs.jumpBounce = Number.isFinite(mergedJumpCfg.bounce) ? Number(mergedJumpCfg.bounce) : 0.35;\n          fs.nextJumpAt = nowMs + (Number(mergedJumpCfg.cooldownMs) || 1400);\n        }\n      }\n\n      if (fs.isJumping) {\n        const dtSec = Math.max(0, Number(deltaMs) || 0) / 1000;\n        fs.jumpVy = (Number(fs.jumpVy) || 0) + (Number(fs.jumpGravity) || (GRAVITY * 60)) * dtSec;\n        let nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        let nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n\n        if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          fs.jumpVx = -(Number(fs.jumpVx) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        }\n\n        if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          if ((Number(fs.jumpVy) || 0) > 0) {\n            entity.health = 0;\n            fs.isJumping = false;\n            entity.vx = 0;\n            entity.vy = 0;\n            entity.isGrounded = true;\n            entity.x = nextX;\n            entity.y = Math.floor((nextY + entity.height - 0.1) / TILE_SIZE) * TILE_SIZE - entity.height;\n            continue;\n          }\n          fs.jumpVy = Math.abs(Number(fs.jumpVy) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n        }\n\n        const landingSample = getLiquidSample ? getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        }) : { inLiquid: false };\n\n        if (landingSample?.inLiquid && liquidTypeToHabitat(landingSample?.type) === 'water' && (Number(fs.jumpVy) || 0) > 0) {\n          fs.isJumping = false;\n          entity.vx = 0;\n          entity.vy = 0;\n        } else {\n          entity.vx = Number(fs.jumpVx) || 0;\n          entity.vy = Number(fs.jumpVy) || 0;\n        }\n\n        entity.x = nextX;\n        entity.y = nextY;\n        entity.isGrounded = false;\n        continue;\n      }\n\n      const px = playerX + gameState.current.width / 2;\n      const py = playerY + gameState.current.height / 2;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      const dx = px - ex;\n      const dy = py - ey;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (fs.shockUntil && fs.shockUntil > now) {\n        const shockFrame = Number(cfg.meteorShockFrame) || 2;\n        entity.animation = 'shock';\n        entity.currentSpriteIndex = shockFrame;\n      }\n\n      const lastWaterEnter = gameState.current.lastWaterEnter;\n      if (lastWaterEnter && Number(lastWaterEnter.time) && now - Number(lastWaterEnter.time) < 1200) {\n        const waveRadiusPx = (Number(cfg.playerWaveRadius) || 10) * TILE_SIZE;\n        if (dist <= waveRadiusPx) {\n          fs.waveImpulse = Number(cfg.playerWaveImpulse) || 0.35;\n          fs.waveUntil = now + 400;\n        }\n        if (dist <= panicRadiusPx) {\n          fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n        }\n      }\n      if (gameState.current.inWater && dist <= panicRadiusPx) {\n        fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n      }\n\n      const isPanicking = fs.panicUntil && fs.panicUntil > now;\n      let dir = entity.direction || 1;\n      if (isPanicking) {\n        dir = dx >= 0 ? -1 : 1;\n      } else if (now >= (fs.nextTurnAt || 0)) {\n        dir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n      }\n      entity.direction = dir;\n\n      if (now >= (fs.nextVerticalAt || 0)) {\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n      }\n\n      let vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n      let vy = (fs.verticalDir || 1) * verticalDrift;\n      if (isWaterfall) {\n        vx *= waterfallSpeedMultiplier;\n        vy *= waterfallDriftMultiplier;\n        const downSpeed = (Number(cfg.waterfallDownSpeed) || 2.4) * TILE_SIZE;\n        vy = Math.max(Math.abs(vy), downSpeed);\n        entity.alpha = Number.isFinite(cfg.waterfallAlpha) ? cfg.waterfallAlpha : 1;\n      }\n\n      if (fs.waveUntil && fs.waveUntil > now) {\n        const impulse = Math.max(0, Number(fs.waveImpulse) || 0.35) * TILE_SIZE;\n        vx += (Math.random() - 0.5) * impulse;\n        vy += (Math.random() - 0.5) * impulse * 0.5;\n      }\n\n      let nextX = entity.x + vx * dt;\n      let nextY = entity.y + vy * dt;\n\n      if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        dir *= -1;\n        entity.direction = dir;\n        vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n        nextX = entity.x + vx * dt;\n      }\n\n      if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        fs.verticalDir *= -1;\n        vy = fs.verticalDir * verticalDrift;\n        nextY = entity.y + vy * dt;\n      }\n\n      if (typeof getLiquidSample === 'function') {\n        const sampleNext = getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        });\n        const nextType = liquidTypeToHabitat(sampleNext?.type);\n        const nextAllowed = !!(sampleNext?.inLiquid && nextType && habitat[nextType] !== false);\n        if (!nextAllowed) {\n          fs.verticalDir *= -1;\n          dir *= -1;\n          entity.direction = dir;\n          vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n          vy = fs.verticalDir * verticalDrift;\n          nextX = entity.x + vx * dt;\n          nextY = entity.y + vy * dt;\n        }\n      }\n\n      if (entitiesRef?.current?.length) {\n        const cx = nextX + entity.width / 2;\n        const cy = nextY + entity.height / 2;\n        const gx = Math.floor(cx / TILE_SIZE);\n        const gy = Math.floor(cy / TILE_SIZE);\n        for (const other of entitiesRef.current) {\n          if (other.id === entity.id) continue;\n          if (!isFishEntity(other) || other.health <= 0) continue;\n          const ocx = other.x + other.width / 2;\n          const ocy = other.y + other.height / 2;\n          if (Math.floor(ocx / TILE_SIZE) !== gx || Math.floor(ocy / TILE_SIZE) !== gy) continue;\n          const dir = String(entity.id) < String(other.id) ? -1 : 1;\n          const nudge = dir * TILE_SIZE * 0.25;\n          const tryX = nextX + nudge;\n          if (!checkCollision(tryX, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextX = tryX;\n            entity.direction = dir;\n            break;\n          }\n          const tryY = nextY + nudge;\n          if (!checkCollision(nextX, tryY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextY = tryY;\n            break;\n          }\n        }\n      }\n\n      entity.x = nextX;\n      entity.y = nextY;\n      entity.vx = vx;\n      entity.vy = vy;\n      entity.isGrounded = false;\n\n      const anims = def.spriteSheet?.animations || {};\n      let animKey = 'swim';\n      if (isPanicking && anims.panic) animKey = 'panic';\n      if (Math.abs(vx) < 0.02 && anims.idle) animKey = 'idle';\n\n      if (!(fs.shockUntil && fs.shockUntil > now)) {\n        const currentAnim = anims[animKey] || anims.swim || anims.idle || [0];\n        fs.animTimer = (fs.animTimer || 0) + deltaMs;\n        const frameDur = 180;\n        if (fs.animTimer >= frameDur) {\n          fs.animTimer = 0;\n          fs.animFrame = (fs.animFrame || 0) + 1;\n          if (fs.animFrame >= currentAnim.length) fs.animFrame = 0;\n        }\n        entity.currentSpriteIndex = currentAnim[fs.animFrame % currentAnim.length];\n      }\n\n      continue;\n    }\n\n    // 1.5. Pushable objektu (Akmeu) fizika\n    if (entity.subtype === 'pushable' || def?.isPushable) {\n      const inLiquid = liquidSample.inLiquid;\n      const liquidType = liquidSample.type;\n\n      // Skaas, ja iekrt idrum\n      if (inLiquid && !entity.prevInLiquid) {\n        if (liquidType === 'water' && def.sounds?.water_splash) {\n          playSfx(def.sounds.water_splash, 0.4);\n        } else if (liquidType === 'lava' && def.sounds?.lava_splash) {\n          playSfx(def.sounds.lava_splash, 0.4);\n        }\n      }\n      entity.prevInLiquid = inLiquid;\n\n        // Horizontl kustba ar berzi\n        const mh = moveHorizontal({\n          keys: {}, \n          state: { x: entity.x, y: entity.y, vx: entity.vx || 0, width: entity.width, height: entity.height, direction: entity.direction },\n          MOVE_SPEED: 6.0, // Palielints max trums akmeiem (Supaplex stil)\n          TILE_SIZE,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) return true;\n            \n            // Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            return (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n          },\n          friction: inLiquid ? 0.7 : 0.85,\n          acceleration: 0.2\n        });\n        entity.x = mh.x;\n        entity.vx = mh.vx;\n        entity.direction = mh.direction;\n\n      // Vertikl fizika\n      if (inLiquid && liquidType === 'lava') {\n        // Lna slkana lav\n        const sinkingSpeed = def.sinkingSpeed || 0.2;\n        entity.vy = sinkingSpeed;\n        entity.y += entity.vy;\n        entity.isGrounded = false;\n        \n        // Prbaudm vai neesam izgjui cauri zemei lav\n        if (checkCollision(entity.x, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n           // Atstumjam atpaka, ja atduras pret dibenu\n           entity.y -= entity.vy;\n           entity.vy = 0;\n           entity.isGrounded = true;\n        }\n      } else {\n        // Fall distance tracking: if falling, accumulate distance\n        if (entity.isGrounded) {\n          entity.fallDistance = 0;\n        } else if ((entity.vy || 0) > 0) {\n          entity.fallDistance = (entity.fallDistance || 0) + (entity.vy || 0);\n        }\n\n        // Standarta gravitcija (den lnka)\n        const vp = applyVerticalPhysics({\n          keys: {}, \n          x: entity.x,\n          y: entity.y,\n          vy: entity.vy || 0,\n          isGrounded: entity.isGrounded,\n          animation: 'idle',\n          GRAVITY: inLiquid ? GRAVITY * 0.3 : GRAVITY,\n          TERMINAL_VELOCITY,\n          JUMP_FORCE: 0,\n          TILE_SIZE,\n          width: entity.width,\n          height: entity.height,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // 1. Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) {\n              // Ja ms kaut kam uzkrtam un esam kritui pietiekami ilgi\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                // Atrodam kuru enttiju ms aizskrm (lai nogalintu ienaidniekus)\n                if (entitiesRef.current) {\n                  for (const other of entitiesRef.current) {\n                    if (other.id === entity.id || other.health <= 0 || other.subtype === 'platform' || other.subtype === 'pushable') continue;\n                    \n                    const hitOther = (\n                      nx < other.x + other.width &&\n                      nx + (w || entity.width) > other.x &&\n                      ny < other.y + other.height &&\n                      ny + (h || entity.height) > other.y\n                    );\n                    \n                    if (hitOther) {\n                      other.health = 0; // Nogalinm ienaidnieku\n                      // Vartu atskaot skau, ja tda definta\n                      if (def.sounds?.kill_enemy) {\n                        playSfx(def.sounds.kill_enemy, 0.5);\n                      }\n                    }\n                  }\n                }\n              }\n              return true;\n            }\n            \n            // 2. Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            const hitPlayer = (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n            \n            if (hitPlayer) {\n              // Ja akmens uzkrt spltjam pc brva kritiena (vismaz 1 tuks bloks)\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                gameState.current.health = 0; // Fatal impact\n              }\n              return true;\n            }\n            \n            return false;\n          },\n          isLiquidAt,\n          vx: entity.vx\n        });\n        entity.y = vp.y;\n        entity.vy = vp.vy;\n        entity.isGrounded = vp.isGrounded;\n\n        // --- ROLLING LOGIC (Supaplex style) ---\n        // Akmei ripo lej no citiem apaiem objektiem vai pakpieniem, ja ir brva vieta sn un pa diagonli\n        if (entity.isGrounded && Math.abs(entity.vx) < 0.1 && def.isRound) {\n          const checkEmpty = (tx, ty) => !checkCollision(tx, ty, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n          \n          // Minm ripot pa KREISI\n          const leftX = entity.x - TILE_SIZE;\n          // canRollLeft: vai flze pa kreisi ir brva UN vai flze pa kreisi uz leju ir brva (tukums/pakpiens)\n          const canRollLeft = checkEmpty(leftX, entity.y) && checkEmpty(leftX, entity.y + TILE_SIZE);\n          \n          if (canRollLeft) {\n            // Ripojam pa kreisi. Palielints trums (6.0), lai \"veas\" trk\n            entity.vx = -6.0; \n          } else {\n            // Minm ripot pa LABI\n            const rightX = entity.x + TILE_SIZE;\n            const canRollRight = checkEmpty(rightX, entity.y) && checkEmpty(rightX, entity.y + TILE_SIZE);\n            if (canRollRight) {\n              entity.vx = 6.0;\n            }\n          }\n        }\n\n        // Atjaunojam rotciju, ja akmens veas (horizontal movement while grounded)\n      if (entity.isGrounded && Math.abs(entity.vx) > 0.1 && def.isRound) {\n        // Rotcija proporcionla trumam (0.07 rad/px * vx)\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.07);\n        if (def.sounds?.roll) {\n          const nowMs = Number(gameState.current.timeMs) || 0;\n          const lastAt = Number(entity.lastRollSfxAt) || 0;\n          if (!lastAt || nowMs - lastAt >= 450) {\n            playSfx(def.sounds.roll, 0.35);\n            entity.lastRollSfxAt = nowMs;\n          }\n        }\n      } else if (!entity.isGrounded && def.isRound) {\n        // Ar krtot var nedaudz rott, ja ir bijis horizontls trums\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.03);\n      }\n      }\n\n      // Animcija akmenim parasti ir statiska\n      entity.animation = 'idle';\n      entity.currentSpriteIndex = def.spriteSheet?.animations?.idle?.[0] || 0;\n\n      continue;\n    }\n\n    // Platformu loika\n    if (entity.subtype === 'platform') {\n      const speed = def.speed || 1.5;\n      const mapW = mapWidth;\n      const mapH = mapHeight;\n      \n      // Mekljam bultias vairkos punktos (centr un mals), lai nepalaistu garm\n      const points = [\n        { x: entity.x + entity.width / 2, y: entity.y + entity.height / 2 }, // Centrs\n        { x: entity.x + 5, y: entity.y + entity.height / 2 },                // Kreis mala\n        { x: entity.x + entity.width - 5, y: entity.y + entity.height / 2 }  // Lab mala\n      ];\n      \n      let arrowId = null;\n      let foundArrowDef = null;\n\n      for (const p of points) {\n        const tx = Math.floor(p.x / TILE_SIZE);\n        const ty = Math.floor(p.y / TILE_SIZE);\n        \n        if (tx < 0 || tx >= mapW || ty < 0 || ty >= mapH) continue;\n        const idx = ty * mapW + tx;\n\n        // 1. Specilais arrows slnis\n        const arrowsLayer = ctx.mapData?.layers?.find(l => l.name === 'arrows' || l.name === 'Arrows')?.data;\n        let id = arrowsLayer ? arrowsLayer[idx] : null;\n        \n        // 2. Objektu slnis\n        if (!id && ctx.objectData) {\n          id = ctx.objectData[idx];\n        }\n\n        if (id) {\n          const aDef = getDefById(ctx.registryItems, id);\n          if (aDef && aDef.subtype === 'arrow') {\n            arrowId = id;\n            foundArrowDef = aDef;\n            break; \n          }\n        }\n      }\n      \n      if (foundArrowDef) {\n        // Mainm kustbas virzienu atbilstoi bultiai\n        if (foundArrowDef.direction === 'up') { entity.vx = 0; entity.vy = -speed; }\n        else if (foundArrowDef.direction === 'down') { entity.vx = 0; entity.vy = speed; }\n        else if (foundArrowDef.direction === 'left') { entity.vx = -speed; entity.vy = 0; }\n        else if (foundArrowDef.direction === 'right') { entity.vx = speed; entity.vy = 0; }\n      }\n\n      // Ja platforma vl nekustas, iedodam tai skuma impulsu\n      if (entity.vx === 0 && entity.vy === 0) {\n        entity.vx = speed;\n      }\n\n      // Kustba\n      let nextX = entity.x + entity.vx * (deltaMs / 16.6);\n      let nextY = entity.y + entity.vy * (deltaMs / 16.6);\n      \n      // Robeu prbaude (neaujam aizbraukt aiz kartes)\n      const worldW = mapWidth * TILE_SIZE;\n      const worldH = mapHeight * TILE_SIZE;\n      \n      if (nextX < 0) { \n        nextX = 0; \n        entity.vx = Math.abs(entity.vx); // Move Right\n      } else if (nextX + entity.width > worldW) { \n        nextX = worldW - entity.width; \n        entity.vx = -Math.abs(entity.vx); // Move Left\n      }\n      \n      if (nextY < 0) { \n        nextY = 0; \n        entity.vy = Math.abs(entity.vy); // Move Down\n      } else if (nextY + entity.height > worldH) { \n        nextY = worldH - entity.height; \n        entity.vy = -Math.abs(entity.vy); // Move Up\n      }\n      \n      entity.x = nextX;\n      entity.y = nextY;\n\n      // Spltja \"prveana\"\n      const player = gameState.current;\n      const onPlatform = (\n        player.x + player.width > entity.x &&\n        player.x < entity.x + entity.width &&\n        Math.abs((player.y + player.height) - entity.y) < 5 &&\n        player.vy >= 0\n      );\n\n      if (onPlatform) {\n        player.x += entity.vx * (deltaMs / 16.6);\n        player.y = entity.y - player.height;\n        player.vy = 0;\n        player.isGrounded = true;\n        \n        // Atjauninam animciju, lai nebtu \"fall\" uz platformas\n        if (Math.abs(player.vx) > 0.1) {\n          player.animation = 'run';\n        } else {\n          player.animation = 'idle';\n        }\n      }\n\n      continue;\n    }\n\n    const ai = def.ai || {};\n    const reactionDist = (ai.reactionDistance || 10) * TILE_SIZE;\n    const shootDist = (ai.shootDistance || 8) * TILE_SIZE;\n    const speed = def.speed || 1.2;\n\n    const dx = playerX - entity.x;\n    const dy = playerY - entity.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let keys = { a: false, d: false, w: false };\n\n    // 2. AI Uzvedba\n    if (dist < reactionDist) {\n      // Sekojam spltjam\n      if (dx > TILE_SIZE * 0.5) {\n          keys.d = true;\n          entity.direction = 1;\n      } else if (dx < -TILE_SIZE * 0.5) {\n          keys.a = true;\n          entity.direction = -1;\n      }\n\n      // Lkana, ja AI to atbalsta un priek ir rslis\n      if (ai.canJump && entity.isGrounded) {\n          const nextX = entity.x + entity.direction * 10;\n          if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n              keys.w = true;\n          }\n      }\n\n      // auana\n      if (dist < shootDist) {\n        if (entity.shootCooldown <= 0) {\n           const facingPlayer = (dx > 0 && entity.direction > 0) || (dx < 0 && entity.direction < 0);\n           // Tanks auj, ja skats uz spltju vai ja tas ir pietiekami tuvu\n           if (facingPlayer || dist < TILE_SIZE * 2) {\n             entity.isShooting = true;\n             entity.shootCooldown = ai.shootCooldown || 2000;\n             \n             // Izsaucam via izveidi\n             if (typeof spawnProjectile === 'function') {\n                // Novietojam viu rpus tanka korpusa (atkarb no virziena)\n                const spawnX = entity.x + (entity.width / 2) + (entity.direction * (entity.width / 2 + 10));\n                const spawnY = entity.y + (entity.height * 0.4); // Nedaudz augstk par centru (stobrs)\n                \n                spawnProjectile(\n                  spawnX, \n                  spawnY, \n                  entity.direction,\n                  entity.id\n                );\n             }\n           }\n        }\n      }\n    } else if (ai.patrol) {\n      // Patruanas rems\n      if (entity.direction > 0) keys.d = true;\n      else keys.a = true;\n\n    // Sienas un ru prbaude, lai grieztos atpaka\n    const nextX = entity.x + entity.direction * 10;\n    let hitSomething = checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height);\n\n    // Tanku specifisk kolzija (ar spltju un citiem tankiem)\n    if (!hitSomething && entity.subtype === 'tank') {\n      // 1. Prbaude ar spltju\n      const p = gameState.current;\n      if (nextX < p.x + p.width && nextX + entity.width > p.x && entity.y < p.y + p.height && entity.y + entity.height > p.y) {\n        hitSomething = true;\n      }\n\n      // 2. Prbaude ar citiem tankiem\n      if (!hitSomething) {\n        for (const other of entitiesRef.current) {\n          if (other === entity || other.health <= 0 || other.isExploding) continue;\n          if (other.subtype !== 'tank') continue;\n\n          if (nextX < other.x + other.width && nextX + entity.width > other.x && entity.y < other.y + other.height && entity.y + entity.height > other.y) {\n            hitSomething = true;\n            // Liekam ar otram tankam maint virzienu, ja tie brauc viens otram virs\n            if ((entity.direction > 0 && other.direction < 0) || (entity.direction < 0 && other.direction > 0)) {\n               other.direction *= -1;\n            }\n            break;\n          }\n        }\n      }\n    }\n\n    if (hitSomething) {\n      entity.direction *= -1;\n    }\n    \n    // Platformas malas prbaude\n      if (ai.stayOnPlatform && entity.isGrounded) {\n          const groundX = entity.x + (entity.direction > 0 ? entity.width : 0) + entity.direction * 5;\n          const groundY = entity.y + entity.height + 5;\n          if (!checkCollision(groundX, groundY, mapWidth, mapHeight, 2, 2)) {\n              entity.direction *= -1;\n          }\n      }\n    }\n\n    // Cooldown atjaunoana\n    if (entity.shootCooldown > 0) {\n      entity.shootCooldown -= deltaMs;\n      // Pc 300ms prtraucam auanas animciju\n      if (entity.shootCooldown < (ai.shootCooldown || 2000) - 300) {\n        entity.isShooting = false;\n      }\n    }\n\n    // 3. Fizika un kustba\n    const frameSpeed = speed * (deltaMs / 16.67);\n    \n    const checkEntityCollision = (nx, ny) => {\n        // Statisk pasaule\n        if (checkCollision(nx, ny, mapWidth, mapHeight, entity.width, entity.height)) return true;\n        \n        // Tankiem blojam ceu, ja priek ir spltjs vai cits tanks\n        if (entity.subtype === 'tank') {\n            const p = gameState.current;\n            if (nx < p.x + p.width && nx + entity.width > p.x && ny < p.y + p.height && ny + entity.height > p.y) return true;\n            \n            for (const other of entitiesRef.current) {\n                if (other === entity || other.health <= 0 || other.isExploding) continue;\n                if (other.subtype !== 'tank') continue;\n                if (nx < other.x + other.width && nx + entity.width > other.x && ny < other.y + other.height && ny + entity.height > other.y) return true;\n            }\n        }\n        return false;\n    };\n\n    const mh = moveHorizontal({\n      keys,\n      state: { \n        x: entity.x, \n        y: entity.y, \n        vx: entity.vx || 0,\n        width: entity.width, \n        direction: entity.direction \n      },\n      MOVE_SPEED: frameSpeed,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision\n    });\n    entity.x = mh.x;\n    entity.vx = mh.vx;\n    entity.direction = mh.direction;\n\n    const vp = applyVerticalPhysics({\n      keys,\n      x: entity.x,\n      y: entity.y,\n      vy: entity.vy,\n      isGrounded: entity.isGrounded,\n      animation: entity.animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE: ai.canJump ? 8 : 0,\n      TILE_SIZE,\n      width: entity.width,\n      height: entity.height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision,\n      isLiquidAt: ctx.isLiquidAt,\n      vx: entity.vx\n    });\n    entity.y = vp.y;\n    entity.vy = vp.vy;\n    entity.isGrounded = vp.isGrounded;\n\n    // 4. Animcijas stvoka noteikana\n    if (entity.isShooting) {\n      entity.animation = 'shoot';\n    } else if (entity.health <= (def.maxHealth || 100) * 0.5) {\n      entity.animation = 'move_damaged';\n    } else if (entity.vx === 0 && entity.isGrounded) {\n      entity.animation = 'idle';\n    } else {\n      entity.animation = 'move';\n    }\n\n    // Atjaunojam animcijas rmi, ja tas nav sprdziens\n    if (!entity.isExploding) {\n        const anims = def.spriteSheet?.animations || {};\n        let currentAnim = anims[entity.animation];\n        \n        // Rezerves varianti, ja specifisk animcija nav atrasta\n        if (!currentAnim || !Array.isArray(currentAnim) || currentAnim.length === 0) {\n            currentAnim = anims['move'] || anims['idle'] || [0];\n        }\n        \n        entity.animTimer = (entity.animTimer || 0) + deltaMs;\n        const frameDur = 100; // ms\n        if (entity.animTimer >= frameDur) {\n            entity.animTimer = 0;\n            entity.animFrame = (entity.animFrame || 0) + 1;\n            if (entity.animFrame >= currentAnim.length) {\n                entity.animFrame = 0;\n            }\n        }\n        entity.currentSpriteIndex = currentAnim[entity.animFrame % currentAnim.length];\n    } else {\n        const explodeAnim = def.spriteSheet?.animations?.explode || [39];\n        // Sprdziena animcija tiek vadta augstk (death sekcij)\n        entity.currentSpriteIndex = explodeAnim[Math.min(entity.animFrame, explodeAnim.length - 1)];\n    }\n\n    if (entity.shouldRemove) {\n      entities.splice(i, 1);\n    }\n  }\n}\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { resolveInteractableContext } from '../gameplay/interactables/context';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\nimport { updateEntities } from '../gameplay/entities';\nimport { getWeatherDps, getMapWeather, getRadioactivityRates, weatherAffectsPlayer, weatherBlockedByCover } from '../gameplay/weatherDamage';\nimport { isCoveredFromAbove } from '../gameplay/weatherCover';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isLiquidAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions,\n    registryItems\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isLiquidAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, playSfx, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const mapWidth = mapData.meta?.width || mapData.width || 20;\n  const mapHeight = mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo,\n    iceResist,\n    maxIceResist\n  } = gameState.current;\n\n  const dt = Math.max(0, deltaMs || 0);\n  const physicsDt = Math.min(dt, 100);\n\n  // 0.5) Resources update (before physics to affect them)\n  // Ice resistance depletion: drains while on slippery surface; regenerates otherwise\n  const layers = ctx.mapData.layers || [];\n  const backgroundLayer = layers.find(l => l.name === 'background')?.data || [];\n  const secretLayer = layers.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n  const objectMetadata = mapData.meta?.objectMetadata || {};\n  const surface = helpers.getSurfaceProperties ? helpers.getSurfaceProperties(x, y, width, height, mapWidth, mapHeight, TILE_SIZE, backgroundLayer, ctx.registryItems) : { friction: 0.8, acceleration: 0.2 };\n  \n  const isSlippery = surface.friction >= 0.9;\n  let currentIceRes = Number(iceResist);\n  const maxIce = Math.max(1, Number(maxIceResist || 100));\n  if (!Number.isFinite(currentIceRes)) currentIceRes = maxIce;\n\n  if (isSlippery) {\n    currentIceRes -= (20 * dt) / 1000;\n  } else {\n    currentIceRes += (35 * dt) / 1000;\n  }\n  currentIceRes = Math.max(0, Math.min(maxIce, currentIceRes));\n  gameState.current.iceResist = currentIceRes;\n\n  let effectiveFriction = surface.friction;\n  if (isSlippery && currentIceRes > 0) {\n      const ratio = currentIceRes / maxIce;\n      const targetFriction = 0.8;\n      effectiveFriction = surface.friction - (surface.friction - targetFriction) * ratio;\n  }\n\n  // 1) Horizontal movement\n  const checkCollisionExtended = (nx, ny, mw, mh, w, h) => {\n    return checkCollision(nx, ny, mw, mh, w, h);\n  };\n\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, vx, width, direction, height },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    friction: effectiveFriction,\n    acceleration: isSlippery ? (currentIceRes > 0 ? 0.15 : surface.acceleration) : surface.acceleration,\n    deltaMs: physicsDt\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 1.1) Pushable objects logic (Stone pushing)\n  let isPushing = false;\n  let pushTarget = null;\n  \n  const currentStrength = gameState.current.strength || 30;\n  const isAlreadyAtMax = currentStrength >= 99;\n  const lastPushTime = gameState.current.lastPushTime || 0;\n  const gracePeriod = 300; // ms, kur strength nesamazins pat ja kontakts pazd uz brdi\n\n  if (entitiesRef.current) {\n    // Ja jau stumjam ar pilnu jaudu, esam pielaidgki pret attlumu (histerze), \n    // lai kompenstu nelielas fizikas dzinja nobdes.\n    const pushDist = isAlreadyAtMax ? 15 : 5;\n    const overlapDist = isAlreadyAtMax ? 12 : 5;\n\n    for (const ent of entitiesRef.current) {\n      if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n        // Prbaudm vai spltjs ir blakus akmenim\n        const isNextToLeft = (x + width + pushDist > ent.x) && (x + width <= ent.x + overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n        const isNextToRight = (x - pushDist < ent.x + ent.width) && (x >= ent.x + ent.width - overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n\n        if ((isNextToLeft && keys.d) || (isNextToRight && keys.a)) {\n          isPushing = true;\n          pushTarget = ent;\n          break;\n        }\n      }\n    }\n  }\n\n  if (isPushing) {\n    gameState.current.strength = Math.min(100, currentStrength + (65 * dt) / 1000); // Aug par ~65% sekund\n    if (gameState.current.strength >= 100 && pushTarget) {\n      // Pastumjam akmeni\n      const pushForce = 2.0;\n      pushTarget.vx = (x < pushTarget.x ? 1 : -1) * pushForce;\n      gameState.current.lastPushTime = timestamp; \n      \n      // Atskaojam skau\n      if (pushTarget.def?.sounds?.push && (!pushTarget.lastPushSoundTime || timestamp - pushTarget.lastPushSoundTime > 450)) {\n        playSfx(pushTarget.def.sounds.push, 0.3);\n        pushTarget.lastPushSoundTime = timestamp;\n      }\n    }\n  } else {\n    // Prbaudm grace periodu pirms skam samazint spku\n    const timeSincePush = timestamp - lastPushTime;\n    if (timeSincePush > gracePeriod) {\n      if (currentStrength > 30) {\n        gameState.current.strength = Math.max(30, currentStrength - (35 * dt) / 1000);\n      } else {\n        gameState.current.strength = 30;\n      }\n    }\n  }\n\n  // 1.9) Ladder check (allow climbing when overlapping ladder objects)\n  const getDefById = (id) => {\n    if (!id) return null;\n    const map = registryItems && registryItems.__byId;\n    if (map && typeof map.get === 'function') return map.get(id) || null;\n    return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n  };\n\n  const findLadderAtPlayer = () => {\n    if (!objectData || !registryItems) return null;\n    const centerX = x + width / 2;\n    const centerY = y + height / 2;\n    const ctxResolved = resolveInteractableContext({\n      mapData,\n      mapWidth,\n      mapHeight,\n      objectLayerData: objectData,\n      mainObjectMetadata: objectMetadata,\n      secretMapData: secretLayer,\n      activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n      centerX,\n      centerY,\n      TILE_SIZE\n    });\n    const { activeObjectData, activeMetadata, activeMapWidth, activeMapHeight, offsetX, offsetY } = ctxResolved;\n    if (!activeObjectData) return null;\n    const localX = centerX - offsetX;\n    const localY = centerY - offsetY;\n    const gridX = Math.floor(localX / TILE_SIZE);\n    const gridY = Math.floor(localY / TILE_SIZE);\n    if (gridX < 0 || gridY < 0 || gridX >= activeMapWidth || gridY >= activeMapHeight) return null;\n    let idx = gridY * activeMapWidth + gridX;\n    let objId = activeObjectData[idx];\n    if (!objId && activeMetadata) {\n      for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n        const baseIdx = parseInt(idxStr, 10);\n        const w = meta.width || 1;\n        const h = meta.height || 1;\n        if (w <= 1 && h <= 1) continue;\n        const ox = baseIdx % activeMapWidth;\n        const oy = Math.floor(baseIdx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          objId = activeObjectData[baseIdx];\n          idx = baseIdx;\n          break;\n        }\n      }\n    }\n    if (!objId) return null;\n    const def = getDefById(objId);\n    if (!def) return null;\n    const isLadder = !!(def.flags?.ladder || def.subtype === 'ladder' || def.type === 'ladder');\n    if (!isLadder) return null;\n    return { def, index: idx };\n  };\n\n  const ladderInfo = findLadderAtPlayer();\n\n  // 2) Vertical physics\n  let vp = null;\n  let remaining = physicsDt;\n  let steps = 0;\n  const prevInWaterFrame = !!gameState.current.inWater;\n  let prevInWater = prevInWaterFrame;\n  if (ladderInfo && !keys?.space) {\n    const ladderSpeed = Math.max(40, Number(ladderInfo.def?.ladder?.speed) || 120);\n    const climbDir = (keys.w ? -1 : 0) + (keys.s ? 1 : 0);\n    if (climbDir !== 0) {\n      const proposedY = y + (climbDir * ladderSpeed) * (physicsDt / 1000);\n      if (!checkCollisionExtended(x, proposedY, mapWidth, mapHeight, width, height)) {\n        y = proposedY;\n      }\n      animation = 'climb';\n    }\n    vy = 0;\n    isGrounded = false;\n    vp = { y, vy, isGrounded, animation, inWater: false, headUnderWater: false, atSurface: false };\n  } else {\n    while (remaining > 0 && steps < 10) {\n      const stepMs = Math.min(16.67, remaining);\n      vp = applyVerticalPhysics({\n        keys,\n        x,\n        y,\n        vy,\n        isGrounded,\n        animation,\n        GRAVITY,\n        TERMINAL_VELOCITY,\n        JUMP_FORCE,\n        TILE_SIZE,\n        width,\n        height,\n        mapWidth,\n        mapHeight,\n        checkCollision: checkCollisionExtended,\n        vx,\n        isLiquidAt: (wx, wy) => {\n          try { return typeof isLiquidAt === 'function' ? isLiquidAt(wx, wy) : null; } catch { return null; }\n        },\n        prevInWater,\n        deltaMs: stepMs\n      });\n      y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n      prevInWater = !!vp.inWater;\n      remaining -= stepMs;\n      steps++;\n    }\n  }\n  const inWater = !!(vp ? vp.inWater : gameState.current.inWater);\n  const headUnderWater = !!(vp ? vp.headUnderWater : gameState.current.headUnderWater);\n  const atSurface = !!(vp ? vp.atSurface : gameState.current.atSurface);\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else if (liquidType === 'quicksand') {\n      vx *= 0.72; // Quicksand is very thick\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n    const resourceParams = liquidParams?.resources || {};\n    const parseNumber = (v) => (v === null || v === undefined || v === '') ? null : Number(v);\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = resourceParams.oxygen || liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = resourceParams.lavaResist || liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n    const iceParams = resourceParams.iceResist;\n    const strengthParams = resourceParams.strength;\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    const oxygenApplies = !!(resourceParams.oxygen || liquidType === 'water' || liquidType === 'quicksand' || liquidType === 'radioactive_water' || liquidType === 'waterfall' || liquidType === 'radioactive_waterfall');\n    const oxygenEnabled = oxyParams?.enabled !== false;\n    const oxyDrain = parseNumber(oxyParams?.drainPerSecond);\n    const oxyRegen = parseNumber(oxyParams?.regenPerSecond);\n    if (oxygenEnabled && headUnderWater && oxygenApplies && Number.isFinite(oxyDrain)) {\n      oxy -= (Math.max(0, oxyDrain) * dt) / 1000;\n    } else if (oxygenEnabled) {\n      oxy += (Math.max(0, Number.isFinite(oxyRegen) ? oxyRegen : 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resist depletion while in lava; regenerates outside\n    const lavaApplies = !!(resourceParams.lavaResist || liquidType === 'lava' || liquidType === 'lava_waterfall');\n    const lavaEnabled = lavaParams?.enabled !== false;\n    const lavaDrain = parseNumber(lavaParams?.drainPerSecond);\n    const lavaRegen = parseNumber(lavaParams?.regenPerSecond);\n    if (lavaEnabled && lavaApplies && liquidType && liquidType.includes('lava') && Number.isFinite(lavaDrain)) {\n      lavaRes -= (Math.max(0, lavaDrain) * dt) / 1000;\n    } else if (lavaEnabled) {\n      lavaRes += (Math.max(0, Number.isFinite(lavaRegen) ? lavaRegen : 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Ice resist & strength can be optionally affected by liquids\n    const applyResource = (key, maxKey, params) => {\n      if (!params || params.enabled === false) return;\n      const drain = parseNumber(params.drainPerSecond);\n      const regen = parseNumber(params.regenPerSecond);\n      if (!Number.isFinite(drain) && !Number.isFinite(regen)) return;\n      const maxVal = Math.max(1, Number(gameState.current[maxKey] || 100));\n      let cur = Number(gameState.current[key]);\n      if (!Number.isFinite(cur)) cur = maxVal;\n      if (inWater || liquidType) {\n        if (Number.isFinite(drain)) cur -= (Math.max(0, drain) * dt) / 1000;\n      } else if (Number.isFinite(regen)) {\n        cur += (Math.max(0, regen) * dt) / 1000;\n      }\n      cur = Math.max(0, Math.min(maxVal, cur));\n      gameState.current[key] = cur;\n      gameState.current[maxKey] = maxVal;\n    };\n\n    applyResource('iceResist', 'maxIceResist', iceParams);\n    applyResource('strength', 'maxStrength', strengthParams);\n\n    // Radioactivity: fills up in radioactive liquid; slowly returns to 20% outside\n    const weatherNow = getMapWeather(mapData);\n    const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n    const fogActive = weatherAffectsPlayer('radioactiveFog') && radioFogInt > 0;\n    const maxRadio = Math.max(1, Number(gameState.current.maxRadioactivity || 100));\n    let radio = Number(gameState.current.radioactivity);\n    if (!Number.isFinite(radio)) radio = maxRadio * 0.2;\n\n    const radioParams = resourceParams.radioactivity;\n    const radioEnabled = radioParams?.enabled !== false;\n    const radioBaseline = Number.isFinite(parseNumber(radioParams?.baselinePercent)) ? Math.max(0, Math.min(1, parseNumber(radioParams?.baselinePercent))) : 0.2;\n    const radioGain = Number.isFinite(parseNumber(radioParams?.gainPerSecond)) ? Math.max(0, parseNumber(radioParams?.gainPerSecond)) : (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall' ? 15 : 0);\n    const radioDecay = Number.isFinite(parseNumber(radioParams?.decayPerSecond)) ? Math.max(0, parseNumber(radioParams?.decayPerSecond)) : 5;\n    const radioRecover = Number.isFinite(parseNumber(radioParams?.recoverPerSecond)) ? Math.max(0, parseNumber(radioParams?.recoverPerSecond)) : 2;\n    const radioApplies = !!(radioParams || liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall');\n\n    if (radioEnabled && radioApplies && (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall')) {\n      radio += (radioGain * dt) / 1000; \n    } else if (radioEnabled && !fogActive) {\n      const baseline = maxRadio * radioBaseline;\n      if (radio > baseline) {\n        radio -= (radioDecay * dt) / 1000;\n      } else if (radio < baseline) {\n        radio += (radioRecover * dt) / 1000;\n      }\n    }\n\n    // Radioactivity resource changes from fog (deplete while fog is active)\n    if (weatherAffectsPlayer('radioactiveFog')) {\n      const rates = getRadioactivityRates();\n      if (radioFogInt > 0 && rates.increase > 0) {\n        const dec = (radioFogInt / 100) * rates.increase * (dt / 1000);\n        radio -= dec;\n      } else if (radioFogInt <= 0 && rates.decay > 0 && !fogActive) {\n        const inc = rates.decay * (dt / 1000);\n        radio += inc;\n      }\n    }\n\n    radio = Math.max(0, Math.min(maxRadio, radio));\n    gameState.current.radioactivity = radio;\n    gameState.current.maxRadioactivity = maxRadio;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && oxygenApplies) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if ((liquidType === 'lava' || liquidType === 'lava_waterfall') && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n\n    // Weather damage (Lava Rain, Radioactive Fog)\n    const weather = weatherNow || getMapWeather(mapData);\n    const lavaRainInt = Number(weather.lavaRain || 0);\n\n    let lavaDps = weatherAffectsPlayer('lavaRain') ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    const radioDps = weatherAffectsPlayer('radioactiveFog') ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && (inWater || (liquidType && liquidType.includes('water')))) {\n      lavaDps = 0;\n    }\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = backgroundLayer;\n        const secretData = secretLayer;\n        const covered = isCoveredFromAbove({\n          x: x + width / 2,\n          y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems: ctx.registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const effectiveRadioDps = (radioDps > 0 && Number(radio) <= 0) ? radioDps : 0;\n    const totalWeatherDps = lavaDps + effectiveRadioDps;\n\n    if (totalWeatherDps > 0) {\n      weatherDamageAccRef.current += dt;\n      if (weatherDamageAccRef.current >= 1000) {\n        weatherDamageAccRef.current -= 1000;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - totalWeatherDps);\n        const HIT_FLASH_MS = 500;\n        gameState.current.hitTimerMs = Math.max(Number(gameState.current.hitTimerMs) || 0, HIT_FLASH_MS);\n        if (actions.onStateUpdate) {\n          actions.onStateUpdate('playerDamage', {\n            damage: totalWeatherDps,\n            x: x + width / 2,\n            y\n          });\n        }\n      }\n    } else {\n      weatherDamageAccRef.current = 0;\n    }\n\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  const healthEnabled = resourceParams?.health?.enabled !== false;\n  const healthDpsOverride = (healthEnabled && resourceParams?.health && resourceParams.health.damagePerSecond !== null && resourceParams.health.damagePerSecond !== undefined)\n    ? Number(resourceParams.health.damagePerSecond)\n    : null;\n  const effectiveDps = Number.isFinite(healthDpsOverride) ? Math.max(0, healthDpsOverride) : Number(liquidParams?.dps);\n  if (liquidType && liquidParams && Number(effectiveDps) > 0) {\n    try {\n      if (liquidType && liquidType.includes('lava')) {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection and triggers\n  // Sync moved state to Ref so triggers can see it and modify it (Teleport, Knockback, etc.)\n  gameState.current.x = x;\n  gameState.current.y = y;\n  gameState.current.vx = vx;\n  gameState.current.vy = vy;\n  gameState.current.isGrounded = isGrounded;\n  gameState.current.animation = animation;\n\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, mapHeight, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // Sync back from Ref in case triggers changed something\n  x = gameState.current.x;\n  y = gameState.current.y;\n  vx = gameState.current.vx;\n  vy = gameState.current.vy;\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0) {\n    const originX = x + (direction >= 0 ? width + 4 : -4);\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1, 'player');\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 5.5) Update entities (tanks etc.)\n  try {\n    updateEntities({\n      entitiesRef,\n      gameState,\n      mapData,\n      objectData,\n      mapWidth,\n      mapHeight,\n      TILE_SIZE,\n      checkCollision,\n      isLiquidAt,\n      getLiquidSample,\n      spawnProjectile,\n      playSfx,\n      constants,\n      registryItems: ctx.registryItems,\n      onStateUpdate: actions.onStateUpdate,\n      activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n    }, Math.min(dt, 100)); // Ierobeojam deltaMs uz 100ms, lai izvairtos no milzgiem lcieniem\n    \n    // Sinhronizjam loklos maingos pc enttiju (platformu) ietekmes\n    x = gameState.current.x;\n    y = gameState.current.y;\n    vx = gameState.current.vx;\n    vy = gameState.current.vy;\n    isGrounded = gameState.current.isGrounded;\n    animation = gameState.current.animation;\n\n    if (checkSecrets && entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n          try { checkSecrets(ent.x, ent.y, ent.width, ent.height, mapWidth, mapHeight); } catch {}\n        }\n      }\n    }\n    \n    // Kontaktbojjumi no enttijm\n    const player = gameState.current;\n    if (entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        \n        // AABB prbaude\n        const hit = (\n          player.x < ent.x + ent.width &&\n          player.x + player.width > ent.x &&\n          player.y < ent.y + ent.height &&\n          player.y + player.height > ent.y\n        );\n        \n        if (hit && Number(player.hitTimerMs) <= 0) {\n          // Pievienojam nelielu atgrdienu (knockback)\n          const knockbackDir = player.x + player.width / 2 < ent.x + ent.width / 2 ? -1 : 1;\n          gameState.current.vx = knockbackDir * 5;\n          gameState.current.vy = -3;\n          \n          // Iestatm bezsmertbas periodu un vizulo flash\n          gameState.current.hitTimerMs = 500;\n          \n          // Samazinm spltja veselbu\n          gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - 10);\n          \n          if (actions.onStateUpdate) {\n            actions.onStateUpdate('playerDamage', { damage: 10, x: player.x + player.width / 2, y: player.y });\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"Entity update failed:\", e);\n  }\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Win and Death check\n  if (gameState.current.isWinning) {\n    gameState.current.winCounter = (gameState.current.winCounter || 0) + (gameState.current.winCountSpeed || 10) * (deltaMs / 100);\n    if (gameState.current.winCounter >= 100) {\n      gameState.current.winCounter = 100;\n      // Trigger level win event if needed\n      if (actions.onStateUpdate) actions.onStateUpdate('levelWin');\n    }\n  }\n\n  if ((Number(gameState.current.health) || 0) <= 0 || y > mapHeight * TILE_SIZE + 300) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  if (!prevInWaterFrame && inWater) {\n    gameState.current.lastWaterEnter = {\n      x: x + width / 2,\n      y: y + height / 2,\n      time: Number(timestamp) || 0\n    };\n  }\n\n  if (actions.playSfx) {\n    const playerDef = getDefById('player');\n    if (playerDef?.sounds?.water_out && prevInWaterFrame && !inWater) {\n      try { actions.playSfx(playerDef.sounds.water_out, 0.35); } catch {}\n    } else if (playerDef?.sounds?.water_in && !prevInWaterFrame && inWater) {\n      try { actions.playSfx(playerDef.sounds.water_in, 0.35); } catch {}\n    }\n  }\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    timeMs: Number(timestamp) || 0,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null,\n    liquidOverlay: liquidParams?.overlay || null,\n    onIce: isSlippery\n  };\n\n  // Floating text deltas for player resources\n  if (actions.onStateUpdate) {\n    const floatState = gameState.current.floatingText || { prev: {}, acc: {} };\n    const resources = [\n      { key: 'health', color: '#ff3b3b' },\n      { key: 'oxygen', color: '#2ecdf1' },\n      { key: 'lavaResist', color: '#ffcc00' },\n      { key: 'iceResist', color: '#a5f3fc' },\n      { key: 'strength', color: '#8b5a2b' },\n      { key: 'radioactivity', color: '#32cd32' }\n    ];\n    const baseX = x + width / 2;\n    const baseY = y - 6;\n\n    resources.forEach((res, idx) => {\n      const cur = Number(gameState.current[res.key]) || 0;\n      if (!Number.isFinite(floatState.prev[res.key])) {\n        floatState.prev[res.key] = cur;\n        floatState.acc[res.key] = 0;\n        return;\n      }\n      const diff = cur - floatState.prev[res.key];\n      if (diff !== 0) {\n        floatState.acc[res.key] = (floatState.acc[res.key] || 0) + diff;\n        if (Math.abs(floatState.acc[res.key]) >= 1) {\n          const amt = Math.round(floatState.acc[res.key]);\n          floatState.acc[res.key] -= amt;\n          const sign = amt > 0 ? '+' : '';\n          actions.onStateUpdate('floatingText', {\n            x: baseX + (idx - 2.5) * 6,\n            y: baseY,\n            text: `${sign}${amt}`,\n            color: res.color,\n            amount: amt\n          });\n        }\n      }\n      floatState.prev[res.key] = cur;\n    });\n\n    gameState.current.floatingText = floatState;\n  }\n\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\nexport const MAX_ICE_RESIST = 100;\nexport const MAX_RADIOACTIVITY = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles, handleWeatherEffectHit } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal, getSurfaceProperties } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST,\n    MAX_ICE_RESIST,\n    MAX_RADIOACTIVITY\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret, objectMetadata\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret, objectMetadata, activeRoomIds, mapWidth, mapHeight) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        fishCount: 0,\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        iceResist: MAX_ICE_RESIST,\n        maxIceResist: MAX_ICE_RESIST,\n        radioactivity: MAX_RADIOACTIVITY * 0.2, // 20% default\n        maxRadioactivity: MAX_RADIOACTIVITY,\n        strength: 30,\n        maxStrength: 100,\n        lastPushTime: 0,\n        isWinning: false,\n        winCounter: 0,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n    const weatherDamageAccRef = useRef(0);                // Weather damage DPS accumulator\n    const entitiesRef = useRef([]);                        // Active moving entities (tanks, etc.)\n\n    // Refs for props to avoid stale closures in the game loop\n    const onStateUpdateRef = useRef(onStateUpdate);\n    const onRevealSecretRef = useRef(onRevealSecret);\n    const onGameOverRef = useRef(onGameOver);\n    const objectMetadataRef = useRef(objectMetadata);\n    const revealedSecretsRef = useRef(revealedSecrets);\n    const activeRoomIdsRef = useRef(activeRoomIds);\n    const mapWidthRef = useRef(mapWidth);\n    const mapHeightRef = useRef(mapHeight);\n    const tileDataRef = useRef(tileData);\n    const objectDataRef = useRef(objectData);\n    const secretDataRef = useRef(secretData);\n\n    useEffect(() => { onStateUpdateRef.current = onStateUpdate; }, [onStateUpdate]);\n    useEffect(() => { onRevealSecretRef.current = onRevealSecret; }, [onRevealSecret]);\n    useEffect(() => { onGameOverRef.current = onGameOver; }, [onGameOver]);\n    useEffect(() => { objectMetadataRef.current = objectMetadata; }, [objectMetadata]);\n    useEffect(() => { revealedSecretsRef.current = revealedSecrets; }, [revealedSecrets]);\n    useEffect(() => { activeRoomIdsRef.current = activeRoomIds; }, [activeRoomIds]);\n    useEffect(() => { mapWidthRef.current = mapWidth; }, [mapWidth]);\n    useEffect(() => { mapHeightRef.current = mapHeight; }, [mapHeight]);\n    useEffect(() => { tileDataRef.current = tileData; }, [tileData]);\n    useEffect(() => { objectDataRef.current = objectData; }, [objectData]);\n    useEffect(() => { secretDataRef.current = secretData; }, [secretData]);\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        const isInsideRoom = activeRoomIdsRef.current && activeRoomIdsRef.current.length > 0;\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume);\n    };\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Weather effects impact handling (meteors, etc.)\n    const handleWeatherEffectHitWrapper = (type, data) => {\n        handleWeatherEffectHit(type, data, {\n            gameState,\n            entitiesRef,\n            TILE_SIZE,\n            onBreakEffect: (detail) => {\n                window.dispatchEvent(new CustomEvent('game-break-effect', { detail }));\n            }\n        });\n    };\n\n    // Listen for weather effect hits from the UI/Renderer\n    useEffect(() => {\n        const onHit = (e) => {\n            if (e && e.detail) {\n                handleWeatherEffectHitWrapper(e.detail.type, e.detail.data);\n            }\n        };\n        window.addEventListener('weather-effect-hit', onHit);\n        return () => window.removeEventListener('weather-effect-hit', onHit);\n    }, []);\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecretRef.current) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecretsRef.current || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecretRef.current(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    const lastMapIdRef = useRef(null);\n\n    // Initialize player at starting position\n    useEffect(() => {\n        if (!mapData) {\n            isInitialized.current = false;\n            lastMapIdRef.current = null;\n            return;\n        }\n\n        // Unique identifier for the map session\n        // We include projectName and timestamps to distinguish between different projects \n        // that might use the same activeMapId (like \"main\")\n        const meta = mapData.meta || {};\n        const projectName = meta.projectName || '';\n        const mapId = meta.activeMapId || mapData.name || 'default';\n        const timestamp = meta.date_map_last_updated || meta.date_map_created_at || '';\n        \n        // Use a unique ID that changes on map load or restart\n        const currentMapId = `${projectName}|${mapId}|${timestamp}`;\n        const isNewMapLoad = currentMapId !== lastMapIdRef.current;\n\n        // Ja sple jau ir inicializta UN t ir t pati karte, nemainm spltja pozciju\n        // Tas novr \"reset\" uz skumu, kad spltjs pace itemu vai mains laikapstki\n        if (isInitialized.current && !isNewMapLoad) return;\n\n        lastMapIdRef.current = currentMapId;\n\n        // Reset state for new initialization\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        entitiesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapWidth || mapData.meta?.width || mapData.width || 20;\n            const mapH = mapHeight || mapData.meta?.height || mapData.height || 15;\n            \n            // Search for entities in objectData\n            const initialEntities = [];\n            if (objectData && Array.isArray(objectData)) {\n                objectData.forEach((id, idx) => {\n                    if (id && !id.includes('player')) {\n                        const def = findItemById(id) || registryItems.find(r => r.id === id);\n                        const isEntity = def && (\n                            def.type === 'entity' || \n                            def.subtype === 'tank' || \n                            def.subtype === 'platform' ||\n                            def.isPushable ||\n                            (def.name && def.name.toLowerCase().includes('entities.'))\n                        );\n\n                        if (isEntity) {\n                            initialEntities.push({\n                                id: `entity_${idx}_${Date.now()}_${idx}`,\n                                defId: id,\n                                def: def,\n                                x: (idx % mapW) * TILE_SIZE,\n                                y: Math.floor(idx / mapW) * TILE_SIZE,\n                                width: (Number(def.width) || 1) * TILE_SIZE,\n                                height: (Number(def.height) || 1) * TILE_SIZE,\n                                vx: 0,\n                                vy: 0,\n                                health: def.maxHealth || 100,\n                                direction: def.subtype === 'platform' ? 1 : (def.isPushable ? 1 : -1),\n                                animation: (def.subtype === 'platform' || def.isPushable) ? 'idle' : 'move',\n                                animFrame: 0,\n                                animTimer: 0,\n                                isGrounded: false,\n                                shootCooldown: 0,\n                                currentSpriteIndex: 0,\n                                subtype: def.subtype || (def.isPushable ? 'pushable' : null),\n                                rotation: def.isRound ? 0 : undefined\n                            });\n                        }\n                    }\n                });\n            }\n            entitiesRef.current = initialEntities;\n\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // 1. Priority: spawnTriggerId hint (from inter-map teleport)\n                const spawnTriggerId = mapData.meta?.spawnTriggerId;\n                let startIndex = -1;\n\n                if (spawnTriggerId !== undefined && spawnTriggerId !== null) {\n                    startIndex = objLayer.data.findIndex((id, idx) => {\n                        if (!id || (!id.includes('target') && id !== 'portal_target')) return false;\n                        const meta = objectMetadataRef.current?.[idx] || mapData.meta?.objectMetadata?.[idx];\n                        return meta && meta.triggerId === spawnTriggerId;\n                    });\n                }\n\n                // 2. Fallback: Search for player (anything containing 'player')\n                if (startIndex === -1) {\n                    startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n                }\n\n                if (startIndex !== -1) {\n                    let startX = (startIndex % mapW) * TILE_SIZE;\n                    let startY = Math.floor(startIndex / mapW) * TILE_SIZE;\n\n                    // Get data from registry\n                    const playerId = objLayer.data[startIndex];\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    const prevAmmo = Math.max(0, Number(gameState.current?.ammo) || 0);\n                    const prevFishCount = Math.max(0, Number(gameState.current?.fishCount) || 0);\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: prevAmmo,\n                        fishCount: prevFishCount,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: Number(registryPlayer?.strength) || 30,\n                        maxStrength: Number(registryPlayer?.maxStrength) || 100,\n                        lastPushTime: 0,\n                        isWinning: false,\n                        winCounter: 0\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    const pW = gameState.current.width || TILE_SIZE;\n                    const pH = gameState.current.height || TILE_SIZE;\n                    while (checkCollision(gameState.current.x, gameState.current.y, undefined, undefined, pW, pH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: 30,\n                        maxStrength: 100,\n                        lastPushTime: 0\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST,\n                    radioactivity: MAX_RADIOACTIVITY * 0.2,\n                    maxRadioactivity: MAX_RADIOACTIVITY,\n                    strength: 30,\n                    maxStrength: 100,\n                    lastPushTime: 0\n                };\n                setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]); // objectData removed - item collection shouldn't trigger re-initialization\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mw, mh, w, h, ignoreEntityId) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE,\n            tileDataRef.current || tileData,\n            registryItems,\n            w !== undefined ? w : gameState.current.width,\n            h !== undefined ? h : gameState.current.height,\n            secretDataRef.current || secretData,\n            objectDataRef.current || objectData,\n            objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreEntityId || null,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mw, mh, TILE_SIZE_OVERRIDE, tileDataOverride, registryItemsOverride, secretDataOverride, objectDataOverride, objectMetadataOverride, ignoreId) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE_OVERRIDE || TILE_SIZE,\n            tileDataOverride || tileDataRef.current || tileData,\n            registryItemsOverride || registryItems,\n            secretDataOverride || secretDataRef.current || secretData,\n            objectDataOverride || objectDataRef.current || objectData,\n            objectMetadataOverride || objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreId,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // New: liquid type check at a world pixel\n    const getLiquidTypeAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        const liq = getLiquidAtPixel(wx, wy, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileData, registryItems);\n        return liq ? liq.type : null;\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthRef.current || 20,\n            mapHeight: mapHeightRef.current || 15,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction, ownerId = 'player') => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction, ownerId);\n    };\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData: objectDataRef.current,\n            input,\n            refs: { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef },\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            registryItems,\n            helpers: {\n                checkCollision,\n                getSurfaceProperties: (x, y, w, h) => getSurfaceProperties(x, y, w, h, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileDataRef.current, registryItems, secretDataRef.current, objectMetadataRef.current || mapData?.meta?.objectMetadata, mapData?.maps, activeRoomIdsRef.current || mapData?.meta?.activeRoomIds),\n                isLiquidAt: (wx, wy) => getLiquidTypeAtPixel(wx, wy),\n                getLiquidSample: ({ x, y, width, height }) =>\n                    sampleLiquid({ x, y, width, height })\n            },\n            actions: {\n                collectItem: (x, y, mw, objectLayer) =>\n                collectItem({\n                    registryItems,\n                    TILE_SIZE,\n                    MAX_HEALTH,\n                    playShotSfx,\n                    onStateUpdate: onStateUpdateRef.current,\n                    gameState,\n                    maps: mapData?.maps,\n                    activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n                    objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata,\n                    secretMapData: secretDataRef.current || secretData,\n                    activeMapId: mapData?.meta?.activeMapId || mapData?.meta?.activeMap || 'main'\n                }, x, y, mapWidthRef.current || 20, objectDataRef.current),\n                checkInteractables: (x, y, mw, mh, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState, mapData, input, activeRoomIds: activeRoomIdsRef.current, objectMetadata: objectMetadataRef.current, secretMapData: secretDataRef.current || secretData }, x, y, mapWidthRef.current || 20, mapHeightRef.current || 15, objectDataRef.current),\n                checkHazardDamage: (x, y, mw, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidthRef.current || 20, objectDataRef.current, deltaMs),\n                checkSecrets: (x, y, width, height, mw, mh) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                spawnProjectile: (originX, originY, direction, ownerId) =>\n                    spawnProjectile(originX, originY, direction, ownerId),\n                playSfx: (url, volume) => playShotSfx(url, volume),\n                updateProjectiles: (deltaMs, mw, mh) =>\n                    updateProjectiles({ \n                        projectilesRef, \n                        entitiesRef,\n                        playerState: gameState.current,\n                        TILE_SIZE, \n                        isSolidAtPixel, \n                        findItemById, \n                        objectData: objectDataRef.current, \n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata, \n                        tileData: tileDataRef.current || tileData,\n                        secretData: secretDataRef.current || secretData,\n                        registryItems,\n                        onStateUpdate: onStateUpdateRef.current,\n                        playSfx: playShotSfx\n                    }, deltaMs, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                setPlayer: (next) => setPlayer(next),\n                onGameOver: onGameOverRef.current\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        if (!mapData) return;\n        requestRef.current = requestAnimationFrame(update);\n        return () => {\n            if (requestRef.current) cancelAnimationFrame(requestRef.current);\n        };\n    }, [mapData]); // Restart loop ONLY if map changes, not objects\n\n    return player;\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false,\n        e: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n            keys.current.e = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'KeyE':\n                    keys.current.e = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'KeyE':\n                    keys.current.e = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","import { getMeteorBreakEffectConfig } from './meteorBreakEffects';\nimport { getBiologicalBreakEffectConfig } from './biologicalBreakEffects';\n\n/**\n * Handles weather effect impacts like meteor strikes, lightning, etc.\n * This logic is decoupled from useGameEngine to allow for easier expansion.\n */\nexport const handleWeatherEffectHit = (type, data, context) => {\n    if (!type || !data || !context) return;\n    const { gameState, entitiesRef, onBreakEffect } = context;\n\n    if (type === 'meteor') {\n        const { x, y, size, isLarge, surfaceType } = data;\n        const damage = isLarge ? 40 : 20;\n        const radius = size * 1.5;\n\n        // 1. Check player impact\n        if (gameState && gameState.current) {\n            const p = gameState.current;\n            const dx = (p.x + p.width / 2) - x;\n            const dy = (p.y + p.height / 2) - y;\n            const dist = Math.sqrt(dx * dx + dy * dy);\n\n            if (dist < radius + p.width / 2) {\n                gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - damage);\n                gameState.current.hitTimerMs = 500;\n                // Add knockback\n                if (dist > 0) {\n                    gameState.current.vx += (dx / dist) * 10;\n                    gameState.current.vy -= 5;\n                } else {\n                    gameState.current.vy -= 10; // direct hit\n                }\n            }\n        }\n\n        // 2. Check entities impact\n        if (entitiesRef && entitiesRef.current) {\n            entitiesRef.current.forEach(ent => {\n                const isFish = ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish;\n                const edx = (ent.x + ent.width / 2) - x;\n                const edy = (ent.y + ent.height / 2) - y;\n                const edist = Math.sqrt(edx * edx + edy * edy);\n\n                const prevHealth = Number(ent.health) || 0;\n                const inDamageRadius = edist < radius + ent.width / 2;\n                if (inDamageRadius) {\n                    ent.health = Math.max(0, prevHealth - damage);\n                    // Platforms don't take knockback, but others might\n                    if (ent.subtype !== 'platform') {\n                        if (edist > 0) {\n                            ent.vx += (edx / edist) * 8;\n                            ent.vy -= 3;\n                        } else {\n                            ent.vy -= 6;\n                        }\n                    }\n                }\n\n                if (isFish) {\n                    const cfg = ent.def?.fish || {};\n                    const shockRadius = (Number(cfg.meteorShockRadius) || 0) * (context?.TILE_SIZE || 32);\n                    if (shockRadius > 0 && edist <= shockRadius) {\n                        ent.fishState = ent.fishState || {};\n                        ent.fishState.shockUntil = (Number(gameState?.current?.timeMs) || 0) + (Number(cfg.meteorShockDurationMs) || 1800);\n                    }\n                    const wasDead = prevHealth <= 0;\n                    if (wasDead && ent.health <= 0 && inDamageRadius) {\n                        const now = Number(gameState?.current?.timeMs) || 0;\n                        ent.fishState = ent.fishState || {};\n                        const lastFx = Number(ent.fishState.lastBioFxAt) || 0;\n                        const alreadyQueued = !!ent.fishState.removeOnNext;\n                        if (!alreadyQueued && now - lastFx > 200) {\n                            const bioConfig = getBiologicalBreakEffectConfig();\n                            if (bioConfig && typeof onBreakEffect === 'function') {\n                                onBreakEffect({ x: ent.x + ent.width / 2, y: ent.y + ent.height / 2, config: bioConfig });\n                            }\n                            ent.fishState.lastBioFxAt = now;\n                            ent.fishState.removeOnNext = true;\n                        }\n                    }\n                }\n            });\n        }\n\n        const breakConfig = getMeteorBreakEffectConfig({ size, surfaceType });\n        if (breakConfig && typeof onBreakEffect === 'function') {\n            onBreakEffect({ x, y, config: breakConfig });\n        }\n    }\n\n    // Future weather types can be added here\n    // e.g., if (type === 'lightning') { ... }\n};\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction, ownerId = 'player') {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    ownerId, // Tagad ms zinm, kur izva\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag,\n    dmg: pDef?.damage || 10\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n  const nowMs = Number(playerState?.timeMs) || 0;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      // Updated isSolidAtPixel call with all necessary layers\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n    }\n    return false;\n  };\n\n  const checkObjectHit = (cx, cy, hw, hh) => {\n    if (!objectData) return null;\n    const pts = [\n        { x: cx - hw, y: cy - hh },\n        { x: cx + hw, y: cy - hh },\n        { x: cx - hw, y: cy + hh },\n        { x: cx + hw, y: cy + hh },\n        { x: cx, y: cy }\n    ];\n    for (const pt of pts) {\n        const gx = Math.floor(pt.x / TILE_SIZE);\n        const gy = Math.floor(pt.y / TILE_SIZE);\n        if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) continue;\n        const index = gy * mapWidth + gx;\n        const objId = objectData[index];\n        if (objId) {\n            const def = findItemById(objId);\n            if (def && def.isDestructible) {\n                // Check if already passable\n                const currentMeta = objectMetadata?.[index] || {};\n                const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                if (health > (def.passableHealthThreshold || 0)) {\n                    return index;\n                }\n            }\n        }\n    }\n    return null;\n  };\n\n  const checkEntityHit = (cx, cy, hw, hh, p) => {\n    if (!entitiesRef?.current) return null;\n    for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.id === p.ownerId) continue; // Ignorjam izvju\n\n        const ex = ent.x;\n        const ey = ent.y;\n        const ew = ent.width;\n        const eh = ent.height;\n        if (cx + hw > ex && cx - hw < ex + ew &&\n            cy + hh > ey && cy - hh < ey + eh) {\n            return ent;\n        }\n    }\n    return null;\n  };\n\n  const checkPlayerHit = (cx, cy, hw, hh, p) => {\n    if (!playerState || p.ownerId === 'player') return false; // Ignorjam, ja izva spltjs\n    \n    const ex = playerState.x;\n    const ey = playerState.y;\n    const ew = playerState.width || TILE_SIZE;\n    const eh = playerState.height || TILE_SIZE;\n    if (cx + hw > ex && cx - hw < ex + ew &&\n        cy + hh > ey && cy - hh < ey + eh) {\n        return true;\n    }\n    return false;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    let removed = false;\n\n    for (let s = 0; s < steps; s++) {\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n      \n      const hitPlayerX = checkPlayerHit(nextX, cy, hw, hh, p);\n      if (hitPlayerX) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntX = checkEntityHit(nextX, cy, hw, hh, p);\n      if (hitEntX) {\n        hitEntX.health -= p.dmg || 10;\n        const isFish = hitEntX.subtype === 'fish' || hitEntX.def?.subtype === 'fish' || hitEntX.def?.ai?.type === 'fish' || !!hitEntX.def?.fish;\n        if (isFish && hitEntX.health > 0) {\n          hitEntX.fishState = hitEntX.fishState || {};\n          const panicMs = Number(hitEntX.def?.fish?.panicDurationMs) || 1200;\n          hitEntX.fishState.panicUntil = Math.max(hitEntX.fishState.panicUntil || 0, nowMs + panicMs * 2);\n        }\n        if (isFish && playSfx) {\n          const hitSound = hitEntX.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\";\n          try { playSfx(hitSound, 0.4); } catch {}\n        }\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntX.x + hitEntX.width / 2,\n            y: hitEntX.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxX = checkObjectHit(nextX, cy, hw, hh);\n      if (hitIdxX !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxX, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      \n      const hitPlayerY = checkPlayerHit(cx, nextY, hw, hh, p);\n      if (hitPlayerY) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntY = checkEntityHit(cx, nextY, hw, hh, p);\n      if (hitEntY) {\n        hitEntY.health -= p.dmg || 10;\n        const isFish = hitEntY.subtype === 'fish' || hitEntY.def?.subtype === 'fish' || hitEntY.def?.ai?.type === 'fish' || !!hitEntY.def?.fish;\n        if (isFish && hitEntY.health > 0) {\n          hitEntY.fishState = hitEntY.fishState || {};\n          const panicMs = Number(hitEntY.def?.fish?.panicDurationMs) || 1200;\n          hitEntY.fishState.panicUntil = Math.max(hitEntY.fishState.panicUntil || 0, nowMs + panicMs * 2);\n        }\n        if (isFish && playSfx) {\n          const hitSound = hitEntY.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\";\n          try { playSfx(hitSound, 0.4); } catch {}\n        }\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntY.x + hitEntY.width / 2,\n            y: hitEntY.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxY = checkObjectHit(cx, nextY, hw, hh);\n      if (hitIdxY !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxY, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className, spriteSheet, frameIndex }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    // Ja ir spraitts, rdm tikai pirmo kadru (vai citu, ja nordts)\n    if (spriteSheet && spriteSheet.enabled) {\n        const columns = spriteSheet.columns || 1;\n        const total = spriteSheet.totalSprites || 1;\n        const rows = Math.ceil(total / columns);\n        \n        // Editor parasti rdm pirmo kadru (index 0) vai nordto kadru\n        const fallbackFrame = spriteSheet && Number.isFinite(Number(spriteSheet.frameIndex)) ? Number(spriteSheet.frameIndex) : 0;\n        const currentFrame = frameIndex !== undefined ? frameIndex : fallbackFrame;\n        const col = currentFrame % columns;\n        const row = Math.floor(currentFrame / columns);\n\n        return (\n            <div className={className} style={{\n                ...style,\n                overflow: 'hidden',\n                display: 'inline-block',\n                width: style?.width || '32px',\n                height: style?.height || '32px',\n                position: 'relative'\n            }}>\n                <img\n                    src={imgSrc}\n                    alt={alt || ''}\n                    style={{\n                        position: 'absolute',\n                        width: `${columns * 100}%`,\n                        height: `${rows * 100}%`,\n                        left: `-${col * 100}%`,\n                        top: `-${row * 100}%`,\n                        maxWidth: 'none',\n                        maxHeight: 'none',\n                        display: 'block'\n                    }}\n                    draggable={false}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false}\n        />\n    );\n};\n\nexport default AnimatedItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport fireballA from '../../../assets/images/items/fireball_basic_A.png';\nimport fireballB from '../../../assets/images/items/fireball_basic_B.png';\nimport fireballC from '../../../assets/images/items/fireball_basic_C.png';\nimport fireballD from '../../../assets/images/items/fireball_basic_D.png';\nimport fishSprite from '../../../assets/images/entities/animals/fish_01.png';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: auto;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nconst FishDisplay = styled(AmmoDisplay)`\n    color: rgba(140, 230, 255, 0.95);\n`;\n\nconst AmmoIcon = styled.span`\n    width: 22px;\n    height: 22px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    image-rendering: pixelated;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    //gap: 8px;\n`;\n\nconst BarsContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    //gap: 1px;\n    width: 250px;\n    padding-top: 5px;\n    padding-bottom: 5px;\n   // border: solid 1px red;\n`;\n\nconst BarRow = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n`;\n\nconst BarWrapper = styled.div`\n    flex: 1;\n    height: 6px;\n    background-color: rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.4);\n    position: relative;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\n`;\n\nconst BarFill = styled.div.attrs(props => ({\n    style: {\n        width: `${props.$percent}%`,\n        backgroundColor: props.$color,\n    },\n}))`\n    height: 100%;\n    transition: width 0.3s ease;\n`;\n\nconst BarLabel = styled.div`\n    width: 60px;\n    font-size: 8px;\n    color: white;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px black;\n    pointer-events: none;\n    white-space: nowrap;\n    text-transform: uppercase;\n    text-align: right;\n`;\n\nconst GameHeader = ({ \n    health, \n    maxHealth = 100, \n    ammo = 0, \n    fishCount = 0,\n    oxygen = 100, \n    maxOxygen = 100, \n    lavaResist = 100, \n    maxLavaResist = 100,\n    iceResist = 100,\n    maxIceResist = 100,\n    strength = 30,\n    maxStrength = 100,\n    radioactivity = 20,\n    maxRadioactivity = 100,\n    inWater = false,\n    liquidType = null,\n    onIce = false\n}) => {\n    const hpPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));\n    const oxyPercent = Math.max(0, Math.min(100, (oxygen / maxOxygen) * 100));\n    const lavaPercent = Math.max(0, Math.min(100, (lavaResist / maxLavaResist) * 100));\n    const icePercent = Math.max(0, Math.min(100, (iceResist / maxIceResist) * 100));\n    const strengthPercent = Math.max(0, Math.min(100, (strength / maxStrength) * 100));\n    const radioPercent = Math.max(0, Math.min(100, (radioactivity / maxRadioactivity) * 100));\n    const fireballFrames = [fireballA, fireballB, fireballC, fireballD, fireballC, fireballB];\n\n    return (\n        <HeaderContainer>\n            <div style={{ display: 'flex', gap: '14px', alignItems: 'center' }}>\n                <AmmoDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            textures={fireballFrames}\n                            speed={300}\n                            alt=\"Fireball ammo\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {ammo || 0}\n                </AmmoDisplay>\n                <FishDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            texture={fishSprite}\n                            spriteSheet={{ enabled: true, columns: 2, totalSprites: 3, frameIndex: 0 }}\n                            alt=\"Fish\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {fishCount || 0}\n                </FishDisplay>\n            </div>\n\n            <RightSection>\n                <BarsContainer>\n                    {/* HP Bar */}\n                    <BarRow>\n                        <BarLabel>HP</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={hpPercent} $color=\"#ff3232\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Oxygen Bar */}\n                    <BarRow>\n                        <BarLabel>OZ</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={oxyPercent} $color=\"#2ecdf1\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Lava Bar */}\n                    <BarRow>\n                        <BarLabel>LAVA</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={lavaPercent} $color=\"#ffcc00\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Ice Bar */}\n                    <BarRow>\n                        <BarLabel>ICE</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={icePercent} $color=\"#a5f3fc\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Strength Bar */}\n                    <BarRow>\n                        <BarLabel>STRNGTH</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={strengthPercent} $color=\"#8b5a2b\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Radioactivity Bar */}\n                    <BarRow>\n                        <BarLabel>RADIO</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={radioPercent} $color=\"#32cd32\" />\n                        </BarWrapper>\n                    </BarRow>\n                </BarsContainer>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    maxHealth: PropTypes.number,\n    ammo: PropTypes.number,\n    fishCount: PropTypes.number,\n    oxygen: PropTypes.number,\n    maxOxygen: PropTypes.number,\n    lavaResist: PropTypes.number,\n    maxLavaResist: PropTypes.number,\n    iceResist: PropTypes.number,\n    maxIceResist: PropTypes.number,\n    strength: PropTypes.number,\n    maxStrength: PropTypes.number,\n    radioactivity: PropTypes.number,\n    maxRadioactivity: PropTypes.number,\n    inWater: PropTypes.bool,\n    liquidType: PropTypes.string,\n    onIce: PropTypes.bool\n};\n\nexport default GameHeader;\n","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\n// Built-in: debug overlay toggle\nregister({\n  name: 'debug',\n  description: \"Toggle debug overlay: debug [on|off|toggle]\",\n  handler({ args }) {\n    const mode = (args && args[0]) ? String(args[0]).toLowerCase() : 'toggle';\n    const current = !!(window.__GAME_RUNTIME_SETTINGS__ && window.__GAME_RUNTIME_SETTINGS__.debugOverlayEnabled);\n    const next = (mode === 'on') ? true : (mode === 'off' ? false : !current);\n    try {\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        debugOverlayEnabled: next\n      };\n      try { localStorage.setItem('game_debug_overlay', next ? '1' : '0'); } catch {}\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: { debugOverlayEnabled: next } }));\n    } catch {}\n    return `Debug overlay ${next ? 'enabled' : 'disabled'}.`;\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Lava Rain (0..100)\n  const [lavaRain, setLavaRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_lavarain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherLavaRain === 'number') return Math.max(0, Math.min(100, g.weatherLavaRain));\n    } catch {}\n    return 0;\n  });\n  // New: Radioactive Fog (0..100)\n  const [radioactiveFog, setRadioactiveFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_radioactivefog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRadioactiveFog === 'number') return Math.max(0, Math.min(100, g.weatherRadioactiveFog));\n    } catch {}\n    return 0;\n  });\n  // New: Meteor Rain (0..100)\n  const [meteorRain, setMeteorRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_meteorrain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherMeteorRain === 'number') return Math.max(0, Math.min(100, g.weatherMeteorRain));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [debugOverlayEnabled, setDebugOverlayEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_debug_overlay');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.debugOverlayEnabled === 'boolean') return g.debugOverlayEnabled;\n    } catch {}\n    return false;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [roomBlurEnabled, setRoomBlurEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_graphics_room_blur');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.roomBlurEnabled === 'boolean') return g.roomBlurEnabled;\n    } catch {}\n    return true;\n  });\n  const [showCoordinates, setShowCoordinates] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_show_coords');\n      return ls === '1';\n    } catch {}\n    return false;\n  });\n\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Listen for runtime settings updates from game engine or other sources\n  useEffect(() => {\n    const onSettingsUpdate = (e) => {\n      const patch = (e && e.detail) || {};\n      if (patch.weatherRain !== undefined) setRain(patch.weatherRain);\n      if (patch.weatherSnow !== undefined) setSnow(patch.weatherSnow);\n      if (patch.weatherClouds !== undefined) setClouds(patch.weatherClouds);\n      if (patch.weatherFog !== undefined) setFog(patch.weatherFog);\n      if (patch.weatherThunder !== undefined) setThunder(patch.weatherThunder);\n      if (patch.weatherLavaRain !== undefined) setLavaRain(patch.weatherLavaRain);\n      if (patch.weatherRadioactiveFog !== undefined) setRadioactiveFog(patch.weatherRadioactiveFog);\n      if (patch.weatherMeteorRain !== undefined) setMeteorRain(patch.weatherMeteorRain);\n      if (patch.backgroundParallaxFactor !== undefined) setParallax(patch.backgroundParallaxFactor);\n      if (patch.roomBlurEnabled !== undefined) setRoomBlurEnabled(!!patch.roomBlurEnabled);\n      if (patch.healthBarEnabled !== undefined) setHealthBarEnabled(!!patch.healthBarEnabled);\n      if (patch.oxygenBarEnabled !== undefined) setOxygenBarEnabled(!!patch.oxygenBarEnabled);\n      if (patch.lavaBarEnabled !== undefined) setLavaBarEnabled(!!patch.lavaBarEnabled);\n      if (patch.waterSplashesEnabled !== undefined) setWaterSplashesEnabled(!!patch.waterSplashesEnabled);\n      if (patch.lavaEmbersEnabled !== undefined) setLavaEmbersEnabled(!!patch.lavaEmbersEnabled);\n      if (patch.debugOverlayEnabled !== undefined) setDebugOverlayEnabled(!!patch.debugOverlayEnabled);\n    };\n    window.addEventListener('game-settings-update', onSettingsUpdate);\n    return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.roomBlurEnabled === 'boolean') {\n          setRoomBlurEnabled(g.roomBlurEnabled);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.weatherLavaRain === 'number') setLavaRain(Math.max(0, Math.min(100, g.weatherLavaRain)));\n        if (typeof g.weatherRadioactiveFog === 'number') setRadioactiveFog(Math.max(0, Math.min(100, g.weatherRadioactiveFog)));\n        if (typeof g.weatherMeteorRain === 'number') setMeteorRain(Math.max(0, Math.min(100, g.weatherMeteorRain)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n        if (typeof g.debugOverlayEnabled === 'boolean') setDebugOverlayEnabled(!!g.debugOverlayEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  useEffect(() => {\n    try { localStorage.setItem('game_ui_show_coords', showCoordinates ? '1' : '0'); } catch {}\n  }, [showCoordinates]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Blur in Room</label>\n          <input\n            type=\"checkbox\"\n            checked={!!roomBlurEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setRoomBlurEnabled(v);\n              try { localStorage.setItem('game_graphics_room_blur', v ? '1' : '0'); } catch {}\n              emitUpdate({ roomBlurEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Coordinates</label>\n          <input\n            type=\"checkbox\"\n            checked={!!showCoordinates}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setShowCoordinates(v);\n              emitUpdate({ showCoordinates: v });\n            }}\n          />\n        </div>\n        {showCoordinates && (\n          <div style={{ marginTop: 8, padding: '4px 8px', background: 'rgba(0,0,0,0.3)', borderRadius: 4, fontSize: 11, fontFamily: 'monospace', color: '#4ec9b0' }}>\n            Pos: X={Math.round(window.__PLAYER_POS__?.x || 0)}, Y={Math.round(window.__PLAYER_POS__?.y || 0)}\n          </div>\n        )}\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lavas lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(lavaRain) ? lavaRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setLavaRain(v);\n            try { localStorage.setItem('game_weather_lavarain', String(v)); } catch {}\n            emitUpdate({ weatherLavaRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(lavaRain) ? lavaRain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Radioakt. migla</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(radioactiveFog) ? radioactiveFog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRadioactiveFog(v);\n            try { localStorage.setItem('game_weather_radioactivefog', String(v)); } catch {}\n            emitUpdate({ weatherRadioactiveFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(radioactiveFog) ? radioactiveFog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Meteortu lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(meteorRain) ? meteorRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setMeteorRain(v);\n            try { localStorage.setItem('game_weather_meteorrain', String(v)); } catch {}\n            emitUpdate({ weatherMeteorRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(meteorRain) ? meteorRain : 0}</span>\n      </div>\n    </section>\n  );\n\n  const renderDebug = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Debug</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 160 }}>Show Debug Overlay</label>\n        <input\n          type=\"checkbox\"\n          checked={!!debugOverlayEnabled}\n          onChange={(e) => {\n            const v = !!e.target.checked;\n            setDebugOverlayEnabled(v);\n            try { localStorage.setItem('game_debug_overlay', v ? '1' : '0'); } catch {}\n            emitUpdate({ debugOverlayEnabled: v });\n          }}\n        />\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather','Debug'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n        {activeTab === 'Debug' && renderDebug()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import breakEffectsConfig from '../../assets/json/system/object_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!breakEffectsConfig || breakEffectsConfig.enabled === false) return null;\n  return breakEffectsConfig;\n};\n\nexport const getBreakEffectParams = (def) => {\n  if (!def) return null;\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const id = def.id;\n  const type = def.type;\n  const subtype = def.subtype;\n  const name = def.name;\n  const ids = Array.isArray(cfg.objectIds) ? cfg.objectIds : [];\n  const types = Array.isArray(cfg.objectTypes) ? cfg.objectTypes : [];\n  const matchesValue = (value, list) => {\n    if (!value) return false;\n    return list.some(item => item === value || value.includes(item));\n  };\n  const matched = matchesValue(id, ids) || matchesValue(name, ids) || matchesValue(type, types) || matchesValue(subtype, types);\n  if (!matched) return null;\n  const base = cfg.default || {};\n  const colors = Array.isArray(base.colors) ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 12,\n    speed: Number(base.speed) || 2,\n    lifeMs: Number(base.lifeMs) || 600,\n    size: Number(base.size) || 2,\n    colors\n  };\n};\n\nexport const shouldTriggerBreakEffect = (def, newHealth) => {\n  if (!def) return false;\n  const params = getBreakEffectParams(def);\n  if (!params) return false;\n  const threshold = Number(def.passableHealthThreshold ?? 0);\n  const hp = Number(newHealth);\n  if (!Number.isFinite(hp)) return false;\n  return hp <= threshold;\n};\n\nexport default {\n  getBreakEffectParams,\n  shouldTriggerBreakEffect\n};\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\n// - isInsideRoom: boolean  apply muffled effect\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6, isInsideRoom = false }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n  const audioCtxRef = useRef(null);\n  const sourceNodeRef = useRef(null);\n  const filterNodeRef = useRef(null);\n  const gainNodeRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n      if (audioCtxRef.current) {\n        audioCtxRef.current.close().catch(() => {});\n        audioCtxRef.current = null;\n        sourceNodeRef.current = null;\n        filterNodeRef.current = null;\n        gainNodeRef.current = null;\n      }\n    } catch {}\n  };\n\n  const setupWebAudio = (audio) => {\n    try {\n      const AudioContext = window.AudioContext || window.webkitAudioContext;\n      if (!AudioContext) return;\n\n      const ctx = new AudioContext();\n      const source = ctx.createMediaElementSource(audio);\n      const filter = ctx.createBiquadFilter();\n      const gain = ctx.createGain();\n\n      filter.type = 'lowpass';\n      filter.frequency.value = isInsideRoom ? 800 : 22000;\n      gain.gain.value = isInsideRoom ? 0.5 : 1.0;\n\n      source.connect(filter);\n      filter.connect(gain);\n      gain.connect(ctx.destination);\n\n      audioCtxRef.current = ctx;\n      sourceNodeRef.current = source;\n      filterNodeRef.current = filter;\n      gainNodeRef.current = gain;\n    } catch (e) {\n      console.warn('Web Audio setup failed:', e);\n    }\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Web Audio setup for filters\n    setupWebAudio(audio);\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume/room changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    // Direct audio volume (without Web Audio or as fallback)\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    \n    // Web Audio updates\n    if (audioCtxRef.current) {\n      if (filterNodeRef.current) {\n        filterNodeRef.current.frequency.setTargetAtTime(isInsideRoom ? 800 : 22000, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.gain.setTargetAtTime(isInsideRoom ? 0.4 : 1.0, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (audioCtxRef.current.state === 'suspended' && enabled) {\n        audioCtxRef.current.resume().catch(() => {});\n      }\n    }\n\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume, isInsideRoom]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst Overlay = styled.div`\n    position: absolute;\n    top: 70px;\n    left: 10%;\n    transform: none;\n    width: 80%;\n    text-align: left;\n    pointer-events: none;\n    z-index: 1500;\n    \n    h2 {\n        font-size: 22px;\n        color: white;\n        text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);\n        margin: 0;\n        padding: 12px 14px;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-weight: 800;\n        letter-spacing: 0.5px;\n        white-space: pre-line;\n        line-height: 1;\n        background: rgba(0, 0, 0, 0.45);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 6px;\n        opacity: ${props => props.$isVisible ? 1 : 0};\n        transition: opacity 2s ease-in-out;\n    }\n`;\n\nexport const MessageOverlay = ({ text, isVisible }) => {\n    if (!text) return null;\n    return (\n        <Overlay $isVisible={isVisible}>\n            <h2>{text}</h2>\n        </Overlay>\n    );\n};\n\nMessageOverlay.propTypes = {\n    text: PropTypes.string,\n    isVisible: PropTypes.bool\n};\n\nMessageOverlay.defaultProps = {\n    text: '',\n    isVisible: false\n};\n\nexport default MessageOverlay;\n","import map1 from '../assets/maps/template.json';\nimport map2 from '../assets/maps/exampel_liquids.json';\nimport map3 from '../assets/maps/exampel_sectors_01.json';\nimport map4 from '../assets/maps/exampel_sectors_02.json';\nimport map5 from '../assets/maps/exampel_m2room.json';\nimport map6 from '../assets/maps/exampel_weather_01.json';\nimport map7 from '../assets/maps/Ports.json';\nimport map8 from '../assets/maps/fish.json';\n\n\nexport const BUILT_IN_MAPS = [\n    map1,\n    map2,\n    map3,\n    map4,\n    map5,\n    map6,\n    map7,\n    map8\n];\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport { findSpawnPosition } from '../../../engine/gameplay/interactables';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../engine/gameplay/breakEffects';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, removeTileAtIndex, moveTileInMap, moveObjectInMap, updateObjectAtIndex, updateObjectMetadata, setObjectTextureIndex, revealSecretZone, resetGame, setGameOver, toggleRoom, clearRooms } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\nimport { BUILT_IN_MAPS } from '../../../constants/builtInMaps';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nconst WinCounterOverlay = styled.div`\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 120px;\n    font-weight: bold;\n    color: #fff;\n    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,255,255,0.5);\n    z-index: 2000;\n    pointer-events: none;\n    font-family: 'Courier New', Courier, monospace;\n`;\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    overflow: hidden;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nexport default function Game() {\n    const { t } = useTranslation('game');\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n\n    // Redux state\n    const gameState = useSelector(state => state.game) || {};\n    const uiState = useSelector(state => state.ui) || {};\n    const {\n        activeMapData = null,\n        tileMapData = [],\n        objectMapData = [],\n        secretMapData = [],\n        objectMetadata = {},\n        revealedSecrets = [],\n        objectTextureIndices = {},\n        mapWidth = 20,\n        mapHeight = 15,\n        isGameOver = false,\n        activeRoomIds = [],\n        projectMaps = {}\n    } = gameState;\n    const {\n        isMapModalOpen = true,\n        cameraScrollX = 0,\n        shouldCenterMap = false\n    } = uiState;\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    // In-game messages\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n\n    useEffect(() => {\n        const onToggle = (e) => {\n            const enabled = !!(e?.detail?.enabled);\n            setSoundEnabled(enabled);\n            try { localStorage.setItem('game_sound_enabled', enabled ? '1' : '0'); } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        return () => window.removeEventListener('game-sound-toggle', onToggle);\n    }, []);\n\n    useEffect(() => {\n        if (messageTimerRef.current) {\n            clearTimeout(messageTimerRef.current);\n            messageTimerRef.current = null;\n        }\n        setGameMessage({ text: '', isVisible: false });\n    }, [activeMapData]);\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        dispatch(setGameOver(true));\n    };\n\n    const handleReplay = () => {\n        if (activeMapData) {\n            console.log(\"Replaying map...\");\n            const mapToLoad = {\n                ...activeMapData,\n                meta: {\n                    ...activeMapData.meta,\n                    date_map_last_updated: new Date().toISOString()\n                }\n            };\n            loadMapData(mapToLoad);\n            dispatch(setGameOver(false));\n        }\n    };\n\n    const playerStateRef = useRef(null);\n    const activeMapIdRef = useRef(null);\n    const isGameOverRef = useRef(false);\n\n    useEffect(() => {\n        const id = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n        activeMapIdRef.current = id;\n    }, [activeMapData]);\n\n    useEffect(() => {\n        isGameOverRef.current = !!isGameOver;\n    }, [isGameOver]);\n\n    const handleStateUpdate = useCallback((action, payload) => {\n        if (action === 'collectItem') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            dispatch(removeObjectAtIndex({ index, mapId }));\n        } else if (action === 'interactable') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            \n            const targetObjectData = (!mapId || mapId === 'main') ? objectMapData : (activeMapData?.maps?.[mapId]?.objectMapData || []);\n            const currentId = targetObjectData[index];\n            \n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used', mapId }));\n            }\n        } else if (action === 'setObjectFrame') {\n            const { index, frame, mapId } = payload;\n            dispatch(updateObjectMetadata({ index, metadata: { currentFrame: frame }, mapId }));\n        } else if (action === 'switchMap') {\n            const { targetMapId, triggerId } = payload;\n            const projectMapsResolved = Object.keys(projectMaps || {}).length\n                ? projectMaps\n                : (activeMapData?.maps || activeMapData?.projectMaps || {});\n            const targetMap = projectMapsResolved[targetMapId];\n            \n            if (targetMap && targetMap.type === 'room') {\n                if (!activeRoomIds.includes(targetMapId)) {\n                    dispatch(toggleRoom(targetMapId));\n                }\n                return;\n            } else if (targetMapId === 'main' && activeRoomIds.length > 0) {\n                dispatch(clearRooms());\n                \n                // Open the door at the exit target position to prevent getting stuck\n                const spawn = findSpawnPosition(activeMapData, triggerId, 32);\n                if (spawn) {\n                    const spawnIdx = (Math.floor(spawn.y / 32) * mapWidth) + Math.floor(spawn.x / 32);\n                    const spawnObjId = objectMapData[spawnIdx];\n                    const spawnDef = registryItems.find(r => r.id === spawnObjId);\n                    if (spawnDef && spawnDef.subtype === 'door') {\n                        dispatch(updateObjectMetadata({ \n                            index: spawnIdx, \n                            metadata: { currentFrame: spawnDef.interaction?.frames?.opening || 1 } \n                        }));\n                    }\n                }\n                return;\n            }\n            \n            if (targetMap) {\n                console.log(`Switching to map: ${targetMapId}, looking for trigger: ${triggerId}`);\n                \n                // Ms varam vienkri nodot visu projektu un pielikt spawnTriggerId\n                const projectToLoad = {\n                    ...activeMapData,\n                    maps: projectMapsResolved,\n                    meta: {\n                        ...activeMapData.meta,\n                        activeMapId: targetMapId,\n                        spawnTriggerId: triggerId\n                    }\n                };\n                \n                loadMapData(projectToLoad);\n            }\n        } else if (action === 'objectDamage') {\n            const { index, damage } = payload;\n            const objId = objectMapData[index];\n            if (objId) {\n                const def = registryItems.find(r => r.id === objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata[index] || {};\n                    const maxH = def.maxHealth || 100;\n                    const newHealth = Math.max(0, (currentMeta.health !== undefined ? currentMeta.health : maxH) - damage);\n                    const metaPatch = { health: newHealth };\n                    if (shouldTriggerBreakEffect(def, newHealth) && !currentMeta.breakFxPlayed) {\n                        metaPatch.breakFxPlayed = true;\n                        const cfg = getBreakEffectParams(def);\n                        if (cfg) {\n                            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            window.dispatchEvent(new CustomEvent('game-break-effect', {\n                                detail: { x, y, config: cfg }\n                            }));\n                        }\n                    }\n                    dispatch(updateObjectMetadata({ index, metadata: metaPatch }));\n\n                    if (shouldRemoveCrackBlock(def, newHealth)) {\n                        dispatch(removeTileAtIndex(index));\n                    }\n\n                    const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                    const y = Math.floor(index / mapWidth) * TILE_SIZE;\n                    window.dispatchEvent(new CustomEvent('game-floating-text', {\n                        detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n                    }));\n                }\n            }\n        } else if (action === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (action === 'shiftTile' && payload) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapIdRef.current;\n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => objectMapData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => dispatch(moveTileInMap({ fromIndex: from, toIndex: to })),\n                moveObject: (from, to) => dispatch(moveObjectInMap({ fromIndex: from, toIndex: to })),\n                removeObject: idx => dispatch(removeObjectAtIndex(idx)),\n                shouldCancel: () => isGameOverRef.current || activeMapIdRef.current !== mapIdAtStart\n            });\n        } else if (action === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            const ps = playerStateRef.current;\n            const px = Number.isFinite(x) ? x : (ps?.x || 0) + (ps?.width || TILE_SIZE) / 2;\n            const py = Number.isFinite(y) ? y : (ps?.y || 0);\n            if (Number.isFinite(px) && Number.isFinite(py) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x: px, y: py, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        } else if (action === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (action === 'levelWin') {\n            console.log(\"Level Win! Returning to map selection.\");\n            setTimeout(() => {\n                alert(\"Level Complete!\");\n                dispatch(setMapModalOpen(true));\n            }, 500);\n        } else if (action === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1); // e.g., weatherRain\n            setRuntimeSettings(prev => ({ ...prev, [settingKey]: value }));\n            \n            // Dispatch event so UI components like GameSettings can update their state\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (action === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            // o darbbu ms izmantosim, lai nodotu informciju dzinjam caur ref vai eventu\n            // Bet labk ir tiei izsaukt dzinja funkciju, ja tda ir.\n            // T k useGameEngine ir hook, ms nevaram viegli izsaukt t iekjo funkciju.\n            // Tomr ms varam izmantot window eventu vai ref.\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (action === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        }\n    }, [dispatch, objectMapData, objectMetadata, registryItems]);\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const playerState = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        activeRoomIds,\n        mapWidth,\n        mapHeight\n    );\n    useEffect(() => {\n        playerStateRef.current = playerState;\n    }, [playerState]);\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => {\n            dispatch(setMapModalOpen(true));\n            dispatch(setGameOver(false)); // Reset game over when opening new game modal\n        };\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherLavaRain: (runtimeSettings.weatherLavaRain ?? 0),\n                weatherRadioactiveFog: (runtimeSettings.weatherRadioactiveFog ?? 0),\n                weatherMeteorRain: (runtimeSettings.weatherMeteorRain ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                roomBlurEnabled: (runtimeSettings.roomBlurEnabled ?? true),\n                debugOverlayEnabled: (runtimeSettings.debugOverlayEnabled ?? false),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const cloneMapData = (data) => {\n        if (!data) return data;\n        try {\n            if (typeof structuredClone === 'function') {\n                return structuredClone(data);\n            }\n        } catch {}\n        try {\n            return JSON.parse(JSON.stringify(data));\n        } catch {\n            return data;\n        }\n    };\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            const sourceMapData = cloneMapData(mapData);\n            let effectiveMapData = sourceMapData;\n            \n            // Atbalsts Version 2.0 (Multi-map project)\n            if (sourceMapData.meta?.version === \"2.0\" && sourceMapData.maps) {\n                const activeId = sourceMapData.meta.activeMapId || Object.keys(sourceMapData.maps)[0];\n                const activeMap = sourceMapData.maps[activeId];\n                \n                if (activeMap) {\n                    const activeLayers = activeMap.layers || [];\n                    const bgLayer = activeLayers.find(l => l.name === 'background' || l.type === 'tile');\n                    const objLayer = activeLayers.find(l => l.name === 'entities' || l.type === 'object');\n                    const secretLayer = activeLayers.find(l => l.name === 'secrets' || l.type === 'secret');\n                    const mapTileData = activeMap.tileMapData || bgLayer?.data;\n                    const mapObjectData = activeMap.objectMapData || objLayer?.data;\n                    const mapSecretData = activeMap.secretMapData || secretLayer?.data;\n\n                    // Konvertjam uz formtu, ko saprot dzinjs un setActiveMap\n                    effectiveMapData = {\n                        ...sourceMapData, // Saglabjam visu projektu\n                        meta: {\n                            ...sourceMapData.meta,\n                            width: activeMap.width,\n                            height: activeMap.height,\n                            name: activeMap.name,\n                            backgroundImage: activeMap.backgroundImage,\n                            backgroundColor: activeMap.backgroundColor,\n                            backgroundMusic: activeMap.backgroundMusic,\n                            backgroundParallaxFactor: activeMap.backgroundParallaxFactor,\n                            weather: activeMap.weather,\n                            objectMetadata: activeMap.objectMetadata || {},\n                            playerPosition: activeMap.playerPosition\n                        },\n                        layers: [\n                            { name: 'background', data: mapTileData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'entities', data: mapObjectData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'secrets', data: mapSecretData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) }\n                        ]\n                    };\n                }\n            }\n\n            const nowIso = new Date().toISOString();\n            if (!effectiveMapData.meta) effectiveMapData.meta = {};\n            effectiveMapData.meta.date_map_last_updated = nowIso;\n\n            const w = effectiveMapData.meta?.width || effectiveMapData.width || 20;\n            const h = effectiveMapData.meta?.height || effectiveMapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (effectiveMapData.layers) {\n                const bgLayer = effectiveMapData.layers.find(l => l.name === 'background' || l.type === 'tile');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = effectiveMapData.layers.find(l => l.name === 'entities' || l.type === 'object');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = effectiveMapData.layers.find(l => l.name === 'secrets' || l.type === 'secret');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = effectiveMapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData: effectiveMapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n            dispatch(setGameOver(false)); // Ensure game over is reset on map load\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: effectiveMapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    const debugOverlayEnabled = !!(runtimeSettings.debugOverlayEnabled);\n    const debugMapId = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n\n    return (\n        <GameContainer onClick={() => {\n            window.dispatchEvent(new CustomEvent('game-sound-user-gesture'));\n        }}>\n        \n            {/* Game Header */}\n            {/* UI Overlays */}\n            {playerState?.isWinning && (\n                <WinCounterOverlay>\n                    {Math.floor(playerState.winCounter || 0)}\n                </WinCounterOverlay>\n            )}\n\n            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n\n            <GameHeader \n                health={playerState.health} \n                maxHealth={playerState.maxHealth}\n                ammo={playerState.ammo || 0} \n                fishCount={playerState.fishCount || 0}\n                oxygen={playerState.oxygen}\n                maxOxygen={playerState.maxOxygen}\n                lavaResist={playerState.lavaResist}\n                maxLavaResist={playerState.maxLavaResist}\n                iceResist={playerState.iceResist}\n                maxIceResist={playerState.maxIceResist}\n                strength={playerState.strength}\n                maxStrength={playerState.maxStrength}\n                radioactivity={playerState.radioactivity}\n                maxRadioactivity={playerState.maxRadioactivity}\n                inWater={playerState.inWater}\n                liquidType={playerState.liquidType}\n                onIce={playerState.onIce}\n            />\n\n            {debugOverlayEnabled && (\n                <div style={{\n                    position: 'absolute',\n                    top: 70,\n                    left: 70,\n                    background: 'rgba(0,0,0,0.6)',\n                    color: '#eaeaea',\n                    padding: '8px 10px',\n                    fontSize: 11,\n                    lineHeight: 1.4,\n                    borderRadius: 4,\n                    zIndex: 2100,\n                    pointerEvents: 'none',\n                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace'\n                }}>\n                    <div>Map: {debugMapId}</div>\n                    <div>Pos: {Math.round(playerState.x || 0)}, {Math.round(playerState.y || 0)}</div>\n                    <div>Room: {Array.isArray(activeRoomIds) && activeRoomIds.length ? activeRoomIds.join(', ') : 'none'}</div>\n                    <div>Weather: rain {runtimeSettings.weatherRain ?? 0} | snow {runtimeSettings.weatherSnow ?? 0} | fog {runtimeSettings.weatherFog ?? 0}</div>\n                    <div>Weather: lava {runtimeSettings.weatherLavaRain ?? 0} | radio {runtimeSettings.weatherRadioactiveFog ?? 0}</div>\n                    <div>HP {Math.round(playerState.health || 0)} / {Math.round(playerState.maxHealth || 0)}</div>\n                    <div>O2 {Math.round(playerState.oxygen || 0)} | Lava {Math.round(playerState.lavaResist || 0)} | Rad {Math.round(playerState.radioactivity || 0)}</div>\n                </div>\n            )}\n\n\n            {isGameOver && (\n                <GameOverOverlay>\n                    <GameOverTitle>Game Over</GameOverTitle>\n                    <ReplayButton onClick={handleReplay}>\n                        REPLAY \n                    </ReplayButton>\n                </GameOverOverlay>\n            )}\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>{t('GAME_MAP_SELECT_TITLE')}</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => {\n                                const isV2 = map.meta?.version === \"2.0\";\n                                const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                                const author = map.meta?.author || \"Unknown\";\n                                \n                                let sizeInfo = \"\";\n                                let subMapInfo = \"\";\n\n                                if (isV2 && map.maps) {\n                                    const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                                    if (mainMap) {\n                                        sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                                    }\n                                    \n                                    const mapValues = Object.values(map.maps);\n                                    const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                                    const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                                    \n                                    subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                                } else {\n                                    sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                                }\n\n                                return (\n                                    <MapCard key={index} onClick={() => loadMapData(map)}>\n                                        <div>\n                                            <MapTitle>{projectName}</MapTitle>\n                                            <MapAuthor>{t('GAME_MAP_BY', { author })}</MapAuthor>\n                                        </div>\n                                        {map.meta?.description && (\n                                            <MapDescription title={map.meta.description}>\n                                                {map.meta.description}\n                                            </MapDescription>\n                                        )}\n                                        <MapInfo>\n                                            <div>{t('GAME_MAP_SIZE', { size: `${sizeInfo}${subMapInfo}` })}</div>\n                                        </MapInfo>\n                                    </MapCard>\n                                );\n                            })}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 {t('GAME_MAP_LOAD_CUSTOM')}\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherLavaRain={runtimeSettings.weatherLavaRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherMeteorRain={runtimeSettings.weatherMeteorRain ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherRadioactiveFog={runtimeSettings.weatherRadioactiveFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                            roomBlurEnabled={runtimeSettings.roomBlurEnabled ?? true}\n                            debugOverlayEnabled={runtimeSettings.debugOverlayEnabled ?? false}\n                            isEditor={false}\n                            mapType={activeMapData?.type || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={projectMaps}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer \n                metaPath={activeMapData?.meta?.backgroundMusic} \n                enabled={soundEnabled} \n                volume={0.6} \n                isInsideRoom={activeRoomIds.length > 0}\n            />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","import saveFile from '../../../../utilities/saveFile';\nimport errorHandler from '../../../../services/errorHandler';\n\nexport const saveMap = async ({\n    maps,\n    activeMapId,\n    mapName,\n    creatorName,\n    mapDescription,\n    createdAt,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    const projectData = {\n        meta: {\n            version: \"2.0\",\n            projectName: mapName,\n            author: creatorName,\n            description: mapDescription,\n            date_created: createdDate,\n            date_last_updated: currentDate,\n            activeMapId: activeMapId\n        },\n        maps: {}\n    };\n\n    // Serialize all maps\n    Object.values(maps).forEach(map => {\n        const filledBlocks = map.tileMapData.filter(t => t !== null).length;\n        const objectsCount = map.objectMapData.filter(o => o !== null).length;\n        \n        projectData.maps[map.id] = {\n            id: map.id,\n            name: map.name,\n            description: map.description || '',\n            type: map.type,\n            width: map.mapWidth,\n            height: map.mapHeight,\n            backgroundImage: map.selectedBackgroundImage || null,\n            backgroundColor: map.selectedBackgroundColor || null,\n            backgroundParallaxFactor: map.backgroundParallaxFactor || 0.3,\n            backgroundMusic: map.selectedBackgroundMusic || null,\n            weather: map.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n            objectMetadata: map.objectMetadata || {},\n            playerPosition: map.playerPosition || null,\n            worldX: map.worldX || 0,\n            worldY: map.worldY || 0,\n            statistics: {\n                total_tiles: map.mapWidth * map.mapHeight,\n                filled_tiles: filledBlocks,\n                total_objects: objectsCount\n            },\n            layers: [\n                { type: \"tile\", name: \"background\", data: map.tileMapData },\n                { type: \"object\", name: \"entities\", data: map.objectMapData },\n                { type: \"secret\", name: \"secrets\", data: map.secretMapData || Array(map.mapWidth * map.mapHeight).fill(null) }\n            ]\n        };\n    });\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(projectData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Project saved successfully', {\n                component: 'Editor',\n                projectName: mapName,\n                fileName,\n                mapsCount: Object.keys(maps).length\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save project. Check console for details.');\n    }\n};\n\nexport const applyMapData = (loaded, {\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setPlayerPosition,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData,\n    setObjectMetadata,\n    setWeatherRain,\n    setWeatherSnow,\n    setWeatherClouds,\n    setWeatherFog,\n    setWeatherThunder,\n    setWeatherLavaRain,\n    setWeatherRadioactiveFog,\n    setWeatherMeteorRain,\n    // Multi-map setters\n    setMaps,\n    setActiveMapId\n}) => {\n    try {\n        // Check for multi-map format (version 2.0)\n        if (loaded.meta && loaded.meta.version === \"2.0\" && loaded.maps) {\n            const projectMaps = {};\n            \n            Object.keys(loaded.maps).forEach(mapId => {\n                const m = loaded.maps[mapId];\n                const bgLayer = m.layers.find(l => l.type === 'tile');\n                const objLayer = m.layers.find(l => l.type === 'object');\n                const secretLayer = m.layers.find(l => l.type === 'secret');\n                \n                projectMaps[mapId] = {\n                    id: mapId,\n                    name: m.name,\n                    description: m.description || '',\n                    type: m.type || 'overworld',\n                    mapWidth: m.width,\n                    mapHeight: m.height,\n                    tileMapData: bgLayer ? bgLayer.data : Array(m.width * m.height).fill(null),\n                    objectMapData: objLayer ? objLayer.data : Array(m.width * m.height).fill(null),\n                    secretMapData: secretLayer ? secretLayer.data : Array(m.width * m.height).fill(null),\n                    objectMetadata: m.objectMetadata || {},\n                    selectedBackgroundImage: m.backgroundImage,\n                    selectedBackgroundColor: m.backgroundColor,\n                    backgroundParallaxFactor: m.backgroundParallaxFactor || 0.3,\n                    selectedBackgroundMusic: m.backgroundMusic,\n                    weather: m.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                    playerPosition: m.playerPosition || null,\n                    worldX: m.worldX || 0,\n                    worldY: m.worldY || 0\n                };\n            });\n            \n            setMaps(projectMaps);\n            setMapName(loaded.meta.projectName || \"Loaded Project\");\n            setCreatorName(loaded.meta.author || \"Anonymous\");\n            setMapDescription(loaded.meta.description || \"\");\n            setCreatedAt(loaded.meta.date_created || new Date().toISOString());\n            \n            const activeId = loaded.meta.activeMapId || Object.keys(projectMaps)[0];\n            setActiveMapId(activeId);\n            \n            const activeMap = projectMaps[activeId];\n            if (activeMap) {\n                setMapWidth(activeMap.mapWidth);\n                setMapHeight(activeMap.mapHeight);\n                setTileMapData(activeMap.tileMapData);\n                setObjectMapData(activeMap.objectMapData);\n                setSecretMapData(activeMap.secretMapData);\n                setObjectMetadata(activeMap.objectMetadata);\n                setSelectedBackgroundImage(activeMap.selectedBackgroundImage);\n                setSelectedBackgroundColor(activeMap.selectedBackgroundColor);\n                setBackgroundParallaxFactor(activeMap.backgroundParallaxFactor);\n                setSelectedBackgroundMusic(activeMap.selectedBackgroundMusic);\n                \n                setWeatherRain(activeMap.weather.rain);\n                setWeatherSnow(activeMap.weather.snow);\n                setWeatherClouds(activeMap.weather.clouds);\n                setWeatherFog(activeMap.weather.fog);\n                setWeatherThunder(activeMap.weather.thunder);\n                setWeatherLavaRain(activeMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(activeMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(activeMap.weather.meteorRain || 0);\n\n                if (activeMap.playerPosition) setPlayerPosition(activeMap.playerPosition);\n            }\n            \n            errorHandler.info('Project loaded successfully', {\n                component: 'Editor',\n                projectName: loaded.meta.projectName\n            });\n        } else if (loaded.meta) {\n            // Legacy 1.0 format\n            setMapWidth(loaded.meta.width);\n            setMapHeight(loaded.meta.height);\n\n            if (loaded.meta.name) setMapName(loaded.meta.name);\n            if (loaded.meta.author) setCreatorName(loaded.meta.author);\n            if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n            const bgLayer = loaded.layers.find(l => l.name === 'background');\n            const objLayer = loaded.layers.find(l => l.name === 'entities');\n            const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n            \n            const singleMap = {\n                id: 'main',\n                name: loaded.meta.name || \"Main Map\",\n                type: 'overworld',\n                mapWidth: loaded.meta.width,\n                mapHeight: loaded.meta.height,\n                tileMapData: bgLayer ? bgLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMapData: objLayer ? objLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                secretMapData: secretLayer ? secretLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMetadata: loaded.meta.objectMetadata || {},\n                selectedBackgroundImage: loaded.meta.backgroundImage,\n                selectedBackgroundColor: loaded.meta.backgroundColor,\n                backgroundParallaxFactor: loaded.meta.backgroundParallaxFactor || 0.3,\n                selectedBackgroundMusic: loaded.meta.backgroundMusic,\n                weather: loaded.meta.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                playerPosition: null\n            };\n\n            setMaps({ 'main': singleMap });\n            setActiveMapId('main');\n\n            if (bgLayer) setTileMapData(bgLayer.data);\n            if (objLayer) setObjectMapData(objLayer.data);\n            if (secretLayer) setSecretMapData(secretLayer.data);\n            \n            // Set other states\n            if (loaded.meta.backgroundImage) setSelectedBackgroundImage(loaded.meta.backgroundImage);\n            if (loaded.meta.backgroundColor) setSelectedBackgroundColor(loaded.meta.backgroundColor);\n            if (loaded.meta.backgroundParallaxFactor !== undefined) setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n            if (loaded.meta.backgroundMusic) setSelectedBackgroundMusic(loaded.meta.backgroundMusic);\n            if (loaded.meta.objectMetadata) setObjectMetadata(loaded.meta.objectMetadata);\n            if (loaded.meta.weather) {\n                setWeatherRain(loaded.meta.weather.rain || 0);\n                setWeatherSnow(loaded.meta.weather.snow || 0);\n                setWeatherClouds(loaded.meta.weather.clouds || 0);\n                setWeatherFog(loaded.meta.weather.fog || 0);\n                setWeatherThunder(loaded.meta.weather.thunder || 0);\n                setWeatherLavaRain(loaded.meta.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(loaded.meta.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(loaded.meta.weather.meteorRain || 0);\n            }\n            if (loaded.meta.playerPosition) setPlayerPosition(loaded.meta.playerPosition);\n\n            errorHandler.info('Map loaded successfully (Converted to Project)', {\n                component: 'Editor',\n                mapName: loaded.meta.name\n            });\n        } else {\n            // Oldest format\n            if (loaded.width) setMapWidth(loaded.width);\n            if (loaded.height) setMapHeight(loaded.height);\n            if (loaded.tiles) setTileMapData(loaded.tiles);\n            setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n            errorHandler.warn('Loaded map in legacy format', {\n                component: 'Editor'\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'applyMapData'\n        });\n        alert('Error applying map data. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    ...setters\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                applyMapData(loaded, setters);\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const loadBuiltInMap = ({\n    mapData,\n    ...setters\n}) => {\n    try {\n        applyMapData(mapData, setters);\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'loadBuiltInMap'\n        });\n        alert('Error loading built-in map.');\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets, objectMetadata: oldMeta } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        if (!oldArr) return newArr;\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[y * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    const resizeMetadata = (oldM) => {\n        const newM = {};\n        if (!oldM) return newM;\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                const oldIdx = y * oldW + x;\n                const newIdx = y * newWidth + x;\n                if (oldM[oldIdx]) {\n                    newM[newIdx] = oldM[oldIdx];\n                }\n            }\n        }\n        return newM;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets));\n    setObjectMetadata(resizeMetadata(oldMeta));\n};\n","import React from 'react';\n\nexport const ObjectLinks = React.memo(({ mapWidth, mapHeight, objectMapData, objectMetadata }) => {\n    const links = [];\n    const portals = [];\n    const targets = [];\n\n    // Collect all portals and targets with Trigger IDs\n    objectMapData.forEach((id, index) => {\n        if (!id) return;\n        const metadata = objectMetadata?.[index];\n        if (!metadata || metadata.triggerId === undefined || metadata.triggerId === null) return;\n\n        const x = (index % mapWidth) * 32 + 16;\n        const y = Math.floor(index / mapWidth) * 32 + 16;\n\n        if (id.includes('portal') && !id.includes('target')) {\n            portals.push({ x, y, id: metadata.triggerId });\n        } else if (id.includes('target') || id === 'portal_target') {\n            targets.push({ x, y, id: metadata.triggerId });\n        }\n    });\n\n    // Draw lines between matching IDs\n    portals.forEach(p => {\n        targets.forEach(t => {\n            if (p.id === t.id) {\n                links.push(\n                    <line\n                        key={`link-${p.x}-${p.y}-${t.x}-${t.y}`}\n                        x1={p.x} y1={p.y}\n                        x2={t.x} y2={t.y}\n                        stroke=\"#fff\"\n                        strokeWidth=\"2\"\n                        strokeDasharray=\"5,5\"\n                    />\n                );\n            }\n        });\n    });\n\n    return (\n        <svg style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: mapWidth * 32,\n            height: mapHeight * 32, // Note: mapHeight must be available\n            zIndex: 10,\n            pointerEvents: 'none',\n            opacity: 0.6\n        }}>\n            {links}\n        </svg>\n    );\n});\n","import React from 'react';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const EditorTile = React.memo(({\n    index,\n    x, y,\n    activeTool,\n    tileObj,\n    objObj,\n    secretObj,\n    objectMetadata,\n    isHighlighted,\n    parentRegionIndex,\n    borderStyle,\n    bgStyle,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleResizeStart,\n    handleMoveStart,\n    filter,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages\n}) => {\n    const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n    const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n    const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n    const isQuicksandTile = !!(tileObj && tileObj.flags && tileObj.flags.quicksand);\n    const isWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.waterfall);\n    const isLavaWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.lava_waterfall);\n    const isRadioactiveWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_water);\n    const isRadioactiveWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_waterfall);\n\n    const actualIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n    const triggerId = objectMetadata?.[actualIndex]?.triggerId;\n    const intensity = objectMetadata?.[actualIndex]?.intensity;\n    const messageText = objectMetadata?.[actualIndex]?.message;\n    const i18nChapter = objectMetadata?.[actualIndex]?.i18nChapter;\n    const i18nId = objectMetadata?.[actualIndex]?.i18nId;\n    const i18nText = objObj?.type === 'message_trigger' ? getTutorialText(i18nChapter, i18nId) : '';\n    const resolvedMessageText = messageText || i18nText;\n    \n    // Dimensijas emam no tie indeksa, lai izvairtos no citu objektu (piem. Room Area) \n    // ietekmes uz 1x1 objektiem, kas atrodas to robes.\n    const width = objectMetadata?.[index]?.width || 1;\n    const height = objectMetadata?.[index]?.height || 1;\n\n    const handleMouseDown = (e) => {\n        // If we're clicking a tile that's part of a region, we should interact with the anchor\n        const targetIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n        \n        if (activeTool === 'move') {\n            const hasMovable = objectMetadata[targetIndex] || objObj || secretObj;\n            if (hasMovable) {\n                e.stopPropagation();\n                handleMoveStart(targetIndex);\n                return;\n            }\n        }\n        handleGridMouseDown(index, e);\n    };\n\n    const isResizable = React.useMemo(() => {\n        if (!objObj && !secretObj) return false;\n        \n        // Room areas (windows) on room maps are NOT resizable\n        if (secretObj && secretObj.subtype === 'room' && mapType === 'room') return false;\n\n        // Specifically requested to disable for these types, except Room Areas which MUST be resizable\n        if (secretObj && secretObj.type === 'secret' && secretObj.subtype !== 'room') return false;\n        if (objObj && (objObj.type === 'crack_block' || objObj.type === 'wolf_secret')) return false;\n        return true;\n    }, [objObj, secretObj, mapType]);\n\n    const hasObjectOrSecret = objObj || secretObj || (parentRegionIndex !== null);\n\n    return (\n        <div\n            onMouseDown={handleMouseDown}\n            onMouseEnter={() => handleGridMouseEnter(index)}\n            style={{\n                width: '32px',\n                height: '32px',\n                border: borderStyle,\n                backgroundColor: bgStyle,\n                position: 'relative',\n                boxSizing: 'border-box',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                overflow: 'visible',\n                cursor: (activeTool === 'move' && hasObjectOrSecret) ? 'grab' : 'default'\n            }}>\n            \n            {isHighlighted && parentRegionIndex === null && isResizable && (\n                <>\n                    {/* Resize Handles */}\n                    {/* Right */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'right'); }}\n                        style={{ position: 'absolute', right: `${-(width-1)*32 - 6}px`, top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Left */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'left'); }}\n                        style={{ position: 'absolute', left: '-6px', top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Bottom */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'bottom'); }}\n                        style={{ position: 'absolute', bottom: `${-(height-1)*32 - 6}px`, left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                    {/* Top */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'top'); }}\n                        style={{ position: 'absolute', top: '-6px', left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                </>\n            )}\n\n            {/* Tile Layer */}\n            {tileObj && (\n                <div style={{ filter: filter ? filter('tile') : 'none', transition: 'filter 0.3s ease' }}>\n                    {isLiquidTile ? (\n                        <div style={{\n                            width: '32px', height: '32px',\n                            background: isLavaWaterfallTile ? 'rgba(255, 204, 0, 0.7)' : (isLavaTile ? 'rgba(255, 204, 0, 0.7)' : (isWaterTile || isWaterfallTile ? 'rgba(58, 127, 184, 0.7)' : (isQuicksandTile ? 'rgba(218, 165, 32, 0.7)' : (isRadioactiveWaterTile || isRadioactiveWaterfallTile ? 'rgba(50, 205, 50, 0.7)' : 'rgba(0, 255, 255, 0.3)')))),\n                            display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: '8px'\n                        }}>\n                            {isLavaWaterfallTile ? 'L.FALL' : (isLavaTile ? 'LAVA' : (isRadioactiveWaterfallTile ? 'RADFALL' : (isRadioactiveWaterTile ? 'RAD' : (isWaterTile ? 'WATER' : (isWaterfallTile ? 'FALL' : (isQuicksandTile ? 'QUICK' : 'LIQ'))))))}\n                        </div>\n                    ) : (\n                        <AnimatedItem\n                            textures={tileObj.textures}\n                            texture={tileObj.texture}\n                            speed={tileObj.animationSpeed}\n                            spriteSheet={tileObj.spriteSheet}\n                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\n                        />\n                    )}\n                </div>\n            )}\n\n            {/* Secret Layer */}\n            {secretObj && (secretObj.subtype !== 'room' || isRoomAreaVisible || showRoomMapContent || activeTool === 'area' || mapType === 'room') && (\n                <div style={{\n                    position: 'absolute', \n                    top: '0', left: '0',\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: secretObj.filterColorInEditor || secretObj.filterColor || 'rgba(128, 0, 128, 0.4)',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    color: '#fff', fontSize: '10px', fontWeight: 'bold', zIndex: 2,\n                    filter: filter ? filter('secret') : 'none', transition: 'filter 0.3s ease',\n                    border: '1px dashed rgba(255,255,255,0.5)',\n                    boxSizing: 'border-box',\n                    pointerEvents: 'none'\n                }}>\n                    {mapType !== 'room' && (secretObj.editorIcon || 'SECRET')}\n                </div>\n            )}\n\n            {/* Object Layer */}\n            {objObj && (() => {\n                const renderOffsetX = Number(objObj?.render?.offsetX) || 0;\n                const renderOffsetY = Number(objObj?.render?.offsetY) || 0;\n                const overlapX = Number(objObj?.render?.overlapX) || 0;\n                const overlapY = Number(objObj?.render?.overlapY) || 0;\n                const baseTop = objObj.type === 'decoration' ? 0 : 2;\n                const baseLeft = objObj.type === 'decoration' ? 0 : 2;\n                const baseWidth = objObj.type === 'decoration' ? (width * 32) : (width * 32 - 4);\n                const baseHeight = objObj.type === 'decoration' ? (height * 32) : (height * 32 - 4);\n                return (\n                <div style={{\n                    position: 'absolute', \n                    top: `${baseTop + renderOffsetY - overlapY / 2}px`,\n                    left: `${baseLeft + renderOffsetX - overlapX / 2}px`,\n                    width: `${baseWidth + overlapX}px`,\n                    height: `${baseHeight + overlapY}px`,\n                    zIndex: 3,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    filter: filter ? filter('object') : 'none', transition: 'filter 0.3s ease',\n                    pointerEvents: 'none' // Let clicks pass through to the tile for resizing handles\n                }}>\n                    {objObj.editorIcon ? (\n                        <span style={{\n                            fontSize: objObj.editorIcon === 'i18n' ? '12px' : '20px',\n                            width: '100%',\n                            height: '100%',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            backgroundColor: 'rgba(255,255,255,0.1)',\n                            border: '1px dashed rgba(255,255,255,0.3)',\n                            color: '#222',\n                            fontWeight: 700\n                        }}>{objObj.editorIcon}</span>\n                    ) : (\n                        <AnimatedItem\n                            textures={objObj.textures}\n                            texture={objObj.texture}\n                            speed={objObj.animationSpeed}\n                            spriteSheet={objObj.spriteSheet}\n                            frameIndex={objectMetadata?.[actualIndex]?.currentFrame !== undefined ? objectMetadata[actualIndex].currentFrame : (objObj.subtype === 'door' && mapType === 'room' ? (objObj.interaction?.frames?.inside || 2) : 0)}\n                            style={{ \n                                width: '100%', \n                                height: '100%', \n                                objectFit: objObj.type === 'decoration' ? 'cover' : 'contain', \n                                backgroundColor: objObj.type === 'decoration' ? 'transparent' : 'rgba(255,255,255,0.1)', \n                                border: objObj.type === 'decoration' ? 'none' : '1px dashed rgba(255,255,255,0.3)' \n                            }}\n                        />\n                    )}\n\n                    {objObj.type === 'message_trigger' && (\n                        <div style={{\n                            position: 'absolute',\n                            inset: '2px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            background: '#fff9c4',\n                            border: '1px solid #fbc02d',\n                            color: '#333',\n                            fontWeight: 700,\n                            fontSize: (objObj.editorIcon === 'i18n' || objObj.i18nMessage) ? '12px' : '18px'\n                        }}>\n                            {objObj.editorIcon || (objObj.i18nMessage ? 'i18n' : '')}\n                        </div>\n                    )}\n\n                    {/* Trigger ID */}\n                    {triggerId !== undefined && triggerId !== null && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', left: '0',\n                            backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 10, border: '1px solid #fff'\n                        }}>\n                            ID: {triggerId}\n                        </div>\n                    )}\n\n                    {/* Intensity */}\n                    {intensity !== undefined && intensity !== null && objObj && (objObj.type === 'weather_trigger' || objObj.hasIntensity) && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', right: '0',\n                            backgroundColor: 'rgba(0,100,200,0.8)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 11, border: '1px solid #fff'\n                        }}>\n                            {intensity}%\n                        </div>\n                    )}\n\n                    {/* Message Bubble */}\n                    {showMessages && objObj && objObj.type === 'message_trigger' && resolvedMessageText && (\n                        <div style={{\n                            position: 'absolute',\n                            left: '50%',\n                            bottom: '100%',\n                            transform: 'translateX(-50%)',\n                            marginBottom: '8px',\n                            maxWidth: '140px',\n                            backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                            color: '#222',\n                            border: '1px solid rgba(0,0,0,0.6)',\n                            borderRadius: '8px',\n                            padding: '4px 6px',\n                            fontSize: '10px',\n                            lineHeight: 1.2,\n                            textAlign: 'center',\n                            zIndex: 12,\n                            pointerEvents: 'none'\n                        }}>\n                            {resolvedMessageText}\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-6px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '6px solid transparent',\n                                borderRight: '6px solid transparent',\n                                borderTop: '6px solid rgba(255, 255, 255, 0.95)'\n                            }} />\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-7px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '7px solid transparent',\n                                borderRight: '7px solid transparent',\n                                borderTop: '7px solid rgba(0,0,0,0.6)',\n                                zIndex: -1\n                            }} />\n                        </div>\n                    )}\n                </div>\n                );\n            })()}\n\n            {/* Room Area Visibility Overlay */}\n            {(isRoomAreaVisible || showRoomMapContent || activeTool === 'area') && secretObj && secretObj.subtype === 'room' && mapType !== 'room' && (\n                <div style={{\n                    position: 'absolute',\n                    top: 0, left: 0,\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: 'rgba(255, 255, 0, 0.2)',\n                    border: '2px solid gold',\n                    boxSizing: 'border-box',\n                    zIndex: 4,\n                    pointerEvents: 'none',\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#000',\n                    fontSize: '10px',\n                    fontWeight: 'bold',\n                    textShadow: '0 0 2px #fff'\n                }}>\n                    <span style={{ fontSize: '14px' }}></span>\n                    <span style={{ whiteSpace: 'nowrap' }}>{objectMetadata?.[actualIndex]?.roomName || 'Unnamed'}</span>\n                    <span style={{ fontSize: '9px' }}>{width}x{height}m</span>\n                </div>\n            )}\n        </div>\n    );\n});\n","import React, { useCallback } from 'react';\nimport { ObjectLinks } from './viewport/ObjectLinks';\nimport { EditorTile } from './viewport/EditorTile';\nimport PixiStage from '../game/PixiStage';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    registryItems,\n    hoverIndex,\n    highlightedIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    handleResizeStart,\n    handleMoveStart,\n    setIsDragging,\n    selectedTile,\n    weatherRain,\n    weatherSnow,\n    weatherClouds,\n    weatherFog,\n    weatherThunder,\n    weatherLavaRain,\n    weatherRadioactiveFog,\n    weatherMeteorRain,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages,\n    maps\n}) => {\n    const isEraserActive = activeTool === 'brush' && selectedTile === null;\n    const isBrushActive = activeTool === 'brush';\n    const isBucketActive = activeTool === 'bucket';\n\n    const regions = React.useMemo(() => {\n        const res = [];\n        if (!objectMetadata) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            if (meta.width > 1 || meta.height > 1) {\n                const idx = parseInt(idxStr);\n                res.push({ \n                    idx, \n                    x: idx % mapWidth, \n                    y: Math.floor(idx / mapWidth), \n                    w: meta.width || 1, \n                    h: meta.height || 1 \n                });\n            }\n        }\n        return res;\n    }, [objectMetadata, mapWidth]);\n\n    const roomAreas = React.useMemo(() => {\n        const res = [];\n        if (!secretMapData || !objectMetadata || !showRoomMapContent) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                res.push({\n                    id: meta.linkedMapId,\n                    x: idx % mapWidth,\n                    y: Math.floor(idx / mapWidth),\n                    width: meta.width || 1,\n                    height: meta.height || 1,\n                    mapData: maps[meta.linkedMapId]\n                });\n            }\n        }\n        return res;\n    }, [secretMapData, objectMetadata, showRoomMapContent, maps, mapWidth]);\n\n    const getLayerColor = (layer, alpha = 0.5) => {\n        if (layer === 'tile') return `rgba(24, 144, 255, ${alpha})`;\n        if (layer === 'object') return `rgba(245, 34, 45, ${alpha})`;\n        if (layer === 'secret') return `rgba(114, 46, 209, ${alpha})`;\n        return `rgba(255, 255, 255, ${alpha})`;\n    };\n\n    const getGridStyles = () => {\n        let color = 'rgba(255, 255, 255, 0.15)';\n        let visible = showGrid;\n\n        if (isEraserActive) {\n            color = getLayerColor(activeLayer, 0.4);\n            visible = true;\n        } else if (isBrushActive || isBucketActive) {\n            color = getLayerColor(activeLayer, 0.25);\n            visible = true; // Auto-show grid when using drawing tools\n        }\n\n        return {\n            backgroundImage: visible ? `\n                linear-gradient(to right, ${color} 1px, transparent 1px),\n                linear-gradient(to bottom, ${color} 1px, transparent 1px)\n            ` : 'none',\n            backgroundSize: '32px 32px'\n        };\n    };\n\n    const getLayerFilter = useCallback((layer) => {\n        if (!isEraserActive) return 'none';\n        return activeLayer === layer ? 'none' : 'grayscale(100%) opacity(0.2) blur(2px)';\n    }, [isEraserActive, activeLayer]);\n\n    const getOverlayColor = () => {\n        if (!isEraserActive) return 'transparent';\n        if (activeLayer === 'tile') return 'rgba(24, 144, 255, 0.25)'; // Blueish for blocks\n        if (activeLayer === 'object') return 'rgba(245, 34, 45, 0.25)'; // Reddish for objects\n        if (activeLayer === 'secret') return 'rgba(114, 46, 209, 0.25)'; // Purplish for secrets\n        return 'transparent';\n    };\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => handleGridMouseUp(hoverIndex)}>\n            <div style={{ position: 'relative', width: 'fit-content' }} onMouseLeave={handleGridMouseLeave}>\n                \n                <ObjectLinks \n                    mapWidth={mapWidth} \n                    mapHeight={mapHeight} \n                    objectMapData={objectMapData} \n                    objectMetadata={objectMetadata} \n                />\n\n                {/* Room Map Content Overlay */}\n                {showRoomMapContent && roomAreas.map(room => (\n                    <div\n                        key={room.id}\n                        style={{\n                            position: 'absolute',\n                            left: room.x * 32,\n                            top: room.y * 32,\n                            width: room.width * 32,\n                            height: room.height * 32,\n                            zIndex: 6,\n                            pointerEvents: 'none',\n                            overflow: 'hidden',\n                            boxShadow: '0 0 15px rgba(0,0,0,0.5)',\n                            border: '2px solid #f39c12'\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={room.mapData.mapWidth}\n                            mapHeight={room.mapData.mapHeight}\n                            tileSize={32}\n                            tileMapData={room.mapData.tileMapData || []}\n                            objectMapData={room.mapData.objectMapData || []}\n                            secretMapData={room.mapData.secretMapData || []}\n                            objectMetadata={room.mapData.objectMetadata || {}}\n                            registryItems={registryItems}\n                            backgroundColor={room.mapData.selectedBackgroundColor}\n                            backgroundImage={room.mapData.selectedBackgroundImage}\n                            backgroundParallaxFactor={room.mapData.backgroundParallaxFactor}\n                            isEditor={true}\n                            mapType={room.mapData.type || 'room'}\n                        />\n                    </div>\n                ))}\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * 32, height: mapHeight * 32,\n                        backgroundImage: (selectedBackgroundUrl && showBackgroundImage && !isEraserActive) ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: (isEraserActive || !showBackgroundImage || !selectedBackgroundUrl) ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x', backgroundSize: 'auto 100%',\n                        zIndex: 0, pointerEvents: 'none'\n                    }}\n                />\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * 32, height: mapHeight * 32,\n                        backgroundColor: getOverlayColor(),\n                        zIndex: 5, pointerEvents: 'none',\n                        transition: 'background-color 0.3s ease'\n                    }}\n                />\n\n                {/* Top Grid Overlay */}\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * 32, height: mapHeight * 32,\n                        zIndex: 10, pointerEvents: 'none',\n                        ...getGridStyles()\n                    }}\n                />\n\n                {/* Weather Effects Overlay */}\n                {(weatherRain > 0 || weatherSnow > 0 || weatherClouds > 0 || weatherFog > 0 || weatherThunder > 0 || weatherLavaRain > 0 || weatherRadioactiveFog > 0 || weatherMeteorRain > 0) && (\n                    <div\n                        style={{\n                            position: 'absolute', top: 0, left: 0,\n                            width: mapWidth * 32, height: mapHeight * 32,\n                            zIndex: 15, pointerEvents: 'none',\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={[]}\n                            objectMapData={[]}\n                            registryItems={registryItems}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            renderLayers={['weather']}\n                            pointerEvents=\"none\"\n                        />\n                    </div>\n                )}\n\n                <div className=\"grid\"\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px', border: '1px solid #444', backgroundColor: 'transparent',\n                        position: 'relative', cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        let dTileId = tileMapData[index];\n                        let dObjId = objectMapData[index];\n                        let dSecId = secretMapData?.[index];\n\n                        if (selection && previewPosition) {\n                            const { w, h } = selection;\n                            const px = previewPosition.x;\n                            const py = previewPosition.y;\n                            if (x >= px && x < px + w && y >= py && y < py + h) {\n                                const idx = (y - py) * w + (x - px);\n                                dTileId = selection.tileData[idx];\n                                dObjId = selection.objectData[idx];\n                                dSecId = selection.secretData?.[idx];\n                            }\n                        }\n\n                        const tileObj = dTileId ? registryItems.find(r => r.id === dTileId) : null;\n                        const objObj = dObjId ? registryItems.find(r => r.id === dObjId) : null;\n                        const secretObj = dSecId ? registryItems.find(r => r.id === dSecId) : null;\n\n                        let borderStyle = 'none';\n                        let bgStyle = 'transparent';\n\n                        const layerColor = getLayerColor(activeLayer, 1);\n\n                        if (activeTool === 'brush' && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) {\n                                borderStyle = `1px dashed ${layerColor}`;\n                                if (isEraserActive) bgStyle = 'rgba(255, 0, 0, 0.1)';\n                            }\n                        } else if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                            else if (hoverIndex === index) borderStyle = '2px solid orange';\n                        } else if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid blue';\n                        } else if (activeTool === 'area') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { \n                                    borderStyle = '1px dashed gold'; \n                                    bgStyle = 'rgba(255, 255, 0, 0.2)'; \n                                }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid gold';\n                        }\n\n                        if (highlightedIndex === index) { borderStyle = '3px solid gold'; bgStyle = 'rgba(255, 215, 0, 0.4)'; }\n                        \n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                borderStyle = '2px solid cyan'; bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red'; bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n\n                        const parentRegion = regions.find(r => x >= r.x && x < r.x + r.w && y >= r.y && y < r.y + r.h);\n\n                        return (\n                            <EditorTile \n                                key={index}\n                                index={index}\n                                x={x} y={y}\n                                activeTool={activeTool}\n                                tileObj={tileObj}\n                                objObj={objObj}\n                                secretObj={secretObj}\n                                objectMetadata={objectMetadata}\n                                isHighlighted={highlightedIndex === index || (parentRegion && highlightedIndex === parentRegion.idx)}\n                                parentRegionIndex={parentRegion ? parentRegion.idx : null}\n                                borderStyle={borderStyle}\n                                bgStyle={bgStyle}\n                                handleGridMouseDown={handleGridMouseDown}\n                                handleGridMouseEnter={handleGridMouseEnter}\n                                handleResizeStart={handleResizeStart}\n                                handleMoveStart={handleMoveStart}\n                                filter={getLayerFilter}\n                                mapType={mapType}\n                                isRoomAreaVisible={isRoomAreaVisible}\n                                showRoomMapContent={showRoomMapContent}\n                                showMessages={showMessages}\n                            />\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const EditorToolsContainer = styled.div`\n    display: contents;\n`;\n\nexport const HeaderBar = styled.div`\n    padding: 0 15px;\n    background-color: #222;\n    border-bottom: none;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 60px;\n    box-sizing: border-box;\n    color: #fff;\n    z-index: 1105;\n    position: relative;\n\n    &::after {\n        content: \"\";\n        position: absolute;\n        left: 60px;\n        right: 0;\n        bottom: 0;\n        height: 1px;\n        background-color: #000;\n        pointer-events: none;\n    }\n`;\n\nexport const ToolsSection = styled.div`\n    display: flex;\n    gap: 15px;\n    align-items: center;\n`;\n\nexport const ToolsGroup = styled.div`\n    display: flex;\n    gap: 10px;\n    align-items: center;\n`;\n\nexport const ToolsInnerGroup = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsRow = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsEditorButton = styled.button`\n    min-width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : (props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : (props.$variant === 'danger' ? '#dc3545' : (props.$variant === 'secondary' ? '#f0f0f0' : '#333'))))};\n    color: ${props => props.$variant === 'secondary' ? '#333' : '#fff'};\n    border: 1px solid ${props => props.$active ? '#1E88E5' : (props.$variant === 'play' ? '#388E3C' : (props.$variant === 'pause' ? '#F57C00' : (props.$variant === 'danger' ? '#c82333' : (props.$variant === 'secondary' ? '#ccc' : '#fff'))))};\n    border-radius: 4px;\n    font-size: ${props => props.$small ? '14px' : '20px'};\n    font-weight: ${props => props.$variant === 'play' || props.$variant === 'pause' ? 'bold' : 'normal'};\n    line-height: 1;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: ${props => props.$square ? '0' : '0 15px'};\n    width: ${props => props.$square ? '40px' : 'auto'};\n    outline: none;\n    user-select: none;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : (props.$variant === 'play' ? '#45a049' : (props.$variant === 'pause' ? '#fb8c00' : (props.$variant === 'danger' ? '#bd2130' : (props.$variant === 'secondary' ? '#e0e0e0' : '#444'))))};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n\n    span {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n`;\n\nexport const StrikeThrough = styled.div`\n    position: absolute;\n    width: 100%;\n    height: 2px;\n    background-color: #f5222d;\n    transform: rotate(-45deg);\n    top: 50%;\n    left: 0;\n    z-index: 2;\n    pointer-events: none;\n`;\n\nexport const LayerIndicator = styled.div`\n    padding: 0 12px;\n    height: 40px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    font-size: 11px;\n    font-weight: 800;\n    text-transform: uppercase;\n    margin-right: 15px;\n    margin-left: 15px;\n    white-space: nowrap;\n    border: 1px solid;\n    box-sizing: border-box;\n    background-color: ${props => props.$bgColor || '#e6f7ff'};\n    border-color: ${props => props.$borderColor || '#91d5ff'};\n    color: ${props => props.$textColor || '#1890ff'};\n`;\n\nexport const BgColorContainer = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n`;\n\nexport const BgColorInputWrapper = styled.div`\n    position: relative;\n    display: flex;\n    align-items: center;\n`;\n\nexport const BgColorInput = styled.input`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    opacity: ${props => props.disabled ? 0.4 : 1};\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n`;\n\nexport const BgTransparentButton = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &::after {\n        content: \"\";\n        width: 100%;\n        height: 100%;\n        background-image: \n            linear-gradient(45deg, #ccc 25%, transparent 25%), \n            linear-gradient(-45deg, #ccc 25%, transparent 25%), \n            linear-gradient(45deg, transparent 75%, #ccc 75%), \n            linear-gradient(-45deg, transparent 75%, #ccc 75%);\n        background-size: 8px 8px;\n        background-position: 0 0, 0 4px, 4px 4px, 4px 0;\n        background-color: #fff;\n        opacity: 0.8;\n        border-radius: 2px;\n    }\n`;\n\nexport const PlayButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const PlayButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : '#333')};\n    color: #fff;\n    font-size: 18px;\n    box-sizing: border-box;\n`;\n\nexport const InfoContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    align-items: flex-start;\n    color: #bbb;\n    margin-left: auto;\n`;\n\nexport const InfoItem = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nexport const InfoLabel = styled.span`\n    font-size: 11px;\n    text-transform: uppercase;\n    opacity: 0.8;\n`;\n\nexport const InfoValue = styled.span`\n    color: #fff;\n    font-size: 12px;\n`;\n\nexport const EraserButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    //cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const EraserButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$active ? (props.$textColor || '#1890ff') : (props.$bgColor || '#f0f0f0')};\n    color: ${props => props.$active ? '#fff' : (props.$textColor || '#000')};\n    font-size: 11px;\n    font-weight: bold;\n    border: ${props => props.$active ? '1px solid #fff' : 'none'};\n    box-sizing: border-box;\n`;\n\nexport const SelectionActions = styled.div`\n    display: flex;\n    gap: 5px;\n    margin-left: 5px;\n    border-left: 1px solid #ccc;\n    padding-left: 5px;\n`;\n\nexport const ConfirmButton = styled(ToolsEditorButton)`\n    background-color: #e6f7ff;\n    color: #1890ff;\n    \n    &:hover {\n        background-color: #bae7ff;\n    }\n`;\n\nexport const CancelButton = styled(ToolsEditorButton)`\n    background-color: #fff1f0;\n    color: #f5222d;\n\n    &:hover {\n        background-color: #ffccc7;\n    }\n`;\n\nexport const GridIcon = styled.span`\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n`;\n","import styled from 'styled-components';\n\n/*\n* Container*/\nexport const SidebarContainer = styled.div`\n    width: 60px;\n    height: 100%;\n    background-color: #222;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding-top: 10px;\n    z-index: 1100;\n    border-right: 1px solid #000;\n    flex-shrink: 0;\n    overflow-y: auto;\n\n    &::-webkit-scrollbar {\n        width: 0px;\n        background: transparent;\n    }\n    \n    -ms-overflow-style: none;\n    scrollbar-width: none;\n`;\n\nexport const ElementEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const PanelContainer = styled.div`\n    position: absolute;\n    left: 60px;\n    top: 60px;\n    width: 320px;\n    height: calc(100% - 60px);\n    background-color: #fff;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    z-index: 1090;\n    box-shadow: 4px 0 10px rgba(0,0,0,0.2);\n    \n    /* Animation settings */\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;\n    transform: ${props => props.$isOpen ? 'translateX(0)' : 'translateX(-110%)'};\n    opacity: ${props => props.$isOpen ? '1' : '0'};\n    pointer-events: ${props => props.$isOpen ? 'all' : 'none'};\n`;\n\nexport const PanelHeader = styled.div`\n    padding: 8px 15px;\n    background-color: #f0f0f0;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 32px;\n    box-sizing: border-box;\n    color: #333;\n\n    span {\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n`;\n\nexport const PanelBody = styled.div`\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n`;\n\nexport const CloseButton = styled.button`\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 16px;\n    padding: 0 5px;\n    color: #666;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    outline: none;\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nexport const OperationButton = styled.button`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: ${props => props.$danger ? '#d32f2f' : '#000'};\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n    outline: none;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n\n// Also exporting as a label for file input usage in OperationsPanel\nexport const OperationLabel = styled.label`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: #000;\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n","import React from 'react';\nimport { ToolsEditorButton } from '../styles/EditorToolsButton';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    tempMapDescription,\n    setTempMapDescription,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', borderRadius: '8px',\n                boxShadow: '0 8px 24px rgba(0,0,0,0.2)', width: '320px',\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\n            }}>\n                <div style={{\n                    padding: '12px 15px',\n                    borderBottom: '2px solid #eee',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                }}>\n                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 'bold', color: '#333' }}>Create New Map</h3>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </div>\n\n                <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Map Name:</label>\n                        <input\n                            type=\"text\"\n                            value={tempMapName}\n                            onChange={(e) => setTempMapName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Creator Nickname:</label>\n                        <input\n                            type=\"text\"\n                            value={tempCreatorName}\n                            onChange={(e) => setTempCreatorName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Description:</label>\n                        <textarea\n                            value={tempMapDescription}\n                            onChange={(e) => setTempMapDescription(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box', minHeight: '60px', resize: 'vertical' }}\n                        />\n                    </div>\n\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                        <ToolsEditorButton onClick={onClose} $variant=\"secondary\" $small>\n                            Cancel\n                        </ToolsEditorButton>\n                        <ToolsEditorButton onClick={() => confirmNewMap(tempMapName, tempCreatorName, tempMapDescription)} $variant=\"play\" $small>\n                            Create\n                        </ToolsEditorButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { BUILT_IN_MAPS } from '../../../../constants/builtInMaps';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalHeader = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    font-size: 24px;\n    color: #333;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nexport const BuiltInMapsModal = ({ isOpen, onClose, onSelect }) => {\n    if (!isOpen) return null;\n\n    return (\n        <ModalOverlay onClick={onClose}>\n            <ModalContent onClick={e => e.stopPropagation()}>\n                <ModalHeader>\n                    <ModalTitle>Select a Built-in Map to Edit</ModalTitle>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </ModalHeader>\n                \n                <MapList>\n                    {BUILT_IN_MAPS.map((map, index) => {\n                        const isV2 = map.meta?.version === \"2.0\";\n                        const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                        const author = map.meta?.author || \"Unknown\";\n                        const description = map.meta?.description || \"\";\n                        \n                        let sizeInfo = \"\";\n                        let subMapInfo = \"\";\n\n                        if (isV2 && map.maps) {\n                            const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                            if (mainMap) {\n                                sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                            }\n                            \n                            const mapValues = Object.values(map.maps);\n                            const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                            const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                            \n                            subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                        } else {\n                            sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                        }\n\n                        return (\n                            <MapCard key={index} onClick={() => {\n                                onSelect(map);\n                                onClose();\n                            }}>\n                                <div>\n                                    <MapTitle>{projectName}</MapTitle>\n                                    <MapAuthor>By: {author}</MapAuthor>\n                                </div>\n                                {description && (\n                                    <MapDescription title={description}>\n                                        {description}\n                                    </MapDescription>\n                                )}\n                                <MapInfo>\n                                    <div>Size: {sizeInfo}{subMapInfo}</div>\n                                </MapInfo>\n                            </MapCard>\n                        );\n                    })}\n                </MapList>\n            </ModalContent>\n        </ModalOverlay>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nlet topZIndex = 1002;\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [position] = useState(defaultPosition);\n    const [zIndex, setZIndex] = useState(() => {\n        topZIndex += 1;\n        return topZIndex;\n    });\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    const lastHeightRef = useRef(0);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            if (height !== lastHeightRef.current) {\n                lastHeightRef.current = height;\n                onHeightChange(height);\n            }\n        }\n    });\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            topZIndex += 1;\n            setZIndex(topZIndex);\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#fff',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n                zIndex: zIndex,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh',\n                overflow: 'hidden'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '12px 15px',\n                    backgroundColor: '#fff',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '18px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '2px solid #eee',\n                    color: '#333'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0,\n                            color: '#333'\n                        }}\n                        title={isMinimized ? t('EDITOR_SCENE_WINDOW_MAXIMIZE') : t('EDITOR_SCENE_WINDOW_MINIMIZE')}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            color: '#333',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title={t('EDITOR_SCENE_WINDOW_CLOSE')}\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '15px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const EditorMapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(5, Math.min(100, startSize.width + blocksX));\n            const newHeight = Math.max(5, Math.min(100, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                {t('EDITOR_SCENE_RESIZER_LABEL')}{' '}\n                <span style={{ color: '#4CAF50' }}>{mapWidth} x {mapHeight}</span>{' '}\n                {t('EDITOR_SCENE_RESIZER_BLOCKS')}\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: -5,\n                        right: -5,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 {t('EDITOR_SCENE_RESIZER_HINT_LINE1')}<br/>\n                {t('EDITOR_SCENE_RESIZER_HINT_LINE2')}\n            </div>\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundColor\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = backgroundColor || '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.lava_waterfall) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.radioactive_waterfall) {\n                                ctx.fillStyle = '#32cd32';\n                            } else if (tile.flags.waterfall) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.water) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.quicksand) {\n                                ctx.fillStyle = '#a6915b';\n                            } else if (tile.flags.radioactive_water) {\n                                ctx.fillStyle = '#32cd32';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n        // Draw connections between portals and targets\n        if (objectMetadata) {\n            const portals = [];\n            const targets = [];\n\n            for (let i = 0; i < mapWidth * mapHeight; i++) {\n                const id = objectMapData[i];\n                if (!id) continue;\n                const metadata = objectMetadata[i];\n                if (!metadata || metadata.triggerId === null || metadata.triggerId === undefined) continue;\n\n                const pos = {\n                    x: (i % mapWidth) * tileWidth + tileWidth / 2,\n                    y: Math.floor(i / mapWidth) * tileHeight + tileHeight / 2\n                };\n\n                if (id.includes('portal') && !id.includes('target')) {\n                    portals.push({ triggerId: metadata.triggerId, pos });\n                } else if (id.includes('target') || id === 'portal_target') {\n                    targets.push({ triggerId: metadata.triggerId, pos });\n                }\n            }\n\n            portals.forEach(portal => {\n                const target = targets.find(t => t.triggerId === portal.triggerId);\n                if (target) {\n                    ctx.beginPath();\n                    ctx.setLineDash([5, 3]);\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.moveTo(portal.pos.x, portal.pos.y);\n                    ctx.lineTo(target.pos.x, target.pos.y);\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n                }\n            });\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, objectMetadata, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useRef, useEffect, useMemo, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WorldView = ({\n    maps,\n    activeMapId,\n    switchMap,\n    registryItems,\n    currentMapData,\n    createMap,\n    deleteMap,\n    updateMapData,\n    onAddRoomArea,\n    showRoomMapContent\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const canvasRef = useRef(null);\n    const containerRef = useRef(null);\n    const mapLayoutsRef = useRef({});\n    const dragRef = useRef(null); // { id, startX, startY, mapStartX, mapStartY }\n\n    // Prepare all maps data, using live data for the active map\n    const allMaps = useMemo(() => {\n        const result = { ...maps };\n        if (currentMapData && currentMapData.id && result[currentMapData.id]) {\n            result[currentMapData.id] = {\n                ...result[currentMapData.id],\n                mapWidth: currentMapData.mapWidth,\n                mapHeight: currentMapData.mapHeight,\n                tileMapData: currentMapData.tileMapData,\n                objectMapData: currentMapData.objectMapData,\n                objectMetadata: currentMapData.objectMetadata,\n                selectedBackgroundColor: currentMapData.selectedBackgroundColor\n            };\n        }\n        return Object.values(result);\n    }, [maps, currentMapData]);\n\n    // Draw function\n    const draw = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        \n        // Settings\n        const baseTileSize = 4; // Each tile in world view\n        \n        // Sync mapLayoutsRef with allMaps, but preserve positions for maps being dragged\n        const layouts = mapLayoutsRef.current;\n        \n        // Remove layouts for deleted maps\n        const currentIds = new Set(allMaps.map(m => m.id));\n        Object.keys(layouts).forEach(id => {\n            if (!currentIds.has(id)) {\n                delete layouts[id];\n            }\n        });\n\n        allMaps.forEach(map => {\n            const isDragging = dragRef.current && dragRef.current.id === map.id;\n            const w = map.mapWidth * baseTileSize;\n            const h = map.mapHeight * baseTileSize;\n\n            if (!layouts[map.id]) {\n                layouts[map.id] = { x: map.worldX || 0, y: map.worldY || 0, w, h, map };\n            } else {\n                layouts[map.id].w = w;\n                layouts[map.id].h = h;\n                layouts[map.id].map = map;\n                // Update position from props ONLY if not currently dragging this map\n                if (!isDragging) {\n                    layouts[map.id].x = map.worldX || 0;\n                    layouts[map.id].y = map.worldY || 0;\n                }\n            }\n        });\n\n        // Clear\n        ctx.fillStyle = '#222';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Grid (optional but helpful)\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 1;\n        for (let x = 0; x < canvas.width; x += 50) {\n            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();\n        }\n        for (let y = 0; y < canvas.height; y += 50) {\n            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();\n        }\n\n        // 1. Draw Maps\n        Object.values(layouts).forEach(layout => {\n            const { x, y, w, h, map } = layout;\n            const tileW = w / map.mapWidth;\n            const tileH = h / map.mapHeight;\n\n            // Background\n            ctx.fillStyle = map.selectedBackgroundColor || '#87CEEB';\n            ctx.fillRect(x, y, w, h);\n\n            // Active indicator\n            if (map.id === activeMapId) {\n                ctx.strokeStyle = '#e3de0a';\n                ctx.lineWidth = 3;\n                ctx.strokeRect(x - 4, y - 4, w + 8, h + 8);\n            } else {\n                ctx.strokeStyle = '#555';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, w, h);\n            }\n\n            // Name\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px Arial';\n            ctx.fillText(map.name, x, y - 10);\n            ctx.font = '10px Arial';\n            ctx.fillStyle = '#aaa';\n            ctx.fillText(map.type, x, y + h + 12);\n\n            // Delete button (X)\n            if (map.id !== 'main') {\n                ctx.fillStyle = '#ff4d4f';\n                ctx.fillRect(x + w - 15, y - 25, 15, 15);\n                ctx.fillStyle = '#fff';\n                ctx.font = 'bold 12px Arial';\n                ctx.fillText('', x + w - 11, y - 13);\n            }\n\n            // Draw Tiles & Objects (simplified)\n            for (let i = 0; i < map.mapWidth * map.mapHeight; i++) {\n                const tx = (i % map.mapWidth) * tileW + x;\n                const ty = Math.floor(i / map.mapWidth) * tileH + y;\n\n                const tileId = map.tileMapData[i];\n                const objId = map.objectMapData[i];\n                const secretId = map.secretMapData ? map.secretMapData[i] : null;\n                const meta = map.objectMetadata ? map.objectMetadata[i] : null;\n\n                // If it's a room area and we want to show content\n                if (showRoomMapContent && secretId === 'room_area' && meta?.linkedMapId && layouts[meta.linkedMapId]) {\n                    const roomMap = layouts[meta.linkedMapId].map;\n                    const rW = meta.width || 1;\n                    const rH = meta.height || 1;\n                    const rAreaW = rW * tileW;\n                    const rAreaH = rH * tileH;\n                    const rTileW = rAreaW / roomMap.mapWidth;\n                    const rTileH = rAreaH / roomMap.mapHeight;\n\n                    // Room Background\n                    ctx.fillStyle = roomMap.selectedBackgroundColor || '#1a1a1a';\n                    ctx.fillRect(tx, ty, rAreaW, rAreaH);\n                    \n                    // Room Tiles (very simplified)\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n                    for (let ri = 0; ri < roomMap.mapWidth * roomMap.mapHeight; ri++) {\n                        if (roomMap.tileMapData[ri]) {\n                            ctx.fillRect(\n                                tx + (ri % roomMap.mapWidth) * rTileW,\n                                ty + Math.floor(ri / roomMap.mapWidth) * rTileH,\n                                Math.ceil(rTileW), Math.ceil(rTileH)\n                            );\n                        }\n                    }\n                    \n                    // Room Border\n                    ctx.strokeStyle = '#f39c12';\n                    ctx.lineWidth = 0.5;\n                    ctx.strokeRect(tx, ty, rAreaW, rAreaH);\n                } else {\n                    if (tileId) {\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (objId) {\n                        if (objId.includes('portal') && !objId.includes('target')) {\n                            ctx.fillStyle = '#007bff';\n                        } else if (objId.includes('target') || objId === 'portal_target') {\n                            ctx.fillStyle = '#ffc107';\n                        } else {\n                            ctx.fillStyle = '#dc3545';\n                        }\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (secretId === 'room_area') {\n                        ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                        ctx.strokeStyle = 'gold';\n                        ctx.lineWidth = 1;\n                        ctx.strokeRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                    }\n                }\n            }\n        });\n\n        // 2. Draw Connections\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 2;\n\n        Object.values(layouts).forEach(sourceLayout => {\n            const { map: sourceMap, x: sx, y: sy, w: sw, h: sh } = sourceLayout;\n            const tileW = sw / sourceMap.mapWidth;\n            const tileH = sh / sourceMap.mapHeight;\n\n            const metadata = sourceMap.objectMetadata || {};\n            \n            for (let i = 0; i < sourceMap.mapWidth * sourceMap.mapHeight; i++) {\n                const objId = sourceMap.objectMapData[i];\n                if (!objId) continue;\n                \n                const meta = metadata[i];\n                if (!meta) continue;\n\n                // Identify if this is a connection source\n                const isPortalSource = objId.includes('portal') && !objId.includes('target');\n                const objDef = registryItems.find(r => r.id === objId);\n                const isDoorSource = objDef && objDef.subtype === 'door';\n\n                if (!isPortalSource && !isDoorSource) continue;\n\n                // For portals we match by triggerId, for doors by spawnTriggerId\n                const linkId = isPortalSource ? meta.triggerId : meta.spawnTriggerId;\n                if (linkId === null || linkId === undefined) continue;\n\n                const targetMapId = meta.targetMapId || sourceMap.id;\n                const targetLayout = layouts[targetMapId];\n\n                if (targetLayout) {\n                    const { map: targetMap, x: tx, y: ty, w: tw, h: th } = targetLayout;\n                    const tTileW = tw / targetMap.mapWidth;\n                    const tTileH = th / targetMap.mapHeight;\n\n                    // Find target object in target map\n                    for (let j = 0; j < targetMap.mapWidth * targetMap.mapHeight; j++) {\n                        const tObjId = targetMap.objectMapData[j];\n                        if (!tObjId) continue;\n\n                        const tObjDef = registryItems.find(r => r.id === tObjId);\n                        const isTarget = tObjId.includes('target') || tObjId === 'portal_target';\n                        const isDoorTarget = tObjDef && tObjDef.subtype === 'door';\n\n                        if (!isTarget && !isDoorTarget) continue;\n\n                        const tMeta = targetMap.objectMetadata?.[j];\n                        if (tMeta && tMeta.triggerId === linkId) {\n                            // Link found!\n                            const startX = sx + (i % sourceMap.mapWidth) * tileW + tileW / 2;\n                            const startY = sy + Math.floor(i / sourceMap.mapWidth) * tileH + tileH / 2;\n                            const endX = tx + (j % targetMap.mapWidth) * tTileW + tTileW / 2;\n                            const endY = ty + Math.floor(j / targetMap.mapWidth) * tTileH + tTileH / 2;\n\n                            // Draw line\n                            ctx.beginPath();\n                            ctx.strokeStyle = (sourceMap.id === targetMap.id) ? '#fff' : '#00ff00';\n                            ctx.moveTo(startX, startY);\n                            \n                            if (sourceMap.id !== targetMap.id) {\n                                // Calculate mid points for a nicer curve\n                                const cp1X = startX + (endX - startX) * 0.25;\n                                const cp1Y = Math.min(startY, endY) - 100;\n                                const cp2X = startX + (endX - startX) * 0.75;\n                                const cp2Y = Math.min(startY, endY) - 100;\n                                ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, endX, endY);\n                            } else {\n                                ctx.lineTo(endX, endY);\n                            }\n                            ctx.stroke();\n\n                            // Arrow head\n                            const angle = Math.atan2(endY - startY, endX - startX);\n                            ctx.save();\n                            ctx.setLineDash([]);\n                            ctx.translate(endX, endY);\n                            ctx.rotate(angle);\n                            ctx.beginPath();\n                            ctx.moveTo(0, 0);\n                            ctx.lineTo(-10, -5);\n                            ctx.lineTo(-10, 5);\n                            ctx.closePath();\n                            ctx.fillStyle = ctx.strokeStyle;\n                            ctx.fill();\n                            ctx.restore();\n                            \n                            break;\n                        }\n                    }\n                }\n            }\n        });\n    }, [allMaps, activeMapId, showRoomMapContent]);\n\n    useEffect(() => {\n        draw();\n    }, [allMaps, activeMapId, draw, showRoomMapContent]);\n\n    const handleMouseDown = (e) => {\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const layouts = Object.values(mapLayoutsRef.current || {});\n        \n        // Check for delete button first\n        for (const layout of layouts) {\n            if (layout.map.id !== 'main') {\n                const btnX = layout.x + layout.w - 15;\n                const btnY = layout.y - 25;\n                if (x >= btnX && x <= btnX + 15 && y >= btnY && y <= btnY + 15) {\n                    if (window.confirm(t('EDITOR_SCENE_WORLD_DELETE_CONFIRM', { name: layout.map.name }))) {\n                        deleteMap(layout.map.id);\n                    }\n                    return;\n                }\n            }\n        }\n\n        // Check for map drag/select\n        for (const layout of layouts) {\n            if (x >= layout.x && x <= layout.x + layout.w &&\n                y >= layout.y && y <= layout.y + layout.h) {\n                \n                if (e.detail === 2) { // Double click to switch\n                    switchMap(layout.map.id);\n                } else {\n                    dragRef.current = {\n                        id: layout.map.id,\n                        startX: x,\n                        startY: y,\n                        mapStartX: layout.x,\n                        mapStartY: layout.y\n                    };\n                }\n                return;\n            }\n        }\n    };\n\n    const handleMouseMove = (e) => {\n        if (!dragRef.current) return;\n\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const dx = x - dragRef.current.startX;\n        const dy = y - dragRef.current.startY;\n\n        const newX = Math.max(0, dragRef.current.mapStartX + dx);\n        const newY = Math.max(0, dragRef.current.mapStartY + dy);\n\n        // Update local layout for immediate visual feedback\n        if (mapLayoutsRef.current[dragRef.current.id]) {\n            mapLayoutsRef.current[dragRef.current.id].x = newX;\n            mapLayoutsRef.current[dragRef.current.id].y = newY;\n            draw();\n        }\n    };\n\n    const handleMouseUp = (e) => {\n        if (!dragRef.current) return;\n\n        const layout = mapLayoutsRef.current[dragRef.current.id];\n        if (layout) {\n            updateMapData(dragRef.current.id, {\n                worldX: layout.x,\n                worldY: layout.y\n            });\n        }\n        \n        dragRef.current = null;\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '10px' }}>\n            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n                <button\n                    onClick={() => switchMap('main')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#1e88e5', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_MAIN')}\n                </button>\n                <button \n                    onClick={() => createMap('overworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_OVERWORLD')}\n                </button>\n                <button \n                    onClick={() => createMap('underworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#5D4037', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_UNDERWORLD')}\n                </button>\n                <button \n                    onClick={onAddRoomArea}\n                    title={t('EDITOR_SCENE_WORLD_ADD_ROOM_TITLE')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#f39c12', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + m<sup>2</sup>\n                </button>\n                <div style={{ marginLeft: 'auto', color: '#ccc', fontSize: '11px' }}>\n                    {t('EDITOR_SCENE_WORLD_HELP')}\n                </div>\n            </div>\n\n            <div ref={containerRef} style={{ width: '100%', height: '500px', backgroundColor: '#333', overflow: 'auto', borderRadius: '4px', position: 'relative', border: '1px solid #555' }}>\n                <canvas\n                    ref={canvasRef}\n                    width={2000}\n                    height={2000}\n                    style={{ display: 'block', cursor: dragRef.current ? 'grabbing' : 'grab' }}\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseLeave={handleMouseUp}\n                />\n                <div style={{ position: 'absolute', bottom: '10px', right: '10px', backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '5px 10px', borderRadius: '4px', fontSize: '11px', pointerEvents: 'none' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#fff', border: '1px dashed #fff' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTRA')}</div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#00ff00', border: '1px dashed #00ff00' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTER')}</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const BackgroundPanel = ({ \n    backgroundOptions, \n    selectedBackgroundImage, \n    setSelectedBackgroundImage, \n    selectedBackgroundColor, \n    backgroundParallaxFactor, \n    setBackgroundParallaxFactor \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '12px' }}>{t('EDITOR_SCENE_BACKGROUND_IMAGE')}</span>\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>\n                    <div onClick={() => setSelectedBackgroundImage(null)}\n                        style={{\n                            border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #2196F3',\n                            borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                            boxShadow: !selectedBackgroundImage ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                        }}\n                        title={t('EDITOR_SCENE_BACKGROUND_SOLID')}>\n                        <div style={{ width: '100%', height: '60px', background: selectedBackgroundColor, display: 'block', borderRadius: '4px' }} />\n                        <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: !selectedBackgroundImage ? 'bold' : 'normal' }}>{t('EDITOR_SCENE_BACKGROUND_SOLID')}</div>\n                    </div>\n                    {backgroundOptions.map((bg) => (\n                        <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                            style={{\n                                border: selectedBackgroundImage === bg.metaPath ? '2px solid #2196F3' : '1px solid #ccc',\n                                borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                boxShadow: selectedBackgroundImage === bg.metaPath ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                            }}\n                            title={bg.name}>\n                            <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '60px', objectFit: 'cover', display: 'block', borderRadius: '4px' }} />\n                            <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: selectedBackgroundImage === bg.metaPath ? 'bold' : 'normal' }}>{bg.name}</div>\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            <section style={{ backgroundColor: '#f9f9f9', padding: '15px', borderRadius: '8px', border: '1px solid #ddd' }}>\n                <div style={{ marginBottom: '0px' }}>\n                    <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>{t('EDITOR_SCENE_BACKGROUND_PARALLAX')}</label>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                            onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))}\n                            style={{ flex: 1 }} />\n                        <span style={{ fontSize: '13px', fontWeight: 'bold', minWidth: '35px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                    </div>\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nexport const MusicPanel = ({ \n    musicOptions, \n    selectedBackgroundMusic, \n    setSelectedBackgroundMusic \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>{t('EDITOR_SCENE_MUSIC_TITLE')}</span>\n                <select\n                    value={selectedBackgroundMusic || ''}\n                    onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                    style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ccc', fontSize: '13px', marginBottom: '10px' }}>\n                    <option value=\"\">{t('EDITOR_SCENE_MUSIC_NONE')}</option>\n                    {musicOptions.map(m => (\n                        <option key={m.name} value={m.metaPath}>{m.name}</option>\n                    ))}\n                </select>\n                <div style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\n                    {t('EDITOR_SCENE_MUSIC_STATUS', {\n                        status: selectedBackgroundMusic ? t('EDITOR_SCENE_MUSIC_STATUS_SELECTED') : t('EDITOR_SCENE_MUSIC_STATUS_SILENCE')\n                    })}\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WeatherPanel = ({\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const weatherItems = [\n        { label: t('EDITOR_SCENE_WEATHER_RAIN'), value: weatherRain, setter: setWeatherRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_LAVA_RAIN'), value: weatherLavaRain, setter: setWeatherLavaRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_SNOW'), value: weatherSnow, setter: setWeatherSnow, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_METEOR_RAIN'), value: weatherMeteorRain, setter: setWeatherMeteorRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_CLOUDS'), value: weatherClouds, setter: setWeatherClouds, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_FOG'), value: weatherFog, setter: setWeatherFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_RADIO_FOG'), value: weatherRadioactiveFog, setter: setWeatherRadioactiveFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_THUNDER'), value: weatherThunder, setter: setWeatherThunder, icon: '' },\n    ];\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px', padding: '5px' }}>\n            {weatherItems.map((item) => (\n                <div key={item.label} style={{ \n                    backgroundColor: '#f9f9f9', \n                    padding: '12px', \n                    borderRadius: '8px', \n                    border: '1px solid #ddd' \n                }}>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\n                        <span style={{ fontSize: '13px', fontWeight: 'bold' }}>\n                            {item.icon} {item.label}\n                        </span>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', color: '#2196F3' }}>\n                            {item.value}%\n                        </span>\n                    </div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input \n                            type=\"range\" \n                            min=\"0\" \n                            max=\"100\" \n                            step=\"1\" \n                            value={item.value}\n                            onChange={(e) => item.setter(parseInt(e.target.value))}\n                            style={{ flex: 1, cursor: 'pointer' }} \n                        />\n                    </div>\n                </div>\n            ))}\n            <div style={{ fontSize: '11px', color: '#888', fontStyle: 'italic', textAlign: 'center', marginTop: '5px' }}>\n                {t('EDITOR_SCENE_WEATHER_HINT')}\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const SceneEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const RightSidebarContainer = styled.div`\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    z-index: 1100;\n`;\n","import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { DraggableWindow } from './editorScene/DraggableWindow';\nimport { EditorMapResizer } from './editorScene/EditorMapResizer';\nimport { Minimap } from './editorScene/Minimap';\nimport { WorldView } from './editorScene/WorldView';\nimport { BackgroundPanel } from './editorScene/BackgroundPanel';\nimport { MusicPanel } from './editorScene/MusicPanel';\nimport { WeatherPanel } from './editorScene/WeatherPanel';\nimport { SceneEditorButton, RightSidebarContainer } from './styles/EditorSceneButtonStyle';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\n\nexport const EditorScene = ({\n    handleMapResize,\n    isResizeWindowOpen,\n    setIsResizeWindowOpen,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain,\n    // New props for multi-map\n    maps,\n    activeMapId,\n    switchMap,\n    createMap,\n    deleteMap,\n    updateMapData,\n    isWorldViewOpen,\n    setIsWorldViewOpen,\n    onAddRoomArea,\n    showRoomMapContent,\n    activeRoomIds\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [isMinimapOpen, setIsMinimapOpen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isBackgroundOpen, setIsBackgroundOpen] = useState(false);\n    const [isMusicOpen, setIsMusicOpen] = useState(false);\n\n    return (\n        <div style={{ display: 'contents' }}>\n            <BackgroundMusicPlayer \n                metaPath={selectedBackgroundMusic} \n                enabled={true} \n                volume={0.4} \n                isInsideRoom={activeRoomIds?.length > 0}\n            />\n            {/* Right side buttons */}\n            <RightSidebarContainer>\n                <SceneEditorButton onClick={() => setIsMinimapOpen(!isMinimapOpen)} $active={isMinimapOpen} title={t('EDITOR_SCENE_BUTTON_MAPS_MINIMAP')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsWorldViewOpen(!isWorldViewOpen)} $active={isWorldViewOpen} title={t('EDITOR_SCENE_BUTTON_WORLD_VIEW')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsBackgroundOpen(!isBackgroundOpen)} $active={isBackgroundOpen} title={t('EDITOR_SCENE_BUTTON_BACKGROUND')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsMusicOpen(!isMusicOpen)} $active={isMusicOpen} title={t('EDITOR_SCENE_BUTTON_MUSIC')}>\n                    <span style={{ color: '#fff' }}></span>\n                </SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsSettingsOpen(!isSettingsOpen)} $active={isSettingsOpen} title={t('EDITOR_SCENE_BUTTON_SETTINGS')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} $active={isResizeWindowOpen} title={t('EDITOR_SCENE_BUTTON_RESIZE')}></SceneEditorButton>\n            </RightSidebarContainer>\n\n            {/* Floating Windows */}\n            {isMinimapOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MINIMAP')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsMinimapOpen(false)}\n                >\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '5px' }}>\n                        <Minimap\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            backgroundColor={selectedBackgroundColor}\n                        />\n                        <div style={{ fontSize: '12px', color: '#ccc', textAlign: 'center' }}>\n                            {maps[activeMapId]?.name || t('EDITOR_SCENE_MINIMAP_CURRENT_MAP')}\n                        </div>\n                    </div>\n                </DraggableWindow>\n            )}\n\n            {isWorldViewOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_WORLD_VIEW')}\n                    defaultPosition={{ x: 100, y: 100 }}\n                    defaultWidth={800}\n                    isOpenDefault={true}\n                    onClose={() => setIsWorldViewOpen(false)}\n                >\n                    <WorldView \n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        registryItems={registryItems}\n                        createMap={createMap}\n                        deleteMap={deleteMap}\n                        updateMapData={updateMapData}\n                        onAddRoomArea={onAddRoomArea}\n                        showRoomMapContent={showRoomMapContent}\n                        // Current map live data\n                        currentMapData={{\n                            id: activeMapId,\n                            mapWidth,\n                            mapHeight,\n                            tileMapData,\n                            objectMapData,\n                            objectMetadata,\n                            selectedBackgroundColor\n                        }}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isBackgroundOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_BACKGROUND')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsBackgroundOpen(false)}\n                >\n                    <BackgroundPanel \n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isMusicOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MUSIC')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 300 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsMusicOpen(false)}\n                >\n                    <MusicPanel \n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isSettingsOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_SETTINGS')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 400 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsSettingsOpen(false)}\n                >\n                    <WeatherPanel \n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_RESIZE')}\n                    defaultPosition={{ x: 400, y: 100 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsResizeWindowOpen(false)}\n                >\n                    <EditorMapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={handleMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { OperationButton, OperationLabel } from '../styles/EditorElementsButtonStyle';\n\nexport const OperationsPanel = ({ \n    openNewMapModal, \n    saveMap, \n    loadMap, \n    openBuiltInModal,\n    clearMap, \n    mapName, \n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const inputStyle = {\n        width: '100%',\n        border: '1px solid transparent',\n        background: 'transparent',\n        padding: '4px 6px',\n        fontSize: '13px',\n        fontWeight: 'bold',\n        outline: 'none',\n        borderRadius: '4px',\n        boxSizing: 'border-box',\n        transition: 'all 0.2s ease',\n        cursor: 'pointer'\n    };\n\n    const handleFocus = (e) => {\n        e.target.style.borderColor = '#2196F3';\n        e.target.style.backgroundColor = '#fff';\n        e.target.style.cursor = 'text';\n    };\n\n    const handleBlur = (e) => {\n        e.target.style.borderColor = 'transparent';\n        e.target.style.backgroundColor = 'transparent';\n        e.target.style.cursor = 'pointer';\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\n            <div style={{ \n                padding: '15px', \n                backgroundColor: '#f9f9f9', \n                borderRadius: '8px', \n                border: '1px solid #ddd', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px' \n            }}>\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\n                    <OperationButton onClick={openNewMapModal} title={t('EDITOR_ELEMENTS_OP_NEW_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_NEW')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={saveMap} title={t('EDITOR_ELEMENTS_OP_SAVE_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_SAVE')}</span>\n                    </OperationButton>\n                    <OperationLabel title={t('EDITOR_ELEMENTS_OP_LOAD_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_LOAD')}</span>\n                        <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} />\n                    </OperationLabel>\n                    <OperationButton onClick={openBuiltInModal} title={t('EDITOR_ELEMENTS_OP_BUILT_IN_MAPS_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_BUILT_IN')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={clearMap} $danger title={t('EDITOR_ELEMENTS_OP_CLEAR_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_CLEAR')}</span>\n                    </OperationButton>\n                </div>\n            </div>\n\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_MAP_NAME_LABEL')}</label>\n                    <input \n                        value={mapName} \n                        onChange={(e) => setMapName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_MAP_NAME_TITLE')}\n                    />\n                </div>\n                \n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_AUTHOR_LABEL')}</label>\n                    <input \n                        value={creatorName} \n                        onChange={(e) => setCreatorName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_AUTHOR_TITLE')}\n                    />\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_DESCRIPTION_LABEL')}</label>\n                    <textarea \n                        value={mapDescription} \n                        onChange={(e) => setMapDescription(e.target.value)}\n                        style={{ ...inputStyle, fontWeight: 'normal', minHeight: '60px', resize: 'vertical' }}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_DESCRIPTION_TITLE')}\n                    />\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const CollapsiblePanel = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '4px 6px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none', lineHeight: 1.1, minHeight: '20px' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { CollapsiblePanel } from './CollapsiblePanel';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport i18n from '../../../../i18n/i18n';\nimport { getTutorialChapters, getTutorialItems } from '../../../../i18n/tutorialMessages';\n\nexport const PalettePanel = ({ \n    isPlayMode, \n    category,\n    blocks, \n    liquids, \n    entities, \n    decorations, \n    items, \n    interactables, \n    hazards, \n    secrets, \n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    objectMetadata,\n    setObjectMetadata,\n    objectMapData,\n    highlightedIndex,\n    setHighlightedIndex,\n    registryItems,\n    handlePaletteSelect, \n    selectedTile \n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [selectedChapter, setSelectedChapter] = useState('');\n\n    const currentLang = i18n?.language || 'en';\n    const tutorialChapters = useMemo(() => getTutorialChapters(currentLang), [currentLang]);\n    const tutorialItems = useMemo(\n        () => (selectedChapter ? getTutorialItems(selectedChapter, currentLang) : []),\n        [selectedChapter, currentLang]\n    );\n\n    useEffect(() => {\n        if (!selectedChapter && tutorialChapters.length > 0) {\n            setSelectedChapter(tutorialChapters[0]);\n        } else if (selectedChapter && !tutorialChapters.includes(selectedChapter)) {\n            setSelectedChapter(tutorialChapters[0] || '');\n        }\n    }, [tutorialChapters, selectedChapter]);\n\n    const getLiquidLabel = ({\n        isLavaWaterfall,\n        isLava,\n        isRadioactiveWaterfall,\n        isRadioactive,\n        isWater,\n        isWaterfall,\n        isQuicksand\n    }) => {\n        if (isLavaWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LFALL');\n        if (isLava) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LAVA');\n        if (isRadioactiveWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RADFALL');\n        if (isRadioactive) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RAD');\n        if (isWater) return t('EDITOR_ELEMENTS_LIQUID_LABEL_WATER');\n        if (isWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_FALL');\n        if (isQuicksand) return t('EDITOR_ELEMENTS_LIQUID_LABEL_QUICK');\n        return t('EDITOR_ELEMENTS_LIQUID_LABEL_LIQ');\n    };\n\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const editorIcon = item.editorIcon;\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isQuicksand = !!(item.flags && item.flags.quicksand);\n        const isWaterfall = !!(item.flags && item.flags.waterfall);\n        const isLavaWaterfall = !!(item.flags && item.flags.lava_waterfall);\n        const isRadioactive = !!(item.flags && item.flags.radioactive);\n        const isRadioactiveWaterfall = !!(item.flags && item.flags.radioactive_waterfall);\n        const isSecret = item.type === 'secret';\n        const isWeatherTrigger = item.type === 'weather_trigger';\n        const isMessageTrigger = item.type === 'message_trigger';\n        \n        const swatchStyle = isLavaWaterfall\n            ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isWater || isWaterfall ? { background: 'linear-gradient(180deg,#3a7fb8,#5ba3d9)' }\n            : (isQuicksand ? { background: 'linear-gradient(180deg,#a6915b,#7d6d42)' }\n            : (isRadioactive || isRadioactiveWaterfall ? { background: 'linear-gradient(180deg,#1a5c1a,#32cd32)' }\n            : { background: '#eee' }))));\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.displayName || item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColorInEditor || item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.editorIcon || (item.subtype === 'above' ? t('EDITOR_ELEMENTS_SECRET_ABOVE') : t('EDITOR_ELEMENTS_SECRET_BELOW'))}\n                    </div>\n                ) : (isWeatherTrigger || isMessageTrigger) ? (\n                    hasImage ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            spriteSheet={item.spriteSheet}\n                            style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                            alt={item.name}\n                        />\n                    ) : (\n                        (() => {\n                            const iconText = item.editorIcon || (item.i18nMessage ? 'i18n' : '');\n                            return (\n                        <div style={{\n                            width: '100%', height: '100%', borderRadius: 2,\n                            display: 'flex', alignItems: 'center', justifyContent: 'center',\n                            background: isMessageTrigger ? '#fff9c4' : '#f0f4f8', \n                            border: isMessageTrigger ? '1px solid #fbc02d' : '1px solid #d1d9e6',\n                            color: '#333', fontSize: (iconText === 'i18n' ? '12px' : '18px'), fontWeight: 700\n                        }}>\n                            {iconText}\n                        </div>\n                            );\n                        })()\n                    )\n                ) : editorIcon ? (\n                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>\n                        {editorIcon}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        spriteSheet={item.spriteSheet}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid\n                            ? getLiquidLabel({\n                                isLavaWaterfall,\n                                isLava,\n                                isRadioactiveWaterfall,\n                                isRadioactive,\n                                isWater,\n                                isWaterfall,\n                                isQuicksand\n                            })\n                            : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    if (isPlayMode) {\n        return (\n            <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                {t('EDITOR_ELEMENTS_PALETTE_DISABLED')}\n            </div>\n        );\n    }\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            {category === 'blocks' && (() => {\n                const getBlockGroup = (b) => {\n                    if (b.editor?.group) return b.editor.group;\n                    const name = (b.id || b.name || '').toLowerCase();\n                    if (name.includes('brick')) return 'bricks';\n                    if (name.includes('diorite') || name.includes('stone')) return 'stone';\n                    if (name.includes('metal')) return 'metal';\n                    if (name.includes('wood')) return 'wood';\n                    return 'ground';\n                };\n\n                const groupOrder = [\n                    { key: 'ground', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_GROUND'), color: 'blue', open: true },\n                    { key: 'bricks', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_BRICKS'), color: 'blue', open: true },\n                    { key: 'stone', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_STONE'), color: 'blue', open: true },\n                    { key: 'metal', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_METAL'), color: 'blue', open: true },\n                    { key: 'wood', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_WOOD'), color: 'blue', open: true }\n                ];\n\n                const withGroups = blocks.map(b => ({\n                    item: b,\n                    group: getBlockGroup(b)\n                }));\n\n                const sortBlocks = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(b => b.group === group.key).sort(sortBlocks);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(b => renderPaletteItem(b.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(b => !groupOrder.some(g => g.key === b.group)).sort(sortBlocks);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(b => renderPaletteItem(b.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'liquids' && (() => {\n                const getLiquidGroup = (li) => {\n                    if (li.editor?.group) return li.editor.group;\n                    if (li.flags?.quicksand) return 'quicksand';\n                    if (li.flags?.lava || li.flags?.lava_waterfall) return 'lava';\n                    if (li.flags?.radioactive || li.flags?.radioactive_waterfall) return 'radiation';\n                    if (li.flags?.water || li.flags?.waterfall) return 'water';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'quicksand', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_QUICKSAND'), color: 'goldenrod', open: true },\n                    { key: 'water', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_WATER'), color: 'blue', open: true },\n                    { key: 'lava', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_LAVA'), color: 'orange', open: true },\n                    { key: 'radiation', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_RADIATION'), color: 'green', open: true }\n                ];\n\n                const withGroups = liquids.map(li => ({\n                    item: li,\n                    group: getLiquidGroup(li)\n                }));\n\n                const sortLiquids = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(li => li.group === group.key).sort(sortLiquids);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(li => renderPaletteItem(li.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(li => !groupOrder.some(g => g.key === li.group)).sort(sortLiquids);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_LIQUIDS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_LIQUIDS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(li => renderPaletteItem(li.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'decorations' && (\n                <CollapsiblePanel title={t('EDITOR_ELEMENTS_DECORATIONS_TITLE')} isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {decorations && decorations.map(d => renderPaletteItem(d, 'purple', 'object'))}\n                    </div>\n                </CollapsiblePanel>\n            )}\n\n            {category === 'entities' && (() => {\n                const getEntityGroup = (e) => {\n                    if (e.editor?.group) return e.editor.group;\n                    const name = (e.id || e.name || '').toLowerCase();\n                    if (name.includes('player')) return 'player';\n                    if (name.includes('fish') || name.includes('animal')) return 'animals';\n                    return 'enemies';\n                };\n\n                const groupOrder = [\n                    { key: 'player', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_PLAYER'), color: 'red', open: true },\n                    { key: 'animals', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ANIMALS'), color: 'red', open: true },\n                    { key: 'enemies', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ENEMIES'), color: 'red', open: true }\n                ];\n\n                const withGroups = entities.map(e => ({\n                    item: e,\n                    group: getEntityGroup(e)\n                }));\n\n                const sortEntities = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(e => e.group === group.key).sort(sortEntities);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(e => renderPaletteItem(e.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(e => !groupOrder.some(g => g.key === e.group)).sort(sortEntities);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ENTITIES_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ENTITIES_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(e => renderPaletteItem(e.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'items' && (() => {\n                const getItemGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.effect?.health) return 'health';\n                    if (i.effect?.fireball) return 'ammunition';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'health', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_HEALTH'), color: 'green', open: true },\n                    { key: 'ammunition', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_AMMUNITION'), color: 'green', open: true }\n                ];\n\n                const withGroups = items.map(i => ({\n                    item: i,\n                    group: getItemGroup(i)\n                }));\n\n                const sortItems = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(i => i.group === group.key).sort(sortItems);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortItems);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ITEMS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ITEMS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'interactables' && (() => {\n                const getInteractableGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.subtype === 'door') return 'entrances';\n                    if (i.subtype === 'ladder') return 'ledders';\n                    if (i.subtype === 'platform' || i.subtype === 'arrow') return 'platforms';\n                    if ((i.id || '').includes('portal') || (i.name || '').includes('portal')) return 'ports';\n                    if (i.subtype === 'end') return 'ends';\n                    const name = (i.id || i.name || '').toLowerCase();\n                    if (name.includes('berry')) return 'harvestables';\n                    if (name.includes('stone') || name.includes('wooden_box')) return 'physics';\n                    if (name.includes('ice')) return 'blocks';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'harvestables', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_HARVESTABLES'), color: 'purple', open: true },\n                    { key: 'physics', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PHYSIC'), color: 'purple', open: true },\n                    { key: 'entrances', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENTRANCES'), color: 'purple', open: true },\n                    { key: 'platforms', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PLATFORMS'), color: 'purple', open: true },\n                    { key: 'ledders', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_LEDDERS'), color: 'purple', open: true },\n                    { key: 'ports', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PORTS'), color: 'purple', open: true },\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_BLOCKS'), color: 'purple', open: true },\n                    { key: 'ends', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENDS'), color: 'purple', open: true }\n                ];\n\n                const withGroups = interactables.map(i => ({\n                    item: i,\n                    group: getInteractableGroup(i)\n                }));\n\n                const sortInteractables = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(i => i.group === group.key).sort(sortInteractables);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortInteractables);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'hazards' && (() => {\n                const getHazardGroup = (h) => {\n                    if (h.editor?.group) return h.editor.group;\n                    if (h.collision) return 'blocks';\n                    return 'obstacles';\n                };\n\n                const groupOrder = [\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_BLOCKS'), color: 'orange', open: true },\n                    { key: 'obstacles', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_OBSTACLES'), color: 'brown', open: true }\n                ];\n\n                const withGroups = hazards.map(h => ({\n                    item: h,\n                    group: getHazardGroup(h)\n                }));\n\n                const sortHazards = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(h => h.group === group.key).sort(sortHazards);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(h => renderPaletteItem(h.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(h => !groupOrder.some(g => g.key === h.group)).sort(sortHazards);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_HAZARDS_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(h => renderPaletteItem(h.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'secrets' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_OPEN_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'open').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n                    \n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_SECRET_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype !== 'open' && s.subtype !== 'room' && s.subtype !== 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_CRACKABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {crackableWalls && crackableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_PUSHABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {pushableWalls && pushableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_ANIMAL_TRIGGERS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'weather' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'rain').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_SNOW')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'snow').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_CLOUDS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'clouds').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'fog').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_THUNDER')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'thunder').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_LAVA_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'lavaRain').map(w => renderPaletteItem(w, 'red', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RADIO_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'radioactiveFog').map(w => renderPaletteItem(w, 'green', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_METEOR_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'meteorRain').map(w => renderPaletteItem(w, 'orange', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'messages' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_MESSAGES_TITLE')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {messages && messages.map(m => renderPaletteItem(m, 'gold', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                    {selectedTile && (selectedTile.i18nMessage || selectedTile.type === 'message_trigger') && (\n                        <CollapsiblePanel title={t('EDITOR_ELEMENTS_I18N_TITLE')} isOpenDefault={true}>\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>\n                                    {tutorialChapters.map(ch => (\n                                        <button\n                                            key={ch}\n                                            onClick={() => setSelectedChapter(ch)}\n                                            style={{\n                                                padding: '4px 8px',\n                                                fontSize: '11px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ccc',\n                                                background: ch === selectedChapter ? '#f4c542' : '#f0f0f0',\n                                                cursor: 'pointer'\n                                            }}\n                                        >\n                                            {ch}\n                                        </button>\n                                    ))}\n                                </div>\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '6px', maxHeight: '200px', overflowY: 'auto' }}>\n                                    {tutorialItems.map(item => (\n                                        <button\n                                            key={`${selectedChapter}_${item.id}`}\n                                            onClick={() => {\n                                                let targetIndex = highlightedIndex;\n                                                if ((targetIndex === null || targetIndex === undefined) && selectedTile?.id && objectMapData) {\n                                                    const idx = objectMapData.findIndex(id => id === selectedTile.id);\n                                                    if (idx >= 0) {\n                                                        targetIndex = idx;\n                                                        if (setHighlightedIndex) setHighlightedIndex(idx);\n                                                    }\n                                                }\n                                                if (targetIndex === null || targetIndex === undefined) return;\n                                                const objId = objectMapData?.[targetIndex];\n                                                const objDef = registryItems?.find(r => r.id === objId);\n                                                if (!objDef || objDef.type !== 'message_trigger') return;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [targetIndex]: {\n                                                        ...prev[targetIndex],\n                                                        i18nChapter: selectedChapter,\n                                                        i18nId: item.id,\n                                                        message: ''\n                                                    }\n                                                }));\n                                            }}\n                                            style={{\n                                                display: 'flex',\n                                                alignItems: 'center',\n                                                justifyContent: 'space-between',\n                                                gap: '8px',\n                                                padding: '6px 8px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ddd',\n                                                background: '#fff',\n                                                cursor: 'pointer',\n                                                textAlign: 'left'\n                                            }}\n                                        >\n                                            <span style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_I18N_ID', { id: item.id })}</span>\n                                            <span style={{ fontSize: '11px', color: '#222', flex: 1 }}>{item.text}</span>\n                                        </button>\n                                    ))}\n                                </div>\n                                {(highlightedIndex === null || highlightedIndex === undefined) && (\n                                    <div style={{ fontSize: '11px', color: '#888' }}>\n                                        {t('EDITOR_ELEMENTS_I18N_SELECT_HINT')}\n                                    </div>\n                                )}\n                            </div>\n                        </CollapsiblePanel>\n                    )}\n                </div>\n            )}\n\n            {category === 'obstacles' && (\n                <CollapsiblePanel title={t('EDITOR_ELEMENTS_OBSTACLES_TITLE')} isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {obstacles && obstacles.length > 0 ? (\n                            obstacles.map(o => renderPaletteItem(o, 'brown', 'object'))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                {t('EDITOR_ELEMENTS_OBSTACLES_EMPTY')}\n                            </div>\n                        )}\n                    </div>\n                </CollapsiblePanel>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\n\nexport const StatisticsPanel = ({ \n    totalTiles, \n    mapWidth, \n    mapHeight, \n    filledBlocks, \n    objectsCount, \n    emptyBlocks,\n    objectMapData,\n    registryItems,\n    maps\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const registryMap = registryItems && registryItems.__byId;\n    const getDef = (id) => {\n        if (!id) return null;\n        if (registryMap && typeof registryMap.get === 'function') return registryMap.get(id) || null;\n        return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    let itemsCount = 0;\n    let entitiesCount = 0;\n\n    if (Array.isArray(objectMapData)) {\n        objectMapData.forEach((id) => {\n            if (!id) return;\n            const def = getDef(id);\n            if (!def) return;\n            const name = (def.name || '').toLowerCase();\n            if (name.startsWith('item.')) itemsCount += 1;\n            if (def.type === 'entity' || def.subtype === 'tank' || def.subtype === 'platform' || name.includes('entities.')) {\n                entitiesCount += 1;\n            }\n        });\n    }\n\n    const mapList = maps ? Object.values(maps) : [];\n    const mapsTotal = mapList.length;\n    const mapsOverworld = mapList.filter(m => m.type === 'overworld').length;\n    const mapsUnderworld = mapList.filter(m => m.type === 'underworld').length;\n    const mapsRooms = mapList.filter(m => m.type === 'room').length;\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n            <div style={{ padding: '15px', backgroundColor: '#e6f7ff', borderRadius: '8px', border: '1px solid #91d5ff' }}>\n                <div style={{ fontSize: '14px', marginBottom: '8px' }}>\n                    <Trans i18nKey=\"EDITOR_ELEMENTS_STATS_TOTAL_AREA\" t={t} values={{ count: totalTiles }} components={[<strong key=\"count\" />]} />\n                </div>\n                <div style={{ fontSize: '13px', color: '#0050b3' }}>{t('EDITOR_ELEMENTS_STATS_DIMENSIONS', { width: mapWidth, height: mapHeight })}</div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#f6ffed', borderRadius: '8px', border: '1px solid #b7eb8f', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#389e0d' }}>{filledBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_FILLED_BLOCKS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#fff7e6', borderRadius: '8px', border: '1px solid #ffd591', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#d46b08' }}>{objectsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_OBJECTS')}</div>\n                </div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#eef7ff', borderRadius: '8px', border: '1px solid #b3d8ff', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#1565c0' }}>{itemsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ITEMS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#f3e8ff', borderRadius: '8px', border: '1px solid #d1c4e9', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#5e35b1' }}>{entitiesCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ENTITIES')}</div>\n                </div>\n            </div>\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#666' }}>{emptyBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_EMPTY_SPACE')}</div>\n            </div>\n            {mapsTotal > 0 && (\n                <div style={{ padding: '12px', backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #ddd' }}>\n                    <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#444', marginBottom: '6px' }}>\n                        {t('EDITOR_ELEMENTS_STATS_MAPS_TOTAL', { count: mapsTotal })}\n                    </div>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: '#666' }}>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_OVERWORLD', { count: mapsOverworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_UNDERWORLD', { count: mapsUnderworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_ROOMS', { count: mapsRooms })}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const ObjectPropsPanel = ({ \n    objectMapData, \n    secretMapData,\n    registryItems, \n    mapWidth, \n    objectMetadata, \n    highlightedIndex, \n    setHighlightedIndex, \n    setObjectMetadata,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const mapType = maps[activeMapId]?.type || 'overworld';\n    const mapList = Object.values(maps || {});\n    const listRef = React.useRef(null);\n\n    // Auto-scroll to highlighted item\n    React.useEffect(() => {\n        if (highlightedIndex !== null && listRef.current) {\n            const highlightedElement = listRef.current.querySelector(`[data-index=\"${highlightedIndex}\"]`);\n            if (highlightedElement) {\n                highlightedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n        }\n    }, [highlightedIndex]);\n\n    return (\n        <div style={{ padding: '0' }}>\n            <p style={{ fontSize: '12px', color: '#666', lineHeight: '1.4' }}>\n                {t('EDITOR_ELEMENTS_PROPS_INTRO_LINE1')}\n                <br />\n                <strong>1.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE2\"\n                    t={t}\n                    components={[<strong key=\"portal\" />, <strong key=\"target\" />, <strong key=\"weather\" />, <strong key=\"message\" />]}\n                />\n                <br />\n                <strong>2.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE3\"\n                    t={t}\n                    components={[<strong key=\"trigger\" />, <strong key=\"intensity\" />, <strong key=\"messageText\" />]}\n                />\n            </p>\n            <div ref={listRef} style={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}>\n                {Array.from({ length: objectMapData.length }).map((_, index) => {\n                    const objId = objectMapData[index];\n                    const secretId = secretMapData ? secretMapData[index] : null;\n                    \n                    if (!objId && !secretId) return null;\n\n                    const objDef = objId ? registryItems.find(r => r.id === objId) : null;\n                    const secretDef = secretId ? registryItems.find(r => r.id === secretId) : null;\n                    \n                    const isWeather = objDef && objDef.type === 'weather_trigger';\n                    const isMessage = objDef && objDef.type === 'message_trigger';\n                    const isPortalOrTarget = objId && (objId.includes('portal') || objId.includes('target') || objId === 'portal_target');\n                    const isDoor = objDef && objDef.subtype === 'door';\n                    const isRoomArea = secretDef && secretDef.subtype === 'room' && mapType !== 'room';\n\n                    if (!isPortalOrTarget && !isWeather && !isMessage && !isRoomArea && !isDoor) return null;\n\n                    const def = objDef || secretDef;\n                    const id = objId || secretId;\n\n                    const x = index % mapWidth;\n                    const y = Math.floor(index / mapWidth);\n                    const metadata = objectMetadata[index] || {};\n                    const i18nPreview = metadata.i18nChapter && metadata.i18nId\n                        ? getTutorialText(metadata.i18nChapter, metadata.i18nId)\n                        : '';\n                    const isHighlighted = highlightedIndex === index;\n\n                    return (\n                        <div key={index} \n                            data-index={index}\n                            onMouseEnter={() => setHighlightedIndex(index)}\n                            onMouseLeave={() => setHighlightedIndex(null)}\n                            style={{\n                                padding: '10px',\n                                border: isHighlighted ? '1px solid gold' : '1px solid #eee',\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '5px',\n                                backgroundColor: isHighlighted ? '#fffde7' : '#f9f9f9',\n                                marginBottom: '5px',\n                                borderRadius: '4px',\n                                transition: 'all 0.2s ease'\n                            }}\n                        >\n                            <div style={{ fontWeight: 'bold', fontSize: '13px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                                <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    {isRoomArea ? '' : ((isWeather || isMessage) ? def.editorIcon : (id.includes('portal') && !id.includes('target') ? '' : ''))} {def.displayName || def.name}\n                                </span>\n                                <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                    <span style={{ color: '#666', fontSize: '11px' }}>({x}, {y})</span>\n                                    <button \n                                        onClick={() => {\n                                            const el = document.querySelector(`.viewport`);\n                                            if (el) {\n                                                const scrollX = x * 32 - el.clientWidth / 2 + 16;\n                                                const scrollY = y * 32 - el.clientHeight / 2 + 16;\n                                                el.scrollTo({ left: scrollX, top: scrollY, behavior: 'smooth' });\n                                            }\n                                        }}\n                                        style={{ \n                                            padding: '2px 6px', fontSize: '10px', cursor: 'pointer',\n                                            backgroundColor: '#eee', border: '1px solid #ccc', borderRadius: '3px'\n                                        }}\n                                        title={t('EDITOR_ELEMENTS_PROPS_LOCATE_TITLE')}\n                                    >\n                                        {t('EDITOR_ELEMENTS_PROPS_LOCATE_LABEL')}\n                                    </button>\n                                </div>\n                            </div>\n\n                            {isRoomArea && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_ROOM_NAME')}</label>\n                                        <input\n                                            type=\"text\"\n                                            value={metadata.roomName || ''}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_ROOM_NAME_PLACEHOLDER')}\n                                            onChange={(e) => {\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], roomName: e.target.value }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                            }}\n                                        />\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE')}</label>\n                                        <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.width || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], width: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                            <span>x</span>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.height || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], height: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                        </div>\n                                    </div>\n                                    {metadata.linkedMapId ? (\n                                        <div style={{ fontSize: '11px', color: 'green' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_LINKED_MAP', { id: metadata.linkedMapId })}\n                                        </div>\n                                    ) : (\n                                        <button\n                                            onClick={() => {\n                                                if (createMap) {\n                                                    const mapId = createMap('room', metadata.roomName || 'Room Area', metadata.width || 1, metadata.height || 1);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], linkedMapId: mapId }\n                                                    }));\n                                                }\n                                            }}\n                                            style={{\n                                                padding: '6px',\n                                                backgroundColor: '#4CAF50',\n                                                color: 'white',\n                                                border: 'none',\n                                                borderRadius: '4px',\n                                                cursor: 'pointer',\n                                                fontWeight: 'bold'\n                                            }}\n                                        >\n                                            {t('EDITOR_ELEMENTS_PROPS_CONFIRM')}\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n\n                            {(!isWeather && !isMessage && !isRoomArea) && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID')}</label>\n                                    <input\n                                        type=\"number\"\n                                        value={metadata.triggerId || ''}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], triggerId: isNaN(val) ? null : val }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                        placeholder={t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {isWeather && def.hasIntensity && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_INTENSITY')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        max=\"100\"\n                                        value={metadata.intensity !== undefined ? metadata.intensity : 50}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], intensity: isNaN(val) ? 0 : Math.min(100, Math.max(0, val)) }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    />\n                                </div>\n                            )}\n\n                            {isMessage && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\n                                    {(metadata.i18nChapter || metadata.i18nId) && (\n                                        <div style={{ fontSize: '11px', color: '#666' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_I18N_LABEL', {\n                                                chapter: metadata.i18nChapter || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY'),\n                                                id: metadata.i18nId || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY')\n                                            })}\n                                            {i18nPreview && (\n                                                <div style={{ marginTop: '4px', color: '#333' }}>\n                                                    {i18nPreview}\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_MESSAGE_TEXT')}</label>\n                                    <textarea\n                                        value={metadata.message || ''}\n                                        onChange={(e) => {\n                                            const val = e.target.value;\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], message: val }\n                                            }));\n                                        }}\n                                        rows={3}\n                                        style={{\n                                            width: '100%',\n                                            padding: '6px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0',\n                                            resize: 'vertical',\n                                            fontFamily: 'inherit'\n                                        }}\n                                        placeholder={i18nPreview || t('EDITOR_ELEMENTS_PROPS_MESSAGE_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {( (id.includes('portal') && !id.includes('target')) || isDoor ) && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px', marginTop: '5px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TARGET_MAP')}</label>\n                                        <select\n                                            value={metadata.targetMapId || ''}\n                                            onChange={(e) => {\n                                                const val = e.target.value;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], targetMapId: val === '' ? null : val }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        >\n                                            <option value=\"\">{t('EDITOR_ELEMENTS_PROPS_CURRENT_MAP_OPTION')}</option>\n                                            {mapList.map(m => (\n                                                <option key={m.id} value={m.id}>{m.name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SPAWN_ID')}</label>\n                                        <input\n                                            type=\"number\"\n                                            value={metadata.spawnTriggerId !== undefined ? metadata.spawnTriggerId : ''}\n                                            onChange={(e) => {\n                                                const val = parseInt(e.target.value);\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], spawnTriggerId: isNaN(val) ? null : val }\n                                                }));\n                                            }}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_SPAWN_ID_PLACEHOLDER')}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        />\n                                    </div>\n                                    {isDoor && (\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                            <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_DELAY')}</label>\n                                            <input\n                                                type=\"number\"\n                                                step=\"0.1\"\n                                                value={metadata.delaySeconds !== undefined ? metadata.delaySeconds : (objDef.interaction?.delaySeconds || 0.5)}\n                                                onChange={(e) => {\n                                                    const val = parseFloat(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], delaySeconds: isNaN(val) ? 0.5 : val }\n                                                    }));\n                                                }}\n                                                style={{\n                                                    flex: 1,\n                                                    padding: '4px 8px',\n                                                    border: '1px solid #ccc',\n                                                    borderRadius: '4px',\n                                                    fontSize: '13px',\n                                                    backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                                }}\n                                            />\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                            {/* Size Configuration */}\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px', paddingTop: '5px', borderTop: '1px solid #eee' }}>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_W')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.width || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], width: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_H')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.height || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], height: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <span style={{ fontSize: '10px', color: '#999' }}>{t('EDITOR_ELEMENTS_PROPS_RESIZE_HINT')}</span>\n                            </div>\n                        </div>\n                    );\n                })}\n                {objectMapData.filter(id => {\n                    if (!id) return false;\n                    const def = registryItems.find(r => r.id === id);\n                    const isWeather = def && def.type === 'weather_trigger';\n                    const isMessage = def && def.type === 'message_trigger';\n                    const isPortalOrTarget = id.includes('portal') || id.includes('target') || id === 'portal_target';\n                    return isPortalOrTarget || isWeather || isMessage;\n                }).length === 0 && (\n                    <p style={{ textAlign: 'center', color: '#999', marginTop: '20px', fontSize: '14px' }}>\n                        {t('EDITOR_ELEMENTS_PROPS_NO_CONFIGURABLE')}\n                    </p>\n                )}\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    SidebarContainer,\n    ElementEditorButton,\n    PanelContainer,\n    PanelHeader,\n    PanelBody,\n    CloseButton\n} from './styles/EditorElementsButtonStyle';\n\n// Panels\nimport { OperationsPanel } from './editorElements/OperationsPanel';\nimport { PalettePanel } from './editorElements/PalettePanel';\nimport { StatisticsPanel } from './editorElements/StatisticsPanel';\nimport { ObjectPropsPanel } from './editorElements/ObjectPropsPanel';\n\nexport const EditorElements = ({\n    mapName,\n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    openNewMapModal,\n    openBuiltInModal,\n    saveMap,\n    loadMap,\n    clearMap,\n    isPlayMode,\n    handlePaletteSelect,\n    selectedTile,\n    blocks,\n    liquids,\n    entities,\n    items,\n    decorations,\n    interactables,\n    hazards,\n    secrets,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    setObjectMetadata,\n    registryItems,\n    highlightedIndex,\n    setHighlightedIndex,\n    activePanel,\n    setActivePanel,\n    togglePanel,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [lastPanel, setLastPanel] = React.useState(null);\n    const [pinnedPanel, setPinnedPanel] = React.useState(null);\n    const hoverTimerRef = React.useRef(null);\n\n    React.useEffect(() => {\n        if (activePanel) {\n            setLastPanel(activePanel);\n        }\n    }, [activePanel]);\n\n    const displayPanel = activePanel || lastPanel;\n\n    const clearHoverTimer = () => {\n        if (hoverTimerRef.current) {\n            clearTimeout(hoverTimerRef.current);\n            hoverTimerRef.current = null;\n        }\n    };\n\n    const handleIconClick = (panel) => {\n        clearHoverTimer();\n        if (pinnedPanel === panel) {\n            setPinnedPanel(null);\n            setActivePanel(null);\n            return;\n        }\n        setPinnedPanel(panel);\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseEnter = (panel) => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        hoverTimerRef.current = setTimeout(() => {\n            setActivePanel(null);\n        }, 120);\n    };\n\n    const handlePanelMouseEnter = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n    };\n\n    const handlePanelMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(null);\n    };\n\n    const panelTitles = {\n        map: t('EDITOR_ELEMENTS_PANEL_OPERATIONS'),\n        blocks: t('EDITOR_ELEMENTS_PANEL_BLOCKS'),\n        liquids: t('EDITOR_ELEMENTS_PANEL_LIQUIDS'),\n        decorations: t('EDITOR_ELEMENTS_PANEL_DECORATIONS'),\n        entities: t('EDITOR_ELEMENTS_PANEL_ENTITIES'),\n        items: t('EDITOR_ELEMENTS_PANEL_ITEMS'),\n        interactables: t('EDITOR_ELEMENTS_PANEL_INTERACTABLES'),\n        hazards: t('EDITOR_ELEMENTS_PANEL_HAZARDS'),\n        secrets: t('EDITOR_ELEMENTS_PANEL_SECTORS'),\n        weather: t('EDITOR_ELEMENTS_PANEL_WEATHER'),\n        messages: t('EDITOR_ELEMENTS_PANEL_MESSAGES'),\n        obstacles: t('EDITOR_ELEMENTS_PANEL_OBSTACLES'),\n        stats: t('EDITOR_ELEMENTS_PANEL_STATISTICS'),\n        props: t('EDITOR_ELEMENTS_PANEL_PROPERTIES')\n    };\n\n    return (\n        <div style={{ display: 'flex', height: '100%', position: 'relative', zIndex: 1001 }}>\n            {/* Sidebar Left Icons */}\n            <SidebarContainer>\n                <ElementEditorButton onClick={() => handleIconClick('map')} onMouseEnter={() => handleIconMouseEnter('map')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'map'} title={t('EDITOR_ELEMENTS_ICON_MAP_CONTROLS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('blocks')} onMouseEnter={() => handleIconMouseEnter('blocks')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'blocks'} title={t('EDITOR_ELEMENTS_ICON_BLOCKS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('liquids')} onMouseEnter={() => handleIconMouseEnter('liquids')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'liquids'} title={t('EDITOR_ELEMENTS_ICON_LIQUIDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('decorations')} onMouseEnter={() => handleIconMouseEnter('decorations')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'decorations'} title={t('EDITOR_ELEMENTS_ICON_DECORATIONS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('obstacles')} onMouseEnter={() => handleIconMouseEnter('obstacles')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'obstacles'} title={t('EDITOR_ELEMENTS_ICON_OBSTACLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('items')} onMouseEnter={() => handleIconMouseEnter('items')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'items'} title={t('EDITOR_ELEMENTS_ICON_ITEMS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('entities')} onMouseEnter={() => handleIconMouseEnter('entities')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'entities'} title={t('EDITOR_ELEMENTS_ICON_ENTITIES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('interactables')} onMouseEnter={() => handleIconMouseEnter('interactables')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'interactables'} title={t('EDITOR_ELEMENTS_ICON_INTERACTABLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('hazards')} onMouseEnter={() => handleIconMouseEnter('hazards')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'hazards'} title={t('EDITOR_ELEMENTS_ICON_HAZARDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('secrets')} onMouseEnter={() => handleIconMouseEnter('secrets')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'secrets'} title={t('EDITOR_ELEMENTS_ICON_SECTORS')}>2</ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('weather')} onMouseEnter={() => handleIconMouseEnter('weather')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'weather'} title={t('EDITOR_ELEMENTS_ICON_WEATHER')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('messages')} onMouseEnter={() => handleIconMouseEnter('messages')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'messages'} title={t('EDITOR_ELEMENTS_ICON_MESSAGES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('stats')} onMouseEnter={() => handleIconMouseEnter('stats')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'stats'} title={t('EDITOR_ELEMENTS_ICON_STATISTICS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('props')} onMouseEnter={() => handleIconMouseEnter('props')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'props'} title={t('EDITOR_ELEMENTS_ICON_PROPERTIES')}></ElementEditorButton>\n            </SidebarContainer>\n\n            {/* Sidebar Fixed Panel Content */}\n            <PanelContainer $isOpen={!!activePanel} onMouseEnter={handlePanelMouseEnter} onMouseLeave={handlePanelMouseLeave}>\n                {displayPanel && (\n                    <>\n                        {/* Panel Header */}\n                        <PanelHeader>\n                            <span>{panelTitles[displayPanel]}</span>\n                            <CloseButton onClick={() => { setPinnedPanel(null); setActivePanel(null); }}></CloseButton>\n                        </PanelHeader>\n\n                        {/* Panel Body */}\n                        <PanelBody>\n                            {displayPanel === 'map' && (\n                                <OperationsPanel \n                                    openNewMapModal={openNewMapModal}\n                                    openBuiltInModal={openBuiltInModal}\n                                    saveMap={saveMap}\n                                    loadMap={loadMap}\n                                    clearMap={clearMap}\n                                    mapName={mapName}\n                                    creatorName={creatorName}\n                                    mapDescription={mapDescription}\n                                    setMapName={setMapName}\n                                    setCreatorName={setCreatorName}\n                                    setMapDescription={setMapDescription}\n                                />\n                            )}\n\n                            {(displayPanel === 'blocks' || \n                              displayPanel === 'liquids' || \n                              displayPanel === 'decorations' || \n                              displayPanel === 'entities' || \n                              displayPanel === 'items' || \n                              displayPanel === 'interactables' || \n                              displayPanel === 'hazards' || \n                              displayPanel === 'secrets' ||\n                              displayPanel === 'weather' ||\n                              displayPanel === 'messages' ||\n                              displayPanel === 'obstacles') && (\n                                <PalettePanel \n                                    isPlayMode={isPlayMode}\n                                    category={displayPanel}\n                                    blocks={blocks}\n                                    liquids={liquids}\n                                    entities={entities}\n                                    decorations={decorations}\n                                    items={items}\n                                    interactables={interactables}\n                                    hazards={hazards}\n                                    secrets={secrets}\n                                    weather={weather}\n                                    messages={messages}\n                                    crackableWalls={crackableWalls}\n                                    pushableWalls={pushableWalls}\n                                    obstacles={obstacles}\n                                    handlePaletteSelect={handlePaletteSelect}\n                                    selectedTile={selectedTile}\n                                    objectMetadata={objectMetadata}\n                                    setObjectMetadata={setObjectMetadata}\n                                    objectMapData={objectMapData}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    registryItems={registryItems}\n                                />\n                            )}\n\n\n                            {displayPanel === 'stats' && (\n                                <StatisticsPanel \n                                    totalTiles={totalTiles}\n                                    mapWidth={mapWidth}\n                                    mapHeight={mapHeight}\n                                    filledBlocks={filledBlocks}\n                                    objectsCount={objectsCount}\n                                    emptyBlocks={emptyBlocks}\n                                    objectMapData={objectMapData}\n                                    registryItems={registryItems}\n                                    maps={maps}\n                                />\n                            )}\n\n                            {displayPanel === 'props' && (\n                                <ObjectPropsPanel \n                                    objectMapData={objectMapData}\n                                    secretMapData={secretMapData}\n                                    registryItems={registryItems}\n                                    mapWidth={mapWidth}\n                                    objectMetadata={objectMetadata}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    setObjectMetadata={setObjectMetadata}\n                                    maps={maps}\n                                    activeMapId={activeMapId}\n                                    createMap={createMap}\n                                />\n                            )}\n                        </PanelBody>\n                    </>\n                )}\n            </PanelContainer>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    EditorToolsContainer,\n    HeaderBar,\n    ToolsSection,\n    ToolsGroup,\n    ToolsInnerGroup,\n    ToolsRow,\n    ToolsEditorButton,\n    StrikeThrough,\n    LayerIndicator,\n    BgColorContainer,\n    BgColorInputWrapper,\n    BgColorInput,\n    BgTransparentButton,\n    PlayButtonContainer,\n    PlayButtonInner,\n    InfoContainer,\n    InfoItem,\n    InfoLabel,\n    InfoValue,\n    EraserButtonContainer,\n    EraserButtonInner,\n    SelectionActions,\n    ConfirmButton,\n    CancelButton,\n    GridIcon\n} from './styles/EditorToolsButton';\n\nexport const EditorTools = (props) => {\n    const { t } = useTranslation('editor_tools');\n    const {\n        mapName, \n        creatorName, \n        activePanel, \n        togglePanel,\n        showGrid, \n        setShowGrid,\n        isPlayMode,\n        handlePlay,\n        handlePause,\n        handleReset,\n        activeTool,\n        setActiveTool,\n        brushSize,\n        setBrushSize,\n        activeLayer,\n        selection,\n        moveSelection,\n        selectionMode,\n        setSelectionMode,\n        commitSelection,\n        cancelSelection,\n        selectedTile,\n        handlePaletteSelect,\n        selectedBackgroundColor,\n        setSelectedBackgroundColor,\n        showBackgroundImage,\n        setShowBackgroundImage,\n        showMessages,\n        setShowMessages,\n        isRoomAreaVisible,\n        setIsRoomAreaVisible,\n        showRoomMapContent,\n        setShowRoomMapContent\n    } = props;\n    const getEraserData = (layer) => {\n        const isActive = selectedTile === null && activeLayer === layer;\n        const colors = {\n            tile: { bg: '#e6f7ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', text: '#722ed1' },\n            props: { bg: '#fffbe6', text: '#faad14' }\n        };\n        const active = colors[layer] || colors.tile;\n        return {\n            isActive,\n            bgColor: active.bg,\n            textColor: active.text\n        };\n    };\n\n    const getLayerIndicatorData = () => {\n        const colors = {\n            tile: { bg: '#e6f7ff', border: '#91d5ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', border: '#ffa39e', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', border: '#d3adf7', text: '#722ed1' },\n            props: { bg: '#fffbe6', border: '#ffe58f', text: '#faad14' }\n        };\n        const active = colors[activeLayer] || colors.tile;\n        return {\n            $bgColor: active.bg,\n            $borderColor: active.border,\n            $textColor: active.text\n        };\n    };\n\n    return (\n        <EditorToolsContainer>\n            {/* Main Header Bar */}\n            <HeaderBar>\n                <ToolsSection>\n                    <ToolsGroup>\n\n                        {/* Brush - Bucket - Move - Area */}\n                        <ToolsRow>\n                            {[\n                                { id: 'brush', icon: '', title: t('EDITOR_TOOLS_BRUSH_TITLE') },\n                                { id: 'bucket', icon: '', title: t('EDITOR_TOOLS_BUCKET_TITLE') },\n                                { id: 'move', icon: '', title: t('EDITOR_TOOLS_MOVE_TITLE') },\n                            ].map(tool => (\n                                <ToolsEditorButton\n                                    key={tool.id}\n                                    onClick={() => !isPlayMode && setActiveTool(tool.id)}\n                                    $active={activeTool === tool.id && !isPlayMode}\n                                    $square\n                                    $disabled={isPlayMode}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : tool.title}\n                                >\n                                    {tool.icon}\n                                    {isPlayMode && <StrikeThrough />}\n                                </ToolsEditorButton>\n                            ))}\n                        </ToolsRow>\n\n                        {/* Cut - Copy - Paste */}\n                        <ToolsInnerGroup>\n                            {['cut', 'copy'].map(mode => {\n                                const isDisabled = isPlayMode || activeTool !== 'move';\n                                return (\n                                    <ToolsEditorButton\n                                        key={mode}\n                                        onClick={() => !isDisabled && setSelectionMode(mode)}\n                                        $active={selectionMode === mode && !isDisabled}\n                                        $square\n                                        $disabled={isDisabled}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? (mode === 'cut' ? t('EDITOR_TOOLS_CUT_ONLY_MOVE') : t('EDITOR_TOOLS_COPY_ONLY_MOVE')) : (mode === 'cut' ? t('EDITOR_TOOLS_CUT_SELECTION') : t('EDITOR_TOOLS_COPY_SELECTION')))}\n                                    >\n                                        {mode === 'cut' ? '' : ''}\n                                        {isDisabled && <StrikeThrough />}\n                                    </ToolsEditorButton>\n                                );\n                            })}\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && activeTool === 'move' && commitSelection()}\n                                $square\n                                $disabled={isPlayMode || activeTool !== 'move'}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (activeTool !== 'move' ? t('EDITOR_TOOLS_PASTE_ONLY_MOVE') : t('EDITOR_TOOLS_PASTE_SELECTION'))}\n                            >\n                                \n                                {(isPlayMode || activeTool !== 'move') && <StrikeThrough />}\n                            </ToolsEditorButton>\n                            {selection && !isPlayMode && (\n                                <SelectionActions>\n                                    <ConfirmButton onClick={commitSelection} $square title={t('EDITOR_TOOLS_CONFIRM_SELECTION')}></ConfirmButton>\n                                    <CancelButton onClick={cancelSelection} $square title={t('EDITOR_TOOLS_CANCEL_SELECTION')}></CancelButton>\n                                </SelectionActions>\n                            )}\n                        </ToolsInnerGroup>\n\n                        {/* Size */}\n                        <ToolsInnerGroup>\n                            {['I', 'II', 'III', 'IV', 'V'].map((roman, idx) => {\n                                const size = idx + 1;\n                                const isDisabled = isPlayMode || activeTool !== 'brush';\n                                return (\n                                    <ToolsEditorButton \n                                        key={size} \n                                    onClick={() => !isDisabled && setBrushSize(size)} \n                                    $active={brushSize === size && !isDisabled} \n                                    $square \n                                    $disabled={isDisabled}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? t('EDITOR_TOOLS_BRUSH_SIZE_ONLY') : t('EDITOR_TOOLS_BRUSH_SIZE', { size }))}\n                                >\n                                    {roman}\n                                    {isDisabled && <StrikeThrough />}\n                                </ToolsEditorButton>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        {/* Background Immage */}\n                        <ToolsRow>\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && setShowBackgroundImage(!showBackgroundImage)}\n                                $active={showBackgroundImage && !isPlayMode}\n                                $square\n                                $disabled={isPlayMode}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (showBackgroundImage ? t('EDITOR_TOOLS_BACKGROUND_IMAGE_HIDE') : t('EDITOR_TOOLS_BACKGROUND_IMAGE_SHOW'))}\n                            >\n                                \n                                {isPlayMode && <StrikeThrough />}\n                            </ToolsEditorButton>\n\n                            {/* Grid */}\n                            <ToolsEditorButton\n                                onClick={() => setShowGrid(!showGrid)}\n                                $active={showGrid}\n                                $square\n                                title={showGrid ? t('EDITOR_TOOLS_GRID_HIDE') : t('EDITOR_TOOLS_GRID_SHOW')}\n                            >\n                                <GridIcon>\n                                    {showGrid ? '' : ''}\n                                </GridIcon>\n                            </ToolsEditorButton>\n\n                            {/* Messages Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowMessages(!showMessages)}\n                                $active={showMessages}\n                                $square\n                                title={showMessages ? t('EDITOR_TOOLS_MESSAGES_HIDE') : t('EDITOR_TOOLS_MESSAGES_SHOW')}\n                            >\n                                \n                            </ToolsEditorButton>\n\n                            {/* Room Area Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setIsRoomAreaVisible(!isRoomAreaVisible)}\n                                $active={isRoomAreaVisible}\n                                $square\n                                title={isRoomAreaVisible ? t('EDITOR_TOOLS_ROOM_AREA_HIDE') : t('EDITOR_TOOLS_ROOM_AREA_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Room Map Content Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowRoomMapContent(!showRoomMapContent)}\n                                $active={showRoomMapContent}\n                                $square\n                                title={showRoomMapContent ? t('EDITOR_TOOLS_ROOM_CONTENT_HIDE') : t('EDITOR_TOOLS_ROOM_CONTENT_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Background Color Picker */}\n                            <BgColorContainer>\n                                <BgColorInputWrapper>\n                                    <BgColorInput\n                                        type=\"color\"\n                                        value={selectedBackgroundColor && selectedBackgroundColor !== 'transparent' ? selectedBackgroundColor : '#000000'}\n                                        onChange={(e) => !isPlayMode && setSelectedBackgroundColor(e.target.value)}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_COLOR')}\n                                        disabled={isPlayMode}\n                                    />\n                                    {isPlayMode && <StrikeThrough />}\n                                </BgColorInputWrapper>\n                                <BgTransparentButton \n                                    $active={selectedBackgroundColor === 'transparent'}\n                                    onClick={() => !isPlayMode && setSelectedBackgroundColor('transparent')}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_TRANSPARENT')}\n                                />\n                            </BgColorContainer>\n                        </ToolsRow>\n\n\n\n                        {/* Active Layer Indicator */}\n                        <ToolsInnerGroup>\n                            <LayerIndicator {...getLayerIndicatorData()}>\n                                {t('EDITOR_TOOLS_LAYER_LABEL', {\n                                    layer: activeLayer === 'tile'\n                                        ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                        : (activeLayer === 'object'\n                                            ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                            : (activeLayer === 'secret'\n                                                ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                })}\n                            </LayerIndicator>\n                        </ToolsInnerGroup>\n\n                        {/* Layers: Block - Object - Sector - Props */}\n                        <ToolsInnerGroup>\n                            {['tile', 'object', 'secret', 'props'].map(layer => {\n                                const { isActive, bgColor, textColor } = getEraserData(layer);\n                                const isDisabled = isPlayMode;\n                                return (\n                                    <EraserButtonContainer\n                                        key={layer}\n                                        onClick={() => !isDisabled && handlePaletteSelect(null, layer)}\n                                        $active={isActive && !isDisabled}\n                                        $disabled={isDisabled}\n                                        title={isDisabled ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_ERASE_LABEL', {\n                                            layer: layer === 'tile'\n                                                ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                                : (layer === 'object'\n                                                    ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                                    : (layer === 'secret'\n                                                        ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                        : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                        })}\n                                    >\n                                        <EraserButtonInner $bgColor={bgColor} $textColor={textColor} $active={isActive && !isDisabled}>\n                                            {layer === 'tile' ? 'B' : (layer === 'object' ? 'O' : (layer === 'secret' ? 'S' : 'P'))}\n                                        </EraserButtonInner>\n                                        {isDisabled && <StrikeThrough />}\n                                    </EraserButtonContainer>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        <ToolsInnerGroup>\n                            <ToolsRow>\n                                <PlayButtonContainer onClick={isPlayMode ? handlePause : handlePlay} title={isPlayMode ? t('EDITOR_TOOLS_PAUSE_TITLE') : t('EDITOR_TOOLS_PLAY_TITLE')}>\n                                    <PlayButtonInner $variant={isPlayMode ? 'pause' : 'play'}>\n                                        <span>{isPlayMode ? '' : ''}</span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n\n                                <PlayButtonContainer onClick={handleReset} title={t('EDITOR_TOOLS_RESET_TITLE')}>\n                                    <PlayButtonInner>\n                                        <span></span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n                            </ToolsRow>\n                        </ToolsInnerGroup>\n                    </ToolsGroup>\n                </ToolsSection>\n\n\n                <ToolsSection>\n                    <InfoContainer>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_MAP')}</InfoLabel>\n                            <InfoValue>{mapName}</InfoValue>\n                        </InfoItem>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_BY')}</InfoLabel>\n                            <InfoValue>{creatorName}</InfoValue>\n                        </InfoItem>\n                    </InfoContainer>\n                </ToolsSection>\n            </HeaderBar>\n        </EditorToolsContainer>\n    );\n};\n","import { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { TILE_SIZE } from '../../../../constants/gameConstants';\nimport { useGameEngine } from '../../../../utilities/useGameEngine';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../../engine/gameplay/breakEffects';\n\nconst EMPTY_ARRAY = [];\n\nexport const useEditorPlayMode = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n    selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n    registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    maps, activeMapId, switchMap, spawnTriggerId,\n    setTileMapData, updateMapData\n) => {\n    const [isPlayMode, setIsPlayMode] = useState(false);\n    const [isGameOver, setIsGameOver] = useState(false);\n    const [restartCounter, setRestartCounter] = useState(0);\n    const [editorSnapshot, setEditorSnapshot] = useState(null);\n    const [revealedSecrets, setRevealedSecrets] = useState([]);\n    const [activeRoomIds, setActiveRoomIds] = useState(new Set());\n    const [playModeObjectData, setPlayModeObjectData] = useState([]);\n    const [playModeSecretData, setPlayModeSecretData] = useState([]);\n    const [playModeWeather, setPlayModeWeather] = useState({\n        rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0,\n        lavaRain: 0, radioactiveFog: 0, meteorRain: 0\n    });\n    const [playModeMapsVersion, setPlayModeMapsVersion] = useState(0);\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n    const lastSyncedMapIdRef = useRef(null);\n    const isPlayModeRef = useRef(isPlayMode);\n    const playModeMapsRef = useRef({});\n\n    useEffect(() => {\n        isPlayModeRef.current = isPlayMode;\n    }, [isPlayMode]);\n\n    // Stability for engine initialization - only changes when map changes or play mode is toggled\n    const engineInitId = useMemo(() => {\n        return isPlayMode ? `${activeMapId}_${restartCounter}_${Date.now()}` : null;\n    }, [isPlayMode, activeMapId, restartCounter]);\n\n    // Derived data to ensure useGameEngine gets fresh data even before useEffect syncs state.\n    // This prevents the engine from using old map data during initialization.\n    const currentPlayObjectData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) {\n            const playData = [...objectMapData];\n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n            return playData;\n        }\n        return playModeObjectData;\n    }, [isPlayMode, activeMapId, playModeObjectData, objectMapData, spawnTriggerId, mapWidth, mapHeight]);\n\n    const currentPlaySecretData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) return [...secretMapData];\n        return playModeSecretData;\n    }, [isPlayMode, activeMapId, playModeSecretData, secretMapData]);\n\n    const playModeMaps = useMemo(() => {\n        if (!isPlayMode) return maps;\n        const overrides = playModeMapsRef.current || {};\n        const merged = { ...maps };\n        Object.keys(overrides).forEach(id => {\n            if (!merged[id]) return;\n            merged[id] = {\n                ...merged[id],\n                objectMapData: overrides[id].objectMapData || merged[id].objectMapData,\n                secretMapData: overrides[id].secretMapData || merged[id].secretMapData,\n                objectMetadata: overrides[id].objectMetadata || merged[id].objectMetadata\n            };\n        });\n        return merged;\n    }, [isPlayMode, maps, playModeMapsVersion]);\n\n    const mapDataForGame = useMemo(() => ({\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: TILE_SIZE,\n            activeMapId: activeMapId,\n            spawnTriggerId: spawnTriggerId,\n            backgroundImage: selectedBackgroundImage,\n            backgroundColor: selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            objectMetadata: objectMetadata,\n            activeRoomIds: Array.from(activeRoomIds),\n            date_map_last_updated: engineInitId, \n            weather: {\n                rain: isPlayMode ? playModeWeather.rain : weatherRain,\n                lavaRain: isPlayMode ? playModeWeather.lavaRain : weatherLavaRain,\n                snow: isPlayMode ? playModeWeather.snow : weatherSnow,\n                meteorRain: isPlayMode ? playModeWeather.meteorRain : weatherMeteorRain,\n                clouds: isPlayMode ? playModeWeather.clouds : weatherClouds,\n                fog: isPlayMode ? playModeWeather.fog : weatherFog,\n                radioactiveFog: isPlayMode ? playModeWeather.radioactiveFog : weatherRadioactiveFog,\n                thunder: isPlayMode ? playModeWeather.thunder : weatherThunder\n            }\n        },\n        maps: playModeMaps, // Project maps for inter-map teleports\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: currentPlayObjectData },\n            { type: \"secret\", name: \"secrets\", data: currentPlaySecretData }\n        ]\n    }), [\n        mapWidth, mapHeight, activeMapId, spawnTriggerId, selectedBackgroundImage, selectedBackgroundColor, \n        backgroundParallaxFactor, tileMapData, currentPlayObjectData, objectMetadata, activeRoomIds,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playModeWeather,\n        isPlayMode, playModeMaps, engineInitId\n    ]);\n\n    // Synchronize play mode state when map changes (e.g., during inter-map teleport)\n    useEffect(() => {\n        if (isPlayMode && lastSyncedMapIdRef.current !== activeMapId) {\n            const saved = playModeMapsRef.current?.[activeMapId];\n            if (saved) {\n                setPlayModeObjectData([...saved.objectMapData]);\n                setPlayModeSecretData([...(saved.secretMapData || [])]);\n                if (saved.objectMetadata) {\n                    setObjectMetadata({ ...saved.objectMetadata });\n                }\n                setRevealedSecrets([]);\n                if (messageTimerRef.current) {\n                    clearTimeout(messageTimerRef.current);\n                    messageTimerRef.current = null;\n                }\n                setGameMessage({ text: '', isVisible: false });\n                lastSyncedMapIdRef.current = activeMapId;\n                return;\n            }\n            const playData = [...objectMapData];\n            \n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(playData);\n            setPlayModeSecretData([...secretMapData]);\n            setRevealedSecrets([]);\n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n                messageTimerRef.current = null;\n            }\n            setGameMessage({ text: '', isVisible: false });\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    }, [activeMapId, isPlayMode, objectMapData, secretMapData, mapWidth, mapHeight, spawnTriggerId]);\n\n    const handleGameOver = useCallback(() => {\n        setIsGameOver(true);\n    }, []);\n\n    const handleReplay = useCallback(() => {\n        setIsGameOver(false);\n        setRestartCounter(prev => prev + 1);\n        setRevealedSecrets([]);\n        if (editorSnapshot) {\n            setPlayModeObjectData([...editorSnapshot.objectMapData]);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n        }\n    }, [editorSnapshot, setObjectMetadata]);\n\n    const handleStateUpdate = useCallback((newState, payload) => {\n        if (newState && typeof newState === 'object' && newState.x !== undefined && newState.y !== undefined) {\n            setPlayerPosition({ x: newState.x, y: newState.y });\n        } else if (newState === 'collectItem' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const newData = [...prev];\n                    newData[index] = null;\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newData = [...(playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [])];\n                newData[index] = null;\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMapData: newData\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'interactable' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const currentId = prev[index];\n                    if (!currentId) return prev;\n                    const newData = [...prev];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const mapObj = playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [];\n                const currentId = mapObj[index];\n                if (currentId) {\n                    const newData = [...mapObj];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[mapId] = {\n                        ...(playModeMapsRef.current[mapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                }\n            }\n        } else if (newState === 'setObjectFrame' && payload !== undefined) {\n            const { index, frame, mapId } = payload;\n            if (!mapId || mapId === activeMapId) {\n                setObjectMetadata(prev => {\n                    const next = {\n                        ...prev,\n                        [index]: { ...prev[index], currentFrame: frame }\n                    };\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMetadata: next\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return next;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newMeta = { ...((playModeMapsRef.current?.[mapId]?.objectMetadata) || maps[mapId].objectMetadata || {}) };\n                newMeta[index] = { ...(newMeta[index] || {}), currentFrame: frame };\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMetadata: newMeta\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'switchMap' && payload !== undefined) {\n            const { targetMapId, triggerId } = payload;\n            \n            // Check if target is a room\n            const targetMap = maps[targetMapId];\n            if (targetMap && targetMap.type === 'room') {\n                setActiveRoomIds(prev => {\n                    const next = new Set(prev);\n                    if (next.has(targetMapId)) next.delete(targetMapId);\n                    else next.add(targetMapId);\n                    return next;\n                });\n            } else if (targetMapId === 'main' && activeRoomIds.size > 0) {\n                setActiveRoomIds(new Set());\n            } else if (switchMap && targetMapId) {\n                playModeMapsRef.current[activeMapId] = {\n                    objectMapData: [...playModeObjectData],\n                    secretMapData: [...playModeSecretData],\n                    objectMetadata: { ...objectMetadata }\n                };\n                setPlayModeMapsVersion(v => v + 1);\n                // We keep play mode active when switching maps via teleport\n                switchMap(targetMapId, triggerId);\n            }\n        } else if (newState === 'objectDamage' && payload !== undefined) {\n            const { index, damage } = payload;\n            const objId = playModeObjectData[index];\n            const def = registryItems.find(r => r.id === objId);\n            if (!def) return;\n\n            setObjectMetadata(prev => {\n                const current = prev[index] || {};\n                const maxH = def.maxHealth || 100;\n                const newHealth = Math.max(0, (current.health !== undefined ? current.health : maxH) - damage);\n                \n                if (shouldRemoveCrackBlock(def, newHealth)) {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[index] = null;\n                            return newTiles;\n                        });\n                    }\n                }\n\n                if (shouldTriggerBreakEffect(def, newHealth) && !current.breakFxPlayed) {\n                    const cfg = getBreakEffectParams(def);\n                    if (cfg) {\n                        const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        window.dispatchEvent(new CustomEvent('game-break-effect', {\n                            detail: { x, y, config: cfg }\n                        }));\n                    }\n                }\n\n                return {\n                    ...prev,\n                    [index]: { ...current, health: newHealth, breakFxPlayed: current.breakFxPlayed || shouldTriggerBreakEffect(def, newHealth) }\n                };\n            });\n            const nextMeta = {\n                ...(objectMetadata || {}),\n                [index]: {\n                    ...(objectMetadata?.[index] || {}),\n                    health: Math.max(0, ((objectMetadata?.[index]?.health ?? (def.maxHealth || 100)) - damage))\n                }\n            };\n            playModeMapsRef.current[activeMapId] = {\n                ...(playModeMapsRef.current[activeMapId] || {}),\n                objectMetadata: nextMeta\n            };\n            setPlayModeMapsVersion(v => v + 1);\n\n            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(index / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n            }));\n        } else if (newState === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (newState === 'shiftTile' && payload !== undefined) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapId;\n            \n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => playModeObjectData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[to] = newTiles[from];\n                            newTiles[from] = null;\n                            return newTiles;\n                        });\n                    }\n                },\n                moveObject: (from, to) => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[to] = newObjs[from];\n                        newObjs[from] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                moveMetadata: (from, to) => {\n                    setObjectMetadata(prevMeta => {\n                        const newMeta = { ...prevMeta };\n                        if (newMeta[from]) {\n                            newMeta[to] = newMeta[from];\n                            delete newMeta[from];\n                        }\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMetadata: newMeta\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newMeta;\n                    });\n                },\n                removeObject: idx => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[idx] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                shouldCancel: () => !isPlayModeRef.current || activeMapId !== mapIdAtStart\n            });\n        } else if (newState === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            setPlayModeWeather(prev => ({\n                ...prev,\n                [type]: value\n            }));\n            \n            // Dispatch event for any UI components that might be listening\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1);\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (newState === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        } else if (newState === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (newState === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (newState === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        }\n    }, [activeMapId, maps, updateMapData, activeRoomIds, playModeObjectData, registryItems, setPlayerPosition, setObjectMetadata, switchMap, playModeSecretData, objectMetadata, mapWidth, mapHeight]);\n\n    const handleRevealSecret = useCallback((secretIndices) => {\n        const next = Array.isArray(secretIndices) ? secretIndices : [secretIndices];\n        if (next.length === 0) return;\n        setRevealedSecrets(prev => [...prev, ...next]);\n    }, []);\n\n    const gameEngineState = useGameEngine(\n        isPlayMode ? mapDataForGame : null,\n        isPlayMode ? tileMapData : EMPTY_ARRAY,\n        isPlayMode ? currentPlayObjectData : EMPTY_ARRAY,\n        isPlayMode ? currentPlaySecretData : EMPTY_ARRAY,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        Array.from(activeRoomIds),\n        mapWidth,\n        mapHeight\n    );\n\n    const handlePlay = () => {\n        setEditorSnapshot({\n            tileMapData: [...tileMapData],\n            objectMapData: [...objectMapData],\n            secretMapData: [...secretMapData],\n            objectMetadata: { ...objectMetadata },\n            playerPosition: { ...playerPosition }\n        });\n\n        const playData = [...objectMapData];\n        let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n        if (spawnIndex === -1) {\n            const spawnX = Math.min(3, mapWidth - 1);\n            const spawnY = Math.min(3, mapHeight - 1);\n            spawnIndex = spawnY * mapWidth + spawnX;\n            playData[spawnIndex] = 'player';\n        }\n\n        setPlayModeObjectData(playData);\n        setPlayModeSecretData([...secretMapData]);\n        playModeMapsRef.current = {\n            [activeMapId]: {\n                objectMapData: playData,\n                secretMapData: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            }\n        };\n        setPlayModeMapsVersion(v => v + 1);\n        setPlayModeWeather({\n            rain: weatherRain,\n            snow: weatherSnow,\n            clouds: weatherClouds,\n            fog: weatherFog,\n            thunder: weatherThunder,\n            lavaRain: weatherLavaRain,\n            radioactiveFog: weatherRadioactiveFog,\n            meteorRain: weatherMeteorRain\n        });\n        setRevealedSecrets([]);\n        lastSyncedMapIdRef.current = activeMapId;\n        setIsPlayMode(true);\n        setIsGameOver(false); // Reset game over when starting play mode\n    };\n\n    const handlePause = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false); // Reset game over when exiting play mode\n        playModeMapsRef.current = {};\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    const handleReset = () => {\n        if (editorSnapshot) {\n            if (setTileMapData) {\n                setTileMapData([...editorSnapshot.tileMapData]);\n            }\n\n            const resetData = [...editorSnapshot.objectMapData];\n            let spawnIndex = resetData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                resetData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(resetData);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n            setRevealedSecrets([]);\n            playModeMapsRef.current = {\n                [activeMapId]: {\n                    objectMapData: resetData,\n                    secretMapData: [...editorSnapshot.secretMapData],\n                    objectMetadata: { ...editorSnapshot.objectMetadata }\n                }\n            };\n            setPlayModeMapsVersion(v => v + 1);\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    };\n\n    const handleForceStop = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false);\n        setEditorSnapshot(null);\n        setPlayModeObjectData([]);\n        setPlayModeSecretData([]);\n        setRevealedSecrets([]);\n        playModeMapsRef.current = {};\n        lastSyncedMapIdRef.current = null;\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    return {\n        isPlayMode,\n        setIsPlayMode,\n        isGameOver,\n        handlePlay,\n        handlePause,\n        handleReset,\n        handleForceStop,\n        handleReplay,\n        handleStateUpdate,\n        playModeObjectData: currentPlayObjectData,\n        playModeSecretData: currentPlaySecretData,\n        playModeWeather,\n        playModeMaps,\n        gameMessage,\n        revealedSecrets,\n        activeRoomIds: Array.from(activeRoomIds),\n        gameEngineState\n    };\n};\n","import { useCallback } from 'react';\nimport { saveMap, loadMap, loadBuiltInMap, clearMap } from '../editorTools/mapOperations';\n\nexport const useEditorOperations = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    mapName, creatorName, mapDescription, createdAt,\n    selectedBackgroundImage, selectedBackgroundColor,\n    backgroundParallaxFactor, selectedBackgroundMusic, playerPosition,\n    registryItems, setCreatedAt,\n    setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n    setSelectedBackgroundImage, setSelectedBackgroundColor,\n    setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n    setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n    // Multi-map props\n    maps, setMaps, activeMapId, setActiveMapId\n) => {\n    const handleSaveMap = useCallback(() => {\n        // Construct the updated maps object with current active map data\n        // to ensure latest changes are saved even if debounce hasn't run\n        const currentMapData = {\n            ...maps[activeMapId],\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weather: {\n                rain: weatherRain,\n                snow: weatherSnow,\n                clouds: weatherClouds,\n                fog: weatherFog,\n                thunder: weatherThunder,\n                lavaRain: weatherLavaRain,\n                radioactiveFog: weatherRadioactiveFog,\n                meteorRain: weatherMeteorRain\n            },\n            playerPosition\n        };\n\n        const updatedMaps = {\n            ...maps,\n            [activeMapId]: currentMapData\n        };\n\n        saveMap({\n            maps: updatedMaps, \n            activeMapId,\n            mapName, creatorName, mapDescription, createdAt,\n            registryItems, setCreatedAt\n        });\n    }, [\n        maps, activeMapId, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain\n    ]);\n\n    const handleLoadMap = useCallback((event) => {\n        loadMap({\n            event, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleLoadBuiltInMap = useCallback((mapData) => {\n        loadBuiltInMap({\n            mapData, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleClearMap = useCallback(() => {\n        clearMap({ \n            mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata \n        });\n    }, [mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    const openNewMapModal = () => {\n        setTempMapName(mapName);\n        setTempCreatorName(creatorName);\n        setTempMapDescription(mapDescription);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = (tempMapName, tempCreatorName, tempMapDescription) => {\n        setMapName(tempMapName || \"New Map\");\n        setCreatorName(tempCreatorName || \"Anonymous\");\n        setMapDescription(tempMapDescription || \"\");\n        setCreatedAt(new Date().toISOString());\n        \n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n        \n        setIsNewMapModalOpen(false);\n    };\n\n    return {\n        handleSaveMap,\n        handleLoadMap,\n        handleLoadBuiltInMap,\n        handleClearMap,\n        openNewMapModal,\n        confirmNewMap\n    };\n};\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = new Set();\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.add(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    if (startId === targetId) return currentData;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    return newData;\n};\n\nexport const paintTile = ({\n    index, brushSize, activeLayer, selectedTile,\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    isRoomAreaVisible, activeTool\n}) => {\n    const isPropsLayer = activeLayer === 'props';\n    const targetLayer = isPropsLayer ? 'object' : activeLayer;\n\n    const targetData = targetLayer === 'tile' ? tileMapData : (targetLayer === 'object' ? objectMapData : secretMapData);\n    const setTargetData = targetLayer === 'tile' ? setTileMapData : (targetLayer === 'object' ? setObjectMapData : setSecretMapData);\n    \n    const newData = [...targetData];\n    let newMetadata = objectMetadata ? { ...objectMetadata } : null;\n    let metadataChanged = false;\n\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                \n                // Protection for Room Areas\n                if (targetLayer === 'secret' && secretMapData[targetIndex] === 'room_area') {\n                    const isRoomAreaTool = activeTool === 'area' || selectedTile?.id === 'room_area';\n                    const isEraser = selectedTile === null;\n                    if (!isRoomAreaVisible && !isRoomAreaTool && !isEraser) {\n                        continue; // Skip overwriting room_area if not visible and not using room tool\n                    }\n                }\n\n                if (isPropsLayer) {\n                    // In props layer, we erase metadata and the object itself\n                    newData[targetIndex] = null;\n                    if (newMetadata && newMetadata[targetIndex]) {\n                        delete newMetadata[targetIndex];\n                        metadataChanged = true;\n                    }\n                } else {\n                    newData[targetIndex] = selectedTile ? selectedTile.id : null;\n                    // If we are painting/erasing in object layer, we should also handle metadata\n                    if (targetLayer === 'object' && selectedTile === null) {\n                        if (newMetadata && newMetadata[targetIndex]) {\n                            delete newMetadata[targetIndex];\n                            metadataChanged = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    setTargetData(newData);\n    if (metadataChanged && setObjectMetadata) {\n        setObjectMetadata(newMetadata);\n    }\n};\n","import { useState, useRef, useEffect, useCallback } from 'react';\nimport { getFloodFillIndices, floodFill, paintTile as paintTileUtil } from '../editorTools/paintingTools';\n\nexport const useEditorPainting = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n    setTileMapData, setObjectMapData, setSecretMapData,\n    activeTool, brushSize, activeLayer, selectedTile, selection, \n    setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n    setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n    objectMetadata, setObjectMetadata,\n    maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n) => {\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [resizeState, setResizeState] = useState(null); // { index, edge, startX, startY, startW, startH }\n    const [moveState, setMoveState] = useState(null); // { index, startX, startY, objId, secretId, meta }\n    const bucketTimerRef = useRef(null);\n\n    const getLinkedRoomAt = useCallback((index) => {\n        if (!showRoomMapContent || !secretMapData || !objectMetadata) return null;\n        \n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n\n        // Scan for room areas\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                const rx = idx % mapWidth;\n                const ry = Math.floor(idx / mapWidth);\n                const rw = meta.width || 1;\n                const rh = meta.height || 1;\n\n                if (x >= rx && x < rx + rw && y >= ry && y < ry + rh) {\n                    return {\n                        mapId: meta.linkedMapId,\n                        roomX: rx,\n                        roomY: ry,\n                        roomWidth: rw,\n                        roomHeight: rh,\n                        localX: x - rx,\n                        localY: y - ry,\n                        map: maps[meta.linkedMapId]\n                    };\n                }\n            }\n        }\n        return null;\n    }, [showRoomMapContent, secretMapData, objectMetadata, maps, mapWidth]);\n\n    const paintTile = useCallback((index) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        \n        if (linkedRoom && showRoomMapContent) {\n            const { mapId, localX, localY, map } = linkedRoom;\n            const rWidth = map.mapWidth;\n            const rHeight = map.mapHeight;\n            const roomIndex = localY * rWidth + localX;\n\n            const setRoomData = (layer, newData) => {\n                updateMapData(mapId, { [layer]: newData });\n            };\n\n            const setRoomMetadata = (newMeta) => {\n                updateMapData(mapId, { objectMetadata: newMeta });\n            };\n\n            paintTileUtil({\n                index: roomIndex,\n                activeTool,\n                brushSize,\n                activeLayer,\n                selectedTile,\n                mapWidth: rWidth,\n                mapHeight: rHeight,\n                tileMapData: map.tileMapData || [],\n                objectMapData: map.objectMapData || [],\n                secretMapData: map.secretMapData || [],\n                objectMetadata: map.objectMetadata || {},\n                setTileMapData: (data) => setRoomData('tileMapData', data),\n                setObjectMapData: (data) => setRoomData('objectMapData', data),\n                setSecretMapData: (data) => setRoomData('secretMapData', data),\n                setObjectMetadata: setRoomMetadata,\n                isRoomAreaVisible\n            });\n            return;\n        }\n\n        paintTileUtil({\n            index,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile,\n            mapWidth,\n            mapHeight,\n            tileMapData,\n            objectMapData,\n            secretMapData,\n            objectMetadata,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData,\n            setObjectMetadata,\n            isRoomAreaVisible\n        });\n    }, [getLinkedRoomAt, showRoomMapContent, updateMapData, activeTool, brushSize, activeLayer, selectedTile, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, isRoomAreaVisible]);\n\n    const handleResizeStart = useCallback((index, edge) => {\n        const meta = objectMetadata[index] || {};\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setResizeState({\n            index,\n            edge,\n            startX: x,\n            startY: y,\n            startW: meta.width || 1,\n            startH: meta.height || 1\n        });\n        setIsDragging(true);\n    }, [objectMetadata, mapWidth, setIsDragging]);\n\n    const handleMoveStart = useCallback((index) => {\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setMoveState({\n            index,\n            startX: x,\n            startY: y,\n            objId: objectMapData[index],\n            secretId: secretMapData[index],\n            meta: objectMetadata[index] ? { ...objectMetadata[index] } : null\n        });\n        setIsDragging(true);\n        setHighlightedIndex(index);\n    }, [objectMapData, secretMapData, objectMetadata, mapWidth, setIsDragging, setHighlightedIndex]);\n\n    const handleGridMouseDown = useCallback((index, e) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n        const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n        const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n        \n        const mTileMapData = useLinked ? linkedRoom.map.tileMapData : tileMapData;\n        const mObjectMapData = useLinked ? linkedRoom.map.objectMapData : objectMapData;\n        const mSecretMapData = useLinked ? linkedRoom.map.secretMapData : secretMapData;\n        const mObjectMetadata = useLinked ? linkedRoom.map.objectMetadata : objectMetadata;\n\n        const mSetTileMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { tileMapData: data }) : setTileMapData;\n        const mSetObjectMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMapData: data }) : setObjectMapData;\n        const mSetSecretMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { secretMapData: data }) : setSecretMapData;\n        const mSetObjectMetadata = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMetadata: data }) : setObjectMetadata;\n\n        // Quick select for configurable objects\n        const existingObjId = mObjectMapData[mIndex];\n        const existingSecretId = mSecretMapData[mIndex];\n        const isEraser = selectedTile === null && activeTool === 'brush';\n        const isRoomMap = maps[activeMapId]?.type === 'room';\n\n        if (!isEraser && (existingObjId || existingSecretId) && setActivePanel && setHighlightedIndex) {\n            const objDef = existingObjId ? registryItems?.find(r => r.id === existingObjId) : null;\n            const secretDef = existingSecretId ? registryItems?.find(r => r.id === existingSecretId) : null;\n\n            const isWeather = objDef && objDef.type === 'weather_trigger';\n            const isMessage = objDef && objDef.type === 'message_trigger';\n            const isPortalOrTarget = existingObjId && (existingObjId.includes('portal') || existingObjId.includes('target') || existingObjId === 'portal_target');\n            const isDoor = objDef && objDef.subtype === 'door';\n            const isRoomArea = secretDef && secretDef.subtype === 'room' && !isRoomMap;\n\n            if (isWeather || isMessage || isPortalOrTarget || isDoor || isRoomArea) {\n                setActivePanel('props');\n                setHighlightedIndex(useLinked ? index : mIndex);\n            }\n        }\n\n        if (activeTool === 'brush') {\n            setIsDragging(true);\n            paintTile(index);\n        } else if (activeTool === 'area') {\n            setIsDragging(true);\n            setDragStart({ x: index % mapWidth, y: Math.floor(index / mapWidth) });\n        } else if (activeTool === 'bucket') {\n            const isPropsLayer = activeLayer === 'props';\n            const targetLayer = isPropsLayer ? 'object' : activeLayer;\n            const targetData = targetLayer === 'tile' ? mTileMapData : (targetLayer === 'object' ? mObjectMapData : mSecretMapData);\n            const targetValue = targetData[mIndex];\n            const newValue = selectedTile ? selectedTile.id : null;\n            if (targetValue === newValue) return;\n\n            const newData = floodFill(mIndex, newValue, targetData, mWidth, mHeight);\n            \n            if (targetLayer === 'tile') mSetTileMapData(newData);\n            else if (targetLayer === 'object') {\n                mSetObjectMapData(newData);\n                // Clean up metadata for all affected indices if erasing\n                if (newValue === null && mObjectMetadata && mSetObjectMetadata) {\n                    const affectedIndices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                    let metaChanged = false;\n                    const newMeta = { ...mObjectMetadata };\n                    affectedIndices.forEach(idx => {\n                        if (newMeta[idx]) {\n                            delete newMeta[idx];\n                            metaChanged = true;\n                        }\n                    });\n                    if (metaChanged) mSetObjectMetadata(newMeta);\n                }\n            }\n            else mSetSecretMapData(newData);\n        } else if (activeTool === 'move') {\n            if (selection) return;\n\n            // If we clicked on an object/secret, start moving it\n            if (existingObjId || existingSecretId) {\n                handleMoveStart(mIndex); // Note: move/resize on linked rooms might still be buggy\n            } else {\n                const x = index % mapWidth;\n                const y = Math.floor(index / mapWidth);\n                setDragStart({ x, y });\n                setIsDragging(true);\n            }\n        }\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, setActivePanel, setHighlightedIndex, registryItems, activeTool, setIsDragging, paintTile, activeLayer, selectedTile, selection, handleMoveStart, setDragStart, getLinkedRoomAt, showRoomMapContent, updateMapData]);\n\n    const handleGridMouseMove = useCallback((index) => {\n        setHoverIndex(index);\n        const curX = index % mapWidth;\n        const curY = Math.floor(index / mapWidth);\n\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        if (resizeState) {\n            // Resize logic - keep on active map for now as it's complex\n            const dx = curX - resizeState.startX;\n            const dy = curY - resizeState.startY;\n            let newW = resizeState.startW;\n            let newH = resizeState.startH;\n            let newIndex = resizeState.index;\n\n            if (resizeState.edge === 'right') newW = Math.max(1, resizeState.startW + dx);\n            if (resizeState.edge === 'bottom') newH = Math.max(1, resizeState.startH + dy);\n            \n            if (resizeState.edge === 'left') {\n                const shift = Math.min(resizeState.startW - 1, dx);\n                newW = resizeState.startW - shift;\n                newIndex = resizeState.startY * mapWidth + (resizeState.startX + shift);\n            }\n            if (resizeState.edge === 'top') {\n                const shift = Math.min(resizeState.startH - 1, dy);\n                newH = resizeState.startH - shift;\n                newIndex = (resizeState.startY + shift) * mapWidth + resizeState.startX;\n            }\n\n            if (newW !== (objectMetadata[resizeState.index]?.width || 1) || \n                newH !== (objectMetadata[resizeState.index]?.height || 1) ||\n                newIndex !== resizeState.index) {\n                \n                const meta = { ...objectMetadata[resizeState.index] };\n                meta.width = newW;\n                meta.height = newH;\n                \n                setObjectMetadata(prev => {\n                    const next = { ...prev };\n                    delete next[resizeState.index];\n                    next[newIndex] = meta;\n                    return next;\n                });\n\n                if (newIndex !== resizeState.index) {\n                    const objId = objectMapData[resizeState.index];\n                    const secretId = secretMapData[resizeState.index];\n                    setObjectMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = objId;\n                        return next;\n                    });\n                    setSecretMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = secretId;\n                        return next;\n                    });\n                    setResizeState(prev => ({ ...prev, index: newIndex, startX: newIndex % mapWidth, startY: Math.floor(newIndex / mapWidth), startW: newW, startH: newH }));\n                    setHighlightedIndex(newIndex);\n                }\n            }\n        } else if (moveState) {\n            if (index === moveState.index) return;\n            \n            // Perform move\n            setObjectMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.objId;\n                return next;\n            });\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.secretId;\n                return next;\n            });\n            setObjectMetadata(prev => {\n                const next = { ...prev };\n                delete next[moveState.index];\n                if (moveState.meta) next[index] = moveState.meta;\n                return next;\n            });\n            setMoveState(prev => ({ ...prev, index, startX: curX, startY: curY }));\n            setHighlightedIndex(index);\n\n        } else if (activeTool === 'brush' && isDragging) {\n            paintTile(index);\n        } else if (activeTool === 'bucket') {\n            if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = setTimeout(() => {\n                const targetLayer = activeLayer === 'props' ? 'object' : activeLayer;\n                \n                const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n                const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n                const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n                const mData = useLinked ? linkedRoom.map : { tileMapData, objectMapData, secretMapData };\n                \n                const targetData = targetLayer === 'tile' ? mData.tileMapData : (targetLayer === 'object' ? mData.objectMapData : mData.secretMapData);\n                const indices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                \n                if (useLinked) {\n                    // We need to convert linked room indices back to main map indices for preview?\n                    // Or just skip preview for linked rooms for now to keep it simple.\n                    setBucketPreviewIndices(new Set()); \n                } else {\n                    setBucketPreviewIndices(indices);\n                }\n            }, 10);\n        }\n    }, [setHoverIndex, activeTool, isDragging, paintTile, activeLayer, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight, setBucketPreviewIndices, resizeState, moveState, objectMetadata, setObjectMetadata, setObjectMapData, setSecretMapData, setHighlightedIndex, getLinkedRoomAt, showRoomMapContent]);\n\n    const handleGridMouseUp = useCallback((index) => {\n        if (activeTool === 'area' && isDragging && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n            const baseIndex = y1 * mapWidth + x1;\n\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[baseIndex] = 'room_area';\n                return next;\n            });\n            setObjectMetadata(prev => ({\n                ...prev,\n                [baseIndex]: { ...prev[baseIndex], width: w, height: h, roomName: 'New Room' }\n            }));\n            setHighlightedIndex(baseIndex);\n            if (setActivePanel) setActivePanel('props');\n            setIsDragging(false);\n            setDragStart(null);\n            return;\n        }\n\n        if (activeTool === 'move' && isDragging && !resizeState && !moveState && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const tileData = [];\n            const objectData = [];\n            const secretData = [];\n            const selectionMetadata = {};\n\n            for (let y = y1; y <= y2; y++) {\n                for (let x = x1; x <= x2; x++) {\n                    const idx = y * mapWidth + x;\n                    tileData.push(tileMapData[idx]);\n                    objectData.push(objectMapData[idx]);\n                    secretData.push(secretMapData[idx]);\n                    if (objectMetadata[idx]) {\n                        selectionMetadata[`${x - x1},${y - y1}`] = { ...objectMetadata[idx] };\n                    }\n                }\n            }\n\n            setSelection({\n                x: x1, y: y1, w, h,\n                originalX: x1, originalY: y1,\n                tileData, objectData, secretData,\n                metadata: selectionMetadata\n            });\n            setPreviewPosition({ x: x1, y: y1 });\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            });\n            setDragStart(null);\n        }\n\n        setIsDragging(false);\n        setResizeState(null);\n        setMoveState(null);\n    }, [activeTool, isDragging, resizeState, moveState, dragStart, mapWidth, tileMapData, objectMapData, secretMapData, setSelection, setPreviewPosition, setOriginalMapData, setDragStart, setIsDragging]);\n\n    return {\n        hoverIndex,\n        setHoverIndex,\n        bucketPreviewIndices,\n        setBucketPreviewIndices,\n        handleGridMouseDown,\n        handleGridMouseMove,\n        handleGridMouseUp,\n        handleResizeStart,\n        handleMoveStart,\n        paintTile\n    };\n};\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { resizeMapData } from './editorTools/mapOperations';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './editorTools/NewMapModal';\nimport { BuiltInMapsModal } from './editorTools/BuiltInMapsModal';\nimport { EditorScene } from './EditorScene';\nimport { EditorElements } from './EditorElements';\nimport { EditorTools } from './EditorTools';\nimport PixiStage from '../game/PixiStage';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\n// Custom Hooks\nimport { useEditorRegistry } from './hooks/useEditorRegistry';\nimport { useEditorSelection } from './hooks/useEditorSelection';\nimport { useEditorPlayMode } from './hooks/useEditorPlayMode';\nimport { useEditorOperations } from './hooks/useEditorOperations';\nimport { useEditorPainting } from './hooks/useEditorPainting';\nimport { useEditorMaps } from './hooks/useEditorMaps';\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nexport const Editor = () => {\n    const registryItems = useMemo(() => getRegistry() || [], []);\n    const playerVisuals = useMemo(() => registryItems.find(item => item.id === 'player') || EMPTY_OBJECT, [registryItems]);\n\n    // Basic Map State\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [objectMetadata, setObjectMetadata] = useState({});\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n    const [showBackgroundImage, setShowBackgroundImage] = useState(true);\n    const [showMessages, setShowMessages] = useState(() => {\n        try {\n            const v = localStorage.getItem('editor_show_messages');\n            if (v === null) return true;\n            return v !== '0';\n        } catch {\n            return true;\n        }\n    });\n\n    // Tools & Modes State\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [isRoomAreaVisible, setIsRoomAreaVisible] = useState(false);\n    const [showRoomMapContent, setShowRoomMapContent] = useState(false);\n    const [isWorldViewOpen, setIsWorldViewOpen] = useState(false);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata });\n\n    // Metadata State\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [mapDescription, setMapDescription] = useState(\"\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [highlightedIndex, setHighlightedIndex] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [isBuiltInMapsModalOpen, setIsBuiltInMapsModalOpen] = useState(false);\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n    const [tempMapDescription, setTempMapDescription] = useState(\"\");\n    const [activePanel, setActivePanel] = useState(null);\n\n    // Asset Options\n    const backgroundOptions = useMemo(() => loadBackgroundOptions(), []);\n    const musicOptions = useMemo(() => loadMusicOptions(), []);\n\n    // Background State\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#99C1F1');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    // Weather State\n    const [weatherRain, setWeatherRain] = useState(0);\n    const [weatherSnow, setWeatherSnow] = useState(0);\n    const [weatherClouds, setWeatherClouds] = useState(0);\n    const [weatherFog, setWeatherFog] = useState(0);\n    const [weatherThunder, setWeatherThunder] = useState(0);\n    const [weatherLavaRain, setWeatherLavaRain] = useState(0);\n    const [weatherRadioactiveFog, setWeatherRadioactiveFog] = useState(0);\n    const [weatherMeteorRain, setWeatherMeteorRain] = useState(0);\n\n    const [playerPosition, setPlayerPosition] = useState({ x: 100, y: 100 });\n\n    useEffect(() => {\n        try { localStorage.setItem('editor_show_messages', showMessages ? '1' : '0'); } catch {}\n    }, [showMessages]);\n\n    // Multi-map state\n    const { \n        maps, setMaps, activeMapId, setActiveMapId, createMap: createNewMap, updateMapData, deleteMap \n    } = useEditorMaps();\n\n    const lastActiveMapIdRef = useRef(activeMapId);\n\n    const switchMap = useCallback((newMapId, spawnTriggerId = null) => {\n        if (newMapId === activeMapId) return;\n\n        // 1. Save current map data to store\n        updateMapData(activeMapId, {\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n            weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n            playerPosition\n        });\n\n        // 2. Load new map data\n        const nextMap = maps[newMapId];\n        if (nextMap) {\n            setMapWidth(nextMap.mapWidth);\n            setMapHeight(nextMap.mapHeight);\n            setTileMapData(nextMap.tileMapData);\n            setObjectMapData(nextMap.objectMapData);\n            setSecretMapData(nextMap.secretMapData);\n            setObjectMetadata(nextMap.objectMetadata || {});\n            setCreatedAt(nextMap.createdAt || new Date().toISOString());\n            setSelectedBackgroundImage(nextMap.selectedBackgroundImage);\n            setSelectedBackgroundColor(nextMap.selectedBackgroundColor);\n            setBackgroundParallaxFactor(nextMap.backgroundParallaxFactor || 0.3);\n            setSelectedBackgroundMusic(nextMap.selectedBackgroundMusic);\n            \n            if (nextMap.weather) {\n                setWeatherRain(nextMap.weather.rain || 0);\n                setWeatherSnow(nextMap.weather.snow || 0);\n                setWeatherClouds(nextMap.weather.clouds || 0);\n                setWeatherFog(nextMap.weather.fog || 0);\n                setWeatherThunder(nextMap.weather.thunder || 0);\n                setWeatherLavaRain(nextMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(nextMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(nextMap.weather.meteorRain || 0);\n            }\n            \n            if (nextMap.playerPosition) {\n                setPlayerPosition(nextMap.playerPosition);\n            }\n            \n            // If we have a spawnTriggerId, we might want to store it temporarily\n            // so useEditorPlayMode can include it in mapDataForGame.meta\n            // But actually, we can just update the map data in the store with this triggerId.\n            if (spawnTriggerId !== null) {\n                updateMapData(newMapId, { ...nextMap, spawnTriggerId });\n            }\n\n            setActiveMapId(newMapId);\n        }\n    }, [\n        activeMapId, maps, updateMapData, setActiveMapId,\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const handleCreateMap = useCallback((type, name, width, height) => {\n        const finalName = name || prompt(`Enter ${type} map name:`, `New ${type.charAt(0).toUpperCase() + type.slice(1)}`);\n        if (finalName) {\n            const finalWidth = width || mapWidth;\n            const finalHeight = height || mapHeight;\n            const newId = createNewMap(type, finalName, finalWidth, finalHeight);\n            return newId;\n        }\n    }, [createNewMap, mapWidth, mapHeight]);\n\n    // Update store when current map data changes (for minimap preview)\n    useEffect(() => {\n        // Skip update if activeMapId just changed to prevent overwriting new map data with old map state\n        if (lastActiveMapIdRef.current !== activeMapId) {\n            lastActiveMapIdRef.current = activeMapId;\n            return;\n        }\n\n        const timeout = setTimeout(() => {\n            updateMapData(activeMapId, {\n                mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n                selectedBackgroundImage, selectedBackgroundColor,\n                selectedBackgroundMusic, backgroundParallaxFactor,\n                weather: {\n                    rain: weatherRain,\n                    snow: weatherSnow,\n                    clouds: weatherClouds,\n                    fog: weatherFog,\n                    thunder: weatherThunder,\n                    lavaRain: weatherLavaRain,\n                    radioactiveFog: weatherRadioactiveFog,\n                    meteorRain: weatherMeteorRain\n                },\n                playerPosition\n            });\n        }, 1000); // Debounce store updates\n        return () => clearTimeout(timeout);\n    }, [\n        activeMapId, updateMapData, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, selectedBackgroundMusic, backgroundParallaxFactor,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    // Use Custom Hooks\n    const { \n        blocks, liquids, entities, decorations, items, interactables, hazards, secrets, weather, messages, crackableWalls, pushableWalls, obstacles \n    } = useEditorRegistry(registryItems);\n\n    const { \n        selection, setSelection, selectionMode, setSelectionMode, previewPosition, setPreviewPosition,\n        originalMapData, setOriginalMapData, moveSelection, commitSelection, cancelSelection \n    } = useEditorSelection(mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata);\n\n    const {\n        isPlayMode, handlePlay, handlePause, handleReset, handleReplay, handleStateUpdate, handleForceStop,\n        playModeObjectData, playModeSecretData, playModeWeather, playModeMaps, gameMessage, revealedSecrets, \n        activeRoomIds, gameEngineState, isGameOver\n    } = useEditorPlayMode(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n        registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        maps, activeMapId, switchMap, maps[activeMapId]?.spawnTriggerId,\n        setTileMapData, updateMapData\n    );\n\n    const {\n        handleSaveMap, handleLoadMap, handleLoadBuiltInMap, handleClearMap, openNewMapModal, confirmNewMap\n    } = useEditorOperations(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        maps, setMaps, activeMapId, setActiveMapId\n    );\n\n    const handleLoadMapWrapped = useCallback((event) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadMap(event);\n    }, [isPlayMode, handleForceStop, handleLoadMap]);\n\n    const handleLoadBuiltInMapWrapped = useCallback((mapData) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadBuiltInMap(mapData);\n    }, [isPlayMode, handleForceStop, handleLoadBuiltInMap]);\n\n    const {\n        hoverIndex, setHoverIndex, bucketPreviewIndices, setBucketPreviewIndices,\n        handleGridMouseDown, handleGridMouseMove, handleGridMouseUp,\n        handleResizeStart, handleMoveStart, paintTile\n    } = useEditorPainting(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n        setTileMapData, setObjectMapData, setSecretMapData,\n        activeTool, brushSize, activeLayer, selectedTile, selection, \n        setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n        setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n        objectMetadata, setObjectMetadata,\n        maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n    );\n\n    // Side Effects\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    const togglePanel = (panel) => {\n        setActivePanel(prev => prev === panel ? null : panel);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n        resizeMapData({\n            newWidth, newHeight, stateRef, setMapWidth, setMapHeight,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata\n        });\n    };\n\n    const handlePaletteSelect = useCallback((item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    }, []);\n\n    // Grid Event Handlers\n    \n    const handleGridMouseLeave = useCallback(() => {\n        setHoverIndex(null);\n        setBucketPreviewIndices(new Set());\n    }, [setHoverIndex, setBucketPreviewIndices]);\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    const onAddRoomArea = useCallback(() => {\n        setIsWorldViewOpen(false);\n        setActiveTool('area');\n        setActiveLayer('secret');\n    }, []);\n\n    const handleDeleteMap = useCallback((id) => {\n        if (id === activeMapId) {\n            switchMap('main');\n        }\n        deleteMap(id);\n    }, [activeMapId, switchMap, deleteMap]);\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\n            <NewMapModal \n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                tempMapDescription={tempMapDescription}\n                setTempMapDescription={setTempMapDescription}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <BuiltInMapsModal \n                isOpen={isBuiltInMapsModalOpen}\n                onClose={() => setIsBuiltInMapsModalOpen(false)}\n                onSelect={handleLoadBuiltInMapWrapped}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', flex: 1, flexDirection: 'row',\n                filter: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'none' : 'auto',\n                overflow: 'hidden'\n            }}>\n                <EditorElements \n                    mapName={mapName}\n                    creatorName={creatorName}\n                    mapDescription={mapDescription}\n                    setMapName={setMapName}\n                    setCreatorName={setCreatorName}\n                    setMapDescription={setMapDescription}\n                    openNewMapModal={openNewMapModal}\n                    openBuiltInModal={() => setIsBuiltInMapsModalOpen(true)}\n                    saveMap={handleSaveMap}\n                    loadMap={handleLoadMapWrapped}\n                    clearMap={handleClearMap}\n                    isPlayMode={isPlayMode}\n                    handlePaletteSelect={handlePaletteSelect}\n                    selectedTile={selectedTile}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    decorations={decorations}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    weather={weather}\n                    messages={messages}\n                    crackableWalls={crackableWalls}\n                    pushableWalls={pushableWalls}\n                    obstacles={obstacles}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    objectMapData={objectMapData}\n                    secretMapData={secretMapData}\n                    objectMetadata={objectMetadata}\n                    setObjectMetadata={setObjectMetadata}\n                    registryItems={registryItems}\n                    highlightedIndex={highlightedIndex}\n                    setHighlightedIndex={setHighlightedIndex}\n                    activePanel={activePanel}\n                    setActivePanel={setActivePanel}\n                    togglePanel={togglePanel}\n                    maps={maps}\n                    activeMapId={activeMapId}\n                    createMap={handleCreateMap}\n                />\n\n                <div style={{ display: 'flex', flex: 1, flexDirection: 'column', overflow: 'hidden' }}>\n                    <EditorTools\n                        mapName={mapName}\n                        creatorName={creatorName}\n                        activePanel={activePanel}\n                        togglePanel={togglePanel}\n                        showGrid={showGrid}\n                        setShowGrid={setShowGrid}\n                        isPlayMode={isPlayMode}\n                        handlePlay={handlePlay}\n                        handlePause={handlePause}\n                        handleReset={handleReset}\n                        activeTool={activeTool}\n                        setActiveTool={setActiveTool}\n                        brushSize={brushSize}\n                        setBrushSize={setBrushSize}\n                        activeLayer={activeLayer}\n                        selection={selection}\n                        moveSelection={moveSelection}\n                        selectionMode={selectionMode}\n                        setSelectionMode={setSelectionMode}\n                        commitSelection={commitSelection}\n                        cancelSelection={cancelSelection}\n                        selectedTile={selectedTile}\n                        handlePaletteSelect={handlePaletteSelect}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        showBackgroundImage={showBackgroundImage}\n                        setShowBackgroundImage={setShowBackgroundImage}\n                        showMessages={showMessages}\n                        setShowMessages={setShowMessages}\n                        isRoomAreaVisible={isRoomAreaVisible}\n                        setIsRoomAreaVisible={setIsRoomAreaVisible}\n                        showRoomMapContent={showRoomMapContent}\n                        setShowRoomMapContent={setShowRoomMapContent}\n                    />\n                    \n                    <div style={{ display: 'flex', flex: 1, flexDirection: 'row', overflow: 'hidden', position: 'relative' }}>\n\n                    <EditorScene \n                        handleMapResize={handleMapResize}\n                        isResizeWindowOpen={isResizeWindowOpen}\n                        setIsResizeWindowOpen={setIsResizeWindowOpen}\n                        isWorldViewOpen={isWorldViewOpen}\n                        setIsWorldViewOpen={setIsWorldViewOpen}\n                        onAddRoomArea={onAddRoomArea}\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                        // Multi-map props\n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        createMap={handleCreateMap}\n                        deleteMap={handleDeleteMap}\n                        updateMapData={updateMapData}\n                        showRoomMapContent={showRoomMapContent}\n                        activeRoomIds={activeRoomIds}\n                    />\n\n                    {!isPlayMode ? (\n                        <Viewport\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            selectedBackgroundUrl={selectedBackgroundUrl}\n                            selectedBackgroundColor={selectedBackgroundColor}\n                            selectedBackgroundImage={selectedBackgroundImage}\n                            showBackgroundImage={showBackgroundImage}\n                            showGrid={showGrid}\n                            activeLayer={activeLayer}\n                            activeTool={activeTool}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            hoverIndex={hoverIndex}\n                            highlightedIndex={highlightedIndex}\n                            brushSize={brushSize}\n                            bucketPreviewIndices={bucketPreviewIndices}\n                            selection={selection}\n                            previewPosition={previewPosition}\n                            dragStart={dragStart}\n                            isDragging={isDragging}\n                            handleGridMouseDown={handleGridMouseDown}\n                            handleGridMouseEnter={handleGridMouseMove}\n                            handleGridMouseUp={handleGridMouseUp}\n                            handleGridMouseLeave={handleGridMouseLeave}\n                            handleResizeStart={handleResizeStart}\n                            handleMoveStart={handleMoveStart}\n                            setIsDragging={setIsDragging}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            mapType={maps[activeMapId]?.type || 'overworld'}\n                            isRoomAreaVisible={isRoomAreaVisible}\n                            showRoomMapContent={showRoomMapContent}\n                            showMessages={showMessages}\n                            maps={maps}\n                        />\n                    ) : (\n                        <div style={{ flex: 1, position: 'relative', backgroundColor: '#000' }}>\n                            <PixiStage\n                                mapWidth={mapWidth}\n                                mapHeight={mapHeight}\n                                tileSize={TILE_SIZE}\n                                tileMapData={tileMapData}\n                                objectMapData={playModeObjectData}\n                                secretMapData={playModeSecretData}\n                                revealedSecrets={revealedSecrets || []}\n                                registryItems={registryItems}\n                                playerState={gameEngineState}\n                                playerVisuals={playerVisuals}\n                                projectiles={gameEngineState?.projectiles || []}\n                                objectMetadata={objectMetadata}\n                                backgroundImage={showBackgroundImage ? selectedBackgroundImage : null}\n                                backgroundColor={selectedBackgroundColor}\n                                backgroundParallaxFactor={backgroundParallaxFactor}\n                                weatherRain={playModeWeather.rain}\n                                weatherLavaRain={playModeWeather.lavaRain}\n                                weatherSnow={playModeWeather.snow}\n                                weatherMeteorRain={playModeWeather.meteorRain}\n                                weatherClouds={playModeWeather.clouds}\n                                weatherFog={playModeWeather.fog}\n                                weatherRadioactiveFog={playModeWeather.radioactiveFog}\n                                weatherThunder={playModeWeather.thunder}\n                                onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                                isEditor={false}\n                                isEditorPlayMode={true}\n                                showGrid={showGrid}\n                            mapType={(playModeMaps?.[activeMapId]?.type || maps[activeMapId]?.type) || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={playModeMaps || maps}\n                        />\n                            {isGameOver && (\n                                <GameOverOverlay>\n                                    <GameOverTitle>Game Over</GameOverTitle>\n                                    <ReplayButton onClick={handleReplay}>\n                                        REPLAY \n                                    </ReplayButton>\n                                </GameOverOverlay>\n                            )}\n                            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    </div>\n);\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import { useState, useCallback } from 'react';\n\nexport const useEditorMaps = () => {\n    const [maps, setMaps] = useState({\n        'main': {\n            id: 'main',\n            name: 'Main',\n            description: '',\n            type: 'overworld',\n            mapWidth: 20,\n            mapHeight: 15,\n            tileMapData: Array(20 * 15).fill(null),\n            objectMapData: Array(20 * 15).fill(null),\n            secretMapData: Array(20 * 15).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: '#99C1F1',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: { x: 100, y: 100 },\n            worldX: 50,\n            worldY: 50\n        }\n    });\n    const [activeMapId, setActiveMapId] = useState('main');\n\n    const createMap = useCallback((type, name, width = 20, height = 15) => {\n        const id = `map_${Date.now()}`;\n        \n        // Find a good spot for new map\n        const existingMaps = Object.values(maps);\n        const maxY = Math.max(...existingMaps.map(m => m.worldY || 0), 0);\n        \n        const newMap = {\n            id,\n            name: name || (type === 'overworld' ? 'New Overworld' : 'New Underworld'),\n            description: '',\n            type,\n            mapWidth: width,\n            mapHeight: height,\n            tileMapData: Array(width * height).fill(null),\n            objectMapData: Array(width * height).fill(null),\n            secretMapData: Array(width * height).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: type === 'overworld' ? '#99C1F1' : '#1a1a1a',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: null, // Only one map should have player eventually\n            worldX: 50,\n            worldY: maxY + 150\n        };\n\n        setMaps(prev => ({\n            ...prev,\n            [id]: newMap\n        }));\n        return id;\n    }, []);\n\n    const updateMapData = useCallback((id, data) => {\n        setMaps(prev => ({\n            ...prev,\n            [id]: {\n                ...prev[id],\n                ...data\n            }\n        }));\n    }, []);\n\n    const deleteMap = useCallback((id) => {\n        if (id === 'main') return; // Cannot delete main map\n        setMaps(prev => {\n            const newMaps = { ...prev };\n            delete newMaps[id];\n            return newMaps;\n        });\n        if (activeMapId === id) {\n            setActiveMapId('main');\n        }\n    }, [activeMapId]);\n\n    return {\n        maps,\n        setMaps,\n        activeMapId,\n        setActiveMapId,\n        createMap,\n        updateMapData,\n        deleteMap\n    };\n};\n","import { useMemo } from 'react';\n\nexport const useEditorRegistry = (registryItems) => {\n    const blocks = useMemo(() => \n        registryItems.filter(item => {\n            if (!item.name || !item.name.startsWith('block.')) return false;\n            if (item.flags && item.flags.liquid) return false;\n            if (item.editor && item.editor.panel && item.editor.panel !== 'blocks') return false;\n            return true;\n        }), \n    [registryItems]);\n\n    const liquids = useMemo(() => \n        registryItems.filter(item => item.flags && item.flags.liquid), \n    [registryItems]);\n\n    const entities = useMemo(() => {\n        const baseEntities = registryItems.filter(item => {\n            if (!item.name || !item.name.toLowerCase().includes('entities.')) return false;\n            if (item.isHiddenInEditor) return false;\n            return !item.type || item.type === 'default' || item.type === 'entity' || item.subtype === 'tank';\n        });\n\n        const itemsToMove = registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            item.id !== 'hertz_item' && \n            item.id !== 'fireball_ammo'\n        );\n\n        return [...baseEntities, ...itemsToMove];\n    }, [registryItems]);\n\n    const decorations = useMemo(() => \n        registryItems.filter(item => {\n            if (item.type === 'decoration') return true;\n            if (item.name && item.name.toLowerCase().includes('decoration.')) return true;\n            if (item.id && item.id.includes('stone_pack')) return true;\n            return false;\n        }), \n    [registryItems]);\n\n    const items = useMemo(() => \n        registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            (item.id === 'hertz_item' || item.id === 'fireball_ammo')\n        ), \n    [registryItems]);\n\n    const interactables = useMemo(() => \n        registryItems.filter(item => {\n            if (item.editor && item.editor.panel) return item.editor.panel === 'interactables';\n            return item.type === 'interactable' || (item.name && item.name.startsWith('interactable.'));\n        }), \n    [registryItems]);\n\n    const hazards = useMemo(() => \n        registryItems.filter(item => item.type === 'hazard' || (item.name && item.name.startsWith('hazard.'))), \n    [registryItems]);\n\n    const secrets = useMemo(() => \n        registryItems.filter(item => item.type === 'secret'), \n    [registryItems]);\n\n    const weather = useMemo(() => \n        registryItems.filter(item => item.type === 'weather_trigger'), \n    [registryItems]);\n\n    const messages = useMemo(() => \n        registryItems.filter(item => item.type === 'message_trigger'), \n    [registryItems]);\n\n    const crackableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'crack_block'),\n    [registryItems]);\n\n    const pushableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'wolf_secret'),\n    [registryItems]);\n\n    const obstacles = useMemo(() => \n        registryItems.filter(item => item.type === 'obstacle' || (item.name && item.name.startsWith('obstacle.'))), \n    [registryItems]);\n\n    return {\n        blocks,\n        liquids,\n        entities,\n        decorations,\n        items,\n        interactables,\n        hazards,\n        secrets,\n        weather,\n        messages,\n        crackableWalls,\n        pushableWalls,\n        obstacles\n    };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nexport const useEditorSelection = (mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata) => {\n    const [selection, setSelection] = useState(null);\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n\n    const moveSelection = useCallback((dx, dy) => {\n        if (!selection || !previewPosition) return;\n        setPreviewPosition({ \n            x: previewPosition.x + dx, \n            y: previewPosition.y + dy \n        });\n    }, [selection, previewPosition]);\n\n    const cancelSelection = useCallback(() => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, []);\n\n    const commitSelection = useCallback(() => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n        const newObjectMetadata = { ...originalMapData.objectMetadata };\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                        delete newObjectMetadata[idx];\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                    \n                    if (selection.metadata && selection.metadata[`${px},${py}`]) {\n                        newObjectMetadata[destIdx] = { ...selection.metadata[`${px},${py}`] };\n                    }\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setObjectMetadata(newObjectMetadata);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, [selection, previewPosition, originalMapData, selectionMode, mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode, commitSelection, cancelSelection]);\n\n    return {\n        selection,\n        setSelection,\n        selectionMode,\n        setSelectionMode,\n        previewPosition,\n        setPreviewPosition,\n        originalMapData,\n        setOriginalMapData,\n        moveSelection,\n        commitSelection,\n        cancelSelection\n    };\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/Editor\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","activeMapData","tileMapData","objectMapData","secretMapData","objectMetadata","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","projectMaps","isLoading","error","isPaused","isGameOver","activeRoomIds","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","meta","maps","updateObjectMap","updateObjectMetadata","index","metadata","mapId","activeId","activeMapId","activeMap","targetId","removeObjectAtIndex","undefined","room","layerData","layers","find","l","type","data","length","removeTileAtIndex","moveTileInMap","fromIndex","toIndex","len","moveObjectInMap","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","forEach","idx","includes","push","toggleRoom","roomId","filter","clearRooms","setLoading","setError","setPaused","setGameOver","resetGame","actions","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","ui","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","lv_navigation_home","no_navigation","no_navigation_home","en_navigation","en_navigation_home","ru_navigation","ru_navigation_home","ja_navigation","ja_navigation_home","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","tutorial","lv_tutorial_messages","lv_game_map_selector","editor_elements","lv_editor_elements","editor_scene","lv_editor_scene","editor_tools","lv_editor_tools","no","no_tutorial_messages","no_game_map_selector","no_editor_elements","no_editor_scene","no_editor_tools","en","en_tutorial_messages","en_game_map_selector","en_editor_elements","en_editor_scene","en_editor_tools","ru","ru_tutorial_messages","ru_game_map_selector","ru_editor_elements","ru_editor_scene","ru_editor_tools","ja","ja_tutorial_messages","ja_game_map_selector","ja_editor_elements","ja_editor_scene","ja_editor_tools","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","SettingsButton","props","$soundOff","DropdownContainer","div","DropdownMenu","MenuItem","ToggleSwitch","$active","SectionHeaderNavigationLanguages","dropdownRef","useRef","isMenuOpen","setIsMenuOpen","useState","soundEnabled","setSoundEnabled","v","localStorage","getItem","currentLang","language","handleLanguageChange","newLang","changeLanguage","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","ref","title","toggleSound","next","setItem","CustomEvent","detail","enabled","height","backgroundColor","margin","padding","color","StyledLogo","p","SectionHeaderNavigationLogo","tag","trim","toLowerCase","StyledSectionHeaderNavigation","StyledSectionContent","_registry","_registryMap","initRegistry","console","time","jsonContext","require","imageContext","soundContext","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","resolveSoundsMap","sounds","Array","isArray","k","entries","key","item","resolvedTexture","texture","resolvedTextures","textures","path","sfx","sfxResolved","defaultAnimation","animItem","r","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","Map","set","__byId","log","timeEnd","getRegistry","findItemById","get","items","flexDirection","justifyContent","alignItems","width","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","apiUrl","env","REACT_APP_API_URL","logo","URL_LOGO_01","URL_LOGO_02","URL_LOGO_03","URL_LOGO_04","URL_LOGO_05","HomeContainer","Home","LOGO_01","config","LOGO_02","LOGO_03","LOGO_04","LOGO_05","src","alt","TextureCache","constructor","this","_map","url","m","has","tex","Texture","from","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","maxParticles","resize","area","Math","max","floor","setIntensity","min","Number","spawnOne","g","Graphics","rect","fill","alpha","viewport","getViewport","x","y","random","speed","vx","vy","rotation","addChild","bounces","alive","update","dtMs","targetIntensity","abs","lerpFactor","exp","norm","scaled","pow","deficit","maxPerFrame","smooth","ceil","toSpawn","i","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","strength","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","vY","vH","j","splice","WeatherSnow","flakes","seeded","maxFlakes","options","circle","minY","maxY","drift","settled","life","phase","restMs","viewportH","viewportY","seedCount","f","sin","sYwater","sYlava","gAcc","WeatherClouds","bandHeight","patches","windDirection","filters","BlurFilter","quality","rebuild","isInitial","w","h","vX","vW","range","rx","ry","circles","baseR","PI","dist","cx","cos","cy","targetAlpha","currentAlpha","dying","targetCount","W","bandTop","bandBottom","activePatches","_spawnTimer","toKill","osc","leftBound","rightBound","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","nv","_applyAlphas","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","moveTo","lineTo","stroke","alignment","cap","join","branchCount","ang","bx","by","worldX","maxH","isSolid","WeatherLavaRain","waterY","WeatherRadioactiveFog","WeatherMeteorRain","size","isLarge","atan2","waterTouched","playerState","getPlayerState","hitEntity","px","py","pr","dx","dy","entities","ent","ex","ey","er","edx","edy","onMeteorHit","surfaceType","liquidType","getLiquidTypeAt","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","count","spd","d","BubbleFX","bubbles","maxBubbles","rise","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","cur","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","bgContainer","_regions","_waterTex","_lavaTex","_quicksandTex","_waterfallTex","_lavaWaterfallTex","_radioactiveWaterTex","_radioactiveWaterfallTex","_time","_noiseTex","_lavaDetailTex","_waterDetailTex","_quicksandDetailTex","_playerState","setPlayerState","_checkPlayerInRegion","region","pw","ph","pt","tileIndicesSet","getSurfaceY","X","topEdges","bgNode","_gradTextures","mw","mh","ts","changed","waterDrift","lavaDrift","quicksandDrift","waterfallDrift","lavaWaterfallDrift","radioactiveWaterDrift","radioactiveWaterfallDrift","sprite","alphaDiff","splashG","bottomEdges","F","splashHeight","splashColor","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","ampNow","amp","capG","centerX","sigma","gauss","maxDisp","build","typeAt","liquid","lava_waterfall","radioactive_waterfall","waterfall","radioactive_water","quicksand","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","Set","bleed","_createLavaTexture","_createQuicksandTexture","_createWaterfallTexture","_createLavaWaterfallTexture","_createRadioactiveWaterfallTexture","_createRadioactiveWaterTexture","_createWaterTexture","source","addressMode","tiling","detailTex1","detailTex2","_createLavaDetailTexture","_createQuicksandDetailTexture","_createWaterDetailTexture","bgMask","bottomColor","_createGradientTexture","bgSprite","Sprite","_computeTopEdgeSpans","_computeBottomEdgeSpans","topColor","createLinearGradient","addColorStop","fillStyle","fillRect","globalAlpha","beginPath","arc","sw","sh","tilesByRow","above","rowList","cols","sort","start","prev","below","addWave","HealthBar","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","visible","c","pct","_redrawFill","roundRect","innerW","freeze","parallax","tiles","tilesAnim","liquidBackground","objBehind","secretsBelow","player","projectiles","objFront","secretsAbove","weather","fog","liquids","liquidFx","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","isWaterfallDef","isLavaWaterfallDef","isRadioactiveWaterDef","isRadioactiveWaterfallDef","ParallaxBackground","textureCache","cache","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","minWidth","minHeight","hex","parseInt","slice","solid","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","spriteSheet","frameIndex","totalSprites","columns","rows","frameWidth","frameHeight","col","row","Rectangle","frame","editorIcon","Text","dropShadow","dropShadowColor","dropShadowBlur","dropShadowDistance","anchor","createPlayerContainer","playerVisuals","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","hit","renderMapContent","refs","secretOverlays","targetBg","targetObjBehind","targetObjFront","isEditor","isEditorPlayMode","mapType","secretLayerRef","activeRoomIndices","roomWindowIndices","idxStr","linkedMapId","roomMap","rw","rh","rMapW","worldIdx","localIdx","roomTiles","roomObjs","add","bgColorStr","bgColorHex","substring","roomBg","objId","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","filterColor","filterColorInGame","renderAbove","renderAbovePlayer","renderOnSecretLayer","backingSprite","backing","isPushable","maxHealth","health","visualElement","healthPercent","currentFrame","interaction","inside","renderOffsetX","render","renderOffsetY","overlapX","overlapY","objWidth","objHeight","isRoomContent","isWeatherTrigger","isMessageTrigger","isWolfSecret","shouldShowAnyway","isHiddenInGame","isDestructible","hb","renderSecretOverlays","overlays","drawOverlay","split","match","parseFloat","createBreakEffectLayer","layer","sortableChildren","createBreakEffectManager","lifeMs","gravity","shape","angleRange","chunks","angle","sp","maxLife","chunkCount","chunkSpeed","chunkLife","chunkSize","chunkGravity","chunkShape","chunkAngle","chunkColors","delta","getLiquidAtPixel","wx","wy","mapWidthTiles","mapHeightTiles","TILE_SIZE","tileData","getDefById","overlayColorRaw","overlayColor","tintBelowSurface","overlayAlphaRaw","overlayAlpha","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","oxygen","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","headY","chestY","feet","chest","head","candidate","inLiquid","headUnder","atSurface","defaultOverlay","rawOverlayColor","rawOverlayAlpha","tickLiquidDamage","deltaMs","accRef","gameState","HIT_FLASH_MS","hitTimerMs","setPreferences","skipCacheIdWarning","preferCreateImageBitmap","EMPTY_ARRAY","EMPTY_OBJECT","LIQUID_SURFACE_MAP","PixiStage","backgroundImage","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherLavaRain","weatherRadioactiveFog","weatherMeteorRain","healthBarEnabled","weatherFog","weatherThunder","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","showGrid","renderLayers","pointerEvents","onWeatherEffectHit","roomBlurEnabled","debugOverlayEnabled","isPixiReady","setIsPixiReady","mountRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","cameraPosRef","bgRef","bgAnimRef","bgImageRef","bgColorRef","objBehindRef","objFrontRef","roomBgRef","roomObjBehindRef","roomObjFrontRef","playerRef","playerLayerRef","playerSpriteRefs","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidBgLayerRef","liquidSystemRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","lavaRain","radioactiveFog","meteorRain","weatherPropsRef","tileMapDataRef","registryItemsRef","projectilesLayerRef","projectileSpritesRef","entitiesLayerRef","entitySpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","overlayLayerRef","underwaterRef","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","bubbleFxRef","fishBubbleStateRef","entityWaterStateRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","inWater","gridRef","showGridRef","roomBlurEnabledRef","blurFilterRef","darkenFilterRef","ColorMatrixFilter","roomBrightnessFilterRef","vignetteRef","floatingLayerRef","debugLayerRef","debugEnabledRef","floatingManagerRef","breakFxLayerRef","breakFxManagerRef","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","createSolidChecker","collision","top","bottom","left","right","rebuildParallax","useCallback","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","screen","destroyed","async","app","Application","resizeTo","backgroundAlpha","antialias","autoDensity","stage","renderer","bg","bgAnim","roomObjBehind","roomObjFront","secretBelowLayer","secretAboveLayer","playerLayer","entitiesLayer","weatherLayer","liquidBgLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","vignetteLayer","overlayLayer","floatingLayer","breakFxLayer","LAYERS","cfg","floatConfig","defaultCfg","critCfg","crit","ttlMs","amount","amountValue","critThreshold","threshold","isCrit","baseColor","finalColor","finalFontSize","finalTtl","riseSpeed","jitterY","finalText","prefix","suffix","label","String","fontFamily","strokeThickness","jitterXValue","jitterYValue","position","ttl","total","createFloatingTextManager","gridGraphics","debugGraphics","allLayersMap","objects","layerName","urlSet","addUrl","urls","playerComponents","innerHTML","appendChild","hbOverlay","oxyColors","oxyBar","lavaColors","lvBar","preventDefault","ticker","updatePlayerSprite","inLava","effectiveWidth","isHit","dir","direction","mag","scale","camX","camY","lastCam","rawX","rawY","smoothing","nextRawX","nextRawY","pivot","__PLAYER_POS__","deltaMS","systems","swNow","shNow","sNow","overlayL","headUnderWater","overlayCfg","liquidOverlay","showOverlay","maxTargetAlpha","pulseBase","fadeSpeed","lastLiquidType","fadeOutSpeed","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","baseX","baseY","hbO","show","nextBarY","maxOxy","maxOxygen","curOxy","maxLv","maxLavaResist","curLv","lavaResist","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","syncEntities","entitySpritesMap","entitiesList","_lastFrameIndex","isTextureReady","currentSpriteIndex","texWidth","texHeight","effectiveColumns","targetWidth","targetHeight","isNaN","flipY","absScaleX","absScaleY","ents","regs","liq","isFish","ai","fish","isAlive","isDormant","interval","bubbleIntervalMs","jitter","bubbleJitter","appToDestroy","values","cleanupProjectiles","cleanupEntities","handler","isInsideRoom","targetBlur","roomBrightness","reset","desaturate","brightness","grad","createRadialGradient","_vignetteSprite","tileCount","tileId","isLiquid","isRadio","radioactive","hasCollision","active","rebuildLayers","safeDestroy","removeChildren","child","roomAreaIndex","ox","oy","roomSecrets","roomOptions","selectedBackgroundColor","pLayer","tileDataString","JSON","stringify","prevTileDataString","_lastTileData","prepare","upload","runRebuild","tmd","entry","toSurfaceType","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","getFogIntensity","getLavaRainIntensity","getRadioactiveFogIntensity","getMeteorRainIntensity","propTypes","PropTypes","isRequired","resolveInteractableContext","objectLayerData","mainObjectMetadata","activeRoomIdsProp","centerY","hasMainMetadata","activeTargetMap","activeObjectData","activeMetadata","activeMapWidth","activeMapHeight","currentMapId","mainMetadata","findSpawnPosition","triggerId","mapW","objLayer","objData","spawnIdx","triggerRequested","findIndex","handleDoorInteraction","objDef","currentMeta","actualIndex","onStateUpdate","playShotSfx","lastETime","sound","sfxVolume","opening","delayS","delaySeconds","targetMapId","setTimeout","targetMap","isRoom","newX","newY","roomAreaEntry","raIdx","spawn","spawnTriggerId","handleTeleportInteraction","vol","destId","destMeta","tx","ty","applyInteractableEffects","MAX_HEALTH","effect","interactableKey","usedInteractables","healthBonus","fireball","ammoBonus","ammo","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","revealedSet","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerIndex","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","MESSAGES","enMessages","lvMessages","noMessages","ruMessages","jaMessages","getLang","lang","raw","getTutorialChapters","fallback","getTutorialItems","chapter","chapterData","getTutorialText","handleWeatherTrigger","weatherType","weatherAction","value","lastWeatherTrigger","handleMessageTrigger","requiresActionKey","requiresKey","i18nChapter","i18nId","message","lastMessageTrigger","duration","triggerWolfSecret","playerCenterX","playerCenterY","objCenterX","objCenterY","playerGridX","playerGridY","objGridX","objGridY","moveX","moveY","eps","applyWolfSecretShift","getObjectId","getObjectDef","moveTile","moveObject","moveMetadata","removeObject","stepDelayMs","setTimeoutFn","shouldCancel","currentIdx","remainingDx","remainingDy","originId","moveStep","currentId","stepX","stepY","targetIndex","targetObjId","extraX","extraY","shouldRemoveCrackBlock","newHealth","passableHealthThreshold","checkInteractables","input","localX","localY","gridX","gridY","upIndex","upObjId","upDef","downIndex","downObjId","downDef","frontX","frontIndex","frontObjId","frontDef","foundIndex","fromMap","fromMeta","isWinning","winCounter","winCountSpeed","normalizeColor","scaleFromRange","readNumber","getMeteorBreakEffectConfig","meteorBreakEffectsConfig","defaults","sizeScale","minSize","maxSize","denom","particleSize","ground","colorsRaw","getBiologicalBreakEffectConfig","biologicalBreakEffectsConfig","beepFallback","muffled","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","lastNode","createBiquadFilter","frequency","setValueAtTime","connect","exponentialRampToValueAtTime","destination","stop","moveHorizontal","MOVE_SPEED","checkCollision","friction","acceleration","timeScale","targetVx","sign","proposedX","step","safeX","moveDist","nextX","applyVerticalPhysics","isGrounded","animation","GRAVITY","TERMINAL_VELOCITY","JUMP_FORCE","isLiquidAt","prevInWater","liqBuoyancy","liqDragY","liqTerminal","swimImpulseMult","activeLiquidType","feetLiq","chestLiq","space","swimImpulse","proposedY","isSolidAtPixel","secretData","objectData","ignoreEntityId","insideAnyRoom","localWx","localWy","roomTileW","roomTileH","roomObjects","closed","isExploding","isEntity","tileDef","getSurfaceProperties","feetY","slipperiness","getWeatherConfig","weatherDamageConfig","getMapWeather","metaWeather","runtime","rt","__GAME_RUNTIME_SETTINGS__","merged","getWeatherDps","clampIntensity","maxDps","minDps","weatherAffectsPlayer","affects","weatherAffectsEnemy","enemyId","enemyName","enemies","mode","excluded","exclude","isExcluded","some","weatherBlockedByCover","blockedByCover","isCoveredFromAbove","isInsideActiveRoom","getTileLayerData","getSecretLayerData","liquidTypeToHabitat","isFishEntity","getFishTriggerAt","objectId","triggerType","getWaterSurfaceY","updateFrame","constants","helpers","isInitialized","lastTimeRef","projectilesRef","entitiesRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","weatherDamageAccRef","activeRoomIdsRef","getLiquidSample","collectItem","checkHazardDamage","checkSecrets","spawnProjectile","playSfx","updateProjectiles","setPlayer","onGameOver","continue","iceResist","maxIceResist","physicsDt","backgroundLayer","secretLayer","isSlippery","currentIceRes","maxIce","effectiveFriction","ratio","targetFriction","checkCollisionExtended","isPushing","pushTarget","currentStrength","isAlreadyAtMax","lastPushTime","pushDist","overlapDist","isNextToLeft","isNextToRight","pushForce","lastPushSoundTime","ladderInfo","findLadderAtPlayer","ctxResolved","baseIdx","ladder","vp","remaining","steps","prevInWaterFrame","ladderSpeed","climbDir","stepMs","liquidParams","sample","resourceParams","parseNumber","maxLava","oxy","lavaRes","oxyParams","lavaParams","iceParams","strengthParams","oxygenApplies","oxygenEnabled","oxyDrain","oxyRegen","lavaApplies","lavaEnabled","lavaDrain","lavaRegen","applyResource","maxKey","drain","regen","maxVal","weatherNow","radioFogInt","fogActive","maxRadio","maxRadioactivity","radio","radioactivity","radioParams","radioEnabled","radioBaseline","baselinePercent","radioGain","gainPerSecond","radioDecay","decayPerSecond","radioRecover","recoverPerSecond","baseline","rates","getRadioactivityRates","inc","radioactivityPerSecond","dec","radioactivityRegenPerSecond","increase","tickDepleteDps","dpsValue","lavaRainInt","lavaDps","radioDps","totalWeatherDps","damage","healthDpsOverride","effectiveDps","currentAmmo","mouseLeft","playerX","playerY","entity","animFrame","animTimer","totalFrames","animations","explode","frameDuration","shouldRemove","liquidSample","activeRadiusPx","activeRadius","dxView","dyView","sqrt","idleAnim","idle","liquidDamageAcc","dmg","weatherDamageAcc","habitat","timeMs","habitatKey","isAllowed","requireLiquid","inWaterNow","fishState","fs","initialized","nextTurnAt","turnMinMs","turnMaxMs","nextVerticalAt","verticalDir","water_out","water_in","fishCount","removeOnNext","solidAtSample","canFloat","surfaceY","surfaceOffset","deathSurfaceOffset","floatSpeed","deathFloatSpeed","deadAnim","dead","meteorShockFrame","isJumping","panicRadiusPx","panicRadius","panicSpeed","baseSpeed","swimSpeed","verticalDrift","isWaterfall","waterfallDriftMultiplier","waterfallSpeedMultiplier","triggerDef","mergedJumpCfg","fishTrigger","jump","nowMs","nextJumpAt","chance","jumpDir","jumpVx","speedX","jumpVy","speedY","jumpGravity","jumpBounce","bounce","cooldownMs","dtSec","nextY","landingSample","shockUntil","shockFrame","lastWaterEnter","playerWaveRadius","waveImpulse","playerWaveImpulse","waveUntil","panicUntil","panicDurationMs","isPanicking","downSpeed","waterfallDownSpeed","waterfallAlpha","impulse","sampleNext","nextType","other","ocx","ocy","nudge","tryX","tryY","anims","animKey","panic","currentAnim","swim","frameDur","prevInLiquid","water_splash","lava_splash","ew","eh","sinkingSpeed","fallDistance","kill_enemy","isRound","checkEmpty","leftX","rightX","roll","lastAt","lastRollSfxAt","mapH","arrowId","foundArrowDef","arrowsLayer","aDef","reactionDist","reactionDistance","shootDist","shootDistance","canJump","shootCooldown","isShooting","patrol","hitSomething","stayOnPlatform","groundX","groundY","frameSpeed","checkEntityCollision","explodeAnim","updateEntities","knockbackDir","maxX","playerDef","onIce","floatState","floatingText","acc","res","diff","amt","MAX_OXYGEN","MAX_LAVA_RESIST","MAX_RADIOACTIVITY","errorHandler","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","logData","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","useGameEngine","onRevealSecret","useInput","clearKeys","handleKeyDown","tagName","typing","isContentEditable","repeat","handleMouseDown","handleMouseUp","handleKeyUp","onToggleTerminal","passive","maxStrength","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","projectileIdRef","soundEnabledRef","audioCtxUnlockedRef","onStateUpdateRef","onRevealSecretRef","onGameOverRef","objectMetadataRef","revealedSecretsRef","mapWidthRef","mapHeightRef","tileDataRef","objectDataRef","secretDataRef","onToggle","onUserGesture","volume","audio","Audio","pause","once","checkHazardDamageWrapper","candidates","pushCandidate","touch","damageDirections","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","overlapTop","overlapBottom","overlapLeft","overlapRight","sideScore","chosen","prevIndex","damageOnce","baseDamage","immediate","TICK_MS","component","function","playerPosition","damageType","localRevealedRef","handleWeatherEffectHitWrapper","handleWeatherEffectHit","onBreakEffect","edist","prevHealth","inDamageRadius","shockRadius","meteorShockRadius","meteorShockDurationMs","lastFx","lastBioFxAt","bioConfig","breakConfig","onHit","lastMapIdRef","projectName","date_map_last_updated","date_map_created_at","isNewMapLoad","initialEntities","startX","startY","playerId","registryPlayer","prevAmmo","prevFishCount","pW","pH","maxXAtStart","checkCollisionExternal","TILE_SIZE_OVERRIDE","tileDataOverride","registryItemsOverride","secretDataOverride","objectDataOverride","objectMetadataOverride","ignoreId","isSolidAtPixelExternal","originX","originY","ownerId","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","proj","cwt","collisionWithTiles","hbs","hitboxScale","ric","spawnProjectileExternal","getLiquidTypeAtPixel","sampleLiquid","aabb","objectLayer","collectedItems","rWidth","rgX","rIndex","itemKey","rObjectData","rItemId","rItemDef","pickup","pickedUp","mapKey","itemId","itemDef","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","checkObjectHit","checkEntityHit","checkPlayerHit","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","stepTime","removed","hitEntX","panicMs","hitSound","hitIdxX","hypot","hitEntY","hitIdxY","requestAnimationFrame","cancelAnimationFrame","AnimatedItem","setIndex","setInterval","clearInterval","imgSrc","fallbackFrame","maxWidth","maxHeight","draggable","HeaderContainer","AmmoDisplay","FishDisplay","AmmoIcon","span","RightSection","BarsContainer","BarRow","BarWrapper","BarFill","attrs","$percent","$color","BarLabel","GameHeader","hpPercent","oxyPercent","lavaPercent","icePercent","strengthPercent","radioPercent","fireballFrames","fireballA","fireballB","fireballC","fireballD","imageRendering","fishSprite","commands","register","cmd","listCommands","description","executeCommand","panelStyleBase","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","focus","onKey","scrollTop","scrollHeight","transform","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setLavaRain","setRadioactiveFog","setMeteorRain","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setDebugOverlayEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","setRoomBlurEnabled","showCoordinates","setShowCoordinates","minimized","setMinimized","pos","setPos","parse","setSize","draggingRef","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onSettingsUpdate","patch","onOpen","onMove","clientX","clientY","onUp","onResize","emitUpdate","panelStyle","userSelect","contentStyle","buttonStyle","marginLeft","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","defaultValue","_Fragment","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","getBreakEffectParams","breakEffectsConfig","ids","objectIds","types","objectTypes","matchesValue","shouldTriggerBreakEffect","hp","BackgroundMusicPlayer","audioRef","currentSrcRef","sourceNodeRef","filterNodeRef","gainNodeRef","musicContext","cleanup","close","resolveUrl","loop","createMediaElementSource","setupWebAudio","setTargetAtTime","onGesture","val","Overlay","$isVisible","MessageOverlay","isVisible","defaultProps","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapDescription","MapInfo","WinCounterOverlay","GameOverOverlay","GameOverTitle","h1","ReplayButton","ModalDivider","FileUploadLabel","HiddenFileInput","Viewport","$blurred","GameCanvas","PlaceholderMessage","Game","dispatch","useDispatch","viewportRef","useSelector","uiState","runtimeSettings","setRuntimeSettings","gameMessage","setGameMessage","messageTimerRef","clearTimeout","activeMapIdRef","isGameOverRef","handleStateUpdate","projectMapsResolved","spawnObjId","spawnDef","projectToLoad","loadMapData","metaPatch","breakFxPlayed","mapIdAtStart","ps","alert","settingKey","charAt","handleGameOver","indices","handleOpenModalEvent","weatherFogLegacy","sourceMapData","structuredClone","cloneMapData","effectiveMapData","version","activeLayers","bgLayer","mapTileData","mapObjectData","mapSecretData","backgroundMusic","nowIso","mapName","dimensions","debugMapId","handleReplay","mapToLoad","isV2","author","sizeInfo","subMapInfo","mainMap","mapValues","accept","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","contents","suggestedName","mimeType","showSaveFilePicker","writable","createWritable","blob","Blob","write","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","applyMapData","setMapWidth","setMapHeight","setMapName","setCreatorName","setMapDescription","setCreatedAt","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","setSelectedBackgroundMusic","setPlayerPosition","setTileMapData","setObjectMapData","setSecretMapData","setObjectMetadata","setWeatherRain","setWeatherSnow","setWeatherClouds","setWeatherFog","setWeatherThunder","setWeatherLavaRain","setWeatherRadioactiveFog","setWeatherMeteorRain","setMaps","setActiveMapId","selectedBackgroundImage","selectedBackgroundMusic","worldY","date_created","ObjectLinks","React","links","portals","targets","x1","y1","x2","y2","strokeWidth","strokeDasharray","opacity","EditorTile","activeTool","tileObj","objObj","secretObj","isHighlighted","parentRegionIndex","borderStyle","bgStyle","handleGridMouseDown","handleGridMouseEnter","handleResizeStart","handleMoveStart","isRoomAreaVisible","showRoomMapContent","showMessages","isLiquidTile","isWaterTile","isLavaTile","isQuicksandTile","isWaterfallTile","isLavaWaterfallTile","isRadioactiveWaterTile","isRadioactiveWaterfallTile","messageText","i18nText","resolvedMessageText","isResizable","hasObjectOrSecret","onMouseEnter","boxSizing","objectFit","filterColorInEditor","baseTop","baseLeft","baseWidth","baseHeight","inset","i18nMessage","hasIntensity","borderLeft","borderRight","textShadow","roomName","selectedBackgroundUrl","showBackgroundImage","activeLayer","hoverIndex","highlightedIndex","brushSize","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseUp","handleGridMouseLeave","setIsDragging","selectedTile","isEraserActive","isBrushActive","isBucketActive","regions","roomAreas","getLayerColor","getLayerFilter","onMouseUp","onMouseLeave","backgroundRepeat","backgroundSize","getGridStyles","gridTemplateColumns","gridTemplateRows","_","dTileId","dObjId","dSecId","layerColor","hx","hy","minX","selX","selY","originalX","originalY","parentRegion","EditorToolsContainer","HeaderBar","ToolsSection","ToolsGroup","ToolsInnerGroup","ToolsRow","ToolsEditorButton","$variant","$small","$square","$disabled","StrikeThrough","LayerIndicator","$bgColor","$borderColor","$textColor","BgColorContainer","BgColorInputWrapper","BgColorInput","disabled","BgTransparentButton","PlayButtonContainer","PlayButtonInner","InfoContainer","InfoItem","InfoLabel","InfoValue","EraserButtonContainer","EraserButtonInner","SelectionActions","ConfirmButton","CancelButton","GridIcon","SidebarContainer","ElementEditorButton","PanelContainer","$isOpen","PanelHeader","PanelBody","CloseButton","OperationButton","$danger","OperationLabel","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","tempMapDescription","setTempMapDescription","confirmNewMap","ModalHeader","BuiltInMapsModal","onSelect","topZIndex","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","setZIndex","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","lastHeightRef","offsetHeight","handleMouseMove","getBoundingClientRect","EditorMapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","tile","obj","strokeStyle","lineWidth","portal","setLineDash","WorldView","switchMap","currentMapData","createMap","deleteMap","updateMapData","onAddRoomArea","mapLayoutsRef","dragRef","allMaps","draw","layouts","currentIds","layout","tileW","tileH","strokeRect","font","fillText","rAreaW","rAreaH","rTileW","rTileH","ri","sourceLayout","sourceMap","sx","isPortalSource","isDoorSource","linkId","targetLayout","tw","th","tTileW","tTileH","tObjId","tObjDef","isTarget","isDoorTarget","tMeta","endX","cp1X","cp1Y","cp2X","cp2Y","bezierCurveTo","save","translate","rotate","closePath","restore","btnX","btnY","confirm","mapStartX","mapStartY","onMouseMove","BackgroundPanel","backgroundOptions","paddingTop","MusicPanel","musicOptions","fontStyle","status","WeatherPanel","weatherItems","setter","icon","SceneEditorButton","RightSidebarContainer","EditorScene","handleMapResize","isResizeWindowOpen","setIsResizeWindowOpen","isWorldViewOpen","setIsWorldViewOpen","isMinimapOpen","setIsMinimapOpen","setIsSettingsOpen","isBackgroundOpen","setIsBackgroundOpen","isMusicOpen","setIsMusicOpen","OperationsPanel","openNewMapModal","saveMap","loadMap","openBuiltInModal","clearMap","creatorName","mapDescription","inputStyle","handleFocus","handleBlur","onFocus","onBlur","CollapsiblePanel","setIsOpen","PalettePanel","isPlayMode","category","blocks","decorations","interactables","hazards","secrets","messages","crackableWalls","pushableWalls","obstacles","setHighlightedIndex","handlePaletteSelect","selectedChapter","setSelectedChapter","tutorialChapters","tutorialItems","getLiquidLabel","isLavaWaterfall","isRadioactiveWaterfall","isRadioactive","isWater","isQuicksand","renderPaletteItem","hasImage","isSecret","swatchStyle","displayName","iconText","getBlockGroup","editor","group","groupOrder","withGroups","sortBlocks","ao","order","bo","localeCompare","groupPanels","flexWrap","otherItems","getLiquidGroup","li","sortLiquids","getEntityGroup","sortEntities","groupItems","getItemGroup","sortItems","getInteractableGroup","sortInteractables","getHazardGroup","sortHazards","ch","StatisticsPanel","totalTiles","filledBlocks","objectsCount","emptyBlocks","registryMap","itemsCount","entitiesCount","mapList","mapsTotal","mapsOverworld","mapsUnderworld","mapsRooms","Trans","i18nKey","components","ObjectPropsPanel","listRef","highlightedElement","querySelector","scrollIntoView","behavior","block","isWeather","isMessage","isPortalOrTarget","isDoor","isRoomArea","i18nPreview","el","scrollX","clientWidth","scrollY","clientHeight","scrollTo","EditorElements","activePanel","setActivePanel","togglePanel","lastPanel","setLastPanel","pinnedPanel","setPinnedPanel","hoverTimerRef","displayPanel","clearHoverTimer","handleIconClick","panel","handleIconMouseEnter","handleIconMouseLeave","panelTitles","stats","handlePanelMouseEnter","handlePanelMouseLeave","EditorTools","setShowGrid","handlePlay","handlePause","handleReset","setActiveTool","setBrushSize","moveSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","setShowBackgroundImage","setShowMessages","setIsRoomAreaVisible","setShowRoomMapContent","tool","isDisabled","roman","getLayerIndicatorData","object","secret","textColor","getEraserData","useEditorOperations","createdAt","setIsNewMapModalOpen","handleSaveMap","currentDate","projectData","date_last_updated","statistics","total_tiles","filled_tiles","total_objects","json","saveFile","mapsCount","handleLoadMap","setters","handleLoadBuiltInMap","loadBuiltInMap","handleClearMap","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","isPropsLayer","targetLayer","setTargetData","newData","newMetadata","metadataChanged","targetX","useEditorPainting","setSelection","setPreviewPosition","setOriginalMapData","setDragStart","setHoverIndex","setBucketPreviewIndices","resizeState","setResizeState","moveState","setMoveState","bucketTimerRef","getLinkedRoomAt","roomX","roomY","roomWidth","roomHeight","linkedRoom","rHeight","setRoomData","setRoomMetadata","newMeta","paintTileUtil","edge","useLinked","mWidth","mHeight","mIndex","mTileMapData","mObjectMapData","mSecretMapData","mObjectMetadata","mSetTileMapData","mSetObjectMapData","mSetSecretMapData","mSetObjectMetadata","existingObjId","existingSecretId","isEraser","isRoomMap","targetData","targetValue","newValue","floodFill","affectedIndices","metaChanged","handleGridMouseMove","curX","curY","newW","newH","newIndex","mData","baseIndex","selectionMetadata","tileMap","objectMap","secretMap","Editor","setSelectedTile","setActiveLayer","stateRef","isNewMapModalOpen","isBuiltInMapsModalOpen","setIsBuiltInMapsModalOpen","loadBackgroundOptions","loadMusicOptions","createNewMap","useEditorMaps","existingMaps","newMap","newMaps","lastActiveMapIdRef","newMapId","nextMap","handleCreateMap","finalName","prompt","timeout","selectedBgOption","useEditorRegistry","originalMapData","useEditorSelection","newTileMap","newObjectMap","newSecretMap","newObjectMetadata","destX","destY","destIdx","srcDataIdx","handleForceStop","playModeObjectData","playModeSecretData","playModeWeather","playModeMaps","gameEngineState","useEditorPlayMode","setIsPlayMode","setIsGameOver","restartCounter","setRestartCounter","editorSnapshot","setEditorSnapshot","setRevealedSecrets","setActiveRoomIds","setPlayModeObjectData","setPlayModeSecretData","setPlayModeWeather","playModeMapsVersion","setPlayModeMapsVersion","lastSyncedMapIdRef","isPlayModeRef","playModeMapsRef","engineInitId","currentPlayObjectData","playData","spawnIndex","spawnX","currentPlaySecretData","overrides","mapDataForGame","saved","newState","mapObj","prevTiles","newTiles","nextMeta","prevObjs","newObjs","prevMeta","handleRevealSecret","secretIndices","resetData","handleLoadMapWrapped","handleLoadBuiltInMapWrapped","handleDeleteMap","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","oldMeta","resizeArray","oldArr","newArr","oldM","newM","oldIdx","newIdx","resizeMetadata","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App"],"ignoreList":[],"sourceRoot":""}