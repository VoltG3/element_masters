{"version":3,"file":"static/js/main.a03413b1.js","mappings":"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","sources":["webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.ogg$","webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/store/slices/playerSlice.js","webpack://element_masters/./src/store/slices/settingsSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/config.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/entityManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/engine/gameplay/secrets.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/engine/gameplay/entities.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/paintingTools.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/constants.js","webpack://element_masters/./src/sections/chapters/editor/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/PaletteSection.jsx","webpack://element_masters/./src/sections/chapters/editor/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/MapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/ToolbarWindows.jsx","webpack://element_masters/./src/sections/chapters/editor/index.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/mapOperations.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe"],"sourcesContent":["var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1032;","var map = {\n\t\"./blocks/block_pack_01/dirt_block_0002.png\": 1006,\n\t\"./blocks/block_pack_01/dirt_block_0003.png\": 2967,\n\t\"./blocks/block_pack_01/dirt_block_0004.png\": 7800,\n\t\"./blocks/block_pack_01/dirt_block_0005.png\": 2017,\n\t\"./blocks/block_pack_01/dirt_block_0006.png\": 1850,\n\t\"./blocks/block_pack_01/ice_block_0001.png\": 9745,\n\t\"./blocks/desert_pack_01/desert_pack_0001.png\": 7741,\n\t\"./blocks/desert_pack_01/desert_pack_0002.png\": 182,\n\t\"./blocks/desert_pack_01/desert_pack_0003.png\": 1727,\n\t\"./blocks/desert_pack_01/desert_pack_0004.png\": 6352,\n\t\"./blocks/desert_pack_01/desert_pack_0005.png\": 2601,\n\t\"./blocks/desert_pack_01/desert_pack_0006.png\": 6018,\n\t\"./blocks/desert_pack_01/desert_pack_0007.png\": 6523,\n\t\"./blocks/desert_pack_01/desert_pack_0008.png\": 5132,\n\t\"./blocks/desert_pack_01/desert_pack_0009.png\": 1045,\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 7157,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./decorations/stone_pack_01/stone_pack_01_001.png\": 1978,\n\t\"./decorations/stone_pack_01/stone_pack_01_002.png\": 4526,\n\t\"./decorations/stone_pack_01/stone_pack_01_003.png\": 7928,\n\t\"./decorations/stone_pack_01/stone_pack_01_004.png\": 9447,\n\t\"./decorations/stone_pack_01/stone_pack_01_005.png\": 1134,\n\t\"./decorations/stone_pack_01/stone_pack_01_006.png\": 8485,\n\t\"./decorations/stone_pack_01/stone_pack_01_007.png\": 3036,\n\t\"./decorations/stone_pack_01/stone_pack_01_008.png\": 7195,\n\t\"./decorations/stone_pack_01/stone_pack_01_009.png\": 9330,\n\t\"./decorations/stone_pack_01/stone_pack_01_010.png\": 2952,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 8905,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./entities/tanks/tank_0000.png\": 2386,\n\t\"./entities/tanks/tank_0001.png\": 3563,\n\t\"./entities/tanks/tank_0002.png\": 5232,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./hazards/death_block_0001.png\": 3527,\n\t\"./interactables/arrows/arrow_down.png\": 7152,\n\t\"./interactables/arrows/arrow_left.png\": 8047,\n\t\"./interactables/arrows/arrow_right.png\": 592,\n\t\"./interactables/arrows/arrow_up.png\": 7263,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./interactables/ends/end_0001.png\": 8597,\n\t\"./interactables/platforms/platform_0001.png\": 9427,\n\t\"./interactables/portals/portal_01/portal_A_001.png\": 8518,\n\t\"./interactables/portals/portal_01/portal_A_002.png\": 3933,\n\t\"./interactables/portals/portal_01/portal_A_003.png\": 692,\n\t\"./interactables/portals/portal_01/portal_A_004.png\": 5499,\n\t\"./interactables/portals/portal_01/portal_A_005.png\": 3954,\n\t\"./interactables/portals/portal_01/portal_A_006.png\": 8489,\n\t\"./interactables/portals/portal_01/portal_A_007.png\": 4288,\n\t\"./interactables/portals/portal_01/portal_A_008.png\": 8519,\n\t\"./interactables/portals/portal_01/portal_A_009.png\": 2734,\n\t\"./interactables/portals/portal_01/portal_A_010.png\": 3124,\n\t\"./interactables/portals/portal_01/portal_A_011.png\": 4253,\n\t\"./interactables/portals/portal_01/portal_A_012.png\": 6838,\n\t\"./interactables/portals/portal_01/portal_A_013.png\": 5583,\n\t\"./interactables/portals/portal_01/portal_A_014.png\": 9712,\n\t\"./interactables/portals/portal_01/portal_A_015.png\": 5465,\n\t\"./interactables/portals/portal_01/portal_A_016.png\": 1458,\n\t\"./interactables/stone_0001.png\": 1020,\n\t\"./interactables/wooden_box_0001.png\": 1169,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  objectMetadata: {}, // Track metadata per object position { index: { health: 100, etc } }\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      const { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.objectMetadata = mapData?.meta?.objectMetadata || {}; // Load initial metadata from map\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.isGameOver = false;\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    updateObjectMetadata: (state, action) => {\n      const { index, metadata } = action.payload;\n      state.objectMetadata[index] = {\n        ...(state.objectMetadata[index] || {}),\n        ...metadata\n      };\n    },\n    removeObjectAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.objectMapData[index] !== undefined) {\n        state.objectMapData[index] = null;\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId } = action.payload;\n      if (state.objectMapData[index] !== undefined) {\n        state.objectMapData[index] = newId;\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  updateObjectMetadata,\n  removeObjectAtIndex,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\nexport const MAX_ICE_RESIST = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Player Slice\n * Manages player state (position, health, resources, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\nimport { MAX_HEALTH, MAX_OXYGEN, MAX_LAVA_RESIST } from '../../constants/gameConstants';\n\nconst initialState = {\n  x: 0,\n  y: 0,\n  width: 32,\n  height: 32,\n  vx: 0,\n  vy: 0,\n  isGrounded: false,\n  direction: 1,\n  animation: 'idle',\n  health: 90,\n  maxHealth: MAX_HEALTH,\n  strength: 30,\n  maxStrength: 100,\n  ammo: 0,\n  oxygen: MAX_OXYGEN,\n  maxOxygen: MAX_OXYGEN,\n  lavaResist: MAX_LAVA_RESIST,\n  maxLavaResist: MAX_LAVA_RESIST,\n  projectiles: [],\n  inWater: false,\n  headUnderWater: false,\n  atSurface: false,\n  liquidType: null,\n  hitTimerMs: 0,\n  isWinning: false,\n  winCounter: 0,\n};\n\nconst playerSlice = createSlice({\n  name: 'player',\n  initialState,\n  reducers: {\n    updateState: (state, action) => {\n      return { ...state, ...action.payload };\n    },\n    setPosition: (state, action) => {\n      const { x, y } = action.payload;\n      state.x = x;\n      state.y = y;\n    },\n    setVelocity: (state, action) => {\n      const { vx, vy } = action.payload;\n      state.vx = vx;\n      state.vy = vy;\n    },\n    setHealth: (state, action) => {\n      state.health = Math.max(0, Math.min(state.maxHealth, action.payload));\n    },\n    addHealth: (state, action) => {\n      state.health = Math.max(0, Math.min(state.maxHealth, state.health + action.payload));\n    },\n    takeDamage: (state, action) => {\n      state.health = Math.max(0, state.health - action.payload);\n      state.hitTimerMs = Math.max(state.hitTimerMs, 500);\n    },\n    setAmmo: (state, action) => {\n      state.ammo = Math.max(0, action.payload);\n    },\n    addAmmo: (state, action) => {\n      state.ammo = Math.max(0, state.ammo + action.payload);\n    },\n    setOxygen: (state, action) => {\n      state.oxygen = Math.max(0, Math.min(state.maxOxygen, action.payload));\n    },\n    setLavaResist: (state, action) => {\n      state.lavaResist = Math.max(0, Math.min(state.maxLavaResist, action.payload));\n    },\n    setStrength: (state, action) => {\n      state.strength = Math.max(0, Math.min(state.maxStrength, action.payload));\n    },\n    setProjectiles: (state, action) => {\n      state.projectiles = action.payload;\n    },\n    addProjectile: (state, action) => {\n      state.projectiles.push(action.payload);\n    },\n    removeProjectile: (state, action) => {\n      state.projectiles = state.projectiles.filter(p => p.id !== action.payload);\n    },\n    setDirection: (state, action) => {\n      state.direction = action.payload;\n    },\n    setAnimation: (state, action) => {\n      state.animation = action.payload;\n    },\n    setGrounded: (state, action) => {\n      state.isGrounded = action.payload;\n    },\n    setInWater: (state, action) => {\n      state.inWater = action.payload;\n    },\n    setLiquidType: (state, action) => {\n      state.liquidType = action.payload;\n    },\n    resetPlayer: () => initialState,\n  },\n});\n\nexport const {\n  updateState,\n  setPosition,\n  setVelocity,\n  setHealth,\n  addHealth,\n  takeDamage,\n  setAmmo,\n  addAmmo,\n  setOxygen,\n  setLavaResist,\n  setStrength,\n  setProjectiles,\n  addProjectile,\n  removeProjectile,\n  setDirection,\n  setAnimation,\n  setGrounded,\n  setInWater,\n  setLiquidType,\n  resetPlayer,\n} = playerSlice.actions;\n\nexport default playerSlice.reducer;\n","/**\n * Settings Slice\n * Manages game settings (audio, graphics, controls, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  sound: {\n    enabled: false,\n    masterVolume: 1.0,\n    sfxVolume: 0.5,\n    musicVolume: 0.6,\n  },\n  graphics: {\n    backgroundParallaxFactor: 0.3,\n    weatherRain: 0,\n    weatherSnow: 0,\n    weatherClouds: 0,\n    weatherFog: 0,\n    weatherThunder: 0,\n  },\n  ui: {\n    healthBarEnabled: true,\n    oxygenBarEnabled: true,\n    lavaBarEnabled: true,\n    waterSplashesEnabled: true,\n    lavaEmbersEnabled: true,\n  },\n  controls: {\n    keyUp: 'w',\n    keyDown: 's',\n    keyLeft: 'a',\n    keyRight: 'd',\n    keyJump: 'Space',\n    keyShoot: 'MouseLeft',\n  },\n};\n\n// Load settings from localStorage\nconst loadSettings = () => {\n  try {\n    const saved = localStorage.getItem('game_settings');\n    if (saved) {\n      const parsed = JSON.parse(saved);\n      return { ...initialState, ...parsed };\n    }\n  } catch (error) {\n    console.error('Failed to load settings:', error);\n  }\n  return initialState;\n};\n\nconst settingsSlice = createSlice({\n  name: 'settings',\n  initialState: loadSettings(),\n  reducers: {\n    updateSettings: (state, action) => {\n      const newState = { ...state, ...action.payload };\n      // Save to localStorage\n      try {\n        localStorage.setItem('game_settings', JSON.stringify(newState));\n      } catch (error) {\n        console.error('Failed to save settings:', error);\n      }\n      return newState;\n    },\n    setSoundEnabled: (state, action) => {\n      state.sound.enabled = action.payload;\n      try {\n        localStorage.setItem('game_sound_enabled', action.payload ? '1' : '0');\n      } catch (error) {\n        console.error('Failed to save sound setting:', error);\n      }\n    },\n    setSoundVolume: (state, action) => {\n      const { type, volume } = action.payload;\n      if (type === 'master') state.sound.masterVolume = volume;\n      else if (type === 'sfx') state.sound.sfxVolume = volume;\n      else if (type === 'music') state.sound.musicVolume = volume;\n    },\n    setGraphicsSetting: (state, action) => {\n      const { key, value } = action.payload;\n      if (state.graphics[key] !== undefined) {\n        state.graphics[key] = value;\n      }\n    },\n    setUISetting: (state, action) => {\n      const { key, value } = action.payload;\n      if (state.ui[key] !== undefined) {\n        state.ui[key] = value;\n      }\n    },\n    setControlBinding: (state, action) => {\n      const { key, value } = action.payload;\n      if (state.controls[key] !== undefined) {\n        state.controls[key] = value;\n      }\n    },\n    resetSettings: () => {\n      try {\n        localStorage.removeItem('game_settings');\n      } catch (error) {\n        console.error('Failed to clear settings:', error);\n      }\n      return initialState;\n    },\n  },\n});\n\nexport const {\n  updateSettings,\n  setSoundEnabled,\n  setSoundVolume,\n  setGraphicsSetting,\n  setUISetting,\n  setControlBinding,\n  resetSettings,\n} = settingsSlice.actions;\n\nexport default settingsSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport playerReducer from './slices/playerSlice';\nimport settingsReducer from './slices/settingsSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    player: playerReducer,\n    settings: settingsReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap', 'player/updateState'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData', 'player.projectiles'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"en\",\n        fallbackLng: \"en\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation\n            },\n            no: {\n                navigation: no_navigation\n            },\n            en: {\n                navigation: en_navigation\n            },\n            ru: {\n                navigation: ru_navigation\n            },\n            ja: {\n                navigation: ja_navigation\n            },\n        },\n    })\n\nexport default i18n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\nimport { useState, useRef, useEffect } from \"react\"\nimport { useSelector, useDispatch } from \"react-redux\"\nimport { setSoundEnabled } from \"../store/slices/settingsSlice\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    height: 36px;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nconst DropdownContainer = styled.div`\n    position: relative;\n    display: flex;\n`\n\nconst DropdownMenu = styled.div`\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background-color: #333;\n    border: 1px solid #444;\n    border-radius: 4px;\n    padding: 10px;\n    z-index: 2000;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n    min-width: 150px;\n    margin-top: 5px;\n`\n\nconst MenuItem = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px;\n    color: white;\n    font-size: 12px;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &:hover {\n        background-color: #444;\n    }\n`\n\nconst ToggleSwitch = styled.div`\n    width: 34px;\n    height: 18px;\n    background-color: ${props => props.$active ? '#f4c542' : '#666'};\n    border-radius: 9px;\n    position: relative;\n    transition: background-color 0.3s;\n\n    &::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        left: ${props => props.$active ? '18px' : '2px'};\n        width: 14px;\n        height: 14px;\n        background-color: white;\n        border-radius: 50%;\n        transition: left 0.3s;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const dispatch = useDispatch();\n    const dropdownRef = useRef(null);\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    \n    const { sound } = useSelector(state => state.settings);\n    const soundEnabled = sound?.enabled ?? false;\n\n    const currentLang = i18n.language || 'en'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    const toggleSound = () => {\n        const next = !soundEnabled;\n        dispatch(setSoundEnabled(next));\n        try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n    };\n\n    useEffect(() => {\n        const handleClickOutside = (event) => {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n                setIsMenuOpen(false);\n            }\n        };\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n\n            <DropdownContainer ref={dropdownRef}>\n                <NavButton onClick={() => setIsMenuOpen(!isMenuOpen)} title=\"Settings\">\n                    \n                </NavButton>\n                {isMenuOpen && (\n                    <DropdownMenu>\n                        <MenuItem onClick={toggleSound}>\n                            <span>Sound Effects</span>\n                            <ToggleSwitch $active={soundEnabled} />\n                        </MenuItem>\n                        <div style={{ height: '1px', backgroundColor: '#444', margin: '5px 0' }} />\n                        <div style={{ padding: '5px 8px', fontSize: '10px', color: '#888' }}>\n                            GAME SETTINGS\n                        </div>\n                    </DropdownMenu>\n                )}\n            </DropdownContainer>\n        </nav>\n    )\n}","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    text-transform: uppercase;\n`\n\nexport function SectionHeaderNavigationLogo() {\n\n    return (\n        <StyledLogo>\n            Element Masters\n        </StyledLogo>\n    )\n}","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    return _registry ? _registry.find(item => item.id === id) : null;\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n        </div>\n      )\n    }\n\nexport default App","const config = {\n    apiUrl: (typeof process !== 'undefined' && process.env?.REACT_APP_API_URL) || 'http://localhost:8000',\n\n    logo: {\n        URL_LOGO_01: '/assets/logo/Logo1.png',\n        URL_LOGO_02: '/assets/logo/Logo2.png',\n        URL_LOGO_03: '/assets/logo/Logo3.png',\n        URL_LOGO_04: '/assets/logo/Logo4.png',\n        URL_LOGO_05: '/assets/logo/Logo5.png',\n    },\n\n};\n\nexport default config","import React from 'react'\nimport styled from 'styled-components'\nimport config from '../../config'\n\nconst HomeContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    //background-color: darkred;\n    \n    .logoRow{\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        width: 100%;\n        height: auto;\n        margin: 10px;\n        //border: solid 1px red;\n        \n        & img {\n            width: 350px;\n        }\n    }\n`\n\nexport default function Home() {\n    const LOGO_01 = config.logo.URL_LOGO_01\n    const LOGO_02 = config.logo.URL_LOGO_02\n    const LOGO_03 = config.logo.URL_LOGO_03\n    const LOGO_04 = config.logo.URL_LOGO_04\n    const LOGO_05 = config.logo.URL_LOGO_05\n    console.log(LOGO_01, LOGO_02, LOGO_03, LOGO_04, LOGO_05)\n\n    return (\n        <HomeContainer>\n           <div className={\"logoRow\"}>\n               <img src={LOGO_01} alt=\"logo\" />\n               <img src={LOGO_02} alt=\"logo\" />\n               <img src={LOGO_03} alt=\"logo\" />\n               <img src={LOGO_04} alt=\"logo\" />\n\n           </div>\n        </HomeContainer>\n    )\n}\n","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on map area to keep FPS stable\n    this.maxParticles = Math.max(160, Math.floor(area / 2600));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.rect(0, 0, 1.3, 9);\n    g.fill({ color: 0x4aa3ff, alpha: 0.92 });\n    const x = Math.random() * this.width;\n    const y = -10 - Math.random() * 30;\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // adjust intensity dynamically\n    this.setIntensity(this.getIntensity());\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      if (p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = Math.max(120, Math.floor(area / 3800));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.circle(0, 0, r);\n    g.fill({ color: 0xffffff, alpha: 0.97 });\n    const x = Math.random() * this.width;\n    const y = -10 - Math.random() * 30;\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // adjust intensity dynamically\n    this.setIntensity(this.getIntensity());\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    const deficit = target - this.flakes.length;\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this.rebuild();\n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const count = Math.round((this.intensity / 100) * 18); // a bit fewer than fog by default\n    for (let i = 0; i < count; i++) {\n      const g = new Graphics();\n      const w = 140 + Math.random() * 300; // cloud size\n      const h = 80 + Math.random() * 160;\n      const x = Math.random() * (this.width + 200) - 100;\n      const y = -40 + Math.random() * (this.bandHeight - 20); // only in band\n      const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n      const speed = 8 + Math.random() * 22; // horizontal drift speed\n      const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n      // Draw an organic cloud using overlapping circles (soft edges)\n      const rx = w * 0.5;\n      const ry = h * 0.5;\n      const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n      const baseR = Math.min(rx, ry) * 0.55;\n      for (let k = 0; k < circles; k++) {\n        const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n        const dist = 0.2 + Math.random() * 0.35;\n        const cx = Math.cos(t) * rx * dist;\n        const cy = Math.sin(t) * ry * dist;\n        const r = baseR * (0.7 + Math.random() * 0.7);\n        g.circle(cx, cy, r);\n      }\n      // central mass\n      g.circle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n      g.fill({ color: 0xffffff, alpha: 1.0 });\n      g.alpha = alpha;\n      g.x = x;\n      g.y = y;\n      this.container.addChild(g);\n      this.patches.push({ g, w, h, vx: speed * (Math.random() < 0.5 ? -1 : 1), vy, alpha, phase: Math.random() * Math.PI * 2 });\n    }\n  }\n\n  update(dtMs) {\n    // live intensity update\n    const cur = Math.max(0, Math.min(100, this.getIntensity()));\n    if (cur !== this.intensity) this.setIntensity(cur);\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const bandTop = -100; // allow spawn/wrap margin above\n    const bandBottom = this.bandHeight - 20; // keep away from lower area\n    for (const p of this.patches) {\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // very gentle alpha oscillation\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      p.g.alpha = Math.max(0.04, Math.min(0.55, p.alpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      if (p.g.x < -180) p.g.x = W + 180;\n      if (p.g.x > W + 180) p.g.x = -180;\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    g.rect(0, 0, w, h);\n    g.fill({ color: 0x9fb7c9, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Live intensity update from settings\n    const cur = Math.max(0, Math.min(100, this.getIntensity()));\n    if (cur !== this.intensity) this.setIntensity(cur);\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // live intensity updates\n    const curInt = Math.max(0, Math.min(100, this.getIntensity()));\n    if (curInt !== this.intensity) this.setIntensity(curInt);\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.25, 0.9, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.8, 1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    g.rect(0, 0, this.width, this.height);\n    g.fill({ color: 0xffffff, alpha: this.flashAlpha });\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    const x = Math.floor(this._rand(8, W - 8));\n    const topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2, 5, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xCCEEFF;\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n    g.stroke({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n      g.stroke({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.circle(d.x, d.y, size);\n      g.fill({ color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.circle(r.x, r.y, r.r);\n      g.stroke({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      g.stroke({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n\n      // glowing ember\n      g.circle(e.x, e.y, emberSize);\n      g.fill({ color: 0xffa229, alpha: 0.9 * emberAlpha });\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.circle(p.x, p.y, radius);\n      g.fill({ color: 0xdfdad2, alpha: Math.max(0, alpha) });\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n    // Simple AABB check against region bounds\n    const b = region.node.getBounds();\n    return (px + pw > b.x && px < b.x + b.width && py + ph > b.y && py < b.y + b.height);\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._noiseTex = null;\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0.010, y: 0.004 };\n    const lavaDrift = { x: -0.012, y: 0.006 };\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : waterDrift;\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly)\n      if (r.type === 'water') {\n        // Check if player is in this water region (simplified check)\n        const playerInRegion = this._checkPlayerInRegion(r);\n        if (playerInRegion) {\n          sprite.alpha = 0.50; // Transparent when player is inside - can see player/items!\n        } else {\n          sprite.alpha = 0.95; // Opaque when player is outside\n        }\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        if (playerInRegion) {\n          sprite.alpha = 0.60; // Transparent when player is inside\n        } else {\n          sprite.alpha = 0.95; // Opaque when player is outside\n        }\n      }\n\n      // Animate noise overlays to break repetition\n      if (r.noise1) {\n        r.noise1.tilePosition.x += drift.x * 1.6 * dt;\n        r.noise1.tilePosition.y += drift.y * 1.2 * dt;\n      }\n      if (r.noise2) {\n        r.noise2.tilePosition.x += -drift.x * 1.1 * dt;\n        r.noise2.tilePosition.y += drift.y * 0.9 * dt;\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.rect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.fill({ color: 0xc9ecff, alpha: 0.35 });\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.water) return 'water';\n      if (def.flags.lava) return 'lava';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n      _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n        const node = new Container();\n        const mask = new Graphics();\n        // SVARGI: v8 maskas labk strd bez addChild, ja ts ir Graphics\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        mask.clear();\n        const bleed = 1; // Palielints bleed, lai nosegtu spraugas\n        for (let k = 0; k < tileIndices.length; k++) {\n          const idx = tileIndices[k];\n          const gx = (idx % mapWidth);\n          const gy = Math.floor(idx / mapWidth);\n          mask.rect(\n            gx * tileSize - bleed,\n            gy * tileSize - bleed,\n            tileSize + bleed * 2,\n            tileSize + bleed * 2\n          );\n        }\n        mask.fill({ color: 0xffffff, alpha: 1 });\n\n        const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                     : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize)));\n        \n        // v8 addressMode iestatana\n        if (tex.source && tex.source.style) {\n          tex.source.style.addressMode = 'repeat';\n        }\n\n        const tiling = new TilingSprite({\n          texture: tex,\n          width: worldW,\n          height: worldH\n        });\n        \n        tiling.tileScale.set(1, 1);\n        tiling.alpha = type === 'lava' ? 0.98 : 0.92;\n        node.addChild(tiling);\n\n        // Noise sli\n        const noiseTex = this._noiseTex || (this._noiseTex = this._createNoiseTexture(256, 256));\n        if (noiseTex.source && noiseTex.source.style) {\n          noiseTex.source.style.addressMode = 'repeat';\n        }\n\n        const noise1 = new TilingSprite({ texture: noiseTex, width: worldW, height: worldH });\n        const noise2 = new TilingSprite({ texture: noiseTex, width: worldW, height: worldH });\n        \n        if (type === 'water') {\n          noise1.alpha = 0.08; noise2.alpha = 0.1;\n        } else {\n          noise1.alpha = 0.12; noise2.alpha = 0.15;\n        }\n        node.addChild(noise1, noise2);\n\n        // LABOJUMS: Maska tiek pievienota k brns, lai t sekotu ldzi node koordintm\n        node.addChild(mask);\n        node.mask = mask;\n\n        if (type === 'water') {\n          const capG = new Graphics();\n          node.addChild(capG);\n          const topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n          // Saglabjam atsauces uz r reistr\n          this._regions.push({ type, node, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [] });\n        } else {\n          this._regions.push({ type, node, mask, sprite: tiling, noise1, noise2, waves: [] });\n        }\n\n        this.container.addChild(node);\n      }\n\n      _createWaterTexture(tileSize) {\n        const canvas = document.createElement('canvas');\n        const size = 64; // Power of Two obligts v8 tilingam\n        canvas.width = size; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n\n        // SEAMLESS gradients (skums un beigas ir #3a7fb8)\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, '#3a7fb8');   \n        g.addColorStop(0.5, '#5ba3d9'); \n        g.addColorStop(1, '#3a7fb8');   \n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, size, size);\n\n        return Texture.from(canvas);\n      }\n\n      _createLavaTexture(tileSize) {\n        const canvas = document.createElement('canvas');\n        const size = 64; \n        canvas.width = size; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n\n        // SEAMLESS gradients lavai\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, '#ffa229');\n        g.addColorStop(0.5, '#ffb84d');\n        g.addColorStop(1, '#ffa229');\n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, size, size);\n\n        return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 256, h = 256) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = '#ffffff';\n    for(let i=0; i<500; i++) {\n      ctx.globalAlpha = Math.random() * 0.05;\n      ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.roundRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.fill({ color: this._trackColor, alpha: 0.85 });\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.roundRect(0, 0, innerW, h, radius);\n    this._fill.fill({ color: this._color, alpha: 1 });\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  tiles: 20,\n  tilesAnim: 25,\n  objBehind: 30,\n  secretsBelow: 35,\n  player: 40,\n  projectiles: 50,\n  objFront: 60,\n  secretsAbove: 65,\n  weather: 70,\n  fog: 80,\n  liquids: 90,\n  liquidFx: 100,\n  overlay: 110,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg)$/);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#2a5d8f');\n    g.addColorStop(1, '#174369');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (dark red to orange)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#6b1a07');\n    g.addColorStop(1, '#c43f0f');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffed8a');\n      grad.addColorStop(1, '#ff7b00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffd36e';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3, minWidth = 0, minHeight = 0 }) {\n    if (!this.container) return;\n    this.clear();\n\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = w;\n    solid.height = h;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: w, height: h });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = h / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight, minWidth = 0, minHeight = 0) {\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = w;\n      this.bgSprite.height = h;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = w;\n      this.imgSprite.height = h;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = h / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl, minWidth = 0, minHeight = 0 } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n      minWidth,\n      minHeight\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const resize = (worldWidth, worldHeight, minWidth = 0, minHeight = 0) => {\n    if (parallaxHelper) {\n      parallaxHelper.resize(worldWidth, worldHeight, minWidth, minHeight);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    resize,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container, Text } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n\n  // Ja nav tekstru masva vai tas ir tuks, minm parasto tekstru\n  if (!spr && def.texture) {\n    const tex = getTexture(def.texture);\n    if (tex) {\n      spr = new Sprite(tex);\n    }\n  }\n\n  // Ja joprojm nav spr (piemram, nav tekstras), prbaudm editorIcon\n  if (!spr && def.editorIcon) {\n    spr = new Text({\n        text: def.editorIcon,\n        style: {\n            fontSize: 24,\n            fill: 0xffffff,\n            fontWeight: 'bold',\n            dropShadow: true,\n            dropShadowColor: 0x000000,\n            dropShadowBlur: 4,\n            dropShadowDistance: 2\n        }\n    });\n    // Centrjam tekstu tile ietvaros\n    spr.anchor.set(0.5, 0.5);\n    // T k ms lietojam anchor 0.5, mums bs jpielgo pozcija vlk vai eit\n    // Bet buildSpriteFromDef parasti atgrie objektu, kura anchor ir (0,0) pc noklusjuma\n    // lai tas atbilstu tileSize pozicionanai.\n    // Tpc iestatsim anchor uz 0, bet nedaudz nobdsim?\n    // Labk lietot anchor 0.5 un layerBuilder- pieskaitt tileSize/2.\n  }\n\n  if (!spr) {\n    spr = new Sprite(Texture.WHITE);\n  }\n\n  if (spr instanceof Sprite) {\n    spr.anchor.set(0, 0);\n  } else if (spr instanceof Text) {\n    // Tekstam ms gribam, lai tas btu centr, tpc atstjam 0.5\n  }\n  \n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth);\n  container.y = playerState.y || 0;\n};\n","import React, { useEffect, useRef, useMemo, useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { syncEntities, cleanupEntities } from './entityManager';\nimport { rebuildLayers } from './layerBuilder';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({\n  skipCacheIdWarning: true,\n  preferCreateImageBitmap: false, // Prevents WebGL warning: texImage: Alpha-premult and y-flip are deprecated\n});\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = EMPTY_ARRAY,\n  objectMapData = EMPTY_ARRAY,\n  secretMapData = EMPTY_ARRAY,\n  revealedSecrets = EMPTY_ARRAY,\n  registryItems = EMPTY_ARRAY,\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  projectiles = EMPTY_ARRAY,\n  healthBarEnabled = true,\n  objectMetadata = EMPTY_OBJECT,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n  isEditor = false,\n}) => {\n  const [isPixiReady, setIsPixiReady] = useState(false);\n\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const cameraPosRef = useRef({ x: 0, y: 0 });\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerLayerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null });\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const entitiesLayerRef = useRef(null);\n  const entitySpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef(EMPTY_ARRAY);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0, targetAlpha: 0, currentAlpha: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl,\n      minWidth: appRef.current?.screen?.width || 0,\n      minHeight: appRef.current?.screen?.height || 0\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      if (appRef.current) return;\n\n      const app = new Application();\n      try {\n        await app.init({\n          resizeTo: mountRef.current,\n          backgroundAlpha: 0,\n          antialias: false,\n          autoDensity: true,\n        });\n\n        if (destroyed) {\n          app.destroy(true, { children: true, texture: true });\n          return;\n        }\n\n        if (!app.renderer) return;\n\n        appRef.current = app;\n        app.stage.sortableChildren = true;\n\n        // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const entitiesLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const overlayLayer = new Container();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      objBehind.zIndex = LAYERS.objBehind;\n      objFront.zIndex = LAYERS.objFront;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      entitiesLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      overlayLayer.zIndex = LAYERS.overlay;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      playerLayerRef.current = playerLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      entitiesLayerRef.current = entitiesLayer;\n      overlayLayerRef.current = overlayLayer;\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      app.stage.addChild(bg, bgAnim, parallaxLayer, objBehind, secretBelowLayer, playerLayer, entitiesLayer, projLayer, objFront, secretAboveLayer, weatherLayer, fogLayer, liquidLayer, liquidFxLayer, overlayLayer);\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas - DROA PIEVIENOANA\n      if (mountRef.current && app.renderer && app.canvas) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.rect(0, 0, W, H);\n      g.fill({ color: 0x1d4875, alpha: 1 });\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffa229, warn: 0xff7b00, danger: 0xff3b1a };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas && app.renderer) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          // No need to manually rebuild here as the main useEffect will catch app state or we can just trigger a state change if needed.\n          // But Pixi v8 often recovers automatically. To be safe, we can force a rebuild by just waiting for next tick.\n        });\n      }\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { mapWidth, mapHeight, tileSize });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n      } catch {}\n\n      rebuildParallax();\n\n      // Finalize initialization by setting appRef\n      // This will trigger the second useEffect to build layers and player\n      appRef.current = app;\n      setIsPixiReady(true);\n      app.ticker.add(() => {\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          updatePlayerSprite(\n            { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n            s,\n            tileSize,\n            hbEnabledRef.current\n          );\n        }\n\n        // Camera Follow\n        const sw = app.screen.width;\n        const sh = app.screen.height;\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        if (s) {\n          const targetX = (s.x || 0) + (s.width || tileSize) / 2;\n          const targetY = (s.y || 0) + (s.height || tileSize) / 2;\n\n          let camX = targetX - sw / 2;\n          let camY = targetY - sh / 2;\n\n          // Constraints with centering for small maps\n          if (worldW < sw) {\n            camX = (worldW - sw) / 2;\n          } else {\n            camX = Math.max(0, Math.min(camX, worldW - sw));\n          }\n\n          if (worldH < sh) {\n            camY = (worldH - sh) / 2;\n          } else {\n            camY = Math.max(0, Math.min(camY, worldH - sh));\n          }\n\n          cameraPosRef.current = { x: camX, y: camY };\n          app.stage.pivot.set(camX, camY);\n\n          if (parallaxRef.current) {\n            parallaxRef.current.position.set(camX, camY);\n          }\n\n          const f = parallaxFactorRef.current;\n          if (parallaxManagerRef.current) {\n            parallaxManagerRef.current.resize(worldW, worldH, sw, sh);\n            parallaxManagerRef.current.setScroll(camX, f);\n          }\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        if (systems.rain) systems.rain.update(dt);\n        if (systems.snow) systems.snow.update(dt);\n        if (systems.clouds) systems.clouds.update(dt);\n        if (systems.fog) systems.fog.update(dt);\n        if (systems.thunder) systems.thunder.update(dt);\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater/lava overlay with smooth fade-in/out\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n\n          // Safety check: ensure graphics object exists and is attached\n          if (u && (!u.g || u.g.destroyed)) {\n            const overlayL = overlayLayerRef.current;\n            if (overlayL) {\n              const g = new Graphics();\n              overlayL.addChild(g);\n              u.g = g;\n              u.currentAlpha = 0;\n              u.targetAlpha = 0;\n              u.time = 0;\n            }\n          }\n\n          if (u && u.g) {\n            // Check if player is in water/lava (regardless of head position)\n            const liquidType = sNow.liquidType;\n            const inLiquid = !!(sNow && sNow.inWater && (liquidType === 'water' || liquidType === 'lava'));\n\n            // Determine overlay color based on liquid type\n            let overlayColor = 0x1d4875; // water (blue)\n            if (liquidType === 'lava') {\n              overlayColor = 0x8b2e0f; // lava (dark orange-red)\n            }\n\n            if (inLiquid) {\n              u.time += dt;\n              // Target alpha with pulse effect\n              const pulseBase = 0.12 + 0.06 * Math.sin(u.time * 0.0025);\n              u.targetAlpha = pulseBase;\n\n              // Smooth fade-in: gradually approach target alpha\n              const fadeSpeed = 0.01; // Faster fade-in for immediate visibility\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeSpeed);\n\n              // Update color if liquid type changed (only when needed to avoid constant redraw)\n              if (!u.g.visible || u.lastLiquidType !== liquidType) {\n                u.g.clear();\n                u.g.rect(0, 0, mapWidth * tileSize, mapHeight * tileSize);\n                u.g.fill({ color: overlayColor, alpha: 1 });\n                u.lastLiquidType = liquidType;\n              }\n\n              u.g.visible = true;\n              u.g.alpha = u.currentAlpha;\n            } else {\n              // Smooth fade-out\n              u.targetAlpha = 0;\n              const fadeOutSpeed = 0.008; // Faster fade-out\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeOutSpeed);\n              u.g.alpha = u.currentAlpha;\n\n              if (u.currentAlpha < 0.01) {\n                u.currentAlpha = 0;\n                u.g.alpha = 0;\n                u.g.visible = false;\n                u.time = 0; // Reset time for next submersion\n              }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n\n        // Entities\n        const sNow = playerStateRef.current || {};\n        syncEntities(entitiesLayerRef.current, entitySpritesRef.current, sNow.entities, registryItems, tileSize);\n      });\n    } catch (error) {\n      console.error('PixiStage init failed:', error);\n    }\n  };\n\n  init();\n\n  return () => {\n    destroyed = true;\n    if (appRef.current) {\n      const appToDestroy = appRef.current;\n      appRef.current = null;\n      appToDestroy.destroy(true, { children: true, texture: true });\n    }\n    try { liquidSystemRef.current?.destroy(); } catch {}\n    try { waterFxRef.current?.destroy(); } catch {}\n    try { lavaEmbersRef.current?.destroy(); } catch {}\n    try { lavaSteamRef.current?.destroy(); } catch {}\n    try { parallaxManagerRef.current?.destroy(); } catch {}\n    parallaxManagerRef.current = null;\n    try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n    try {\n      weatherSystemsRef.current.rain?.destroy();\n      weatherSystemsRef.current.snow?.destroy();\n      weatherSystemsRef.current.fog?.destroy();\n    } catch {}\n    cleanupProjectiles(projectileSpritesRef.current);\n    cleanupEntities(entitySpritesRef.current);\n    clearTextureCache();\n  };\n  }, []);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n\n    let active = true;\n\n    const runRebuild = async () => {\n        // Collect all textures to preload\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n            addUrl(def?.texture);\n            if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n            addUrl(playerVisuals.texture);\n            if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n            await Assets.load(urls);\n        }\n\n        if (!active || !appRef.current) return;\n\n        if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n            rebuildLayers(\n                { bgRef: bgRef.current, objBehindRef: objBehindRef.current, objFrontRef: objFrontRef.current, secretLayerRef: secretLayerRef.current },\n                { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems, objectMetadata, isEditor }\n            );\n\n            // Rebuild player visuals if visuals changed or player not created yet\n            const pLayer = playerLayerRef.current;\n            if (pLayer) {\n                if (playerRef.current) {\n                    pLayer.removeChild(playerRef.current);\n                    try { playerRef.current.destroy({ children: true }); } catch {}\n                }\n                \n                const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerStateRef.current, tileSize);\n                pLayer.addChild(playerComponents.container);\n                playerRef.current = playerComponents.container;\n                playerSpriteRefs.current = playerComponents.sprites;\n                playerHealthBarRef.current = playerComponents.healthBar;\n            }\n\n            // Rebuild liquid regions only if tileMapData changed (not just revealedSecrets)\n            // This prevents liquid \"jumping\" when revealing secrets\n            const tileDataString = JSON.stringify(tileMapData);\n            const prevTileDataString = liquidSystemRef.current?._lastTileData;\n            if (tileDataString !== prevTileDataString) {\n                try {\n                    if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n                    if (liquidLayerRef.current) {\n                        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { mapWidth, mapHeight, tileSize });\n                        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n                        liquidSystemRef.current._lastTileData = tileDataString; // Track what we built\n                    }\n                } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n                try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n            }\n\n            // Upload to GPU to avoid lazy initialization warnings\n            if (app.renderer && app.renderer.prepare) {\n                try {\n                    await app.renderer.prepare.upload(app.stage);\n                } catch (e) {\n                    // Prepare might fail in some edge cases or context loss\n                }\n            }\n        }\n    };\n\n    runRebuild();\n\n    return () => { active = false; };\n  }, [tileMapData, objectMapData, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets, objectMetadata, playerVisuals, isPixiReady]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      }\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherRain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherSnow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherClouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherThunder) || 0));\n\n    // Reset systems\n    try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n    try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n    try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n    try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n    try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n    weatherSystemsRef.current.rain = null;\n    weatherSystemsRef.current.snow = null;\n    weatherSystemsRef.current.clouds = null;\n    weatherSystemsRef.current.fog = null;\n    weatherSystemsRef.current.thunder = null;\n\n    // Rain\n    if (getRainIntensity() > 0) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n      weatherSystemsRef.current.rain.setIntensity(getRainIntensity());\n    }\n\n    // Snow\n    if (getSnowIntensity() > 0) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n      weatherSystemsRef.current.snow.setIntensity(getSnowIntensity());\n    }\n\n    // Clouds\n    if (getCloudsIntensity() > 0) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n      weatherSystemsRef.current.clouds.setIntensity(getCloudsIntensity());\n    }\n\n    // Fog\n    if (Number(weatherFog) > 0) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, () => Number(weatherFog) || 0);\n      weatherSystemsRef.current.fog.setIntensity(Number(weatherFog) || 0);\n    }\n\n    // Thunder\n    if (getThunderIntensity() > 0) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n      weatherSystemsRef.current.thunder.setIntensity(getThunderIntensity());\n    }\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, mapWidth, mapHeight, tileSize, isSolidAt]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%' }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  objectMetadata: PropTypes.object,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n};\n\nexport default PixiStage;\n","import { Sprite, AnimatedSprite, Texture } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Create new sprite\n      const def = getRegItem(registryItems, p.defId);\n      if (def && Array.isArray(def.textures) && def.textures.length > 1) {\n        const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n        if (frames.length > 0) {\n          spr = new AnimatedSprite(frames);\n          spr.animationSpeed = msToSpeed(def.animationSpeed);\n          spr.play();\n        }\n      }\n      if (!spr) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        spr = new Sprite(tex);\n      }\n      spr.anchor.set(0.5, 0.5);\n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x + (p.dir >= 0 ? 0 : 0);\n    spr.y = p.y;\n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = p.dir >= 0 ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","import { Sprite, Texture, Rectangle } from 'pixi.js';\nimport { getTexture } from './helpers';\n\n/**\n * Sinhroniz un atjaunina kustgo enttiju (piem. tanku) spraitus.\n * @param {Container} entitiesLayer PixiJS konteiners enttijm\n * @param {Map} entitySpritesMap Map, kur glabjas esoie spraiti (pc ID)\n * @param {Array} entitiesList Enttiju saraksts no dzinja\n * @param {Array} registryItems Reistra elementi\n * @param {number} tileSize Flzes izmrs pikseos\n */\nexport const syncEntities = (entitiesLayer, entitySpritesMap, entitiesList, registryItems, tileSize) => {\n  if (!entitiesLayer) return;\n\n  const seen = new Set();\n  const list = entitiesList || [];\n\n  for (const ent of list) {\n    const key = ent.id;\n    seen.add(key);\n\n    let spr = entitySpritesMap.get(key);\n    const def = ent.def || {};\n\n    if (!spr) {\n      // Izveidojam jaunu spraitu ar baltu tekstru k aizvietotju, kamr ldjas st\n      spr = new Sprite(Texture.WHITE);\n      spr.anchor.set(0, 0);\n      entitiesLayer.addChild(spr);\n      entitySpritesMap.set(key, spr);\n      spr._lastFrameIndex = -1;\n    }\n\n    // Atjaunojam tekstru no spritesheet, ja nepiecieams\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    const isTextureReady = source && source.width > 1;\n\n    if (def.spriteSheet && def.spriteSheet.enabled && isTextureReady) {\n      const columns = def.spriteSheet.columns || 1;\n      const frameIndex = ent.currentSpriteIndex !== undefined ? ent.currentSpriteIndex : 0;\n      \n      if (spr._lastFrameIndex !== frameIndex) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const totalSprites = def.spriteSheet.totalSprites || 1;\n\n        // Ja kolonnu skaits JSON ir nepareizs vai trkst, minm to aprint\n        let effectiveColumns = columns;\n        if (!effectiveColumns || effectiveColumns <= 0) {\n            effectiveColumns = Math.floor(texWidth / (def.spriteSheet.frameWidth || 32)) || 1;\n        }\n\n        const frameWidth = texWidth / effectiveColumns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / effectiveColumns);\n        \n        const col = frameIndex % effectiveColumns;\n        const row = Math.floor(frameIndex / effectiveColumns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        try {\n            spr.texture = new Texture({\n              source: source,\n              frame: rect\n            });\n            spr._lastFrameIndex = frameIndex;\n        } catch (e) {\n            console.warn(`Failed to create texture for entity ${key} frame ${frameIndex}`, e);\n            spr.texture = baseTexture;\n        }\n      }\n    } else if (isTextureReady) {\n      if (spr.texture !== baseTexture) {\n        spr.texture = baseTexture;\n        spr._lastFrameIndex = -1;\n      }\n    } else if (def.editorIcon) {\n        // Ja nav tekstras, bet ir ikona (piemram, bultia, kaut gan ts te nevajadztu bt k enttijai)\n        if (spr.texture !== Texture.WHITE) spr.texture = Texture.WHITE;\n    }\n\n    // Pozcija un izmrs\n    // Svargi: Vispirms iestatm izmru, tad virzienu\n    const targetWidth = ent.width || tileSize;\n    const targetHeight = ent.height || tileSize;\n    \n    spr.width = targetWidth;\n    spr.height = targetHeight;\n    \n    // Nodroinm, ka scale nav 0 vai NaN (ja tekstra bija dvaina skum)\n    if (!spr.scale.x || isNaN(spr.scale.x)) spr.scale.x = 1;\n    if (!spr.scale.y || isNaN(spr.scale.y)) spr.scale.y = 1;\n\n    // Virziens (flipping)\n    const direction = ent.direction !== undefined ? ent.direction : 1;\n    const absScaleX = Math.abs(spr.scale.x);\n    spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n    \n    // Pozicionana emot vr flipping\n    spr.x = ent.x + (direction < 0 ? targetWidth : 0);\n    spr.y = ent.y;\n  }\n\n  // Noemam spraitus enttijm, kas vairs neeksist\n  for (const [key, spr] of entitySpritesMap.entries()) {\n    if (!seen.has(key)) {\n      if (spr.parent) spr.parent.removeChild(spr);\n      spr.destroy({ children: true, texture: false }); // Tekstras koplietoanas d ts neizncinm\n      entitySpritesMap.delete(key);\n    }\n  }\n};\n\n/**\n * Attra visus enttiju spraitus.\n */\nexport const cleanupEntities = (entitySpritesMap) => {\n  for (const spr of entitySpritesMap.values()) {\n    if (spr.parent) spr.parent.removeChild(spr);\n    spr.destroy({ children: true, texture: false });\n  }\n  entitySpritesMap.clear();\n};\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef } from './liquidRendering';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const {\n    mapWidth,\n    mapHeight,\n    tileSize,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    revealedSecrets,\n    registryItems,\n    objectMetadata,\n    isEditor\n  } = options;\n\n  const { bgRef, objBehindRef, objFrontRef, secretLayerRef } = refs;\n\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous and destroy old children to prevent memory leaks/ticker buildup\n  const safeDestroy = (container) => {\n    if (!container) return;\n    const children = container.removeChildren();\n    children.forEach(child => {\n      try {\n        // Destroy child but KEEP textures in cache\n        child.destroy({ children: true, texture: false });\n      } catch (e) {}\n    });\n  };\n\n  safeDestroy(bgRef);\n  safeDestroy(objBehindRef);\n  safeDestroy(objFrontRef);\n  safeDestroy(secretLayerRef?.below);\n  safeDestroy(secretLayerRef?.above);\n\n  // Track which tiles need secret overlay\n  // We need overlay for: 1) unrevealed above/secret zones, 2) all open/below zones\n  const secretOverlayTilesBelow = new Map(); // tile index -> filterColor\n  const secretOverlayTilesAbove = new Map(); // tile index -> filterColor\n\n  // Helper: resolve registry item by id\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Background tiles (skip liquids; they are handled by LiquidRegionSystem)\n  let secretLayerCount = 0;\n  let normalLayerCount = 0;\n\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    // Check if this tile is in a secret zone\n    const secretId = secretMapData?.[i];\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = secretSubtype === 'secret' || secretSubtype === 'above';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    // Track which tiles need overlay rendering\n    // above/secret: overlay AFTER reveal (to darken objects after revealing secret)\n    // open/below: no overlay needed (tiles already darkened)\n    if (isInSecretArea && isSecretRevealed) {\n      const filterColor = secretDef?.filterColorInGame || secretDef?.filterColor || 'rgba(0, 0, 0, 0.6)';\n      const renderAbove = secretDef?.renderAbovePlayer;\n      if (renderAbove) {\n        secretOverlayTilesAbove.set(i, filterColor);\n      } else {\n        secretOverlayTilesBelow.set(i, filterColor);\n      }\n    }\n\n    // Determine if this tile should be rendered with filter on secret layer\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      // open.area: always render on secret layer with filter\n      renderOnSecretLayer = true;\n      secretLayerCount++;\n    } else if (isInSecretArea && isSecretRevealed) {\n      // secret.area: only render on secret layer with filter AFTER revealed\n      renderOnSecretLayer = true;\n      secretLayerCount++;\n    } else {\n      normalLayerCount++;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def) || def.type === 'entity' || def.subtype === 'platform') {\n      // liquids are handled by LiquidRegionSystem; skip per-tile sprite\n      // entities and platforms are handled by separate managers\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    const x = (i % mapWidth) * tileSize;\n    const y = Math.floor(i / mapWidth) * tileSize;\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    // Apply filter if rendering on secret layer\n    if (renderOnSecretLayer) {\n      // Add dark backing to block background image for tiles with alpha\n      // Both open.area (always) and secret.area (when revealed) need backing\n      // Add to bgRef (same layer as tiles) to keep it BELOW objects\n      const backing = new Graphics();\n      backing.rect(x, y, tileSize, tileSize);\n      backing.fill({ color: 0x000000, alpha: 0.8 }); // Dark backing to block background\n      bgRef.addChild(backing);\n\n      sprite.alpha = 0.4; // darken the tile\n      // Add to secret layer (below player always for tiles)\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        bgRef.addChild(sprite);\n      }\n    } else {\n      // Normal rendering on tiles layer\n      bgRef.addChild(sprite);\n    }\n  }\n\n  // Objects (non-player)\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n    const def = getDef(id);\n    if (!def || def.type === 'entity' || def.subtype === 'platform' || def.subtype === 'pushable' || def.isPushable) continue;\n\n    const meta = (objectMetadata && objectMetadata[i]) || {};\n    const maxH = def.maxHealth || 100;\n    const health = meta.health !== undefined ? meta.health : maxH;\n\n    let visualElement;\n    if (def.spriteSheet && def.spriteSheet.enabled) {\n      const totalSprites = def.spriteSheet.totalSprites || 1;\n      const columns = def.spriteSheet.columns || totalSprites;\n      \n      const healthPercent = Math.max(0, Math.min(100, (health / maxH) * 100));\n      let frameIndex = Math.floor((1 - healthPercent / 100) * (totalSprites - 1));\n      frameIndex = Math.max(0, Math.min(totalSprites - 1, frameIndex));\n\n      const baseTexture = getTexture(def.texture);\n      const source = baseTexture?.source;\n      if (source && source.width > 1) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n\n        const frameWidth = texWidth / columns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / columns);\n        \n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        const frameTexture = new Texture({\n            source: source,\n            frame: rect\n        });\n        visualElement = new Sprite(frameTexture);\n      } else {\n        visualElement = buildSpriteFromDef(def);\n      }\n    } else {\n      visualElement = buildSpriteFromDef(def);\n    }\n\n    if (!visualElement) continue;\n\n    const x = (i % mapWidth) * tileSize;\n    const y = Math.floor(i / mapWidth) * tileSize;\n    \n    // Ja tas ir teksts (piemram, bultia redaktor), centrjam to tile ietvaros\n    if (visualElement.anchor && visualElement.anchor.x === 0.5) {\n      visualElement.x = tileSize / 2;\n      visualElement.y = tileSize / 2;\n    } else {\n      visualElement.x = 0;\n      visualElement.y = 0;\n    }\n    \n    visualElement.width = tileSize;\n    visualElement.height = tileSize;\n\n    // Create a container if we need a health bar or just to keep it clean\n    const container = new Container();\n    container.x = x;\n    container.y = y;\n    \n    // Slpjam objektus, kuriem ir isHiddenInGame: true (piemram, bultias spl)\n    // Bet ja ms esam redaktor, ms gribam ts redzt.\n    if (def.isHiddenInGame && !isEditor) {\n        container.visible = false;\n    }\n\n    // Check if object is in unrevealed secret zone - if so, hide it\n    const secretId = secretMapData?.[i];\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInSecretArea = secretSubtype === 'secret' || secretSubtype === 'above';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    if (isInSecretArea && !isSecretRevealed && !isEditor) {\n      // Object is in unrevealed secret zone - make it invisible\n      container.visible = false;\n    }\n\n    container.addChild(visualElement);\n\n    // Add health bar for destructible objects if damaged\n    if (def.isDestructible && health < maxH && health > 0) {\n      try {\n        const hb = new HealthBar({\n          width: tileSize,\n          height: 4,\n          offsetX: 0,\n          offsetY: -5\n        });\n        hb.update(health, maxH);\n        container.addChild(hb);\n      } catch (e) {}\n    }\n\n    const renderAbove = !!def.renderAbovePlayer;\n    if (renderAbove) {\n      objFrontRef.addChild(container);\n    } else {\n      objBehindRef.addChild(container);\n    }\n  }\n\n  // Create dark overlays for unrevealed secret zones\n  // Below player overlay (for secrets with renderAbovePlayer: false)\n  if (secretOverlayTilesBelow.size > 0 && secretLayerRef?.below) {\n    const overlay = new Graphics();\n    secretOverlayTilesBelow.forEach((filterColor, idx) => {\n      const x = (idx % mapWidth) * tileSize;\n      const y = Math.floor(idx / mapWidth) * tileSize;\n\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    secretLayerRef.below.addChild(overlay);\n  }\n\n  // Above player overlay (for secrets with renderAbovePlayer: true)\n  if (secretOverlayTilesAbove.size > 0 && secretLayerRef?.above) {\n    const overlay = new Graphics();\n    secretOverlayTilesAbove.forEach((filterColor, idx) => {\n      const x = (idx % mapWidth) * tileSize;\n      const y = Math.floor(idx / mapWidth) * tileSize;\n\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    secretLayerRef.above.addChild(overlay);\n  }\n};\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = registryItems.find(r => r.id === startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSecrets && revealedSecrets.includes(idx)) continue;\n\n      const def = registryItems.find(r => r.id === secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSecrets || !revealedSecrets.includes(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    const vol = Math.max(0, Math.min(1, volume ?? 1));\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    osc.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  friction = 0.8,\n  acceleration = 0.2\n}) {\n  let { x, vx, width, direction } = state;\n  \n  const targetVx = keys?.a ? -MOVE_SPEED : (keys?.d ? MOVE_SPEED : 0);\n  \n  if (targetVx !== 0) {\n    // Accelerate\n    vx += targetVx * acceleration;\n    if (Math.abs(vx) > MOVE_SPEED) vx = Math.sign(vx) * MOVE_SPEED;\n    direction = Math.sign(targetVx);\n  } else {\n    // Apply friction\n    vx *= friction;\n    if (Math.abs(vx) < 0.1) vx = 0;\n  }\n\n  const proposedX = x + vx;\n  const py = state.y ?? 0;\n  if (checkCollision(proposedX, py, mapWidth, mapHeight)) {\n    // Precza apstans pie ra (tiles vai enttijas) bez rupja snapping pie TILE_SIZE\n    const step = 0.5;\n    const sign = Math.sign(vx);\n    let safeX = x;\n    \n    for (let d = step; d < Math.abs(vx); d += step) {\n      const nextX = x + d * sign;\n      if (!checkCollision(nextX, py, mapWidth, mapHeight)) {\n        safeX = nextX;\n      } else {\n        break;\n      }\n    }\n    x = safeX;\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isWaterAt(wx, wy): optional helper to detect liquid tiles at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isWaterAt,\n  prevInWater\n}) {\n  // Liquid defaults (can be overridden in future via per-tile sampling)\n  const LIQ_BUOYANCY = 0.5; // reduces effective gravity by 50%\n  const LIQ_DRAG_Y = 0.88;  // vertical damping per frame when in liquid\n  const LIQ_TERMINAL = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  if (typeof isWaterAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    inWater = !!(isWaterAt(cx, feetY) || isWaterAt(cx, chestY));\n    headUnderWater = !!isWaterAt(cx, headY);\n    atSurface = inWater && !headUnderWater;\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * 0.55));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - LIQ_BUOYANCY);\n    vy *= LIQ_DRAG_Y;\n    if (vy > LIQ_TERMINAL) vy = LIQ_TERMINAL;\n  } else {\n    vy += GRAVITY;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  if (checkCollision(x, y + vy, mapWidth, mapHeight)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      y = Math.floor((y + vy + height) / TILE_SIZE) * TILE_SIZE - height;\n      if (Math.abs(vx || 0) > 0) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((y + vy) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y += vy;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.water ? 'water' : (def.flags.lava ? 'lava' : 'liquid');\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    }\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    }\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\nimport { updateEntities } from '../gameplay/entities';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isWaterAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isWaterAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, playSfx, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const mapWidth = mapData.meta?.width || mapData.width || 20;\n  const mapHeight = mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo,\n    iceResist,\n    maxIceResist\n  } = gameState.current;\n\n  const dt = Math.max(0, deltaMs || 0);\n\n  // 0.5) Resources update (before physics to affect them)\n  // Ice resistance depletion: drains while on slippery surface; regenerates otherwise\n  const backgroundLayer = ctx.mapData.layers.find(l => l.name === 'background')?.data || [];\n  const surface = helpers.getSurfaceProperties ? helpers.getSurfaceProperties(x, y, width, height, mapWidth, mapHeight, TILE_SIZE, backgroundLayer, ctx.registryItems) : { friction: 0.8, acceleration: 0.2 };\n  \n  const isSlippery = surface.friction >= 0.9;\n  let currentIceRes = Number(iceResist);\n  const maxIce = Math.max(1, Number(maxIceResist || 100));\n  if (!Number.isFinite(currentIceRes)) currentIceRes = maxIce;\n\n  if (isSlippery) {\n    currentIceRes -= (20 * dt) / 1000;\n  } else {\n    currentIceRes += (35 * dt) / 1000;\n  }\n  currentIceRes = Math.max(0, Math.min(maxIce, currentIceRes));\n  gameState.current.iceResist = currentIceRes;\n\n  let effectiveFriction = surface.friction;\n  if (isSlippery && currentIceRes > 0) {\n      const ratio = currentIceRes / maxIce;\n      const targetFriction = 0.8;\n      effectiveFriction = surface.friction - (surface.friction - targetFriction) * ratio;\n  }\n\n  // 1) Horizontal movement\n  const checkCollisionExtended = (nx, ny, mw, mh, w, h) => {\n    // Statisk pasaule\n    if (checkCollision(nx, ny, mw, mh, w, h)) return true;\n    \n    // Enttijas (tanki)\n    if (entitiesRef.current) {\n      const pw = w || width;\n      const ph = h || height;\n      // Izmantojam punktu prbaudi ar nelielu nobdi uz ieku (0.01), \n      // ldzgi k statiskaj checkCollision, lai izvairtos no snmalu iespranas.\n      const points = [\n        { x: nx + 0.01, y: ny + 0.01 },\n        { x: nx + pw - 0.01, y: ny + 0.01 },\n        { x: nx + 0.01, y: ny + ph - 0.01 },\n        { x: nx + pw - 0.01, y: ny + ph - 0.01 }\n      ];\n\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding || ent.subtype === 'platform') continue;\n        \n        for (const pt of points) {\n          if (pt.x >= ent.x && pt.x <= ent.x + ent.width && pt.y >= ent.y && pt.y <= ent.y + ent.height) {\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  };\n\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, vx, width, direction },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    friction: effectiveFriction,\n    acceleration: isSlippery ? (currentIceRes > 0 ? 0.15 : surface.acceleration) : surface.acceleration\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 1.1) Pushable objects logic (Stone pushing)\n  let isPushing = false;\n  let pushTarget = null;\n  \n  const currentStrength = gameState.current.strength || 30;\n  const isAlreadyAtMax = currentStrength >= 99;\n  const lastPushTime = gameState.current.lastPushTime || 0;\n  const gracePeriod = 300; // ms, kur strength nesamazins pat ja kontakts pazd uz brdi\n\n  if (entitiesRef.current) {\n    // Ja jau stumjam ar pilnu jaudu, esam pielaidgki pret attlumu (histerze), \n    // lai kompenstu nelielas fizikas dzinja nobdes.\n    const pushDist = isAlreadyAtMax ? 15 : 5;\n    const overlapDist = isAlreadyAtMax ? 12 : 5;\n\n    for (const ent of entitiesRef.current) {\n      if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n        // Prbaudm vai spltjs ir blakus akmenim\n        const isNextToLeft = (x + width + pushDist > ent.x) && (x + width <= ent.x + overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n        const isNextToRight = (x - pushDist < ent.x + ent.width) && (x >= ent.x + ent.width - overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n\n        if ((isNextToLeft && keys.d) || (isNextToRight && keys.a)) {\n          isPushing = true;\n          pushTarget = ent;\n          break;\n        }\n      }\n    }\n  }\n\n  if (isPushing) {\n    gameState.current.strength = Math.min(100, currentStrength + (65 * dt) / 1000); // Aug par ~65% sekund\n    if (gameState.current.strength >= 100 && pushTarget) {\n      // Pastumjam akmeni\n      const pushForce = 2.0;\n      pushTarget.vx = (x < pushTarget.x ? 1 : -1) * pushForce;\n      gameState.current.lastPushTime = timestamp; \n      \n      // Atskaojam skau\n      if (pushTarget.def?.sounds?.push && (!pushTarget.lastPushSoundTime || timestamp - pushTarget.lastPushSoundTime > 450)) {\n        playSfx(pushTarget.def.sounds.push, 0.3);\n        pushTarget.lastPushSoundTime = timestamp;\n      }\n    }\n  } else {\n    // Prbaudm grace periodu pirms skam samazint spku\n    const timeSincePush = timestamp - lastPushTime;\n    if (timeSincePush > gracePeriod) {\n      if (currentStrength > 30) {\n        gameState.current.strength = Math.max(30, currentStrength - (35 * dt) / 1000);\n      } else {\n        gameState.current.strength = 30;\n      }\n    }\n  }\n\n  // 2) Vertical physics\n  const vp = applyVerticalPhysics({\n    keys,\n    x,\n    y,\n    vy,\n    isGrounded,\n    animation,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    JUMP_FORCE,\n    TILE_SIZE,\n    width,\n    height,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    vx,\n    isWaterAt: (wx, wy) => {\n      try { return typeof isWaterAt === 'function' ? !!isWaterAt(wx, wy) : false; } catch { return false; }\n    },\n    prevInWater: !!gameState.current.inWater\n  });\n  y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n  const inWater = !!vp.inWater;\n  const headUnderWater = !!vp.headUnderWater;\n  const atSurface = !!vp.atSurface;\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    if (headUnderWater && (liquidType === 'water' || inWater)) {\n      oxy -= (Math.max(0, Number(oxyParams.drainPerSecond) || 0) * dt) / 1000;\n    } else {\n      oxy += (Math.max(0, Number(oxyParams.regenPerSecond) || 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resist depletion while in lava; regenerates outside\n    if (liquidType === 'lava') {\n      lavaRes -= (Math.max(0, Number(lavaParams.drainPerSecond) || 0) * dt) / 1000;\n    } else {\n      lavaRes += (Math.max(0, Number(lavaParams.regenPerSecond) || 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && (liquidType === 'water' || inWater)) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if (liquidType === 'lava' && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  if (liquidType && liquidParams && Number(liquidParams.dps) > 0) {\n    try {\n      if (liquidType === 'lava') {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, liquidParams);\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, liquidParams);\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection and triggers\n  // Sync moved state to Ref so triggers can see it and modify it (Teleport, Knockback, etc.)\n  gameState.current.x = x;\n  gameState.current.y = y;\n  gameState.current.vx = vx;\n  gameState.current.vy = vy;\n  gameState.current.isGrounded = isGrounded;\n  gameState.current.animation = animation;\n\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // Sync back from Ref in case triggers changed something\n  x = gameState.current.x;\n  y = gameState.current.y;\n  vx = gameState.current.vx;\n  vy = gameState.current.vy;\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0) {\n    const originX = x + (direction >= 0 ? width + 4 : -4);\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1, 'player');\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 5.5) Update entities (tanks etc.)\n  try {\n    updateEntities({\n      entitiesRef,\n      gameState,\n      mapData,\n      objectData,\n      mapWidth,\n      mapHeight,\n      TILE_SIZE,\n      checkCollision,\n      isWaterAt,\n      getLiquidSample,\n      spawnProjectile,\n      playSfx,\n      constants,\n      registryItems: ctx.registryItems\n    }, Math.min(dt, 100)); // Ierobeojam deltaMs uz 100ms, lai izvairtos no milzgiem lcieniem\n    \n    // Sinhronizjam loklos maingos pc enttiju (platformu) ietekmes\n    x = gameState.current.x;\n    y = gameState.current.y;\n    vx = gameState.current.vx;\n    vy = gameState.current.vy;\n    isGrounded = gameState.current.isGrounded;\n    animation = gameState.current.animation;\n    \n    // Kontaktbojjumi no enttijm\n    const player = gameState.current;\n    if (entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        \n        // AABB prbaude\n        const hit = (\n          player.x < ent.x + ent.width &&\n          player.x + player.width > ent.x &&\n          player.y < ent.y + ent.height &&\n          player.y + player.height > ent.y\n        );\n        \n        if (hit && Number(player.hitTimerMs) <= 0) {\n          // Pievienojam nelielu atgrdienu (knockback)\n          const knockbackDir = player.x + player.width / 2 < ent.x + ent.width / 2 ? -1 : 1;\n          gameState.current.vx = knockbackDir * 5;\n          gameState.current.vy = -3;\n          \n          // Iestatm bezsmertbas periodu un vizulo flash\n          gameState.current.hitTimerMs = 500;\n          \n          // Samazinm spltja veselbu\n          gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - 10);\n          \n          if (actions.onStateUpdate) {\n            actions.onStateUpdate('playerDamage', { damage: 10 });\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"Entity update failed:\", e);\n  }\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Win and Death check\n  if (gameState.current.isWinning) {\n    gameState.current.winCounter = (gameState.current.winCounter || 0) + (gameState.current.winCountSpeed || 10) * (deltaMs / 100);\n    if (gameState.current.winCounter >= 100) {\n      gameState.current.winCounter = 100;\n      // Trigger level win event if needed\n      if (actions.onStateUpdate) actions.onStateUpdate('levelWin');\n    }\n  }\n\n  if ((Number(gameState.current.health) || 0) <= 0) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null,\n    onIce: isSlippery\n  };\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","import { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\n\n/**\n * Atjaunina visas aktvs enttijas (piemram, tankus).\n * @param {Object} ctx Konteksts ar nepiecieamajiem datiem un funkcijm\n * @param {number} deltaMs Laiks kop pdj kadra\n */\nexport function updateEntities(ctx, deltaMs) {\n  const {\n    entitiesRef,\n    gameState,\n    mapWidth,\n    mapHeight,\n    TILE_SIZE,\n    checkCollision,\n    isWaterAt,\n    getLiquidSample,\n    spawnProjectile,\n    playSfx,\n    constants,\n    objectData,\n    mapData,\n    registryItems\n  } = ctx;\n\n  if (!entitiesRef.current || entitiesRef.current.length === 0) return;\n\n  const { GRAVITY, TERMINAL_VELOCITY } = constants;\n  const playerX = gameState.current.x;\n  const playerY = gameState.current.y;\n\n  // Ms modificjam enttijas pa tieo ref\n  entitiesRef.current = entitiesRef.current.map(entity => {\n    // 1. Ja enttija ir mirusi, apstrdjam sprdzienu vai noemanu\n    if (entity.health <= 0) {\n      if (!entity.isExploding) {\n        entity.isExploding = true;\n        entity.animation = 'explode';\n        entity.animFrame = 0;\n        entity.animTimer = 0;\n        entity.vx = 0; // Apstjamies sprdziena laik\n        entity.vy = 0;\n        entity.isGrounded = true; // Sprgst uz zemes\n      }\n      \n      const def = entity.def;\n      const explodeAnim = def.spriteSheet?.animations?.explode || [];\n      const totalFrames = explodeAnim.length;\n      const frameDuration = 100; // ms uz kadru\n      \n      entity.animTimer += deltaMs;\n      if (entity.animTimer >= frameDuration) {\n        entity.animTimer = 0;\n        entity.animFrame++;\n        if (entity.animFrame >= totalFrames) {\n          entity.shouldRemove = true;\n        }\n      }\n      return entity;\n    }\n\n    const def = entity.def;\n    \n    // 1.5. Pushable objektu (Akmeu) fizika\n    if (entity.subtype === 'pushable' || def?.isPushable) {\n      // idruma noteikana\n      const liquidSample = getLiquidSample ? getLiquidSample({\n        x: entity.x,\n        y: entity.y,\n        width: entity.width,\n        height: entity.height,\n        TILE_SIZE,\n        mapWidth,\n        mapHeight\n      }) : { inLiquid: false };\n\n      const inLiquid = liquidSample.inLiquid;\n      const liquidType = liquidSample.type;\n\n      // Skaas, ja iekrt idrum\n      if (inLiquid && !entity.prevInLiquid) {\n        if (liquidType === 'water' && def.sounds?.water_splash) {\n          playSfx(def.sounds.water_splash, 0.4);\n        } else if (liquidType === 'lava' && def.sounds?.lava_splash) {\n          playSfx(def.sounds.lava_splash, 0.4);\n        }\n      }\n      entity.prevInLiquid = inLiquid;\n\n      // Horizontl kustba ar berzi\n      if (Math.abs(entity.vx) > 0.01) {\n        const friction = inLiquid ? 0.7 : 0.85;\n        entity.vx *= friction;\n        \n        const nextX = entity.x + entity.vx;\n        if (!checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n          entity.x = nextX;\n        } else {\n          entity.vx = 0;\n        }\n      } else {\n        entity.vx = 0;\n      }\n\n      // Vertikl fizika\n      if (inLiquid && liquidType === 'lava') {\n        // Lna slkana lav\n        const sinkingSpeed = def.sinkingSpeed || 0.2;\n        entity.vy = sinkingSpeed;\n        entity.y += entity.vy;\n        entity.isGrounded = false;\n        \n        // Prbaudm vai neesam izgjui cauri zemei lav\n        if (checkCollision(entity.x, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n           // Atstumjam atpaka, ja atduras pret dibenu\n           entity.y -= entity.vy;\n           entity.vy = 0;\n           entity.isGrounded = true;\n        }\n      } else {\n        // Standarta gravitcija (den lnka)\n        const vp = applyVerticalPhysics({\n          keys: {}, \n          x: entity.x,\n          y: entity.y,\n          vy: entity.vy || 0,\n          isGrounded: entity.isGrounded,\n          animation: 'idle',\n          GRAVITY: inLiquid ? GRAVITY * 0.3 : GRAVITY,\n          TERMINAL_VELOCITY,\n          JUMP_FORCE: 0,\n          TILE_SIZE,\n          width: entity.width,\n          height: entity.height,\n          mapWidth,\n          mapHeight,\n          checkCollision,\n          isWaterAt,\n          vx: entity.vx\n        });\n        entity.y = vp.y;\n        entity.vy = vp.vy;\n        entity.isGrounded = vp.isGrounded;\n      }\n\n      // Animcija akmenim parasti ir statiska\n      entity.animation = 'idle';\n      entity.currentSpriteIndex = def.spriteSheet?.animations?.idle?.[0] || 0;\n\n      return entity;\n    }\n\n    // Platformu loika\n    if (entity.subtype === 'platform') {\n      const speed = def.speed || 1.5;\n      const mapW = mapWidth;\n      const mapH = mapHeight;\n      \n      // Mekljam bultias vairkos punktos (centr un mals), lai nepalaistu garm\n      const points = [\n        { x: entity.x + entity.width / 2, y: entity.y + entity.height / 2 }, // Centrs\n        { x: entity.x + 5, y: entity.y + entity.height / 2 },                // Kreis mala\n        { x: entity.x + entity.width - 5, y: entity.y + entity.height / 2 }  // Lab mala\n      ];\n      \n      let arrowId = null;\n      let foundArrowDef = null;\n\n      for (const p of points) {\n        const tx = Math.floor(p.x / TILE_SIZE);\n        const ty = Math.floor(p.y / TILE_SIZE);\n        \n        if (tx < 0 || tx >= mapW || ty < 0 || ty >= mapH) continue;\n        const idx = ty * mapW + tx;\n\n        // 1. Specilais arrows slnis\n        const arrowsLayer = ctx.mapData?.layers?.find(l => l.name === 'arrows' || l.name === 'Arrows')?.data;\n        let id = arrowsLayer ? arrowsLayer[idx] : null;\n        \n        // 2. Objektu slnis\n        if (!id && ctx.objectData) {\n          id = ctx.objectData[idx];\n        }\n\n        if (id) {\n          const aDef = ctx.registryItems.find(r => r.id === id);\n          if (aDef && aDef.subtype === 'arrow') {\n            arrowId = id;\n            foundArrowDef = aDef;\n            break; \n          }\n        }\n      }\n      \n      if (foundArrowDef) {\n        // Mainm kustbas virzienu atbilstoi bultiai\n        if (foundArrowDef.direction === 'up') { entity.vx = 0; entity.vy = -speed; }\n        else if (foundArrowDef.direction === 'down') { entity.vx = 0; entity.vy = speed; }\n        else if (foundArrowDef.direction === 'left') { entity.vx = -speed; entity.vy = 0; }\n        else if (foundArrowDef.direction === 'right') { entity.vx = speed; entity.vy = 0; }\n      }\n\n      // Ja platforma vl nekustas, iedodam tai skuma impulsu\n      if (entity.vx === 0 && entity.vy === 0) {\n        entity.vx = speed;\n      }\n\n      // Kustba\n      let nextX = entity.x + entity.vx * (deltaMs / 16.6);\n      let nextY = entity.y + entity.vy * (deltaMs / 16.6);\n      \n      // Robeu prbaude (neaujam aizbraukt aiz kartes)\n      const worldW = mapWidth * TILE_SIZE;\n      const worldH = mapHeight * TILE_SIZE;\n      \n      if (nextX < 0) { \n        nextX = 0; \n        entity.vx = Math.abs(entity.vx); // Move Right\n      } else if (nextX + entity.width > worldW) { \n        nextX = worldW - entity.width; \n        entity.vx = -Math.abs(entity.vx); // Move Left\n      }\n      \n      if (nextY < 0) { \n        nextY = 0; \n        entity.vy = Math.abs(entity.vy); // Move Down\n      } else if (nextY + entity.height > worldH) { \n        nextY = worldH - entity.height; \n        entity.vy = -Math.abs(entity.vy); // Move Up\n      }\n      \n      entity.x = nextX;\n      entity.y = nextY;\n\n      // Spltja \"prveana\"\n      const player = gameState.current;\n      const onPlatform = (\n        player.x + player.width > entity.x &&\n        player.x < entity.x + entity.width &&\n        Math.abs((player.y + player.height) - entity.y) < 5 &&\n        player.vy >= 0\n      );\n\n      if (onPlatform) {\n        player.x += entity.vx * (deltaMs / 16.6);\n        player.y = entity.y - player.height;\n        player.vy = 0;\n        player.isGrounded = true;\n        \n        // Atjauninam animciju, lai nebtu \"fall\" uz platformas\n        if (Math.abs(player.vx) > 0.1) {\n          player.animation = 'run';\n        } else {\n          player.animation = 'idle';\n        }\n      }\n\n      return entity;\n    }\n\n    const ai = def.ai || {};\n    const reactionDist = (ai.reactionDistance || 10) * TILE_SIZE;\n    const shootDist = (ai.shootDistance || 8) * TILE_SIZE;\n    const speed = def.speed || 1.2;\n\n    const dx = playerX - entity.x;\n    const dy = playerY - entity.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let keys = { a: false, d: false, w: false };\n\n    // 2. AI Uzvedba\n    if (dist < reactionDist) {\n      // Sekojam spltjam\n      if (dx > TILE_SIZE * 0.5) {\n          keys.d = true;\n          entity.direction = 1;\n      } else if (dx < -TILE_SIZE * 0.5) {\n          keys.a = true;\n          entity.direction = -1;\n      }\n\n      // Lkana, ja AI to atbalsta un priek ir rslis\n      if (ai.canJump && entity.isGrounded) {\n          const nextX = entity.x + entity.direction * 10;\n          if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n              keys.w = true;\n          }\n      }\n\n      // auana\n      if (dist < shootDist) {\n        if (entity.shootCooldown <= 0) {\n           const facingPlayer = (dx > 0 && entity.direction > 0) || (dx < 0 && entity.direction < 0);\n           // Tanks auj, ja skats uz spltju vai ja tas ir pietiekami tuvu\n           if (facingPlayer || dist < TILE_SIZE * 2) {\n             entity.isShooting = true;\n             entity.shootCooldown = ai.shootCooldown || 2000;\n             \n             // Izsaucam via izveidi\n             if (typeof spawnProjectile === 'function') {\n                // Novietojam viu rpus tanka korpusa (atkarb no virziena)\n                const spawnX = entity.x + (entity.width / 2) + (entity.direction * (entity.width / 2 + 10));\n                const spawnY = entity.y + (entity.height * 0.4); // Nedaudz augstk par centru (stobrs)\n                \n                spawnProjectile(\n                  spawnX, \n                  spawnY, \n                  entity.direction,\n                  entity.id\n                );\n             }\n           }\n        }\n      }\n    } else if (ai.patrol) {\n      // Patruanas rems\n      if (entity.direction > 0) keys.d = true;\n      else keys.a = true;\n\n    // Sienas un ru prbaude, lai grieztos atpaka\n    const nextX = entity.x + entity.direction * 10;\n    let hitSomething = checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height);\n\n    // Tanku specifisk kolzija (ar spltju un citiem tankiem)\n    if (!hitSomething && entity.subtype === 'tank') {\n      // 1. Prbaude ar spltju\n      const p = gameState.current;\n      if (nextX < p.x + p.width && nextX + entity.width > p.x && entity.y < p.y + p.height && entity.y + entity.height > p.y) {\n        hitSomething = true;\n      }\n\n      // 2. Prbaude ar citiem tankiem\n      if (!hitSomething) {\n        for (const other of entitiesRef.current) {\n          if (other === entity || other.health <= 0 || other.isExploding) continue;\n          if (other.subtype !== 'tank') continue;\n\n          if (nextX < other.x + other.width && nextX + entity.width > other.x && entity.y < other.y + other.height && entity.y + entity.height > other.y) {\n            hitSomething = true;\n            // Liekam ar otram tankam maint virzienu, ja tie brauc viens otram virs\n            if ((entity.direction > 0 && other.direction < 0) || (entity.direction < 0 && other.direction > 0)) {\n               other.direction *= -1;\n            }\n            break;\n          }\n        }\n      }\n    }\n\n    if (hitSomething) {\n      entity.direction *= -1;\n    }\n    \n    // Platformas malas prbaude\n      if (ai.stayOnPlatform && entity.isGrounded) {\n          const groundX = entity.x + (entity.direction > 0 ? entity.width : 0) + entity.direction * 5;\n          const groundY = entity.y + entity.height + 5;\n          if (!checkCollision(groundX, groundY, mapWidth, mapHeight, 2, 2)) {\n              entity.direction *= -1;\n          }\n      }\n    }\n\n    // Cooldown atjaunoana\n    if (entity.shootCooldown > 0) {\n      entity.shootCooldown -= deltaMs;\n      // Pc 300ms prtraucam auanas animciju\n      if (entity.shootCooldown < (ai.shootCooldown || 2000) - 300) {\n        entity.isShooting = false;\n      }\n    }\n\n    // 3. Fizika un kustba\n    const frameSpeed = speed * (deltaMs / 16.67);\n    \n    const checkEntityCollision = (nx, ny) => {\n        // Statisk pasaule\n        if (checkCollision(nx, ny, mapWidth, mapHeight, entity.width, entity.height)) return true;\n        \n        // Tankiem blojam ceu, ja priek ir spltjs vai cits tanks\n        if (entity.subtype === 'tank') {\n            const p = gameState.current;\n            if (nx < p.x + p.width && nx + entity.width > p.x && ny < p.y + p.height && ny + entity.height > p.y) return true;\n            \n            for (const other of entitiesRef.current) {\n                if (other === entity || other.health <= 0 || other.isExploding) continue;\n                if (other.subtype !== 'tank') continue;\n                if (nx < other.x + other.width && nx + entity.width > other.x && ny < other.y + other.height && ny + entity.height > other.y) return true;\n            }\n        }\n        return false;\n    };\n\n    const mh = moveHorizontal({\n      keys,\n      state: { \n        x: entity.x, \n        y: entity.y, \n        vx: entity.vx || 0,\n        width: entity.width, \n        direction: entity.direction \n      },\n      MOVE_SPEED: frameSpeed,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision\n    });\n    entity.x = mh.x;\n    entity.vx = mh.vx;\n    entity.direction = mh.direction;\n\n    const vp = applyVerticalPhysics({\n      keys,\n      x: entity.x,\n      y: entity.y,\n      vy: entity.vy,\n      isGrounded: entity.isGrounded,\n      animation: entity.animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE: ai.canJump ? 8 : 0,\n      TILE_SIZE,\n      width: entity.width,\n      height: entity.height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision,\n      isWaterAt: ctx.isWaterAt,\n      vx: entity.vx\n    });\n    entity.y = vp.y;\n    entity.vy = vp.vy;\n    entity.isGrounded = vp.isGrounded;\n\n    // 4. Animcijas stvoka noteikana\n    if (entity.isShooting) {\n      entity.animation = 'shoot';\n    } else if (entity.health <= (def.maxHealth || 100) * 0.5) {\n      entity.animation = 'move_damaged';\n    } else if (entity.vx === 0 && entity.isGrounded) {\n      entity.animation = 'idle';\n    } else {\n      entity.animation = 'move';\n    }\n\n    // Atjaunojam animcijas rmi, ja tas nav sprdziens\n    if (!entity.isExploding) {\n        const anims = def.spriteSheet?.animations || {};\n        let currentAnim = anims[entity.animation];\n        \n        // Rezerves varianti, ja specifisk animcija nav atrasta\n        if (!currentAnim || !Array.isArray(currentAnim) || currentAnim.length === 0) {\n            currentAnim = anims['move'] || anims['idle'] || [0];\n        }\n        \n        entity.animTimer = (entity.animTimer || 0) + deltaMs;\n        const frameDur = 100; // ms\n        if (entity.animTimer >= frameDur) {\n            entity.animTimer = 0;\n            entity.animFrame = (entity.animFrame || 0) + 1;\n            if (entity.animFrame >= currentAnim.length) {\n                entity.animFrame = 0;\n            }\n        }\n        entity.currentSpriteIndex = currentAnim[entity.animFrame % currentAnim.length];\n    } else {\n        const explodeAnim = def.spriteSheet?.animations?.explode || [39];\n        // Sprdziena animcija tiek vadta augstk (death sekcij)\n        entity.currentSpriteIndex = explodeAnim[Math.min(entity.animFrame, explodeAnim.length - 1)];\n    }\n\n    return entity;\n  }).filter(e => !e.shouldRemove);\n}\n","// Collision helpers (migrated from GameEngine/collision.js)\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile or an object)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve definitions\n// - secretData: secret layer array (ids)\n// - objectData: object layer array (ids)\n// - objectMetadata: metadata for objects (e.g. health)\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata) {\n  // Allow movement above the map\n  if (wy < 0) return false;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  // Out of world is not solid\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return false;\n  const index = gy * mapWidthTiles + gx;\n\n  // Check if this tile has a secret - secrets make tiles passable\n  if (secretData && secretData[index]) {\n    return false;\n  }\n\n  // 1. Check objects layer first (like the wooden box)\n  if (objectData && objectData[index]) {\n    const objId = objectData[index];\n    const objDef = registryItems.find(r => r.id === objId);\n    \n    // Ignorjam enttijas kolziju prbauds (tm ir sava fizika un ts nevajadztu uztvert k blokus)\n    // Prbaudm pc vairkm pazmm, lai btu droi\n    const isEntity = objDef && (\n      objDef.type === 'entity' || \n      objDef.subtype === 'tank' || \n      objDef.subtype === 'platform' ||\n      objDef.subtype === 'pushable' ||\n      objDef.isPushable ||\n      (objDef.name && objDef.name.toLowerCase().includes('entities.'))\n    );\n\n    if (objDef && objDef.collision && !isEntity) {\n      // Special logic for destructible objects like the wooden box\n      if (objDef.isDestructible && objectMetadata && objectMetadata[index]) {\n        const health = objectMetadata[index].health !== undefined ? objectMetadata[index].health : objDef.maxHealth;\n        const threshold = objDef.passableHealthThreshold || 0;\n        if (health <= threshold) {\n          return false; // Box is broken, can pass through\n        }\n      }\n      return true;\n    }\n  }\n\n  // 2. Check tiles layer\n  const tileId = tileData[index];\n  if (!tileId) return false;\n  const tileDef = registryItems.find(r => r.id === tileId);\n  if (!tileDef || !tileDef.collision) return false;\n  if (tileDef.collision === true) return true;\n  if (typeof tileDef.collision === 'object') {\n    return !!(\n      tileDef.collision.top ||\n      tileDef.collision.bottom ||\n      tileDef.collision.left ||\n      tileDef.collision.right\n    );\n  }\n  return false;\n}\n\n// AABB collision check for player rectangle at (newX, newY)\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData, objectData, objectMetadata) {\n  const points = [\n    { x: newX, y: newY }, // Top Left\n    { x: newX + width - 0.01, y: newY }, // Top Right\n    { x: newX, y: newY + height - 0.01 }, // Bottom Left\n    { x: newX + width - 0.01, y: newY + height - 0.01 } // Bottom Right\n  ];\n\n  for (let p of points) {\n    const gx = Math.floor(p.x / TILE_SIZE);\n    const gy = Math.floor(p.y / TILE_SIZE);\n    \n    // Boundary checks: block left, right, and top edges of the world.\n    // Allow falling off the bottom (gy >= mapHeightTiles).\n    if (gx < 0 || gx >= mapWidthTiles || gy < 0) return true;\n\n    if (isSolidAtPixel(p.x, p.y, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Gets physical properties of the surface below the player (friction, acceleration)\n */\nexport function getSurfaceProperties(x, y, width, height, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  const cx = x + width / 2;\n  const feetY = y + height + 1; // 1 pixel below feet\n  const gx = Math.floor(cx / TILE_SIZE);\n  const gy = Math.floor(feetY / TILE_SIZE);\n  \n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n    return { friction: 0.8, acceleration: 0.2 };\n  }\n  \n  const index = gy * mapWidthTiles + gx;\n  const tileId = tileData[index];\n  if (!tileId) return { friction: 0.8, acceleration: 0.2 };\n  \n  const tileDef = registryItems.find(r => r.id === tileId);\n  if (!tileDef) return { friction: 0.8, acceleration: 0.2 };\n  \n  // If block has slipperiness, use it. Default friction is 0.8.\n  const slipperiness = tileDef.slipperiness !== undefined ? tileDef.slipperiness : 0.8;\n  \n  return {\n    friction: slipperiness,\n    // When slippery, acceleration is lower (harder to start/change direction)\n    acceleration: tileDef.slipperiness !== undefined ? (1 - slipperiness) * 2 + 0.05 : 0.2\n  };\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n  getSurfaceProperties\n};\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal, getSurfaceProperties } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST,\n    MAX_ICE_RESIST\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret, objectMetadata\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret, objectMetadata) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        iceResist: MAX_ICE_RESIST,\n        maxIceResist: MAX_ICE_RESIST,\n        strength: 30,\n        maxStrength: 100,\n        lastPushTime: 0,\n        isWinning: false,\n        winCounter: 0,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n    const entitiesRef = useRef([]);                        // Active moving entities (tanks, etc.)\n\n    // Refs for props to avoid stale closures in the game loop\n    const onStateUpdateRef = useRef(onStateUpdate);\n    const onRevealSecretRef = useRef(onRevealSecret);\n    const onGameOverRef = useRef(onGameOver);\n    const objectMetadataRef = useRef(objectMetadata);\n    const revealedSecretsRef = useRef(revealedSecrets);\n\n    useEffect(() => { onStateUpdateRef.current = onStateUpdate; }, [onStateUpdate]);\n    useEffect(() => { onRevealSecretRef.current = onRevealSecret; }, [onRevealSecret]);\n    useEffect(() => { onGameOverRef.current = onGameOver; }, [onGameOver]);\n    useEffect(() => { objectMetadataRef.current = objectMetadata; }, [objectMetadata]);\n    useEffect(() => { revealedSecretsRef.current = revealedSecrets; }, [revealedSecrets]);\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef }, url, volume);\n    };\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecretRef.current) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecretsRef.current || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecretRef.current(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    const lastMapIdRef = useRef(null);\n\n    // Initialize player at starting position\n    useEffect(() => {\n        if (!mapData) {\n            isInitialized.current = false;\n            lastMapIdRef.current = null;\n            return;\n        }\n\n        // Unique identifier for the map session\n        // We use created_at/updated time or just the object reference itself if it's a completely new load\n        // In Game/index.jsx loadMapData creates a new object {...activeMapData} for reset.\n        const meta = mapData.meta || {};\n        const currentMapId = meta.date_map_last_updated || meta.date_map_created_at || mapData.name || 'default';\n        const isNewMapLoad = currentMapId !== lastMapIdRef.current;\n\n        // Ja sple jau ir inicializta UN t ir t pati karte, nemainm spltja pozciju\n        // Tas novr \"reset\" uz skumu, kad spltjs pace itemu (kas maina mapData atsauci, bet ne saturu)\n        // Ataujam prldi, ja enttiju saraksts ir tuks (drobai)\n        if (isInitialized.current && !isNewMapLoad && entitiesRef.current.length > 0) return;\n\n        lastMapIdRef.current = currentMapId;\n\n        // Reset state for new initialization\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        entitiesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapData.meta?.width || mapData.width || 20;\n            const mapH = mapData.meta?.height || mapData.height || 15;\n            \n            // Search for entities in objectData\n            const initialEntities = [];\n            if (objectData && Array.isArray(objectData)) {\n                objectData.forEach((id, idx) => {\n                    if (id && !id.includes('player')) {\n                        const def = findItemById(id) || registryItems.find(r => r.id === id);\n                        const isEntity = def && (\n                            def.type === 'entity' || \n                            def.subtype === 'tank' || \n                            def.subtype === 'platform' ||\n                            def.isPushable ||\n                            (def.name && def.name.toLowerCase().includes('entities.'))\n                        );\n\n                        if (isEntity) {\n                            initialEntities.push({\n                                id: `entity_${idx}_${Date.now()}_${idx}`,\n                                defId: id,\n                                def: def,\n                                x: (idx % mapW) * TILE_SIZE,\n                                y: Math.floor(idx / mapW) * TILE_SIZE,\n                                width: (Number(def.width) || 1) * TILE_SIZE,\n                                height: (Number(def.height) || 1) * TILE_SIZE,\n                                vx: 0,\n                                vy: 0,\n                                health: def.maxHealth || 100,\n                                direction: def.subtype === 'platform' ? 1 : (def.isPushable ? 1 : -1),\n                                animation: (def.subtype === 'platform' || def.isPushable) ? 'idle' : 'move',\n                                animFrame: 0,\n                                animTimer: 0,\n                                isGrounded: false,\n                                shootCooldown: 0,\n                                currentSpriteIndex: 0,\n                                subtype: def.subtype || (def.isPushable ? 'pushable' : null)\n                            });\n                        }\n                    }\n                });\n            }\n            entitiesRef.current = initialEntities;\n\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // Search for player (anything containing 'player')\n                const startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n\n                if (startIndex !== -1) {\n                    let startX = (startIndex % mapW) * TILE_SIZE;\n                    let startY = Math.floor(startIndex / mapW) * TILE_SIZE;\n\n                    // Get data from registry\n                    const playerId = objLayer.data[startIndex];\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: 0,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        strength: Number(registryPlayer?.strength) || 30,\n                        maxStrength: Number(registryPlayer?.maxStrength) || 100,\n                        lastPushTime: 0,\n                        isWinning: false,\n                        winCounter: 0\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    while (checkCollision(gameState.current.x, gameState.current.y, mapW, mapH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        strength: 30,\n                        maxStrength: 100,\n                        lastPushTime: 0\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST,\n                    strength: 30,\n                    maxStrength: 100,\n                    lastPushTime: 0\n                };\n                setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]); // objectData removed - item collection shouldn't trigger re-initialization\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mapWidth, mapHeightParam, widthOverride, heightOverride) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mapWidth,\n            mapHeightParam,\n            TILE_SIZE,\n            tileData,\n            registryItems,\n            widthOverride !== undefined ? widthOverride : gameState.current.width,\n            heightOverride !== undefined ? heightOverride : gameState.current.height,\n            secretData,\n            objectData,\n            objectMetadataRef.current || mapData?.meta?.objectMetadata\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE_OVERRIDE, tileDataOverride, registryItemsOverride, secretDataOverride, objectDataOverride, objectMetadataOverride) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mapWidthTiles,\n            mapHeightTiles,\n            TILE_SIZE_OVERRIDE || TILE_SIZE,\n            tileDataOverride || tileData,\n            registryItemsOverride || registryItems,\n            secretDataOverride || secretData,\n            objectDataOverride || objectData,\n            objectMetadataOverride || objectMetadataRef.current || mapData?.meta?.objectMetadata\n        );\n    };\n\n    // New: water presence check at a world pixel\n    const isWaterAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        // Strict: Only treat WATER as buoyant/swimmable in vertical physics\n        const liq = getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n        return !!(liq && liq.type === 'water');\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthTiles,\n            mapHeight: mapHeightTiles,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction, ownerId = 'player') => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction, ownerId);\n    };\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData,\n            input,\n            refs: { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef },\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            registryItems,\n            helpers: {\n                checkCollision,\n                getSurfaceProperties: (x, y, w, h, mw, mh, ts, td, ri) => getSurfaceProperties(x, y, w, h, mw, mh, ts, td, ri),\n                isWaterAt: (wx, wy) => isWaterAtPixel(wx, wy, (mapData?.meta?.width || mapData?.width || 20), (mapData?.meta?.height || mapData?.height || 15)),\n                getLiquidSample: ({ x, y, width, height, TILE_SIZE: TS, mapWidth, mapHeight }) =>\n                    sampleLiquid({ x, y, width, height }, (mapData?.meta?.width || mapData?.width || 20), (mapData?.meta?.height || mapData?.height || 15))\n            },\n            actions: {\n                collectItem: (x, y, mapWidth, objectLayer) =>\n                    collectItem({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState }, x, y, mapWidth, objectLayer),\n                checkInteractables: (x, y, mapWidth, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState, mapData }, x, y, mapWidth, objectLayer),\n                checkHazardDamage: (x, y, mapWidth, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidth, objectLayer, deltaMs),\n                checkSecrets: (x, y, width, height, mapWidth, mapHeight) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidth, mapHeight),\n                spawnProjectile: (originX, originY, direction, ownerId) =>\n                    spawnProjectile(originX, originY, direction, ownerId),\n                playSfx: (url, volume) => playShotSfx(url, volume),\n                updateProjectiles: (deltaMs, mapWidth, mapHeight) =>\n                    updateProjectiles({ \n                        projectilesRef, \n                        entitiesRef,\n                        playerState: gameState.current,\n                        TILE_SIZE, \n                        isSolidAtPixel, \n                        findItemById, \n                        objectData, \n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata, \n                        onStateUpdate: onStateUpdateRef.current\n                    }, deltaMs, mapWidth, mapHeight),\n                setPlayer: (next) => setPlayer(next),\n                onGameOver: onGameOverRef.current\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        if (!mapData) return;\n        requestRef.current = requestAnimationFrame(update);\n        return () => {\n            if (requestRef.current) cancelAnimationFrame(requestRef.current);\n        };\n    }, [mapData, objectData]); // Restart loop if map or objects change\n\n    return player;\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor(playerRight / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor(playerBottom / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = registryItems.find(r => r.id === objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight >= tileLeft && playerLeft <= tileRight;\n      const overlapsVertically = playerBottom >= tileTop && playerTop <= tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const distTop = Math.abs(playerBottom - tileTop);\n        const distBottom = Math.abs(tileBottom - playerTop);\n        const distLeft = Math.abs(playerRight - tileLeft);\n        const distRight = Math.abs(tileRight - playerLeft);\n        const min = Math.min(distTop, distBottom, distLeft, distRight);\n        touchingTop = (min === distTop);\n        touchingBottom = (!touchingTop && min === distBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === distLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction, ownerId = 'player') {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    ownerId, // Tagad ms zinm, kur izva\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag,\n    dmg: pDef?.damage || 10\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Item collection extracted from useGameEngine.js\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = registryItems.find(r => r.id === itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', index);\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', index);\n    return;\n  }\n}\n","// Interactables logic - objects that can be used once and change state\n// Unlike items (which disappear), interactables stay but change texture\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, mapData } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const objId = objectLayerData[index];\n  if (!objId) return;\n\n  const objDef = registryItems.find(r => r.id === objId);\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return;\n\n  // Check for Teleport logic\n  const metadata = mapData?.meta?.objectMetadata;\n  const currentMeta = metadata?.[index];\n  \n  if (objId.includes('portal') && currentMeta && currentMeta.triggerId !== undefined && currentMeta.triggerId !== null) {\n      // Find destination\n      for (let i = 0; i < objectLayerData.length; i++) {\n          if (i === index) continue;\n          const destId = objectLayerData[i];\n          if (destId && (destId.includes('target') || destId === 'portal_target')) {\n              const destMeta = metadata?.[i];\n              if (destMeta && destMeta.triggerId === currentMeta.triggerId) {\n                  // TELEPORT!\n                  const tx = (i % mapWidth) * TILE_SIZE;\n                  const ty = Math.floor(i / mapWidth) * TILE_SIZE;\n                  \n                  // Move player to target\n                  gameState.current.x = tx;\n                  gameState.current.y = ty;\n                  \n                  // Play sound\n                  try {\n                      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n                      playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n                  } catch {}\n\n                  // For teleport we don't necessarily mark as used if we want multi-use\n                  // but if the user wants it to disappear/change state, we can.\n                  // For now, let's just teleport.\n                  return;\n              }\n          }\n      }\n  }\n\n  // Check for End Level logic\n  if (objDef.subtype === 'end' && !gameState.current.isWinning) {\n    gameState.current.isWinning = true;\n    gameState.current.winCounter = 0;\n    gameState.current.winCountSpeed = objDef.winCountSpeed || 10;\n    return;\n  }\n\n  // Check if already used (track used interactables in gameState)\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (gameState.current.usedInteractables.has(index)) return; // Already used\n\n  // Check if has effect\n  if (!objDef.effect) return;\n\n  // Health effect\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return; // Don't use if already full health\n\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n\n    // Play sound\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    // Mark as used\n    gameState.current.usedInteractables.add(index);\n\n    // Notify state update with 'interactable' event - this will switch to next texture\n    if (onStateUpdate) onStateUpdate('interactable', index);\n    return;\n  }\n\n  // Future: Add other interactable effects (ammo, etc.)\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(index);\n    if (onStateUpdate) onStateUpdate('interactable', index);\n    return;\n  }\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, onStateUpdate }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, onStateUpdate } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      // Updated isSolidAtPixel call with all necessary layers\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight, TILE_SIZE, null, null, null, objectData, objectMetadata)) return true;\n    }\n    return false;\n  };\n\n  const checkObjectHit = (cx, cy, hw, hh) => {\n    if (!objectData) return null;\n    const pts = [\n        { x: cx - hw, y: cy - hh },\n        { x: cx + hw, y: cy - hh },\n        { x: cx - hw, y: cy + hh },\n        { x: cx + hw, y: cy + hh },\n        { x: cx, y: cy }\n    ];\n    for (const pt of pts) {\n        const gx = Math.floor(pt.x / TILE_SIZE);\n        const gy = Math.floor(pt.y / TILE_SIZE);\n        if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) continue;\n        const index = gy * mapWidth + gx;\n        const objId = objectData[index];\n        if (objId) {\n            const def = findItemById(objId);\n            if (def && def.isDestructible) {\n                // Check if already passable\n                const currentMeta = objectMetadata?.[index] || {};\n                const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                if (health > (def.passableHealthThreshold || 0)) {\n                    return index;\n                }\n            }\n        }\n    }\n    return null;\n  };\n\n  const checkEntityHit = (cx, cy, hw, hh, p) => {\n    if (!entitiesRef?.current) return null;\n    for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.id === p.ownerId) continue; // Ignorjam izvju\n\n        const ex = ent.x;\n        const ey = ent.y;\n        const ew = ent.width;\n        const eh = ent.height;\n        if (cx + hw > ex && cx - hw < ex + ew &&\n            cy + hh > ey && cy - hh < ey + eh) {\n            return ent;\n        }\n    }\n    return null;\n  };\n\n  const checkPlayerHit = (cx, cy, hw, hh, p) => {\n    if (!playerState || p.ownerId === 'player') return false; // Ignorjam, ja izva spltjs\n    \n    const ex = playerState.x;\n    const ey = playerState.y;\n    const ew = playerState.width || TILE_SIZE;\n    const eh = playerState.height || TILE_SIZE;\n    if (cx + hw > ex && cx - hw < ex + ew &&\n        cy + hh > ey && cy - hh < ey + eh) {\n        return true;\n    }\n    return false;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    let removed = false;\n\n    for (let s = 0; s < steps; s++) {\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n      \n      const hitPlayerX = checkPlayerHit(nextX, cy, hw, hh, p);\n      if (hitPlayerX) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate) onStateUpdate('playerDamage', { damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      const hitEntX = checkEntityHit(nextX, cy, hw, hh, p);\n      if (hitEntX) {\n        hitEntX.health -= p.dmg || 10;\n        removed = true;\n        break;\n      }\n\n      const hitIdxX = checkObjectHit(nextX, cy, hw, hh);\n      if (hitIdxX !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxX, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      \n      const hitPlayerY = checkPlayerHit(cx, nextY, hw, hh, p);\n      if (hitPlayerY) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate) onStateUpdate('playerDamage', { damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      const hitEntY = checkEntityHit(cx, nextY, hw, hh, p);\n      if (hitEntY) {\n        hitEntY.health -= p.dmg || 10;\n        removed = true;\n        break;\n      }\n\n      const hitIdxY = checkObjectHit(cx, nextY, hw, hh);\n      if (hitIdxY !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxY, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 110px;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 8px;\n`;\n\nconst BarsContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    width: 200px;\n`;\n\nconst BarWrapper = styled.div`\n    width: 100%;\n    height: 8px;\n    background-color: rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.4);\n    position: relative;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.3);\n`;\n\nconst BarFill = styled.div.attrs(props => ({\n    style: {\n        width: `${props.$percent}%`,\n        backgroundColor: props.$color,\n    },\n}))`\n    height: 100%;\n    transition: width 0.3s ease;\n`;\n\nconst BarLabel = styled.div`\n    position: absolute;\n    top: -12px;\n    left: 0;\n    font-size: 9px;\n    color: white;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px black;\n    pointer-events: none;\n    white-space: nowrap;\n    text-transform: uppercase;\n`;\n\nconst GameHeader = ({ \n    health, \n    maxHealth = 100, \n    ammo = 0, \n    oxygen = 100, \n    maxOxygen = 100, \n    lavaResist = 100, \n    maxLavaResist = 100,\n    iceResist = 100,\n    maxIceResist = 100,\n    strength = 30,\n    maxStrength = 100,\n    inWater = false,\n    liquidType = null,\n    onIce = false\n}) => {\n    const hpPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));\n    const oxyPercent = Math.max(0, Math.min(100, (oxygen / maxOxygen) * 100));\n    const lavaPercent = Math.max(0, Math.min(100, (lavaResist / maxLavaResist) * 100));\n    const icePercent = Math.max(0, Math.min(100, (iceResist / maxIceResist) * 100));\n    const strengthPercent = Math.max(0, Math.min(100, (strength / maxStrength) * 100));\n\n    const showOxy = inWater || liquidType === 'water' || oxyPercent < 100;\n    const showLava = liquidType === 'lava' || lavaPercent < 100;\n    const showIce = onIce || icePercent < 100;\n    const showStrength = strengthPercent > 30; // Rdt tikai kad sk augt vai ja gribam vienmr? \n    // Uzdevum teikts \"jpievieno vlviena lnija\", pieemsim ka rdm vienmr vai kad nepiecieams.\n    // Bet ja default ir 30%, tad varbt labk rdt vienmr.\n\n    return (\n        <HeaderContainer>\n            <AmmoDisplay>\n                 {ammo || 0}\n            </AmmoDisplay>\n\n            <RightSection>\n                <BarsContainer style={{ gap: '12px' }}>\n                    {/* HP Bar */}\n                    <BarWrapper>\n                        <BarLabel>HP: {Math.round(hpPercent)}%</BarLabel>\n                        <BarFill $percent={hpPercent} $color=\"#ff3232\" />\n                    </BarWrapper>\n\n                    {/* Oxygen Bar */}\n                    <BarWrapper>\n                        <BarLabel>O2: {Math.round(oxyPercent)}%</BarLabel>\n                        <BarFill $percent={oxyPercent} $color=\"#2ecdf1\" />\n                    </BarWrapper>\n\n                    {/* Lava Bar */}\n                    <BarWrapper>\n                        <BarLabel>LAVA: {Math.round(lavaPercent)}%</BarLabel>\n                        <BarFill $percent={lavaPercent} $color=\"#ffa229\" />\n                    </BarWrapper>\n\n                    {/* Ice Bar */}\n                    <BarWrapper>\n                        <BarLabel>ICE: {Math.round(icePercent)}%</BarLabel>\n                        <BarFill $percent={icePercent} $color=\"#a5f3fc\" />\n                    </BarWrapper>\n\n                    {/* Strength Bar */}\n                    <BarWrapper>\n                        <BarLabel>STRENGTH: {Math.round(strengthPercent)}%</BarLabel>\n                        <BarFill $percent={strengthPercent} $color=\"#eab308\" />\n                    </BarWrapper>\n                </BarsContainer>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    maxHealth: PropTypes.number,\n    ammo: PropTypes.number,\n    oxygen: PropTypes.number,\n    maxOxygen: PropTypes.number,\n    lavaResist: PropTypes.number,\n    maxLavaResist: PropTypes.number,\n    iceResist: PropTypes.number,\n    maxIceResist: PropTypes.number,\n    strength: PropTypes.number,\n    maxStrength: PropTypes.number,\n    inWater: PropTypes.bool,\n    liquidType: PropTypes.string,\n    onIce: PropTypes.bool\n};\n\nexport default GameHeader;","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Lava Embers</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaEmbersEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaEmbersEnabled(v);\n              try { localStorage.setItem('game_fx_lava_embers', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaEmbersEnabled: v });\n            }}\n          />\n        </div>\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6 }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.ogg$/);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n    } catch {}\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, updateObjectAtIndex, updateObjectMetadata, setObjectTextureIndex, revealSecretZone, resetGame } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport { setSoundEnabled } from '../../../store/slices/settingsSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\n\n// Import maps (static files usually need to be imported or fetched in React/Webpack)\nimport map1 from '../../../assets/maps/Areas.json';\nimport map9 from '../../../assets/maps/Temp_01.json';\n\n\n// Simulate file list from folder\nconst BUILT_IN_MAPS = [map1, map9];\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 1000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 500px;\n    max-height: 80%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 6px;\n    padding: 10px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n\n    &:hover {\n        background-color: #e8e8e8;\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapInfo = styled.div`\n    text-align: right;\n    font-size: 11px;\n    color: #555;\n`;\n\nconst WinCounterOverlay = styled.div`\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 120px;\n    font-weight: bold;\n    color: #fff;\n    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,255,255,0.5);\n    z-index: 2000;\n    pointer-events: none;\n    font-family: 'Courier New', Courier, monospace;\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    overflow: hidden;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nexport default function Game() {\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n    const player = useSelector(state => state.player); // Ensure this isn't undefined\n\n    // Redux state\n    const { activeMapData, tileMapData, objectMapData, secretMapData, objectMetadata, revealedSecrets, objectTextureIndices, mapWidth, mapHeight } = useSelector(state => state.game);\n    const { isMapModalOpen, cameraScrollX, shouldCenterMap } = useSelector(state => state.ui);\n    const { sound } = useSelector(state => state.settings);\n    const soundEnabled = sound.enabled;\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        // Reload current map using Redux\n        if (activeMapData) {\n            console.log(\"Game Over! Reloading map...\");\n            // Pievienojam timestamp, lai dzinjs zintu, ka is ir restarts/jauna ielde\n            const mapToLoad = {\n                ...activeMapData,\n                meta: {\n                    ...activeMapData.meta,\n                    date_map_last_updated: new Date().toISOString()\n                }\n            };\n            loadMapData(mapToLoad);\n        }\n    };\n\n    const handleStateUpdate = useCallback((action, payload) => {\n        if (action === 'collectItem') {\n            const indexToRemove = payload;\n            dispatch(removeObjectAtIndex(indexToRemove));\n        } else if (action === 'interactable') {\n            const index = payload;\n            // Switch interactable to \"used\" variant by changing ID\n            // e.g., berry_bush_01 -> berry_bush_01_used\n            const currentId = objectMapData[index];\n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used' }));\n            }\n        } else if (action === 'objectDamage') {\n            const { index, damage } = payload;\n            const objId = objectMapData[index];\n            if (objId) {\n                const def = registryItems.find(r => r.id === objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata[index] || {};\n                    const maxH = def.maxHealth || 100;\n                    const newHealth = Math.max(0, (currentMeta.health !== undefined ? currentMeta.health : maxH) - damage);\n                    dispatch(updateObjectMetadata({ index, metadata: { health: newHealth } }));\n                }\n            }\n        } else if (action === 'playerDamage' && payload !== undefined) {\n            // eit ms nevaram viegli atjaunint Redux katr kadr,\n            // bet varam atskaot trpjuma skau\n            console.log(\"Player hit by entity!\");\n        } else if (action === 'levelWin') {\n            console.log(\"Level Win! Returning to map selection.\");\n            setTimeout(() => {\n                alert(\"Level Complete!\");\n                dispatch(setMapModalOpen(true));\n            }, 500);\n        }\n    }, [dispatch, objectMapData, objectMetadata, registryItems]);\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const playerState = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata\n    );\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => dispatch(setMapModalOpen(true));\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            const w = mapData.meta?.width || mapData.width || 20;\n            const h = mapData.meta?.height || mapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (mapData.layers) {\n                const bgLayer = mapData.layers.find(l => l.name === 'background');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = mapData.layers.find(l => l.name === 'entities');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = mapData.layers.find(l => l.name === 'secrets');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = mapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Debug logging\n            console.log('[DEBUG] Loading map with secrets:', {\n                hasSecretsLayer: !!mapData.layers?.find(l => l.name === 'secrets'),\n                secretDataLength: secretData?.length,\n                secretDataNonNull: secretData?.filter(s => s !== null).length,\n                secretDataSample: secretData?.filter(s => s !== null).slice(0, 5)\n            });\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: mapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    return (\n        <GameContainer>\n        \n            {/* Game Header */}\n            {/* UI Overlays */}\n            {playerState?.isWinning && (\n                <WinCounterOverlay>\n                    {Math.floor(playerState.winCounter || 0)}\n                </WinCounterOverlay>\n            )}\n\n            <GameHeader \n                health={playerState.health} \n                maxHealth={playerState.maxHealth}\n                ammo={playerState.ammo || 0} \n                oxygen={playerState.oxygen}\n                maxOxygen={playerState.maxOxygen}\n                lavaResist={playerState.lavaResist}\n                maxLavaResist={playerState.maxLavaResist}\n                iceResist={playerState.iceResist}\n                maxIceResist={playerState.maxIceResist}\n                strength={playerState.strength}\n                maxStrength={playerState.maxStrength}\n                inWater={playerState.inWater}\n                liquidType={playerState.liquidType}\n                onIce={playerState.onIce}\n            />\n\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>Select a Map</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => (\n                                <MapCard key={index} onClick={() => loadMapData(map)}>\n                                    <div>\n                                        <MapTitle>{map.meta?.name || \"Unnamed Map\"}</MapTitle>\n                                        <MapAuthor>By: {map.meta?.author || \"Unknown\"}</MapAuthor>\n                                    </div>\n                                    <MapInfo>\n                                        <div>Size: {map.meta?.width}x{map.meta?.height}</div>\n                                    </MapInfo>\n                                </MapCard>\n                            ))}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 Load Custom Map from Computer\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                            isEditor={false}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer metaPath={activeMapData?.meta?.backgroundMusic} enabled={soundEnabled} volume={0.6} />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = [];\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.push(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, getCurrentData, setCurrentData, mapWidth, mapHeight) => {\n    const currentData = getCurrentData();\n    const startId = currentData[startIndex];\n    if (startId === targetId) return;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    setCurrentData(newData);\n};\n\nexport const paintTile = (index, selectedTile, brushSize, mapWidth, mapHeight, getCurrentData, setCurrentData) => {\n    const currentData = getCurrentData();\n    const newData = [...currentData];\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                newData[targetIndex] = selectedTile ? selectedTile.id : null;\n            }\n        }\n    }\n    setCurrentData(newData);\n};\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className, spriteSheet }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    // Ja ir spraitts, rdm tikai pirmo kadru (vai citu, ja nordts)\n    if (spriteSheet && spriteSheet.enabled) {\n        const columns = spriteSheet.columns || 1;\n        const total = spriteSheet.totalSprites || 1;\n        const rows = Math.ceil(total / columns);\n        \n        // Editor parasti rdm pirmo kadru (index 0)\n        const frameIndex = 0;\n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n\n        return (\n            <div className={className} style={{\n                ...style,\n                overflow: 'hidden',\n                display: 'inline-block',\n                width: style?.width || '32px',\n                height: style?.height || '32px',\n                position: 'relative'\n            }}>\n                <img\n                    src={imgSrc}\n                    alt={alt || ''}\n                    style={{\n                        position: 'absolute',\n                        width: `${columns * 100}%`,\n                        height: `${rows * 100}%`,\n                        left: `-${col * 100}%`,\n                        top: `-${row * 100}%`,\n                        maxWidth: 'none',\n                        maxHeight: 'none',\n                        display: 'block'\n                    }}\n                    draggable={false}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false}\n        />\n    );\n};\n\nexport default AnimatedItem;","import React from 'react';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    registryItems,\n    hoverIndex,\n    highlightedIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    setIsDragging\n}) => {\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => setIsDragging(false)}>\n            <div style={{ position: 'relative', width: 'fit-content' }} onMouseLeave={handleGridMouseLeave}>\n                {/* Visual links between portals and targets */}\n                <svg style={{\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    width: mapWidth * 32,\n                    height: mapHeight * 32,\n                    zIndex: 10,\n                    pointerEvents: 'none',\n                    opacity: 0.6\n                }}>\n                    {(() => {\n                        const links = [];\n                        const portals = [];\n                        const targets = [];\n\n                        // Collect all portals and targets with Trigger IDs\n                        objectMapData.forEach((id, index) => {\n                            if (!id) return;\n                            const metadata = objectMetadata?.[index];\n                            if (!metadata || metadata.triggerId === undefined || metadata.triggerId === null) return;\n\n                            const x = (index % mapWidth) * 32 + 16;\n                            const y = Math.floor(index / mapWidth) * 32 + 16;\n\n                            if (id.includes('portal') && !id.includes('target')) {\n                                portals.push({ x, y, id: metadata.triggerId });\n                            } else if (id.includes('target') || id === 'portal_target') {\n                                targets.push({ x, y, id: metadata.triggerId });\n                            }\n                        });\n\n                        // Draw lines between matching IDs\n                        portals.forEach(p => {\n                            targets.forEach(t => {\n                                if (p.id === t.id) {\n                                    links.push(\n                                        <line\n                                            key={`link-${p.x}-${p.y}-${t.x}-${t.y}`}\n                                            x1={p.x} y1={p.y}\n                                            x2={t.x} y2={t.y}\n                                            stroke=\"#fff\"\n                                            strokeWidth=\"2\"\n                                            strokeDasharray=\"5,5\"\n                                        />\n                                    );\n                                }\n                            });\n                        });\n                        return links;\n                    })()}\n                </svg>\n\n                {/* Background preview layer */}\n                <div\n                    style={{\n                        position: 'absolute',\n                        top: 0,\n                        left: 0,\n                        width: mapWidth * 32,\n                        height: mapHeight * 32,\n                        backgroundImage: selectedBackgroundUrl ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: !selectedBackgroundUrl ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x',\n                        backgroundSize: 'auto 100%',\n                        zIndex: 0,\n                        pointerEvents: 'none'\n                    }}\n                />\n                <div className=\"grid\"\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px',\n                        border: '1px solid #444',\n                        backgroundColor: 'transparent',\n                        position: 'relative',\n                        cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        // Check if this tile is in preview selection area\n                        let displayTileId = tileMapData[index];\n                        let displayObjectId = objectMapData[index];\n                        let displaySecretId = secretMapData?.[index];\n\n                        // If we have a preview position, check if this tile should show selection content\n                        if (selection && previewPosition) {\n                            const selX = previewPosition.x;\n                            const selY = previewPosition.y;\n\n                            if (x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                                // This tile is in the preview selection area\n                                const offsetX = x - selX;\n                                const offsetY = y - selY;\n                                const selectionIndex = offsetY * selection.w + offsetX;\n\n                                displayTileId = selection.tileData[selectionIndex];\n                                displayObjectId = selection.objectData[selectionIndex];\n                                displaySecretId = selection.secretData?.[selectionIndex];\n                            }\n                        }\n\n                        const tileObj = displayTileId ? registryItems.find(r => r.id === displayTileId) : null;\n                        const objObj = displayObjectId ? registryItems.find(r => r.id === displayObjectId) : null;\n                        const secretObj = displaySecretId ? registryItems.find(r => r.id === displaySecretId) : null;\n\n                        let isSelected = false;\n                        let isPreviewSelection = false;\n\n                        // Use previewPosition if available, otherwise use selection.x/y\n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            isSelected = true;\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                isPreviewSelection = true;\n                            }\n                        }\n\n                        let isMoveSelecting = false;\n                        let isMoveHover = false;\n                        if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const sx = dragStart.x;\n                                const sy = dragStart.y;\n                                const minX = Math.min(sx, hx);\n                                const minY = Math.min(sy, hy);\n                                const maxX = Math.max(sx, hx);\n                                const maxY = Math.max(sy, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) isMoveSelecting = true;\n                            } else if (!isDragging && hoverIndex === index) {\n                                isMoveHover = true;\n                            }\n                        }\n\n                        let isBrushTarget = false;\n                        if ((activeTool === 'brush') && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) isBrushTarget = true;\n                        }\n\n                        let isBucketTarget = false;\n                        let isBucketPreview = false;\n                        if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) isBucketPreview = true;\n                            else if (hoverIndex === index) isBucketTarget = true;\n                        }\n\n                        let borderStyle = showGrid ? '0.5px solid rgba(128,128,128,0.5)' : 'none';\n                        let bgStyle = 'transparent';\n                        const isHighlighted = highlightedIndex === index;\n\n                        const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n                        const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n                        const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n\n                        if (isBrushTarget) borderStyle = '2px solid red';\n                        else if (isBucketPreview) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                        else if (isBucketTarget) borderStyle = '2px solid orange';\n                        else if (isMoveHover) borderStyle = '2px solid blue';\n                        else if (isMoveSelecting) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                        else if (isHighlighted) { borderStyle = '3px solid gold'; bgStyle = 'rgba(255, 215, 0, 0.4)'; }\n                        else if (isSelected) {\n                            if (isPreviewSelection) {\n                                borderStyle = '2px solid cyan';\n                                bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red';\n                                bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n                        else if (!showGrid) borderStyle = 'none';\n\n                        let backgroundStyleObj = {};\n                        if (bgStyle !== 'transparent') {\n                            backgroundStyleObj.backgroundColor = bgStyle;\n                        } else if (isLiquidTile) {\n                            if (isWaterTile) {\n                                backgroundStyleObj.background = 'linear-gradient(180deg, #2a5d8f, #174369)';\n                            } else if (isLavaTile) {\n                                backgroundStyleObj.background = 'linear-gradient(180deg, #6b1a07, #c43f0f)';\n                            } else {\n                                backgroundStyleObj.background = 'linear-gradient(180deg, #3a3a3a, #1e1e1e)';\n                            }\n                        }\n\n                        return (\n                            <div key={index}\n                                onMouseDown={(e) => handleGridMouseDown(index, e)}\n                                onMouseEnter={() => handleGridMouseEnter(index)}\n                                onMouseUp={() => handleGridMouseUp(index)}\n                                style={{\n                                    width: '32px', height: '32px', border: borderStyle,\n                                    zIndex: (isBrushTarget || isBucketTarget || isBucketPreview || isMoveHover || isMoveSelecting) ? 20 : (isSelected ? 15 : 1),\n                                    boxSizing: 'border-box', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative',\n                                    ...backgroundStyleObj\n                                }}>\n                                {/* Background Layer (Tiles) */}\n                                {tileObj && (\n                                    tileObj.editorIcon ? (\n                                        <div style={{ position: 'absolute', zIndex: 2, fontSize: '20px', fontWeight: 'bold' }}>\n                                            {tileObj.editorIcon}\n                                        </div>\n                                    ) : (\n                                        <AnimatedItem\n                                            textures={tileObj.textures}\n                                            texture={tileObj.texture}\n                                            speed={tileObj.animationSpeed}\n                                            spriteSheet={tileObj.spriteSheet}\n                                            style={{ position: 'absolute', width: '100%', height: '100%', objectFit: 'contain', zIndex: 2 }}\n                                        />\n                                    )\n                                )}\n\n                                {/* Foreground Layer (Objects) */}\n                                {objObj && (\n                                    <div style={{ position: 'absolute', width: '100%', height: '100%', zIndex: 3, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                                        {objObj.editorIcon ? (\n                                            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#fff', textShadow: '0 0 4px #000' }}>\n                                                {objObj.editorIcon}\n                                            </div>\n                                        ) : (\n                                            <AnimatedItem\n                                                textures={objObj.textures}\n                                                texture={objObj.texture}\n                                                speed={objObj.animationSpeed}\n                                                spriteSheet={objObj.spriteSheet}\n                                                style={{ width: '100%', height: '100%', objectFit: 'contain' }}\n                                            />\n                                        )}\n                                        {/* Render Trigger ID if present */}\n                                        {objectMetadata && objectMetadata[index] && objectMetadata[index].triggerId !== undefined && objectMetadata[index].triggerId !== null && (\n                                            <div style={{\n                                                position: 'absolute',\n                                                top: '-15px',\n                                                left: '50%',\n                                                transform: 'translateX(-50%)',\n                                                backgroundColor: 'rgba(0,0,0,0.7)',\n                                                color: '#fff',\n                                                padding: '1px 4px',\n                                                borderRadius: '3px',\n                                                fontSize: '10px',\n                                                whiteSpace: 'nowrap',\n                                                zIndex: 10,\n                                                border: '1px solid #fff'\n                                            }}>\n                                                ID: {objectMetadata[index].triggerId}\n                                            </div>\n                                        )}\n                                    </div>\n                                )}\n\n                                {/* Secret Layer (Dark Filter) */}\n                                {secretObj && (\n                                    <div style={{\n                                        position: 'absolute',\n                                        width: '100%',\n                                        height: '100%',\n                                        background: secretObj.filterColorInEditor || secretObj.filterColor || 'rgba(0, 0, 0, 0.5)',\n                                        zIndex: 4,\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center',\n                                        fontSize: '8px',\n                                        color: 'rgba(255, 255, 255, 0.6)',\n                                        fontWeight: 'bold',\n                                        pointerEvents: 'none'\n                                    }}>\n                                        {secretObj.editorIcon || '?'}\n                                    </div>\n                                )}\n\n                                <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', zIndex: 10 }} />\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","export const baseButtonStyle = {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    border: '1px solid #333',\n    padding: '0 10px',\n    height: '28px',\n    backgroundColor: '#e0e0e0',\n    marginRight: '5px',\n    marginBottom: '5px',\n    fontSize: '13px',\n    color: '#000',\n    borderRadius: '3px',\n    userSelect: 'none',\n    minWidth: '30px',\n    boxSizing: 'border-box',\n    textDecoration: 'none',\n    lineHeight: 'normal'\n};\n\nexport const buttonStyle = { ...baseButtonStyle };\n\nexport const activeButtonStyle = {\n    ...baseButtonStyle,\n    backgroundColor: '#aaa',\n    borderColor: '#000',\n    fontWeight: 'bold'\n};\n","import React from 'react';\nimport { buttonStyle } from './constants';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', padding: '20px', borderRadius: '8px',\n                boxShadow: '0 4px 6px rgba(0,0,0,0.1)', width: '300px',\n                display: 'flex', flexDirection: 'column', gap: '10px'\n            }}>\n                <h3 style={{ marginTop: 0 }}>Create New Map</h3>\n\n                <div>\n                    <label style={{ display: 'block', fontSize: '12px', marginBottom: '4px' }}>Map Name:</label>\n                    <input\n                        type=\"text\"\n                        value={tempMapName}\n                        onChange={(e) => setTempMapName(e.target.value)}\n                        style={{ width: '100%', padding: '5px', boxSizing: 'border-box' }}\n                    />\n                </div>\n\n                <div>\n                    <label style={{ display: 'block', fontSize: '12px', marginBottom: '4px' }}>Creator Nickname:</label>\n                    <input\n                        type=\"text\"\n                        value={tempCreatorName}\n                        onChange={(e) => setTempCreatorName(e.target.value)}\n                        style={{ width: '100%', padding: '5px', boxSizing: 'border-box' }}\n                    />\n                </div>\n\n                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                    <button onClick={onClose} style={{ ...buttonStyle, backgroundColor: '#f0f0f0' }}>Cancel</button>\n                    <button onClick={confirmNewMap} style={{ ...buttonStyle, backgroundColor: '#4CAF50', color: 'white', borderColor: '#4CAF50' }}>Create</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const [position] = useState(defaultPosition);\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    const lastHeightRef = useRef(0);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            if (height !== lastHeightRef.current) {\n                lastHeightRef.current = height;\n                onHeightChange(height);\n            }\n        }\n    });\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#f8f8f8',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n                zIndex: 10,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '8px 10px',\n                    backgroundColor: '#e0e0e0',\n                    borderTopLeftRadius: '4px',\n                    borderTopRightRadius: '4px',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '13px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '1px solid #ccc'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '4px' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#ffc107',\n                            border: 'none',\n                            borderRadius: '2px',\n                            width: '18px',\n                            height: '18px',\n                            cursor: 'pointer',\n                            fontSize: '12px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title={isMinimized ? \"Maximize\" : \"Minimize\"}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f44336',\n                            border: 'none',\n                            borderRadius: '2px',\n                            width: '18px',\n                            height: '18px',\n                            cursor: 'pointer',\n                            color: '#fff',\n                            fontSize: '12px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title=\"Close\"\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '10px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const PaletteSection = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '8px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.water) {\n                                ctx.fillStyle = '#2a5d8f';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#c43f0f';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n        // Draw connections between portals and targets\n        if (objectMetadata) {\n            const portals = [];\n            const targets = [];\n\n            for (let i = 0; i < mapWidth * mapHeight; i++) {\n                const id = objectMapData[i];\n                if (!id) continue;\n                const metadata = objectMetadata[i];\n                if (!metadata || metadata.triggerId === null || metadata.triggerId === undefined) continue;\n\n                const pos = {\n                    x: (i % mapWidth) * tileWidth + tileWidth / 2,\n                    y: Math.floor(i / mapWidth) * tileHeight + tileHeight / 2\n                };\n\n                if (id.includes('portal') && !id.includes('target')) {\n                    portals.push({ triggerId: metadata.triggerId, pos });\n                } else if (id.includes('target') || id === 'portal_target') {\n                    targets.push({ triggerId: metadata.triggerId, pos });\n                }\n            }\n\n            portals.forEach(portal => {\n                const target = targets.find(t => t.triggerId === portal.triggerId);\n                if (target) {\n                    ctx.beginPath();\n                    ctx.setLineDash([5, 3]);\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.moveTo(portal.pos.x, portal.pos.y);\n                    ctx.lineTo(target.pos.x, target.pos.y);\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n                }\n            });\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, objectMetadata, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\n\nexport const MapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(5, Math.min(100, startSize.width + blocksX));\n            const newHeight = Math.max(5, Math.min(100, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                Map Size: <span style={{ color: '#4CAF50' }}>{mapWidth}  {mapHeight}</span> blocks\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: -5,\n                        right: -5,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 Drag the corner to resize the map<br/>\n                (Min: 55, Max: 100100)\n            </div>\n        </div>\n    );\n};\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { DraggableWindow } from './DraggableWindow';\nimport { PaletteSection } from './PaletteSection';\nimport { Minimap } from './Minimap';\nimport { MapResizer } from './MapResizer';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { buttonStyle, activeButtonStyle } from './constants';\n\nexport const ToolbarWindows = ({\n    mapName,\n    creatorName,\n    openNewMapModal,\n    saveMap,\n    loadMap,\n    showGrid,\n    setShowGrid,\n    clearMap,\n    isPlayMode,\n    handlePlay,\n    handlePause,\n    handleReset,\n    activeTool,\n    setActiveTool,\n    brushSize,\n    setBrushSize,\n    activeLayer,\n    selection,\n    moveSelection,\n    setSelection,\n    selectionMode,\n    setSelectionMode,\n    commitSelection,\n    cancelSelection,\n    selectedTile,\n    handlePaletteSelect,\n    blocks,\n    liquids,\n    entities,\n    items,\n    decorations,\n    interactables,\n    hazards,\n    secrets,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    setObjectMetadata,\n    registryItems,\n    onMapResize,\n    highlightedIndex,\n    setHighlightedIndex\n}) => {\n    const [activePanel, setActivePanel] = useState(null); // 'map', 'tools', 'palette', 'bg', 'stats', 'props'\n    const [isMinimapOpen, setIsMinimapOpen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n\n    const togglePanel = (panel) => {\n        setActivePanel(prev => prev === panel ? null : panel);\n    };\n\n    const sidebarButtonStyle = {\n        width: '40px',\n        height: '40px',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        cursor: 'pointer',\n        backgroundColor: '#333',\n        color: '#fff',\n        border: '1px solid #444',\n        borderRadius: '4px',\n        marginBottom: '10px',\n        fontSize: '20px',\n        transition: 'all 0.2s ease',\n        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n    };\n\n    const activeSidebarButtonStyle = {\n        ...sidebarButtonStyle,\n        backgroundColor: '#2196F3',\n        borderColor: '#1E88E5',\n        transform: 'scale(1.05)'\n    };\n\n    const panelStyle = {\n        position: 'absolute',\n        top: 0,\n        left: '60px',\n        width: '320px',\n        height: '100%',\n        backgroundColor: '#fff',\n        boxShadow: '2px 0 10px rgba(0,0,0,0.2)',\n        zIndex: 100,\n        display: 'flex',\n        flexDirection: 'column',\n        borderRight: '1px solid #ddd',\n        overflowY: 'auto',\n        padding: '20px',\n        boxSizing: 'border-box'\n    };\n\n    const rightSidebarStyle = {\n        position: 'absolute',\n        top: '20px',\n        right: '20px',\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '10px',\n        zIndex: 101\n    };\n\n    const panelHeaderStyle = {\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        marginBottom: '15px',\n        borderBottom: '2px solid #eee',\n        paddingBottom: '10px'\n    };\n\n    const panelTitleStyle = {\n        margin: 0,\n        fontSize: '18px',\n        fontWeight: 'bold',\n        color: '#333'\n    };\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const editorIcon = item.editorIcon;\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isSecret = item.type === 'secret';\n        const swatchStyle = isWater\n            ? { background: 'linear-gradient(180deg,#2a5d8f,#174369)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#6b1a07,#c43f0f)' } : { background: '#eee' });\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColorInEditor || item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.editorIcon || (item.subtype === 'above' ? 'ABOVE' : 'BELOW')}\n                    </div>\n                ) : editorIcon ? (\n                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>\n                        {editorIcon}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        spriteSheet={item.spriteSheet}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid ? (isWater ? 'WATER' : (isLava ? 'LAVA' : 'LIQ')) : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    const BlockEraser = () => (\n        <div onClick={() => { handlePaletteSelect(null, 'tile'); }} title=\"Erase Blocks (Background)\"\n            style={{\n                border: (selectedTile === null && activeLayer === 'tile') ? `2px solid blue` : '1px solid #ccc',\n                cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\n                backgroundColor: '#f0f8ff', fontSize: '16px', color: 'blue'\n            }}>\n            B\n        </div>\n    );\n\n    const ObjectEraser = () => (\n        <div onClick={() => { handlePaletteSelect(null, 'object'); }} title=\"Erase Objects (Entities/Items)\"\n            style={{\n                border: (selectedTile === null && activeLayer === 'object') ? `2px solid red` : '1px solid #ccc',\n                cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\n                backgroundColor: '#fff0f0', fontSize: '16px', color: 'red'\n            }}>\n            O\n        </div>\n    );\n\n    const SecretEraser = () => (\n        <div onClick={() => { handlePaletteSelect(null, 'secret'); }} title=\"Erase Secrets\"\n            style={{\n                border: (selectedTile === null && activeLayer === 'secret') ? `2px solid purple` : '1px solid #ccc',\n                cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\n                backgroundColor: '#f8f0ff', fontSize: '16px', color: 'purple'\n            }}>\n            S\n        </div>\n    );\n\n\n    return (\n        <div style={{ display: 'contents' }}>\n            {/* Sidebar Left */}\n            <div style={{\n                width: '60px',\n                height: '100%',\n                backgroundColor: '#222',\n                display: 'flex',\n                flexDirection: 'column',\n                alignItems: 'center',\n                paddingTop: '20px',\n                zIndex: 102,\n                borderRight: '1px solid #000',\n                flexShrink: 0\n            }}>\n                <div onClick={() => togglePanel('map')} style={activePanel === 'map' ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Map Controls\"></div>\n                <div onClick={() => togglePanel('tools')} style={activePanel === 'tools' ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Tools\"></div>\n                <div onClick={() => togglePanel('palette')} style={activePanel === 'palette' ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Palette\"></div>\n                <div onClick={() => togglePanel('bg')} style={activePanel === 'bg' ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Background & Music\"></div>\n                <div onClick={() => togglePanel('stats')} style={activePanel === 'stats' ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Statistics\"></div>\n                <div onClick={() => togglePanel('props')} style={activePanel === 'props' ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Object Properties\"></div>\n            </div>\n\n            {/* Panels */}\n            {activePanel === 'map' && (\n                <div style={panelStyle}>\n                    <div style={panelHeaderStyle}>\n                        <h3 style={panelTitleStyle}>Map Controls</h3>\n                        <button onClick={() => setActivePanel(null)} style={{ ...buttonStyle, margin: 0 }}></button>\n                    </div>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\n                        <div style={{ padding: '10px', backgroundColor: '#f9f9f9', borderRadius: '4px', border: '1px solid #ddd' }}>\n                            <div style={{ fontSize: '13px', marginBottom: '5px' }}>Map: <strong>{mapName}</strong></div>\n                            <div style={{ fontSize: '13px' }}>Author: <strong>{creatorName}</strong></div>\n                        </div>\n\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>\n                            <button onClick={openNewMapModal} style={{ ...buttonStyle, backgroundColor: '#4CAF50', color: '#fff', borderColor: '#388E3C', flex: '1' }}>New</button>\n                            <button onClick={saveMap} style={{ ...buttonStyle, flex: '1' }}>Save</button>\n                            <label style={{ ...buttonStyle, flex: '1' }}>Load <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} /></label>\n                        </div>\n                        \n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>\n                            <button onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} style={{ ...(isResizeWindowOpen ? activeButtonStyle : buttonStyle), flex: '1' }} title=\"Resize Map\"> Resize</button>\n                            <button onClick={() => setShowGrid(!showGrid)} style={{ ...(showGrid ? activeButtonStyle : buttonStyle), flex: '1' }}>{showGrid ? 'Hide Grid' : 'Show Grid'} #</button>\n                            <button onClick={clearMap} style={{ ...buttonStyle, color: 'red', flex: '1' }} title=\"Clear Map\"> Clear</button>\n                        </div>\n\n                        <div style={{ borderTop: '2px solid #eee', paddingTop: '15px', marginTop: '5px' }}>\n                            <div style={{ fontSize: '14px', fontWeight: 'bold', marginBottom: '10px' }}>PLAY MODE</div>\n                            <div style={{ display: 'flex', gap: '8px' }}>\n                                {!isPlayMode ? (\n                                    <button onClick={handlePlay} style={{ ...buttonStyle, backgroundColor: '#4CAF50', color: '#fff', borderColor: '#388E3C', flex: '1', height: '40px', fontSize: '16px' }} title=\"Play from current position\"> Play</button>\n                                ) : (\n                                    <>\n                                        <button onClick={handlePause} style={{ ...buttonStyle, backgroundColor: '#FF9800', color: '#fff', borderColor: '#F57C00', flex: '1', height: '40px' }} title=\"Pause and return to editor\"> Pause</button>\n                                        <button onClick={handleReset} style={{ ...buttonStyle, backgroundColor: '#2196F3', color: '#fff', borderColor: '#1976D2', flex: '1', height: '40px' }} title=\"Reset collected objects\"> Reset</button>\n                                    </>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {activePanel === 'tools' && (\n                <div style={panelStyle}>\n                    <div style={panelHeaderStyle}>\n                        <h3 style={panelTitleStyle}>Tools & Erase</h3>\n                        <button onClick={() => setActivePanel(null)} style={{ ...buttonStyle, margin: 0 }}></button>\n                    </div>\n                    {isPlayMode ? (\n                        <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                            Tools disabled during Play mode\n                        </div>\n                    ) : (\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n                            <section>\n                                <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '10px', color: '#555' }}>DRAWING TOOLS</span>\n                                <div style={{ display: 'flex', gap: '10px' }}>\n                                    <button onClick={() => setActiveTool('brush')} style={{ ...(activeTool === 'brush' ? activeButtonStyle : buttonStyle), width: '40px', height: '40px', fontSize: '20px', margin: 0 }}></button>\n                                    <button onClick={() => setActiveTool('bucket')} style={{ ...(activeTool === 'bucket' ? activeButtonStyle : buttonStyle), width: '40px', height: '40px', fontSize: '20px', margin: 0 }}></button>\n                                    <button onClick={() => setActiveTool('move')} style={{ ...(activeTool === 'move' ? activeButtonStyle : buttonStyle), width: '40px', height: '40px', fontSize: '20px', margin: 0 }}></button>\n                                </div>\n                            </section>\n\n                            {activeTool === 'brush' && (\n                                <section style={{ backgroundColor: '#f9f9f9', padding: '10px', borderRadius: '6px' }}>\n                                    <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>BRUSH SIZE</span>\n                                    <div style={{ display: 'flex', gap: '5px' }}>\n                                        {[1, 2, 3, 4, 5].map(size => (\n                                            <button key={size} onClick={() => setBrushSize(size)}\n                                                style={{ ...(brushSize === size ? activeButtonStyle : buttonStyle), padding: '0 10px', minWidth: '35px', height: '35px' }}>\n                                                {size}\n                                            </button>\n                                        ))}\n                                    </div>\n                                </section>\n                            )}\n\n                            <section style={{ padding: '10px', backgroundColor: activeLayer === 'tile' ? '#e6f7ff' : (activeLayer === 'object' ? '#fff1f0' : '#f8f0ff'), borderRadius: '6px', border: '1px solid #ccc' }}>\n                                <span style={{ fontSize: '13px' }}>Active Layer: <strong>{activeLayer === 'tile' ? ' Background' : (activeLayer === 'object' ? ' Objects' : ' Secrets')}</strong></span>\n                            </section>\n\n                            {activeTool === 'move' && (\n                                <section style={{ backgroundColor: '#fffbe6', padding: '10px', borderRadius: '6px', border: '1px solid #ffe58f' }}>\n                                    <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>SELECTION MODE</span>\n                                    <div style={{ display: 'flex', gap: '8px' }}>\n                                        <button onClick={() => setSelectionMode('cut')} style={{ ...(selectionMode === 'cut' ? activeButtonStyle : buttonStyle), flex: 1 }}> Cut</button>\n                                        <button onClick={() => setSelectionMode('copy')} style={{ ...(selectionMode === 'copy' ? activeButtonStyle : buttonStyle), flex: 1 }}> Copy</button>\n                                    </div>\n                                </section>\n                            )}\n\n                            {activeTool === 'move' && selection && (\n                                <section style={{ padding: '12px', backgroundColor: '#fff3cd', borderRadius: '6px', border: '1px solid #ffc107' }}>\n                                    <span style={{ fontSize: '13px', display: 'block', marginBottom: '8px', fontWeight: 'bold' }}>Selection Active</span>\n                                    <div style={{ fontSize: '11px', marginBottom: '10px', lineHeight: '1.4' }}>\n                                         Drag with mouse or use arrows<br/>\n                                         Press <strong>Enter</strong> to confirm<br/>\n                                         Press <strong>Esc</strong> to cancel\n                                    </div>\n                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '5px' }}>\n                                        <button onClick={() => moveSelection(0, -1)} style={{ ...buttonStyle, margin: 0 }}></button>\n                                        <div style={{ display: 'flex', gap: '5px' }}>\n                                            <button onClick={() => moveSelection(-1, 0)} style={{ ...buttonStyle, margin: 0 }}></button>\n                                            <button onClick={() => moveSelection(1, 0)} style={{ ...buttonStyle, margin: 0 }}></button>\n                                        </div>\n                                        <button onClick={() => moveSelection(0, 1)} style={{ ...buttonStyle, margin: 0 }}></button>\n                                    </div>\n                                    <div style={{ display: 'flex', gap: '8px', marginTop: '15px' }}>\n                                        <button onClick={commitSelection} style={{ ...buttonStyle, backgroundColor: '#28a745', color: '#fff', flex: 1, height: '35px' }}> Confirm</button>\n                                        <button onClick={cancelSelection} style={{ ...buttonStyle, backgroundColor: '#dc3545', color: '#fff', flex: 1, height: '35px' }}> Cancel</button>\n                                    </div>\n                                </section>\n                            )}\n\n                            <section>\n                                <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '10px', color: '#555' }}>ERASERS</span>\n                                <div style={{ display: 'flex', gap: '8px' }}>\n                                    <BlockEraser />\n                                    <ObjectEraser />\n                                    <SecretEraser />\n                                </div>\n                            </section>\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {activePanel === 'palette' && (\n                <div style={panelStyle}>\n                    <div style={panelHeaderStyle}>\n                        <h3 style={panelTitleStyle}>Palette</h3>\n                        <button onClick={() => setActivePanel(null)} style={{ ...buttonStyle, margin: 0 }}></button>\n                    </div>\n                    {isPlayMode ? (\n                        <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                            Palette disabled during Play mode\n                        </div>\n                    ) : (\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                            <PaletteSection title=\"Blocks (Background)\" isOpenDefault={true}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {blocks.map(b => renderPaletteItem(b, 'blue', 'tile'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Liquids (Blocks)\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {liquids.map(li => renderPaletteItem(li, 'blue', 'tile'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Entities (Objects)\" isOpenDefault={true}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {entities.map(e => renderPaletteItem(e, 'red', 'object'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Decorations\" isOpenDefault={true}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {decorations && decorations.map(d => renderPaletteItem(d, 'purple', 'object'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Items (Objects)\" isOpenDefault={true}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {items.map(i => renderPaletteItem(i, 'green', 'object'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Interactables\" isOpenDefault={true}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {interactables.map(i => renderPaletteItem(i, 'purple', 'object'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Hazards\" isOpenDefault={true}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {hazards.map(h => renderPaletteItem(h, 'orange', 'object'))}\n                                </div>\n                            </PaletteSection>\n\n                            <PaletteSection title=\"Secrets\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {secrets && secrets.map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                                </div>\n                            </PaletteSection>\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {activePanel === 'bg' && (\n                <div style={panelStyle}>\n                    <div style={panelHeaderStyle}>\n                        <h3 style={panelTitleStyle}>Background & Music</h3>\n                        <button onClick={() => setActivePanel(null)} style={{ ...buttonStyle, margin: 0 }}></button>\n                    </div>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n                        <section>\n                            <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '12px' }}>Background Image</span>\n                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>\n                                <div onClick={() => setSelectedBackgroundImage(null)}\n                                    style={{\n                                        border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #2196F3',\n                                        borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                        boxShadow: !selectedBackgroundImage ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                                    }}\n                                    title=\"Solid Color\">\n                                    <div style={{ width: '100%', height: '60px', background: selectedBackgroundColor, display: 'block', borderRadius: '4px' }} />\n                                    <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: !selectedBackgroundImage ? 'bold' : 'normal' }}>Solid Color</div>\n                                </div>\n                                {backgroundOptions.map((bg) => (\n                                    <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                                        style={{\n                                            border: selectedBackgroundImage === bg.metaPath ? '2px solid #2196F3' : '1px solid #ccc',\n                                            borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                            boxShadow: selectedBackgroundImage === bg.metaPath ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                                        }}\n                                        title={bg.name}>\n                                        <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '60px', objectFit: 'cover', display: 'block', borderRadius: '4px' }} />\n                                        <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: selectedBackgroundImage === bg.metaPath ? 'bold' : 'normal' }}>{bg.name}</div>\n                                    </div>\n                                ))}\n                            </div>\n                        </section>\n\n                        <section style={{ backgroundColor: '#f9f9f9', padding: '15px', borderRadius: '8px', border: '1px solid #ddd' }}>\n                            <div style={{ marginBottom: '15px' }}>\n                                <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>Parallax Effect:</label>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                                        onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))}\n                                        style={{ flex: 1 }} />\n                                    <span style={{ fontSize: '13px', fontWeight: 'bold', minWidth: '35px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                                </div>\n                            </div>\n                            <div>\n                                <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>Background Color:</label>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <input type=\"color\" value={selectedBackgroundColor}\n                                        onChange={(e) => setSelectedBackgroundColor(e.target.value)}\n                                        style={{ width: '40px', height: '40px', border: 'none', padding: 0, cursor: 'pointer' }} />\n                                    <span style={{ fontSize: '13px', fontFamily: 'monospace' }}>{selectedBackgroundColor.toUpperCase()}</span>\n                                </div>\n                            </div>\n                        </section>\n\n                        <section style={{ borderTop: '2px solid #eee', paddingTop: '15px' }}>\n                            <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>Background Music</span>\n                            <select\n                                value={selectedBackgroundMusic || ''}\n                                onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                                style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ccc', fontSize: '13px', marginBottom: '10px' }}>\n                                <option value=\"\"> No Music </option>\n                                {musicOptions.map(m => (\n                                    <option key={m.name} value={m.metaPath}>{m.name}</option>\n                                ))}\n                            </select>\n                            <BackgroundMusicPlayer metaPath={selectedBackgroundMusic} enabled={true} volume={0.4} />\n                            <div style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\n                                Status: {selectedBackgroundMusic ? 'Music selected' : 'Silence'}\n                            </div>\n                        </section>\n                    </div>\n                </div>\n            )}\n\n            {activePanel === 'stats' && (\n                <div style={panelStyle}>\n                    <div style={panelHeaderStyle}>\n                        <h3 style={panelTitleStyle}>Statistics</h3>\n                        <button onClick={() => setActivePanel(null)} style={{ ...buttonStyle, margin: 0 }}></button>\n                    </div>\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n                        <div style={{ padding: '15px', backgroundColor: '#e6f7ff', borderRadius: '8px', border: '1px solid #91d5ff' }}>\n                            <div style={{ fontSize: '14px', marginBottom: '8px' }}>Total Map Area: <strong>{totalTiles}</strong> tiles</div>\n                            <div style={{ fontSize: '13px', color: '#0050b3' }}>Dimensions: {mapWidth} x {mapHeight}</div>\n                        </div>\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                            <div style={{ padding: '12px', backgroundColor: '#f6ffed', borderRadius: '8px', border: '1px solid #b7eb8f', textAlign: 'center' }}>\n                                <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#389e0d' }}>{filledBlocks}</div>\n                                <div style={{ fontSize: '11px', color: '#555' }}>FILLED BLOCKS</div>\n                            </div>\n                            <div style={{ padding: '12px', backgroundColor: '#fff7e6', borderRadius: '8px', border: '1px solid #ffd591', textAlign: 'center' }}>\n                                <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#d46b08' }}>{objectsCount}</div>\n                                <div style={{ fontSize: '11px', color: '#555' }}>OBJECTS</div>\n                            </div>\n                        </div>\n                        <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', textAlign: 'center' }}>\n                                <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#666' }}>{emptyBlocks}</div>\n                                <div style={{ fontSize: '11px', color: '#555' }}>EMPTY SPACE</div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {activePanel === 'props' && (\n                <div style={panelStyle}>\n                    <div style={panelHeaderStyle}>\n                        <h3 style={{ margin: 0 }}>Object Properties</h3>\n                        <div onClick={() => setActivePanel(null)} style={{ cursor: 'pointer' }}></div>\n                    </div>\n                    <div style={{ padding: '10px 0' }}>\n                        <p style={{ fontSize: '12px', color: '#666', lineHeight: '1.4' }}>\n                            Configure triggers for Portals and Targets.\n                            <br />\n                            <strong>1.</strong> Place a <strong>Portal</strong> and a <strong>Portal Target</strong> from the palette.\n                            <br />\n                            <strong>2.</strong> Link them by giving them the <strong>same Trigger ID</strong> here.\n                            <br />\n                            <i style={{ fontSize: '11px' }}>* Tip: You can see visual links between them in the editor and minimap.</i>\n                        </p>\n                        <div style={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}>\n                            {objectMapData.map((id, index) => {\n                                if (!id) return null;\n                                const def = registryItems.find(r => r.id === id);\n                                if (!def || (!id.includes('portal') && !id.includes('target') && id !== 'portal_target')) return null;\n\n                                const x = index % mapWidth;\n                                const y = Math.floor(index / mapWidth);\n                                const metadata = objectMetadata[index] || {};\n                                const isHighlighted = highlightedIndex === index;\n\n                                return (\n                                    <div key={index} \n                                        onMouseEnter={() => setHighlightedIndex(index)}\n                                        onMouseLeave={() => setHighlightedIndex(null)}\n                                        style={{\n                                            padding: '10px',\n                                            border: isHighlighted ? '1px solid gold' : '1px solid #eee',\n                                            display: 'flex',\n                                            flexDirection: 'column',\n                                            gap: '5px',\n                                            backgroundColor: isHighlighted ? '#fffde7' : '#f9f9f9',\n                                            marginBottom: '5px',\n                                            borderRadius: '4px',\n                                            transition: 'all 0.2s ease'\n                                        }}\n                                    >\n                                        <div style={{ fontWeight: 'bold', fontSize: '13px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                                            <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                                {id.includes('portal') && !id.includes('target') ? '' : ''} {def.name}\n                                            </span>\n                                            <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                                <span style={{ color: '#666', fontSize: '11px' }}>({x}, {y})</span>\n                                                <button \n                                                    onClick={() => {\n                                                        const el = document.querySelector(`.viewport`);\n                                                        if (el) {\n                                                            const scrollX = x * 32 - el.clientWidth / 2 + 16;\n                                                            const scrollY = y * 32 - el.clientHeight / 2 + 16;\n                                                            el.scrollTo({ left: scrollX, top: scrollY, behavior: 'smooth' });\n                                                        }\n                                                    }}\n                                                    style={{ \n                                                        padding: '2px 6px', fontSize: '10px', cursor: 'pointer',\n                                                        backgroundColor: '#eee', border: '1px solid #ccc', borderRadius: '3px'\n                                                    }}\n                                                    title=\"Scroll to this object\"\n                                                >\n                                                    Locate\n                                                </button>\n                                            </div>\n                                        </div>\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                            <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Trigger ID:</label>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.triggerId || ''}\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], triggerId: isNaN(val) ? null : val }\n                                                    }));\n                                                }}\n                                                style={{\n                                                    flex: 1,\n                                                    padding: '4px 8px',\n                                                    border: '1px solid #ccc',\n                                                    borderRadius: '4px',\n                                                    fontSize: '13px',\n                                                    backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                                }}\n                                                placeholder=\"Enter ID (e.g. 1)\"\n                                            />\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                            {objectMapData.filter(id => id && (id.includes('portal') || id.includes('target'))).length === 0 && (\n                                <p style={{ textAlign: 'center', color: '#999', marginTop: '20px', fontSize: '14px' }}>\n                                    No portals or targets found on map.\n                                </p>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Right side buttons */}\n            <div style={rightSidebarStyle}>\n                <div onClick={() => setIsMinimapOpen(!isMinimapOpen)} style={isMinimapOpen ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Minimap\"></div>\n                <div onClick={() => setIsSettingsOpen(!isSettingsOpen)} style={isSettingsOpen ? activeSidebarButtonStyle : sidebarButtonStyle} title=\"Settings\"></div>\n            </div>\n\n            {/* Floating Windows (Minimap / Settings) */}\n            {isMinimapOpen && (\n                <DraggableWindow\n                    title=\"Minimap\"\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsMinimapOpen(false)}\n                >\n                    <Minimap\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isSettingsOpen && (\n                <DraggableWindow\n                    title=\"Editor Settings\"\n                    defaultPosition={{ x: window.innerWidth - 340, y: 400 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsSettingsOpen(false)}\n                >\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                         <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n                            <span style={{ fontSize: '13px' }}>Show Grid:</span>\n                            <button onClick={() => setShowGrid(!showGrid)} style={showGrid ? activeButtonStyle : buttonStyle}>\n                                {showGrid ? 'ON' : 'OFF'}\n                            </button>\n                        </div>\n                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n                            <span style={{ fontSize: '13px' }}>Brush Size:</span>\n                            <div style={{ display: 'flex', gap: '2px' }}>\n                                {[1, 2, 3, 4, 5].map(s => (\n                                    <button key={s} onClick={() => setBrushSize(s)} style={{ ...(brushSize === s ? activeButtonStyle : buttonStyle), minWidth: '25px', padding: 0 }}>{s}</button>\n                                ))}\n                            </div>\n                        </div>\n                        <div style={{ borderTop: '1px solid #eee', paddingTop: '10px', marginTop: '5px' }}>\n                            <button onClick={clearMap} style={{ ...buttonStyle, color: 'red', width: '100%' }}> Clear Entire Map</button>\n                        </div>\n                    </div>\n                </DraggableWindow>\n            )}\n\n            {/* Resize Map Popup */}\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title=\"Resize Map\"\n                    defaultPosition={{ x: 400, y: 100 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsResizeWindowOpen(false)}\n                >\n                    <MapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={onMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { saveMap, loadMap, clearMap, resizeMapData } from './mapOperations';\nimport { getFloodFillIndices, floodFill, paintTile } from './paintingTools';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './NewMapModal';\nimport { ToolbarWindows } from './ToolbarWindows';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport PixiStage from '../game/PixiStage';\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nexport const Editor = () => {\n    // 1. Definjam registryItems pa aug\n    const registryItems = useMemo(() => getRegistry() || [], []);\n    const playerVisuals = useMemo(() => registryItems.find(item => item.id === 'player') || EMPTY_OBJECT, [registryItems]);\n\n    // Editor state: map dimensions, tile/object data, selected tile, tools\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [objectMetadata, setObjectMetadata] = useState({});\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n\n    const [selection, setSelection] = useState(null);\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [isMovingSelection, setIsMovingSelection] = useState(false);\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n    const bucketTimerRef = useRef(null);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata });\n\n    // Map metadata\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [highlightedIndex, setHighlightedIndex] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n\n    // 2. NOEM O RINDIU (t vairs nav vajadzga eit):\n    // const registryItems = getRegistry() || [];\n\n    // Background and music options (memoized to avoid reloading every frame)\n    const backgroundOptions = useMemo(() => loadBackgroundOptions(), []);\n    const musicOptions = useMemo(() => loadMusicOptions(), []);\n\n    // Background state - needed before Play/Pause state\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(backgroundOptions[0]?.metaPath || null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#87CEEB');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    // 3. Definjam stabilu handleSaveMap funkciju\n    const handleSaveMap = useCallback(() => {\n        saveMap({\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            mapName, creatorName, createdAt,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            registryItems, setCreatedAt\n        });\n    }, [\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, createdAt,\n        selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic,\n        registryItems\n    ]);\n\n    // Play/Pause/Reset state\n    const [isPlayMode, setIsPlayMode] = useState(false);\n    const [editorSnapshot, setEditorSnapshot] = useState(null);\n    const [playerPosition, setPlayerPosition] = useState({ x: 100, y: 100 });\n    const [revealedSecrets, setRevealedSecrets] = useState([]);\n    const [playModeObjectData, setPlayModeObjectData] = useState([]);\n    const [playModeSecretData, setPlayModeSecretData] = useState([]);\n\n    // Game engine integration for Play mode\n    const mapDataForGame = useMemo(() => ({\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: TILE_SIZE,\n            backgroundImage: selectedBackgroundImage,\n            backgroundColor: selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            objectMetadata: objectMetadata\n        },\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: playModeObjectData }\n        ]\n    }), [mapWidth, mapHeight, selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, tileMapData, playModeObjectData, objectMetadata]);\n\n    const handleGameOver = useCallback(() => {\n        // On game over in editor, just pause\n        setIsPlayMode(false);\n    }, []);\n\n    const handleStateUpdate = useCallback((newState, payload) => {\n        // Update player position during play or handle events like item collection\n        if (newState && typeof newState === 'object' && newState.x !== undefined && newState.y !== undefined) {\n            setPlayerPosition({ x: newState.x, y: newState.y });\n        } else if (newState === 'collectItem' && payload !== undefined) {\n            setPlayModeObjectData(prev => {\n                const newData = [...prev];\n                newData[payload] = null;\n                return newData;\n            });\n        } else if (newState === 'objectDamage' && payload !== undefined) {\n            const { index, damage } = payload;\n            setObjectMetadata(prev => {\n                const current = prev[index] || {};\n                const objId = playModeObjectData[index];\n                const def = registryItems.find(r => r.id === objId);\n                if (!def) return prev;\n                const maxH = def.maxHealth || 100;\n                const newHealth = Math.max(0, (current.health !== undefined ? current.health : maxH) - damage);\n                \n                return {\n                    ...prev,\n                    [index]: { ...current, health: newHealth }\n                };\n            });\n        } else if (newState === 'playerDamage' && payload !== undefined) {\n            // Reistrjam spltja bojjumus editora play rem (vizulai atgriezeniskajai saitei)\n            // eit vartu atskaot skau vai ko citu, bet dzinjs pats iestata hitTimerMs\n        }\n    }, [playModeObjectData, registryItems]);\n\n    const handleRevealSecret = useCallback((secretIndex) => {\n        setRevealedSecrets(prev => [...prev, secretIndex]);\n    }, []);\n\n    const gameEngineState = useGameEngine(\n        isPlayMode ? mapDataForGame : null,\n        isPlayMode ? tileMapData : EMPTY_ARRAY,\n        isPlayMode ? playModeObjectData : EMPTY_ARRAY,\n        isPlayMode ? playModeSecretData : EMPTY_ARRAY,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata\n    );\n\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode]);\n\n    const blocks = useMemo(() => registryItems.filter(item => item.name && item.name.startsWith('block.') && !(item.flags && item.flags.liquid)), [registryItems]);\n    const liquids = useMemo(() => registryItems.filter(item => item.flags && item.flags.liquid), [registryItems]);\n    const entities = useMemo(() => registryItems.filter(item => {\n        if (!item.name || !item.name.toLowerCase().includes('entities.')) return false;\n        if (item.isHiddenInEditor) return false;\n        // Tips var bt entity, default vai pat nebt nordts, ja nosaukums sakrt\n        return !item.type || item.type === 'default' || item.type === 'entity' || item.subtype === 'tank';\n    }), [registryItems]);\n    const decorations = useMemo(() => registryItems.filter(item => {\n        if (item.type === 'decoration') return true;\n        if (item.name && item.name.toLowerCase().includes('decoration.')) return true;\n        if (item.id && item.id.includes('stone_pack')) return true;\n        return false;\n    }), [registryItems]);\n    const items = useMemo(() => registryItems.filter(item => item.name && item.name.toLowerCase().includes('item.')), [registryItems]);\n    const interactables = useMemo(() => registryItems.filter(item => item.name && item.name.toLowerCase().includes('interactable.')), [registryItems]);\n    const hazards = useMemo(() => registryItems.filter(item => item.type === 'hazard' || (item.name && item.name.toLowerCase().includes('hazard.'))), [registryItems]);\n    const secrets = useMemo(() => registryItems.filter(item => item.type === 'secret' || (item.name && item.name.toLowerCase().includes('secret.'))), [registryItems]);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    const openNewMapModal = () => {\n        setTempMapName(\"New Map\");\n        setTempCreatorName(creatorName);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = () => {\n        if (window.confirm(\"Are you sure you want to create a new map? Unsaved changes will be lost.\")) {\n            const size = 20 * 15;\n            setMapWidth(20);\n            setMapHeight(15);\n            setTileMapData(Array(size).fill(null));\n            setObjectMapData(Array(size).fill(null));\n            setSecretMapData(Array(size).fill(null));\n\n            setMapName(tempMapName || \"New Map\");\n            setCreatorName(tempCreatorName || \"Anonymous\");\n            setCreatedAt(null);\n            setSelectedBackgroundImage(backgroundOptions[0]?.metaPath || null);\n            setBackgroundParallaxFactor(0.3);\n            setSelectedBackgroundColor('#87CEEB');\n            setSelectedBackgroundMusic(null);\n\n            setIsNewMapModalOpen(false);\n        }\n    };\n\n    const getCurrentData = () => {\n        if (activeLayer === 'tile') return tileMapData;\n        if (activeLayer === 'object') return objectMapData;\n        if (activeLayer === 'secret') return secretMapData;\n        return tileMapData;\n    };\n    const setCurrentData = (newData) => {\n        if (activeLayer === 'tile') setTileMapData(newData);\n        else if (activeLayer === 'object') {\n            // Ja ms mainm objektu slni, prbaudm vai vajag izdzst metadatus\n            setObjectMapData((prev) => {\n                const newMetadata = { ...objectMetadata };\n                let metadataChanged = false;\n                \n                newData.forEach((id, idx) => {\n                    if (prev[idx] !== id && objectMetadata[idx]) {\n                        delete newMetadata[idx];\n                        metadataChanged = true;\n                    }\n                });\n                \n                if (metadataChanged) setObjectMetadata(newMetadata);\n                return newData;\n            });\n        }\n        else if (activeLayer === 'secret') setSecretMapData(newData);\n    };\n\n    const handleGridMouseDown = (index, e) => {\n        e.preventDefault();\n\n        // Check if clicking on existing selection to move it\n        if (selection && previewPosition) {\n            const x = index % mapWidth;\n            const y = Math.floor(index / mapWidth);\n\n            // Check if click is inside selection\n            if (x >= previewPosition.x && x < previewPosition.x + selection.w &&\n                y >= previewPosition.y && y < previewPosition.y + selection.h) {\n                setIsMovingSelection(true);\n                setIsDragging(true);\n                return;\n            }\n        }\n\n        if (activeTool === 'brush') {\n            setIsDragging(true);\n            paintTile(index, selectedTile, brushSize, mapWidth, mapHeight, getCurrentData, setCurrentData);\n        }\n        else if (activeTool === 'bucket') {\n            const targetId = selectedTile ? selectedTile.id : null;\n            floodFill(index, targetId, getCurrentData, setCurrentData, mapWidth, mapHeight);\n            setBucketPreviewIndices(new Set());\n        } else if (activeTool === 'move') {\n            const x = index % mapWidth;\n            const y = Math.floor(index / mapWidth);\n            setDragStart({ x, y });\n            setSelection(null);\n            setPreviewPosition(null);\n            setOriginalMapData(null);\n            setIsDragging(true);\n        }\n    };\n\n    const handleGridMouseEnter = (index) => {\n        setHoverIndex(index);\n\n        // If moving selection, update preview position\n        if (isMovingSelection && isDragging && previewPosition) {\n            const x = index % mapWidth;\n            const y = Math.floor(index / mapWidth);\n            setPreviewPosition({ x, y });\n            return;\n        }\n\n        if (bucketTimerRef.current) {\n            clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = null;\n        }\n        setBucketPreviewIndices(new Set());\n        if (activeTool === 'brush' && isDragging) {\n            paintTile(index, selectedTile, brushSize, mapWidth, mapHeight, getCurrentData, setCurrentData);\n        }\n        else if (activeTool === 'bucket' && !isDragging) {\n            bucketTimerRef.current = setTimeout(() => {\n                const currentData = getCurrentData();\n                const indices = getFloodFillIndices(index, currentData, mapWidth, mapHeight);\n                setBucketPreviewIndices(new Set(indices));\n            }, 600);\n        }\n    };\n\n    const handleGridMouseLeave = () => {\n        setHoverIndex(null);\n        if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n        setBucketPreviewIndices(new Set());\n    };\n\n    const handleGridMouseUp = (index) => {\n        if (isMovingSelection) {\n            // Just stop moving, don't commit yet (wait for Enter)\n            setIsMovingSelection(false);\n            return;\n        }\n\n        setIsDragging(false);\n        if (activeTool === 'move' && dragStart) {\n            const endX = index % mapWidth;\n            const endY = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, endX);\n            const y1 = Math.min(dragStart.y, endY);\n            const x2 = Math.max(dragStart.x, endX);\n            const y2 = Math.max(dragStart.y, endY);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const selTileData = [];\n            const selObjectData = [];\n            const selSecretData = [];\n\n            for (let py = 0; py < h; py++) {\n                for (let px = 0; px < w; px++) {\n                    const idx = (y1 + py) * mapWidth + (x1 + px);\n                    selTileData.push(tileMapData[idx]);\n                    selObjectData.push(objectMapData[idx]);\n                    selSecretData.push(secretMapData[idx]);\n                }\n            }\n\n            // Save original map state\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData]\n            });\n\n            setSelection({ x: x1, y: y1, w, h, tileData: selTileData, objectData: selObjectData, secretData: selSecretData, originalX: x1, originalY: y1 });\n            setPreviewPosition({ x: x1, y: y1 });\n            setDragStart(null);\n        }\n    };\n\n    const moveSelection = (dx, dy) => {\n        if (!selection || !previewPosition) return;\n\n        const newX = previewPosition.x + dx;\n        const newY = previewPosition.y + dy;\n\n        // Just update preview position\n        setPreviewPosition({ x: newX, y: newY });\n    };\n\n    const commitSelection = () => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    };\n\n    const cancelSelection = () => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n        setIsMovingSelection(false);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n\n        resizeMapData({\n            newWidth,\n            newHeight,\n            stateRef,\n            setMapWidth,\n            setMapHeight,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData,\n            setObjectMetadata\n        });\n    };\n\n    const handlePaletteSelect = (item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    };\n\n    // Play/Pause/Reset handlers\n    const handlePlay = () => {\n        // Save snapshot of current state (original editor data)\n        setEditorSnapshot({\n            objectMapData: [...objectMapData],\n            secretMapData: [...secretMapData],\n            objectMetadata: { ...objectMetadata },\n            playerPosition: { ...playerPosition }\n        });\n\n        // Create copies for play mode (these will be modified by game engine)\n        const playData = [...objectMapData];\n\n        // Find player spawn position or use default center position\n        let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n        if (spawnIndex === -1) {\n            // No player found, place at center of map (or position 3,3)\n            const spawnX = Math.min(3, mapWidth - 1);\n            const spawnY = Math.min(3, mapHeight - 1);\n            spawnIndex = spawnY * mapWidth + spawnX;\n            // Add temporary player marker (use ID 'player' which is in registry)\n            playData[spawnIndex] = 'player';\n        }\n\n        setPlayModeObjectData(playData);\n        setPlayModeSecretData([...secretMapData]);\n        setRevealedSecrets([]);\n\n        setIsPlayMode(true);\n    };\n\n    const handlePause = () => {\n        setIsPlayMode(false);\n        // When pausing, update editor's objectMapData with current play state\n        // This simulates \"saving\" the collected items during play\n        const pauseData = [...playModeObjectData];\n\n        // Remove temporary player if it was auto-added (not in original editor data)\n        const originalHadPlayer = editorSnapshot.objectMapData.findIndex(id => id && id.includes('player')) !== -1;\n        if (!originalHadPlayer) {\n            const playerIndex = pauseData.findIndex(id => id && id.includes('player'));\n            if (playerIndex !== -1) {\n                pauseData[playerIndex] = null;\n            }\n        }\n\n        setObjectMapData(pauseData);\n        setSecretMapData([...playModeSecretData]);\n    };\n\n    const handleReset = () => {\n        if (editorSnapshot && isPlayMode) {\n            // Restore objects from snapshot but keep player position\n            // This resets collected objects during play mode\n            const resetData = [...editorSnapshot.objectMapData];\n\n            // Re-add player at same spawn position\n            let spawnIndex = resetData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                resetData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(resetData);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n            setRevealedSecrets([]);\n            // Player position is maintained by useGameEngine state\n        }\n    };\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden' }}>\n            <NewMapModal\n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', height: '100%', flexDirection: 'row',\n                filter: isNewMapModalOpen ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: isNewMapModalOpen ? 'none' : 'auto'\n            }}>\n                <ToolbarWindows\n                    mapName={mapName}\n                    creatorName={creatorName}\n                    openNewMapModal={openNewMapModal}\n                    saveMap={handleSaveMap} // 4. Izmanto jauno handleSaveMap\n                    loadMap={(event) => loadMap({\n                        event, setMapWidth, setMapHeight, setMapName, setCreatorName,\n                        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n                        setBackgroundParallaxFactor, setSelectedBackgroundMusic,\n                        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata\n                    })}\n                    showGrid={showGrid}\n                    setShowGrid={setShowGrid}\n                    clearMap={() => clearMap({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata })}\n                    isPlayMode={isPlayMode}\n                    handlePlay={handlePlay}\n                    handlePause={handlePause}\n                    handleReset={handleReset}\n                    activeTool={activeTool}\n                    setActiveTool={setActiveTool}\n                    brushSize={brushSize}\n                    setBrushSize={setBrushSize}\n                    activeLayer={activeLayer}\n                    selection={selection}\n                    moveSelection={moveSelection}\n                    setSelection={setSelection}\n                    selectionMode={selectionMode}\n                    setSelectionMode={setSelectionMode}\n                    commitSelection={commitSelection}\n                    cancelSelection={cancelSelection}\n                    selectedTile={selectedTile}\n                    handlePaletteSelect={handlePaletteSelect}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    decorations={decorations}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    backgroundOptions={backgroundOptions}\n                    selectedBackgroundImage={selectedBackgroundImage}\n                    setSelectedBackgroundImage={setSelectedBackgroundImage}\n                    selectedBackgroundColor={selectedBackgroundColor}\n                    setSelectedBackgroundColor={setSelectedBackgroundColor}\n                    backgroundParallaxFactor={backgroundParallaxFactor}\n                    setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    musicOptions={musicOptions}\n                    selectedBackgroundMusic={selectedBackgroundMusic}\n                    setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    tileMapData={tileMapData}\n                    objectMapData={objectMapData}\n                    objectMetadata={objectMetadata}\n                    setObjectMetadata={setObjectMetadata}\n                    registryItems={registryItems}\n                    onMapResize={handleMapResize}\n                    highlightedIndex={highlightedIndex}\n                    setHighlightedIndex={setHighlightedIndex}\n                />\n\n                {!isPlayMode ? (\n                    <Viewport\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        selectedBackgroundUrl={selectedBackgroundUrl}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        showGrid={showGrid}\n                        activeLayer={activeLayer}\n                        activeTool={activeTool}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        secretMapData={secretMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                        hoverIndex={hoverIndex}\n                        highlightedIndex={highlightedIndex}\n                        brushSize={brushSize}\n                        bucketPreviewIndices={bucketPreviewIndices}\n                        selection={selection}\n                        previewPosition={previewPosition}\n                        dragStart={dragStart}\n                        isDragging={isDragging}\n                        handleGridMouseDown={handleGridMouseDown}\n                        handleGridMouseEnter={handleGridMouseEnter}\n                        handleGridMouseUp={handleGridMouseUp}\n                        handleGridMouseLeave={handleGridMouseLeave}\n                        setIsDragging={setIsDragging}\n                    />\n                ) : (\n                    <div style={{ flex: 1, position: 'relative', backgroundColor: '#000' }}>\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={TILE_SIZE}\n                            tileMapData={tileMapData}\n                            objectMapData={playModeObjectData}\n                            secretMapData={playModeSecretData}\n                            revealedSecrets={revealedSecrets}\n                            registryItems={registryItems}\n                            playerState={gameEngineState}\n                            playerVisuals={playerVisuals}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={selectedBackgroundImage}\n                            backgroundColor={selectedBackgroundColor}\n                            backgroundParallaxFactor={backgroundParallaxFactor}\n                            projectiles={gameEngineState?.projectiles || EMPTY_ARRAY}\n                            healthBarEnabled={true}\n                            oxygenBarEnabled={true}\n                            lavaBarEnabled={true}\n                            isEditor={true}\n                        />\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg)$/);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.ogg$/);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import saveFile from '../../../utilities/saveFile';\nimport errorHandler from '../../../services/errorHandler';\n\nexport const saveMap = async ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    mapName,\n    creatorName,\n    createdAt,\n    selectedBackgroundImage,\n    selectedBackgroundColor,\n    backgroundParallaxFactor,\n    selectedBackgroundMusic,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    // Statistics calculation\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n    const itemsCount = objectMapData.filter(o => {\n        if (!o) return false;\n        const item = registryItems.find(r => r.id === o);\n        return item && item.name && item.name.startsWith('item.');\n    }).length;\n\n    const mapData = {\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: 32,\n            version: \"1.0\",\n            name: mapName,\n            author: creatorName,\n            date_map_created_at: createdDate,\n            date_map_last_updated: currentDate,\n            backgroundImage: selectedBackgroundImage || null,\n            backgroundColor: selectedBackgroundImage ? null : selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            backgroundMusic: selectedBackgroundMusic || null,\n            objectMetadata: objectMetadata || {}\n        },\n        statistics: {\n            total_tiles: mapWidth * mapHeight,\n            filled_tiles: filledBlocks,\n            total_objects: objectsCount,\n            total_items: itemsCount\n        },\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: objectMapData },\n            { type: \"secret\", name: \"secrets\", data: secretMapData || Array(mapWidth * mapHeight).fill(null) }\n        ]\n    };\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(mapData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Map saved successfully', {\n                component: 'Editor',\n                mapName,\n                fileName,\n                dimensions: `${mapWidth}x${mapHeight}`\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save map. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData,\n    setObjectMetadata\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                if (loaded.meta) {\n                    setMapWidth(loaded.meta.width);\n                    setMapHeight(loaded.meta.height);\n\n                    if (loaded.meta.name) setMapName(loaded.meta.name);\n                    if (loaded.meta.author) setCreatorName(loaded.meta.author);\n                    if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n                    if (typeof loaded.meta.backgroundImage !== 'undefined' && loaded.meta.backgroundImage) {\n                        setSelectedBackgroundImage(loaded.meta.backgroundImage);\n                    } else {\n                        setSelectedBackgroundImage(null);\n                    }\n                    if (typeof loaded.meta.backgroundColor !== 'undefined' && loaded.meta.backgroundColor) {\n                        setSelectedBackgroundColor(loaded.meta.backgroundColor);\n                    }\n                    if (typeof loaded.meta.backgroundParallaxFactor !== 'undefined') {\n                        setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n                    } else {\n                        setBackgroundParallaxFactor(0.3);\n                    }\n                    if (typeof loaded.meta.backgroundMusic !== 'undefined' && loaded.meta.backgroundMusic) {\n                        const m = loaded.meta.backgroundMusic;\n                        const normalized = typeof m === 'string' ? m.replace('/sound/background/', '/assets/sound/background/') : m;\n                        setSelectedBackgroundMusic(normalized);\n                    } else {\n                        setSelectedBackgroundMusic(null);\n                    }\n\n                    if (loaded.meta.objectMetadata) {\n                        setObjectMetadata(loaded.meta.objectMetadata);\n                    } else {\n                        setObjectMetadata({});\n                    }\n\n                    const bgLayer = loaded.layers.find(l => l.name === 'background');\n                    const objLayer = loaded.layers.find(l => l.name === 'entities');\n                    const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n                    if (bgLayer) setTileMapData(bgLayer.data);\n                    if (objLayer) setObjectMapData(objLayer.data);\n                    if (secretLayer) {\n                        setSecretMapData(secretLayer.data);\n                    } else {\n                        setSecretMapData(Array(loaded.meta.width * loaded.meta.height).fill(null));\n                    }\n\n                    errorHandler.info('Map loaded successfully', {\n                        component: 'Editor',\n                        mapName: loaded.meta.name,\n                        dimensions: `${loaded.meta.width}x${loaded.meta.height}`\n                    });\n                } else {\n                    // Old format\n                    if (loaded.width) setMapWidth(loaded.width);\n                    if (loaded.height) setMapHeight(loaded.height);\n                    if (loaded.tiles) setTileMapData(loaded.tiles);\n                    setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n                    errorHandler.warn('Loaded map in legacy format', {\n                        component: 'Editor',\n                        fileName: file.name\n                    });\n                }\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets, objectMetadata: oldMeta } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        if (!oldArr) return newArr;\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[y * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    const resizeMetadata = (oldM) => {\n        const newM = {};\n        if (!oldM) return newM;\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                const oldIdx = y * oldW + x;\n                const newIdx = y * newWidth + x;\n                if (oldM[oldIdx]) {\n                    newM[newIdx] = oldM[oldIdx];\n                }\n            }\n        }\n        return newM;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets));\n    setObjectMetadata(resizeMetadata(oldMeta));\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/index\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/desert_block_0001.json\": 6918,\n\t\"./blocks/desert_block_0002.json\": 8359,\n\t\"./blocks/desert_block_0003.json\": 324,\n\t\"./blocks/desert_block_0004.json\": 2149,\n\t\"./blocks/desert_block_0005.json\": 5418,\n\t\"./blocks/desert_block_0006.json\": 5531,\n\t\"./blocks/desert_block_0007.json\": 4136,\n\t\"./blocks/desert_block_0008.json\": 329,\n\t\"./blocks/desert_block_0009.json\": 9518,\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/dirt_block_0002.json\": 5655,\n\t\"./blocks/dirt_block_0003.json\": 4932,\n\t\"./blocks/dirt_block_0004.json\": 5653,\n\t\"./blocks/dirt_block_0005.json\": 8970,\n\t\"./blocks/dirt_block_0006.json\": 2251,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/ice_block_0001.json\": 3322,\n\t\"./blocks/lava_block.json\": 2619,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./blocks/water_block.json\": 5688,\n\t\"./decorations/stone_pack_01_001.json\": 5247,\n\t\"./decorations/stone_pack_01_002.json\": 5134,\n\t\"./decorations/stone_pack_01_003.json\": 9593,\n\t\"./decorations/stone_pack_01_004.json\": 9840,\n\t\"./decorations/stone_pack_01_005.json\": 2867,\n\t\"./decorations/stone_pack_01_006.json\": 7618,\n\t\"./decorations/stone_pack_01_007.json\": 9069,\n\t\"./decorations/stone_pack_01_008.json\": 9588,\n\t\"./decorations/stone_pack_01_009.json\": 3975,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./entities/tank_0000.json\": 9381,\n\t\"./entities/tank_0001.json\": 8938,\n\t\"./entities/tank_0002.json\": 9179,\n\t\"./hazards/bushes_001.json\": 3540,\n\t\"./hazards/death_block_0001.json\": 2068,\n\t\"./interactables/arrows/arrow_down.json\": 3741,\n\t\"./interactables/arrows/arrow_left.json\": 4636,\n\t\"./interactables/arrows/arrow_right.json\": 9821,\n\t\"./interactables/arrows/arrow_up.json\": 7852,\n\t\"./interactables/berry_bush_01.json\": 7043,\n\t\"./interactables/berry_bush_01_used.json\": 8669,\n\t\"./interactables/ends/end_0001.json\": 9318,\n\t\"./interactables/platforms/platform_0001.json\": 2008,\n\t\"./interactables/portal_001.json\": 3742,\n\t\"./interactables/portal_target.json\": 4198,\n\t\"./interactables/stone_0001.json\": 1521,\n\t\"./interactables/wooden_box_0001.json\": 2010,\n\t\"./items/fireball_ammo.json\": 8443,\n\t\"./items/hertz_item.json\": 1752,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/secret_area_a.json\": 1866,\n\t\"./secrets/secret_area_b.json\": 3227,\n\t\"./secrets/secret_area_c.json\": 3880\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","var map = {\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719,\n\t\"./seamless_07.png\": 6390\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8870;"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","activeMapData","tileMapData","objectMapData","secretMapData","objectMetadata","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","isLoading","error","isPaused","isGameOver","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","meta","updateObjectMap","updateObjectMetadata","index","metadata","removeObjectAtIndex","undefined","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","forEach","idx","includes","push","setLoading","setError","setPaused","setGameOver","resetGame","actions","TILE_SIZE","MAX_HEALTH","MAX_OXYGEN","MAX_LAVA_RESIST","x","y","width","height","vx","vy","isGrounded","direction","animation","health","maxHealth","strength","maxStrength","ammo","oxygen","maxOxygen","lavaResist","maxLavaResist","projectiles","inWater","headUnderWater","atSurface","liquidType","hitTimerMs","isWinning","winCounter","playerSlice","updateState","setPosition","setVelocity","setHealth","Math","max","min","addHealth","takeDamage","setAmmo","addAmmo","setOxygen","setLavaResist","setStrength","setProjectiles","addProjectile","removeProjectile","filter","p","setDirection","setAnimation","setGrounded","setInWater","setLiquidType","resetPlayer","sound","enabled","masterVolume","sfxVolume","musicVolume","graphics","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherFog","weatherThunder","ui","healthBarEnabled","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","controls","keyUp","keyDown","keyLeft","keyRight","keyJump","keyShoot","settingsSlice","loadSettings","saved","localStorage","getItem","parsed","JSON","parse","console","updateSettings","newState","setItem","stringify","setSoundEnabled","setSoundVolume","type","volume","setGraphicsSetting","key","value","setUISetting","setControlBinding","resetSettings","removeItem","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","player","playerReducer","settings","settingsReducer","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","no_navigation","en_navigation","ru_navigation","ja_navigation","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","no","en","ru","ja","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","chapter_repository","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","DropdownContainer","div","DropdownMenu","MenuItem","ToggleSwitch","props","$active","SectionHeaderNavigationLanguages","dispatch","useDispatch","dropdownRef","useRef","isMenuOpen","setIsMenuOpen","useState","useSelector","soundEnabled","currentLang","language","handleLanguageChange","newLang","changeLanguage","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","ref","title","toggleSound","next","CustomEvent","detail","backgroundColor","margin","padding","color","StyledLogo","SectionHeaderNavigationLogo","StyledSectionHeaderNavigation","StyledSectionHeaderFooter","StyledSectionContent","_registry","initRegistry","time","jsonContext","require","imageContext","soundContext","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","data","item","resolvedTexture","texture","resolvedTextures","textures","Array","isArray","path","sfx","sfxResolved","defaultAnimation","animItem","find","r","length","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","log","timeEnd","getRegistry","findItemById","items","flexDirection","justifyContent","alignItems","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","SectionFooter","apiUrl","env","REACT_APP_API_URL","logo","URL_LOGO_01","URL_LOGO_02","URL_LOGO_03","URL_LOGO_04","URL_LOGO_05","HomeContainer","Home","LOGO_01","config","LOGO_02","LOGO_03","LOGO_04","LOGO_05","src","alt","TextureCache","constructor","this","_map","Map","get","url","m","has","tex","Texture","from","set","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","area","maxParticles","floor","setIntensity","v","Number","spawnOne","g","Graphics","rect","fill","alpha","random","speed","rotation","addChild","bounces","alive","update","dtMs","norm","scaled","pow","deficit","maxPerFrame","smooth","ceil","toSpawn","i","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","abs","j","splice","WeatherSnow","flakes","maxFlakes","circle","drift","settled","life","phase","restMs","f","sin","sYwater","sYlava","gAcc","WeatherClouds","bandHeight","patches","filters","BlurFilter","quality","rebuild","nv","count","w","h","rx","ry","circles","baseR","k","PI","dist","cx","cos","cy","cur","W","bandBottom","osc","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","_applyAlphas","resize","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","curInt","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","moveTo","lineTo","stroke","alignment","cap","join","branchCount","len","ang","bx","by","worldX","maxH","isSolid","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","spd","d","size","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","_regions","_waterTex","_lavaTex","_time","_noiseTex","_playerState","setPlayerState","playerState","_checkPlayerInRegion","region","px","py","pw","ph","getBounds","getSurfaceY","X","topEdges","mw","mh","ts","changed","waterDrift","lavaDrift","sprite","playerInRegion","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","exp","ampNow","amp","capG","dy","centerX","dx","sigma","gauss","maxDisp","build","typeAt","liquid","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","bleed","_createLavaTexture","_createWaterTexture","source","addressMode","tiling","_computeTopEdgeSpans","createLinearGradient","addColorStop","fillStyle","fillRect","globalAlpha","Set","tilesByRow","above","rowList","cols","entries","sort","start","prev","addWave","HealthBar","options","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","visible","c","pct","_redrawFill","roundRect","innerW","freeze","parallax","tiles","tilesAnim","objBehind","secretsBelow","objFront","secretsAbove","weather","fog","liquids","liquidFx","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","ParallaxBackground","textureCache","cache","bgSprite","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","minWidth","minHeight","hex","parseInt","slice","solid","Sprite","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","editorIcon","Text","dropShadow","dropShadowColor","dropShadowBlur","dropShadowDistance","anchor","createPlayerContainer","playerVisuals","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","hit","setPreferences","skipCacheIdWarning","preferCreateImageBitmap","EMPTY_ARRAY","EMPTY_OBJECT","PixiStage","backgroundImage","isEditor","isPixiReady","setIsPixiReady","mountRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","cameraPosRef","bgRef","bgAnimRef","bgImageRef","bgColorRef","objBehindRef","objFrontRef","secretLayerRef","playerRef","playerLayerRef","playerSpriteRefs","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidSystemRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","projectilesLayerRef","projectileSpritesRef","entitiesLayerRef","entitySpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","overlayLayerRef","underwaterRef","targetAlpha","currentAlpha","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","headUnder","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","split","createSolidChecker","wx","wy","collision","top","bottom","left","right","rebuildParallax","useCallback","layer","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","screen","destroyed","async","app","Application","resizeTo","backgroundAlpha","antialias","autoDensity","renderer","stage","sortableChildren","bg","bgAnim","secretBelowLayer","secretAboveLayer","playerLayer","entitiesLayer","weatherLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","overlayLayer","LAYERS","below","urlSet","addUrl","add","urls","playerComponents","innerHTML","appendChild","hbOverlay","oxyColors","oxyBar","lavaColors","lvBar","preventDefault","ticker","updatePlayerSprite","refs","inLava","effectiveWidth","isHit","dir","mag","scale","sw","sh","camX","camY","pivot","position","deltaMS","systems","sNow","overlayL","inLiquid","overlayColor","pulseBase","fadeSpeed","alphaDiff","lastLiquidType","fadeOutSpeed","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","baseX","baseY","hbO","show","nextBarY","maxOxy","curOxy","maxLv","curLv","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","syncEntities","entitySpritesMap","entitiesList","ent","_lastFrameIndex","isTextureReady","spriteSheet","columns","frameIndex","currentSpriteIndex","texWidth","texHeight","totalSprites","effectiveColumns","frameWidth","frameHeight","col","row","Rectangle","frame","targetWidth","targetHeight","isNaN","absScaleX","entities","appToDestroy","values","cleanupProjectiles","cleanupEntities","active","rebuildLayers","safeDestroy","removeChildren","child","secretOverlayTilesBelow","secretOverlayTilesAbove","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","filterColor","filterColorInGame","renderAbove","renderAbovePlayer","renderOnSecretLayer","backing","isPushable","visualElement","healthPercent","frameTexture","isHiddenInGame","isDestructible","hb","match","parseFloat","pLayer","tileDataString","prevTileDataString","_lastTileData","prepare","upload","runRebuild","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","propTypes","PropTypes","isRequired","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerIndex","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","beepFallback","vol","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","frequency","setValueAtTime","exponentialRampToValueAtTime","connect","destination","stop","moveHorizontal","MOVE_SPEED","checkCollision","friction","acceleration","targetVx","sign","proposedX","step","safeX","nextX","applyVerticalPhysics","GRAVITY","TERMINAL_VELOCITY","JUMP_FORCE","isWaterAt","prevInWater","LIQ_TERMINAL","headY","chestY","space","swimImpulse","getLiquidAtPixel","mapWidthTiles","mapHeightTiles","tileData","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","feet","chest","head","candidate","tickLiquidDamage","deltaMs","accRef","gameState","HIT_FLASH_MS","updateFrame","objectData","input","constants","helpers","isInitialized","lastTimeRef","projectilesRef","entitiesRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","getLiquidSample","collectItem","checkInteractables","checkHazardDamage","checkSecrets","spawnProjectile","playSfx","updateProjectiles","setPlayer","onGameOver","continue","iceResist","maxIceResist","backgroundLayer","layers","l","getSurfaceProperties","isSlippery","currentIceRes","maxIce","effectiveFriction","ratio","targetFriction","checkCollisionExtended","isExploding","pt","isPushing","pushTarget","currentStrength","isAlreadyAtMax","lastPushTime","pushDist","overlapDist","isNextToLeft","isNextToRight","pushForce","sounds","lastPushSoundTime","vp","liquidParams","sample","maxLava","oxy","lavaRes","oxyParams","lavaParams","tickDepleteDps","dpsValue","currentAmmo","mouseLeft","playerX","playerY","entity","animFrame","animTimer","totalFrames","animations","explode","frameDuration","shouldRemove","liquidSample","prevInLiquid","water_splash","lava_splash","sinkingSpeed","idle","mapW","mapH","arrowId","foundArrowDef","tx","ty","arrowsLayer","aDef","nextY","ai","reactionDist","reactionDistance","shootDist","shootDistance","sqrt","canJump","shootCooldown","isShooting","spawnX","spawnY","patrol","hitSomething","other","stayOnPlatform","groundX","groundY","frameSpeed","checkEntityCollision","explodeAnim","anims","currentAnim","frameDur","updateEntities","knockbackDir","onStateUpdate","damage","maxX","winCountSpeed","onIce","isSolidAtPixel","secretData","objId","objDef","isEntity","toLowerCase","passableHealthThreshold","tileId","tileDef","newX","newY","feetY","slipperiness","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","String","logData","message","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","trim","useGameEngine","onRevealSecret","useInput","clearKeys","handleKeyDown","tag","tagName","typing","isContentEditable","repeat","handleMouseDown","handleMouseUp","handleKeyUp","onToggleTerminal","passive","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","projectileIdRef","soundEnabledRef","audioCtxUnlockedRef","onStateUpdateRef","onRevealSecretRef","onGameOverRef","objectMetadataRef","revealedSecretsRef","onToggle","onUserGesture","playShotSfx","audio","Audio","pause","once","checkHazardDamageWrapper","objectLayerData","candidates","pushCandidate","touch","damageDirections","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","distTop","distBottom","distLeft","distRight","sideScore","chosen","prevIndex","damageOnce","baseDamage","immediate","TICK_MS","errorHandler","component","function","playerPosition","damageType","localRevealedRef","lastMapIdRef","currentMapId","date_map_last_updated","date_map_created_at","isNewMapLoad","initialEntities","objLayer","findIndex","startX","startY","playerId","registryPlayer","maxXAtStart","mapHeightParam","widthOverride","heightOverride","checkCollisionExternal","TILE_SIZE_OVERRIDE","tileDataOverride","registryItemsOverride","secretDataOverride","objectDataOverride","objectMetadataOverride","isSolidAtPixelExternal","originX","originY","ownerId","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","proj","cwt","collisionWithTiles","hbs","hitboxScale","ric","dmg","spawnProjectileExternal","td","ri","isWaterAtPixel","liq","sampleLiquid","aabb","objectLayer","centerY","gridX","itemId","itemDef","pickup","effect","healthBonus","newHealth","fireball","ammoBonus","currentMeta","triggerId","destId","destMeta","usedInteractables","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","checkObjectHit","checkEntityHit","ex","ey","ew","eh","checkPlayerHit","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","steps","stepTime","removed","hitEntX","hitIdxX","sp","hypot","jitter","hitEntY","hitIdxY","res","requestAnimationFrame","cancelAnimationFrame","HeaderContainer","AmmoDisplay","RightSection","BarsContainer","BarWrapper","BarFill","attrs","$percent","$color","BarLabel","GameHeader","hpPercent","oxyPercent","lavaPercent","icePercent","strengthPercent","commands","register","cmd","listCommands","description","executeCommand","raw","handler","panelStyleBase","fontFamily","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","setTimeout","focus","onKey","scrollTop","scrollHeight","transform","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","__GAME_RUNTIME_SETTINGS__","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","minimized","setMinimized","pos","setPos","setSize","draggingRef","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onOpen","onMove","clientX","clientY","onUp","onResize","emitUpdate","patch","panelStyle","userSelect","contentStyle","buttonStyle","marginLeft","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","defaultValue","_Fragment","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","BackgroundMusicPlayer","audioRef","currentSrcRef","musicContext","cleanup","resolveUrl","loop","onGesture","val","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapInfo","WinCounterOverlay","ModalDivider","FileUploadLabel","label","HiddenFileInput","Viewport","$blurred","GameCanvas","PlaceholderMessage","Game","viewportRef","runtimeSettings","setRuntimeSettings","handleStateUpdate","currentId","alert","handleGameOver","mapToLoad","loadMapData","indices","onSettingsUpdate","handleOpenModalEvent","weatherFogLegacy","objData","bgLayer","secretLayer","hasSecretsLayer","secretDataLength","secretDataNonNull","secretDataSample","mapName","dimensions","author","accept","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","backgroundMusic","contents","suggestedName","mimeType","showSaveFilePicker","types","writable","createWritable","blob","Blob","write","close","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","selectedTile","brushSize","getCurrentData","setCurrentData","newData","targetX","AnimatedItem","setIndex","interval","setInterval","clearInterval","imgSrc","total","rows","maxWidth","maxHeight","draggable","selectedBackgroundUrl","selectedBackgroundColor","selectedBackgroundImage","showGrid","activeLayer","activeTool","hoverIndex","highlightedIndex","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseDown","handleGridMouseEnter","handleGridMouseUp","handleGridMouseLeave","setIsDragging","onMouseUp","onMouseLeave","pointerEvents","opacity","links","portals","targets","x1","y1","x2","y2","strokeWidth","strokeDasharray","backgroundRepeat","backgroundSize","gridTemplateColumns","gridTemplateRows","_","displayTileId","displayObjectId","displaySecretId","selX","selY","selectionIndex","tileObj","objObj","secretObj","isSelected","isPreviewSelection","originalX","originalY","isMoveSelecting","isMoveHover","hx","hy","sx","minX","minY","maxY","isBrushTarget","isBucketTarget","isBucketPreview","borderStyle","bgStyle","isHighlighted","isLiquidTile","isWaterTile","isLavaTile","backgroundStyleObj","onMouseEnter","boxSizing","objectFit","textShadow","filterColorInEditor","baseButtonStyle","marginRight","textDecoration","activeButtonStyle","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","confirmNewMap","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","lastHeightRef","offsetHeight","handleMouseMove","getBoundingClientRect","borderTopLeftRadius","borderTopRightRadius","PaletteSection","setIsOpen","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","objectId","tile","obj","strokeStyle","lineWidth","beginPath","portal","setLineDash","imageRendering","MapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","ToolbarWindows","creatorName","openNewMapModal","saveMap","loadMap","setShowGrid","clearMap","isPlayMode","handlePlay","handlePause","handleReset","setActiveTool","setBrushSize","moveSelection","setSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","handlePaletteSelect","blocks","decorations","interactables","hazards","secrets","backgroundOptions","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","musicOptions","selectedBackgroundMusic","setSelectedBackgroundMusic","totalTiles","filledBlocks","emptyBlocks","objectsCount","setObjectMetadata","onMapResize","setHighlightedIndex","activePanel","setActivePanel","isMinimapOpen","setIsMinimapOpen","setIsSettingsOpen","isResizeWindowOpen","setIsResizeWindowOpen","togglePanel","panel","sidebarButtonStyle","activeSidebarButtonStyle","borderRight","panelHeaderStyle","paddingBottom","panelTitleStyle","renderPaletteItem","hasImage","isLiquid","isWater","isSecret","swatchStyle","BlockEraser","ObjectEraser","SecretEraser","paddingTop","flexWrap","li","fontStyle","el","querySelector","scrollX","clientWidth","scrollY","clientHeight","scrollTo","behavior","Editor","setMapWidth","setMapHeight","setTileMapData","setObjectMapData","setSecretMapData","setSelectedTile","setHoverIndex","setActiveLayer","setDragStart","setBucketPreviewIndices","isMovingSelection","setIsMovingSelection","setPreviewPosition","originalMapData","setOriginalMapData","bucketTimerRef","stateRef","setMapName","setCreatorName","createdAt","setCreatedAt","isNewMapModalOpen","setIsNewMapModalOpen","loadBackgroundOptions","loadMusicOptions","handleSaveMap","currentDate","version","statistics","total_tiles","filled_tiles","total_objects","total_items","json","saveFile","setIsPlayMode","editorSnapshot","setEditorSnapshot","setPlayerPosition","setRevealedSecrets","playModeObjectData","setPlayModeObjectData","playModeSecretData","setPlayModeSecretData","mapDataForGame","handleRevealSecret","secretIndex","gameEngineState","selectedBgOption","newMetadata","metadataChanged","newTileMap","tileMap","newObjectMap","objectMap","newSecretMap","secretMap","destX","destY","destIdx","srcDataIdx","confirm","normalized","playData","spawnIndex","pauseData","playerIndex","resetData","handleMapResize","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","oldMeta","resizeArray","oldArr","newArr","oldM","newM","oldIdx","newIdx","resizeMetadata","floodFill","targetId","clearTimeout","endX","selTileData","selObjectData","selSecretData","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","render","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App"],"ignoreList":[],"sourceRoot":""}