{"version":3,"file":"static/js/main.fece9b91.js","mappings":"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","sources":["webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/config.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/weather/LavaRain.js","webpack://element_masters/./src/Pixi/effects/weather/RadioactiveFog.js","webpack://element_masters/./src/Pixi/effects/weather/MeteorRain.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/sections/chapters/game/PixiStage/floatingTextManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/entityManager.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables/context.js","webpack://element_masters/./src/engine/gameplay/interactables/spawn.js","webpack://element_masters/./src/engine/gameplay/interactables/doors.js","webpack://element_masters/./src/engine/gameplay/interactables/teleport.js","webpack://element_masters/./src/engine/gameplay/interactables/effects.js","webpack://element_masters/./src/engine/gameplay/secrets/reveal.js","webpack://element_masters/./src/engine/gameplay/secrets/triggers.js","webpack://element_masters/./src/engine/gameplay/secrets/wolfSecret.js","webpack://element_masters/./src/engine/gameplay/secrets/crackBlock.js","webpack://element_masters/./src/engine/gameplay/interactables/checkInteractables.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/engine/gameplay/weatherDamage.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/engine/gameplay/weatherCover.js","webpack://element_masters/./src/engine/gameplay/entities.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/weatherEffects.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/constants/builtInMaps.js","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/mapOperations.js","webpack://element_masters/./src/sections/chapters/editor/viewport/ObjectLinks.jsx","webpack://element_masters/./src/sections/chapters/editor/viewport/EditorTile.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorToolsButton.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorElementsButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorTools/BuiltInMapsModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/EditorMapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WorldView.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/BackgroundPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/MusicPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WeatherPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorSceneButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/EditorScene.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/OperationsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/CollapsiblePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/PalettePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/StatisticsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/ObjectPropsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorElements.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorTools.jsx","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPlayMode.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorOperations.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/paintingTools.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPainting.js","webpack://element_masters/./src/sections/chapters/editor/Editor.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorMaps.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorRegistry.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorSelection.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js","webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.(ogg%7Cmp3%7Cwav%7Cm4a)$i"],"sourcesContent":["var map = {\n\t\"./blocks/block_pack_01/dirt_block_0002.png\": 8625,\n\t\"./blocks/block_pack_01/dirt_block_0003.png\": 2967,\n\t\"./blocks/block_pack_01/dirt_block_0004.png\": 7800,\n\t\"./blocks/block_pack_01/dirt_block_0005.png\": 2017,\n\t\"./blocks/block_pack_01/dirt_block_0006.png\": 1850,\n\t\"./blocks/block_pack_01/ice_block_0001.png\": 9745,\n\t\"./blocks/brick_block_0001.png\": 3611,\n\t\"./blocks/desert_pack_01/desert_pack_0001.png\": 7741,\n\t\"./blocks/desert_pack_01/desert_pack_0002.png\": 182,\n\t\"./blocks/desert_pack_01/desert_pack_0003.png\": 1727,\n\t\"./blocks/desert_pack_01/desert_pack_0004.png\": 6352,\n\t\"./blocks/desert_pack_01/desert_pack_0005.png\": 2601,\n\t\"./blocks/desert_pack_01/desert_pack_0006.png\": 6018,\n\t\"./blocks/desert_pack_01/desert_pack_0007.png\": 6523,\n\t\"./blocks/desert_pack_01/desert_pack_0008.png\": 5132,\n\t\"./blocks/desert_pack_01/desert_pack_0009.png\": 1045,\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 9538,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./decorations/stone_pack_01/stone_pack_01_001.png\": 1978,\n\t\"./decorations/stone_pack_01/stone_pack_01_002.png\": 4526,\n\t\"./decorations/stone_pack_01/stone_pack_01_003.png\": 7928,\n\t\"./decorations/stone_pack_01/stone_pack_01_004.png\": 9447,\n\t\"./decorations/stone_pack_01/stone_pack_01_005.png\": 1134,\n\t\"./decorations/stone_pack_01/stone_pack_01_006.png\": 8485,\n\t\"./decorations/stone_pack_01/stone_pack_01_007.png\": 3036,\n\t\"./decorations/stone_pack_01/stone_pack_01_008.png\": 7195,\n\t\"./decorations/stone_pack_01/stone_pack_01_009.png\": 9330,\n\t\"./decorations/stone_pack_01/stone_pack_01_010.png\": 2952,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 8905,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./entities/tanks/tank_0000.png\": 2386,\n\t\"./entities/tanks/tank_0001.png\": 3563,\n\t\"./entities/tanks/tank_0002.png\": 5232,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./hazards/death_block_0001.png\": 3527,\n\t\"./interactables/arrows/arrow_down.png\": 7152,\n\t\"./interactables/arrows/arrow_left.png\": 8047,\n\t\"./interactables/arrows/arrow_right.png\": 592,\n\t\"./interactables/arrows/arrow_up.png\": 7263,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./interactables/doors/door_0001.png\": 175,\n\t\"./interactables/ends/end_0001.png\": 8597,\n\t\"./interactables/platforms/platform_0001.png\": 9427,\n\t\"./interactables/portals/portal_01/portal_A_001.png\": 8518,\n\t\"./interactables/portals/portal_01/portal_A_002.png\": 3933,\n\t\"./interactables/portals/portal_01/portal_A_003.png\": 692,\n\t\"./interactables/portals/portal_01/portal_A_004.png\": 5499,\n\t\"./interactables/portals/portal_01/portal_A_005.png\": 3954,\n\t\"./interactables/portals/portal_01/portal_A_006.png\": 8489,\n\t\"./interactables/portals/portal_01/portal_A_007.png\": 4288,\n\t\"./interactables/portals/portal_01/portal_A_008.png\": 8519,\n\t\"./interactables/portals/portal_01/portal_A_009.png\": 2734,\n\t\"./interactables/portals/portal_01/portal_A_010.png\": 3124,\n\t\"./interactables/portals/portal_01/portal_A_011.png\": 4253,\n\t\"./interactables/portals/portal_01/portal_A_012.png\": 6838,\n\t\"./interactables/portals/portal_01/portal_A_013.png\": 5583,\n\t\"./interactables/portals/portal_01/portal_A_014.png\": 9712,\n\t\"./interactables/portals/portal_01/portal_A_015.png\": 5465,\n\t\"./interactables/portals/portal_01/portal_A_016.png\": 1458,\n\t\"./interactables/stone_0001.png\": 1020,\n\t\"./interactables/wooden_box_0001.png\": 1169,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205,\n\t\"./secrets/crack_block.png\": 2789\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","var map = {\n\t\"./City.png\": 3676,\n\t\"./Forest.png\": 6370,\n\t\"./UndergroundCave.png\": 2445,\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719,\n\t\"./seamless_07.png\": 6390\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 2201;","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/brick_block_0001.json\": 544,\n\t\"./blocks/desert_block_0001.json\": 6918,\n\t\"./blocks/desert_block_0002.json\": 8359,\n\t\"./blocks/desert_block_0003.json\": 324,\n\t\"./blocks/desert_block_0004.json\": 2149,\n\t\"./blocks/desert_block_0005.json\": 5418,\n\t\"./blocks/desert_block_0006.json\": 5531,\n\t\"./blocks/desert_block_0007.json\": 4136,\n\t\"./blocks/desert_block_0008.json\": 329,\n\t\"./blocks/desert_block_0009.json\": 9518,\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/dirt_block_0002.json\": 5655,\n\t\"./blocks/dirt_block_0003.json\": 4932,\n\t\"./blocks/dirt_block_0004.json\": 5653,\n\t\"./blocks/dirt_block_0005.json\": 8970,\n\t\"./blocks/dirt_block_0006.json\": 2251,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/hazard/death_block_0001.json\": 698,\n\t\"./blocks/liquids/lava_block.json\": 9649,\n\t\"./blocks/liquids/lava_waterfall_block.json\": 9104,\n\t\"./blocks/liquids/quicksand_block.json\": 1924,\n\t\"./blocks/liquids/radioactive_water_block.json\": 1408,\n\t\"./blocks/liquids/radioactive_waterfall_block.json\": 8317,\n\t\"./blocks/liquids/water_block.json\": 8606,\n\t\"./blocks/liquids/waterfall_block.json\": 119,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./decorations/stone_pack_01_001.json\": 5247,\n\t\"./decorations/stone_pack_01_002.json\": 5134,\n\t\"./decorations/stone_pack_01_003.json\": 9593,\n\t\"./decorations/stone_pack_01_004.json\": 9840,\n\t\"./decorations/stone_pack_01_005.json\": 2867,\n\t\"./decorations/stone_pack_01_006.json\": 7618,\n\t\"./decorations/stone_pack_01_007.json\": 9069,\n\t\"./decorations/stone_pack_01_008.json\": 9588,\n\t\"./decorations/stone_pack_01_009.json\": 3975,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./entities/tank_0000.json\": 9381,\n\t\"./entities/tank_0001.json\": 8938,\n\t\"./entities/tank_0002.json\": 9179,\n\t\"./interactables/arrows/arrow_down.json\": 3741,\n\t\"./interactables/arrows/arrow_left.json\": 4636,\n\t\"./interactables/arrows/arrow_right.json\": 9821,\n\t\"./interactables/arrows/arrow_up.json\": 7852,\n\t\"./interactables/blocks/ice_block_0001.json\": 5742,\n\t\"./interactables/doors/door_0001.json\": 6332,\n\t\"./interactables/ends/end_0001.json\": 9318,\n\t\"./interactables/harvestables/berry_bush_01.json\": 7562,\n\t\"./interactables/harvestables/berry_bush_01_used.json\": 3614,\n\t\"./interactables/physics/stone_0001.json\": 9095,\n\t\"./interactables/physics/wooden_box_0001.json\": 1116,\n\t\"./interactables/platforms/platform_0001.json\": 2008,\n\t\"./interactables/portals/portal_001.json\": 2190,\n\t\"./interactables/portals/portal_target.json\": 5206,\n\t\"./items/ammunition/fireball_ammo.json\": 7289,\n\t\"./items/health/hertz_item.json\": 3321,\n\t\"./obstacles/hazards/bushes_001.json\": 6447,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/crack_block.json\": 6854,\n\t\"./secrets/message_trigger.json\": 3746,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/room_area.json\": 4547,\n\t\"./secrets/secret_area_a.json\": 1866,\n\t\"./secrets/secret_area_b.json\": 3227,\n\t\"./secrets/secret_area_c.json\": 3880,\n\t\"./secrets/wolf_secret_down.json\": 7716,\n\t\"./secrets/wolf_secret_left.json\": 7157,\n\t\"./secrets/wolf_secret_right.json\": 9950,\n\t\"./secrets/wolf_secret_up.json\": 8577,\n\t\"./system/floating_text.json\": 7794,\n\t\"./system/weather_damage.json\": 6234,\n\t\"./weather/weather_clouds_off.json\": 8264,\n\t\"./weather/weather_clouds_on.json\": 9138,\n\t\"./weather/weather_clouds_value.json\": 6592,\n\t\"./weather/weather_fog_off.json\": 4870,\n\t\"./weather/weather_fog_on.json\": 9560,\n\t\"./weather/weather_fog_value.json\": 1374,\n\t\"./weather/weather_lava_rain_off.json\": 4159,\n\t\"./weather/weather_lava_rain_on.json\": 7795,\n\t\"./weather/weather_meteor_rain_off.json\": 8421,\n\t\"./weather/weather_meteor_rain_on.json\": 2097,\n\t\"./weather/weather_radioactive_fog_off.json\": 8304,\n\t\"./weather/weather_radioactive_fog_on.json\": 6298,\n\t\"./weather/weather_rain_off.json\": 8312,\n\t\"./weather/weather_rain_on.json\": 914,\n\t\"./weather/weather_rain_value.json\": 7664,\n\t\"./weather/weather_snow_off.json\": 8445,\n\t\"./weather/weather_snow_on.json\": 969,\n\t\"./weather/weather_snow_value.json\": 5409,\n\t\"./weather/weather_thunder_off.json\": 628,\n\t\"./weather/weather_thunder_on.json\": 1006,\n\t\"./weather/weather_thunder_value.json\": 6756\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  objectMetadata: {}, // Track metadata per object position { index: { health: 100, etc } }\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  projectMaps: {}, // For Project v2.0 (multi-map)\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n  activeRoomIds: [], // IDs of currently active rooms (overlays)\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      const { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.objectMetadata = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {}; // Load initial metadata from map\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.activeRoomIds = []; // Reset active rooms on new map load\n      state.isGameOver = false;\n\n      // If this is a project (v2.0) with multiple maps\n      if (mapData?.maps) {\n        state.projectMaps = mapData.maps;\n      }\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    updateObjectMetadata: (state, action) => {\n      const { index, metadata, mapId } = action.payload;\n      if (!mapId || mapId === 'main') {\n        state.objectMetadata[index] = {\n          ...(state.objectMetadata[index] || {}),\n          ...metadata\n        };\n      } else if (state.projectMaps[mapId]) {\n        if (!state.projectMaps[mapId].objectMetadata) {\n          state.projectMaps[mapId].objectMetadata = {};\n        }\n        state.projectMaps[mapId].objectMetadata[index] = {\n          ...(state.projectMaps[mapId].objectMetadata[index] || {}),\n          ...metadata\n        };\n      }\n    },\n    removeObjectAtIndex: (state, action) => {\n      const { index, mapId } = typeof action.payload === 'object' ? action.payload : { index: action.payload, mapId: null };\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = null;\n        }\n      } else if (state.projectMaps[mapId]) {\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          // Make sure we are working with a fresh array if we want to trigger changes reliably\n          room.objectMapData = [...room.objectMapData];\n        }\n        \n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = null;\n        }\n      }\n    },\n    removeTileAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.tileMapData[index] !== undefined) {\n        state.tileMapData[index] = null;\n      }\n    },\n    moveTileInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.tileMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.tileMapData[fromIndex] === undefined) return;\n      state.tileMapData[toIndex] = state.tileMapData[fromIndex];\n      state.tileMapData[fromIndex] = null;\n    },\n    moveObjectInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.objectMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.objectMapData[fromIndex] === undefined) return;\n      state.objectMapData[toIndex] = state.objectMapData[fromIndex];\n      state.objectMapData[fromIndex] = null;\n      \n      // Move metadata as well\n      if (state.objectMetadata[fromIndex]) {\n        state.objectMetadata[toIndex] = state.objectMetadata[fromIndex];\n        delete state.objectMetadata[fromIndex];\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId, mapId } = action.payload;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = newId;\n        }\n      } else if (state.projectMaps[mapId]) {\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          room.objectMapData = [...room.objectMapData];\n        }\n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = newId;\n        }\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    toggleRoom: (state, action) => {\n      const roomId = action.payload;\n      if (state.activeRoomIds.includes(roomId)) {\n        state.activeRoomIds = state.activeRoomIds.filter(id => id !== roomId);\n      } else {\n        state.activeRoomIds.push(roomId);\n      }\n    },\n    clearRooms: (state) => {\n      state.activeRoomIds = [];\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  updateObjectMetadata,\n  removeObjectAtIndex,\n  removeTileAtIndex,\n  moveTileInMap,\n  moveObjectInMap,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  toggleRoom,\n  clearRooms,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"en\",\n        fallbackLng: \"en\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation\n            },\n            no: {\n                navigation: no_navigation\n            },\n            en: {\n                navigation: en_navigation\n            },\n            ru: {\n                navigation: ru_navigation\n            },\n            ja: {\n                navigation: ja_navigation\n            },\n        },\n    })\n\nexport default i18n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n\n        </nav>\n    )\n}\n\n/*\n<NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n* */","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\nimport { useState, useRef, useEffect } from \"react\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    height: 36px;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nconst DropdownContainer = styled.div`\n    position: relative;\n    display: flex;\n`\n\nconst DropdownMenu = styled.div`\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background-color: #333;\n    border: 1px solid #444;\n    border-radius: 4px;\n    padding: 10px;\n    z-index: 2000;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n    min-width: 150px;\n    margin-top: 5px;\n`\n\nconst MenuItem = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px;\n    color: white;\n    font-size: 12px;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &:hover {\n        background-color: #444;\n    }\n`\n\nconst ToggleSwitch = styled.div`\n    width: 34px;\n    height: 18px;\n    background-color: ${props => props.$active ? '#f4c542' : '#666'};\n    border-radius: 9px;\n    position: relative;\n    transition: background-color 0.3s;\n\n    &::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        left: ${props => props.$active ? '18px' : '2px'};\n        width: 14px;\n        height: 14px;\n        background-color: white;\n        border-radius: 50%;\n        transition: left 0.3s;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const dropdownRef = useRef(null);\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    const currentLang = i18n.language || 'en'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    const toggleSound = () => {\n        const next = !soundEnabled;\n        setSoundEnabled(next);\n        try { localStorage.setItem('game_sound_enabled', next ? '1' : '0'); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n    };\n\n    useEffect(() => {\n        const handleClickOutside = (event) => {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n                setIsMenuOpen(false);\n            }\n        };\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n\n            <DropdownContainer ref={dropdownRef}>\n                <NavButton onClick={() => setIsMenuOpen(!isMenuOpen)} title=\"Settings\">\n                    \n                </NavButton>\n                {isMenuOpen && (\n                    <DropdownMenu>\n                        <MenuItem onClick={toggleSound}>\n                            <span>Sound Effects</span>\n                            <ToggleSwitch $active={soundEnabled} />\n                        </MenuItem>\n                        <div style={{ height: '1px', backgroundColor: '#444', margin: '5px 0' }} />\n                        <div style={{ padding: '5px 8px', fontSize: '10px', color: '#888' }}>\n                            GAME SETTINGS\n                        </div>\n                    </DropdownMenu>\n                )}\n            </DropdownContainer>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    text-transform: uppercase;\n    margin: 0;\n    line-height: 1.1;\n\n    .tagline {\n        font-size: 0.7rem;\n        letter-spacing: 0.04em;\n        text-transform: lowercase;\n        opacity: 0.7;\n    }\n`\n\nexport function SectionHeaderNavigationLogo() {\n    const tag = (process.env.APP_GIT_TAG || '').trim();\n\n    return (\n        <StyledLogo>\n            <span>Element Masters</span>\n            {tag ? <span className=\"tagline\">{tag.toLowerCase()}</span> : null}\n        </StyledLogo>\n    )\n}\n","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\nlet _registryMap = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        _registryMap = new Map();\n        _registry.forEach(item => {\n            if (item && item.id) _registryMap.set(item.id, item);\n        });\n        _registry.__byId = _registryMap;\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    if (!_registry) return null;\n    if (_registryMap) return _registryMap.get(id) || null;\n    return _registry.find(item => item.id === id);\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n\n        </div>\n      )\n    }\n\nexport default App\n/*\n <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n* */","import Logo1 from './assets/logo/Logo1.png';\nimport Logo2 from './assets/logo/Logo2.png';\nimport Logo3 from './assets/logo/Logo3.png';\nimport Logo4 from './assets/logo/Logo4.png';\nimport Logo5 from './assets/logo/Logo5.png';\n\nconst config = {\n    apiUrl: (typeof process !== 'undefined' && process.env?.REACT_APP_API_URL) || 'http://localhost:8000',\n\n    logo: {\n        URL_LOGO_01: Logo1,\n        URL_LOGO_02: Logo2,\n        URL_LOGO_03: Logo3,\n        URL_LOGO_04: Logo4,\n        URL_LOGO_05: Logo5,\n    },\n\n};\n\nexport default config\n","import React from 'react'\nimport styled from 'styled-components'\nimport config from '../../config'\n\nconst HomeContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    //background-color: darkred;\n    \n    .logoRow{\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        width: 100%;\n        height: auto;\n        margin: 10px;\n        //border: solid 1px red;\n        \n        & img {\n            width: 350px;\n        }\n    }\n`\n\nexport default function Home() {\n    const LOGO_01 = config.logo.URL_LOGO_01\n    const LOGO_02 = config.logo.URL_LOGO_02\n    const LOGO_03 = config.logo.URL_LOGO_03\n    const LOGO_04 = config.logo.URL_LOGO_04\n    const LOGO_05 = config.logo.URL_LOGO_05\n    console.log(LOGO_01, LOGO_02, LOGO_03, LOGO_04, LOGO_05)\n\n    return (\n        <HomeContainer>\n           <div className={\"logoRow\"}>\n               <img src={LOGO_01} alt=\"logo\" />\n               <img src={LOGO_02} alt=\"logo\" />\n               <img src={LOGO_03} alt=\"logo\" />\n               <img src={LOGO_04} alt=\"logo\" />\n\n           </div>\n        </HomeContainer>\n    )\n}\n","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on viewport area to keep FPS stable\n    this.maxParticles = 400; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(160, Math.floor(area / 2300));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.rect(0, 0, 1.3, 9);\n    g.fill({ color: 0x4aa3ff, alpha: 0.92 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus a small margin for slanted fall\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 100 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    this.seeded = false;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = 300; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxFlakes = Math.max(120, Math.floor(area / 3000));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(options = null) {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.circle(0, 0, r);\n    g.fill({ color: 0xffffff, alpha: 0.97 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus margin\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      const minY = options && Number.isFinite(options.minY) ? options.minY : (viewport.y - 10);\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : (viewport.y - 40);\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    } else {\n      x = Math.random() * this.width;\n      const minY = options && Number.isFinite(options.minY) ? options.minY : -10;\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : -40;\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    }\n\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    if (target === 0) {\n      this.seeded = false;\n    }\n\n    const deficit = target - this.flakes.length;\n    if (!this.seeded && target > 0) {\n      const viewportH = viewport ? viewport.height : this.height;\n      const viewportY = viewport ? viewport.y : 0;\n      const seedCount = Math.min(target, Math.max(24, Math.floor(this.maxFlakes * 0.35)));\n      for (let i = 0; i < seedCount; i++) {\n        this.spawnOne({\n          minY: viewportY - viewportH * 0.35,\n          maxY: viewportY + viewportH * 0.9\n        });\n      }\n      this.seeded = true;\n    }\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40 || (viewport && f.y > viewport.y + viewport.height + 100)) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n    this.windDirection = 1; // 1: from left to right, -1: from right to left\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(isInitial = false) {\n    const g = new Graphics();\n    const w = 140 + Math.random() * 300; // cloud size\n    const h = 80 + Math.random() * 160;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : this.width;\n\n    let x;\n    if (isInitial) {\n      // Initial scatter across the whole viewport (or map if no viewport)\n      const range = Math.max(vW, this.width) + 800;\n      const startX = viewport ? vX - 400 : -400;\n      x = startX + Math.random() * range;\n    } else if (viewport) {\n      // Dynamic spawn: place in or near viewport so the user sees results quickly\n      // We scatter them in a wider area around viewport [x-400, x+width+400]\n      x = viewport.x - 400 + Math.random() * (viewport.width + 800);\n    } else {\n      // Fallback to edges\n      x = (Math.random() < 0.5 ? -180 : this.width + 180);\n    }\n    \n    const y = vY - 40 + Math.random() * (this.bandHeight - 20); // only in band\n    const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n    const speed = 8 + Math.random() * 22; // horizontal drift speed\n    const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n    // Draw an organic cloud using overlapping circles (soft edges)\n    const rx = w * 0.5;\n    const ry = h * 0.5;\n    const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n    const baseR = Math.min(rx, ry) * 0.55;\n    for (let k = 0; k < circles; k++) {\n      const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n      const dist = 0.2 + Math.random() * 0.35;\n      const cx = Math.cos(t) * rx * dist;\n      const cy = Math.sin(t) * ry * dist;\n      const r = baseR * (0.7 + Math.random() * 0.7);\n      g.circle(cx, cy, r);\n    }\n    // central mass\n    g.circle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n    g.fill({ color: 0xffffff, alpha: 1.0 });\n    g.alpha = 0; // Start invisible for fade-in\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.patches.push({ \n      g, w, h, \n      vx: speed * this.windDirection, \n      vy, \n      targetAlpha: alpha, \n      currentAlpha: 0,\n      phase: Math.random() * Math.PI * 2,\n      dying: false\n    });\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    // We don't change this.width/height here as they are map bounds,\n    // but we can update bandHeight if the screen height changed significantly.\n    this.bandHeight = Math.max(1, Math.floor(h * 0.3)); \n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vW = viewport ? viewport.width : 1280;\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    for (let i = 0; i < targetCount; i++) {\n      this.spawnOne(true);\n      // For initial ones, set alpha immediately\n      if (this.patches.length > 0) {\n        const p = this.patches[this.patches.length - 1];\n        p.currentAlpha = p.targetAlpha;\n        p.g.alpha = p.currentAlpha;\n      }\n    }\n  }\n\n  update(dtMs) {\n    // Live intensity update with smoothing\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : 1280;\n    const vH = viewport ? viewport.height : 720;\n\n    const bandTop = vY - 100;\n    const bandBottom = vY + this.bandHeight;\n\n    // Adjust cloud count gradually\n    // We scale target count based on viewport width (default 18 for 1280px)\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    const activePatches = this.patches.filter(p => {\n      if (p.dying) return false;\n      if (!viewport) return true;\n      // Only count patches that are within a reasonable distance of the viewport\n      return p.g.x > vX - 1000 && p.g.x < vX + vW + 1000;\n    });\n    \n    if (activePatches.length < targetCount) {\n      // Spawn one cloud per ~300ms if needed, to avoid sudden pops\n      this._spawnTimer = (this._spawnTimer || 0) + dtMs;\n      if (this._spawnTimer > 300 || activePatches.length === 0) {\n        this.spawnOne(activePatches.length === 0);\n        this._spawnTimer = 0;\n      }\n    } else if (activePatches.length > targetCount) {\n      // Mark one for death\n      const toKill = activePatches[0];\n      if (toKill) toKill.dying = true;\n    }\n\n    const toRemove = [];\n    for (let i = 0; i < this.patches.length; i++) {\n      const p = this.patches[i];\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // Alpha handling\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      \n      // Cleanup if too far from viewport (e.g. teleport)\n      if (viewport && !p.dying && (p.g.x < vX - 2500 || p.g.x > vX + vW + 2500)) {\n        p.dying = true;\n      }\n\n      if (p.dying) {\n        p.currentAlpha -= dt * 0.1; // Fade out slowly\n        if (p.currentAlpha <= 0) {\n          toRemove.push(i);\n          continue;\n        }\n      } else if (p.currentAlpha < p.targetAlpha) {\n        p.currentAlpha += dt * 0.05; // Fade in slowly\n        if (p.currentAlpha > p.targetAlpha) p.currentAlpha = p.targetAlpha;\n      }\n\n      p.g.alpha = Math.max(0, Math.min(0.55, p.currentAlpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      const margin = 800; // Increased margin to ensure they don't pop out visibly\n      if (viewport) {\n          const leftBound = vX - margin;\n          const rightBound = vX + vW + margin;\n          if (p.g.x < leftBound) p.g.x = rightBound;\n          if (p.g.x > rightBound) p.g.x = leftBound;\n      } else {\n          if (p.g.x < -margin) p.g.x = W + margin;\n          if (p.g.x > W + margin) p.g.x = -margin;\n      }\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n\n    // Remove dead patches\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.patches[idx];\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n      this.patches.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    // We draw a large rectangle to cover the viewport\n    g.rect(0, 0, w, h);\n    g.fill({ color: 0x9fb7c9, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      // Follow camera\n      if (this.g) this.g.x = viewport.x;\n      if (this.layer1) this.layer1.x = viewport.x;\n      if (this.layer2) this.layer2.x = viewport.x;\n      \n      // We also need to follow Y if the map is tall\n      if (this.g) this.g.y = viewport.y;\n      if (this.layer1) this.layer1.y = viewport.y;\n      if (this.layer2) this.layer2.y = viewport.y;\n    }\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.25, 0.9, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.8, 1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    \n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      g.x = viewport.x;\n      g.y = viewport.y;\n      g.rect(0, 0, viewport.width, viewport.height);\n    } else {\n      g.rect(0, 0, this.width, this.height);\n    }\n    g.fill({ color: 0xffffff, alpha: this.flashAlpha });\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, topY;\n    if (viewport) {\n      // Strike within viewport\n      x = Math.floor(viewport.x + this._rand(8, viewport.width - 8));\n      topY = viewport.y - Math.floor(this._rand(10, 40));\n    } else {\n      x = Math.floor(this._rand(8, W - 8));\n      topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    }\n\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2, 5, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xCCEEFF;\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n    g.stroke({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n      g.stroke({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Graphics } from 'pixi.js';\n\n// Lava rain system: similar to rain but red/orange and potentially deals damage (handled by engine)\nexport default class WeatherLavaRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 300; \n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(120, Math.floor(area / 3000));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Lava drops are slightly thicker and more glowing\n    g.rect(0, 0, 2, 10);\n    // Glowing yellow/orange color\n    const color = Math.random() > 0.3 ? 0xffaa00 : 0xffcc00;\n    g.fill({ color, alpha: 0.95 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 400 + Math.random() * 400; // slightly slower/heavier than water rain\n    const vx = (Math.random() * 40 - 20); \n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.1; \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, alive: true });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    let target = Math.floor(this.maxParticles * norm);\n    if (norm > 0 && target < 5) target = 5;\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      const toSpawn = Math.min(deficit, Math.max(1, Math.ceil(target * 0.02)), 30);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    \n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (p) {\n          try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n        }\n      }\n    }\n\n    const dt = dtMs / 1000;\n    const gAcc = 1200; \n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.vy += gAcc * dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Interaction with surfaces / water\n      if (this.api.getLiquidSurfaceY) {\n        const waterY = this.api.getLiquidSurfaceY('water', p.x);\n        if (Number.isFinite(waterY) && p.y >= waterY) {\n          if (typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: waterY, strength: 0.9 });\n          }\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Interaction with solid surfaces\n      if (this.api.isSolidAt(p.x, p.y)) {\n         // Lava drops just vanish on hit with a tiny \"ember\" effect (optional)\n         if (typeof this.api.onLavaImpact === 'function' && Math.random() > 0.5) {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: 0.2 });\n         }\n         p.alive = false;\n         toRemove.push(i);\n         continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 50 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Radioactive fog overlay: similar to fog but toxic green\nexport default class WeatherRadioactiveFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0;\n\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    this.noiseTex = WeatherRadioactiveFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    this.layer2 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    \n    this.layer1.tileScale.set(1.2, 1.2);\n    this.layer2.tileScale.set(0.7, 0.9);\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100;\n    return Math.max(0, Math.min(0.75, t * 0.75));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0);\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    g.rect(0, 0, w, h);\n    // Toxic green tint\n    g.fill({ color: 0x1a5c1a, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      if (this.g) { this.g.x = viewport.x; this.g.y = viewport.y; }\n      if (this.layer1) { this.layer1.x = viewport.x; this.layer1.y = viewport.y; }\n      if (this.layer2) { this.layer2.x = viewport.x; this.layer2.y = viewport.y; }\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    const pulse = 1 + 0.06 * Math.sin(this.time * 0.001);\n    this._applyAlphas(pulse);\n\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    if (this.layer1) { try { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); } catch {} }\n    if (this.layer2) { try { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); } catch {} }\n    this.layer1 = null; this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.3 + 0.4 * t);\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.7;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    this.speed1 = { x: lerp(0.004, 0.02, t), y: lerp(0.0, 0.01, t) };\n    this.speed2 = { x: lerp(-0.005, -0.015, t), y: lerp(0.003, 0.015, t) };\n  }\n\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 180 + Math.floor(Math.random() * 75); \n      img.data[i] = v * 0.4;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v * 0.4;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Meteor rain system: large falling fireballs that can deal damage via API callback\nexport default class WeatherMeteorRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 15; // Meteors are rare and large\n  }\n\n  resize(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n  spawnOne() {\n    const size = 4 + Math.random() * 8; // Meteor radius\n    const isLarge = size > 9;\n    \n    const g = new Graphics();\n    g.clear();\n    \n    // Core\n    g.circle(0, 0, size);\n    g.fill({ color: 0x555555, alpha: 1 });\n    \n    // Glow/Fire\n    g.circle(0, 0, size * 1.5);\n    g.fill({ color: 0xff4500, alpha: 0.4 });\n    \n    // Tail\n    g.moveTo(-size, 0);\n    g.lineTo(0, -size * 4);\n    g.lineTo(size, 0);\n    g.fill({ color: 0xff8c00, alpha: 0.6 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 200 + Math.random() * (viewport.width + 400);\n      y = viewport.y - 100 - Math.random() * 200;\n    } else {\n      x = Math.random() * this.width;\n      y = -100 - Math.random() * 200;\n    }\n\n    const vx = 100 + Math.random() * 100; // slanted fall\n    const vy = 400 + Math.random() * 300;\n    \n    g.x = x;\n    g.y = y;\n    // Rotate towards fall direction\n    g.rotation = Math.atan2(vy, vx) - Math.PI/2;\n    \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, size, isLarge, alive: true });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0005 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = this.intensity / 100;\n    const target = Math.floor(this.maxParticles * norm);\n\n    if (this.particles.length < target && Math.random() < 0.02 * norm) {\n      this.spawnOne();\n    }\n\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Check collision with solid world\n      if (this.api.isSolidAt(p.x, p.y)) {\n        // Explosion effect\n        if (typeof this.api.onLavaImpact === 'function') {\n           this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.5 : 0.8 });\n        }\n        \n        // Notify engine about meteor hit for damage\n        if (typeof this.api.onMeteorHit === 'function') {\n           this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge });\n        }\n\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      if (viewport && (p.y > viewport.y + viewport.height + 100 || p.x > viewport.x + viewport.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      } else if (!viewport && (p.y > this.height + 100 || p.x > this.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.circle(d.x, d.y, size);\n      g.fill({ color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.circle(r.x, r.y, r.r);\n      g.stroke({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      g.stroke({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n\n      // glowing ember\n      g.circle(e.x, e.y, emberSize);\n      g.fill({ color: 0xffa229, alpha: 0.9 * emberAlpha });\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.circle(p.x, p.y, radius);\n      g.fill({ color: 0xdfdad2, alpha: Math.max(0, alpha) });\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite, Sprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.bgContainer = opts.bgContainer || null;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n\n    // Use multiple sample points for better precision\n    // 1. Center\n    const points = [\n      { x: px + pw * 0.5, y: py + ph * 0.5 },\n      { x: px + pw * 0.5, y: py + ph * 0.1 }, // Top\n      { x: px + pw * 0.5, y: py + ph * 0.9 }, // Bottom\n    ];\n\n    for (const pt of points) {\n      const gx = Math.floor(pt.x / this.tileSize);\n      const gy = Math.floor(pt.y / this.tileSize);\n      const idx = gy * this.mapWidth + gx;\n      if (region.tileIndicesSet && region.tileIndicesSet.has(idx)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { if (r.bgNode && r.bgNode.parent) r.bgNode.parent.removeChild(r.bgNode); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n        try { r.bgNode?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._quicksandTex?.destroy(true); } catch {}\n    try { this._waterfallTex?.destroy(true); } catch {}\n    try { this._lavaWaterfallTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    try { this._lavaDetailTex?.destroy(true); } catch {}\n    try { this._waterDetailTex?.destroy(true); } catch {}\n    try { this._quicksandDetailTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    if (this._gradTextures) {\n      for (const k in this._gradTextures) {\n        try { this._gradTextures[k].destroy(true); } catch {}\n      }\n      this._gradTextures = null;\n    }\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.bgNode?.parent && r.bgNode.parent.removeChild(r.bgNode); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n      try { r.bgNode?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      try { this._quicksandTex?.destroy(true); } catch {}\n      try { this._waterfallTex?.destroy(true); } catch {}\n      try { this._lavaWaterfallTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n      try { this._lavaDetailTex?.destroy(true); } catch {}\n      try { this._waterDetailTex?.destroy(true); } catch {}\n      try { this._quicksandDetailTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null; this._quicksandTex = null; this._waterfallTex = null;\n      this._lavaWaterfallTex = null;\n      this._radioactiveWaterTex = null; this._radioactiveWaterfallTex = null;\n      this._lavaDetailTex = null; this._waterDetailTex = null; this._quicksandDetailTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0, y: 0 }; // Static (bubbles added via texture/noise)\n    const lavaDrift = { x: 0, y: 0 }; // Static (floating pieces added via noise/texture)\n    const quicksandDrift = { x: 0, y: 0 }; // Static (pixels fade via noise)\n    const waterfallDrift = { x: 0, y: 0.15 }; // Fast vertical drift\n    const lavaWaterfallDrift = { x: 0, y: 0.12 }; // Lava falls a bit slower/thicker\n    const radioactiveWaterDrift = { x: 0, y: 0 }; // Static\n    const radioactiveWaterfallDrift = { x: 0, y: 0.12 }; // Match lava waterfall speed or similar\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : (r.type === 'quicksand' ? quicksandDrift : (r.type === 'waterfall' ? waterfallDrift : (r.type === 'lava_waterfall' ? lavaWaterfallDrift : (r.type === 'radioactive_waterfall' ? radioactiveWaterfallDrift : (r.type === 'radioactive_water' ? radioactiveWaterDrift : waterDrift)))));\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly with smooth transitions)\n      let targetAlpha = 0.95;\n      if (r.type === 'water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.50 : 0.95;\n      } else if (r.type === 'quicksand') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.70 : 1.0;\n      } else if (r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.40 : 0.65;\n      } else if (r.type === 'radioactive_water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.55 : 0.90;\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.60 : 0.98;\n      }\n\n      // Smooth transition (lerp)\n      if (r.currentAlpha === undefined) r.currentAlpha = sprite.alpha;\n      const lerpFactor = 0.005; // Adjust for speed of transition\n      const alphaDiff = targetAlpha - r.currentAlpha;\n      r.currentAlpha += alphaDiff * Math.min(1, dt * lerpFactor);\n      sprite.alpha = r.currentAlpha;\n\n      // Splash animation for waterfalls\n      if ((r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') && r.splashG && Array.isArray(r.bottomEdges)) {\n        const g = r.splashG;\n        g.clear();\n        const thickness = Math.max(2, Math.floor(this.tileSize * 0.25));\n        const F = 1000;\n        const cycle = (this._time % F) / F;\n        \n        for (const e of r.bottomEdges) {\n          // Animated foam/splash at the bottom\n          const splashHeight = thickness * (0.8 + Math.sin(this._time * 0.01 + e.x) * 0.2);\n          g.rect(e.x, e.y + this.tileSize - splashHeight, e.w, splashHeight);\n          \n          // Bubbles\n          for (let k = 0; k < 5; k++) {\n             const bx = e.x + ((e.x * 13 + k * 37 + this._time * 0.05) % e.w);\n             const by = e.y + this.tileSize - (Math.random() * thickness * 2);\n             g.circle(bx, by, 1 + Math.random() * 2);\n          }\n        }\n        const splashColor = r.type === 'lava_waterfall' ? 0xffcc00 : (r.type === 'radioactive_waterfall' ? 0xadff2f : 0xffffff);\n        g.fill({ color: splashColor, alpha: 0.5 + Math.sin(this._time * 0.02) * 0.2 });\n      }\n\n      // Animate noise/detail overlays\n      if (r.noise1) {\n        if (r.type === 'water') {\n          r.noise1.tilePosition.y -= 0.015 * dt; // Bubbles go UP\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.001) * 0.005 * dt; \n        } else if (r.type === 'lava') {\n          r.noise1.tilePosition.x += 0.004 * dt; \n          r.noise1.tilePosition.y += 0.002 * dt;\n        } else if (r.type === 'quicksand') {\n          // Fade effect for pixels\n          r.noise1.alpha = 0.4 + Math.sin(this._time * 0.001) * 0.2;\n          r.noise1.tilePosition.x += 0.001 * dt;\n        } else if (r.type.includes('waterfall')) {\n          r.noise1.tilePosition.y += drift.y * 0.8 * dt;\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.002) * 0.02 * dt;\n        } else {\n          r.noise1.tilePosition.x += 0.008 * dt;\n          r.noise1.tilePosition.y += 0.004 * dt;\n        }\n      }\n      if (r.noise2) {\n        if (r.type === 'quicksand') {\n          r.noise2.alpha = 0.2 + Math.cos(this._time * 0.0015) * 0.1;\n        } else if (r.type.includes('waterfall')) {\n          r.noise2.tilePosition.y += drift.y * 1.2 * dt;\n        } else {\n          r.noise2.tilePosition.x -= 0.005 * dt;\n          r.noise2.tilePosition.y += 0.003 * dt;\n        }\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.rect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.fill({ color: 0xc9ecff, alpha: 0.35 });\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.lava_waterfall) return 'lava_waterfall';\n      if (def.flags.radioactive_waterfall) return 'radioactive_waterfall';\n      if (def.flags.waterfall) return 'waterfall';\n      if (def.flags.radioactive_water) return 'radioactive_water';\n      if (def.flags.quicksand) return 'quicksand';\n      if (def.flags.lava) return 'lava';\n      if (def.flags.water) return 'water';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n      _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n        const node = new Container();\n        const mask = new Graphics();\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        const tileIndicesSet = new Set(tileIndices);\n\n        mask.clear();\n        const bleed = 1; // Palielints bleed, lai nosegtu spraugas\n        for (let k = 0; k < tileIndices.length; k++) {\n          const idx = tileIndices[k];\n          const gx = (idx % mapWidth);\n          const gy = Math.floor(idx / mapWidth);\n          mask.rect(\n            gx * tileSize - bleed,\n            gy * tileSize - bleed,\n            tileSize + bleed * 2,\n            tileSize + bleed * 2\n          );\n        }\n        mask.fill({ color: 0xffffff, alpha: 1 });\n\n        const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                     : (type === 'quicksand' ? (this._quicksandTex || (this._quicksandTex = this._createQuicksandTexture(tileSize)))\n                                     : (type === 'waterfall' ? (this._waterfallTex || (this._waterfallTex = this._createWaterfallTexture(tileSize)))\n                                     : (type === 'lava_waterfall' ? (this._lavaWaterfallTex || (this._lavaWaterfallTex = this._createLavaWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_waterfall' ? (this._radioactiveWaterfallTex || (this._radioactiveWaterfallTex = this._createRadioactiveWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_water' ? (this._radioactiveWaterTex || (this._radioactiveWaterTex = this._createRadioactiveWaterTexture(tileSize)))\n                                     : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize))))))));\n        \n        // v8 addressMode iestatana\n        if (tex.source && tex.source.style) {\n          tex.source.style.addressMode = 'repeat';\n        }\n\n        const tiling = new TilingSprite({\n          texture: tex,\n          width: worldW,\n          height: worldH\n        });\n        \n        tiling.tileScale.set(1, 1);\n        tiling.alpha = type === 'lava' ? 0.98 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.6 : 0.92);\n        node.addChild(tiling);\n\n        // Noise/Detail sli\n        let detailTex1, detailTex2;\n        if (type.includes('lava')) {\n          detailTex1 = this._lavaDetailTex || (this._lavaDetailTex = this._createLavaDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type === 'quicksand') {\n          detailTex1 = this._quicksandDetailTex || (this._quicksandDetailTex = this._createQuicksandDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type.includes('radioactive')) {\n          detailTex1 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n          detailTex2 = this._noiseTex;\n        } else {\n          // water, waterfall\n          detailTex1 = this._waterDetailTex || (this._waterDetailTex = this._createWaterDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        }\n\n        if (detailTex1.source && detailTex1.source.style) detailTex1.source.style.addressMode = 'repeat';\n        if (detailTex2.source && detailTex2.source.style) detailTex2.source.style.addressMode = 'repeat';\n\n        const noise1 = new TilingSprite({ texture: detailTex1, width: worldW, height: worldH });\n        const noise2 = new TilingSprite({ texture: detailTex2, width: worldW, height: worldH });\n        \n        if (type === 'water' || type === 'radioactive_water') {\n          noise1.alpha = 0.25; noise2.alpha = 0.15;\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          noise1.alpha = 0.2; noise2.alpha = 0.15;\n        } else if (type === 'lava') {\n          noise1.alpha = 0.4; noise2.alpha = 0.2;\n        } else if (type === 'quicksand') {\n          noise1.alpha = 0.6; noise2.alpha = 0.3;\n        } else {\n          noise1.alpha = 0.12; noise2.alpha = 0.15;\n        }\n        node.addChild(noise1, noise2);\n\n        // LABOJUMS: Maska tiek pievienota k brns, lai t sekotu ldzi node koordintm\n        node.addChild(mask);\n        node.mask = mask;\n\n        // Background slnis (zIndex 28) - lai aizsegtu fonu caur deni\n        let bgNode = null;\n        if (this.bgContainer) {\n          bgNode = new Container();\n          const bgMask = new Graphics();\n          bgMask.clear();\n          for (let k = 0; k < tileIndices.length; k++) {\n            const idx = tileIndices[k];\n            const gx = (idx % mapWidth);\n            const gy = Math.floor(idx / mapWidth);\n            bgMask.rect(gx * tileSize - bleed, gy * tileSize - bleed, tileSize + bleed * 2, tileSize + bleed * 2);\n          }\n          bgMask.fill({ color: 0xffffff, alpha: 1 });\n          bgNode.addChild(bgMask);\n          bgNode.mask = bgMask;\n\n          const bgG = new Graphics();\n          let minY = Infinity, maxY = -Infinity;\n          for (let k = 0; k < tileIndices.length; k++) {\n            const gy = Math.floor(tileIndices[k] / mapWidth) * tileSize;\n            if (gy < minY) minY = gy;\n            if (gy + tileSize > maxY) maxY = gy + tileSize;\n          }\n\n          if (!this._gradTextures) this._gradTextures = {};\n          if (!this._gradTextures[type]) {\n            let color, bottomColor;\n            if (type.includes('lava')) {\n              color = '#ffaa00'; bottomColor = '#884400';\n            } else if (type.includes('radioactive')) {\n              color = '#004400'; bottomColor = '#001100';\n            } else if (type === 'quicksand') {\n              color = '#5d4037'; bottomColor = '#2d1d19';\n            } else { \n              color = '#3a7fb8'; bottomColor = '#0b1d2e';\n            }\n            this._gradTextures[type] = this._createGradientTexture(color, bottomColor);\n          }\n\n          const bgSprite = new Sprite(this._gradTextures[type]);\n          bgSprite.width = worldW;\n          bgSprite.height = worldH;\n          bgSprite.y = 0;\n          \n          bgNode.addChild(bgSprite);\n          this.bgContainer.addChild(bgNode);\n        }\n\n        const baseAlpha = type === 'lava' ? 0.98 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.6 : 0.92);\n\n        if (type === 'water' || type === 'radioactive_water') {\n          const capG = new Graphics();\n          node.addChild(capG);\n          const topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n          // Saglabjam atsauces uz r reistr\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          const splashG = new Graphics();\n          node.addChild(splashG);\n          const bottomEdges = this._computeBottomEdgeSpans(tileIndices, mapWidth, tileSize);\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, splashG, bottomEdges, tileIndicesSet, currentAlpha: baseAlpha });\n        } else {\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        }\n\n        this.container.addChild(node);\n      }\n\n      _createGradientTexture(topColor, bottomColor) {\n        const canvas = document.createElement('canvas');\n        const size = 64; \n        canvas.width = 2; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, topColor);\n        g.addColorStop(1, bottomColor);\n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, 2, size);\n        return Texture.from(canvas);\n      }\n\n  _createWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient to remove horizontal bars\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // No horizontal gradient to remove bars\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    // Lava pieces/streaks (vertical) - these go down\n    ctx.fillStyle = '#ffed8a';\n    for (let k = 0; k < 10; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 15;\n      const w = 3 + Math.random() * 4; // Wider \"chunks\"\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid sand color\n    ctx.fillStyle = '#a6915b';\n    ctx.fillRect(0, 0, size, size);\n\n    // grainy texture (static here, will animate pixels via noise)\n    ctx.globalAlpha = 0.3;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 25; k++) {\n      ctx.fillRect(Math.random() * size, Math.random() * size, 1, 1);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Background color\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 15; k++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.4;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 25;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid toxic green\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Some mini bubbles (static here, noise provides movement)\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random() * 1.5, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.15 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 8 + Math.random() * 15;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n    \n    // Pievienojam burbuus (prasba: \"var pieveinot burbuus kuri iet uzleju k radioactive water\")\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 6; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random(), 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ff8800'; \n    for (let i = 0; i < 10; i++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      const sw = 12 + Math.random() * 24;\n      const sh = 10 + Math.random() * 20;\n      ctx.fillRect(Math.random() * w, Math.random() * h, sw, sh);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createWaterDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < 12; i++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * w, Math.random() * h, 1 + Math.random() * 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#5c5031';\n    for (let i = 0; i < 100; i++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.5;\n      ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 256, h = 256) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = '#ffffff';\n    for(let i=0; i<500; i++) {\n      ctx.globalAlpha = Math.random() * 0.05;\n      ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its bottom boundary per row.\n  _computeBottomEdgeSpans(tileIndices, mapWidth, tileSize) {\n    const set = new Set(tileIndices);\n    const spans = [];\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const below = idx + mapWidth;\n      if (!set.has(below)) {\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.roundRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.fill({ color: this._trackColor, alpha: 0.85 });\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.roundRect(0, 0, innerW, h, radius);\n    this._fill.fill({ color: this._color, alpha: 1 });\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  tiles: 20,\n  tilesAnim: 25,\n  liquidBackground: 28,\n  objBehind: 30,\n  secretsBelow: 35,\n  player: 40,\n  projectiles: 50,\n  objFront: 60,\n  secretsAbove: 65,\n  weather: 70,\n  fog: 80,\n  liquids: 90,\n  liquidFx: 100,\n  overlay: 110,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#3a7fb8');\n    g.addColorStop(0.5, '#5ba3d9');\n    g.addColorStop(1, '#3a7fb8');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (yellow to golden)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#ffaa00');\n    g.addColorStop(1, '#ffcc00');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffff00');\n      grad.addColorStop(1, '#ffaa00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffffff';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\nexport const isQuicksandDef = (def) => !!(def && def.flags && def.flags.quicksand);\nexport const isWaterfallDef = (def) => !!(def && def.flags && def.flags.waterfall);\nexport const isLavaWaterfallDef = (def) => !!(def && def.flags && def.flags.lava_waterfall);\nexport const isRadioactiveWaterDef = (def) => !!(def && def.flags && def.flags.radioactive_water);\nexport const isRadioactiveWaterfallDef = (def) => !!(def && def.flags && def.flags.radioactive_waterfall);\n\n// Generate procedural quicksand frames (cached per tile size)\nexport const createQuicksandFrames = (tileSize) => {\n  const frames = [];\n  const F = 12; // slightly more frames for smoother slow movement\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base sand color (brownish yellow)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#a6915b');\n    g.addColorStop(1, '#7d6d42');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // grainy texture / swirling patterns\n    const t = i / F;\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 4; k++) {\n       const y = Math.floor((tileSize / 4) * k + (t * tileSize)) % tileSize;\n       ctx.fillRect(0, y, tileSize, 1);\n    }\n    \n    // random grains\n    ctx.globalAlpha = 0.15;\n    ctx.fillStyle = '#d1ba7d';\n    const count = Math.max(5, Math.floor(tileSize * 0.25));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 43 + i * 7) % tileSize);\n      const ry = Math.floor((k * 61 + i * 11) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural waterfall frames\nexport const createWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent blue (izmantojam dens krsas)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(42, 93, 143, 0.5)');\n    g.addColorStop(0.5, 'rgba(91, 163, 217, 0.5)');\n    g.addColorStop(1, 'rgba(42, 93, 143, 0.5)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // sas vertiklas svtrias\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    const count = 6;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.3);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava waterfall frames\nexport const createLavaWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent lava colors\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(255, 170, 0, 0.6)');\n    g.addColorStop(0.5, 'rgba(255, 204, 0, 0.6)');\n    g.addColorStop(1, 'rgba(255, 170, 0, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated lava streaks\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';\n    const count = 5;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.4);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive water frames\nexport const createRadioactiveWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 12;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient (toxic green)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#1a5c1a');\n    g.addColorStop(1, '#0d2e0d');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    \n    // Bubbles\n    ctx.globalAlpha = 0.6;\n    ctx.fillStyle = '#32cd32';\n    const bubbleCount = 4;\n    for (let k = 0; k < bubbleCount; k++) {\n      const bx = Math.floor((k * 137 + i * 2) % tileSize);\n      const by = Math.floor((tileSize + k * 43 - (t * tileSize + k * 10)) % tileSize);\n      const size = 1 + (Math.sin(t * Math.PI + k) * 0.5 + 0.5) * 2;\n      ctx.beginPath();\n      ctx.arc(bx, by, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Glow streaks\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#adff2f';\n    for (let b = 0; b < 2; b++) {\n      const y = Math.floor((tileSize / 2) * b + Math.sin((t + b * 0.5) * Math.PI * 2) * (tileSize * 0.1));\n      ctx.fillRect(0, y, tileSize, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive waterfall frames\nexport const createRadioactiveWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 16; // more frames for slower motion\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(26, 92, 26, 0.6)');\n    g.addColorStop(0.5, 'rgba(50, 205, 50, 0.6)');\n    g.addColorStop(1, 'rgba(26, 92, 26, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    ctx.fillStyle = 'rgba(173, 255, 47, 0.5)';\n    const count = 4; // fewer streaks\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.2);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3, minWidth = 0, minHeight = 0 }) {\n    if (!this.container) return;\n    this.clear();\n\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = w;\n    solid.height = h;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: w, height: h });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = h / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight, minWidth = 0, minHeight = 0) {\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = w;\n      this.bgSprite.height = h;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = w;\n      this.imgSprite.height = h;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = h / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl, minWidth = 0, minHeight = 0 } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n      minWidth,\n      minHeight\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const resize = (worldWidth, worldHeight, minWidth = 0, minHeight = 0) => {\n    if (parallaxHelper) {\n      parallaxHelper.resize(worldWidth, worldHeight, minWidth, minHeight);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    resize,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container, Text } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n\n  // Ja nav tekstru masva vai tas ir tuks, minm parasto tekstru\n  if (!spr && def.texture) {\n    const tex = getTexture(def.texture);\n    if (tex) {\n      spr = new Sprite(tex);\n    }\n  }\n\n  // Ja joprojm nav spr (piemram, nav tekstras), prbaudm editorIcon\n  if (!spr && def.editorIcon) {\n    spr = new Text({\n        text: def.editorIcon,\n        style: {\n            fontSize: 24,\n            fill: 0xffffff,\n            fontWeight: 'bold',\n            dropShadow: true,\n            dropShadowColor: 0x000000,\n            dropShadowBlur: 4,\n            dropShadowDistance: 2\n        }\n    });\n    // Centrjam tekstu tile ietvaros\n    spr.anchor.set(0.5, 0.5);\n    // T k ms lietojam anchor 0.5, mums bs jpielgo pozcija vlk vai eit\n    // Bet buildSpriteFromDef parasti atgrie objektu, kura anchor ir (0,0) pc noklusjuma\n    // lai tas atbilstu tileSize pozicionanai.\n    // Tpc iestatsim anchor uz 0, bet nedaudz nobdsim?\n    // Labk lietot anchor 0.5 un layerBuilder- pieskaitt tileSize/2.\n  }\n\n  if (!spr) {\n    spr = new Sprite(Texture.WHITE);\n  }\n\n  if (spr instanceof Sprite) {\n    spr.anchor.set(0, 0);\n  } else if (spr instanceof Text) {\n    // Tekstam ms gribam, lai tas btu centr, tpc atstjam 0.5\n  }\n  \n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = Math.round(dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth));\n  container.y = Math.round(playerState.y || 0);\n};\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef, isQuicksandDef, isWaterfallDef, isLavaWaterfallDef, isRadioactiveWaterDef, isRadioactiveWaterfallDef, createWaterFrames, createLavaFrames, createQuicksandFrames } from './liquidRendering';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const { bgRef, objBehindRef, objFrontRef, roomBgRef, roomObjBehindRef, roomObjFrontRef, secretLayerRef } = refs;\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous and destroy old children to prevent memory leaks/ticker buildup\n  const safeDestroy = (container) => {\n    if (!container) return;\n    const children = container.removeChildren();\n    children.forEach(child => {\n      try {\n        // Destroy child but KEEP textures in cache\n        child.destroy({ children: true, texture: false });\n      } catch (e) {}\n    });\n  };\n\n  safeDestroy(bgRef);\n  safeDestroy(objBehindRef);\n  safeDestroy(objFrontRef);\n  safeDestroy(roomBgRef);\n  safeDestroy(roomObjBehindRef);\n  safeDestroy(roomObjFrontRef);\n  safeDestroy(secretLayerRef?.below);\n  safeDestroy(secretLayerRef?.above);\n\n  const secretOverlays = {\n    below: new Map(),\n    above: new Map()\n  };\n\n  // 1. Render main map\n  renderMapContent(refs, options, 0, 0, secretOverlays, bgRef, objBehindRef, objFrontRef);\n\n  // 2. Render active rooms\n  const { activeRoomIds, maps, objectMetadata, secretMapData, mapWidth, tileSize } = options;\n  if (activeRoomIds && activeRoomIds.length > 0 && maps && objectMetadata && secretMapData) {\n    activeRoomIds.forEach(roomId => {\n      const roomMap = maps[roomId];\n      if (!roomMap) return;\n\n      // Find the room_area on the current map that links to this room\n      const roomAreaIndex = Object.keys(objectMetadata).find(idx => \n        secretMapData[idx] === 'room_area' && objectMetadata[idx].linkedMapId === roomId\n      );\n\n      if (roomAreaIndex !== undefined) {\n        const idx = parseInt(roomAreaIndex);\n        const ox = Math.round((idx % mapWidth) * tileSize);\n        const oy = Math.round(Math.floor(idx / mapWidth) * tileSize);\n        \n        const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n        \n        const roomOptions = {\n          ...options,\n          mapWidth: roomMap.mapWidth || roomMap.width,\n          mapHeight: roomMap.mapHeight || roomMap.height,\n          tileMapData: roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [],\n          objectMapData: roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [],\n          secretMapData: roomSecrets,\n          objectMetadata: roomMap.objectMetadata || {},\n          mapType: 'room',\n          backgroundColor: roomMap.selectedBackgroundColor,\n          activeRoomIds: [] // Avoid recursion\n        };\n\n        renderMapContent(refs, roomOptions, ox, oy, secretOverlays, roomBgRef, roomObjBehindRef, roomObjFrontRef);\n      }\n    });\n  }\n\n  // 3. Render collected secret overlays\n  renderSecretOverlays(refs, options, secretOverlays);\n};\n\nconst renderMapContent = (refs, options, offsetX, offsetY, secretOverlays, targetBg, targetObjBehind, targetObjFront) => {\n  const {\n    mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData,\n    revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType,\n    activeRoomIds, maps\n  } = options;\n\n  const { secretLayerRef } = refs;\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Pre-calculate indices covered by active rooms to hide main map content under them\n  const activeRoomIndices = new Set();\n  const roomWindowIndices = new Set(); // Store indices where rooms have windows\n\n  if (mapType !== 'room' && activeRoomIds && activeRoomIds.length > 0 && maps) {\n      Object.entries(objectMetadata || {}).forEach(([idxStr, meta]) => {\n          const idx = parseInt(idxStr);\n          if (secretMapData?.[idx] === 'room_area' && meta?.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n              const roomMap = maps[meta.linkedMapId];\n              if (!roomMap) return;\n\n              const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n              const rw = meta.width || 1;\n              const rh = meta.height || 1;\n              const rx = idx % mapWidth;\n              const ry = Math.floor(idx / mapWidth);\n              const rMapW = roomMap.mapWidth || roomMap.width || rw;\n\n              for (let dy = 0; dy < rh; dy++) {\n                  for (let dx = 0; dx < rw; dx++) {\n                      const worldIdx = (ry + dy) * mapWidth + (rx + dx);\n                      const localIdx = dy * rMapW + dx;\n                      \n                      // In the main map context, roomWindowIndices are spots where we DON'T hide the main map\n                      // because the room has a \"hole\" (window) there.\n                      // A \"hole\" is defined as no tile AND no object in the room map.\n                      const roomTiles = roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [];\n                      const roomObjs = roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [];\n                      \n                      if (!roomTiles[localIdx] && !roomObjs[localIdx]) {\n                          roomWindowIndices.add(worldIdx);\n                          activeRoomIndices.add(worldIdx); // Also hide main map tiles here to see background through windows\n                      } else {\n                          activeRoomIndices.add(worldIdx);\n                      }\n                  }\n              }\n          }\n      });\n  }\n\n  // Add background color for rooms\n  if (mapType === 'room') {\n    const bgColorStr = options.backgroundColor || '#1a1a1a';\n    const bgColorHex = bgColorStr.startsWith('#') ? \n        parseInt(bgColorStr.substring(1), 16) : \n        0x1a1a1a;\n    \n    const roomBg = new Graphics();\n    const floorTileIds = new Set(tileMapData.filter(id => id));\n    const floorObjIds = new Set(objectMapData.filter(id => id && !id.includes('player')));\n\n    for (let i = 0; i < mapWidth * mapHeight; i++) {\n        const id = tileMapData[i];\n        const objId = objectMapData[i];\n        \n        // Window logic: if there is no tile AND no object, it's a window (transparent)\n        // Be very strict about what counts as content\n        const hasContent = (id && id !== \"0\") || (objId && objId !== \"0\" && !objId.includes('player'));\n\n        if (hasContent) {\n            const tx = i % mapWidth;\n            const ty = Math.floor(i / mapWidth);\n            const x = offsetX + tx * tileSize;\n            const y = offsetY + ty * tileSize;\n            \n            // Use a slightly larger rect (0.5px) to prevent gaps/bleeding between tiles\n            // but keep the overall room boundary sharp\n            roomBg.rect(x - 0.25, y - 0.25, tileSize + 0.5, tileSize + 0.5);\n        }\n    }\n    roomBg.fill({ color: bgColorHex, alpha: 1 });\n    targetBg.addChild(roomBg);\n  }\n\n  // Background tiles\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    const secretId = secretMapData?.[i];\n\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    // Hide content if it's under an active room\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area'; // Don't treat room_area as a classic secret filter if it's used as a window\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n\n    if (isInSecretArea && isSecretRevealed) {\n      const filterColor = secretDef?.filterColorInGame || secretDef?.filterColor || 'rgba(0, 0, 0, 0.6)';\n      const renderAbove = secretDef?.renderAbovePlayer;\n      const key = `${x},${y}`;\n      if (renderAbove) {\n        secretOverlays.above.set(key, filterColor);\n      } else {\n        secretOverlays.below.set(key, filterColor);\n      }\n    }\n\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      renderOnSecretLayer = true;\n    } else if (isInSecretArea && isSecretRevealed) {\n      renderOnSecretLayer = true;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def) || isWaterfallDef(def) || isLavaWaterfallDef(def) || isRadioactiveWaterDef(def) || isRadioactiveWaterfallDef(def) || def.type === 'entity' || def.subtype === 'platform') {\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    if (renderOnSecretLayer) {\n      let backingSprite;\n      if (frames && frames.length > 0) {\n        backingSprite = new AnimatedSprite(frames);\n        backingSprite.animationSpeed = sprite.animationSpeed;\n        backingSprite.play();\n      } else if (sprite.texture) {\n        backingSprite = new Sprite(sprite.texture);\n      }\n\n      if (backingSprite) {\n        backingSprite.x = x;\n        backingSprite.y = y;\n        backingSprite.width = tileSize;\n        backingSprite.height = tileSize;\n        targetBg.addChild(backingSprite);\n      }\n\n      const backing = new Graphics();\n      backing.rect(x, y, tileSize, tileSize);\n      backing.fill({ color: 0x000000, alpha: 0.7 });\n      targetBg.addChild(backing);\n\n      sprite.alpha = 0.4;\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        targetBg.addChild(sprite);\n      }\n    } else {\n      targetBg.addChild(sprite);\n    }\n  }\n\n  // Objects\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n\n    const secretId = secretMapData?.[i];\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    const def = getDef(id);\n    if (!def || def.type === 'entity' || def.subtype === 'platform' || def.subtype === 'pushable' || def.isPushable) continue;\n\n    const meta = (objectMetadata && objectMetadata[i]) || {};\n    const maxH = def.maxHealth || 100;\n    const health = meta.health !== undefined ? meta.health : maxH;\n\n    let visualElement;\n    if (def.spriteSheet && def.spriteSheet.enabled) {\n      const totalSprites = def.spriteSheet.totalSprites || 1;\n      const columns = def.spriteSheet.columns || totalSprites;\n      \n      const healthPercent = Math.max(0, Math.min(100, (health / maxH) * 100));\n      let frameIndex = 0;\n      \n      if (meta.currentFrame !== undefined) {\n        frameIndex = meta.currentFrame;\n      } else if (def.subtype === 'door' && mapType === 'room') {\n        frameIndex = def.interaction?.frames?.inside || 2;\n      } else {\n        frameIndex = Math.floor((1 - healthPercent / 100) * (totalSprites - 1));\n      }\n      \n      frameIndex = Math.max(0, Math.min(totalSprites - 1, frameIndex));\n\n      const baseTexture = getTexture(def.texture);\n      const source = baseTexture?.source;\n      if (source && source.width > 1) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const frameWidth = texWidth / columns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / columns);\n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        visualElement = new Sprite(new Texture({ source: source, frame: rect }));\n      } else {\n        visualElement = buildSpriteFromDef(def);\n      }\n    } else {\n      visualElement = buildSpriteFromDef(def);\n    }\n\n    if (!visualElement) continue;\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n    \n    if (visualElement.anchor && visualElement.anchor.x === 0.5) {\n      visualElement.x = tileSize / 2;\n      visualElement.y = tileSize / 2;\n    } else {\n      visualElement.x = 0;\n      visualElement.y = 0;\n    }\n    \n    const objWidth = (meta.width || def.width || 1) * tileSize;\n    const objHeight = (meta.height || def.height || 1) * tileSize;\n    visualElement.width = objWidth;\n    visualElement.height = objHeight;\n\n    const container = new Container();\n    container.x = x;\n    container.y = y;\n    container.isRoomContent = mapType === 'room';\n    \n    const isWeatherTrigger = def.type === 'weather_trigger';\n    const isMessageTrigger = def.type === 'message_trigger';\n    const isWolfSecret = def.type === 'wolf_secret';\n    const shouldShowAnyway = (isWeatherTrigger || isMessageTrigger || isWolfSecret) && (isEditor || isEditorPlayMode);\n    \n    if (def.isHiddenInGame && !isEditor && !shouldShowAnyway) {\n        container.visible = false;\n    }\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    if (isInSecretArea && !isSecretRevealed && !isEditor) {\n      container.visible = false;\n    }\n\n    container.addChild(visualElement);\n\n    if (def.isDestructible && health < maxH && health > 0) {\n      try {\n        const hb = new HealthBar({\n          width: objWidth,\n          height: 4,\n          offsetX: 0,\n          offsetY: -5\n        });\n        hb.update(health, maxH);\n        container.addChild(hb);\n      } catch (e) {}\n    }\n\n    if (!!def.renderAbovePlayer) {\n      targetObjFront.addChild(container);\n    } else {\n      targetObjBehind.addChild(container);\n    }\n  }\n};\n\nconst renderSecretOverlays = (refs, options, overlays) => {\n  const { tileSize } = options;\n  const { secretLayerRef } = refs;\n\n  const drawOverlay = (map, container) => {\n    if (!container || map.size === 0) return;\n    const overlay = new Graphics();\n    map.forEach((filterColor, key) => {\n      const [x, y] = key.split(',').map(Number);\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    container.addChild(overlay);\n  };\n\n  drawOverlay(overlays.below, secretLayerRef?.below);\n  drawOverlay(overlays.above, secretLayerRef?.above);\n};\n","import React, { useEffect, useRef, useMemo, useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets, BlurFilter, ColorMatrixFilter, Texture, Sprite } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder, LavaRain as WeatherLavaRain, RadioactiveFog as WeatherRadioactiveFog, MeteorRain as WeatherMeteorRain } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { syncEntities, cleanupEntities } from './entityManager';\nimport { rebuildLayers } from './layerBuilder';\nimport { createFloatingTextLayer, createFloatingTextManager } from './floatingTextManager';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({\n  skipCacheIdWarning: true,\n  preferCreateImageBitmap: false, // Prevents WebGL warning: texImage: Alpha-premult and y-flip are deprecated\n});\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = EMPTY_ARRAY,\n  objectMapData = EMPTY_ARRAY,\n  secretMapData = EMPTY_ARRAY,\n  revealedSecrets = EMPTY_ARRAY,\n  registryItems = EMPTY_ARRAY,\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  weatherLavaRain = 0,\n  weatherRadioactiveFog = 0,\n  weatherMeteorRain = 0,\n  projectiles = EMPTY_ARRAY,\n  healthBarEnabled = true,\n  objectMetadata = EMPTY_OBJECT,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n  isEditor = false,\n  isEditorPlayMode = false,\n  mapType = 'overworld',\n  activeRoomIds = EMPTY_ARRAY,\n  maps = EMPTY_OBJECT,\n  showGrid = false,\n  renderLayers = null, // null means all layers, otherwise an array of layer names to show\n  pointerEvents = 'auto',\n  onWeatherEffectHit = null,\n  roomBlurEnabled = true,\n  debugOverlayEnabled = false,\n}) => {\n  const [isPixiReady, setIsPixiReady] = useState(false);\n\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const cameraPosRef = useRef({ x: 0, y: 0 });\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const roomBgRef = useRef(null);\n  const roomObjBehindRef = useRef(null);\n  const roomObjFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerLayerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidBgLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null, fog: null, lavaRain: null, radioactiveFog: null, meteorRain: null });\n  const weatherPropsRef = useRef({ rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0, lavaRain: 0, radioactiveFog: 0, meteorRain: 0 });\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const entitiesLayerRef = useRef(null);\n  const entitySpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef(EMPTY_ARRAY);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0, targetAlpha: 0, currentAlpha: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n  const gridRef = useRef(null);\n  const showGridRef = useRef(showGrid);\n  const roomBlurEnabledRef = useRef(roomBlurEnabled);\n  const blurFilterRef = useRef(new BlurFilter({ strength: 0 }));\n  const darkenFilterRef = useRef(new ColorMatrixFilter());\n  const roomBrightnessFilterRef = useRef(new ColorMatrixFilter());\n  const vignetteRef = useRef(null);\n  const floatingLayerRef = useRef(null);\n  const debugLayerRef = useRef(null);\n  const debugEnabledRef = useRef(!!debugOverlayEnabled);\n  const floatingManagerRef = useRef(null);\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { showGridRef.current = showGrid; }, [showGrid]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { roomBlurEnabledRef.current = roomBlurEnabled; }, [roomBlurEnabled]);\n  useEffect(() => { debugEnabledRef.current = !!debugOverlayEnabled; }, [debugOverlayEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n\n  // Sync weather props to ref for systems to read live\n  useEffect(() => {\n    weatherPropsRef.current = {\n      rain: Number(weatherRain) || 0,\n      snow: Number(weatherSnow) || 0,\n      clouds: Number(weatherClouds) || 0,\n      fog: Number(weatherFog) || 0,\n      thunder: Number(weatherThunder) || 0,\n      lavaRain: Number(weatherLavaRain) || 0,\n      radioactiveFog: Number(weatherRadioactiveFog) || 0,\n      meteorRain: Number(weatherMeteorRain) || 0,\n    };\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl,\n      minWidth: appRef.current?.screen?.width || 0,\n      minHeight: appRef.current?.screen?.height || 0\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      if (appRef.current) return;\n\n      const app = new Application();\n      try {\n        await app.init({\n          resizeTo: mountRef.current,\n          backgroundAlpha: 0,\n          antialias: false,\n          autoDensity: true,\n        });\n\n        // Enable z-index sorting for the main stage\n        app.stage.sortableChildren = true;\n\n        if (destroyed) {\n          app.destroy(true, { children: true, texture: true });\n          return;\n        }\n\n        if (!app.renderer) return;\n\n        appRef.current = app;\n        app.stage.sortableChildren = true;\n\n        // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const roomBg = new Container();\n      const roomObjBehind = new Container();\n      const roomObjFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const entitiesLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidBgLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const vignetteLayer = new Container();\n      const overlayLayer = new Container();\n      const floatingLayer = createFloatingTextLayer();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      roomBg.zIndex = LAYERS.tiles + 1;\n      objBehind.zIndex = LAYERS.objBehind;\n      roomObjBehind.zIndex = LAYERS.objBehind + 1;\n      objFront.zIndex = LAYERS.objFront;\n      roomObjFront.zIndex = LAYERS.objFront + 1;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      entitiesLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidBgLayer.zIndex = LAYERS.liquidBackground;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      vignetteLayer.zIndex = LAYERS.overlay - 1;\n      overlayLayer.zIndex = LAYERS.overlay;\n      floatingLayer.zIndex = LAYERS.overlay + 1;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      roomBgRef.current = roomBg;\n      roomObjBehindRef.current = roomObjBehind;\n      roomObjFrontRef.current = roomObjFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      playerLayerRef.current = playerLayer;\n      liquidBgLayerRef.current = liquidBgLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      entitiesLayerRef.current = entitiesLayer;\n      vignetteRef.current = vignetteLayer;\n      overlayLayerRef.current = overlayLayer;\n      floatingLayerRef.current = floatingLayer;\n      floatingManagerRef.current = createFloatingTextManager(floatingLayer);\n    \n      const gridGraphics = new Graphics();\n      gridRef.current = gridGraphics;\n      overlayLayer.addChild(gridGraphics);\n\n      const debugGraphics = new Graphics();\n      debugLayerRef.current = debugGraphics;\n      overlayLayer.addChild(debugGraphics);\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      const allLayersMap = {\n        background: [bg, bgAnim],\n        parallax: [parallaxLayer],\n        tiles: [bg, bgAnim], // Aliased for convenience\n        objects: [objBehind, objFront, secretBelowLayer, secretAboveLayer, entitiesLayer, projLayer],\n        player: [playerLayer],\n        weather: [weatherLayer, fogLayer],\n        liquids: [liquidBgLayer, liquidLayer, liquidFxLayer],\n        overlay: [overlayLayer]\n      };\n\n      if (renderLayers) {\n        renderLayers.forEach(layerName => {\n          const layers = allLayersMap[layerName];\n          if (layers) layers.forEach(l => {\n            if (!app.stage.children.includes(l)) app.stage.addChild(l);\n          });\n        });\n      } else {\n        // Add layers in z-order priority (back to front) for stability\n        app.stage.addChild(\n          parallaxLayer,\n          bg, bgAnim, \n          roomBg,\n          liquidBgLayer, \n          objBehind, \n          roomObjBehind,\n          secretBelowLayer, \n          playerLayer, \n          entitiesLayer, \n          projLayer, \n          objFront, \n          roomObjFront,\n          secretAboveLayer, \n          weatherLayer, \n          fogLayer, \n          liquidLayer, \n          liquidFxLayer,\n          vignetteLayer,\n          overlayLayer,\n          floatingLayer\n        );\n      }\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas - DROA PIEVIENOANA\n      if (mountRef.current && app.renderer && app.canvas) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.rect(0, 0, W, H);\n      g.fill({ color: 0x1d4875, alpha: 1 });\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffcc00, warn: 0xffaa00, danger: 0xff8800 };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas && app.renderer) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          // No need to manually rebuild here as the main useEffect will catch app state or we can just trigger a state change if needed.\n          // But Pixi v8 often recovers automatically. To be safe, we can force a rebuild by just waiting for next tick.\n        });\n      }\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n            mapWidth, \n            mapHeight, \n            tileSize,\n            bgContainer: liquidBgLayerRef.current\n          });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n      } catch {}\n\n      rebuildParallax();\n\n      // Finalize initialization by setting appRef\n      // This will trigger the second useEffect to build layers and player\n      appRef.current = app;\n      setIsPixiReady(true);\n      app.ticker.add(() => {\n        if (gridRef.current) {\n          gridRef.current.clear();\n          if (showGridRef.current) {\n            for (let x = 0; x <= mapWidth; x++) {\n              gridRef.current.moveTo(x * tileSize, 0);\n              gridRef.current.lineTo(x * tileSize, mapHeight * tileSize);\n            }\n            for (let y = 0; y <= mapHeight; y++) {\n              gridRef.current.moveTo(0, y * tileSize);\n              gridRef.current.lineTo(mapWidth * tileSize, y * tileSize);\n            }\n            gridRef.current.stroke({ width: 0.5, color: 0xffffff, alpha: 0.2 });\n          }\n        }\n\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          updatePlayerSprite(\n            { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n            s,\n            tileSize,\n            hbEnabledRef.current\n          );\n        }\n\n        // Camera Follow\n        const sw = app.screen.width;\n        const sh = app.screen.height;\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        if (s) {\n          const targetX = (s.x || 0) + (s.width || tileSize) / 2;\n          const targetY = (s.y || 0) + (s.height || tileSize) / 2;\n\n          let camX = targetX - sw / 2;\n          let camY = targetY - sh / 2;\n\n          // Constraints with centering for small maps\n          if (worldW < sw) {\n            camX = (worldW - sw) / 2;\n          } else {\n            camX = Math.max(0, Math.min(camX, worldW - sw));\n          }\n\n          if (worldH < sh) {\n            camY = (worldH - sh) / 2;\n          } else {\n            camY = Math.max(0, Math.min(camY, worldH - sh));\n          }\n\n          // Use a small dead-zone/smooth follow to prevent 1px jitter from sub-pixel player movement\n          const lastCam = cameraPosRef.current || { x: camX, y: camY, rawX: camX, rawY: camY };\n          const smoothing = 0.2; // Lerp factor (0 to 1, higher is faster)\n          const rawX = lastCam.rawX !== undefined ? lastCam.rawX : camX;\n          const rawY = lastCam.rawY !== undefined ? lastCam.rawY : camY;\n          \n          const nextRawX = rawX + (camX - rawX) * smoothing;\n          const nextRawY = rawY + (camY - rawY) * smoothing;\n\n          cameraPosRef.current = { \n            x: Math.round(nextRawX), \n            y: Math.round(nextRawY),\n            rawX: nextRawX,\n            rawY: nextRawY\n          };\n          \n          app.stage.pivot.set(Math.round(nextRawX), Math.round(nextRawY));\n          \n          window.__PLAYER_POS__ = { x: s.x, y: s.y };\n\n          if (parallaxRef.current) {\n            parallaxRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          if (vignetteRef.current && vignetteRef.current.visible) {\n            vignetteRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          const f = parallaxFactorRef.current;\n          if (parallaxManagerRef.current) {\n            parallaxManagerRef.current.resize(worldW, worldH, sw, sh);\n            parallaxManagerRef.current.setScroll(nextRawX, f);\n          }\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        const swNow = app.screen.width;\n        const shNow = app.screen.height;\n\n        if (systems.rain) {\n          if (systems.rain.resize) systems.rain.resize(swNow, shNow);\n          systems.rain.update(dt);\n        }\n        if (systems.lavaRain) {\n          if (systems.lavaRain.resize) systems.lavaRain.resize(swNow, shNow);\n          systems.lavaRain.update(dt);\n        }\n        if (systems.snow) {\n          if (systems.snow.resize) systems.snow.resize(swNow, shNow);\n          systems.snow.update(dt);\n        }\n        if (systems.meteorRain) {\n          if (systems.meteorRain.resize) systems.meteorRain.resize(swNow, shNow);\n          systems.meteorRain.update(dt);\n        }\n        if (systems.clouds) {\n          if (systems.clouds.resize) systems.clouds.resize(swNow, shNow);\n          systems.clouds.update(dt);\n        }\n        if (systems.fog) {\n          if (systems.fog.resize) systems.fog.resize(swNow, shNow);\n          systems.fog.update(dt);\n        }\n        if (systems.radioactiveFog) {\n          if (systems.radioactiveFog.resize) systems.radioactiveFog.resize(swNow, shNow);\n          systems.radioactiveFog.update(dt);\n        }\n        if (systems.thunder) {\n          if (systems.thunder.resize) systems.thunder.resize(swNow, shNow);\n          systems.thunder.update(dt);\n        }\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater/lava overlay with smooth fade-in/out\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n\n          // Safety check: ensure graphics object exists and is attached\n          if (u && (!u.g || u.g.destroyed)) {\n            const overlayL = overlayLayerRef.current;\n            if (overlayL) {\n              const g = new Graphics();\n              overlayL.addChild(g);\n              u.g = g;\n              u.currentAlpha = 0;\n              u.targetAlpha = 0;\n              u.time = 0;\n            }\n          }\n\n          if (u && u.g) {\n            // Check if player's head is in water/lava for full overlay\n            // If only body is in liquid, use a much subtler effect or none\n            const liquidType = sNow.liquidType;\n            const headUnder = !!(sNow && sNow.headUnderWater);\n            const inLiquid = !!(sNow && sNow.inWater);\n            \n            const overlayCfg = sNow.liquidOverlay || null;\n            const showOverlay = headUnder && !!overlayCfg;\n\n            let overlayColor = 0x1d4875;\n            let maxTargetAlpha = 0.15;\n\n            if (overlayCfg) {\n              if (Number.isFinite(overlayCfg.color)) overlayColor = overlayCfg.color;\n              if (Number.isFinite(overlayCfg.alpha)) maxTargetAlpha = overlayCfg.alpha;\n            }\n\n            if (showOverlay) {\n              u.time += dt;\n              // Target alpha with pulse effect\n              const pulseBase = (maxTargetAlpha * 0.8) + (maxTargetAlpha * 0.2) * Math.sin(u.time * 0.0025);\n              u.targetAlpha = pulseBase;\n\n              // Smooth fade-in: gradually approach target alpha\n              const fadeSpeed = 0.01; // Faster fade-in for immediate visibility\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeSpeed);\n\n              // Update color if liquid type changed (only when needed to avoid constant redraw)\n              if (!u.g.visible || u.lastLiquidType !== liquidType) {\n                u.g.clear();\n                u.g.rect(0, 0, mapWidth * tileSize, mapHeight * tileSize);\n                u.g.fill({ color: overlayColor, alpha: 1 });\n                u.lastLiquidType = liquidType;\n              }\n\n              u.g.visible = true;\n              u.g.alpha = u.currentAlpha;\n            } else {\n              // Smooth fade-out\n              u.targetAlpha = 0;\n              const fadeOutSpeed = 0.008; // Faster fade-out\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeOutSpeed);\n              u.g.alpha = u.currentAlpha;\n\n              if (u.currentAlpha < 0.01) {\n                u.currentAlpha = 0;\n                u.g.alpha = 0;\n                u.g.visible = false;\n                u.time = 0; // Reset time for next submersion\n              }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n\n        // Entities\n        const sNow = playerStateRef.current || {};\n        syncEntities(entitiesLayerRef.current, entitySpritesRef.current, sNow.entities, registryItems, tileSize);\n\n        // Floating texts\n        floatingManagerRef.current?.update(dt);\n      });\n    } catch (error) {\n      console.error('PixiStage init failed:', error);\n    }\n  };\n\n  init();\n\n  return () => {\n    destroyed = true;\n    if (appRef.current) {\n      const appToDestroy = appRef.current;\n      appRef.current = null;\n      appToDestroy.destroy(true, { children: true, texture: true });\n    }\n    try { liquidSystemRef.current?.destroy(); } catch {}\n    try { waterFxRef.current?.destroy(); } catch {}\n    try { lavaEmbersRef.current?.destroy(); } catch {}\n    try { lavaSteamRef.current?.destroy(); } catch {}\n    try { parallaxManagerRef.current?.destroy(); } catch {}\n    parallaxManagerRef.current = null;\n    try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n    try {\n      weatherSystemsRef.current.rain?.destroy();\n      weatherSystemsRef.current.snow?.destroy();\n      weatherSystemsRef.current.fog?.destroy();\n    } catch {}\n    cleanupProjectiles(projectileSpritesRef.current);\n    cleanupEntities(entitySpritesRef.current);\n    clearTextureCache();\n  };\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      floatingManagerRef.current?.add(detail);\n    };\n    window.addEventListener('game-floating-text', handler);\n    return () => window.removeEventListener('game-floating-text', handler);\n  }, []);\n\n  useEffect(() => {\n    const isInsideRoom = activeRoomIds && activeRoomIds.length > 0;\n    const targetBlur = (isInsideRoom && roomBlurEnabled) ? 4 : 0;\n    const roomBrightness = isInsideRoom ? 1.25 : 1.0; // Slightly brighter interior\n    \n    if (blurFilterRef.current) {\n      blurFilterRef.current.strength = targetBlur;\n    }\n\n    if (darkenFilterRef.current) {\n      darkenFilterRef.current.reset();\n      if (isInsideRoom) {\n        // Desaturate and darken background when inside\n        darkenFilterRef.current.desaturate();\n        darkenFilterRef.current.brightness(0.75, true);\n      }\n    }\n\n    if (roomBrightnessFilterRef.current) {\n      roomBrightnessFilterRef.current.reset();\n      roomBrightnessFilterRef.current.brightness(roomBrightness, false);\n    }\n\n    if (vignetteRef.current) {\n      vignetteRef.current.visible = isInsideRoom;\n      if (isInsideRoom && !vignetteRef.current.children.length) {\n        const sw = appRef.current?.screen?.width || 800;\n        const sh = appRef.current?.screen?.height || 600;\n        \n        // Create programmatic vignette texture using canvas\n        const canvas = document.createElement('canvas');\n        canvas.width = 512;\n        canvas.height = 512;\n        const ctx = canvas.getContext('2d');\n        const grad = ctx.createRadialGradient(256, 256, 100, 256, 256, 360);\n        grad.addColorStop(0, 'rgba(0,0,0,0)');\n        grad.addColorStop(1, 'rgba(0,0,0,0.6)');\n        ctx.fillStyle = grad;\n        ctx.fillRect(0, 0, 512, 512);\n        \n        const tex = Texture.from(canvas);\n        const sprite = new Sprite(tex);\n        sprite.width = sw;\n        sprite.height = sh;\n        vignetteRef.current.addChild(sprite);\n        \n        // Also update sprite size on resize\n        vignetteRef.current._vignetteSprite = sprite;\n      }\n      \n      // Sync vignette position to camera (it should be screen-space)\n      if (isInsideRoom && vignetteRef.current._vignetteSprite) {\n        vignetteRef.current.x = cameraPosRef.current.x;\n        vignetteRef.current.y = cameraPosRef.current.y;\n        vignetteRef.current._vignetteSprite.width = appRef.current?.screen?.width || 800;\n        vignetteRef.current._vignetteSprite.height = appRef.current?.screen?.height || 600;\n      }\n    }\n\n    const layersToBlur = [\n      bgRef.current,\n      bgAnimRef.current,\n      objBehindRef.current,\n      objFrontRef.current,\n      secretLayerRef.current?.below,\n      secretLayerRef.current?.above,\n      liquidBgLayerRef.current,\n      liquidLayerRef.current,\n      parallaxRef.current\n    ];\n\n    layersToBlur.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        \n        // Blur filter\n        if (targetBlur > 0) {\n          if (!layer.filters.includes(blurFilterRef.current)) {\n            layer.filters = [...layer.filters, blurFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== blurFilterRef.current);\n        }\n\n        // Darken/Desaturate filter (Background only)\n        if (isInsideRoom) {\n          if (!layer.filters.includes(darkenFilterRef.current)) {\n            layer.filters = [...layer.filters, darkenFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== darkenFilterRef.current);\n        }\n\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n\n    // Apply brightness to room layers\n    const roomLayers = [\n      roomBgRef.current,\n      roomObjBehindRef.current,\n      roomObjFrontRef.current\n    ];\n\n    roomLayers.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        if (isInsideRoom) {\n          if (!layer.filters.includes(roomBrightnessFilterRef.current)) {\n            layer.filters = [...layer.filters, roomBrightnessFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== roomBrightnessFilterRef.current);\n        }\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n  }, [activeRoomIds, roomBlurEnabled]);\n\n  useEffect(() => {\n    const g = debugLayerRef.current;\n    if (!g) return;\n    g.clear();\n    if (!debugEnabledRef.current) {\n      g.visible = false;\n      return;\n    }\n    g.visible = true;\n\n    const getDefById = (id) => {\n      if (!id) return null;\n      const map = registryItems && registryItems.__byId;\n      if (map && typeof map.get === 'function') return map.get(id) || null;\n      return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    const tileCount = mapWidth * mapHeight;\n    for (let i = 0; i < tileCount; i++) {\n      const tileId = tileMapData[i];\n      if (!tileId) continue;\n      const def = getDefById(tileId);\n      if (!def) continue;\n      const x = (i % mapWidth) * tileSize;\n      const y = Math.floor(i / mapWidth) * tileSize;\n      const isLiquid = !!def.flags?.liquid;\n      const isLava = !!def.flags?.lava || !!def.flags?.lava_waterfall;\n      const isRadio = !!def.flags?.radioactive || !!def.flags?.radioactive_waterfall;\n      const hasCollision = !!def.collision;\n\n      if (isLiquid) {\n        const color = isLava ? 0xffa500 : (isRadio ? 0x32cd32 : 0x2ecdf1);\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color, alpha: 0.18 });\n      } else if (hasCollision) {\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color: 0xff3b3b, alpha: 0.12 });\n      }\n    }\n\n    if (Array.isArray(secretMapData) && secretMapData.length) {\n      g.stroke({ width: 1, color: 0xb57bff, alpha: 0.6 });\n      for (let i = 0; i < secretMapData.length; i++) {\n        if (secretMapData[i] !== 'room_area') continue;\n        const x = (i % mapWidth) * tileSize;\n        const y = Math.floor(i / mapWidth) * tileSize;\n        g.rect(x, y, tileSize, tileSize);\n      }\n    }\n  }, [debugOverlayEnabled, tileMapData, secretMapData, mapWidth, mapHeight, tileSize, registryItems]);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n\n    let active = true;\n\n    const runRebuild = async () => {\n        // Collect all textures to preload\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n            addUrl(def?.texture);\n            if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n            addUrl(playerVisuals.texture);\n            if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n            await Assets.load(urls);\n        }\n\n        if (!active || !appRef.current) return;\n\n        if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n            rebuildLayers(\n                { \n                  bgRef: bgRef.current, \n                  objBehindRef: objBehindRef.current, \n                  objFrontRef: objFrontRef.current, \n                  roomBgRef: roomBgRef.current,\n                  roomObjBehindRef: roomObjBehindRef.current,\n                  roomObjFrontRef: roomObjFrontRef.current,\n                  secretLayerRef: secretLayerRef.current \n                },\n                { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType, backgroundColor, activeRoomIds, maps }\n            );\n\n            // Rebuild player visuals if visuals changed or player not created yet\n            const pLayer = playerLayerRef.current;\n            if (pLayer) {\n                if (playerRef.current) {\n                    pLayer.removeChild(playerRef.current);\n                    try { playerRef.current.destroy({ children: true }); } catch {}\n                }\n                \n                const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerStateRef.current, tileSize);\n                pLayer.addChild(playerComponents.container);\n                playerRef.current = playerComponents.container;\n                playerSpriteRefs.current = playerComponents.sprites;\n                playerHealthBarRef.current = playerComponents.healthBar;\n            }\n\n            // Rebuild liquid regions only if tileMapData changed (not just revealedSecrets)\n            // This prevents liquid \"jumping\" when revealing secrets\n            const tileDataString = JSON.stringify(tileMapData);\n            const prevTileDataString = liquidSystemRef.current?._lastTileData;\n            if (tileDataString !== prevTileDataString) {\n                try {\n                    if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n                    if (liquidLayerRef.current) {\n                        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n                            mapWidth, \n                            mapHeight, \n                            tileSize,\n                            bgContainer: liquidBgLayerRef.current\n                        });\n                        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n                        liquidSystemRef.current._lastTileData = tileDataString; // Track what we built\n                    }\n                } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n                try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n            }\n\n            // Upload to GPU to avoid lazy initialization warnings\n            if (app.renderer && app.renderer.prepare) {\n                try {\n                    await app.renderer.prepare.upload(app.stage);\n                } catch (e) {\n                    // Prepare might fail in some edge cases or context loss\n                }\n            }\n        }\n    };\n\n    runRebuild();\n\n    return () => { active = false; };\n  }, [tileMapData, objectMapData, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets, objectMetadata, playerVisuals, isPixiReady, activeRoomIds, maps, mapType, backgroundColor]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer || !isPixiReady) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      },\n      onMeteorHit: (data) => {\n        if (typeof onWeatherEffectHit === 'function') {\n          onWeatherEffectHit('meteor', data);\n        }\n      },\n      getViewport: () => ({\n        x: cameraPosRef.current.x,\n        y: cameraPosRef.current.y,\n        width: app.screen?.width || 800,\n        height: app.screen?.height || 600\n      })\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.rain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.snow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.clouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.thunder) || 0));\n    const getFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.fog) || 0));\n    const getLavaRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.lavaRain) || 0));\n    const getRadioactiveFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.radioactiveFog) || 0));\n    const getMeteorRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.meteorRain) || 0));\n\n    // Initialize systems if they don't exist\n    if (!weatherSystemsRef.current.rain) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n    }\n    if (!weatherSystemsRef.current.lavaRain) {\n      weatherSystemsRef.current.lavaRain = new WeatherLavaRain(weatherLayer, api, getLavaRainIntensity);\n    }\n    if (!weatherSystemsRef.current.snow) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n    }\n    if (!weatherSystemsRef.current.meteorRain) {\n      weatherSystemsRef.current.meteorRain = new WeatherMeteorRain(weatherLayer, api, getMeteorRainIntensity);\n    }\n    if (!weatherSystemsRef.current.clouds) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n    }\n    if (!weatherSystemsRef.current.fog) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, getFogIntensity);\n    }\n    if (!weatherSystemsRef.current.radioactiveFog) {\n      weatherSystemsRef.current.radioactiveFog = new WeatherRadioactiveFog(fogLayer, api, getRadioactiveFogIntensity);\n    }\n    if (!weatherSystemsRef.current.thunder) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n    }\n\n    // Return cleanup to destroy all when stage unmounts or map changes\n    return () => {\n      try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.lavaRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n      try { weatherSystemsRef.current.meteorRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n      try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.radioactiveFog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n      weatherSystemsRef.current = { rain: null, lavaRain: null, snow: null, meteorRain: null, clouds: null, thunder: null, fog: null, radioactiveFog: null };\n    };\n  }, [mapWidth, mapHeight, tileSize, isSolidAt, isPixiReady]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%', pointerEvents }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  objectMetadata: PropTypes.object,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  weatherLavaRain: PropTypes.number,\n  weatherRadioactiveFog: PropTypes.number,\n  weatherMeteorRain: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n  roomBlurEnabled: PropTypes.bool,\n  debugOverlayEnabled: PropTypes.bool,\n  renderLayers: PropTypes.arrayOf(PropTypes.string),\n  pointerEvents: PropTypes.string,\n  onWeatherEffectHit: PropTypes.func,\n};\n\nexport default PixiStage;\n","import { Container, Text } from 'pixi.js';\nimport floatConfig from '../../../../assets/json/system/floating_text.json';\n\nexport const createFloatingTextManager = (layer) => {\n  const items = [];\n  const cfg = floatConfig || {};\n  const defaultCfg = cfg.default || {};\n  const critCfg = cfg.crit || {};\n\n  const add = ({\n    x,\n    y,\n    text,\n    color = '#ff3b3b',\n    fontSize = 14,\n    ttlMs = 900,\n    amount,\n    crit\n  }) => {\n    if (!layer || !Number.isFinite(x) || !Number.isFinite(y) || !text) return;\n\n    const amountValue = Number.isFinite(amount) ? amount : null;\n    const critThreshold = Number.isFinite(critCfg.threshold) ? critCfg.threshold : null;\n    const isCrit = !!crit || (amountValue !== null && critThreshold !== null && Math.abs(amountValue) >= critThreshold);\n\n    const baseColor = defaultCfg.color || color;\n    const finalColor = isCrit ? (critCfg.color || baseColor) : baseColor;\n    const finalFontSize = isCrit ? (critCfg.fontSize || Math.round((defaultCfg.fontSize || fontSize) * 1.2)) : (defaultCfg.fontSize || fontSize);\n    const finalTtl = isCrit ? (critCfg.ttlMs || defaultCfg.ttlMs || ttlMs) : (defaultCfg.ttlMs || ttlMs);\n    const riseSpeed = isCrit ? (critCfg.riseSpeed || defaultCfg.riseSpeed || 0.04) : (defaultCfg.riseSpeed || 0.04);\n    const jitterX = Number.isFinite(defaultCfg.jitterX) ? defaultCfg.jitterX : 6;\n    const jitterY = Number.isFinite(defaultCfg.jitterY) ? defaultCfg.jitterY : 2;\n    const prefix = isCrit && typeof critCfg.prefix === 'string' ? critCfg.prefix : '';\n    const suffix = isCrit && typeof critCfg.suffix === 'string' ? critCfg.suffix : '';\n    const finalText = `${prefix}${text}${suffix}`;\n\n    const label = new Text({\n      text: String(finalText),\n      style: {\n        fontFamily: 'monospace',\n        fontSize: finalFontSize,\n        fill: finalColor,\n        stroke: '#000000',\n        strokeThickness: 2,\n        dropShadow: true,\n        dropShadowColor: '#000000',\n        dropShadowBlur: 2,\n        dropShadowDistance: 1\n      }\n    });\n\n    label.anchor.set(0.5, 1);\n    const jitterXValue = (Math.random() * 2 - 1) * jitterX;\n    const jitterYValue = (Math.random() * 2 - 1) * jitterY;\n    label.position.set(x + jitterXValue, y + jitterYValue);\n    layer.addChild(label);\n\n    items.push({\n      label,\n      ttl: finalTtl,\n      total: finalTtl,\n      vy: -riseSpeed\n    });\n  };\n\n  const update = (deltaMs) => {\n    if (!items.length) return;\n    for (let i = items.length - 1; i >= 0; i--) {\n      const item = items[i];\n      item.ttl -= deltaMs;\n      if (item.ttl <= 0) {\n        try { item.label.destroy(); } catch {}\n        items.splice(i, 1);\n        continue;\n      }\n      item.label.y += item.vy * deltaMs;\n      item.label.alpha = Math.max(0, item.ttl / item.total);\n    }\n  };\n\n  return { add, update };\n};\n\nexport const createFloatingTextLayer = () => new Container();\n","import { Sprite, AnimatedSprite, Texture } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Create new sprite\n      const def = getRegItem(registryItems, p.defId);\n      if (def && Array.isArray(def.textures) && def.textures.length > 1) {\n        const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n        if (frames.length > 0) {\n          spr = new AnimatedSprite(frames);\n          spr.animationSpeed = msToSpeed(def.animationSpeed);\n          spr.play();\n        }\n      }\n      if (!spr) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        spr = new Sprite(tex);\n      }\n      spr.anchor.set(0.5, 0.5);\n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x + (p.dir >= 0 ? 0 : 0);\n    spr.y = p.y;\n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = p.dir >= 0 ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","import { Sprite, Texture, Rectangle } from 'pixi.js';\nimport { getTexture } from './helpers';\n\n/**\n * Sinhroniz un atjaunina kustgo enttiju (piem. tanku) spraitus.\n * @param {Container} entitiesLayer PixiJS konteiners enttijm\n * @param {Map} entitySpritesMap Map, kur glabjas esoie spraiti (pc ID)\n * @param {Array} entitiesList Enttiju saraksts no dzinja\n * @param {Array} registryItems Reistra elementi\n * @param {number} tileSize Flzes izmrs pikseos\n */\nexport const syncEntities = (entitiesLayer, entitySpritesMap, entitiesList, registryItems, tileSize) => {\n  if (!entitiesLayer) return;\n\n  const seen = new Set();\n  const list = entitiesList || [];\n\n  for (const ent of list) {\n    const key = ent.id;\n    seen.add(key);\n\n    let spr = entitySpritesMap.get(key);\n    const def = ent.def || {};\n\n    if (!spr) {\n      // Izveidojam jaunu spraitu ar baltu tekstru k aizvietotju, kamr ldjas st\n      spr = new Sprite(Texture.WHITE);\n      spr.anchor.set(0, 0);\n      entitiesLayer.addChild(spr);\n      entitySpritesMap.set(key, spr);\n      spr._lastFrameIndex = -1;\n    }\n\n    // Atjaunojam tekstru no spritesheet, ja nepiecieams\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    const isTextureReady = source && source.width > 1;\n\n    if (def.spriteSheet && def.spriteSheet.enabled && isTextureReady) {\n      const columns = def.spriteSheet.columns || 1;\n      const frameIndex = ent.currentSpriteIndex !== undefined ? ent.currentSpriteIndex : 0;\n      \n      if (spr._lastFrameIndex !== frameIndex) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const totalSprites = def.spriteSheet.totalSprites || 1;\n\n        // Ja kolonnu skaits JSON ir nepareizs vai trkst, minm to aprint\n        let effectiveColumns = columns;\n        if (!effectiveColumns || effectiveColumns <= 0) {\n            effectiveColumns = Math.floor(texWidth / (def.spriteSheet.frameWidth || 32)) || 1;\n        }\n\n        const frameWidth = texWidth / effectiveColumns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / effectiveColumns);\n        \n        const col = frameIndex % effectiveColumns;\n        const row = Math.floor(frameIndex / effectiveColumns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        try {\n            spr.texture = new Texture({\n              source: source,\n              frame: rect\n            });\n            spr._lastFrameIndex = frameIndex;\n        } catch (e) {\n            console.warn(`Failed to create texture for entity ${key} frame ${frameIndex}`, e);\n            spr.texture = baseTexture;\n        }\n      }\n    } else if (isTextureReady) {\n      if (spr.texture !== baseTexture) {\n        spr.texture = baseTexture;\n        spr._lastFrameIndex = -1;\n      }\n    } else if (def.editorIcon) {\n        // Ja nav tekstras, bet ir ikona (piemram, bultia, kaut gan ts te nevajadztu bt k enttijai)\n        if (spr.texture !== Texture.WHITE) spr.texture = Texture.WHITE;\n    }\n\n    // Pozcija un izmrs\n    const targetWidth = ent.width || tileSize;\n    const targetHeight = ent.height || tileSize;\n    \n    spr.width = targetWidth;\n    spr.height = targetHeight;\n    \n    // Nodroinm, ka scale nav 0 vai NaN (ja tekstra bija dvaina skum)\n    if (!spr.scale.x || isNaN(spr.scale.x)) spr.scale.x = 1;\n    if (!spr.scale.y || isNaN(spr.scale.y)) spr.scale.y = 1;\n\n    // Virziens (flipping)\n    const direction = ent.direction !== undefined ? ent.direction : 1;\n    \n    // Ja ir definta rotcija (piem. akmeiem), izmantojam centru k enkuru\n    if (ent.rotation !== undefined) {\n        spr.anchor.set(0.5, 0.5);\n        spr.x = ent.x + targetWidth / 2;\n        spr.y = ent.y + targetHeight / 2;\n        spr.rotation = ent.rotation;\n        \n        // Flipping ar centru enkuru\n        const absScaleX = Math.abs(spr.scale.x);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n    } else {\n        // Standarta enkurs (augjais kreisais stris)\n        spr.anchor.set(0, 0);\n        spr.rotation = 0;\n        \n        const absScaleX = Math.abs(spr.scale.x);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        \n        // Pozicionana emot vr flipping pie enkura (0,0)\n        spr.x = ent.x + (direction < 0 ? targetWidth : 0);\n        spr.y = ent.y;\n    }\n  }\n\n  // Noemam spraitus enttijm, kas vairs neeksist\n  for (const [key, spr] of entitySpritesMap.entries()) {\n    if (!seen.has(key)) {\n      if (spr.parent) spr.parent.removeChild(spr);\n      spr.destroy({ children: true, texture: false }); // Tekstras koplietoanas d ts neizncinm\n      entitySpritesMap.delete(key);\n    }\n  }\n};\n\n/**\n * Attra visus enttiju spraitus.\n */\nexport const cleanupEntities = (entitySpritesMap) => {\n  for (const spr of entitySpritesMap.values()) {\n    if (spr.parent) spr.parent.removeChild(spr);\n    spr.destroy({ children: true, texture: false });\n  }\n  entitySpritesMap.clear();\n};\n","// Item collection extracted from useGameEngine.js\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata: mainMetadata, secretMapData } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  // --- ROOM OVERLAY LOGIC ---\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && mainMetadata) {\n    if (!gameState.current.collectedItems) {\n      gameState.current.collectedItems = new Set();\n    }\n\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          // Inside a room!\n          const localX = centerX - rx;\n          const localY = centerY - ry;\n          const rWidth = roomMap.mapWidth || roomMap.width || 20;\n          const rgX = Math.floor(localX / TILE_SIZE);\n          const rgY = Math.floor(localY / TILE_SIZE);\n          const rIndex = rgY * rWidth + rgX;\n          \n          const itemKey = `${meta.linkedMapId}:${rIndex}`;\n          if (gameState.current.collectedItems.has(itemKey)) return;\n\n          const rObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          if (rObjectData && rObjectData[rIndex]) {\n            // Call collectItem recursively or just handle it here\n            const rItemId = rObjectData[rIndex];\n            const rItemDef = getDefById(registryItems, rItemId);\n            \n            if (rItemDef && rItemDef.pickup && !rItemId.includes('player')) {\n               if (rItemDef.name && rItemDef.name.startsWith('interactable.')) return;\n\n               // Pick it up\n               let pickedUp = false;\n               if (rItemDef.effect && rItemDef.effect.health) {\n                 const healthBonus = parseInt(rItemDef.effect.health, 10);\n                 if (gameState.current.health < MAX_HEALTH) {\n                   gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n                   pickedUp = true;\n                 }\n               } else if (rItemDef.effect && rItemDef.effect.fireball) {\n                 const ammoBonus = parseInt(rItemDef.effect.fireball, 10) || 0;\n                 gameState.current.ammo = (gameState.current.ammo || 0) + ammoBonus;\n                 pickedUp = true;\n               }\n\n               if (pickedUp) {\n                 gameState.current.collectedItems.add(itemKey);\n                 try {\n                   playShotSfx(rItemDef?.sfx, Math.max(0, Math.min(1, rItemDef?.sfxVolume ?? 1)));\n                 } catch {}\n                 if (onStateUpdate) {\n                   onStateUpdate('collectItem', { index: rIndex, mapId: meta.linkedMapId });\n                 }\n                 return;\n               }\n            }\n          }\n          // If we are in a room, we don't pick up items from the main map below\n          return;\n        }\n      }\n    }\n  }\n  // --- END ROOM OVERLAY LOGIC ---\n\n  if (!gameState.current.collectedItems) {\n    gameState.current.collectedItems = new Set();\n  }\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const itemKey = `main:${index}`;\n  if (gameState.current.collectedItems.has(itemKey)) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = getDefById(registryItems, itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', index);\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', index);\n    return;\n  }\n}\n","export function resolveInteractableContext({\n  mapData,\n  mapWidth,\n  mapHeight,\n  objectLayerData,\n  mainObjectMetadata,\n  secretMapData,\n  activeRoomIds: activeRoomIdsProp,\n  centerX,\n  centerY,\n  TILE_SIZE\n}) {\n  let activeTargetMap = mapData;\n  let activeObjectData = objectLayerData;\n  let activeMetadata = mainObjectMetadata || mapData?.objectMetadata || mapData?.meta?.objectMetadata || {};\n  let activeMapWidth = mapWidth;\n  let activeMapHeight = mapHeight;\n  let offsetX = 0;\n  let offsetY = 0;\n  let currentMapId = mapData?.id || 'main';\n\n  const projectMaps = mapData?.maps || mapData?.projectMaps || {};\n  const activeRoomIds = activeRoomIdsProp || mapData?.meta?.activeRoomIds || [];\n\n  if (activeRoomIds.length > 0) {\n    const mainMetadata = mainObjectMetadata || mapData?.objectMetadata || mapData?.meta?.objectMetadata || {};\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = projectMaps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          activeTargetMap = roomMap;\n          activeMapWidth = roomMap.mapWidth || roomMap.width || 20;\n          activeMapHeight = roomMap.mapHeight || roomMap.height || 15;\n          activeObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          activeMetadata = roomMap.objectMetadata || {};\n          offsetX = rx;\n          offsetY = ry;\n          currentMapId = meta.linkedMapId;\n          break;\n        }\n      }\n    }\n  }\n\n  return {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps,\n    activeRoomIds\n  };\n}\n\nexport default { resolveInteractableContext };\n","/**\n * Finds spawn position in a map by trigger ID or player start\n */\nexport function findSpawnPosition(map, triggerId, tileSize) {\n  if (!map) return null;\n\n  const mapW = map.width || map.mapWidth || 20;\n  const metadata = map.objectMetadata || {};\n\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data;\n\n  if (!objData) return null;\n\n  let spawnIdx = -1;\n\n  const triggerRequested = triggerId !== undefined && triggerId !== null && triggerId !== '';\n  if (triggerRequested) {\n    for (let i = 0; i < objData.length; i++) {\n      if (!objData[i]) continue;\n      if (metadata[i] && metadata[i].triggerId === triggerId) {\n        spawnIdx = i;\n        break;\n      }\n    }\n  }\n\n  if (spawnIdx === -1 && !triggerRequested) {\n    spawnIdx = objData.findIndex(id => id && id.includes('player'));\n  }\n\n  if (spawnIdx !== -1) {\n    return {\n      x: (spawnIdx % mapW) * tileSize,\n      y: Math.floor(spawnIdx / mapW) * tileSize\n    };\n  }\n\n  return null;\n}\n\nexport default { findSpawnPosition };\n","import { findSpawnPosition } from './spawn';\n\nexport function handleDoorInteraction({\n  objDef,\n  currentMeta,\n  actualIndex,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  mapData,\n  mapWidth,\n  TILE_SIZE,\n  activeTargetMap,\n  projectMaps\n}) {\n  if (!objDef || objDef.subtype !== 'door') return false;\n  if (!keys?.e) return true;\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 600) return true;\n  gameState.current.lastETime = now;\n\n  const sound = currentMeta?.sound || objDef.interaction?.sound;\n  if (sound) {\n    try { playShotSfx(sound, objDef.sfxVolume || 0.5); } catch {}\n  }\n\n  if (onStateUpdate) {\n    onStateUpdate('setObjectFrame', {\n      index: actualIndex,\n      frame: objDef.interaction?.frames?.opening || 1,\n      mapId: activeTargetMap === mapData ? null : activeTargetMap.id\n    });\n  }\n\n  const delayS = currentMeta?.delaySeconds !== undefined ? currentMeta.delaySeconds : (objDef.interaction?.delaySeconds || 0.5);\n  const targetMapId = currentMeta?.targetMapId;\n\n  if (onStateUpdate && targetMapId) {\n    setTimeout(() => {\n      const targetMap = projectMaps[targetMapId];\n      const isRoom = targetMap && targetMap.type === 'room';\n      const isExitingRoom = !isRoom && activeTargetMap !== mapData && targetMapId === 'main';\n\n      if (isRoom || isExitingRoom) {\n        let newX = gameState.current.x;\n        let newY = gameState.current.y;\n\n        if (isRoom) {\n          const roomAreaEntry = Object.entries(mapData?.meta?.objectMetadata || {})\n            .find(([, m]) => m.linkedMapId === targetMapId);\n          let rx = 0;\n          let ry = 0;\n          if (roomAreaEntry) {\n            const raIdx = parseInt(roomAreaEntry[0], 10);\n            rx = (raIdx % mapWidth) * TILE_SIZE;\n            ry = Math.floor(raIdx / mapWidth) * TILE_SIZE;\n          }\n          const spawn = findSpawnPosition(targetMap, currentMeta.spawnTriggerId, TILE_SIZE);\n          if (spawn) {\n            newX = rx + spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n            newY = ry + spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n          }\n        } else {\n          const roomAreaEntry = Object.entries(mapData?.meta?.objectMetadata || {})\n            .find(([, m]) => m.linkedMapId === activeTargetMap.id);\n          if (roomAreaEntry) {\n            const spawn = findSpawnPosition(mapData, currentMeta.spawnTriggerId, TILE_SIZE);\n            if (spawn) {\n              newX = spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n              newY = spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n            }\n          }\n        }\n\n        gameState.current.x = newX;\n        gameState.current.y = newY;\n        gameState.current.vx = 0;\n        gameState.current.vy = 0;\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      } else {\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      }\n    }, delayS * 1000);\n  }\n\n  return true;\n}\n\nexport default { handleDoorInteraction };\n","export function handleTeleportInteraction({\n  objId,\n  objDef,\n  currentMeta,\n  actualIndex,\n  activeObjectData,\n  activeMetadata,\n  activeMapWidth,\n  offsetX,\n  offsetY,\n  projectMaps,\n  onStateUpdate,\n  playShotSfx,\n  gameState,\n  TILE_SIZE\n}) {\n  if (!objId || !objId.includes('portal')) return false;\n  if (!currentMeta || currentMeta.triggerId === undefined || currentMeta.triggerId === null) return true;\n\n  const targetMapId = currentMeta.targetMapId;\n  if (targetMapId && projectMaps && projectMaps[targetMapId]) {\n    if (onStateUpdate) {\n      onStateUpdate('switchMap', {\n        targetMapId,\n        triggerId: currentMeta.triggerId\n      });\n      try {\n        const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n        playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n      } catch {}\n    }\n    return true;\n  }\n\n  for (let i = 0; i < (activeObjectData?.length || 0); i++) {\n    if (i === actualIndex) continue;\n    const destId = activeObjectData[i];\n    if (destId && (destId.includes('target') || destId === 'portal_target')) {\n      const destMeta = activeMetadata?.[i];\n      if (destMeta && destMeta.triggerId === currentMeta.triggerId) {\n        const tx = offsetX + (i % activeMapWidth) * TILE_SIZE;\n        const ty = offsetY + Math.floor(i / activeMapWidth) * TILE_SIZE;\n\n        gameState.current.x = tx;\n        gameState.current.y = ty;\n\n        try {\n          const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n          playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n        } catch {}\n        return true;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport default { handleTeleportInteraction };\n","export function applyInteractableEffects({\n  objDef,\n  actualIndex,\n  currentMapId,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  MAX_HEALTH\n}) {\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return false;\n  if (!objDef.effect) return true;\n\n  const interactableKey = currentMapId === 'main' ? `${actualIndex}` : `${currentMapId}:${actualIndex}`;\n  if (gameState.current.usedInteractables.has(interactableKey)) return true;\n\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return true;\n\n    gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  return true;\n}\n\nexport default { applyInteractableEffects };\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = getDefById(registryItems, startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n  const revealedSet = (revealedSecrets instanceof Set)\n    ? revealedSecrets\n    : new Set(revealedSecrets || []);\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSet.has(idx)) continue;\n\n      const def = getDefById(registryItems, secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSet.has(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","// Secret-related trigger handlers (weather, messages)\n\nexport function handleWeatherTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx\n}) {\n  if (!objDef || objDef.type !== 'weather_trigger') return false;\n\n  const weatherType = objDef.weatherType; // rain, snow, clouds, fog, thunder\n  const action = objDef.weatherAction; // on, off, set\n  let value = 0;\n\n  if (action === 'set' || action === 'on') {\n    value = currentMeta?.intensity !== undefined ? currentMeta.intensity : (action === 'on' ? 100 : 50);\n  } else if (action === 'off') {\n    value = 0;\n  }\n\n  if (!gameState.current.lastWeatherTrigger) {\n    gameState.current.lastWeatherTrigger = {};\n  }\n\n  const lastVal = gameState.current.lastWeatherTrigger[index];\n  if (lastVal !== value) {\n    if (onStateUpdate) {\n      onStateUpdate('updateWeather', { type: weatherType, value });\n    }\n    gameState.current.lastWeatherTrigger[index] = value;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport function handleMessageTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx\n}) {\n  if (!objDef || objDef.type !== 'message_trigger') return false;\n\n  const message = currentMeta?.message;\n  if (!message) return true;\n\n  if (!gameState.current.lastMessageTrigger) {\n    gameState.current.lastMessageTrigger = {};\n  }\n\n  const lastMsg = gameState.current.lastMessageTrigger[index];\n  if (lastMsg !== message) {\n    if (onStateUpdate) {\n      onStateUpdate('showMessage', { text: message, duration: 8000 });\n    }\n    gameState.current.lastMessageTrigger[index] = message;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport default { handleWeatherTrigger, handleMessageTrigger };\n","// Wolfenstein-style secret triggers and movement handling\n\nexport function triggerWolfSecret({\n  objDef,\n  index,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  playerCenterX,\n  playerCenterY,\n  objCenterX,\n  objCenterY,\n  playerGridX,\n  playerGridY,\n  objGridX,\n  objGridY\n}) {\n  if (!objDef || objDef.type !== 'wolf_secret') return false;\n  if (!keys?.e) return true;\n\n  const moveX = objDef.moveX || 0;\n  const moveY = objDef.moveY || 0;\n  if (moveX !== 0 || moveY !== 0) {\n    const hasGrid = Number.isFinite(playerGridX) && Number.isFinite(playerGridY) && Number.isFinite(objGridX) && Number.isFinite(objGridY);\n    if (hasGrid) {\n      if (moveX < 0 && !(playerGridX > objGridX)) return true;\n      if (moveX > 0 && !(playerGridX < objGridX)) return true;\n      if (moveY < 0) {\n        if (!keys?.w) return true;\n        if (!(playerGridY > objGridY)) return true;\n      }\n      if (moveY > 0) {\n        if (!keys?.s) return true;\n        if (!(playerGridY < objGridY)) return true;\n      }\n    } else {\n      const eps = 0.01;\n      if (moveX < 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX > objCenterX + eps)) return true;\n      }\n      if (moveX > 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX < objCenterX - eps)) return true;\n      }\n      if (moveY < 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.w) return true;\n        if (!(playerCenterY > objCenterY + eps)) return true;\n      }\n      if (moveY > 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.s) return true;\n        if (!(playerCenterY < objCenterY - eps)) return true;\n      }\n    }\n  }\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 1000) return true;\n  gameState.current.lastETime = now;\n\n  if (onStateUpdate) {\n    const dx = moveX;\n    const dy = moveY;\n    onStateUpdate('shiftTile', { index, dx, dy });\n\n    if (objDef.sfx) {\n      try { playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5); } catch {}\n    }\n  }\n  return true;\n}\n\nexport function applyWolfSecretShift({\n  index,\n  dx,\n  dy,\n  mapWidth,\n  mapHeight,\n  getObjectId,\n  getObjectDef,\n  moveTile,\n  moveObject,\n  moveMetadata,\n  removeObject,\n  stepDelayMs = 250,\n  setTimeoutFn = setTimeout,\n  shouldCancel\n}) {\n  let currentIdx = index;\n  let remainingDx = dx;\n  let remainingDy = dy;\n  const originId = getObjectId(currentIdx);\n  if (!originId) return;\n\n  const moveStep = () => {\n    if (shouldCancel && shouldCancel()) return;\n    const currentId = getObjectId(currentIdx);\n    if (!currentId || currentId !== originId) return;\n    if (remainingDx === 0 && remainingDy === 0) {\n      if (removeObject) removeObject(currentIdx);\n      return;\n    }\n\n    const stepX = remainingDx > 0 ? 1 : (remainingDx < 0 ? -1 : 0);\n    const stepY = remainingDy > 0 ? 1 : (remainingDy < 0 ? -1 : 0);\n\n    const tx = (currentIdx % mapWidth) + stepX;\n    const ty = Math.floor(currentIdx / mapWidth) + stepY;\n\n    if (tx >= 0 && tx < mapWidth && ty >= 0 && ty < mapHeight) {\n      const targetIndex = ty * mapWidth + tx;\n\n      const isLastStepOfBatch = (Math.abs(remainingDx) === 1 && remainingDy === 0) ||\n        (Math.abs(remainingDy) === 1 && remainingDx === 0);\n      if (isLastStepOfBatch) {\n        const targetObjId = getObjectId(targetIndex);\n        const targetDef = getObjectDef(targetObjId);\n        if (targetDef && targetDef.type === 'wolf_secret') {\n          const extraX = Math.abs(targetDef.moveX || 3);\n          const extraY = Math.abs(targetDef.moveY || 3);\n          if (remainingDx !== 0) remainingDx += (remainingDx > 0 ? extraX : -extraX);\n          if (remainingDy !== 0) remainingDy += (remainingDy > 0 ? extraY : -extraY);\n        }\n      }\n\n      if (moveTile) moveTile(currentIdx, targetIndex);\n      if (moveObject) moveObject(currentIdx, targetIndex);\n      if (moveMetadata) moveMetadata(currentIdx, targetIndex);\n\n      currentIdx = targetIndex;\n      remainingDx -= stepX;\n      remainingDy -= stepY;\n\n      if (remainingDx !== 0 || remainingDy !== 0) {\n        setTimeoutFn(moveStep, stepDelayMs);\n      } else {\n        if (removeObject) removeObject(currentIdx);\n      }\n    } else {\n      if (removeObject) removeObject(currentIdx);\n    }\n  };\n\n  moveStep();\n}\n\nexport default { triggerWolfSecret, applyWolfSecretShift };\n","// Helpers for crack_block secret behavior\n\nexport function shouldRemoveCrackBlock(def, newHealth) {\n  if (!def || def.type !== 'crack_block') return false;\n  const threshold = def.passableHealthThreshold || 0;\n  return newHealth <= threshold;\n}\n\nexport default { shouldRemoveCrackBlock };\n","import { resolveInteractableContext } from './context';\nimport { handleDoorInteraction } from './doors';\nimport { handleTeleportInteraction } from './teleport';\nimport { applyInteractableEffects } from './effects';\nimport { handleWeatherTrigger, handleMessageTrigger, triggerWolfSecret } from '../secrets';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, mapHeight, objectLayerData) {\n  const {\n    registryItems,\n    TILE_SIZE,\n    MAX_HEALTH,\n    playShotSfx,\n    onStateUpdate,\n    gameState,\n    mapData,\n    activeRoomIds: activeRoomIdsProp,\n    objectMetadata: mainObjectMetadata,\n    secretMapData\n  } = ctx;\n  if (!objectLayerData) return;\n\n  const keys = ctx.input?.current || {};\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps\n  } = resolveInteractableContext({\n    mapData,\n    mapWidth,\n    mapHeight,\n    objectLayerData,\n    mainObjectMetadata,\n    secretMapData,\n    activeRoomIds: activeRoomIdsProp,\n    centerX,\n    centerY,\n    TILE_SIZE\n  });\n\n  const localX = centerX - offsetX;\n  const localY = centerY - offsetY;\n\n  const gridX = Math.floor(localX / TILE_SIZE);\n  const gridY = Math.floor(localY / TILE_SIZE);\n  let index = gridY * activeMapWidth + gridX;\n\n  if (keys.e) {\n    let targetIndex = null;\n\n    if (keys.w) {\n        const upIndex = (gridY - 1) * activeMapWidth + gridX;\n        if (gridY - 1 >= 0) {\n          const upObjId = activeObjectData?.[upIndex];\n          const upDef = getDefById(registryItems, upObjId);\n          if (upDef && upDef.type === 'wolf_secret') {\n            targetIndex = upIndex;\n          }\n        }\n      }\n\n    if (targetIndex === null && keys.s) {\n      const downIndex = (gridY + 1) * activeMapWidth + gridX;\n      const limitHeight = activeMapHeight || mapHeight || 0;\n      if (gridY + 1 < limitHeight) {\n        const downObjId = activeObjectData?.[downIndex];\n        const downDef = getDefById(registryItems, downObjId);\n        if (downDef && downDef.type === 'wolf_secret') {\n          targetIndex = downIndex;\n        }\n      }\n    }\n\n    if (targetIndex === null) {\n      const dir = keys.d ? 1 : (keys.a ? -1 : (gameState.current.direction || 1));\n      const frontX = localX + dir * (TILE_SIZE * 0.8);\n      const frontGridX = Math.floor(frontX / TILE_SIZE);\n      const frontIndex = gridY * activeMapWidth + frontGridX;\n\n      if (frontIndex >= 0 && frontIndex < (activeObjectData?.length || 0)) {\n        const frontObjId = activeObjectData[frontIndex];\n        if (frontObjId) {\n          const frontDef = getDefById(registryItems, frontObjId);\n          if (frontDef && (frontDef.type === 'wolf_secret' || frontDef.subtype === 'door' || frontDef.name?.startsWith('interactable.'))) {\n            targetIndex = frontIndex;\n          }\n        }\n      }\n    }\n\n    if (targetIndex !== null) {\n      index = targetIndex;\n    }\n  }\n\n  let foundIndex = -1;\n  const directObjId = activeObjectData ? activeObjectData[index] : null;\n  if (directObjId) {\n    foundIndex = index;\n  } else if (activeMetadata) {\n    for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      const w = meta.width || 1;\n      const h = meta.height || 1;\n      if (w > 1 || h > 1) {\n        const ox = idx % activeMapWidth;\n        const oy = Math.floor(idx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          if (activeObjectData && activeObjectData[idx]) {\n            foundIndex = idx;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (foundIndex === -1) return;\n  const actualIndex = foundIndex;\n\n  const currentMeta = activeMetadata?.[actualIndex];\n  const objId = activeObjectData[actualIndex];\n  if (!objId) return;\n\n  const objDef = getDefById(registryItems, objId);\n  if (!objDef) return;\n\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (handleWeatherTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx })) return;\n  if (handleMessageTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx })) return;\n  if (triggerWolfSecret({\n    objDef,\n    index: actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    playerCenterX: localX,\n    playerCenterY: localY,\n    objCenterX: ((actualIndex % activeMapWidth) + 0.5) * TILE_SIZE,\n    objCenterY: (Math.floor(actualIndex / activeMapWidth) + 0.5) * TILE_SIZE,\n    playerGridX: gridX,\n    playerGridY: gridY,\n    objGridX: actualIndex % activeMapWidth,\n    objGridY: Math.floor(actualIndex / activeMapWidth)\n  })) return;\n\n  if (handleDoorInteraction({\n    objDef,\n    currentMeta,\n    actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    mapData,\n    mapWidth,\n    TILE_SIZE,\n    activeTargetMap,\n    projectMaps\n  })) return;\n\n  if (handleTeleportInteraction({\n    objId,\n    objDef,\n    currentMeta,\n    actualIndex,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    offsetX,\n    offsetY,\n    projectMaps,\n    onStateUpdate,\n    playShotSfx,\n    gameState,\n    TILE_SIZE\n  })) return;\n\n  if (objDef.subtype === 'end' && !gameState.current.isWinning) {\n    gameState.current.isWinning = true;\n    gameState.current.winCounter = 0;\n    gameState.current.winCountSpeed = objDef.winCountSpeed || 10;\n    return;\n  }\n\n  applyInteractableEffects({\n    objDef,\n    actualIndex,\n    currentMapId,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    MAX_HEALTH\n  });\n}\n\nexport default { checkInteractables };\n","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor(playerRight / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor(playerBottom / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = getDefById(registryItems, objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight >= tileLeft && playerLeft <= tileRight;\n      const overlapsVertically = playerBottom >= tileTop && playerTop <= tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const overlapTop = playerBottom - tileTop;\n        const overlapBottom = tileBottom - playerTop;\n        const overlapLeft = playerRight - tileLeft;\n        const overlapRight = tileRight - playerLeft;\n        const min = Math.min(overlapTop, overlapBottom, overlapLeft, overlapRight);\n        touchingTop = (min === overlapTop);\n        touchingBottom = (!touchingTop && min === overlapBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === overlapLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef, isInsideRoom } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    \n    let vol = Math.max(0, Math.min(1, volume ?? 1));\n    let muffled = !!isInsideRoom;\n\n    if (muffled) {\n        vol *= 0.5; // Reduce volume if inside\n    }\n\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        \n        // If we wanted a filter for SFX, we'd need to set up Web Audio context for each sound,\n        // which might be heavy for many sounds. Let's stick to volume reduction for simplicity \n        // unless Web Audio context is already available and passed in.\n\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol, muffled);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol, muffled = false) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    \n    // Lowpass filter if muffled\n    let lastNode = osc;\n    if (muffled) {\n        const filter = audioCtx.createBiquadFilter();\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(600, now);\n        osc.connect(filter);\n        lastNode = filter;\n    }\n\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(muffled ? 260 : 520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    \n    lastNode.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  friction = 0.8,\n  acceleration = 0.2,\n  deltaMs = 16.67\n}) {\n  let { x, vx, width, direction, y, height } = state;\n  \n  const timeScale = deltaMs / 16.67;\n  const targetVx = keys?.a ? -MOVE_SPEED : (keys?.d ? MOVE_SPEED : 0);\n  \n  if (targetVx !== 0) {\n    // Accelerate\n    vx += targetVx * acceleration * timeScale;\n    if (Math.abs(vx) > MOVE_SPEED) vx = Math.sign(vx) * MOVE_SPEED;\n    direction = Math.sign(targetVx);\n  } else {\n    // Apply friction (time-scaled)\n    const effectiveFriction = Math.pow(friction, timeScale);\n    vx *= effectiveFriction;\n    if (Math.abs(vx) < 0.1) vx = 0;\n  }\n\n  const proposedX = x + vx * timeScale;\n  const py = y ?? 0;\n  if (checkCollision(proposedX, py, mapWidth, mapHeight, width, height)) {\n    // Precza apstans pie ra\n    const step = 0.05;\n    const sign = Math.sign(vx);\n    let safeX = x;\n    const moveDist = Math.abs(vx * timeScale);\n    \n    for (let d = step; d <= moveDist; d += step) {\n      const nextX = x + d * sign;\n      if (!checkCollision(nextX, py, mapWidth, mapHeight, width, height)) {\n        safeX = nextX;\n      } else {\n        break;\n      }\n    }\n    x = safeX;\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  // Sanitize coordinates to avoid sub-pixel noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  x = Math.round(x * 1000) / 1000;\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isLiquidAt(wx, wy): optional helper to detect liquid type at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isLiquidAt,\n  prevInWater,\n  deltaMs = 16.67\n}) {\n  const timeScale = deltaMs / 16.67;\n  \n  // Liquid defaults\n  let liqBuoyancy = 0.5; // reduces effective gravity by 50%\n  let liqDragY = 0.88;  // vertical damping per frame when in liquid\n  let liqTerminal = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n  let swimImpulseMult = 0.55;\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  let activeLiquidType = null;\n\n  if (typeof isLiquidAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    \n    const feetLiq = isLiquidAt(cx, feetY);\n    const chestLiq = isLiquidAt(cx, chestY);\n    const headLiq = isLiquidAt(cx, headY);\n    \n    activeLiquidType = feetLiq || chestLiq;\n    inWater = !!activeLiquidType;\n    headUnderWater = !!headLiq;\n    atSurface = inWater && !headUnderWater;\n\n    // Apply per-liquid physics overrides\n    if (activeLiquidType === 'quicksand') {\n      liqBuoyancy = -0.15; // Negative buoyancy makes player sink!\n      liqDragY = 0.85;     // Higher drag\n      liqTerminal = 1.2;   // Very slow terminal velocity for sinking\n      swimImpulseMult = 0.35; // Harder to jump/swim\n    } else if (activeLiquidType === 'lava') {\n      liqBuoyancy = 0.3;\n      liqDragY = 0.82;\n    } else if (activeLiquidType === 'waterfall') {\n      liqBuoyancy = -0.5; // Acts like extra gravity\n      liqDragY = 0.95;     // Very low resistance\n      liqTerminal = TERMINAL_VELOCITY * 1.5; // Allow falling faster than usual terminal velocity\n    } else if (activeLiquidType === 'lava_waterfall') {\n      liqBuoyancy = -0.4; // Slightly more viscous than water\n      liqDragY = 0.92;\n      liqTerminal = TERMINAL_VELOCITY * 1.3;\n    } else if (activeLiquidType === 'radioactive_waterfall') {\n      liqBuoyancy = -0.2; // Slower fall than normal waterfall\n      liqDragY = 0.94;\n      liqTerminal = TERMINAL_VELOCITY * 0.7; // Slower speed\n    } else if (activeLiquidType === 'radioactive_water') {\n      liqBuoyancy = 0.45; // Slightly less buoyant than water\n      liqDragY = 0.86;\n    }\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * swimImpulseMult));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5 * timeScale; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - liqBuoyancy) * timeScale;\n    vy *= Math.pow(liqDragY, timeScale);\n    if (vy > liqTerminal) vy = liqTerminal;\n  } else {\n    vy += GRAVITY * timeScale;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  const proposedY = y + vy * timeScale;\n  if (checkCollision(x, proposedY, mapWidth, mapHeight, width, height)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      // Snapping to the pixel above the tile - use a small offset consistent with collision inset\n      y = Math.floor((proposedY + height - 0.1) / TILE_SIZE) * TILE_SIZE - height;\n      \n      if (Math.abs(vx || 0) > 0.1) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((proposedY + 0.1) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y = proposedY;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  // Sanitize coordinates to prevent floating point noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  y = Math.round(y * 1000) / 1000;\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = getDefById(registryItems, id);\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.lava_waterfall ? 'lava_waterfall' :\n               (def.flags.radioactive_waterfall ? 'radioactive_waterfall' :\n               (def.flags.waterfall ? 'waterfall' :\n               (def.flags.radioactive_water ? 'radioactive_water' :\n               (def.flags.quicksand ? 'quicksand' :\n               (def.flags.lava ? 'lava' :\n               (def.flags.water ? 'water' : 'liquid'))))));\n  const overlayColorRaw = def?.liquid?.overlay?.color ?? def?.liquid?.overlayColor ?? def?.tintBelowSurface;\n  const overlayAlphaRaw = def?.liquid?.overlay?.alpha ?? def?.liquid?.overlayAlpha;\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    overlay: {\n      color: Number(overlayColorRaw),\n      alpha: Number(overlayAlphaRaw)\n    },\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    },\n    resources: def?.liquid?.resources || {}\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  const defaultOverlay = (() => {\n    if (type.includes('lava')) return { color: 10914816, alpha: 0.25 };\n    if (type === 'quicksand') return { color: 10916187, alpha: 0.2 };\n    if (type === 'radioactive_water' || type === 'radioactive_waterfall') return { color: 1727514, alpha: 0.18 };\n    return { color: 1919093, alpha: 0.15 };\n  })();\n  const rawOverlayColor = candidate.params?.overlay?.color;\n  const rawOverlayAlpha = candidate.params?.overlay?.alpha;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    overlay: {\n      color: Number.isFinite(rawOverlayColor) ? rawOverlayColor : defaultOverlay.color,\n      alpha: Number.isFinite(rawOverlayAlpha) ? rawOverlayAlpha : defaultOverlay.alpha\n    },\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    },\n    resources: candidate.params?.resources || {}\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","import weatherDamageConfig from '../../assets/json/system/weather_damage.json';\n\nconst clampIntensity = (v) => {\n  const n = Number(v) || 0;\n  return Math.max(0, Math.min(100, n));\n};\n\nconst getWeatherConfig = (type) => {\n  return weatherDamageConfig?.weather?.[type] || null;\n};\n\nexport const getMapWeather = (mapData) => {\n  if (!mapData) return {};\n  let base = {};\n  if (mapData.weather) base = mapData.weather;\n  else {\n    const metaWeather = mapData.meta?.weather;\n    if (metaWeather && Object.keys(metaWeather).length > 0) {\n      base = metaWeather;\n    } else {\n      const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap;\n      if (activeId && mapData.maps && mapData.maps[activeId] && mapData.maps[activeId].weather) {\n        base = mapData.maps[activeId].weather;\n      } else {\n        base = mapData.meta?.weather || {};\n      }\n    }\n  }\n  let runtime = {};\n  try {\n    const rt = window.__GAME_RUNTIME_SETTINGS__ || {};\n    runtime = {\n      rain: rt.weatherRain,\n      snow: rt.weatherSnow,\n      clouds: rt.weatherClouds,\n      fog: rt.weatherFog,\n      thunder: rt.weatherThunder,\n      lavaRain: rt.weatherLavaRain,\n      radioactiveFog: rt.weatherRadioactiveFog,\n      meteorRain: rt.weatherMeteorRain\n    };\n  } catch {}\n  const merged = { ...base };\n  Object.keys(runtime).forEach(key => {\n    if (runtime[key] !== undefined && runtime[key] !== null) {\n      merged[key] = runtime[key];\n    }\n  });\n  return merged;\n};\n\nexport const getWeatherDps = (type, intensity) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return 0;\n  const pct = clampIntensity(intensity);\n  if (pct <= 0) return 0;\n  const maxDps = Number(cfg.maxDps) || 0;\n  const minDps = Number(cfg.minDps) || 0;\n  const dps = (pct / 100) * maxDps;\n  return Math.max(minDps, dps);\n};\n\nexport const getRadioactivityRates = () => {\n  const cfg = getWeatherConfig('radioactiveFog') || {};\n  const inc = Number(cfg.radioactivityPerSecond);\n  const dec = Number(cfg.radioactivityRegenPerSecond);\n  return {\n    increase: Number.isFinite(inc) ? inc : 0,\n    decay: Number.isFinite(dec) ? dec : 0\n  };\n};\n\nexport const weatherAffectsPlayer = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  return !!cfg.affects?.player;\n};\n\nexport const weatherAffectsEnemy = (type, enemyId, enemyName) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  const enemies = cfg.affects?.enemies;\n  if (enemies === 'true') return true;\n  if (enemies === true || enemies === 'all') return true;\n  if (enemies && typeof enemies === 'object' && enemies.mode === 'all') {\n    const excluded = Array.isArray(enemies.exclude) ? enemies.exclude : [];\n    const isExcluded = (value) => value && excluded.some(ex => value === ex || value.includes(ex));\n    if (isExcluded(enemyId)) return false;\n    if (isExcluded(enemyName)) return false;\n    return true;\n  }\n  if (Array.isArray(enemies)) {\n    if (enemyId && enemies.some(ex => enemyId === ex || enemyId.includes(ex))) return true;\n    if (enemyName && enemies.some(ex => enemyName === ex || enemyName.includes(ex))) return true;\n    return false;\n  }\n  return false;\n};\n\nexport const weatherBlockedByCover = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg) return false;\n  return !!cfg.blockedByCover;\n};\n","// Collision helpers (migrated from GameEngine/collision.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile or an object)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve definitions\n// - secretData: secret layer array (ids)\n// - objectData: object layer array (ids)\n// - objectMetadata: metadata for objects (e.g. health)\n// - entities: array of active entities (optional)\n// - ignoreEntityId: ID of the entity to ignore in check (optional)\n// - maps: all project maps (optional, for room overlays)\n// - activeRoomIds: IDs of currently active/open rooms (optional)\n// - isRoom: boolean, whether we are checking collision for a room sub-map\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds, isRoom = false) {\n  try {\n    const gx = Math.floor(wx / TILE_SIZE);\n    const gy = Math.floor(wy / TILE_SIZE);\n\n    // Boundary check\n    if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n        // Rooms have strict boundaries. Main map allows falling off the bottom.\n        // checkCollision handles top/left/right boundaries for main map.\n        return isRoom; \n    }\n\n    // Allow movement above the map (already handled by gx,gy check usually, but just in case)\n    if (wy < 0) return false;\n\n    // 0. Check for active rooms (sub-maps) - Priority check\n    if (!isRoom && maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n      let insideAnyRoom = false;\n      \n      for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n        const idx = parseInt(idxStr);\n        if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n          const roomMap = maps[meta.linkedMapId];\n          if (!roomMap) continue;\n\n          const rx = (idx % mapWidthTiles) * TILE_SIZE;\n          const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n          const rw = (meta.width || 1) * TILE_SIZE;\n          const rh = (meta.height || 1) * TILE_SIZE;\n\n          // Boundary check with pixel precision\n          // Pievienojam nelielu pielaidi (0.2px) apak, lai snapping loika vertical.js \n          // (kas izmanto y + height - 0.1) nepalaistu garm istabas grdu.\n          if (wx >= rx && wx < rx + rw && wy >= ry && wy < ry + rh + 0.2) {\n            insideAnyRoom = true;\n            \n            const localWx = wx - rx;\n            const localWy = wy - ry;\n            \n            const roomTileW = roomMap.mapWidth || roomMap.width;\n            const roomTileH = roomMap.mapHeight || roomMap.height;\n            \n            const roomTiles = roomMap.tileMapData || roomMap.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data;\n            const roomObjects = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            const roomSecrets = roomMap.secretMapData || roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data;\n\n            const solidInRoom = isSolidAtPixel(\n              localWx, localWy, \n              roomTileW, roomTileH, TILE_SIZE, \n              roomTiles, \n              registryItems, \n              roomSecrets, \n              roomObjects, \n              roomMap.objectMetadata, \n              null, \n              ignoreEntityId,\n              null,\n              null,\n              true // WE ARE IN A ROOM\n            );\n\n            if (solidInRoom) return true;\n            \n            // If the room map has NO content at this spot, it's a window/open area.\n            // The recursive call with isRoom=true already blocked the boundaries of the room map.\n            return false;\n          }\n        }\n      }\n      \n      if (!insideAnyRoom) {\n        // Izmums: aujam atrasties uz durvm, kas ir atvrtas, pat ja ts ir rpus room_area.\n        // Tas ir nepiecieams, lai spltjs neiestrgtu teleportcijas brd, izejot no istabas.\n        const index = gy * mapWidthTiles + gx;\n        const objId = objectData && objectData[index];\n        if (objId) {\n        const objDef = getDefById(registryItems, objId);\n          if (objDef && objDef.subtype === 'door') {\n            const meta = (objectMetadata && objectMetadata[index]) || {};\n            let frame = meta.currentFrame;\n            if (frame === undefined) frame = 0;\n            \n            const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n            if (frame !== closedFrame) {\n              return false; // Durvis ir atvrtas, aujam te atrasties\n            }\n          }\n        }\n        return true; \n      }\n    }\n\n    const index = gy * mapWidthTiles + gx;\n    \n    // 0. Check entities first (dynamic obstacles)\n    if (entities) {\n      for (const ent of entities) {\n        if (ent.id === ignoreEntityId) continue;\n        if (ent.health <= 0 || ent.isExploding) continue;\n        // Platforms are stand-on-able but not usually \"solid\" for other entities' horizontal physics\n        if (ent.subtype === 'platform') continue;\n\n        if (wx >= ent.x && wx < ent.x + ent.width && wy >= ent.y && wy < ent.y + ent.height) {\n          return true;\n        }\n      }\n    }\n\n    // Check if this tile has a secret - secrets make tiles passable\n    if (secretData && secretData[index]) {\n      return false;\n    }\n\n    // 1. Check objects layer first (like the wooden box)\n    if (objectData && objectData[index]) {\n      const objId = objectData[index];\n      const objDef = getDefById(registryItems, objId);\n      \n      const isEntity = objDef && (\n        objDef.type === 'entity' || \n        objDef.subtype === 'tank' || \n        objDef.subtype === 'platform' ||\n        objDef.subtype === 'pushable' ||\n        objDef.isPushable ||\n        (objDef.name && objDef.name.toLowerCase().includes('entities.'))\n      );\n\n      if (objDef && objDef.collision && !isEntity) {\n        // Durvju specil loika: atvrtas/lietotas durvis nav cietas\n        if (objDef.subtype === 'door') {\n          const meta = (objectMetadata && objectMetadata[index]) || {};\n          let frame = meta.currentFrame;\n          \n          if (frame === undefined) {\n              // Default frame for rooms is 'inside' (open)\n              if (isRoom) {\n                  frame = objDef.interaction?.frames?.inside ?? 0;\n              } else {\n                  frame = 0; // Default for main map is closed\n              }\n          }\n\n          const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n          \n          // Ja durvis nav aizvrtas (ir atvrans fz vai atvrtas), ts nav cietas\n          if (frame !== closedFrame) {\n            return false;\n          }\n        }\n\n        // Special logic for destructible objects like the wooden box\n        if (objDef.isDestructible && objectMetadata && objectMetadata[index]) {\n          const health = objectMetadata[index].health !== undefined ? objectMetadata[index].health : objDef.maxHealth;\n          const threshold = objDef.passableHealthThreshold || 0;\n          if (health <= threshold) {\n            return false; // Box is broken, can pass through\n          }\n        }\n        return true;\n      }\n    }\n\n    // 2. Check tiles layer\n    const tileId = tileData[index];\n    if (!tileId) return false;\n    const tileDef = getDefById(registryItems, tileId);\n    if (!tileDef || !tileDef.collision) return false;\n    if (tileDef.collision === true) return true;\n    if (typeof tileDef.collision === 'object') {\n      return !!(\n        tileDef.collision.top ||\n        tileDef.collision.bottom ||\n        tileDef.collision.left ||\n        tileDef.collision.right\n      );\n    }\n    return false;\n  } catch (error) {\n    console.error('Error in isSolidAtPixel:', error);\n    return false;\n  }\n}\n\n// AABB collision check for player rectangle at (newX, newY)\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds) {\n  // Insets and epsilon values to prevent \"sticking\" and ensure stable grounding.\n  // inset: distance from corners for edge-mid points to avoid catching perpendicular walls.\n  // eps: small offset from the actual edge to ensure we stay within the intended tile/boundary.\n  const inset = 1.0; \n  const eps = 0.1;\n  \n  const points = [\n    // Vertical checks (Top/Bottom)\n    { x: newX + inset, y: newY + eps }, \n    { x: newX + width - inset, y: newY + eps },\n    { x: newX + width / 2, y: newY + eps },\n    \n    { x: newX + inset, y: newY + height - eps },\n    { x: newX + width - inset, y: newY + height - eps },\n    { x: newX + width / 2, y: newY + height - eps },\n\n    // Horizontal checks (Left/Right)\n    { x: newX + eps, y: newY + inset },\n    { x: newX + eps, y: newY + height - inset },\n    { x: newX + eps, y: newY + height / 2 },\n\n    { x: newX + width - eps, y: newY + inset },\n    { x: newX + width - eps, y: newY + height - inset },\n    { x: newX + width - eps, y: newY + height / 2 }\n  ];\n\n  for (let p of points) {\n    const gx = Math.floor(p.x / TILE_SIZE);\n    const gy = Math.floor(p.y / TILE_SIZE);\n    \n    // Boundary checks: block left, right, and top edges of the world.\n    // Allow falling off the bottom (gy >= mapHeightTiles).\n    if (gx < 0 || gx >= mapWidthTiles || gy < 0) return true;\n\n    if (isSolidAtPixel(p.x, p.y, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Gets physical properties of the surface below the player (friction, acceleration)\n */\nexport function getSurfaceProperties(x, y, width, height, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectMetadata, maps, activeRoomIds) {\n  const cx = x + width / 2;\n  const feetY = y + height + 1; // 1 pixel below feet\n\n  // Check for active rooms (sub-maps) - Priority check\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n    for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidthTiles) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (cx >= rx && cx < rx + rw && feetY >= ry && feetY < ry + rh + 2) {\n          // Point is inside an active room!\n          const localCx = cx - rx;\n          const localFeetY = feetY - ry;\n          \n          const roomTileW = roomMap.mapWidth || roomMap.width;\n          const roomTileH = roomMap.mapHeight || roomMap.height;\n          \n          return getSurfaceProperties(\n            localCx - width/2, localFeetY - height - 1, width, height,\n            roomTileW, roomTileH, TILE_SIZE,\n            roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data),\n            registryItems,\n            roomMap.secretMapData,\n            roomMap.objectMetadata,\n            null,\n            null\n          );\n        }\n      }\n    }\n  }\n\n  const gx = Math.floor(cx / TILE_SIZE);\n  const gy = Math.floor(feetY / TILE_SIZE);\n  \n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n    return { friction: 0.8, acceleration: 0.2 };\n  }\n  \n  const index = gy * mapWidthTiles + gx;\n  const tileId = tileData ? tileData[index] : null;\n  if (!tileId) return { friction: 0.8, acceleration: 0.2 };\n  \n    const tileDef = getDefById(registryItems, tileId);\n  if (!tileDef) return { friction: 0.8, acceleration: 0.2 };\n  \n  // If block has slipperiness, use it. Default friction is 0.8.\n  const slipperiness = tileDef.slipperiness !== undefined ? tileDef.slipperiness : 0.8;\n  \n  return {\n    friction: slipperiness,\n    // When slippery, acceleration is lower (harder to start/change direction)\n    acceleration: tileDef.slipperiness !== undefined ? (1 - slipperiness) * 2 + 0.05 : 0.2\n  };\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n  getSurfaceProperties\n};\n","import { isSolidAtPixel } from '../physics/collision';\n\nconst isInsideActiveRoom = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  secretData,\n  objectMetadata,\n  activeRoomIds\n}) => {\n  if (!activeRoomIds || !activeRoomIds.length) return false;\n  if (!secretData || !objectMetadata) return false;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false;\n  for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n    const idx = parseInt(idxStr, 10);\n    if (secretData[idx] !== 'room_area') continue;\n    if (!meta?.linkedMapId || !activeRoomIds.includes(meta.linkedMapId)) continue;\n    const rx = idx % mapWidth;\n    const ry = Math.floor(idx / mapWidth);\n    const rw = meta.width || 1;\n    const rh = meta.height || 1;\n    if (gx >= rx && gx < rx + rw && gy >= ry && gy < ry + rh) return true;\n  }\n  return false;\n};\n\nexport const isCoveredFromAbove = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  tileData,\n  registryItems,\n  secretData,\n  objectData,\n  objectMetadata,\n  maps,\n  activeRoomIds\n}) => {\n  if (!Number.isFinite(x) || !Number.isFinite(y)) return false;\n  if (isInsideActiveRoom({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectMetadata, activeRoomIds })) {\n    return true;\n  }\n  const gridX = Math.floor(x / TILE_SIZE);\n  if (gridX < 0 || gridX >= mapWidth) return false;\n  let gridY = Math.floor(y / TILE_SIZE) - 1;\n  for (; gridY >= 0; gridY--) {\n    const wx = gridX * TILE_SIZE + TILE_SIZE / 2;\n    const wy = gridY * TILE_SIZE + TILE_SIZE / 2;\n    if (isSolidAtPixel(wx, wy, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, null, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n};\n","import { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { getWeatherDps, getMapWeather, weatherAffectsEnemy, weatherBlockedByCover } from './weatherDamage';\nimport { isCoveredFromAbove } from './weatherCover';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Atjaunina visas aktvs enttijas (piemram, tankus).\n * @param {Object} ctx Konteksts ar nepiecieamajiem datiem un funkcijm\n * @param {number} deltaMs Laiks kop pdj kadra\n */\nexport function updateEntities(ctx, deltaMs) {\n  const {\n    entitiesRef,\n    gameState,\n    mapWidth,\n    mapHeight,\n    TILE_SIZE,\n    checkCollision,\n    isLiquidAt,\n    getLiquidSample,\n    spawnProjectile,\n    playSfx,\n    constants,\n    objectData,\n    mapData,\n    registryItems,\n    onStateUpdate,\n    activeRoomIds\n  } = ctx;\n\n  if (!entitiesRef.current || entitiesRef.current.length === 0) return;\n\n  const { GRAVITY, TERMINAL_VELOCITY } = constants;\n  const playerX = gameState.current.x;\n  const playerY = gameState.current.y;\n  const weatherNow = getMapWeather(mapData);\n  const lavaRainInt = Number(weatherNow.lavaRain || 0);\n  const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n\n  // Ms modificjam enttijas pa tieo ref\n  const entities = entitiesRef.current;\n  for (let i = entities.length - 1; i >= 0; i--) {\n    const entity = entities[i];\n    // 1. Ja enttija ir mirusi, apstrdjam sprdzienu vai noemanu\n    if (entity.health <= 0) {\n      if (!entity.isExploding) {\n        entity.isExploding = true;\n        entity.animation = 'explode';\n        entity.animFrame = 0;\n        entity.animTimer = 0;\n        entity.vx = 0; // Apstjamies sprdziena laik\n        entity.vy = 0;\n        entity.isGrounded = true; // Sprgst uz zemes\n      }\n      \n      const def = entity.def;\n      const explodeAnim = def.spriteSheet?.animations?.explode || [];\n      const totalFrames = explodeAnim.length;\n      const frameDuration = 100; // ms uz kadru\n      \n      entity.animTimer += deltaMs;\n      if (entity.animTimer >= frameDuration) {\n        entity.animTimer = 0;\n        entity.animFrame++;\n        if (entity.animFrame >= totalFrames) {\n          entity.shouldRemove = true;\n        }\n      }\n      if (entity.shouldRemove) {\n        entities.splice(i, 1);\n      }\n      continue;\n    }\n\n    const def = entity.def;\n    \n    // 1.2. Liquid damage (e.g. lava, radioactive water)\n    const liquidSample = getLiquidSample ? getLiquidSample({\n      x: entity.x,\n      y: entity.y,\n      width: entity.width,\n      height: entity.height,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight\n    }) : { inLiquid: false };\n\n    if (liquidSample.inLiquid && liquidSample.params && liquidSample.params.dps > 0) {\n      entity.liquidDamageAcc = (entity.liquidDamageAcc || 0) + deltaMs;\n      while (entity.liquidDamageAcc >= 1000) {\n        entity.liquidDamageAcc -= 1000;\n        const dmg = liquidSample.params.dps;\n        entity.health = Math.max(0, entity.health - dmg);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: dmg\n          });\n        }\n      }\n    } else {\n      entity.liquidDamageAcc = 0;\n    }\n\n    // 1.3. Weather damage (Lava Rain, Radioactive Fog)\n    const enemyId = entity.defId || def?.id;\n    const enemyName = def?.name;\n    let lavaDps = weatherAffectsEnemy('lavaRain', enemyId, enemyName) ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    if (lavaDps > 0 && liquidSample.inLiquid && liquidSample.type && liquidSample.type.includes('water')) {\n      lavaDps = 0;\n    }\n    const radioDps = weatherAffectsEnemy('radioactiveFog', enemyId, enemyName) ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data || [];\n        const secretData = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n        const objectMetadata = mapData.meta?.objectMetadata || {};\n        const covered = isCoveredFromAbove({\n          x: entity.x + entity.width / 2,\n          y: entity.y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIds || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const totalWeatherDps = lavaDps + radioDps;\n\n    if (totalWeatherDps > 0) {\n      entity.weatherDamageAcc = (entity.weatherDamageAcc || 0) + deltaMs;\n      if (entity.weatherDamageAcc >= 1000) {\n        entity.weatherDamageAcc -= 1000;\n        entity.health = Math.max(0, entity.health - totalWeatherDps);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: totalWeatherDps\n          });\n        }\n      }\n    } else {\n      entity.weatherDamageAcc = 0;\n    }\n\n    // 1.5. Pushable objektu (Akmeu) fizika\n    if (entity.subtype === 'pushable' || def?.isPushable) {\n      const inLiquid = liquidSample.inLiquid;\n      const liquidType = liquidSample.type;\n\n      // Skaas, ja iekrt idrum\n      if (inLiquid && !entity.prevInLiquid) {\n        if (liquidType === 'water' && def.sounds?.water_splash) {\n          playSfx(def.sounds.water_splash, 0.4);\n        } else if (liquidType === 'lava' && def.sounds?.lava_splash) {\n          playSfx(def.sounds.lava_splash, 0.4);\n        }\n      }\n      entity.prevInLiquid = inLiquid;\n\n        // Horizontl kustba ar berzi\n        const mh = moveHorizontal({\n          keys: {}, \n          state: { x: entity.x, y: entity.y, vx: entity.vx || 0, width: entity.width, height: entity.height, direction: entity.direction },\n          MOVE_SPEED: 6.0, // Palielints max trums akmeiem (Supaplex stil)\n          TILE_SIZE,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) return true;\n            \n            // Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            return (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n          },\n          friction: inLiquid ? 0.7 : 0.85,\n          acceleration: 0.2\n        });\n        entity.x = mh.x;\n        entity.vx = mh.vx;\n        entity.direction = mh.direction;\n\n      // Vertikl fizika\n      if (inLiquid && liquidType === 'lava') {\n        // Lna slkana lav\n        const sinkingSpeed = def.sinkingSpeed || 0.2;\n        entity.vy = sinkingSpeed;\n        entity.y += entity.vy;\n        entity.isGrounded = false;\n        \n        // Prbaudm vai neesam izgjui cauri zemei lav\n        if (checkCollision(entity.x, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n           // Atstumjam atpaka, ja atduras pret dibenu\n           entity.y -= entity.vy;\n           entity.vy = 0;\n           entity.isGrounded = true;\n        }\n      } else {\n        // Fall distance tracking: if falling, accumulate distance\n        if (entity.isGrounded) {\n          entity.fallDistance = 0;\n        } else if ((entity.vy || 0) > 0) {\n          entity.fallDistance = (entity.fallDistance || 0) + (entity.vy || 0);\n        }\n\n        // Standarta gravitcija (den lnka)\n        const vp = applyVerticalPhysics({\n          keys: {}, \n          x: entity.x,\n          y: entity.y,\n          vy: entity.vy || 0,\n          isGrounded: entity.isGrounded,\n          animation: 'idle',\n          GRAVITY: inLiquid ? GRAVITY * 0.3 : GRAVITY,\n          TERMINAL_VELOCITY,\n          JUMP_FORCE: 0,\n          TILE_SIZE,\n          width: entity.width,\n          height: entity.height,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // 1. Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) {\n              // Ja ms kaut kam uzkrtam un esam kritui pietiekami ilgi\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                // Atrodam kuru enttiju ms aizskrm (lai nogalintu ienaidniekus)\n                if (entitiesRef.current) {\n                  for (const other of entitiesRef.current) {\n                    if (other.id === entity.id || other.health <= 0 || other.subtype === 'platform' || other.subtype === 'pushable') continue;\n                    \n                    const hitOther = (\n                      nx < other.x + other.width &&\n                      nx + (w || entity.width) > other.x &&\n                      ny < other.y + other.height &&\n                      ny + (h || entity.height) > other.y\n                    );\n                    \n                    if (hitOther) {\n                      other.health = 0; // Nogalinm ienaidnieku\n                      // Vartu atskaot skau, ja tda definta\n                      if (def.sounds?.kill_enemy) {\n                        playSfx(def.sounds.kill_enemy, 0.5);\n                      }\n                    }\n                  }\n                }\n              }\n              return true;\n            }\n            \n            // 2. Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            const hitPlayer = (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n            \n            if (hitPlayer) {\n              // Ja akmens uzkrt spltjam pc brva kritiena (vismaz 1 tuks bloks)\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                gameState.current.health = 0; // Fatal impact\n              }\n              return true;\n            }\n            \n            return false;\n          },\n          isLiquidAt,\n          vx: entity.vx\n        });\n        entity.y = vp.y;\n        entity.vy = vp.vy;\n        entity.isGrounded = vp.isGrounded;\n\n        // --- ROLLING LOGIC (Supaplex style) ---\n        // Akmei ripo lej no citiem apaiem objektiem vai pakpieniem, ja ir brva vieta sn un pa diagonli\n        if (entity.isGrounded && Math.abs(entity.vx) < 0.1 && def.isRound) {\n          const checkEmpty = (tx, ty) => !checkCollision(tx, ty, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n          \n          // Minm ripot pa KREISI\n          const leftX = entity.x - TILE_SIZE;\n          // canRollLeft: vai flze pa kreisi ir brva UN vai flze pa kreisi uz leju ir brva (tukums/pakpiens)\n          const canRollLeft = checkEmpty(leftX, entity.y) && checkEmpty(leftX, entity.y + TILE_SIZE);\n          \n          if (canRollLeft) {\n            // Ripojam pa kreisi. Palielints trums (6.0), lai \"veas\" trk\n            entity.vx = -6.0; \n          } else {\n            // Minm ripot pa LABI\n            const rightX = entity.x + TILE_SIZE;\n            const canRollRight = checkEmpty(rightX, entity.y) && checkEmpty(rightX, entity.y + TILE_SIZE);\n            if (canRollRight) {\n              entity.vx = 6.0;\n            }\n          }\n        }\n\n        // Atjaunojam rotciju, ja akmens veas (horizontal movement while grounded)\n        if (entity.isGrounded && Math.abs(entity.vx) > 0.1 && def.isRound) {\n          // Rotcija proporcionla trumam (0.07 rad/px * vx)\n          entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.07);\n        } else if (!entity.isGrounded && def.isRound) {\n          // Ar krtot var nedaudz rott, ja ir bijis horizontls trums\n          entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.03);\n        }\n      }\n\n      // Animcija akmenim parasti ir statiska\n      entity.animation = 'idle';\n      entity.currentSpriteIndex = def.spriteSheet?.animations?.idle?.[0] || 0;\n\n      continue;\n    }\n\n    // Platformu loika\n    if (entity.subtype === 'platform') {\n      const speed = def.speed || 1.5;\n      const mapW = mapWidth;\n      const mapH = mapHeight;\n      \n      // Mekljam bultias vairkos punktos (centr un mals), lai nepalaistu garm\n      const points = [\n        { x: entity.x + entity.width / 2, y: entity.y + entity.height / 2 }, // Centrs\n        { x: entity.x + 5, y: entity.y + entity.height / 2 },                // Kreis mala\n        { x: entity.x + entity.width - 5, y: entity.y + entity.height / 2 }  // Lab mala\n      ];\n      \n      let arrowId = null;\n      let foundArrowDef = null;\n\n      for (const p of points) {\n        const tx = Math.floor(p.x / TILE_SIZE);\n        const ty = Math.floor(p.y / TILE_SIZE);\n        \n        if (tx < 0 || tx >= mapW || ty < 0 || ty >= mapH) continue;\n        const idx = ty * mapW + tx;\n\n        // 1. Specilais arrows slnis\n        const arrowsLayer = ctx.mapData?.layers?.find(l => l.name === 'arrows' || l.name === 'Arrows')?.data;\n        let id = arrowsLayer ? arrowsLayer[idx] : null;\n        \n        // 2. Objektu slnis\n        if (!id && ctx.objectData) {\n          id = ctx.objectData[idx];\n        }\n\n        if (id) {\n          const aDef = getDefById(ctx.registryItems, id);\n          if (aDef && aDef.subtype === 'arrow') {\n            arrowId = id;\n            foundArrowDef = aDef;\n            break; \n          }\n        }\n      }\n      \n      if (foundArrowDef) {\n        // Mainm kustbas virzienu atbilstoi bultiai\n        if (foundArrowDef.direction === 'up') { entity.vx = 0; entity.vy = -speed; }\n        else if (foundArrowDef.direction === 'down') { entity.vx = 0; entity.vy = speed; }\n        else if (foundArrowDef.direction === 'left') { entity.vx = -speed; entity.vy = 0; }\n        else if (foundArrowDef.direction === 'right') { entity.vx = speed; entity.vy = 0; }\n      }\n\n      // Ja platforma vl nekustas, iedodam tai skuma impulsu\n      if (entity.vx === 0 && entity.vy === 0) {\n        entity.vx = speed;\n      }\n\n      // Kustba\n      let nextX = entity.x + entity.vx * (deltaMs / 16.6);\n      let nextY = entity.y + entity.vy * (deltaMs / 16.6);\n      \n      // Robeu prbaude (neaujam aizbraukt aiz kartes)\n      const worldW = mapWidth * TILE_SIZE;\n      const worldH = mapHeight * TILE_SIZE;\n      \n      if (nextX < 0) { \n        nextX = 0; \n        entity.vx = Math.abs(entity.vx); // Move Right\n      } else if (nextX + entity.width > worldW) { \n        nextX = worldW - entity.width; \n        entity.vx = -Math.abs(entity.vx); // Move Left\n      }\n      \n      if (nextY < 0) { \n        nextY = 0; \n        entity.vy = Math.abs(entity.vy); // Move Down\n      } else if (nextY + entity.height > worldH) { \n        nextY = worldH - entity.height; \n        entity.vy = -Math.abs(entity.vy); // Move Up\n      }\n      \n      entity.x = nextX;\n      entity.y = nextY;\n\n      // Spltja \"prveana\"\n      const player = gameState.current;\n      const onPlatform = (\n        player.x + player.width > entity.x &&\n        player.x < entity.x + entity.width &&\n        Math.abs((player.y + player.height) - entity.y) < 5 &&\n        player.vy >= 0\n      );\n\n      if (onPlatform) {\n        player.x += entity.vx * (deltaMs / 16.6);\n        player.y = entity.y - player.height;\n        player.vy = 0;\n        player.isGrounded = true;\n        \n        // Atjauninam animciju, lai nebtu \"fall\" uz platformas\n        if (Math.abs(player.vx) > 0.1) {\n          player.animation = 'run';\n        } else {\n          player.animation = 'idle';\n        }\n      }\n\n      continue;\n    }\n\n    const ai = def.ai || {};\n    const reactionDist = (ai.reactionDistance || 10) * TILE_SIZE;\n    const shootDist = (ai.shootDistance || 8) * TILE_SIZE;\n    const speed = def.speed || 1.2;\n\n    const dx = playerX - entity.x;\n    const dy = playerY - entity.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let keys = { a: false, d: false, w: false };\n\n    // 2. AI Uzvedba\n    if (dist < reactionDist) {\n      // Sekojam spltjam\n      if (dx > TILE_SIZE * 0.5) {\n          keys.d = true;\n          entity.direction = 1;\n      } else if (dx < -TILE_SIZE * 0.5) {\n          keys.a = true;\n          entity.direction = -1;\n      }\n\n      // Lkana, ja AI to atbalsta un priek ir rslis\n      if (ai.canJump && entity.isGrounded) {\n          const nextX = entity.x + entity.direction * 10;\n          if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n              keys.w = true;\n          }\n      }\n\n      // auana\n      if (dist < shootDist) {\n        if (entity.shootCooldown <= 0) {\n           const facingPlayer = (dx > 0 && entity.direction > 0) || (dx < 0 && entity.direction < 0);\n           // Tanks auj, ja skats uz spltju vai ja tas ir pietiekami tuvu\n           if (facingPlayer || dist < TILE_SIZE * 2) {\n             entity.isShooting = true;\n             entity.shootCooldown = ai.shootCooldown || 2000;\n             \n             // Izsaucam via izveidi\n             if (typeof spawnProjectile === 'function') {\n                // Novietojam viu rpus tanka korpusa (atkarb no virziena)\n                const spawnX = entity.x + (entity.width / 2) + (entity.direction * (entity.width / 2 + 10));\n                const spawnY = entity.y + (entity.height * 0.4); // Nedaudz augstk par centru (stobrs)\n                \n                spawnProjectile(\n                  spawnX, \n                  spawnY, \n                  entity.direction,\n                  entity.id\n                );\n             }\n           }\n        }\n      }\n    } else if (ai.patrol) {\n      // Patruanas rems\n      if (entity.direction > 0) keys.d = true;\n      else keys.a = true;\n\n    // Sienas un ru prbaude, lai grieztos atpaka\n    const nextX = entity.x + entity.direction * 10;\n    let hitSomething = checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height);\n\n    // Tanku specifisk kolzija (ar spltju un citiem tankiem)\n    if (!hitSomething && entity.subtype === 'tank') {\n      // 1. Prbaude ar spltju\n      const p = gameState.current;\n      if (nextX < p.x + p.width && nextX + entity.width > p.x && entity.y < p.y + p.height && entity.y + entity.height > p.y) {\n        hitSomething = true;\n      }\n\n      // 2. Prbaude ar citiem tankiem\n      if (!hitSomething) {\n        for (const other of entitiesRef.current) {\n          if (other === entity || other.health <= 0 || other.isExploding) continue;\n          if (other.subtype !== 'tank') continue;\n\n          if (nextX < other.x + other.width && nextX + entity.width > other.x && entity.y < other.y + other.height && entity.y + entity.height > other.y) {\n            hitSomething = true;\n            // Liekam ar otram tankam maint virzienu, ja tie brauc viens otram virs\n            if ((entity.direction > 0 && other.direction < 0) || (entity.direction < 0 && other.direction > 0)) {\n               other.direction *= -1;\n            }\n            break;\n          }\n        }\n      }\n    }\n\n    if (hitSomething) {\n      entity.direction *= -1;\n    }\n    \n    // Platformas malas prbaude\n      if (ai.stayOnPlatform && entity.isGrounded) {\n          const groundX = entity.x + (entity.direction > 0 ? entity.width : 0) + entity.direction * 5;\n          const groundY = entity.y + entity.height + 5;\n          if (!checkCollision(groundX, groundY, mapWidth, mapHeight, 2, 2)) {\n              entity.direction *= -1;\n          }\n      }\n    }\n\n    // Cooldown atjaunoana\n    if (entity.shootCooldown > 0) {\n      entity.shootCooldown -= deltaMs;\n      // Pc 300ms prtraucam auanas animciju\n      if (entity.shootCooldown < (ai.shootCooldown || 2000) - 300) {\n        entity.isShooting = false;\n      }\n    }\n\n    // 3. Fizika un kustba\n    const frameSpeed = speed * (deltaMs / 16.67);\n    \n    const checkEntityCollision = (nx, ny) => {\n        // Statisk pasaule\n        if (checkCollision(nx, ny, mapWidth, mapHeight, entity.width, entity.height)) return true;\n        \n        // Tankiem blojam ceu, ja priek ir spltjs vai cits tanks\n        if (entity.subtype === 'tank') {\n            const p = gameState.current;\n            if (nx < p.x + p.width && nx + entity.width > p.x && ny < p.y + p.height && ny + entity.height > p.y) return true;\n            \n            for (const other of entitiesRef.current) {\n                if (other === entity || other.health <= 0 || other.isExploding) continue;\n                if (other.subtype !== 'tank') continue;\n                if (nx < other.x + other.width && nx + entity.width > other.x && ny < other.y + other.height && ny + entity.height > other.y) return true;\n            }\n        }\n        return false;\n    };\n\n    const mh = moveHorizontal({\n      keys,\n      state: { \n        x: entity.x, \n        y: entity.y, \n        vx: entity.vx || 0,\n        width: entity.width, \n        direction: entity.direction \n      },\n      MOVE_SPEED: frameSpeed,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision\n    });\n    entity.x = mh.x;\n    entity.vx = mh.vx;\n    entity.direction = mh.direction;\n\n    const vp = applyVerticalPhysics({\n      keys,\n      x: entity.x,\n      y: entity.y,\n      vy: entity.vy,\n      isGrounded: entity.isGrounded,\n      animation: entity.animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE: ai.canJump ? 8 : 0,\n      TILE_SIZE,\n      width: entity.width,\n      height: entity.height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision,\n      isLiquidAt: ctx.isLiquidAt,\n      vx: entity.vx\n    });\n    entity.y = vp.y;\n    entity.vy = vp.vy;\n    entity.isGrounded = vp.isGrounded;\n\n    // 4. Animcijas stvoka noteikana\n    if (entity.isShooting) {\n      entity.animation = 'shoot';\n    } else if (entity.health <= (def.maxHealth || 100) * 0.5) {\n      entity.animation = 'move_damaged';\n    } else if (entity.vx === 0 && entity.isGrounded) {\n      entity.animation = 'idle';\n    } else {\n      entity.animation = 'move';\n    }\n\n    // Atjaunojam animcijas rmi, ja tas nav sprdziens\n    if (!entity.isExploding) {\n        const anims = def.spriteSheet?.animations || {};\n        let currentAnim = anims[entity.animation];\n        \n        // Rezerves varianti, ja specifisk animcija nav atrasta\n        if (!currentAnim || !Array.isArray(currentAnim) || currentAnim.length === 0) {\n            currentAnim = anims['move'] || anims['idle'] || [0];\n        }\n        \n        entity.animTimer = (entity.animTimer || 0) + deltaMs;\n        const frameDur = 100; // ms\n        if (entity.animTimer >= frameDur) {\n            entity.animTimer = 0;\n            entity.animFrame = (entity.animFrame || 0) + 1;\n            if (entity.animFrame >= currentAnim.length) {\n                entity.animFrame = 0;\n            }\n        }\n        entity.currentSpriteIndex = currentAnim[entity.animFrame % currentAnim.length];\n    } else {\n        const explodeAnim = def.spriteSheet?.animations?.explode || [39];\n        // Sprdziena animcija tiek vadta augstk (death sekcij)\n        entity.currentSpriteIndex = explodeAnim[Math.min(entity.animFrame, explodeAnim.length - 1)];\n    }\n\n    if (entity.shouldRemove) {\n      entities.splice(i, 1);\n    }\n  }\n}\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\nimport { updateEntities } from '../gameplay/entities';\nimport { getWeatherDps, getMapWeather, getRadioactivityRates, weatherAffectsPlayer, weatherBlockedByCover } from '../gameplay/weatherDamage';\nimport { isCoveredFromAbove } from '../gameplay/weatherCover';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isLiquidAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isLiquidAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, playSfx, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const mapWidth = mapData.meta?.width || mapData.width || 20;\n  const mapHeight = mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo,\n    iceResist,\n    maxIceResist\n  } = gameState.current;\n\n  const dt = Math.max(0, deltaMs || 0);\n  const physicsDt = Math.min(dt, 100);\n\n  // 0.5) Resources update (before physics to affect them)\n  // Ice resistance depletion: drains while on slippery surface; regenerates otherwise\n  const layers = ctx.mapData.layers || [];\n  const backgroundLayer = layers.find(l => l.name === 'background')?.data || [];\n  const secretLayer = layers.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n  const objectMetadata = mapData.meta?.objectMetadata || {};\n  const surface = helpers.getSurfaceProperties ? helpers.getSurfaceProperties(x, y, width, height, mapWidth, mapHeight, TILE_SIZE, backgroundLayer, ctx.registryItems) : { friction: 0.8, acceleration: 0.2 };\n  \n  const isSlippery = surface.friction >= 0.9;\n  let currentIceRes = Number(iceResist);\n  const maxIce = Math.max(1, Number(maxIceResist || 100));\n  if (!Number.isFinite(currentIceRes)) currentIceRes = maxIce;\n\n  if (isSlippery) {\n    currentIceRes -= (20 * dt) / 1000;\n  } else {\n    currentIceRes += (35 * dt) / 1000;\n  }\n  currentIceRes = Math.max(0, Math.min(maxIce, currentIceRes));\n  gameState.current.iceResist = currentIceRes;\n\n  let effectiveFriction = surface.friction;\n  if (isSlippery && currentIceRes > 0) {\n      const ratio = currentIceRes / maxIce;\n      const targetFriction = 0.8;\n      effectiveFriction = surface.friction - (surface.friction - targetFriction) * ratio;\n  }\n\n  // 1) Horizontal movement\n  const checkCollisionExtended = (nx, ny, mw, mh, w, h) => {\n    return checkCollision(nx, ny, mw, mh, w, h);\n  };\n\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, vx, width, direction, height },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    friction: effectiveFriction,\n    acceleration: isSlippery ? (currentIceRes > 0 ? 0.15 : surface.acceleration) : surface.acceleration,\n    deltaMs: physicsDt\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 1.1) Pushable objects logic (Stone pushing)\n  let isPushing = false;\n  let pushTarget = null;\n  \n  const currentStrength = gameState.current.strength || 30;\n  const isAlreadyAtMax = currentStrength >= 99;\n  const lastPushTime = gameState.current.lastPushTime || 0;\n  const gracePeriod = 300; // ms, kur strength nesamazins pat ja kontakts pazd uz brdi\n\n  if (entitiesRef.current) {\n    // Ja jau stumjam ar pilnu jaudu, esam pielaidgki pret attlumu (histerze), \n    // lai kompenstu nelielas fizikas dzinja nobdes.\n    const pushDist = isAlreadyAtMax ? 15 : 5;\n    const overlapDist = isAlreadyAtMax ? 12 : 5;\n\n    for (const ent of entitiesRef.current) {\n      if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n        // Prbaudm vai spltjs ir blakus akmenim\n        const isNextToLeft = (x + width + pushDist > ent.x) && (x + width <= ent.x + overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n        const isNextToRight = (x - pushDist < ent.x + ent.width) && (x >= ent.x + ent.width - overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n\n        if ((isNextToLeft && keys.d) || (isNextToRight && keys.a)) {\n          isPushing = true;\n          pushTarget = ent;\n          break;\n        }\n      }\n    }\n  }\n\n  if (isPushing) {\n    gameState.current.strength = Math.min(100, currentStrength + (65 * dt) / 1000); // Aug par ~65% sekund\n    if (gameState.current.strength >= 100 && pushTarget) {\n      // Pastumjam akmeni\n      const pushForce = 2.0;\n      pushTarget.vx = (x < pushTarget.x ? 1 : -1) * pushForce;\n      gameState.current.lastPushTime = timestamp; \n      \n      // Atskaojam skau\n      if (pushTarget.def?.sounds?.push && (!pushTarget.lastPushSoundTime || timestamp - pushTarget.lastPushSoundTime > 450)) {\n        playSfx(pushTarget.def.sounds.push, 0.3);\n        pushTarget.lastPushSoundTime = timestamp;\n      }\n    }\n  } else {\n    // Prbaudm grace periodu pirms skam samazint spku\n    const timeSincePush = timestamp - lastPushTime;\n    if (timeSincePush > gracePeriod) {\n      if (currentStrength > 30) {\n        gameState.current.strength = Math.max(30, currentStrength - (35 * dt) / 1000);\n      } else {\n        gameState.current.strength = 30;\n      }\n    }\n  }\n\n  // 2) Vertical physics\n  let vp = null;\n  let remaining = physicsDt;\n  let steps = 0;\n  let prevInWater = !!gameState.current.inWater;\n  while (remaining > 0 && steps < 10) {\n    const stepMs = Math.min(16.67, remaining);\n    vp = applyVerticalPhysics({\n      keys,\n      x,\n      y,\n      vy,\n      isGrounded,\n      animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE,\n      TILE_SIZE,\n      width,\n      height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkCollisionExtended,\n      vx,\n      isLiquidAt: (wx, wy) => {\n        try { return typeof isLiquidAt === 'function' ? isLiquidAt(wx, wy) : null; } catch { return null; }\n      },\n      prevInWater,\n      deltaMs: stepMs\n    });\n    y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n    prevInWater = !!vp.inWater;\n    remaining -= stepMs;\n    steps++;\n  }\n  const inWater = !!(vp ? vp.inWater : gameState.current.inWater);\n  const headUnderWater = !!(vp ? vp.headUnderWater : gameState.current.headUnderWater);\n  const atSurface = !!(vp ? vp.atSurface : gameState.current.atSurface);\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else if (liquidType === 'quicksand') {\n      vx *= 0.72; // Quicksand is very thick\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n    const resourceParams = liquidParams?.resources || {};\n    const parseNumber = (v) => (v === null || v === undefined || v === '') ? null : Number(v);\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = resourceParams.oxygen || liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = resourceParams.lavaResist || liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n    const iceParams = resourceParams.iceResist;\n    const strengthParams = resourceParams.strength;\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    const oxygenApplies = !!(resourceParams.oxygen || liquidType === 'water' || liquidType === 'quicksand' || liquidType === 'radioactive_water' || liquidType === 'waterfall' || liquidType === 'radioactive_waterfall');\n    const oxygenEnabled = oxyParams?.enabled !== false;\n    const oxyDrain = parseNumber(oxyParams?.drainPerSecond);\n    const oxyRegen = parseNumber(oxyParams?.regenPerSecond);\n    if (oxygenEnabled && headUnderWater && oxygenApplies && Number.isFinite(oxyDrain)) {\n      oxy -= (Math.max(0, oxyDrain) * dt) / 1000;\n    } else if (oxygenEnabled) {\n      oxy += (Math.max(0, Number.isFinite(oxyRegen) ? oxyRegen : 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resist depletion while in lava; regenerates outside\n    const lavaApplies = !!(resourceParams.lavaResist || liquidType === 'lava' || liquidType === 'lava_waterfall');\n    const lavaEnabled = lavaParams?.enabled !== false;\n    const lavaDrain = parseNumber(lavaParams?.drainPerSecond);\n    const lavaRegen = parseNumber(lavaParams?.regenPerSecond);\n    if (lavaEnabled && lavaApplies && liquidType && liquidType.includes('lava') && Number.isFinite(lavaDrain)) {\n      lavaRes -= (Math.max(0, lavaDrain) * dt) / 1000;\n    } else if (lavaEnabled) {\n      lavaRes += (Math.max(0, Number.isFinite(lavaRegen) ? lavaRegen : 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Ice resist & strength can be optionally affected by liquids\n    const applyResource = (key, maxKey, params) => {\n      if (!params || params.enabled === false) return;\n      const drain = parseNumber(params.drainPerSecond);\n      const regen = parseNumber(params.regenPerSecond);\n      if (!Number.isFinite(drain) && !Number.isFinite(regen)) return;\n      const maxVal = Math.max(1, Number(gameState.current[maxKey] || 100));\n      let cur = Number(gameState.current[key]);\n      if (!Number.isFinite(cur)) cur = maxVal;\n      if (inWater || liquidType) {\n        if (Number.isFinite(drain)) cur -= (Math.max(0, drain) * dt) / 1000;\n      } else if (Number.isFinite(regen)) {\n        cur += (Math.max(0, regen) * dt) / 1000;\n      }\n      cur = Math.max(0, Math.min(maxVal, cur));\n      gameState.current[key] = cur;\n      gameState.current[maxKey] = maxVal;\n    };\n\n    applyResource('iceResist', 'maxIceResist', iceParams);\n    applyResource('strength', 'maxStrength', strengthParams);\n\n    // Radioactivity: fills up in radioactive liquid; slowly returns to 20% outside\n    const weatherNow = getMapWeather(mapData);\n    const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n    const fogActive = weatherAffectsPlayer('radioactiveFog') && radioFogInt > 0;\n    const maxRadio = Math.max(1, Number(gameState.current.maxRadioactivity || 100));\n    let radio = Number(gameState.current.radioactivity);\n    if (!Number.isFinite(radio)) radio = maxRadio * 0.2;\n\n    const radioParams = resourceParams.radioactivity;\n    const radioEnabled = radioParams?.enabled !== false;\n    const radioBaseline = Number.isFinite(parseNumber(radioParams?.baselinePercent)) ? Math.max(0, Math.min(1, parseNumber(radioParams?.baselinePercent))) : 0.2;\n    const radioGain = Number.isFinite(parseNumber(radioParams?.gainPerSecond)) ? Math.max(0, parseNumber(radioParams?.gainPerSecond)) : (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall' ? 15 : 0);\n    const radioDecay = Number.isFinite(parseNumber(radioParams?.decayPerSecond)) ? Math.max(0, parseNumber(radioParams?.decayPerSecond)) : 5;\n    const radioRecover = Number.isFinite(parseNumber(radioParams?.recoverPerSecond)) ? Math.max(0, parseNumber(radioParams?.recoverPerSecond)) : 2;\n    const radioApplies = !!(radioParams || liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall');\n\n    if (radioEnabled && radioApplies && (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall')) {\n      radio += (radioGain * dt) / 1000; \n    } else if (radioEnabled && !fogActive) {\n      const baseline = maxRadio * radioBaseline;\n      if (radio > baseline) {\n        radio -= (radioDecay * dt) / 1000;\n      } else if (radio < baseline) {\n        radio += (radioRecover * dt) / 1000;\n      }\n    }\n\n    // Radioactivity resource changes from fog (deplete while fog is active)\n    if (weatherAffectsPlayer('radioactiveFog')) {\n      const rates = getRadioactivityRates();\n      if (radioFogInt > 0 && rates.increase > 0) {\n        const dec = (radioFogInt / 100) * rates.increase * (dt / 1000);\n        radio -= dec;\n      } else if (radioFogInt <= 0 && rates.decay > 0 && !fogActive) {\n        const inc = rates.decay * (dt / 1000);\n        radio += inc;\n      }\n    }\n\n    radio = Math.max(0, Math.min(maxRadio, radio));\n    gameState.current.radioactivity = radio;\n    gameState.current.maxRadioactivity = maxRadio;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && oxygenApplies) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if ((liquidType === 'lava' || liquidType === 'lava_waterfall') && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n\n    // Weather damage (Lava Rain, Radioactive Fog)\n    const weather = weatherNow || getMapWeather(mapData);\n    const lavaRainInt = Number(weather.lavaRain || 0);\n\n    let lavaDps = weatherAffectsPlayer('lavaRain') ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    const radioDps = weatherAffectsPlayer('radioactiveFog') ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && (inWater || (liquidType && liquidType.includes('water')))) {\n      lavaDps = 0;\n    }\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = backgroundLayer;\n        const secretData = secretLayer;\n        const covered = isCoveredFromAbove({\n          x: x + width / 2,\n          y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems: ctx.registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const effectiveRadioDps = (radioDps > 0 && Number(radio) <= 0) ? radioDps : 0;\n    const totalWeatherDps = lavaDps + effectiveRadioDps;\n\n    if (totalWeatherDps > 0) {\n      weatherDamageAccRef.current += dt;\n      if (weatherDamageAccRef.current >= 1000) {\n        weatherDamageAccRef.current -= 1000;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - totalWeatherDps);\n        const HIT_FLASH_MS = 500;\n        gameState.current.hitTimerMs = Math.max(Number(gameState.current.hitTimerMs) || 0, HIT_FLASH_MS);\n        if (actions.onStateUpdate) {\n          actions.onStateUpdate('playerDamage', {\n            damage: totalWeatherDps,\n            x: x + width / 2,\n            y\n          });\n        }\n      }\n    } else {\n      weatherDamageAccRef.current = 0;\n    }\n\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  const healthEnabled = resourceParams?.health?.enabled !== false;\n  const healthDpsOverride = (healthEnabled && resourceParams?.health && resourceParams.health.damagePerSecond !== null && resourceParams.health.damagePerSecond !== undefined)\n    ? Number(resourceParams.health.damagePerSecond)\n    : null;\n  const effectiveDps = Number.isFinite(healthDpsOverride) ? Math.max(0, healthDpsOverride) : Number(liquidParams?.dps);\n  if (liquidType && liquidParams && Number(effectiveDps) > 0) {\n    try {\n      if (liquidType && liquidType.includes('lava')) {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection and triggers\n  // Sync moved state to Ref so triggers can see it and modify it (Teleport, Knockback, etc.)\n  gameState.current.x = x;\n  gameState.current.y = y;\n  gameState.current.vx = vx;\n  gameState.current.vy = vy;\n  gameState.current.isGrounded = isGrounded;\n  gameState.current.animation = animation;\n\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, mapHeight, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // Sync back from Ref in case triggers changed something\n  x = gameState.current.x;\n  y = gameState.current.y;\n  vx = gameState.current.vx;\n  vy = gameState.current.vy;\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0) {\n    const originX = x + (direction >= 0 ? width + 4 : -4);\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1, 'player');\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 5.5) Update entities (tanks etc.)\n  try {\n    updateEntities({\n      entitiesRef,\n      gameState,\n      mapData,\n      objectData,\n      mapWidth,\n      mapHeight,\n      TILE_SIZE,\n      checkCollision,\n      isLiquidAt,\n      getLiquidSample,\n      spawnProjectile,\n      playSfx,\n      constants,\n      registryItems: ctx.registryItems,\n      onStateUpdate: actions.onStateUpdate,\n      activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n    }, Math.min(dt, 100)); // Ierobeojam deltaMs uz 100ms, lai izvairtos no milzgiem lcieniem\n    \n    // Sinhronizjam loklos maingos pc enttiju (platformu) ietekmes\n    x = gameState.current.x;\n    y = gameState.current.y;\n    vx = gameState.current.vx;\n    vy = gameState.current.vy;\n    isGrounded = gameState.current.isGrounded;\n    animation = gameState.current.animation;\n    \n    // Kontaktbojjumi no enttijm\n    const player = gameState.current;\n    if (entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        \n        // AABB prbaude\n        const hit = (\n          player.x < ent.x + ent.width &&\n          player.x + player.width > ent.x &&\n          player.y < ent.y + ent.height &&\n          player.y + player.height > ent.y\n        );\n        \n        if (hit && Number(player.hitTimerMs) <= 0) {\n          // Pievienojam nelielu atgrdienu (knockback)\n          const knockbackDir = player.x + player.width / 2 < ent.x + ent.width / 2 ? -1 : 1;\n          gameState.current.vx = knockbackDir * 5;\n          gameState.current.vy = -3;\n          \n          // Iestatm bezsmertbas periodu un vizulo flash\n          gameState.current.hitTimerMs = 500;\n          \n          // Samazinm spltja veselbu\n          gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - 10);\n          \n          if (actions.onStateUpdate) {\n            actions.onStateUpdate('playerDamage', { damage: 10, x: player.x + player.width / 2, y: player.y });\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"Entity update failed:\", e);\n  }\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Win and Death check\n  if (gameState.current.isWinning) {\n    gameState.current.winCounter = (gameState.current.winCounter || 0) + (gameState.current.winCountSpeed || 10) * (deltaMs / 100);\n    if (gameState.current.winCounter >= 100) {\n      gameState.current.winCounter = 100;\n      // Trigger level win event if needed\n      if (actions.onStateUpdate) actions.onStateUpdate('levelWin');\n    }\n  }\n\n  if ((Number(gameState.current.health) || 0) <= 0 || y > mapHeight * TILE_SIZE + 300) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null,\n    liquidOverlay: liquidParams?.overlay || null,\n    onIce: isSlippery\n  };\n\n  // Floating text deltas for player resources\n  if (actions.onStateUpdate) {\n    const floatState = gameState.current.floatingText || { prev: {}, acc: {} };\n    const resources = [\n      { key: 'health', color: '#ff3b3b' },\n      { key: 'oxygen', color: '#2ecdf1' },\n      { key: 'lavaResist', color: '#ffcc00' },\n      { key: 'iceResist', color: '#a5f3fc' },\n      { key: 'strength', color: '#8b5a2b' },\n      { key: 'radioactivity', color: '#32cd32' }\n    ];\n    const baseX = x + width / 2;\n    const baseY = y - 6;\n\n    resources.forEach((res, idx) => {\n      const cur = Number(gameState.current[res.key]) || 0;\n      if (!Number.isFinite(floatState.prev[res.key])) {\n        floatState.prev[res.key] = cur;\n        floatState.acc[res.key] = 0;\n        return;\n      }\n      const diff = cur - floatState.prev[res.key];\n      if (diff !== 0) {\n        floatState.acc[res.key] = (floatState.acc[res.key] || 0) + diff;\n        if (Math.abs(floatState.acc[res.key]) >= 1) {\n          const amt = Math.round(floatState.acc[res.key]);\n          floatState.acc[res.key] -= amt;\n          const sign = amt > 0 ? '+' : '';\n          actions.onStateUpdate('floatingText', {\n            x: baseX + (idx - 2.5) * 6,\n            y: baseY,\n            text: `${sign}${amt}`,\n            color: res.color,\n            amount: amt\n          });\n        }\n      }\n      floatState.prev[res.key] = cur;\n    });\n\n    gameState.current.floatingText = floatState;\n  }\n\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\nexport const MAX_ICE_RESIST = 100;\nexport const MAX_RADIOACTIVITY = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles, handleWeatherEffectHit } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal, getSurfaceProperties } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST,\n    MAX_ICE_RESIST,\n    MAX_RADIOACTIVITY\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret, objectMetadata\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret, objectMetadata, activeRoomIds, mapWidth, mapHeight) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        iceResist: MAX_ICE_RESIST,\n        maxIceResist: MAX_ICE_RESIST,\n        radioactivity: MAX_RADIOACTIVITY * 0.2, // 20% default\n        maxRadioactivity: MAX_RADIOACTIVITY,\n        strength: 30,\n        maxStrength: 100,\n        lastPushTime: 0,\n        isWinning: false,\n        winCounter: 0,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n    const weatherDamageAccRef = useRef(0);                // Weather damage DPS accumulator\n    const entitiesRef = useRef([]);                        // Active moving entities (tanks, etc.)\n\n    // Refs for props to avoid stale closures in the game loop\n    const onStateUpdateRef = useRef(onStateUpdate);\n    const onRevealSecretRef = useRef(onRevealSecret);\n    const onGameOverRef = useRef(onGameOver);\n    const objectMetadataRef = useRef(objectMetadata);\n    const revealedSecretsRef = useRef(revealedSecrets);\n    const activeRoomIdsRef = useRef(activeRoomIds);\n    const mapWidthRef = useRef(mapWidth);\n    const mapHeightRef = useRef(mapHeight);\n    const tileDataRef = useRef(tileData);\n    const objectDataRef = useRef(objectData);\n    const secretDataRef = useRef(secretData);\n\n    useEffect(() => { onStateUpdateRef.current = onStateUpdate; }, [onStateUpdate]);\n    useEffect(() => { onRevealSecretRef.current = onRevealSecret; }, [onRevealSecret]);\n    useEffect(() => { onGameOverRef.current = onGameOver; }, [onGameOver]);\n    useEffect(() => { objectMetadataRef.current = objectMetadata; }, [objectMetadata]);\n    useEffect(() => { revealedSecretsRef.current = revealedSecrets; }, [revealedSecrets]);\n    useEffect(() => { activeRoomIdsRef.current = activeRoomIds; }, [activeRoomIds]);\n    useEffect(() => { mapWidthRef.current = mapWidth; }, [mapWidth]);\n    useEffect(() => { mapHeightRef.current = mapHeight; }, [mapHeight]);\n    useEffect(() => { tileDataRef.current = tileData; }, [tileData]);\n    useEffect(() => { objectDataRef.current = objectData; }, [objectData]);\n    useEffect(() => { secretDataRef.current = secretData; }, [secretData]);\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        const isInsideRoom = activeRoomIdsRef.current && activeRoomIdsRef.current.length > 0;\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume);\n    };\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Weather effects impact handling (meteors, etc.)\n    const handleWeatherEffectHitWrapper = (type, data) => {\n        handleWeatherEffectHit(type, data, { gameState, entitiesRef });\n    };\n\n    // Listen for weather effect hits from the UI/Renderer\n    useEffect(() => {\n        const onHit = (e) => {\n            if (e && e.detail) {\n                handleWeatherEffectHitWrapper(e.detail.type, e.detail.data);\n            }\n        };\n        window.addEventListener('weather-effect-hit', onHit);\n        return () => window.removeEventListener('weather-effect-hit', onHit);\n    }, []);\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecretRef.current) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecretsRef.current || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecretRef.current(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    const lastMapIdRef = useRef(null);\n\n    // Initialize player at starting position\n    useEffect(() => {\n        if (!mapData) {\n            isInitialized.current = false;\n            lastMapIdRef.current = null;\n            return;\n        }\n\n        // Unique identifier for the map session\n        // We include projectName and timestamps to distinguish between different projects \n        // that might use the same activeMapId (like \"main\")\n        const meta = mapData.meta || {};\n        const projectName = meta.projectName || '';\n        const mapId = meta.activeMapId || mapData.name || 'default';\n        const timestamp = meta.date_map_last_updated || meta.date_map_created_at || '';\n        \n        // Use a unique ID that changes on map load or restart\n        const currentMapId = `${projectName}|${mapId}|${timestamp}`;\n        const isNewMapLoad = currentMapId !== lastMapIdRef.current;\n\n        // Ja sple jau ir inicializta UN t ir t pati karte, nemainm spltja pozciju\n        // Tas novr \"reset\" uz skumu, kad spltjs pace itemu vai mains laikapstki\n        if (isInitialized.current && !isNewMapLoad) return;\n\n        lastMapIdRef.current = currentMapId;\n\n        // Reset state for new initialization\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        entitiesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapWidth || mapData.meta?.width || mapData.width || 20;\n            const mapH = mapHeight || mapData.meta?.height || mapData.height || 15;\n            \n            // Search for entities in objectData\n            const initialEntities = [];\n            if (objectData && Array.isArray(objectData)) {\n                objectData.forEach((id, idx) => {\n                    if (id && !id.includes('player')) {\n                        const def = findItemById(id) || registryItems.find(r => r.id === id);\n                        const isEntity = def && (\n                            def.type === 'entity' || \n                            def.subtype === 'tank' || \n                            def.subtype === 'platform' ||\n                            def.isPushable ||\n                            (def.name && def.name.toLowerCase().includes('entities.'))\n                        );\n\n                        if (isEntity) {\n                            initialEntities.push({\n                                id: `entity_${idx}_${Date.now()}_${idx}`,\n                                defId: id,\n                                def: def,\n                                x: (idx % mapW) * TILE_SIZE,\n                                y: Math.floor(idx / mapW) * TILE_SIZE,\n                                width: (Number(def.width) || 1) * TILE_SIZE,\n                                height: (Number(def.height) || 1) * TILE_SIZE,\n                                vx: 0,\n                                vy: 0,\n                                health: def.maxHealth || 100,\n                                direction: def.subtype === 'platform' ? 1 : (def.isPushable ? 1 : -1),\n                                animation: (def.subtype === 'platform' || def.isPushable) ? 'idle' : 'move',\n                                animFrame: 0,\n                                animTimer: 0,\n                                isGrounded: false,\n                                shootCooldown: 0,\n                                currentSpriteIndex: 0,\n                                subtype: def.subtype || (def.isPushable ? 'pushable' : null),\n                                rotation: def.isRound ? 0 : undefined\n                            });\n                        }\n                    }\n                });\n            }\n            entitiesRef.current = initialEntities;\n\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // 1. Priority: spawnTriggerId hint (from inter-map teleport)\n                const spawnTriggerId = mapData.meta?.spawnTriggerId;\n                let startIndex = -1;\n\n                if (spawnTriggerId !== undefined && spawnTriggerId !== null) {\n                    startIndex = objLayer.data.findIndex((id, idx) => {\n                        if (!id || (!id.includes('target') && id !== 'portal_target')) return false;\n                        const meta = objectMetadataRef.current?.[idx] || mapData.meta?.objectMetadata?.[idx];\n                        return meta && meta.triggerId === spawnTriggerId;\n                    });\n                }\n\n                // 2. Fallback: Search for player (anything containing 'player')\n                if (startIndex === -1) {\n                    startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n                }\n\n                if (startIndex !== -1) {\n                    let startX = (startIndex % mapW) * TILE_SIZE;\n                    let startY = Math.floor(startIndex / mapW) * TILE_SIZE;\n\n                    // Get data from registry\n                    const playerId = objLayer.data[startIndex];\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: 0,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: Number(registryPlayer?.strength) || 30,\n                        maxStrength: Number(registryPlayer?.maxStrength) || 100,\n                        lastPushTime: 0,\n                        isWinning: false,\n                        winCounter: 0\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    const pW = gameState.current.width || TILE_SIZE;\n                    const pH = gameState.current.height || TILE_SIZE;\n                    while (checkCollision(gameState.current.x, gameState.current.y, undefined, undefined, pW, pH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: 30,\n                        maxStrength: 100,\n                        lastPushTime: 0\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST,\n                    radioactivity: MAX_RADIOACTIVITY * 0.2,\n                    maxRadioactivity: MAX_RADIOACTIVITY,\n                    strength: 30,\n                    maxStrength: 100,\n                    lastPushTime: 0\n                };\n                setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]); // objectData removed - item collection shouldn't trigger re-initialization\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mw, mh, w, h) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE,\n            tileDataRef.current || tileData,\n            registryItems,\n            w !== undefined ? w : gameState.current.width,\n            h !== undefined ? h : gameState.current.height,\n            secretDataRef.current || secretData,\n            objectDataRef.current || objectData,\n            objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            null,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mw, mh, TILE_SIZE_OVERRIDE, tileDataOverride, registryItemsOverride, secretDataOverride, objectDataOverride, objectMetadataOverride, ignoreId) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE_OVERRIDE || TILE_SIZE,\n            tileDataOverride || tileDataRef.current || tileData,\n            registryItemsOverride || registryItems,\n            secretDataOverride || secretDataRef.current || secretData,\n            objectDataOverride || objectDataRef.current || objectData,\n            objectMetadataOverride || objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreId,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // New: liquid type check at a world pixel\n    const getLiquidTypeAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        const liq = getLiquidAtPixel(wx, wy, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileData, registryItems);\n        return liq ? liq.type : null;\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthRef.current || 20,\n            mapHeight: mapHeightRef.current || 15,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction, ownerId = 'player') => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction, ownerId);\n    };\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData: objectDataRef.current,\n            input,\n            refs: { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef },\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            registryItems,\n            helpers: {\n                checkCollision,\n                getSurfaceProperties: (x, y, w, h) => getSurfaceProperties(x, y, w, h, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileDataRef.current, registryItems, secretDataRef.current, objectMetadataRef.current || mapData?.meta?.objectMetadata, mapData?.maps, activeRoomIdsRef.current || mapData?.meta?.activeRoomIds),\n                isLiquidAt: (wx, wy) => getLiquidTypeAtPixel(wx, wy),\n                getLiquidSample: ({ x, y, width, height }) =>\n                    sampleLiquid({ x, y, width, height })\n            },\n            actions: {\n                collectItem: (x, y, mw, objectLayer) =>\n                    collectItem({\n                        registryItems,\n                        TILE_SIZE,\n                        MAX_HEALTH,\n                        playShotSfx,\n                        onStateUpdate: onStateUpdateRef.current,\n                        gameState,\n                        maps: mapData?.maps,\n                        activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata,\n                        secretMapData: secretDataRef.current || secretData\n                    }, x, y, mapWidthRef.current || 20, objectDataRef.current),\n                checkInteractables: (x, y, mw, mh, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState, mapData, input, activeRoomIds: activeRoomIdsRef.current, objectMetadata: objectMetadataRef.current, secretMapData: secretDataRef.current || secretData }, x, y, mapWidthRef.current || 20, mapHeightRef.current || 15, objectDataRef.current),\n                checkHazardDamage: (x, y, mw, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidthRef.current || 20, objectDataRef.current, deltaMs),\n                checkSecrets: (x, y, width, height, mw, mh) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                spawnProjectile: (originX, originY, direction, ownerId) =>\n                    spawnProjectile(originX, originY, direction, ownerId),\n                playSfx: (url, volume) => playShotSfx(url, volume),\n                updateProjectiles: (deltaMs, mw, mh) =>\n                    updateProjectiles({ \n                        projectilesRef, \n                        entitiesRef,\n                        playerState: gameState.current,\n                        TILE_SIZE, \n                        isSolidAtPixel, \n                        findItemById, \n                        objectData: objectDataRef.current, \n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata, \n                        tileData: tileDataRef.current || tileData,\n                        secretData: secretDataRef.current || secretData,\n                        registryItems,\n                        onStateUpdate: onStateUpdateRef.current\n                    }, deltaMs, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                setPlayer: (next) => setPlayer(next),\n                onGameOver: onGameOverRef.current\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        if (!mapData) return;\n        requestRef.current = requestAnimationFrame(update);\n        return () => {\n            if (requestRef.current) cancelAnimationFrame(requestRef.current);\n        };\n    }, [mapData]); // Restart loop ONLY if map changes, not objects\n\n    return player;\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false,\n        e: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n            keys.current.e = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'KeyE':\n                    keys.current.e = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'KeyE':\n                    keys.current.e = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","/**\n * Handles weather effect impacts like meteor strikes, lightning, etc.\n * This logic is decoupled from useGameEngine to allow for easier expansion.\n */\nexport const handleWeatherEffectHit = (type, data, context) => {\n    if (!type || !data || !context) return;\n    const { gameState, entitiesRef } = context;\n\n    if (type === 'meteor') {\n        const { x, y, size, isLarge } = data;\n        const damage = isLarge ? 40 : 20;\n        const radius = size * 1.5;\n\n        // 1. Check player impact\n        if (gameState && gameState.current) {\n            const p = gameState.current;\n            const dx = (p.x + p.width / 2) - x;\n            const dy = (p.y + p.height / 2) - y;\n            const dist = Math.sqrt(dx * dx + dy * dy);\n\n            if (dist < radius + p.width / 2) {\n                gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - damage);\n                gameState.current.hitTimerMs = 500;\n                // Add knockback\n                if (dist > 0) {\n                    gameState.current.vx += (dx / dist) * 10;\n                    gameState.current.vy -= 5;\n                } else {\n                    gameState.current.vy -= 10; // direct hit\n                }\n            }\n        }\n\n        // 2. Check entities impact\n        if (entitiesRef && entitiesRef.current) {\n            entitiesRef.current.forEach(ent => {\n                const edx = (ent.x + ent.width / 2) - x;\n                const edy = (ent.y + ent.height / 2) - y;\n                const edist = Math.sqrt(edx * edx + edy * edy);\n\n                if (edist < radius + ent.width / 2) {\n                    ent.health = Math.max(0, (ent.health || 0) - damage);\n                    // Platforms don't take knockback, but others might\n                    if (ent.subtype !== 'platform') {\n                        if (edist > 0) {\n                            ent.vx += (edx / edist) * 8;\n                            ent.vy -= 3;\n                        } else {\n                            ent.vy -= 6;\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    // Future weather types can be added here\n    // e.g., if (type === 'lightning') { ... }\n};\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction, ownerId = 'player') {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    ownerId, // Tagad ms zinm, kur izva\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag,\n    dmg: pDef?.damage || 10\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      // Updated isSolidAtPixel call with all necessary layers\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n    }\n    return false;\n  };\n\n  const checkObjectHit = (cx, cy, hw, hh) => {\n    if (!objectData) return null;\n    const pts = [\n        { x: cx - hw, y: cy - hh },\n        { x: cx + hw, y: cy - hh },\n        { x: cx - hw, y: cy + hh },\n        { x: cx + hw, y: cy + hh },\n        { x: cx, y: cy }\n    ];\n    for (const pt of pts) {\n        const gx = Math.floor(pt.x / TILE_SIZE);\n        const gy = Math.floor(pt.y / TILE_SIZE);\n        if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) continue;\n        const index = gy * mapWidth + gx;\n        const objId = objectData[index];\n        if (objId) {\n            const def = findItemById(objId);\n            if (def && def.isDestructible) {\n                // Check if already passable\n                const currentMeta = objectMetadata?.[index] || {};\n                const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                if (health > (def.passableHealthThreshold || 0)) {\n                    return index;\n                }\n            }\n        }\n    }\n    return null;\n  };\n\n  const checkEntityHit = (cx, cy, hw, hh, p) => {\n    if (!entitiesRef?.current) return null;\n    for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.id === p.ownerId) continue; // Ignorjam izvju\n\n        const ex = ent.x;\n        const ey = ent.y;\n        const ew = ent.width;\n        const eh = ent.height;\n        if (cx + hw > ex && cx - hw < ex + ew &&\n            cy + hh > ey && cy - hh < ey + eh) {\n            return ent;\n        }\n    }\n    return null;\n  };\n\n  const checkPlayerHit = (cx, cy, hw, hh, p) => {\n    if (!playerState || p.ownerId === 'player') return false; // Ignorjam, ja izva spltjs\n    \n    const ex = playerState.x;\n    const ey = playerState.y;\n    const ew = playerState.width || TILE_SIZE;\n    const eh = playerState.height || TILE_SIZE;\n    if (cx + hw > ex && cx - hw < ex + ew &&\n        cy + hh > ey && cy - hh < ey + eh) {\n        return true;\n    }\n    return false;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    let removed = false;\n\n    for (let s = 0; s < steps; s++) {\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n      \n      const hitPlayerX = checkPlayerHit(nextX, cy, hw, hh, p);\n      if (hitPlayerX) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntX = checkEntityHit(nextX, cy, hw, hh, p);\n      if (hitEntX) {\n        hitEntX.health -= p.dmg || 10;\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntX.x + hitEntX.width / 2,\n            y: hitEntX.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxX = checkObjectHit(nextX, cy, hw, hh);\n      if (hitIdxX !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxX, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      \n      const hitPlayerY = checkPlayerHit(cx, nextY, hw, hh, p);\n      if (hitPlayerY) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntY = checkEntityHit(cx, nextY, hw, hh, p);\n      if (hitEntY) {\n        hitEntY.health -= p.dmg || 10;\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntY.x + hitEntY.width / 2,\n            y: hitEntY.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxY = checkObjectHit(cx, nextY, hw, hh);\n      if (hitIdxY !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxY, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className, spriteSheet, frameIndex }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    // Ja ir spraitts, rdm tikai pirmo kadru (vai citu, ja nordts)\n    if (spriteSheet && spriteSheet.enabled) {\n        const columns = spriteSheet.columns || 1;\n        const total = spriteSheet.totalSprites || 1;\n        const rows = Math.ceil(total / columns);\n        \n        // Editor parasti rdm pirmo kadru (index 0) vai nordto kadru\n        const currentFrame = frameIndex !== undefined ? frameIndex : 0;\n        const col = currentFrame % columns;\n        const row = Math.floor(currentFrame / columns);\n\n        return (\n            <div className={className} style={{\n                ...style,\n                overflow: 'hidden',\n                display: 'inline-block',\n                width: style?.width || '32px',\n                height: style?.height || '32px',\n                position: 'relative'\n            }}>\n                <img\n                    src={imgSrc}\n                    alt={alt || ''}\n                    style={{\n                        position: 'absolute',\n                        width: `${columns * 100}%`,\n                        height: `${rows * 100}%`,\n                        left: `-${col * 100}%`,\n                        top: `-${row * 100}%`,\n                        maxWidth: 'none',\n                        maxHeight: 'none',\n                        display: 'block'\n                    }}\n                    draggable={false}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false}\n        />\n    );\n};\n\nexport default AnimatedItem;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport fireballA from '../../../assets/images/items/fireball_basic_A.png';\nimport fireballB from '../../../assets/images/items/fireball_basic_B.png';\nimport fireballC from '../../../assets/images/items/fireball_basic_C.png';\nimport fireballD from '../../../assets/images/items/fireball_basic_D.png';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: auto;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nconst AmmoIcon = styled.span`\n    width: 22px;\n    height: 22px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    image-rendering: pixelated;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    //gap: 8px;\n`;\n\nconst BarsContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    //gap: 1px;\n    width: 250px;\n    padding-top: 5px;\n    padding-bottom: 5px;\n   // border: solid 1px red;\n`;\n\nconst BarRow = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n`;\n\nconst BarWrapper = styled.div`\n    flex: 1;\n    height: 6px;\n    background-color: rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.4);\n    position: relative;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\n`;\n\nconst BarFill = styled.div.attrs(props => ({\n    style: {\n        width: `${props.$percent}%`,\n        backgroundColor: props.$color,\n    },\n}))`\n    height: 100%;\n    transition: width 0.3s ease;\n`;\n\nconst BarLabel = styled.div`\n    width: 60px;\n    font-size: 8px;\n    color: white;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px black;\n    pointer-events: none;\n    white-space: nowrap;\n    text-transform: uppercase;\n    text-align: right;\n`;\n\nconst GameHeader = ({ \n    health, \n    maxHealth = 100, \n    ammo = 0, \n    oxygen = 100, \n    maxOxygen = 100, \n    lavaResist = 100, \n    maxLavaResist = 100,\n    iceResist = 100,\n    maxIceResist = 100,\n    strength = 30,\n    maxStrength = 100,\n    radioactivity = 20,\n    maxRadioactivity = 100,\n    inWater = false,\n    liquidType = null,\n    onIce = false\n}) => {\n    const hpPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));\n    const oxyPercent = Math.max(0, Math.min(100, (oxygen / maxOxygen) * 100));\n    const lavaPercent = Math.max(0, Math.min(100, (lavaResist / maxLavaResist) * 100));\n    const icePercent = Math.max(0, Math.min(100, (iceResist / maxIceResist) * 100));\n    const strengthPercent = Math.max(0, Math.min(100, (strength / maxStrength) * 100));\n    const radioPercent = Math.max(0, Math.min(100, (radioactivity / maxRadioactivity) * 100));\n    const fireballFrames = [fireballA, fireballB, fireballC, fireballD, fireballC, fireballB];\n\n    return (\n        <HeaderContainer>\n            <AmmoDisplay>\n                <AmmoIcon>\n                    <AnimatedItem\n                        textures={fireballFrames}\n                        speed={300}\n                        alt=\"Fireball ammo\"\n                        style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                    />\n                </AmmoIcon>\n                {ammo || 0}\n            </AmmoDisplay>\n\n            <RightSection>\n                <BarsContainer>\n                    {/* HP Bar */}\n                    <BarRow>\n                        <BarLabel>HP</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={hpPercent} $color=\"#ff3232\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Oxygen Bar */}\n                    <BarRow>\n                        <BarLabel>OZ</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={oxyPercent} $color=\"#2ecdf1\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Lava Bar */}\n                    <BarRow>\n                        <BarLabel>LAVA</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={lavaPercent} $color=\"#ffcc00\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Ice Bar */}\n                    <BarRow>\n                        <BarLabel>ICE</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={icePercent} $color=\"#a5f3fc\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Strength Bar */}\n                    <BarRow>\n                        <BarLabel>STRNGTH</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={strengthPercent} $color=\"#8b5a2b\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Radioactivity Bar */}\n                    <BarRow>\n                        <BarLabel>RADIO</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={radioPercent} $color=\"#32cd32\" />\n                        </BarWrapper>\n                    </BarRow>\n                </BarsContainer>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    maxHealth: PropTypes.number,\n    ammo: PropTypes.number,\n    oxygen: PropTypes.number,\n    maxOxygen: PropTypes.number,\n    lavaResist: PropTypes.number,\n    maxLavaResist: PropTypes.number,\n    iceResist: PropTypes.number,\n    maxIceResist: PropTypes.number,\n    strength: PropTypes.number,\n    maxStrength: PropTypes.number,\n    radioactivity: PropTypes.number,\n    maxRadioactivity: PropTypes.number,\n    inWater: PropTypes.bool,\n    liquidType: PropTypes.string,\n    onIce: PropTypes.bool\n};\n\nexport default GameHeader;\n","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\n// Built-in: debug overlay toggle\nregister({\n  name: 'debug',\n  description: \"Toggle debug overlay: debug [on|off|toggle]\",\n  handler({ args }) {\n    const mode = (args && args[0]) ? String(args[0]).toLowerCase() : 'toggle';\n    const current = !!(window.__GAME_RUNTIME_SETTINGS__ && window.__GAME_RUNTIME_SETTINGS__.debugOverlayEnabled);\n    const next = (mode === 'on') ? true : (mode === 'off' ? false : !current);\n    try {\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        debugOverlayEnabled: next\n      };\n      try { localStorage.setItem('game_debug_overlay', next ? '1' : '0'); } catch {}\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: { debugOverlayEnabled: next } }));\n    } catch {}\n    return `Debug overlay ${next ? 'enabled' : 'disabled'}.`;\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Lava Rain (0..100)\n  const [lavaRain, setLavaRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_lavarain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherLavaRain === 'number') return Math.max(0, Math.min(100, g.weatherLavaRain));\n    } catch {}\n    return 0;\n  });\n  // New: Radioactive Fog (0..100)\n  const [radioactiveFog, setRadioactiveFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_radioactivefog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRadioactiveFog === 'number') return Math.max(0, Math.min(100, g.weatherRadioactiveFog));\n    } catch {}\n    return 0;\n  });\n  // New: Meteor Rain (0..100)\n  const [meteorRain, setMeteorRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_meteorrain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherMeteorRain === 'number') return Math.max(0, Math.min(100, g.weatherMeteorRain));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [debugOverlayEnabled, setDebugOverlayEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_debug_overlay');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.debugOverlayEnabled === 'boolean') return g.debugOverlayEnabled;\n    } catch {}\n    return false;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [roomBlurEnabled, setRoomBlurEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_graphics_room_blur');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.roomBlurEnabled === 'boolean') return g.roomBlurEnabled;\n    } catch {}\n    return true;\n  });\n  const [showCoordinates, setShowCoordinates] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_show_coords');\n      return ls === '1';\n    } catch {}\n    return false;\n  });\n\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Listen for runtime settings updates from game engine or other sources\n  useEffect(() => {\n    const onSettingsUpdate = (e) => {\n      const patch = (e && e.detail) || {};\n      if (patch.weatherRain !== undefined) setRain(patch.weatherRain);\n      if (patch.weatherSnow !== undefined) setSnow(patch.weatherSnow);\n      if (patch.weatherClouds !== undefined) setClouds(patch.weatherClouds);\n      if (patch.weatherFog !== undefined) setFog(patch.weatherFog);\n      if (patch.weatherThunder !== undefined) setThunder(patch.weatherThunder);\n      if (patch.weatherLavaRain !== undefined) setLavaRain(patch.weatherLavaRain);\n      if (patch.weatherRadioactiveFog !== undefined) setRadioactiveFog(patch.weatherRadioactiveFog);\n      if (patch.weatherMeteorRain !== undefined) setMeteorRain(patch.weatherMeteorRain);\n      if (patch.backgroundParallaxFactor !== undefined) setParallax(patch.backgroundParallaxFactor);\n      if (patch.roomBlurEnabled !== undefined) setRoomBlurEnabled(!!patch.roomBlurEnabled);\n      if (patch.healthBarEnabled !== undefined) setHealthBarEnabled(!!patch.healthBarEnabled);\n      if (patch.oxygenBarEnabled !== undefined) setOxygenBarEnabled(!!patch.oxygenBarEnabled);\n      if (patch.lavaBarEnabled !== undefined) setLavaBarEnabled(!!patch.lavaBarEnabled);\n      if (patch.waterSplashesEnabled !== undefined) setWaterSplashesEnabled(!!patch.waterSplashesEnabled);\n      if (patch.lavaEmbersEnabled !== undefined) setLavaEmbersEnabled(!!patch.lavaEmbersEnabled);\n      if (patch.debugOverlayEnabled !== undefined) setDebugOverlayEnabled(!!patch.debugOverlayEnabled);\n    };\n    window.addEventListener('game-settings-update', onSettingsUpdate);\n    return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.roomBlurEnabled === 'boolean') {\n          setRoomBlurEnabled(g.roomBlurEnabled);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.weatherLavaRain === 'number') setLavaRain(Math.max(0, Math.min(100, g.weatherLavaRain)));\n        if (typeof g.weatherRadioactiveFog === 'number') setRadioactiveFog(Math.max(0, Math.min(100, g.weatherRadioactiveFog)));\n        if (typeof g.weatherMeteorRain === 'number') setMeteorRain(Math.max(0, Math.min(100, g.weatherMeteorRain)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n        if (typeof g.debugOverlayEnabled === 'boolean') setDebugOverlayEnabled(!!g.debugOverlayEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  useEffect(() => {\n    try { localStorage.setItem('game_ui_show_coords', showCoordinates ? '1' : '0'); } catch {}\n  }, [showCoordinates]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Blur in Room</label>\n          <input\n            type=\"checkbox\"\n            checked={!!roomBlurEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setRoomBlurEnabled(v);\n              try { localStorage.setItem('game_graphics_room_blur', v ? '1' : '0'); } catch {}\n              emitUpdate({ roomBlurEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Coordinates</label>\n          <input\n            type=\"checkbox\"\n            checked={!!showCoordinates}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setShowCoordinates(v);\n              emitUpdate({ showCoordinates: v });\n            }}\n          />\n        </div>\n        {showCoordinates && (\n          <div style={{ marginTop: 8, padding: '4px 8px', background: 'rgba(0,0,0,0.3)', borderRadius: 4, fontSize: 11, fontFamily: 'monospace', color: '#4ec9b0' }}>\n            Pos: X={Math.round(window.__PLAYER_POS__?.x || 0)}, Y={Math.round(window.__PLAYER_POS__?.y || 0)}\n          </div>\n        )}\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lavas lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(lavaRain) ? lavaRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setLavaRain(v);\n            try { localStorage.setItem('game_weather_lavarain', String(v)); } catch {}\n            emitUpdate({ weatherLavaRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(lavaRain) ? lavaRain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Radioakt. migla</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(radioactiveFog) ? radioactiveFog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRadioactiveFog(v);\n            try { localStorage.setItem('game_weather_radioactivefog', String(v)); } catch {}\n            emitUpdate({ weatherRadioactiveFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(radioactiveFog) ? radioactiveFog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Meteortu lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(meteorRain) ? meteorRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setMeteorRain(v);\n            try { localStorage.setItem('game_weather_meteorrain', String(v)); } catch {}\n            emitUpdate({ weatherMeteorRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(meteorRain) ? meteorRain : 0}</span>\n      </div>\n    </section>\n  );\n\n  const renderDebug = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Debug</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 160 }}>Show Debug Overlay</label>\n        <input\n          type=\"checkbox\"\n          checked={!!debugOverlayEnabled}\n          onChange={(e) => {\n            const v = !!e.target.checked;\n            setDebugOverlayEnabled(v);\n            try { localStorage.setItem('game_debug_overlay', v ? '1' : '0'); } catch {}\n            emitUpdate({ debugOverlayEnabled: v });\n          }}\n        />\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather','Debug'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n        {activeTab === 'Debug' && renderDebug()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\n// - isInsideRoom: boolean  apply muffled effect\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6, isInsideRoom = false }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n  const audioCtxRef = useRef(null);\n  const sourceNodeRef = useRef(null);\n  const filterNodeRef = useRef(null);\n  const gainNodeRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n      if (audioCtxRef.current) {\n        audioCtxRef.current.close().catch(() => {});\n        audioCtxRef.current = null;\n        sourceNodeRef.current = null;\n        filterNodeRef.current = null;\n        gainNodeRef.current = null;\n      }\n    } catch {}\n  };\n\n  const setupWebAudio = (audio) => {\n    try {\n      const AudioContext = window.AudioContext || window.webkitAudioContext;\n      if (!AudioContext) return;\n\n      const ctx = new AudioContext();\n      const source = ctx.createMediaElementSource(audio);\n      const filter = ctx.createBiquadFilter();\n      const gain = ctx.createGain();\n\n      filter.type = 'lowpass';\n      filter.frequency.value = isInsideRoom ? 800 : 22000;\n      gain.gain.value = isInsideRoom ? 0.5 : 1.0;\n\n      source.connect(filter);\n      filter.connect(gain);\n      gain.connect(ctx.destination);\n\n      audioCtxRef.current = ctx;\n      sourceNodeRef.current = source;\n      filterNodeRef.current = filter;\n      gainNodeRef.current = gain;\n    } catch (e) {\n      console.warn('Web Audio setup failed:', e);\n    }\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Web Audio setup for filters\n    setupWebAudio(audio);\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume/room changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    // Direct audio volume (without Web Audio or as fallback)\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    \n    // Web Audio updates\n    if (audioCtxRef.current) {\n      if (filterNodeRef.current) {\n        filterNodeRef.current.frequency.setTargetAtTime(isInsideRoom ? 800 : 22000, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.gain.setTargetAtTime(isInsideRoom ? 0.4 : 1.0, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (audioCtxRef.current.state === 'suspended' && enabled) {\n        audioCtxRef.current.resume().catch(() => {});\n      }\n    }\n\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume, isInsideRoom]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import map1 from '../assets/maps/Template.json';\nimport map2 from '../assets/maps/Exampel_-_SECTORS.json';\nimport map3 from '../assets/maps/Exampel_-_LIQUIDS.json';\nimport map4 from '../assets/maps/Room.json';\nimport map5 from '../assets/maps/Ports.json';\n\n\nexport const BUILT_IN_MAPS = [\n    map1,\n    map2,\n    map3,\n    map4,\n    map5\n];\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport { findSpawnPosition } from '../../../engine/gameplay/interactables';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../engine/gameplay/secrets';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, removeTileAtIndex, moveTileInMap, moveObjectInMap, updateObjectAtIndex, updateObjectMetadata, setObjectTextureIndex, revealSecretZone, resetGame, setGameOver, toggleRoom, clearRooms } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\n\nimport { BUILT_IN_MAPS } from '../../../constants/builtInMaps';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nconst WinCounterOverlay = styled.div`\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 120px;\n    font-weight: bold;\n    color: #fff;\n    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,255,255,0.5);\n    z-index: 2000;\n    pointer-events: none;\n    font-family: 'Courier New', Courier, monospace;\n`;\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    overflow: hidden;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nconst MessageOverlay = styled.div`\n    position: absolute;\n    top: 40%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 80%;\n    text-align: center;\n    pointer-events: none;\n    z-index: 1500;\n    \n    h2 {\n        font-size: 48px;\n        color: white;\n        text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);\n        margin: 0;\n        padding: 20px;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-weight: 800;\n        letter-spacing: 2px;\n        opacity: ${props => props.$isVisible ? 1 : 0};\n        transition: opacity 2s ease-in-out;\n    }\n`;\n\nexport default function Game() {\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n\n    // Redux state\n    const gameState = useSelector(state => state.game) || {};\n    const uiState = useSelector(state => state.ui) || {};\n    const {\n        activeMapData = null,\n        tileMapData = [],\n        objectMapData = [],\n        secretMapData = [],\n        objectMetadata = {},\n        revealedSecrets = [],\n        objectTextureIndices = {},\n        mapWidth = 20,\n        mapHeight = 15,\n        isGameOver = false,\n        activeRoomIds = [],\n        projectMaps = {}\n    } = gameState;\n    const {\n        isMapModalOpen = true,\n        cameraScrollX = 0,\n        shouldCenterMap = false\n    } = uiState;\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    // In-game messages\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n\n    useEffect(() => {\n        const onToggle = (e) => {\n            const enabled = !!(e?.detail?.enabled);\n            setSoundEnabled(enabled);\n            try { localStorage.setItem('game_sound_enabled', enabled ? '1' : '0'); } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        return () => window.removeEventListener('game-sound-toggle', onToggle);\n    }, []);\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        dispatch(setGameOver(true));\n    };\n\n    const handleReplay = () => {\n        if (activeMapData) {\n            console.log(\"Replaying map...\");\n            const mapToLoad = {\n                ...activeMapData,\n                meta: {\n                    ...activeMapData.meta,\n                    date_map_last_updated: new Date().toISOString()\n                }\n            };\n            loadMapData(mapToLoad);\n            dispatch(setGameOver(false));\n        }\n    };\n\n    const playerStateRef = useRef(null);\n    const activeMapIdRef = useRef(null);\n    const isGameOverRef = useRef(false);\n\n    useEffect(() => {\n        const id = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n        activeMapIdRef.current = id;\n    }, [activeMapData]);\n\n    useEffect(() => {\n        isGameOverRef.current = !!isGameOver;\n    }, [isGameOver]);\n\n    const handleStateUpdate = useCallback((action, payload) => {\n        if (action === 'collectItem') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            dispatch(removeObjectAtIndex({ index, mapId }));\n        } else if (action === 'interactable') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            \n            const targetObjectData = (!mapId || mapId === 'main') ? objectMapData : (activeMapData?.maps?.[mapId]?.objectMapData || []);\n            const currentId = targetObjectData[index];\n            \n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used', mapId }));\n            }\n        } else if (action === 'setObjectFrame') {\n            const { index, frame, mapId } = payload;\n            dispatch(updateObjectMetadata({ index, metadata: { currentFrame: frame }, mapId }));\n        } else if (action === 'switchMap') {\n            const { targetMapId, triggerId } = payload;\n            const projectMaps = activeMapData?.maps || activeMapData?.projectMaps || {};\n            const targetMap = projectMaps[targetMapId];\n            \n            if (targetMap && targetMap.type === 'room') {\n                if (!activeRoomIds.includes(targetMapId)) {\n                    dispatch(toggleRoom(targetMapId));\n                }\n                return;\n            } else if (targetMapId === 'main' && activeRoomIds.length > 0) {\n                dispatch(clearRooms());\n                \n                // Open the door at the exit target position to prevent getting stuck\n                const spawn = findSpawnPosition(activeMapData, triggerId, 32);\n                if (spawn) {\n                    const spawnIdx = (Math.floor(spawn.y / 32) * mapWidth) + Math.floor(spawn.x / 32);\n                    const spawnObjId = objectMapData[spawnIdx];\n                    const spawnDef = registryItems.find(r => r.id === spawnObjId);\n                    if (spawnDef && spawnDef.subtype === 'door') {\n                        dispatch(updateObjectMetadata({ \n                            index: spawnIdx, \n                            metadata: { currentFrame: spawnDef.interaction?.frames?.opening || 1 } \n                        }));\n                    }\n                }\n                return;\n            }\n            \n            if (targetMap) {\n                console.log(`Switching to map: ${targetMapId}, looking for trigger: ${triggerId}`);\n                \n                // Ms varam vienkri nodot visu projektu un pielikt spawnTriggerId\n                const projectToLoad = {\n                    ...activeMapData,\n                    meta: {\n                        ...activeMapData.meta,\n                        activeMapId: targetMapId,\n                        spawnTriggerId: triggerId\n                    }\n                };\n                \n                loadMapData(projectToLoad);\n            }\n        } else if (action === 'objectDamage') {\n            const { index, damage } = payload;\n            const objId = objectMapData[index];\n            if (objId) {\n                const def = registryItems.find(r => r.id === objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata[index] || {};\n                    const maxH = def.maxHealth || 100;\n                    const newHealth = Math.max(0, (currentMeta.health !== undefined ? currentMeta.health : maxH) - damage);\n                    dispatch(updateObjectMetadata({ index, metadata: { health: newHealth } }));\n\n                    if (shouldRemoveCrackBlock(def, newHealth)) {\n                        dispatch(removeTileAtIndex(index));\n                    }\n\n                    const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                    const y = Math.floor(index / mapWidth) * TILE_SIZE;\n                    window.dispatchEvent(new CustomEvent('game-floating-text', {\n                        detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n                    }));\n                }\n            }\n        } else if (action === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (action === 'shiftTile' && payload) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapIdRef.current;\n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => objectMapData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => dispatch(moveTileInMap({ fromIndex: from, toIndex: to })),\n                moveObject: (from, to) => dispatch(moveObjectInMap({ fromIndex: from, toIndex: to })),\n                removeObject: idx => dispatch(removeObjectAtIndex(idx)),\n                shouldCancel: () => isGameOverRef.current || activeMapIdRef.current !== mapIdAtStart\n            });\n        } else if (action === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            const ps = playerStateRef.current;\n            const px = Number.isFinite(x) ? x : (ps?.x || 0) + (ps?.width || TILE_SIZE) / 2;\n            const py = Number.isFinite(y) ? y : (ps?.y || 0);\n            if (Number.isFinite(px) && Number.isFinite(py) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x: px, y: py, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        } else if (action === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (action === 'levelWin') {\n            console.log(\"Level Win! Returning to map selection.\");\n            setTimeout(() => {\n                alert(\"Level Complete!\");\n                dispatch(setMapModalOpen(true));\n            }, 500);\n        } else if (action === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1); // e.g., weatherRain\n            setRuntimeSettings(prev => ({ ...prev, [settingKey]: value }));\n            \n            // Dispatch event so UI components like GameSettings can update their state\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (action === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            // o darbbu ms izmantosim, lai nodotu informciju dzinjam caur ref vai eventu\n            // Bet labk ir tiei izsaukt dzinja funkciju, ja tda ir.\n            // T k useGameEngine ir hook, ms nevaram viegli izsaukt t iekjo funkciju.\n            // Tomr ms varam izmantot window eventu vai ref.\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (action === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        }\n    }, [dispatch, objectMapData, objectMetadata, registryItems]);\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const playerState = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        activeRoomIds,\n        mapWidth,\n        mapHeight\n    );\n    useEffect(() => {\n        playerStateRef.current = playerState;\n    }, [playerState]);\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => {\n            dispatch(setMapModalOpen(true));\n            dispatch(setGameOver(false)); // Reset game over when opening new game modal\n        };\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherLavaRain: (runtimeSettings.weatherLavaRain ?? 0),\n                weatherRadioactiveFog: (runtimeSettings.weatherRadioactiveFog ?? 0),\n                weatherMeteorRain: (runtimeSettings.weatherMeteorRain ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                roomBlurEnabled: (runtimeSettings.roomBlurEnabled ?? true),\n                debugOverlayEnabled: (runtimeSettings.debugOverlayEnabled ?? false),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            let effectiveMapData = mapData;\n            \n            // Atbalsts Version 2.0 (Multi-map project)\n            if (mapData.meta?.version === \"2.0\" && mapData.maps) {\n                const activeId = mapData.meta.activeMapId || Object.keys(mapData.maps)[0];\n                const activeMap = mapData.maps[activeId];\n                \n                if (activeMap) {\n                    // Konvertjam uz formtu, ko saprot dzinjs un setActiveMap\n                    effectiveMapData = {\n                        ...mapData, // Saglabjam visu projektu\n                        meta: {\n                            ...mapData.meta,\n                            width: activeMap.width,\n                            height: activeMap.height,\n                            name: activeMap.name,\n                            backgroundImage: activeMap.backgroundImage,\n                            backgroundColor: activeMap.backgroundColor,\n                            backgroundMusic: activeMap.backgroundMusic,\n                            backgroundParallaxFactor: activeMap.backgroundParallaxFactor,\n                            weather: activeMap.weather,\n                            objectMetadata: activeMap.objectMetadata || {},\n                            playerPosition: activeMap.playerPosition\n                        },\n                        layers: activeMap.layers || [\n                            { name: 'background', data: activeMap.tileMapData },\n                            { name: 'entities', data: activeMap.objectMapData },\n                            { name: 'secrets', data: activeMap.secretMapData }\n                        ]\n                    };\n                }\n            }\n\n            const w = effectiveMapData.meta?.width || effectiveMapData.width || 20;\n            const h = effectiveMapData.meta?.height || effectiveMapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (effectiveMapData.layers) {\n                const bgLayer = effectiveMapData.layers.find(l => l.name === 'background' || l.type === 'tile');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = effectiveMapData.layers.find(l => l.name === 'entities' || l.type === 'object');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = effectiveMapData.layers.find(l => l.name === 'secrets' || l.type === 'secret');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = effectiveMapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData: effectiveMapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n            dispatch(setGameOver(false)); // Ensure game over is reset on map load\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: effectiveMapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    const debugOverlayEnabled = !!(runtimeSettings.debugOverlayEnabled);\n    const debugMapId = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n\n    return (\n        <GameContainer onClick={() => {\n            window.dispatchEvent(new CustomEvent('game-sound-user-gesture'));\n        }}>\n        \n            {/* Game Header */}\n            {/* UI Overlays */}\n            {playerState?.isWinning && (\n                <WinCounterOverlay>\n                    {Math.floor(playerState.winCounter || 0)}\n                </WinCounterOverlay>\n            )}\n\n            {gameMessage.text && (\n                <MessageOverlay $isVisible={gameMessage.isVisible}>\n                    <h2>{gameMessage.text}</h2>\n                </MessageOverlay>\n            )}\n\n            <GameHeader \n                health={playerState.health} \n                maxHealth={playerState.maxHealth}\n                ammo={playerState.ammo || 0} \n                oxygen={playerState.oxygen}\n                maxOxygen={playerState.maxOxygen}\n                lavaResist={playerState.lavaResist}\n                maxLavaResist={playerState.maxLavaResist}\n                iceResist={playerState.iceResist}\n                maxIceResist={playerState.maxIceResist}\n                strength={playerState.strength}\n                maxStrength={playerState.maxStrength}\n                radioactivity={playerState.radioactivity}\n                maxRadioactivity={playerState.maxRadioactivity}\n                inWater={playerState.inWater}\n                liquidType={playerState.liquidType}\n                onIce={playerState.onIce}\n            />\n\n            {debugOverlayEnabled && (\n                <div style={{\n                    position: 'absolute',\n                    top: 70,\n                    left: 70,\n                    background: 'rgba(0,0,0,0.6)',\n                    color: '#eaeaea',\n                    padding: '8px 10px',\n                    fontSize: 11,\n                    lineHeight: 1.4,\n                    borderRadius: 4,\n                    zIndex: 2100,\n                    pointerEvents: 'none',\n                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace'\n                }}>\n                    <div>Map: {debugMapId}</div>\n                    <div>Pos: {Math.round(playerState.x || 0)}, {Math.round(playerState.y || 0)}</div>\n                    <div>Room: {Array.isArray(activeRoomIds) && activeRoomIds.length ? activeRoomIds.join(', ') : 'none'}</div>\n                    <div>Weather: rain {runtimeSettings.weatherRain ?? 0} | snow {runtimeSettings.weatherSnow ?? 0} | fog {runtimeSettings.weatherFog ?? 0}</div>\n                    <div>Weather: lava {runtimeSettings.weatherLavaRain ?? 0} | radio {runtimeSettings.weatherRadioactiveFog ?? 0}</div>\n                    <div>HP {Math.round(playerState.health || 0)} / {Math.round(playerState.maxHealth || 0)}</div>\n                    <div>O2 {Math.round(playerState.oxygen || 0)} | Lava {Math.round(playerState.lavaResist || 0)} | Rad {Math.round(playerState.radioactivity || 0)}</div>\n                </div>\n            )}\n\n\n            {isGameOver && (\n                <GameOverOverlay>\n                    <GameOverTitle>Game Over</GameOverTitle>\n                    <ReplayButton onClick={handleReplay}>\n                        REPLAY \n                    </ReplayButton>\n                </GameOverOverlay>\n            )}\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>Select a Map</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => {\n                                const isV2 = map.meta?.version === \"2.0\";\n                                const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                                const author = map.meta?.author || \"Unknown\";\n                                \n                                let sizeInfo = \"\";\n                                let subMapInfo = \"\";\n\n                                if (isV2 && map.maps) {\n                                    const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                                    if (mainMap) {\n                                        sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                                    }\n                                    \n                                    const mapValues = Object.values(map.maps);\n                                    const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                                    const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                                    \n                                    subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                                } else {\n                                    sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                                }\n\n                                return (\n                                    <MapCard key={index} onClick={() => loadMapData(map)}>\n                                        <div>\n                                            <MapTitle>{projectName}</MapTitle>\n                                            <MapAuthor>By: {author}</MapAuthor>\n                                        </div>\n                                        {map.meta?.description && (\n                                            <MapDescription title={map.meta.description}>\n                                                {map.meta.description}\n                                            </MapDescription>\n                                        )}\n                                        <MapInfo>\n                                            <div>Size: {sizeInfo}{subMapInfo}</div>\n                                        </MapInfo>\n                                    </MapCard>\n                                );\n                            })}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 Load Custom Map from Computer\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherLavaRain={runtimeSettings.weatherLavaRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherMeteorRain={runtimeSettings.weatherMeteorRain ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherRadioactiveFog={runtimeSettings.weatherRadioactiveFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                            roomBlurEnabled={runtimeSettings.roomBlurEnabled ?? true}\n                            debugOverlayEnabled={runtimeSettings.debugOverlayEnabled ?? false}\n                            isEditor={false}\n                            mapType={activeMapData?.type || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={projectMaps}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer \n                metaPath={activeMapData?.meta?.backgroundMusic} \n                enabled={soundEnabled} \n                volume={0.6} \n                isInsideRoom={activeRoomIds.length > 0}\n            />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","import saveFile from '../../../../utilities/saveFile';\nimport errorHandler from '../../../../services/errorHandler';\n\nexport const saveMap = async ({\n    maps,\n    activeMapId,\n    mapName,\n    creatorName,\n    mapDescription,\n    createdAt,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    const projectData = {\n        meta: {\n            version: \"2.0\",\n            projectName: mapName,\n            author: creatorName,\n            description: mapDescription,\n            date_created: createdDate,\n            date_last_updated: currentDate,\n            activeMapId: activeMapId\n        },\n        maps: {}\n    };\n\n    // Serialize all maps\n    Object.values(maps).forEach(map => {\n        const filledBlocks = map.tileMapData.filter(t => t !== null).length;\n        const objectsCount = map.objectMapData.filter(o => o !== null).length;\n        \n        projectData.maps[map.id] = {\n            id: map.id,\n            name: map.name,\n            description: map.description || '',\n            type: map.type,\n            width: map.mapWidth,\n            height: map.mapHeight,\n            backgroundImage: map.selectedBackgroundImage || null,\n            backgroundColor: map.selectedBackgroundColor || null,\n            backgroundParallaxFactor: map.backgroundParallaxFactor || 0.3,\n            backgroundMusic: map.selectedBackgroundMusic || null,\n            weather: map.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n            objectMetadata: map.objectMetadata || {},\n            playerPosition: map.playerPosition || null,\n            worldX: map.worldX || 0,\n            worldY: map.worldY || 0,\n            statistics: {\n                total_tiles: map.mapWidth * map.mapHeight,\n                filled_tiles: filledBlocks,\n                total_objects: objectsCount\n            },\n            layers: [\n                { type: \"tile\", name: \"background\", data: map.tileMapData },\n                { type: \"object\", name: \"entities\", data: map.objectMapData },\n                { type: \"secret\", name: \"secrets\", data: map.secretMapData || Array(map.mapWidth * map.mapHeight).fill(null) }\n            ]\n        };\n    });\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(projectData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Project saved successfully', {\n                component: 'Editor',\n                projectName: mapName,\n                fileName,\n                mapsCount: Object.keys(maps).length\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save project. Check console for details.');\n    }\n};\n\nexport const applyMapData = (loaded, {\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setPlayerPosition,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData,\n    setObjectMetadata,\n    setWeatherRain,\n    setWeatherSnow,\n    setWeatherClouds,\n    setWeatherFog,\n    setWeatherThunder,\n    setWeatherLavaRain,\n    setWeatherRadioactiveFog,\n    setWeatherMeteorRain,\n    // Multi-map setters\n    setMaps,\n    setActiveMapId\n}) => {\n    try {\n        // Check for multi-map format (version 2.0)\n        if (loaded.meta && loaded.meta.version === \"2.0\" && loaded.maps) {\n            const projectMaps = {};\n            \n            Object.keys(loaded.maps).forEach(mapId => {\n                const m = loaded.maps[mapId];\n                const bgLayer = m.layers.find(l => l.type === 'tile');\n                const objLayer = m.layers.find(l => l.type === 'object');\n                const secretLayer = m.layers.find(l => l.type === 'secret');\n                \n                projectMaps[mapId] = {\n                    id: mapId,\n                    name: m.name,\n                    description: m.description || '',\n                    type: m.type || 'overworld',\n                    mapWidth: m.width,\n                    mapHeight: m.height,\n                    tileMapData: bgLayer ? bgLayer.data : Array(m.width * m.height).fill(null),\n                    objectMapData: objLayer ? objLayer.data : Array(m.width * m.height).fill(null),\n                    secretMapData: secretLayer ? secretLayer.data : Array(m.width * m.height).fill(null),\n                    objectMetadata: m.objectMetadata || {},\n                    selectedBackgroundImage: m.backgroundImage,\n                    selectedBackgroundColor: m.backgroundColor,\n                    backgroundParallaxFactor: m.backgroundParallaxFactor || 0.3,\n                    selectedBackgroundMusic: m.backgroundMusic,\n                    weather: m.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                    playerPosition: m.playerPosition || null,\n                    worldX: m.worldX || 0,\n                    worldY: m.worldY || 0\n                };\n            });\n            \n            setMaps(projectMaps);\n            setMapName(loaded.meta.projectName || \"Loaded Project\");\n            setCreatorName(loaded.meta.author || \"Anonymous\");\n            setMapDescription(loaded.meta.description || \"\");\n            setCreatedAt(loaded.meta.date_created || new Date().toISOString());\n            \n            const activeId = loaded.meta.activeMapId || Object.keys(projectMaps)[0];\n            setActiveMapId(activeId);\n            \n            const activeMap = projectMaps[activeId];\n            if (activeMap) {\n                setMapWidth(activeMap.mapWidth);\n                setMapHeight(activeMap.mapHeight);\n                setTileMapData(activeMap.tileMapData);\n                setObjectMapData(activeMap.objectMapData);\n                setSecretMapData(activeMap.secretMapData);\n                setObjectMetadata(activeMap.objectMetadata);\n                setSelectedBackgroundImage(activeMap.selectedBackgroundImage);\n                setSelectedBackgroundColor(activeMap.selectedBackgroundColor);\n                setBackgroundParallaxFactor(activeMap.backgroundParallaxFactor);\n                setSelectedBackgroundMusic(activeMap.selectedBackgroundMusic);\n                \n                setWeatherRain(activeMap.weather.rain);\n                setWeatherSnow(activeMap.weather.snow);\n                setWeatherClouds(activeMap.weather.clouds);\n                setWeatherFog(activeMap.weather.fog);\n                setWeatherThunder(activeMap.weather.thunder);\n                setWeatherLavaRain(activeMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(activeMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(activeMap.weather.meteorRain || 0);\n\n                if (activeMap.playerPosition) setPlayerPosition(activeMap.playerPosition);\n            }\n            \n            errorHandler.info('Project loaded successfully', {\n                component: 'Editor',\n                projectName: loaded.meta.projectName\n            });\n        } else if (loaded.meta) {\n            // Legacy 1.0 format\n            setMapWidth(loaded.meta.width);\n            setMapHeight(loaded.meta.height);\n\n            if (loaded.meta.name) setMapName(loaded.meta.name);\n            if (loaded.meta.author) setCreatorName(loaded.meta.author);\n            if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n            const bgLayer = loaded.layers.find(l => l.name === 'background');\n            const objLayer = loaded.layers.find(l => l.name === 'entities');\n            const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n            \n            const singleMap = {\n                id: 'main',\n                name: loaded.meta.name || \"Main Map\",\n                type: 'overworld',\n                mapWidth: loaded.meta.width,\n                mapHeight: loaded.meta.height,\n                tileMapData: bgLayer ? bgLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMapData: objLayer ? objLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                secretMapData: secretLayer ? secretLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMetadata: loaded.meta.objectMetadata || {},\n                selectedBackgroundImage: loaded.meta.backgroundImage,\n                selectedBackgroundColor: loaded.meta.backgroundColor,\n                backgroundParallaxFactor: loaded.meta.backgroundParallaxFactor || 0.3,\n                selectedBackgroundMusic: loaded.meta.backgroundMusic,\n                weather: loaded.meta.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                playerPosition: null\n            };\n\n            setMaps({ 'main': singleMap });\n            setActiveMapId('main');\n\n            if (bgLayer) setTileMapData(bgLayer.data);\n            if (objLayer) setObjectMapData(objLayer.data);\n            if (secretLayer) setSecretMapData(secretLayer.data);\n            \n            // Set other states\n            if (loaded.meta.backgroundImage) setSelectedBackgroundImage(loaded.meta.backgroundImage);\n            if (loaded.meta.backgroundColor) setSelectedBackgroundColor(loaded.meta.backgroundColor);\n            if (loaded.meta.backgroundParallaxFactor !== undefined) setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n            if (loaded.meta.backgroundMusic) setSelectedBackgroundMusic(loaded.meta.backgroundMusic);\n            if (loaded.meta.objectMetadata) setObjectMetadata(loaded.meta.objectMetadata);\n            if (loaded.meta.weather) {\n                setWeatherRain(loaded.meta.weather.rain || 0);\n                setWeatherSnow(loaded.meta.weather.snow || 0);\n                setWeatherClouds(loaded.meta.weather.clouds || 0);\n                setWeatherFog(loaded.meta.weather.fog || 0);\n                setWeatherThunder(loaded.meta.weather.thunder || 0);\n                setWeatherLavaRain(loaded.meta.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(loaded.meta.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(loaded.meta.weather.meteorRain || 0);\n            }\n            if (loaded.meta.playerPosition) setPlayerPosition(loaded.meta.playerPosition);\n\n            errorHandler.info('Map loaded successfully (Converted to Project)', {\n                component: 'Editor',\n                mapName: loaded.meta.name\n            });\n        } else {\n            // Oldest format\n            if (loaded.width) setMapWidth(loaded.width);\n            if (loaded.height) setMapHeight(loaded.height);\n            if (loaded.tiles) setTileMapData(loaded.tiles);\n            setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n            errorHandler.warn('Loaded map in legacy format', {\n                component: 'Editor'\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'applyMapData'\n        });\n        alert('Error applying map data. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    ...setters\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                applyMapData(loaded, setters);\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const loadBuiltInMap = ({\n    mapData,\n    ...setters\n}) => {\n    try {\n        applyMapData(mapData, setters);\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'loadBuiltInMap'\n        });\n        alert('Error loading built-in map.');\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets, objectMetadata: oldMeta } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        if (!oldArr) return newArr;\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[y * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    const resizeMetadata = (oldM) => {\n        const newM = {};\n        if (!oldM) return newM;\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                const oldIdx = y * oldW + x;\n                const newIdx = y * newWidth + x;\n                if (oldM[oldIdx]) {\n                    newM[newIdx] = oldM[oldIdx];\n                }\n            }\n        }\n        return newM;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets));\n    setObjectMetadata(resizeMetadata(oldMeta));\n};\n","import React from 'react';\n\nexport const ObjectLinks = React.memo(({ mapWidth, mapHeight, objectMapData, objectMetadata }) => {\n    const links = [];\n    const portals = [];\n    const targets = [];\n\n    // Collect all portals and targets with Trigger IDs\n    objectMapData.forEach((id, index) => {\n        if (!id) return;\n        const metadata = objectMetadata?.[index];\n        if (!metadata || metadata.triggerId === undefined || metadata.triggerId === null) return;\n\n        const x = (index % mapWidth) * 32 + 16;\n        const y = Math.floor(index / mapWidth) * 32 + 16;\n\n        if (id.includes('portal') && !id.includes('target')) {\n            portals.push({ x, y, id: metadata.triggerId });\n        } else if (id.includes('target') || id === 'portal_target') {\n            targets.push({ x, y, id: metadata.triggerId });\n        }\n    });\n\n    // Draw lines between matching IDs\n    portals.forEach(p => {\n        targets.forEach(t => {\n            if (p.id === t.id) {\n                links.push(\n                    <line\n                        key={`link-${p.x}-${p.y}-${t.x}-${t.y}`}\n                        x1={p.x} y1={p.y}\n                        x2={t.x} y2={t.y}\n                        stroke=\"#fff\"\n                        strokeWidth=\"2\"\n                        strokeDasharray=\"5,5\"\n                    />\n                );\n            }\n        });\n    });\n\n    return (\n        <svg style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: mapWidth * 32,\n            height: mapHeight * 32, // Note: mapHeight must be available\n            zIndex: 10,\n            pointerEvents: 'none',\n            opacity: 0.6\n        }}>\n            {links}\n        </svg>\n    );\n});\n","import React from 'react';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\n\nexport const EditorTile = React.memo(({\n    index,\n    x, y,\n    activeTool,\n    tileObj,\n    objObj,\n    secretObj,\n    objectMetadata,\n    isHighlighted,\n    parentRegionIndex,\n    borderStyle,\n    bgStyle,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleResizeStart,\n    handleMoveStart,\n    filter,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages\n}) => {\n    const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n    const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n    const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n    const isQuicksandTile = !!(tileObj && tileObj.flags && tileObj.flags.quicksand);\n    const isWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.waterfall);\n    const isLavaWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.lava_waterfall);\n    const isRadioactiveWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_water);\n    const isRadioactiveWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_waterfall);\n\n    const actualIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n    const triggerId = objectMetadata?.[actualIndex]?.triggerId;\n    const intensity = objectMetadata?.[actualIndex]?.intensity;\n    const messageText = objectMetadata?.[actualIndex]?.message;\n    \n    // Dimensijas emam no tie indeksa, lai izvairtos no citu objektu (piem. Room Area) \n    // ietekmes uz 1x1 objektiem, kas atrodas to robes.\n    const width = objectMetadata?.[index]?.width || 1;\n    const height = objectMetadata?.[index]?.height || 1;\n\n    const handleMouseDown = (e) => {\n        // If we're clicking a tile that's part of a region, we should interact with the anchor\n        const targetIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n        \n        if (activeTool === 'move') {\n            const hasMovable = objectMetadata[targetIndex] || objObj || secretObj;\n            if (hasMovable) {\n                e.stopPropagation();\n                handleMoveStart(targetIndex);\n                return;\n            }\n        }\n        handleGridMouseDown(index, e);\n    };\n\n    const isResizable = React.useMemo(() => {\n        if (!objObj && !secretObj) return false;\n        \n        // Room areas (windows) on room maps are NOT resizable\n        if (secretObj && secretObj.subtype === 'room' && mapType === 'room') return false;\n\n        // Specifically requested to disable for these types, except Room Areas which MUST be resizable\n        if (secretObj && secretObj.type === 'secret' && secretObj.subtype !== 'room') return false;\n        if (objObj && (objObj.type === 'crack_block' || objObj.type === 'wolf_secret')) return false;\n        return true;\n    }, [objObj, secretObj, mapType]);\n\n    const hasObjectOrSecret = objObj || secretObj || (parentRegionIndex !== null);\n\n    return (\n        <div\n            onMouseDown={handleMouseDown}\n            onMouseEnter={() => handleGridMouseEnter(index)}\n            style={{\n                width: '32px',\n                height: '32px',\n                border: borderStyle,\n                backgroundColor: bgStyle,\n                position: 'relative',\n                boxSizing: 'border-box',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                overflow: 'visible',\n                cursor: (activeTool === 'move' && hasObjectOrSecret) ? 'grab' : 'default'\n            }}>\n            \n            {isHighlighted && parentRegionIndex === null && isResizable && (\n                <>\n                    {/* Resize Handles */}\n                    {/* Right */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'right'); }}\n                        style={{ position: 'absolute', right: `${-(width-1)*32 - 6}px`, top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Left */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'left'); }}\n                        style={{ position: 'absolute', left: '-6px', top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Bottom */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'bottom'); }}\n                        style={{ position: 'absolute', bottom: `${-(height-1)*32 - 6}px`, left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                    {/* Top */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'top'); }}\n                        style={{ position: 'absolute', top: '-6px', left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                </>\n            )}\n\n            {/* Tile Layer */}\n            {tileObj && (\n                <div style={{ filter: filter ? filter('tile') : 'none', transition: 'filter 0.3s ease' }}>\n                    {isLiquidTile ? (\n                        <div style={{\n                            width: '32px', height: '32px',\n                            background: isLavaWaterfallTile ? 'rgba(255, 204, 0, 0.7)' : (isLavaTile ? 'rgba(255, 204, 0, 0.7)' : (isWaterTile || isWaterfallTile ? 'rgba(58, 127, 184, 0.7)' : (isQuicksandTile ? 'rgba(218, 165, 32, 0.7)' : (isRadioactiveWaterTile || isRadioactiveWaterfallTile ? 'rgba(50, 205, 50, 0.7)' : 'rgba(0, 255, 255, 0.3)')))),\n                            display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: '8px'\n                        }}>\n                            {isLavaWaterfallTile ? 'L.FALL' : (isLavaTile ? 'LAVA' : (isRadioactiveWaterfallTile ? 'RADFALL' : (isRadioactiveWaterTile ? 'RAD' : (isWaterTile ? 'WATER' : (isWaterfallTile ? 'FALL' : (isQuicksandTile ? 'QUICK' : 'LIQ'))))))}\n                        </div>\n                    ) : (\n                        <AnimatedItem\n                            textures={tileObj.textures}\n                            texture={tileObj.texture}\n                            speed={tileObj.animationSpeed}\n                            spriteSheet={tileObj.spriteSheet}\n                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\n                        />\n                    )}\n                </div>\n            )}\n\n            {/* Secret Layer */}\n            {secretObj && (secretObj.subtype !== 'room' || isRoomAreaVisible || showRoomMapContent || activeTool === 'area' || mapType === 'room') && (\n                <div style={{\n                    position: 'absolute', \n                    top: '0', left: '0',\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: secretObj.filterColorInEditor || secretObj.filterColor || 'rgba(128, 0, 128, 0.4)',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    color: '#fff', fontSize: '10px', fontWeight: 'bold', zIndex: 2,\n                    filter: filter ? filter('secret') : 'none', transition: 'filter 0.3s ease',\n                    border: '1px dashed rgba(255,255,255,0.5)',\n                    boxSizing: 'border-box',\n                    pointerEvents: 'none'\n                }}>\n                    {mapType !== 'room' && (secretObj.editorIcon || 'SECRET')}\n                </div>\n            )}\n\n            {/* Object Layer */}\n            {objObj && (\n                <div style={{\n                    position: 'absolute', \n                    top: objObj.type === 'decoration' ? '0' : '2px',\n                    left: objObj.type === 'decoration' ? '0' : '2px',\n                    width: objObj.type === 'decoration' ? `${width * 32}px` : `${width * 32 - 4}px`,\n                    height: objObj.type === 'decoration' ? `${height * 32}px` : `${height * 32 - 4}px`,\n                    zIndex: 3,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    filter: filter ? filter('object') : 'none', transition: 'filter 0.3s ease',\n                    pointerEvents: 'none' // Let clicks pass through to the tile for resizing handles\n                }}>\n                    {objObj.editorIcon ? (\n                        <span style={{ fontSize: '20px', width: '100%', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: 'rgba(255,255,255,0.1)', border: '1px dashed rgba(255,255,255,0.3)' }}>{objObj.editorIcon}</span>\n                    ) : (\n                        <AnimatedItem\n                            textures={objObj.textures}\n                            texture={objObj.texture}\n                            speed={objObj.animationSpeed}\n                            spriteSheet={objObj.spriteSheet}\n                            frameIndex={objectMetadata?.[actualIndex]?.currentFrame !== undefined ? objectMetadata[actualIndex].currentFrame : (objObj.subtype === 'door' && mapType === 'room' ? (objObj.interaction?.frames?.inside || 2) : 0)}\n                            style={{ \n                                width: '100%', \n                                height: '100%', \n                                objectFit: objObj.type === 'decoration' ? 'cover' : 'contain', \n                                backgroundColor: objObj.type === 'decoration' ? 'transparent' : 'rgba(255,255,255,0.1)', \n                                border: objObj.type === 'decoration' ? 'none' : '1px dashed rgba(255,255,255,0.3)' \n                            }}\n                        />\n                    )}\n\n                    {/* Trigger ID */}\n                    {triggerId !== undefined && triggerId !== null && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', left: '0',\n                            backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 10, border: '1px solid #fff'\n                        }}>\n                            ID: {triggerId}\n                        </div>\n                    )}\n\n                    {/* Intensity */}\n                    {intensity !== undefined && intensity !== null && objObj && (objObj.type === 'weather_trigger' || objObj.hasIntensity) && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', right: '0',\n                            backgroundColor: 'rgba(0,100,200,0.8)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 11, border: '1px solid #fff'\n                        }}>\n                            {intensity}%\n                        </div>\n                    )}\n\n                    {/* Message Bubble */}\n                    {showMessages && objObj && objObj.type === 'message_trigger' && messageText && (\n                        <div style={{\n                            position: 'absolute',\n                            left: '50%',\n                            bottom: '100%',\n                            transform: 'translateX(-50%)',\n                            marginBottom: '8px',\n                            maxWidth: '140px',\n                            backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                            color: '#222',\n                            border: '1px solid rgba(0,0,0,0.6)',\n                            borderRadius: '8px',\n                            padding: '4px 6px',\n                            fontSize: '10px',\n                            lineHeight: 1.2,\n                            textAlign: 'center',\n                            zIndex: 12,\n                            pointerEvents: 'none'\n                        }}>\n                            {messageText}\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-6px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '6px solid transparent',\n                                borderRight: '6px solid transparent',\n                                borderTop: '6px solid rgba(255, 255, 255, 0.95)'\n                            }} />\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-7px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '7px solid transparent',\n                                borderRight: '7px solid transparent',\n                                borderTop: '7px solid rgba(0,0,0,0.6)',\n                                zIndex: -1\n                            }} />\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {/* Room Area Visibility Overlay */}\n            {(isRoomAreaVisible || showRoomMapContent || activeTool === 'area') && secretObj && secretObj.subtype === 'room' && mapType !== 'room' && (\n                <div style={{\n                    position: 'absolute',\n                    top: 0, left: 0,\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: 'rgba(255, 255, 0, 0.2)',\n                    border: '2px solid gold',\n                    boxSizing: 'border-box',\n                    zIndex: 4,\n                    pointerEvents: 'none',\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#000',\n                    fontSize: '10px',\n                    fontWeight: 'bold',\n                    textShadow: '0 0 2px #fff'\n                }}>\n                    <span style={{ fontSize: '14px' }}></span>\n                    <span style={{ whiteSpace: 'nowrap' }}>{objectMetadata?.[actualIndex]?.roomName || 'Unnamed'}</span>\n                    <span style={{ fontSize: '9px' }}>{width}x{height}m</span>\n                </div>\n            )}\n        </div>\n    );\n});\n","import React, { useCallback } from 'react';\nimport { ObjectLinks } from './viewport/ObjectLinks';\nimport { EditorTile } from './viewport/EditorTile';\nimport PixiStage from '../game/PixiStage';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    registryItems,\n    hoverIndex,\n    highlightedIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    handleResizeStart,\n    handleMoveStart,\n    setIsDragging,\n    selectedTile,\n    weatherRain,\n    weatherSnow,\n    weatherClouds,\n    weatherFog,\n    weatherThunder,\n    weatherLavaRain,\n    weatherRadioactiveFog,\n    weatherMeteorRain,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages,\n    maps\n}) => {\n    const isEraserActive = activeTool === 'brush' && selectedTile === null;\n    const isBrushActive = activeTool === 'brush';\n    const isBucketActive = activeTool === 'bucket';\n\n    const regions = React.useMemo(() => {\n        const res = [];\n        if (!objectMetadata) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            if (meta.width > 1 || meta.height > 1) {\n                const idx = parseInt(idxStr);\n                res.push({ \n                    idx, \n                    x: idx % mapWidth, \n                    y: Math.floor(idx / mapWidth), \n                    w: meta.width || 1, \n                    h: meta.height || 1 \n                });\n            }\n        }\n        return res;\n    }, [objectMetadata, mapWidth]);\n\n    const roomAreas = React.useMemo(() => {\n        const res = [];\n        if (!secretMapData || !objectMetadata || !showRoomMapContent) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                res.push({\n                    id: meta.linkedMapId,\n                    x: idx % mapWidth,\n                    y: Math.floor(idx / mapWidth),\n                    width: meta.width || 1,\n                    height: meta.height || 1,\n                    mapData: maps[meta.linkedMapId]\n                });\n            }\n        }\n        return res;\n    }, [secretMapData, objectMetadata, showRoomMapContent, maps, mapWidth]);\n\n    const getLayerColor = (layer, alpha = 0.5) => {\n        if (layer === 'tile') return `rgba(24, 144, 255, ${alpha})`;\n        if (layer === 'object') return `rgba(245, 34, 45, ${alpha})`;\n        if (layer === 'secret') return `rgba(114, 46, 209, ${alpha})`;\n        return `rgba(255, 255, 255, ${alpha})`;\n    };\n\n    const getGridStyles = () => {\n        let color = 'rgba(255, 255, 255, 0.15)';\n        let visible = showGrid;\n\n        if (isEraserActive) {\n            color = getLayerColor(activeLayer, 0.4);\n            visible = true;\n        } else if (isBrushActive || isBucketActive) {\n            color = getLayerColor(activeLayer, 0.25);\n            visible = true; // Auto-show grid when using drawing tools\n        }\n\n        return {\n            backgroundImage: visible ? `\n                linear-gradient(to right, ${color} 1px, transparent 1px),\n                linear-gradient(to bottom, ${color} 1px, transparent 1px)\n            ` : 'none',\n            backgroundSize: '32px 32px'\n        };\n    };\n\n    const getLayerFilter = useCallback((layer) => {\n        if (!isEraserActive) return 'none';\n        return activeLayer === layer ? 'none' : 'grayscale(100%) opacity(0.2) blur(2px)';\n    }, [isEraserActive, activeLayer]);\n\n    const getOverlayColor = () => {\n        if (!isEraserActive) return 'transparent';\n        if (activeLayer === 'tile') return 'rgba(24, 144, 255, 0.25)'; // Blueish for blocks\n        if (activeLayer === 'object') return 'rgba(245, 34, 45, 0.25)'; // Reddish for objects\n        if (activeLayer === 'secret') return 'rgba(114, 46, 209, 0.25)'; // Purplish for secrets\n        return 'transparent';\n    };\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => handleGridMouseUp(hoverIndex)}>\n            <div style={{ position: 'relative', width: 'fit-content' }} onMouseLeave={handleGridMouseLeave}>\n                \n                <ObjectLinks \n                    mapWidth={mapWidth} \n                    mapHeight={mapHeight} \n                    objectMapData={objectMapData} \n                    objectMetadata={objectMetadata} \n                />\n\n                {/* Room Map Content Overlay */}\n                {showRoomMapContent && roomAreas.map(room => (\n                    <div\n                        key={room.id}\n                        style={{\n                            position: 'absolute',\n                            left: room.x * 32,\n                            top: room.y * 32,\n                            width: room.width * 32,\n                            height: room.height * 32,\n                            zIndex: 6,\n                            pointerEvents: 'none',\n                            overflow: 'hidden',\n                            boxShadow: '0 0 15px rgba(0,0,0,0.5)',\n                            border: '2px solid #f39c12'\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={room.mapData.mapWidth}\n                            mapHeight={room.mapData.mapHeight}\n                            tileSize={32}\n                            tileMapData={room.mapData.tileMapData || []}\n                            objectMapData={room.mapData.objectMapData || []}\n                            secretMapData={room.mapData.secretMapData || []}\n                            objectMetadata={room.mapData.objectMetadata || {}}\n                            registryItems={registryItems}\n                            backgroundColor={room.mapData.selectedBackgroundColor}\n                            backgroundImage={room.mapData.selectedBackgroundImage}\n                            backgroundParallaxFactor={room.mapData.backgroundParallaxFactor}\n                            isEditor={true}\n                            mapType={room.mapData.type || 'room'}\n                        />\n                    </div>\n                ))}\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * 32, height: mapHeight * 32,\n                        backgroundImage: (selectedBackgroundUrl && showBackgroundImage && !isEraserActive) ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: (isEraserActive || !showBackgroundImage || !selectedBackgroundUrl) ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x', backgroundSize: 'auto 100%',\n                        zIndex: 0, pointerEvents: 'none'\n                    }}\n                />\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * 32, height: mapHeight * 32,\n                        backgroundColor: getOverlayColor(),\n                        zIndex: 5, pointerEvents: 'none',\n                        transition: 'background-color 0.3s ease'\n                    }}\n                />\n\n                {/* Top Grid Overlay */}\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * 32, height: mapHeight * 32,\n                        zIndex: 10, pointerEvents: 'none',\n                        ...getGridStyles()\n                    }}\n                />\n\n                {/* Weather Effects Overlay */}\n                {(weatherRain > 0 || weatherSnow > 0 || weatherClouds > 0 || weatherFog > 0 || weatherThunder > 0 || weatherLavaRain > 0 || weatherRadioactiveFog > 0 || weatherMeteorRain > 0) && (\n                    <div\n                        style={{\n                            position: 'absolute', top: 0, left: 0,\n                            width: mapWidth * 32, height: mapHeight * 32,\n                            zIndex: 15, pointerEvents: 'none',\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={[]}\n                            objectMapData={[]}\n                            registryItems={registryItems}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            renderLayers={['weather']}\n                            pointerEvents=\"none\"\n                        />\n                    </div>\n                )}\n\n                <div className=\"grid\"\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px', border: '1px solid #444', backgroundColor: 'transparent',\n                        position: 'relative', cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        let dTileId = tileMapData[index];\n                        let dObjId = objectMapData[index];\n                        let dSecId = secretMapData?.[index];\n\n                        if (selection && previewPosition) {\n                            const { w, h } = selection;\n                            const px = previewPosition.x;\n                            const py = previewPosition.y;\n                            if (x >= px && x < px + w && y >= py && y < py + h) {\n                                const idx = (y - py) * w + (x - px);\n                                dTileId = selection.tileData[idx];\n                                dObjId = selection.objectData[idx];\n                                dSecId = selection.secretData?.[idx];\n                            }\n                        }\n\n                        const tileObj = dTileId ? registryItems.find(r => r.id === dTileId) : null;\n                        const objObj = dObjId ? registryItems.find(r => r.id === dObjId) : null;\n                        const secretObj = dSecId ? registryItems.find(r => r.id === dSecId) : null;\n\n                        let borderStyle = 'none';\n                        let bgStyle = 'transparent';\n\n                        const layerColor = getLayerColor(activeLayer, 1);\n\n                        if (activeTool === 'brush' && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) {\n                                borderStyle = `1px dashed ${layerColor}`;\n                                if (isEraserActive) bgStyle = 'rgba(255, 0, 0, 0.1)';\n                            }\n                        } else if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                            else if (hoverIndex === index) borderStyle = '2px solid orange';\n                        } else if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid blue';\n                        } else if (activeTool === 'area') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { \n                                    borderStyle = '1px dashed gold'; \n                                    bgStyle = 'rgba(255, 255, 0, 0.2)'; \n                                }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid gold';\n                        }\n\n                        if (highlightedIndex === index) { borderStyle = '3px solid gold'; bgStyle = 'rgba(255, 215, 0, 0.4)'; }\n                        \n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                borderStyle = '2px solid cyan'; bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red'; bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n\n                        const parentRegion = regions.find(r => x >= r.x && x < r.x + r.w && y >= r.y && y < r.y + r.h);\n\n                        return (\n                            <EditorTile \n                                key={index}\n                                index={index}\n                                x={x} y={y}\n                                activeTool={activeTool}\n                                tileObj={tileObj}\n                                objObj={objObj}\n                                secretObj={secretObj}\n                                objectMetadata={objectMetadata}\n                                isHighlighted={highlightedIndex === index || (parentRegion && highlightedIndex === parentRegion.idx)}\n                                parentRegionIndex={parentRegion ? parentRegion.idx : null}\n                                borderStyle={borderStyle}\n                                bgStyle={bgStyle}\n                                handleGridMouseDown={handleGridMouseDown}\n                                handleGridMouseEnter={handleGridMouseEnter}\n                                handleResizeStart={handleResizeStart}\n                                handleMoveStart={handleMoveStart}\n                                filter={getLayerFilter}\n                                mapType={mapType}\n                                isRoomAreaVisible={isRoomAreaVisible}\n                                showRoomMapContent={showRoomMapContent}\n                                showMessages={showMessages}\n                            />\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const EditorToolsContainer = styled.div`\n    display: contents;\n`;\n\nexport const HeaderBar = styled.div`\n    padding: 0 15px;\n    background-color: #222;\n    border-bottom: none;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 60px;\n    box-sizing: border-box;\n    color: #fff;\n    z-index: 1105;\n    position: relative;\n\n    &::after {\n        content: \"\";\n        position: absolute;\n        left: 60px;\n        right: 0;\n        bottom: 0;\n        height: 1px;\n        background-color: #000;\n        pointer-events: none;\n    }\n`;\n\nexport const ToolsSection = styled.div`\n    display: flex;\n    gap: 15px;\n    align-items: center;\n`;\n\nexport const ToolsGroup = styled.div`\n    display: flex;\n    gap: 10px;\n    align-items: center;\n`;\n\nexport const ToolsInnerGroup = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsRow = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsEditorButton = styled.button`\n    min-width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : (props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : (props.$variant === 'danger' ? '#dc3545' : (props.$variant === 'secondary' ? '#f0f0f0' : '#333'))))};\n    color: ${props => props.$variant === 'secondary' ? '#333' : '#fff'};\n    border: 1px solid ${props => props.$active ? '#1E88E5' : (props.$variant === 'play' ? '#388E3C' : (props.$variant === 'pause' ? '#F57C00' : (props.$variant === 'danger' ? '#c82333' : (props.$variant === 'secondary' ? '#ccc' : '#fff'))))};\n    border-radius: 4px;\n    font-size: ${props => props.$small ? '14px' : '20px'};\n    font-weight: ${props => props.$variant === 'play' || props.$variant === 'pause' ? 'bold' : 'normal'};\n    line-height: 1;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: ${props => props.$square ? '0' : '0 15px'};\n    width: ${props => props.$square ? '40px' : 'auto'};\n    outline: none;\n    user-select: none;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : (props.$variant === 'play' ? '#45a049' : (props.$variant === 'pause' ? '#fb8c00' : (props.$variant === 'danger' ? '#bd2130' : (props.$variant === 'secondary' ? '#e0e0e0' : '#444'))))};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n\n    span {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n`;\n\nexport const StrikeThrough = styled.div`\n    position: absolute;\n    width: 100%;\n    height: 2px;\n    background-color: #f5222d;\n    transform: rotate(-45deg);\n    top: 50%;\n    left: 0;\n    z-index: 2;\n    pointer-events: none;\n`;\n\nexport const LayerIndicator = styled.div`\n    padding: 0 12px;\n    height: 40px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    font-size: 11px;\n    font-weight: 800;\n    text-transform: uppercase;\n    margin-right: 15px;\n    margin-left: 15px;\n    white-space: nowrap;\n    border: 1px solid;\n    box-sizing: border-box;\n    background-color: ${props => props.$bgColor || '#e6f7ff'};\n    border-color: ${props => props.$borderColor || '#91d5ff'};\n    color: ${props => props.$textColor || '#1890ff'};\n`;\n\nexport const BgColorContainer = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n`;\n\nexport const BgColorInputWrapper = styled.div`\n    position: relative;\n    display: flex;\n    align-items: center;\n`;\n\nexport const BgColorInput = styled.input`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    opacity: ${props => props.disabled ? 0.4 : 1};\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n`;\n\nexport const BgTransparentButton = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &::after {\n        content: \"\";\n        width: 100%;\n        height: 100%;\n        background-image: \n            linear-gradient(45deg, #ccc 25%, transparent 25%), \n            linear-gradient(-45deg, #ccc 25%, transparent 25%), \n            linear-gradient(45deg, transparent 75%, #ccc 75%), \n            linear-gradient(-45deg, transparent 75%, #ccc 75%);\n        background-size: 8px 8px;\n        background-position: 0 0, 0 4px, 4px 4px, 4px 0;\n        background-color: #fff;\n        opacity: 0.8;\n        border-radius: 2px;\n    }\n`;\n\nexport const PlayButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const PlayButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : '#333')};\n    color: #fff;\n    font-size: 18px;\n    box-sizing: border-box;\n`;\n\nexport const InfoContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    align-items: flex-start;\n    color: #bbb;\n    margin-left: auto;\n`;\n\nexport const InfoItem = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nexport const InfoLabel = styled.span`\n    font-size: 11px;\n    text-transform: uppercase;\n    opacity: 0.8;\n`;\n\nexport const InfoValue = styled.span`\n    color: #fff;\n    font-size: 12px;\n`;\n\nexport const EraserButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    //cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const EraserButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$active ? (props.$textColor || '#1890ff') : (props.$bgColor || '#f0f0f0')};\n    color: ${props => props.$active ? '#fff' : (props.$textColor || '#000')};\n    font-size: 11px;\n    font-weight: bold;\n    border: ${props => props.$active ? '1px solid #fff' : 'none'};\n    box-sizing: border-box;\n`;\n\nexport const SelectionActions = styled.div`\n    display: flex;\n    gap: 5px;\n    margin-left: 5px;\n    border-left: 1px solid #ccc;\n    padding-left: 5px;\n`;\n\nexport const ConfirmButton = styled(ToolsEditorButton)`\n    background-color: #e6f7ff;\n    color: #1890ff;\n    \n    &:hover {\n        background-color: #bae7ff;\n    }\n`;\n\nexport const CancelButton = styled(ToolsEditorButton)`\n    background-color: #fff1f0;\n    color: #f5222d;\n\n    &:hover {\n        background-color: #ffccc7;\n    }\n`;\n\nexport const GridIcon = styled.span`\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n`;\n","import styled from 'styled-components';\n\n/*\n* Container*/\nexport const SidebarContainer = styled.div`\n    width: 60px;\n    height: 100%;\n    background-color: #222;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding-top: 10px;\n    z-index: 1100;\n    border-right: 1px solid #000;\n    flex-shrink: 0;\n    overflow-y: auto;\n\n    &::-webkit-scrollbar {\n        width: 0px;\n        background: transparent;\n    }\n    \n    -ms-overflow-style: none;\n    scrollbar-width: none;\n`;\n\nexport const ElementEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const PanelContainer = styled.div`\n    position: absolute;\n    left: 60px;\n    top: 60px;\n    width: 320px;\n    height: calc(100% - 60px);\n    background-color: #fff;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    z-index: 1090;\n    box-shadow: 4px 0 10px rgba(0,0,0,0.2);\n    \n    /* Animation settings */\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;\n    transform: ${props => props.$isOpen ? 'translateX(0)' : 'translateX(-110%)'};\n    opacity: ${props => props.$isOpen ? '1' : '0'};\n    pointer-events: ${props => props.$isOpen ? 'all' : 'none'};\n`;\n\nexport const PanelHeader = styled.div`\n    padding: 8px 15px;\n    background-color: #f0f0f0;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 32px;\n    box-sizing: border-box;\n    color: #333;\n\n    span {\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n`;\n\nexport const PanelBody = styled.div`\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n`;\n\nexport const CloseButton = styled.button`\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 16px;\n    padding: 0 5px;\n    color: #666;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    outline: none;\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nexport const OperationButton = styled.button`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: ${props => props.$danger ? '#d32f2f' : '#000'};\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n    outline: none;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n\n// Also exporting as a label for file input usage in OperationsPanel\nexport const OperationLabel = styled.label`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: #000;\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n","import React from 'react';\nimport { ToolsEditorButton } from '../styles/EditorToolsButton';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    tempMapDescription,\n    setTempMapDescription,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', borderRadius: '8px',\n                boxShadow: '0 8px 24px rgba(0,0,0,0.2)', width: '320px',\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\n            }}>\n                <div style={{\n                    padding: '12px 15px',\n                    borderBottom: '2px solid #eee',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                }}>\n                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 'bold', color: '#333' }}>Create New Map</h3>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </div>\n\n                <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Map Name:</label>\n                        <input\n                            type=\"text\"\n                            value={tempMapName}\n                            onChange={(e) => setTempMapName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Creator Nickname:</label>\n                        <input\n                            type=\"text\"\n                            value={tempCreatorName}\n                            onChange={(e) => setTempCreatorName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Description:</label>\n                        <textarea\n                            value={tempMapDescription}\n                            onChange={(e) => setTempMapDescription(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box', minHeight: '60px', resize: 'vertical' }}\n                        />\n                    </div>\n\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                        <ToolsEditorButton onClick={onClose} $variant=\"secondary\" $small>\n                            Cancel\n                        </ToolsEditorButton>\n                        <ToolsEditorButton onClick={() => confirmNewMap(tempMapName, tempCreatorName, tempMapDescription)} $variant=\"play\" $small>\n                            Create\n                        </ToolsEditorButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { BUILT_IN_MAPS } from '../../../../constants/builtInMaps';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalHeader = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    font-size: 24px;\n    color: #333;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nexport const BuiltInMapsModal = ({ isOpen, onClose, onSelect }) => {\n    if (!isOpen) return null;\n\n    return (\n        <ModalOverlay onClick={onClose}>\n            <ModalContent onClick={e => e.stopPropagation()}>\n                <ModalHeader>\n                    <ModalTitle>Select a Built-in Map to Edit</ModalTitle>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </ModalHeader>\n                \n                <MapList>\n                    {BUILT_IN_MAPS.map((map, index) => {\n                        const isV2 = map.meta?.version === \"2.0\";\n                        const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                        const author = map.meta?.author || \"Unknown\";\n                        const description = map.meta?.description || \"\";\n                        \n                        let sizeInfo = \"\";\n                        let subMapInfo = \"\";\n\n                        if (isV2 && map.maps) {\n                            const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                            if (mainMap) {\n                                sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                            }\n                            \n                            const mapValues = Object.values(map.maps);\n                            const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                            const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                            \n                            subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                        } else {\n                            sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                        }\n\n                        return (\n                            <MapCard key={index} onClick={() => {\n                                onSelect(map);\n                                onClose();\n                            }}>\n                                <div>\n                                    <MapTitle>{projectName}</MapTitle>\n                                    <MapAuthor>By: {author}</MapAuthor>\n                                </div>\n                                {description && (\n                                    <MapDescription title={description}>\n                                        {description}\n                                    </MapDescription>\n                                )}\n                                <MapInfo>\n                                    <div>Size: {sizeInfo}{subMapInfo}</div>\n                                </MapInfo>\n                            </MapCard>\n                        );\n                    })}\n                </MapList>\n            </ModalContent>\n        </ModalOverlay>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\n\nlet topZIndex = 1002;\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const [position] = useState(defaultPosition);\n    const [zIndex, setZIndex] = useState(() => {\n        topZIndex += 1;\n        return topZIndex;\n    });\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    const lastHeightRef = useRef(0);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            if (height !== lastHeightRef.current) {\n                lastHeightRef.current = height;\n                onHeightChange(height);\n            }\n        }\n    });\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            topZIndex += 1;\n            setZIndex(topZIndex);\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#fff',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n                zIndex: zIndex,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh',\n                overflow: 'hidden'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '12px 15px',\n                    backgroundColor: '#fff',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '18px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '2px solid #eee',\n                    color: '#333'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0,\n                            color: '#333'\n                        }}\n                        title={isMinimized ? \"Maximize\" : \"Minimize\"}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            color: '#333',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title=\"Close\"\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '15px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\n\nexport const EditorMapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(5, Math.min(100, startSize.width + blocksX));\n            const newHeight = Math.max(5, Math.min(100, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                Map Size: <span style={{ color: '#4CAF50' }}>{mapWidth}  {mapHeight}</span> blocks\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: -5,\n                        right: -5,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 Drag the corner to resize the map<br/>\n                (Min: 55, Max: 100100)\n            </div>\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundColor\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = backgroundColor || '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.lava_waterfall) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.radioactive_waterfall) {\n                                ctx.fillStyle = '#32cd32';\n                            } else if (tile.flags.waterfall) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.water) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.quicksand) {\n                                ctx.fillStyle = '#a6915b';\n                            } else if (tile.flags.radioactive_water) {\n                                ctx.fillStyle = '#32cd32';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n        // Draw connections between portals and targets\n        if (objectMetadata) {\n            const portals = [];\n            const targets = [];\n\n            for (let i = 0; i < mapWidth * mapHeight; i++) {\n                const id = objectMapData[i];\n                if (!id) continue;\n                const metadata = objectMetadata[i];\n                if (!metadata || metadata.triggerId === null || metadata.triggerId === undefined) continue;\n\n                const pos = {\n                    x: (i % mapWidth) * tileWidth + tileWidth / 2,\n                    y: Math.floor(i / mapWidth) * tileHeight + tileHeight / 2\n                };\n\n                if (id.includes('portal') && !id.includes('target')) {\n                    portals.push({ triggerId: metadata.triggerId, pos });\n                } else if (id.includes('target') || id === 'portal_target') {\n                    targets.push({ triggerId: metadata.triggerId, pos });\n                }\n            }\n\n            portals.forEach(portal => {\n                const target = targets.find(t => t.triggerId === portal.triggerId);\n                if (target) {\n                    ctx.beginPath();\n                    ctx.setLineDash([5, 3]);\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.moveTo(portal.pos.x, portal.pos.y);\n                    ctx.lineTo(target.pos.x, target.pos.y);\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n                }\n            });\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, objectMetadata, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useRef, useEffect, useMemo, useCallback } from 'react';\n\nexport const WorldView = ({\n    maps,\n    activeMapId,\n    switchMap,\n    registryItems,\n    currentMapData,\n    createMap,\n    deleteMap,\n    updateMapData,\n    onAddRoomArea,\n    showRoomMapContent\n}) => {\n    const canvasRef = useRef(null);\n    const containerRef = useRef(null);\n    const mapLayoutsRef = useRef({});\n    const dragRef = useRef(null); // { id, startX, startY, mapStartX, mapStartY }\n\n    // Prepare all maps data, using live data for the active map\n    const allMaps = useMemo(() => {\n        const result = { ...maps };\n        if (currentMapData && currentMapData.id && result[currentMapData.id]) {\n            result[currentMapData.id] = {\n                ...result[currentMapData.id],\n                mapWidth: currentMapData.mapWidth,\n                mapHeight: currentMapData.mapHeight,\n                tileMapData: currentMapData.tileMapData,\n                objectMapData: currentMapData.objectMapData,\n                objectMetadata: currentMapData.objectMetadata,\n                selectedBackgroundColor: currentMapData.selectedBackgroundColor\n            };\n        }\n        return Object.values(result);\n    }, [maps, currentMapData]);\n\n    // Draw function\n    const draw = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        \n        // Settings\n        const baseTileSize = 4; // Each tile in world view\n        \n        // Sync mapLayoutsRef with allMaps, but preserve positions for maps being dragged\n        const layouts = mapLayoutsRef.current;\n        \n        // Remove layouts for deleted maps\n        const currentIds = new Set(allMaps.map(m => m.id));\n        Object.keys(layouts).forEach(id => {\n            if (!currentIds.has(id)) {\n                delete layouts[id];\n            }\n        });\n\n        allMaps.forEach(map => {\n            const isDragging = dragRef.current && dragRef.current.id === map.id;\n            const w = map.mapWidth * baseTileSize;\n            const h = map.mapHeight * baseTileSize;\n\n            if (!layouts[map.id]) {\n                layouts[map.id] = { x: map.worldX || 0, y: map.worldY || 0, w, h, map };\n            } else {\n                layouts[map.id].w = w;\n                layouts[map.id].h = h;\n                layouts[map.id].map = map;\n                // Update position from props ONLY if not currently dragging this map\n                if (!isDragging) {\n                    layouts[map.id].x = map.worldX || 0;\n                    layouts[map.id].y = map.worldY || 0;\n                }\n            }\n        });\n\n        // Clear\n        ctx.fillStyle = '#222';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Grid (optional but helpful)\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 1;\n        for (let x = 0; x < canvas.width; x += 50) {\n            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();\n        }\n        for (let y = 0; y < canvas.height; y += 50) {\n            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();\n        }\n\n        // 1. Draw Maps\n        Object.values(layouts).forEach(layout => {\n            const { x, y, w, h, map } = layout;\n            const tileW = w / map.mapWidth;\n            const tileH = h / map.mapHeight;\n\n            // Background\n            ctx.fillStyle = map.selectedBackgroundColor || '#87CEEB';\n            ctx.fillRect(x, y, w, h);\n\n            // Active indicator\n            if (map.id === activeMapId) {\n                ctx.strokeStyle = '#e3de0a';\n                ctx.lineWidth = 3;\n                ctx.strokeRect(x - 4, y - 4, w + 8, h + 8);\n            } else {\n                ctx.strokeStyle = '#555';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, w, h);\n            }\n\n            // Name\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px Arial';\n            ctx.fillText(map.name, x, y - 10);\n            ctx.font = '10px Arial';\n            ctx.fillStyle = '#aaa';\n            ctx.fillText(map.type, x, y + h + 12);\n\n            // Delete button (X)\n            if (map.id !== 'main') {\n                ctx.fillStyle = '#ff4d4f';\n                ctx.fillRect(x + w - 15, y - 25, 15, 15);\n                ctx.fillStyle = '#fff';\n                ctx.font = 'bold 12px Arial';\n                ctx.fillText('', x + w - 11, y - 13);\n            }\n\n            // Draw Tiles & Objects (simplified)\n            for (let i = 0; i < map.mapWidth * map.mapHeight; i++) {\n                const tx = (i % map.mapWidth) * tileW + x;\n                const ty = Math.floor(i / map.mapWidth) * tileH + y;\n\n                const tileId = map.tileMapData[i];\n                const objId = map.objectMapData[i];\n                const secretId = map.secretMapData ? map.secretMapData[i] : null;\n                const meta = map.objectMetadata ? map.objectMetadata[i] : null;\n\n                // If it's a room area and we want to show content\n                if (showRoomMapContent && secretId === 'room_area' && meta?.linkedMapId && layouts[meta.linkedMapId]) {\n                    const roomMap = layouts[meta.linkedMapId].map;\n                    const rW = meta.width || 1;\n                    const rH = meta.height || 1;\n                    const rAreaW = rW * tileW;\n                    const rAreaH = rH * tileH;\n                    const rTileW = rAreaW / roomMap.mapWidth;\n                    const rTileH = rAreaH / roomMap.mapHeight;\n\n                    // Room Background\n                    ctx.fillStyle = roomMap.selectedBackgroundColor || '#1a1a1a';\n                    ctx.fillRect(tx, ty, rAreaW, rAreaH);\n                    \n                    // Room Tiles (very simplified)\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n                    for (let ri = 0; ri < roomMap.mapWidth * roomMap.mapHeight; ri++) {\n                        if (roomMap.tileMapData[ri]) {\n                            ctx.fillRect(\n                                tx + (ri % roomMap.mapWidth) * rTileW,\n                                ty + Math.floor(ri / roomMap.mapWidth) * rTileH,\n                                Math.ceil(rTileW), Math.ceil(rTileH)\n                            );\n                        }\n                    }\n                    \n                    // Room Border\n                    ctx.strokeStyle = '#f39c12';\n                    ctx.lineWidth = 0.5;\n                    ctx.strokeRect(tx, ty, rAreaW, rAreaH);\n                } else {\n                    if (tileId) {\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (objId) {\n                        if (objId.includes('portal') && !objId.includes('target')) {\n                            ctx.fillStyle = '#007bff';\n                        } else if (objId.includes('target') || objId === 'portal_target') {\n                            ctx.fillStyle = '#ffc107';\n                        } else {\n                            ctx.fillStyle = '#dc3545';\n                        }\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (secretId === 'room_area') {\n                        ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                        ctx.strokeStyle = 'gold';\n                        ctx.lineWidth = 1;\n                        ctx.strokeRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                    }\n                }\n            }\n        });\n\n        // 2. Draw Connections\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 2;\n\n        Object.values(layouts).forEach(sourceLayout => {\n            const { map: sourceMap, x: sx, y: sy, w: sw, h: sh } = sourceLayout;\n            const tileW = sw / sourceMap.mapWidth;\n            const tileH = sh / sourceMap.mapHeight;\n\n            const metadata = sourceMap.objectMetadata || {};\n            \n            for (let i = 0; i < sourceMap.mapWidth * sourceMap.mapHeight; i++) {\n                const objId = sourceMap.objectMapData[i];\n                if (!objId) continue;\n                \n                const meta = metadata[i];\n                if (!meta) continue;\n\n                // Identify if this is a connection source\n                const isPortalSource = objId.includes('portal') && !objId.includes('target');\n                const objDef = registryItems.find(r => r.id === objId);\n                const isDoorSource = objDef && objDef.subtype === 'door';\n\n                if (!isPortalSource && !isDoorSource) continue;\n\n                // For portals we match by triggerId, for doors by spawnTriggerId\n                const linkId = isPortalSource ? meta.triggerId : meta.spawnTriggerId;\n                if (linkId === null || linkId === undefined) continue;\n\n                const targetMapId = meta.targetMapId || sourceMap.id;\n                const targetLayout = layouts[targetMapId];\n\n                if (targetLayout) {\n                    const { map: targetMap, x: tx, y: ty, w: tw, h: th } = targetLayout;\n                    const tTileW = tw / targetMap.mapWidth;\n                    const tTileH = th / targetMap.mapHeight;\n\n                    // Find target object in target map\n                    for (let j = 0; j < targetMap.mapWidth * targetMap.mapHeight; j++) {\n                        const tObjId = targetMap.objectMapData[j];\n                        if (!tObjId) continue;\n\n                        const tObjDef = registryItems.find(r => r.id === tObjId);\n                        const isTarget = tObjId.includes('target') || tObjId === 'portal_target';\n                        const isDoorTarget = tObjDef && tObjDef.subtype === 'door';\n\n                        if (!isTarget && !isDoorTarget) continue;\n\n                        const tMeta = targetMap.objectMetadata?.[j];\n                        if (tMeta && tMeta.triggerId === linkId) {\n                            // Link found!\n                            const startX = sx + (i % sourceMap.mapWidth) * tileW + tileW / 2;\n                            const startY = sy + Math.floor(i / sourceMap.mapWidth) * tileH + tileH / 2;\n                            const endX = tx + (j % targetMap.mapWidth) * tTileW + tTileW / 2;\n                            const endY = ty + Math.floor(j / targetMap.mapWidth) * tTileH + tTileH / 2;\n\n                            // Draw line\n                            ctx.beginPath();\n                            ctx.strokeStyle = (sourceMap.id === targetMap.id) ? '#fff' : '#00ff00';\n                            ctx.moveTo(startX, startY);\n                            \n                            if (sourceMap.id !== targetMap.id) {\n                                // Calculate mid points for a nicer curve\n                                const cp1X = startX + (endX - startX) * 0.25;\n                                const cp1Y = Math.min(startY, endY) - 100;\n                                const cp2X = startX + (endX - startX) * 0.75;\n                                const cp2Y = Math.min(startY, endY) - 100;\n                                ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, endX, endY);\n                            } else {\n                                ctx.lineTo(endX, endY);\n                            }\n                            ctx.stroke();\n\n                            // Arrow head\n                            const angle = Math.atan2(endY - startY, endX - startX);\n                            ctx.save();\n                            ctx.setLineDash([]);\n                            ctx.translate(endX, endY);\n                            ctx.rotate(angle);\n                            ctx.beginPath();\n                            ctx.moveTo(0, 0);\n                            ctx.lineTo(-10, -5);\n                            ctx.lineTo(-10, 5);\n                            ctx.closePath();\n                            ctx.fillStyle = ctx.strokeStyle;\n                            ctx.fill();\n                            ctx.restore();\n                            \n                            break;\n                        }\n                    }\n                }\n            }\n        });\n    }, [allMaps, activeMapId, showRoomMapContent]);\n\n    useEffect(() => {\n        draw();\n    }, [allMaps, activeMapId, draw, showRoomMapContent]);\n\n    const handleMouseDown = (e) => {\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const layouts = Object.values(mapLayoutsRef.current || {});\n        \n        // Check for delete button first\n        for (const layout of layouts) {\n            if (layout.map.id !== 'main') {\n                const btnX = layout.x + layout.w - 15;\n                const btnY = layout.y - 25;\n                if (x >= btnX && x <= btnX + 15 && y >= btnY && y <= btnY + 15) {\n                    if (window.confirm(`Delete map \"${layout.map.name}\"?`)) {\n                        deleteMap(layout.map.id);\n                    }\n                    return;\n                }\n            }\n        }\n\n        // Check for map drag/select\n        for (const layout of layouts) {\n            if (x >= layout.x && x <= layout.x + layout.w &&\n                y >= layout.y && y <= layout.y + layout.h) {\n                \n                if (e.detail === 2) { // Double click to switch\n                    switchMap(layout.map.id);\n                } else {\n                    dragRef.current = {\n                        id: layout.map.id,\n                        startX: x,\n                        startY: y,\n                        mapStartX: layout.x,\n                        mapStartY: layout.y\n                    };\n                }\n                return;\n            }\n        }\n    };\n\n    const handleMouseMove = (e) => {\n        if (!dragRef.current) return;\n\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const dx = x - dragRef.current.startX;\n        const dy = y - dragRef.current.startY;\n\n        const newX = Math.max(0, dragRef.current.mapStartX + dx);\n        const newY = Math.max(0, dragRef.current.mapStartY + dy);\n\n        // Update local layout for immediate visual feedback\n        if (mapLayoutsRef.current[dragRef.current.id]) {\n            mapLayoutsRef.current[dragRef.current.id].x = newX;\n            mapLayoutsRef.current[dragRef.current.id].y = newY;\n            draw();\n        }\n    };\n\n    const handleMouseUp = (e) => {\n        if (!dragRef.current) return;\n\n        const layout = mapLayoutsRef.current[dragRef.current.id];\n        if (layout) {\n            updateMapData(dragRef.current.id, {\n                worldX: layout.x,\n                worldY: layout.y\n            });\n        }\n        \n        dragRef.current = null;\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '10px' }}>\n            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n                <button \n                    onClick={() => createMap('overworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + Overworld\n                </button>\n                <button \n                    onClick={() => createMap('underworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#5D4037', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + Underworld\n                </button>\n                <button \n                    onClick={onAddRoomArea}\n                    title=\"Mark Room Area on Map\"\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#f39c12', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + m<sup>2</sup>\n                </button>\n                <div style={{ marginLeft: 'auto', color: '#ccc', fontSize: '11px' }}>\n                    Double-click map to select. Drag to move.\n                </div>\n            </div>\n\n            <div ref={containerRef} style={{ width: '100%', height: '500px', backgroundColor: '#333', overflow: 'auto', borderRadius: '4px', position: 'relative', border: '1px solid #555' }}>\n                <canvas\n                    ref={canvasRef}\n                    width={2000}\n                    height={2000}\n                    style={{ display: 'block', cursor: dragRef.current ? 'grabbing' : 'grab' }}\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseLeave={handleMouseUp}\n                />\n                <div style={{ position: 'absolute', bottom: '10px', right: '10px', backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '5px 10px', borderRadius: '4px', fontSize: '11px', pointerEvents: 'none' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#fff', border: '1px dashed #fff' }}></div> Intra-map teleport</div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#00ff00', border: '1px dashed #00ff00' }}></div> Inter-map teleport</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\n\nexport const BackgroundPanel = ({ \n    backgroundOptions, \n    selectedBackgroundImage, \n    setSelectedBackgroundImage, \n    selectedBackgroundColor, \n    backgroundParallaxFactor, \n    setBackgroundParallaxFactor \n}) => {\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '12px' }}>Background Image</span>\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>\n                    <div onClick={() => setSelectedBackgroundImage(null)}\n                        style={{\n                            border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #2196F3',\n                            borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                            boxShadow: !selectedBackgroundImage ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                        }}\n                        title=\"Solid Color\">\n                        <div style={{ width: '100%', height: '60px', background: selectedBackgroundColor, display: 'block', borderRadius: '4px' }} />\n                        <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: !selectedBackgroundImage ? 'bold' : 'normal' }}>Solid Color</div>\n                    </div>\n                    {backgroundOptions.map((bg) => (\n                        <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                            style={{\n                                border: selectedBackgroundImage === bg.metaPath ? '2px solid #2196F3' : '1px solid #ccc',\n                                borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                boxShadow: selectedBackgroundImage === bg.metaPath ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                            }}\n                            title={bg.name}>\n                            <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '60px', objectFit: 'cover', display: 'block', borderRadius: '4px' }} />\n                            <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: selectedBackgroundImage === bg.metaPath ? 'bold' : 'normal' }}>{bg.name}</div>\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            <section style={{ backgroundColor: '#f9f9f9', padding: '15px', borderRadius: '8px', border: '1px solid #ddd' }}>\n                <div style={{ marginBottom: '0px' }}>\n                    <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>Parallax Effect:</label>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                            onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))}\n                            style={{ flex: 1 }} />\n                        <span style={{ fontSize: '13px', fontWeight: 'bold', minWidth: '35px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                    </div>\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nexport const MusicPanel = ({ \n    musicOptions, \n    selectedBackgroundMusic, \n    setSelectedBackgroundMusic \n}) => {\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>Background Music</span>\n                <select\n                    value={selectedBackgroundMusic || ''}\n                    onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                    style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ccc', fontSize: '13px', marginBottom: '10px' }}>\n                    <option value=\"\"> No Music </option>\n                    {musicOptions.map(m => (\n                        <option key={m.name} value={m.metaPath}>{m.name}</option>\n                    ))}\n                </select>\n                <div style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\n                    Status: {selectedBackgroundMusic ? 'Music selected' : 'Silence'}\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\n\nexport const WeatherPanel = ({\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain\n}) => {\n    const weatherItems = [\n        { label: 'Rain', value: weatherRain, setter: setWeatherRain, icon: '' },\n        { label: 'Lava Rain', value: weatherLavaRain, setter: setWeatherLavaRain, icon: '' },\n        { label: 'Snow', value: weatherSnow, setter: setWeatherSnow, icon: '' },\n        { label: 'Meteor Rain', value: weatherMeteorRain, setter: setWeatherMeteorRain, icon: '' },\n        { label: 'Clouds', value: weatherClouds, setter: setWeatherClouds, icon: '' },\n        { label: 'Fog', value: weatherFog, setter: setWeatherFog, icon: '' },\n        { label: 'Radio Fog', value: weatherRadioactiveFog, setter: setWeatherRadioactiveFog, icon: '' },\n        { label: 'Thunder', value: weatherThunder, setter: setWeatherThunder, icon: '' },\n    ];\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px', padding: '5px' }}>\n            {weatherItems.map((item) => (\n                <div key={item.label} style={{ \n                    backgroundColor: '#f9f9f9', \n                    padding: '12px', \n                    borderRadius: '8px', \n                    border: '1px solid #ddd' \n                }}>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\n                        <span style={{ fontSize: '13px', fontWeight: 'bold' }}>\n                            {item.icon} {item.label}\n                        </span>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', color: '#2196F3' }}>\n                            {item.value}%\n                        </span>\n                    </div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input \n                            type=\"range\" \n                            min=\"0\" \n                            max=\"100\" \n                            step=\"1\" \n                            value={item.value}\n                            onChange={(e) => item.setter(parseInt(e.target.value))}\n                            style={{ flex: 1, cursor: 'pointer' }} \n                        />\n                    </div>\n                </div>\n            ))}\n            <div style={{ fontSize: '11px', color: '#888', fontStyle: 'italic', textAlign: 'center', marginTop: '5px' }}>\n                Weather effects will be visible in Play mode\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const SceneEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const RightSidebarContainer = styled.div`\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    z-index: 1100;\n`;\n","import React, { useState } from 'react';\nimport { DraggableWindow } from './editorScene/DraggableWindow';\nimport { EditorMapResizer } from './editorScene/EditorMapResizer';\nimport { Minimap } from './editorScene/Minimap';\nimport { WorldView } from './editorScene/WorldView';\nimport { BackgroundPanel } from './editorScene/BackgroundPanel';\nimport { MusicPanel } from './editorScene/MusicPanel';\nimport { WeatherPanel } from './editorScene/WeatherPanel';\nimport { SceneEditorButton, RightSidebarContainer } from './styles/EditorSceneButtonStyle';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\n\nexport const EditorScene = ({\n    handleMapResize,\n    isResizeWindowOpen,\n    setIsResizeWindowOpen,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain,\n    // New props for multi-map\n    maps,\n    activeMapId,\n    switchMap,\n    createMap,\n    deleteMap,\n    updateMapData,\n    isWorldViewOpen,\n    setIsWorldViewOpen,\n    onAddRoomArea,\n    showRoomMapContent,\n    activeRoomIds\n}) => {\n    const [isMinimapOpen, setIsMinimapOpen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isBackgroundOpen, setIsBackgroundOpen] = useState(false);\n    const [isMusicOpen, setIsMusicOpen] = useState(false);\n\n    return (\n        <div style={{ display: 'contents' }}>\n            <BackgroundMusicPlayer \n                metaPath={selectedBackgroundMusic} \n                enabled={true} \n                volume={0.4} \n                isInsideRoom={activeRoomIds?.length > 0}\n            />\n            {/* Right side buttons */}\n            <RightSidebarContainer>\n                <SceneEditorButton onClick={() => setIsMinimapOpen(!isMinimapOpen)} $active={isMinimapOpen} title=\"Maps & Minimap\"></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsWorldViewOpen(!isWorldViewOpen)} $active={isWorldViewOpen} title=\"Project World View\"></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsBackgroundOpen(!isBackgroundOpen)} $active={isBackgroundOpen} title=\"Background\"></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsMusicOpen(!isMusicOpen)} $active={isMusicOpen} title=\"Music\">\n                    <span style={{ color: '#fff' }}></span>\n                </SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsSettingsOpen(!isSettingsOpen)} $active={isSettingsOpen} title=\"Settings\"></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} $active={isResizeWindowOpen} title=\"Resize Map\"></SceneEditorButton>\n            </RightSidebarContainer>\n\n            {/* Floating Windows */}\n            {isMinimapOpen && (\n                <DraggableWindow\n                    title=\"Active Map Minimap\"\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsMinimapOpen(false)}\n                >\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '5px' }}>\n                        <Minimap\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            backgroundColor={selectedBackgroundColor}\n                        />\n                        <div style={{ fontSize: '12px', color: '#ccc', textAlign: 'center' }}>\n                            {maps[activeMapId]?.name || 'Current Map'}\n                        </div>\n                    </div>\n                </DraggableWindow>\n            )}\n\n            {isWorldViewOpen && (\n                <DraggableWindow\n                    title=\"Project World View\"\n                    defaultPosition={{ x: 100, y: 100 }}\n                    defaultWidth={800}\n                    isOpenDefault={true}\n                    onClose={() => setIsWorldViewOpen(false)}\n                >\n                    <WorldView \n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        registryItems={registryItems}\n                        createMap={createMap}\n                        deleteMap={deleteMap}\n                        updateMapData={updateMapData}\n                        onAddRoomArea={onAddRoomArea}\n                        showRoomMapContent={showRoomMapContent}\n                        // Current map live data\n                        currentMapData={{\n                            id: activeMapId,\n                            mapWidth,\n                            mapHeight,\n                            tileMapData,\n                            objectMapData,\n                            objectMetadata,\n                            selectedBackgroundColor\n                        }}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isBackgroundOpen && (\n                <DraggableWindow\n                    title=\"Background\"\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsBackgroundOpen(false)}\n                >\n                    <BackgroundPanel \n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isMusicOpen && (\n                <DraggableWindow\n                    title=\"Music\"\n                    defaultPosition={{ x: window.innerWidth - 340, y: 300 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsMusicOpen(false)}\n                >\n                    <MusicPanel \n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isSettingsOpen && (\n                <DraggableWindow\n                    title=\"Settings\"\n                    defaultPosition={{ x: window.innerWidth - 340, y: 400 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsSettingsOpen(false)}\n                >\n                    <WeatherPanel \n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title=\"Resize Map\"\n                    defaultPosition={{ x: 400, y: 100 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsResizeWindowOpen(false)}\n                >\n                    <EditorMapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={handleMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { OperationButton, OperationLabel } from '../styles/EditorElementsButtonStyle';\n\nexport const OperationsPanel = ({ \n    openNewMapModal, \n    saveMap, \n    loadMap, \n    openBuiltInModal,\n    clearMap, \n    mapName, \n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription\n}) => {\n    const inputStyle = {\n        width: '100%',\n        border: '1px solid transparent',\n        background: 'transparent',\n        padding: '4px 6px',\n        fontSize: '13px',\n        fontWeight: 'bold',\n        outline: 'none',\n        borderRadius: '4px',\n        boxSizing: 'border-box',\n        transition: 'all 0.2s ease',\n        cursor: 'pointer'\n    };\n\n    const handleFocus = (e) => {\n        e.target.style.borderColor = '#2196F3';\n        e.target.style.backgroundColor = '#fff';\n        e.target.style.cursor = 'text';\n    };\n\n    const handleBlur = (e) => {\n        e.target.style.borderColor = 'transparent';\n        e.target.style.backgroundColor = 'transparent';\n        e.target.style.cursor = 'pointer';\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\n            <div style={{ \n                padding: '15px', \n                backgroundColor: '#f9f9f9', \n                borderRadius: '8px', \n                border: '1px solid #ddd', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px' \n            }}>\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\n                    <OperationButton onClick={openNewMapModal} title=\"New Map\">\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>New</span>\n                    </OperationButton>\n                    <OperationButton onClick={saveMap} title=\"Save Map\">\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>Save</span>\n                    </OperationButton>\n                    <OperationLabel title=\"Load Map\">\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>Load</span>\n                        <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} />\n                    </OperationLabel>\n                    <OperationButton onClick={openBuiltInModal} title=\"Built-in Maps\">\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>Built-in</span>\n                    </OperationButton>\n                    <OperationButton onClick={clearMap} $danger title=\"Clear Map\">\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>Clear</span>\n                    </OperationButton>\n                </div>\n            </div>\n\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>MAP NAME</label>\n                    <input \n                        value={mapName} \n                        onChange={(e) => setMapName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title=\"Click to edit map name\"\n                    />\n                </div>\n                \n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>AUTHOR</label>\n                    <input \n                        value={creatorName} \n                        onChange={(e) => setCreatorName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title=\"Click to edit author\"\n                    />\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>DESCRIPTION</label>\n                    <textarea \n                        value={mapDescription} \n                        onChange={(e) => setMapDescription(e.target.value)}\n                        style={{ ...inputStyle, fontWeight: 'normal', minHeight: '60px', resize: 'vertical' }}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title=\"Click to edit description\"\n                    />\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const CollapsiblePanel = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '4px 6px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none', lineHeight: 1.1, minHeight: '20px' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React from 'react';\nimport { CollapsiblePanel } from './CollapsiblePanel';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\n\nexport const PalettePanel = ({ \n    isPlayMode, \n    category,\n    blocks, \n    liquids, \n    entities, \n    decorations, \n    items, \n    interactables, \n    hazards, \n    secrets, \n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    handlePaletteSelect, \n    selectedTile \n}) => {\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const editorIcon = item.editorIcon;\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isQuicksand = !!(item.flags && item.flags.quicksand);\n        const isWaterfall = !!(item.flags && item.flags.waterfall);\n        const isLavaWaterfall = !!(item.flags && item.flags.lava_waterfall);\n        const isRadioactive = !!(item.flags && item.flags.radioactive);\n        const isRadioactiveWaterfall = !!(item.flags && item.flags.radioactive_waterfall);\n        const isSecret = item.type === 'secret';\n        const isWeatherTrigger = item.type === 'weather_trigger';\n        const isMessageTrigger = item.type === 'message_trigger';\n        \n        const swatchStyle = isLavaWaterfall\n            ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isWater || isWaterfall ? { background: 'linear-gradient(180deg,#3a7fb8,#5ba3d9)' }\n            : (isQuicksand ? { background: 'linear-gradient(180deg,#a6915b,#7d6d42)' }\n            : (isRadioactive || isRadioactiveWaterfall ? { background: 'linear-gradient(180deg,#1a5c1a,#32cd32)' }\n            : { background: '#eee' }))));\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.displayName || item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColorInEditor || item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.editorIcon || (item.subtype === 'above' ? 'ABOVE' : 'BELOW')}\n                    </div>\n                ) : (isWeatherTrigger || isMessageTrigger) ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: isMessageTrigger ? '#fff9c4' : '#f0f4f8', \n                        border: isMessageTrigger ? '1px solid #fbc02d' : '1px solid #d1d9e6',\n                        color: '#333', fontSize: '18px'\n                    }}>\n                        {item.editorIcon}\n                    </div>\n                ) : editorIcon ? (\n                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>\n                        {editorIcon}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        spriteSheet={item.spriteSheet}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid ? (isLavaWaterfall ? 'L.FALL' : (isLava ? 'LAVA' : (isRadioactiveWaterfall ? 'RADFALL' : (isRadioactive ? 'RAD' : (isWater ? 'WATER' : (isWaterfall ? 'FALL' : (isQuicksand ? 'QUICK' : 'LIQ'))))))) : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    if (isPlayMode) {\n        return (\n            <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                Palette disabled during Play mode\n            </div>\n        );\n    }\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            {category === 'blocks' && (() => {\n                const getBlockGroup = (b) => {\n                    if (b.editor?.group) return b.editor.group;\n                    const name = (b.id || b.name || '').toLowerCase();\n                    if (name.includes('brick')) return 'bricks';\n                    if (name.includes('diorite') || name.includes('stone')) return 'stone';\n                    if (name.includes('metal')) return 'metal';\n                    if (name.includes('wood')) return 'wood';\n                    return 'ground';\n                };\n\n                const groupOrder = [\n                    { key: 'ground', title: 'Ground', color: 'blue', open: true },\n                    { key: 'bricks', title: 'Bricks', color: 'blue', open: true },\n                    { key: 'stone', title: 'Stone', color: 'blue', open: true },\n                    { key: 'metal', title: 'Metal', color: 'blue', open: true },\n                    { key: 'wood', title: 'Wood', color: 'blue', open: true }\n                ];\n\n                const withGroups = blocks.map(b => ({\n                    item: b,\n                    group: getBlockGroup(b)\n                }));\n\n                const sortBlocks = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(b => b.group === group.key).sort(sortBlocks);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(b => renderPaletteItem(b.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(b => !groupOrder.some(g => g.key === b.group)).sort(sortBlocks);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title=\"Other\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(b => renderPaletteItem(b.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'liquids' && (() => {\n                const getLiquidGroup = (li) => {\n                    if (li.editor?.group) return li.editor.group;\n                    if (li.flags?.quicksand) return 'quicksand';\n                    if (li.flags?.lava || li.flags?.lava_waterfall) return 'lava';\n                    if (li.flags?.radioactive || li.flags?.radioactive_waterfall) return 'radiation';\n                    if (li.flags?.water || li.flags?.waterfall) return 'water';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'quicksand', title: 'Quicksand', color: 'goldenrod', open: true },\n                    { key: 'water', title: 'Water', color: 'blue', open: true },\n                    { key: 'lava', title: 'Lava', color: 'orange', open: true },\n                    { key: 'radiation', title: 'Radiation', color: 'green', open: true }\n                ];\n\n                const withGroups = liquids.map(li => ({\n                    item: li,\n                    group: getLiquidGroup(li)\n                }));\n\n                const sortLiquids = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(li => li.group === group.key).sort(sortLiquids);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(li => renderPaletteItem(li.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(li => !groupOrder.some(g => g.key === li.group)).sort(sortLiquids);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title=\"Liquids support JSON overrides: liquid.overlay {color,alpha} and liquid.resources {oxygen,lavaResist,iceResist,strength,radioactivity,health} with enabled flags.\"\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             Liquid JSON overrides available (hover for details)\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title=\"Other\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(li => renderPaletteItem(li.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'decorations' && (\n                <CollapsiblePanel title=\"Decorations\" isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {decorations && decorations.map(d => renderPaletteItem(d, 'purple', 'object'))}\n                    </div>\n                </CollapsiblePanel>\n            )}\n\n            {category === 'entities' && (() => {\n                const getEntityGroup = (e) => {\n                    if (e.editor?.group) return e.editor.group;\n                    const name = (e.id || e.name || '').toLowerCase();\n                    if (name.includes('player')) return 'player';\n                    return 'enemies';\n                };\n\n                const groupOrder = [\n                    { key: 'player', title: 'Player', color: 'red', open: true },\n                    { key: 'enemies', title: 'Enemies', color: 'red', open: true }\n                ];\n\n                const withGroups = entities.map(e => ({\n                    item: e,\n                    group: getEntityGroup(e)\n                }));\n\n                const sortEntities = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(e => e.group === group.key).sort(sortEntities);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(e => renderPaletteItem(e.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(e => !groupOrder.some(g => g.key === e.group)).sort(sortEntities);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title=\"Entities use editor metadata: editor.panel 'entities' and editor.group 'player' or 'enemies'.\"\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             Entities grouping is data-driven (hover for details)\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title=\"Other\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(e => renderPaletteItem(e.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'items' && (() => {\n                const getItemGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.effect?.health) return 'health';\n                    if (i.effect?.fireball) return 'ammunition';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'health', title: 'Health', color: 'green', open: true },\n                    { key: 'ammunition', title: 'Ammunition', color: 'green', open: true }\n                ];\n\n                const withGroups = items.map(i => ({\n                    item: i,\n                    group: getItemGroup(i)\n                }));\n\n                const sortItems = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(i => i.group === group.key).sort(sortItems);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortItems);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title=\"Items use editor metadata: editor.panel 'items' and editor.group 'health' or 'ammunition'.\"\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             Items grouping is data-driven (hover for details)\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title=\"Other\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'interactables' && (() => {\n                const getInteractableGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.subtype === 'door') return 'entrances';\n                    if (i.subtype === 'platform' || i.subtype === 'arrow') return 'platforms';\n                    if ((i.id || '').includes('portal') || (i.name || '').includes('portal')) return 'ports';\n                    if (i.subtype === 'end') return 'ends';\n                    const name = (i.id || i.name || '').toLowerCase();\n                    if (name.includes('berry')) return 'harvestables';\n                    if (name.includes('stone') || name.includes('wooden_box')) return 'physics';\n                    if (name.includes('ice')) return 'blocks';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'harvestables', title: 'Harvestables', color: 'purple', open: true },\n                    { key: 'physics', title: 'Physic', color: 'purple', open: true },\n                    { key: 'entrances', title: 'Entrences', color: 'purple', open: true },\n                    { key: 'platforms', title: 'Platforms', color: 'purple', open: true },\n                    { key: 'ports', title: 'Ports', color: 'purple', open: true },\n                    { key: 'blocks', title: 'Blocks', color: 'purple', open: true },\n                    { key: 'ends', title: 'Ends', color: 'purple', open: true }\n                ];\n\n                const withGroups = interactables.map(i => ({\n                    item: i,\n                    group: getInteractableGroup(i)\n                }));\n\n                const sortInteractables = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(i => i.group === group.key).sort(sortInteractables);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortInteractables);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title=\"Other\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'hazards' && (() => {\n                const getHazardGroup = (h) => {\n                    if (h.editor?.group) return h.editor.group;\n                    if (h.collision) return 'blocks';\n                    return 'obstacles';\n                };\n\n                const groupOrder = [\n                    { key: 'blocks', title: 'Hazards (Blocks)', color: 'orange', open: true },\n                    { key: 'obstacles', title: 'Hazards (Obstacles)', color: 'brown', open: true }\n                ];\n\n                const withGroups = hazards.map(h => ({\n                    item: h,\n                    group: getHazardGroup(h)\n                }));\n\n                const sortHazards = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(h => h.group === group.key).sort(sortHazards);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(h => renderPaletteItem(h.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(h => !groupOrder.some(g => g.key === h.group)).sort(sortHazards);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title=\"Hazards (Other)\" isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(h => renderPaletteItem(h.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'secrets' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title=\"Open Area\" isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'open').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n                    \n                    <CollapsiblePanel title=\"Secret Area\" isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype !== 'open' && s.subtype !== 'room').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Crackable Wall\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {crackableWalls && crackableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Pushable Wall\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {pushableWalls && pushableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'weather' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title=\"Rain\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'rain').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Snow\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'snow').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Clouds\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'clouds').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Fog\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'fog').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Thunder\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'thunder').map(w => renderPaletteItem(w, 'blue', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Lava Rain\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'lavaRain').map(w => renderPaletteItem(w, 'red', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Radio Fog\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'radioactiveFog').map(w => renderPaletteItem(w, 'green', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title=\"Meteor Rain\" isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'meteorRain').map(w => renderPaletteItem(w, 'orange', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'messages' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title=\"Messages\" isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {messages && messages.map(m => renderPaletteItem(m, 'gold', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'obstacles' && (\n                <CollapsiblePanel title=\"Obstacles\" isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {obstacles && obstacles.length > 0 ? (\n                            obstacles.map(o => renderPaletteItem(o, 'brown', 'object'))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                No obstacles available yet\n                            </div>\n                        )}\n                    </div>\n                </CollapsiblePanel>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\n\nexport const StatisticsPanel = ({ \n    totalTiles, \n    mapWidth, \n    mapHeight, \n    filledBlocks, \n    objectsCount, \n    emptyBlocks \n}) => {\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n            <div style={{ padding: '15px', backgroundColor: '#e6f7ff', borderRadius: '8px', border: '1px solid #91d5ff' }}>\n                <div style={{ fontSize: '14px', marginBottom: '8px' }}>Total Map Area: <strong>{totalTiles}</strong> tiles</div>\n                <div style={{ fontSize: '13px', color: '#0050b3' }}>Dimensions: {mapWidth} x {mapHeight}</div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#f6ffed', borderRadius: '8px', border: '1px solid #b7eb8f', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#389e0d' }}>{filledBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>FILLED BLOCKS</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#fff7e6', borderRadius: '8px', border: '1px solid #ffd591', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#d46b08' }}>{objectsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>OBJECTS</div>\n                </div>\n            </div>\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#666' }}>{emptyBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>EMPTY SPACE</div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\n\nexport const ObjectPropsPanel = ({ \n    objectMapData, \n    secretMapData,\n    registryItems, \n    mapWidth, \n    objectMetadata, \n    highlightedIndex, \n    setHighlightedIndex, \n    setObjectMetadata,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const mapType = maps[activeMapId]?.type || 'overworld';\n    const mapList = Object.values(maps || {});\n    const listRef = React.useRef(null);\n\n    // Auto-scroll to highlighted item\n    React.useEffect(() => {\n        if (highlightedIndex !== null && listRef.current) {\n            const highlightedElement = listRef.current.querySelector(`[data-index=\"${highlightedIndex}\"]`);\n            if (highlightedElement) {\n                highlightedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n        }\n    }, [highlightedIndex]);\n\n    return (\n        <div style={{ padding: '0' }}>\n            <p style={{ fontSize: '12px', color: '#666', lineHeight: '1.4' }}>\n                Configure triggers for Portals, Targets, Weather and Messages.\n                <br />\n                <strong>1.</strong> Place a <strong>Portal</strong>, <strong>Target</strong>, <strong>Weather</strong> or <strong>Message Trigger</strong> from the palette.\n                <br />\n                <strong>2.</strong> Configure <strong>Trigger ID</strong> for links, <strong>Intensity</strong> for weather or <strong>Message Text</strong>.\n            </p>\n            <div ref={listRef} style={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}>\n                {Array.from({ length: objectMapData.length }).map((_, index) => {\n                    const objId = objectMapData[index];\n                    const secretId = secretMapData ? secretMapData[index] : null;\n                    \n                    if (!objId && !secretId) return null;\n\n                    const objDef = objId ? registryItems.find(r => r.id === objId) : null;\n                    const secretDef = secretId ? registryItems.find(r => r.id === secretId) : null;\n                    \n                    const isWeather = objDef && objDef.type === 'weather_trigger';\n                    const isMessage = objDef && objDef.type === 'message_trigger';\n                    const isPortalOrTarget = objId && (objId.includes('portal') || objId.includes('target') || objId === 'portal_target');\n                    const isDoor = objDef && objDef.subtype === 'door';\n                    const isRoomArea = secretDef && secretDef.subtype === 'room' && mapType !== 'room';\n\n                    if (!isPortalOrTarget && !isWeather && !isMessage && !isRoomArea && !isDoor) return null;\n\n                    const def = objDef || secretDef;\n                    const id = objId || secretId;\n\n                    const x = index % mapWidth;\n                    const y = Math.floor(index / mapWidth);\n                    const metadata = objectMetadata[index] || {};\n                    const isHighlighted = highlightedIndex === index;\n\n                    return (\n                        <div key={index} \n                            data-index={index}\n                            onMouseEnter={() => setHighlightedIndex(index)}\n                            onMouseLeave={() => setHighlightedIndex(null)}\n                            style={{\n                                padding: '10px',\n                                border: isHighlighted ? '1px solid gold' : '1px solid #eee',\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '5px',\n                                backgroundColor: isHighlighted ? '#fffde7' : '#f9f9f9',\n                                marginBottom: '5px',\n                                borderRadius: '4px',\n                                transition: 'all 0.2s ease'\n                            }}\n                        >\n                            <div style={{ fontWeight: 'bold', fontSize: '13px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                                <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    {isRoomArea ? '' : ((isWeather || isMessage) ? def.editorIcon : (id.includes('portal') && !id.includes('target') ? '' : ''))} {def.displayName || def.name}\n                                </span>\n                                <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                    <span style={{ color: '#666', fontSize: '11px' }}>({x}, {y})</span>\n                                    <button \n                                        onClick={() => {\n                                            const el = document.querySelector(`.viewport`);\n                                            if (el) {\n                                                const scrollX = x * 32 - el.clientWidth / 2 + 16;\n                                                const scrollY = y * 32 - el.clientHeight / 2 + 16;\n                                                el.scrollTo({ left: scrollX, top: scrollY, behavior: 'smooth' });\n                                            }\n                                        }}\n                                        style={{ \n                                            padding: '2px 6px', fontSize: '10px', cursor: 'pointer',\n                                            backgroundColor: '#eee', border: '1px solid #ccc', borderRadius: '3px'\n                                        }}\n                                        title=\"Scroll to this object\"\n                                    >\n                                        Locate\n                                    </button>\n                                </div>\n                            </div>\n\n                            {isRoomArea && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Room Name:</label>\n                                        <input\n                                            type=\"text\"\n                                            value={metadata.roomName || ''}\n                                            placeholder=\"Enter house name\"\n                                            onChange={(e) => {\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], roomName: e.target.value }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                            }}\n                                        />\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Size:</label>\n                                        <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.width || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], width: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                            <span>x</span>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.height || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], height: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                        </div>\n                                    </div>\n                                    {metadata.linkedMapId ? (\n                                        <div style={{ fontSize: '11px', color: 'green' }}>\n                                            Linked to Map ID: {metadata.linkedMapId}\n                                        </div>\n                                    ) : (\n                                        <button\n                                            onClick={() => {\n                                                if (createMap) {\n                                                    const mapId = createMap('room', metadata.roomName || 'Room Area', metadata.width || 1, metadata.height || 1);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], linkedMapId: mapId }\n                                                    }));\n                                                }\n                                            }}\n                                            style={{\n                                                padding: '6px',\n                                                backgroundColor: '#4CAF50',\n                                                color: 'white',\n                                                border: 'none',\n                                                borderRadius: '4px',\n                                                cursor: 'pointer',\n                                                fontWeight: 'bold'\n                                            }}\n                                        >\n                                            Confirm\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n\n                            {(!isWeather && !isMessage && !isRoomArea) && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Trigger ID:</label>\n                                    <input\n                                        type=\"number\"\n                                        value={metadata.triggerId || ''}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], triggerId: isNaN(val) ? null : val }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                        placeholder=\"Enter ID (e.g. 1)\"\n                                    />\n                                </div>\n                            )}\n\n                            {isWeather && def.hasIntensity && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Intensity (%):</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        max=\"100\"\n                                        value={metadata.intensity !== undefined ? metadata.intensity : 50}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], intensity: isNaN(val) ? 0 : Math.min(100, Math.max(0, val)) }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    />\n                                </div>\n                            )}\n\n                            {isMessage && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Message Text:</label>\n                                    <textarea\n                                        value={metadata.message || ''}\n                                        onChange={(e) => {\n                                            const val = e.target.value;\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], message: val }\n                                            }));\n                                        }}\n                                        rows={3}\n                                        style={{\n                                            width: '100%',\n                                            padding: '6px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0',\n                                            resize: 'vertical',\n                                            fontFamily: 'inherit'\n                                        }}\n                                        placeholder=\"Enter message to display...\"\n                                    />\n                                </div>\n                            )}\n\n                            {( (id.includes('portal') && !id.includes('target')) || isDoor ) && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px', marginTop: '5px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Target Map:</label>\n                                        <select\n                                            value={metadata.targetMapId || ''}\n                                            onChange={(e) => {\n                                                const val = e.target.value;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], targetMapId: val === '' ? null : val }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        >\n                                            <option value=\"\">Current Map</option>\n                                            {mapList.map(m => (\n                                                <option key={m.id} value={m.id}>{m.name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Spawn ID:</label>\n                                        <input\n                                            type=\"number\"\n                                            value={metadata.spawnTriggerId !== undefined ? metadata.spawnTriggerId : ''}\n                                            onChange={(e) => {\n                                                const val = parseInt(e.target.value);\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], spawnTriggerId: isNaN(val) ? null : val }\n                                                }));\n                                            }}\n                                            placeholder=\"Trigger ID to spawn at\"\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        />\n                                    </div>\n                                    {isDoor && (\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                            <label style={{ fontSize: '12px', fontWeight: 'bold' }}>Delay (s):</label>\n                                            <input\n                                                type=\"number\"\n                                                step=\"0.1\"\n                                                value={metadata.delaySeconds !== undefined ? metadata.delaySeconds : (objDef.interaction?.delaySeconds || 0.5)}\n                                                onChange={(e) => {\n                                                    const val = parseFloat(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], delaySeconds: isNaN(val) ? 0.5 : val }\n                                                    }));\n                                                }}\n                                                style={{\n                                                    flex: 1,\n                                                    padding: '4px 8px',\n                                                    border: '1px solid #ccc',\n                                                    borderRadius: '4px',\n                                                    fontSize: '13px',\n                                                    backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                                }}\n                                            />\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                            {/* Size Configuration */}\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px', paddingTop: '5px', borderTop: '1px solid #eee' }}>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>W:</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.width || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], width: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>H:</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.height || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], height: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <span style={{ fontSize: '10px', color: '#999' }}>Drag handles on map to resize</span>\n                            </div>\n                        </div>\n                    );\n                })}\n                {objectMapData.filter(id => {\n                    if (!id) return false;\n                    const def = registryItems.find(r => r.id === id);\n                    const isWeather = def && def.type === 'weather_trigger';\n                    const isMessage = def && def.type === 'message_trigger';\n                    const isPortalOrTarget = id.includes('portal') || id.includes('target') || id === 'portal_target';\n                    return isPortalOrTarget || isWeather || isMessage;\n                }).length === 0 && (\n                    <p style={{ textAlign: 'center', color: '#999', marginTop: '20px', fontSize: '14px' }}>\n                        No configurable objects found on map.\n                    </p>\n                )}\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { \n    SidebarContainer,\n    ElementEditorButton,\n    PanelContainer,\n    PanelHeader,\n    PanelBody,\n    CloseButton\n} from './styles/EditorElementsButtonStyle';\n\n// Panels\nimport { OperationsPanel } from './editorElements/OperationsPanel';\nimport { PalettePanel } from './editorElements/PalettePanel';\nimport { StatisticsPanel } from './editorElements/StatisticsPanel';\nimport { ObjectPropsPanel } from './editorElements/ObjectPropsPanel';\n\nexport const EditorElements = ({\n    mapName,\n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    openNewMapModal,\n    openBuiltInModal,\n    saveMap,\n    loadMap,\n    clearMap,\n    isPlayMode,\n    handlePaletteSelect,\n    selectedTile,\n    blocks,\n    liquids,\n    entities,\n    items,\n    decorations,\n    interactables,\n    hazards,\n    secrets,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    setObjectMetadata,\n    registryItems,\n    highlightedIndex,\n    setHighlightedIndex,\n    activePanel,\n    setActivePanel,\n    togglePanel,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const [lastPanel, setLastPanel] = React.useState(null);\n    const [pinnedPanel, setPinnedPanel] = React.useState(null);\n    const hoverTimerRef = React.useRef(null);\n\n    React.useEffect(() => {\n        if (activePanel) {\n            setLastPanel(activePanel);\n        }\n    }, [activePanel]);\n\n    const displayPanel = activePanel || lastPanel;\n\n    const clearHoverTimer = () => {\n        if (hoverTimerRef.current) {\n            clearTimeout(hoverTimerRef.current);\n            hoverTimerRef.current = null;\n        }\n    };\n\n    const handleIconClick = (panel) => {\n        clearHoverTimer();\n        if (pinnedPanel === panel) {\n            setPinnedPanel(null);\n            setActivePanel(null);\n            return;\n        }\n        setPinnedPanel(panel);\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseEnter = (panel) => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        hoverTimerRef.current = setTimeout(() => {\n            setActivePanel(null);\n        }, 120);\n    };\n\n    const handlePanelMouseEnter = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n    };\n\n    const handlePanelMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(null);\n    };\n\n    const panelTitles = {\n        map: 'Operations',\n        blocks: 'Blocks',\n        liquids: 'Liquids (Blocks)',\n        decorations: 'Decorations',\n        entities: 'Entities',\n        items: 'Items',\n        interactables: 'Interactables',\n        hazards: 'Hazards',\n        secrets: 'Sectors',\n        weather: 'Weather',\n        messages: 'Messages',\n        obstacles: 'Obstacles',\n        stats: 'Statistics',\n        props: 'Object Properties'\n    };\n\n    return (\n        <div style={{ display: 'flex', height: '100%', position: 'relative', zIndex: 1001 }}>\n            {/* Sidebar Left Icons */}\n            <SidebarContainer>\n                <ElementEditorButton onClick={() => handleIconClick('map')} onMouseEnter={() => handleIconMouseEnter('map')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'map'} title=\"Map Controls\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('blocks')} onMouseEnter={() => handleIconMouseEnter('blocks')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'blocks'} title=\"Blocks\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('liquids')} onMouseEnter={() => handleIconMouseEnter('liquids')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'liquids'} title=\"Liquids\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('decorations')} onMouseEnter={() => handleIconMouseEnter('decorations')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'decorations'} title=\"Decorations\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('obstacles')} onMouseEnter={() => handleIconMouseEnter('obstacles')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'obstacles'} title=\"Obstacles\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('items')} onMouseEnter={() => handleIconMouseEnter('items')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'items'} title=\"Items\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('entities')} onMouseEnter={() => handleIconMouseEnter('entities')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'entities'} title=\"Entities\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('interactables')} onMouseEnter={() => handleIconMouseEnter('interactables')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'interactables'} title=\"Interactables\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('hazards')} onMouseEnter={() => handleIconMouseEnter('hazards')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'hazards'} title=\"Hazards\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('secrets')} onMouseEnter={() => handleIconMouseEnter('secrets')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'secrets'} title=\"Sectors\">2</ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('weather')} onMouseEnter={() => handleIconMouseEnter('weather')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'weather'} title=\"Weather\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('messages')} onMouseEnter={() => handleIconMouseEnter('messages')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'messages'} title=\"Messages\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('stats')} onMouseEnter={() => handleIconMouseEnter('stats')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'stats'} title=\"Statistics\"></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('props')} onMouseEnter={() => handleIconMouseEnter('props')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'props'} title=\"Object Properties\"></ElementEditorButton>\n            </SidebarContainer>\n\n            {/* Sidebar Fixed Panel Content */}\n            <PanelContainer $isOpen={!!activePanel} onMouseEnter={handlePanelMouseEnter} onMouseLeave={handlePanelMouseLeave}>\n                {displayPanel && (\n                    <>\n                        {/* Panel Header */}\n                        <PanelHeader>\n                            <span>{panelTitles[displayPanel]}</span>\n                            <CloseButton onClick={() => { setPinnedPanel(null); setActivePanel(null); }}></CloseButton>\n                        </PanelHeader>\n\n                        {/* Panel Body */}\n                        <PanelBody>\n                            {displayPanel === 'map' && (\n                                <OperationsPanel \n                                    openNewMapModal={openNewMapModal}\n                                    openBuiltInModal={openBuiltInModal}\n                                    saveMap={saveMap}\n                                    loadMap={loadMap}\n                                    clearMap={clearMap}\n                                    mapName={mapName}\n                                    creatorName={creatorName}\n                                    mapDescription={mapDescription}\n                                    setMapName={setMapName}\n                                    setCreatorName={setCreatorName}\n                                    setMapDescription={setMapDescription}\n                                />\n                            )}\n\n                            {(displayPanel === 'blocks' || \n                              displayPanel === 'liquids' || \n                              displayPanel === 'decorations' || \n                              displayPanel === 'entities' || \n                              displayPanel === 'items' || \n                              displayPanel === 'interactables' || \n                              displayPanel === 'hazards' || \n                              displayPanel === 'secrets' ||\n                              displayPanel === 'weather' ||\n                              displayPanel === 'messages' ||\n                              displayPanel === 'obstacles') && (\n                                <PalettePanel \n                                    isPlayMode={isPlayMode}\n                                    category={displayPanel}\n                                    blocks={blocks}\n                                    liquids={liquids}\n                                    entities={entities}\n                                    decorations={decorations}\n                                    items={items}\n                                    interactables={interactables}\n                                    hazards={hazards}\n                                    secrets={secrets}\n                                    weather={weather}\n                                    messages={messages}\n                                    crackableWalls={crackableWalls}\n                                    pushableWalls={pushableWalls}\n                                    obstacles={obstacles}\n                                    handlePaletteSelect={handlePaletteSelect}\n                                    selectedTile={selectedTile}\n                                />\n                            )}\n\n\n                            {displayPanel === 'stats' && (\n                                <StatisticsPanel \n                                    totalTiles={totalTiles}\n                                    mapWidth={mapWidth}\n                                    mapHeight={mapHeight}\n                                    filledBlocks={filledBlocks}\n                                    objectsCount={objectsCount}\n                                    emptyBlocks={emptyBlocks}\n                                />\n                            )}\n\n                            {displayPanel === 'props' && (\n                                <ObjectPropsPanel \n                                    objectMapData={objectMapData}\n                                    secretMapData={secretMapData}\n                                    registryItems={registryItems}\n                                    mapWidth={mapWidth}\n                                    objectMetadata={objectMetadata}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    setObjectMetadata={setObjectMetadata}\n                                    maps={maps}\n                                    activeMapId={activeMapId}\n                                    createMap={createMap}\n                                />\n                            )}\n                        </PanelBody>\n                    </>\n                )}\n            </PanelContainer>\n        </div>\n    );\n};\n","import React from 'react';\nimport { \n    EditorToolsContainer,\n    HeaderBar,\n    ToolsSection,\n    ToolsGroup,\n    ToolsInnerGroup,\n    ToolsRow,\n    ToolsEditorButton,\n    StrikeThrough,\n    LayerIndicator,\n    BgColorContainer,\n    BgColorInputWrapper,\n    BgColorInput,\n    BgTransparentButton,\n    PlayButtonContainer,\n    PlayButtonInner,\n    InfoContainer,\n    InfoItem,\n    InfoLabel,\n    InfoValue,\n    EraserButtonContainer,\n    EraserButtonInner,\n    SelectionActions,\n    ConfirmButton,\n    CancelButton,\n    GridIcon\n} from './styles/EditorToolsButton';\n\nexport const EditorTools = (props) => {\n    const {\n        mapName, \n        creatorName, \n        activePanel, \n        togglePanel,\n        showGrid, \n        setShowGrid,\n        isPlayMode,\n        handlePlay,\n        handlePause,\n        handleReset,\n        activeTool,\n        setActiveTool,\n        brushSize,\n        setBrushSize,\n        activeLayer,\n        selection,\n        moveSelection,\n        selectionMode,\n        setSelectionMode,\n        commitSelection,\n        cancelSelection,\n        selectedTile,\n        handlePaletteSelect,\n        selectedBackgroundColor,\n        setSelectedBackgroundColor,\n        showBackgroundImage,\n        setShowBackgroundImage,\n        showMessages,\n        setShowMessages,\n        isRoomAreaVisible,\n        setIsRoomAreaVisible,\n        showRoomMapContent,\n        setShowRoomMapContent\n    } = props;\n    const getEraserData = (layer) => {\n        const isActive = selectedTile === null && activeLayer === layer;\n        const colors = {\n            tile: { bg: '#e6f7ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', text: '#722ed1' },\n            props: { bg: '#fffbe6', text: '#faad14' }\n        };\n        const active = colors[layer] || colors.tile;\n        return {\n            isActive,\n            bgColor: active.bg,\n            textColor: active.text\n        };\n    };\n\n    const getLayerIndicatorData = () => {\n        const colors = {\n            tile: { bg: '#e6f7ff', border: '#91d5ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', border: '#ffa39e', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', border: '#d3adf7', text: '#722ed1' },\n            props: { bg: '#fffbe6', border: '#ffe58f', text: '#faad14' }\n        };\n        const active = colors[activeLayer] || colors.tile;\n        return {\n            $bgColor: active.bg,\n            $borderColor: active.border,\n            $textColor: active.text\n        };\n    };\n\n    return (\n        <EditorToolsContainer>\n            {/* Main Header Bar */}\n            <HeaderBar>\n                <ToolsSection>\n                    <ToolsGroup>\n\n                        {/* Brush - Bucket - Move - Area */}\n                        <ToolsRow>\n                            {[\n                                { id: 'brush', icon: '', title: 'Brush (B)' },\n                                { id: 'bucket', icon: '', title: 'Fill Bucket (F)' },\n                                { id: 'move', icon: '', title: 'Move Selection (M)' },\n                            ].map(tool => (\n                                <ToolsEditorButton\n                                    key={tool.id}\n                                    onClick={() => !isPlayMode && setActiveTool(tool.id)}\n                                    $active={activeTool === tool.id && !isPlayMode}\n                                    $square\n                                    $disabled={isPlayMode}\n                                    title={isPlayMode ? \"Disabled in Play Mode\" : tool.title}\n                                >\n                                    {tool.icon}\n                                    {isPlayMode && <StrikeThrough />}\n                                </ToolsEditorButton>\n                            ))}\n                        </ToolsRow>\n\n                        {/* Cut - Copy - Paste */}\n                        <ToolsInnerGroup>\n                            {['cut', 'copy'].map(mode => {\n                                const isDisabled = isPlayMode || activeTool !== 'move';\n                                return (\n                                    <ToolsEditorButton\n                                        key={mode}\n                                        onClick={() => !isDisabled && setSelectionMode(mode)}\n                                        $active={selectionMode === mode && !isDisabled}\n                                        $square\n                                        $disabled={isDisabled}\n                                        title={isPlayMode ? \"Disabled in Play Mode\" : (isDisabled ? `${mode === 'cut' ? 'Cut' : 'Copy'} (Only for Move tool)` : `${mode === 'cut' ? 'Cut' : 'Copy'} Selection`)}\n                                    >\n                                        {mode === 'cut' ? '' : ''}\n                                        {isDisabled && <StrikeThrough />}\n                                    </ToolsEditorButton>\n                                );\n                            })}\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && activeTool === 'move' && commitSelection()}\n                                $square\n                                $disabled={isPlayMode || activeTool !== 'move'}\n                                title={isPlayMode ? \"Disabled in Play Mode\" : (activeTool !== 'move' ? \"Paste (Only for Move tool)\" : \"Paste Selection\")}\n                            >\n                                \n                                {(isPlayMode || activeTool !== 'move') && <StrikeThrough />}\n                            </ToolsEditorButton>\n                            {selection && !isPlayMode && (\n                                <SelectionActions>\n                                    <ConfirmButton onClick={commitSelection} $square title=\"Confirm Selection (Enter)\"></ConfirmButton>\n                                    <CancelButton onClick={cancelSelection} $square title=\"Cancel Selection (Esc)\"></CancelButton>\n                                </SelectionActions>\n                            )}\n                        </ToolsInnerGroup>\n\n                        {/* Size */}\n                        <ToolsInnerGroup>\n                            {['I', 'II', 'III', 'IV', 'V'].map((roman, idx) => {\n                                const size = idx + 1;\n                                const isDisabled = isPlayMode || activeTool !== 'brush';\n                                return (\n                                    <ToolsEditorButton \n                                        key={size} \n                                        onClick={() => !isDisabled && setBrushSize(size)} \n                                        $active={brushSize === size && !isDisabled} \n                                        $square \n                                        $disabled={isDisabled}\n                                        title={isPlayMode ? \"Disabled in Play Mode\" : (isDisabled ? \"Brush size (Only for Brush tool)\" : `Brush Size ${size}`)}\n                                    >\n                                        {roman}\n                                        {isDisabled && <StrikeThrough />}\n                                    </ToolsEditorButton>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        {/* Background Immage */}\n                        <ToolsRow>\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && setShowBackgroundImage(!showBackgroundImage)}\n                                $active={showBackgroundImage && !isPlayMode}\n                                $square\n                                $disabled={isPlayMode}\n                                title={isPlayMode ? \"Disabled in Play Mode\" : (showBackgroundImage ? \"Hide Background Image\" : \"Show Background Image\")}\n                            >\n                                \n                                {isPlayMode && <StrikeThrough />}\n                            </ToolsEditorButton>\n\n                            {/* Grid */}\n                            <ToolsEditorButton\n                                onClick={() => setShowGrid(!showGrid)}\n                                $active={showGrid}\n                                $square\n                                title={showGrid ? \"Hide Grid Lines\" : \"Show Grid Lines\"}\n                            >\n                                <GridIcon>\n                                    {showGrid ? '' : ''}\n                                </GridIcon>\n                            </ToolsEditorButton>\n\n                            {/* Messages Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowMessages(!showMessages)}\n                                $active={showMessages}\n                                $square\n                                title={showMessages ? \"Hide Messages\" : \"Show Messages\"}\n                            >\n                                \n                            </ToolsEditorButton>\n\n                            {/* Room Area Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setIsRoomAreaVisible(!isRoomAreaVisible)}\n                                $active={isRoomAreaVisible}\n                                $square\n                                title={isRoomAreaVisible ? \"Hide Room Areas Overlay\" : \"Show Room Areas Overlay\"}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Room Map Content Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowRoomMapContent(!showRoomMapContent)}\n                                $active={showRoomMapContent}\n                                $square\n                                title={showRoomMapContent ? \"Hide Room Map Content\" : \"Show Room Map Content\"}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Background Color Picker */}\n                            <BgColorContainer>\n                                <BgColorInputWrapper>\n                                    <BgColorInput\n                                        type=\"color\"\n                                        value={selectedBackgroundColor && selectedBackgroundColor !== 'transparent' ? selectedBackgroundColor : '#000000'}\n                                        onChange={(e) => !isPlayMode && setSelectedBackgroundColor(e.target.value)}\n                                        title={isPlayMode ? \"Disabled in Play Mode\" : \"Background Color\"}\n                                        disabled={isPlayMode}\n                                    />\n                                    {isPlayMode && <StrikeThrough />}\n                                </BgColorInputWrapper>\n                                <BgTransparentButton \n                                    $active={selectedBackgroundColor === 'transparent'}\n                                    onClick={() => !isPlayMode && setSelectedBackgroundColor('transparent')}\n                                    title={isPlayMode ? \"Disabled in Play Mode\" : \"Transparent Background\"}\n                                />\n                            </BgColorContainer>\n                        </ToolsRow>\n\n\n\n                        {/* Active Layer Indicator */}\n                        <ToolsInnerGroup>\n                            <LayerIndicator {...getLayerIndicatorData()}>\n                                Layer: {activeLayer === 'tile' ? 'Blocks' : (activeLayer === 'object' ? 'Objects' : (activeLayer === 'secret' ? 'Sectors' : 'Properties'))}\n                            </LayerIndicator>\n                        </ToolsInnerGroup>\n\n                        {/* Layers: Block - Object - Sector - Props */}\n                        <ToolsInnerGroup>\n                            {['tile', 'object', 'secret', 'props'].map(layer => {\n                                const { isActive, bgColor, textColor } = getEraserData(layer);\n                                const isDisabled = isPlayMode;\n                                return (\n                                    <EraserButtonContainer\n                                        key={layer}\n                                        onClick={() => !isDisabled && handlePaletteSelect(null, layer)}\n                                        $active={isActive && !isDisabled}\n                                        $disabled={isDisabled}\n                                        title={isDisabled ? \"Disabled in Play Mode\" : `Erase ${layer === 'tile' ? 'Blocks' : (layer === 'object' ? 'Objects' : (layer === 'secret' ? 'Sectors' : 'Properties'))}`}\n                                    >\n                                        <EraserButtonInner $bgColor={bgColor} $textColor={textColor} $active={isActive && !isDisabled}>\n                                            {layer === 'tile' ? 'B' : (layer === 'object' ? 'O' : (layer === 'secret' ? 'S' : 'P'))}\n                                        </EraserButtonInner>\n                                        {isDisabled && <StrikeThrough />}\n                                    </EraserButtonContainer>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        <ToolsInnerGroup>\n                            <ToolsRow>\n                                <PlayButtonContainer onClick={isPlayMode ? handlePause : handlePlay} title={isPlayMode ? \"Pause/Editor\" : \"Play Map\"}>\n                                    <PlayButtonInner $variant={isPlayMode ? 'pause' : 'play'}>\n                                        <span>{isPlayMode ? '' : ''}</span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n\n                                <PlayButtonContainer onClick={handleReset} title=\"Reset State\">\n                                    <PlayButtonInner>\n                                        <span></span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n                            </ToolsRow>\n                        </ToolsInnerGroup>\n                    </ToolsGroup>\n                </ToolsSection>\n\n\n                <ToolsSection>\n                    <InfoContainer>\n                        <InfoItem>\n                            <InfoLabel>Map:</InfoLabel>\n                            <InfoValue>{mapName}</InfoValue>\n                        </InfoItem>\n                        <InfoItem>\n                            <InfoLabel>By:</InfoLabel>\n                            <InfoValue>{creatorName}</InfoValue>\n                        </InfoItem>\n                    </InfoContainer>\n                </ToolsSection>\n            </HeaderBar>\n        </EditorToolsContainer>\n    );\n};\n","import { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { TILE_SIZE } from '../../../../constants/gameConstants';\nimport { useGameEngine } from '../../../../utilities/useGameEngine';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../../engine/gameplay/secrets';\n\nconst EMPTY_ARRAY = [];\n\nexport const useEditorPlayMode = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n    selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n    registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    maps, activeMapId, switchMap, spawnTriggerId,\n    setTileMapData, updateMapData\n) => {\n    const [isPlayMode, setIsPlayMode] = useState(false);\n    const [isGameOver, setIsGameOver] = useState(false);\n    const [restartCounter, setRestartCounter] = useState(0);\n    const [editorSnapshot, setEditorSnapshot] = useState(null);\n    const [revealedSecrets, setRevealedSecrets] = useState([]);\n    const [activeRoomIds, setActiveRoomIds] = useState(new Set());\n    const [playModeObjectData, setPlayModeObjectData] = useState([]);\n    const [playModeSecretData, setPlayModeSecretData] = useState([]);\n    const [playModeWeather, setPlayModeWeather] = useState({\n        rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0,\n        lavaRain: 0, radioactiveFog: 0, meteorRain: 0\n    });\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n    const lastSyncedMapIdRef = useRef(null);\n    const isPlayModeRef = useRef(isPlayMode);\n\n    useEffect(() => {\n        isPlayModeRef.current = isPlayMode;\n    }, [isPlayMode]);\n\n    // Stability for engine initialization - only changes when map changes or play mode is toggled\n    const engineInitId = useMemo(() => {\n        return isPlayMode ? `${activeMapId}_${restartCounter}_${Date.now()}` : null;\n    }, [isPlayMode, activeMapId, restartCounter]);\n\n    // Derived data to ensure useGameEngine gets fresh data even before useEffect syncs state.\n    // This prevents the engine from using old map data during initialization.\n    const currentPlayObjectData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) {\n            const playData = [...objectMapData];\n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n            return playData;\n        }\n        return playModeObjectData;\n    }, [isPlayMode, activeMapId, playModeObjectData, objectMapData, spawnTriggerId, mapWidth, mapHeight]);\n\n    const currentPlaySecretData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) return [...secretMapData];\n        return playModeSecretData;\n    }, [isPlayMode, activeMapId, playModeSecretData, secretMapData]);\n\n    const mapDataForGame = useMemo(() => ({\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: TILE_SIZE,\n            activeMapId: activeMapId,\n            spawnTriggerId: spawnTriggerId,\n            backgroundImage: selectedBackgroundImage,\n            backgroundColor: selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            objectMetadata: objectMetadata,\n            activeRoomIds: Array.from(activeRoomIds),\n            date_map_last_updated: engineInitId, \n            weather: {\n                rain: isPlayMode ? playModeWeather.rain : weatherRain,\n                lavaRain: isPlayMode ? playModeWeather.lavaRain : weatherLavaRain,\n                snow: isPlayMode ? playModeWeather.snow : weatherSnow,\n                meteorRain: isPlayMode ? playModeWeather.meteorRain : weatherMeteorRain,\n                clouds: isPlayMode ? playModeWeather.clouds : weatherClouds,\n                fog: isPlayMode ? playModeWeather.fog : weatherFog,\n                radioactiveFog: isPlayMode ? playModeWeather.radioactiveFog : weatherRadioactiveFog,\n                thunder: isPlayMode ? playModeWeather.thunder : weatherThunder\n            }\n        },\n        maps: maps, // Project maps for inter-map teleports\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: currentPlayObjectData }\n        ]\n    }), [\n        mapWidth, mapHeight, activeMapId, spawnTriggerId, selectedBackgroundImage, selectedBackgroundColor, \n        backgroundParallaxFactor, tileMapData, currentPlayObjectData, objectMetadata, activeRoomIds,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playModeWeather,\n        isPlayMode, maps, engineInitId\n    ]);\n\n    // Synchronize play mode state when map changes (e.g., during inter-map teleport)\n    useEffect(() => {\n        if (isPlayMode && lastSyncedMapIdRef.current !== activeMapId) {\n            const playData = [...objectMapData];\n            \n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(playData);\n            setPlayModeSecretData([...secretMapData]);\n            setRevealedSecrets([]);\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    }, [activeMapId, isPlayMode, objectMapData, secretMapData, mapWidth, mapHeight, spawnTriggerId]);\n\n    const handleGameOver = useCallback(() => {\n        setIsGameOver(true);\n    }, []);\n\n    const handleReplay = useCallback(() => {\n        setIsGameOver(false);\n        setRestartCounter(prev => prev + 1);\n        setRevealedSecrets([]);\n        if (editorSnapshot) {\n            setPlayModeObjectData([...editorSnapshot.objectMapData]);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n        }\n    }, [editorSnapshot, setObjectMetadata]);\n\n    const handleStateUpdate = useCallback((newState, payload) => {\n        if (newState && typeof newState === 'object' && newState.x !== undefined && newState.y !== undefined) {\n            setPlayerPosition({ x: newState.x, y: newState.y });\n        } else if (newState === 'collectItem' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const newData = [...prev];\n                    newData[index] = null;\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newData = [...(maps[mapId].objectMapData || [])];\n                newData[index] = null;\n                updateMapData(mapId, { objectMapData: newData });\n            }\n        } else if (newState === 'interactable' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const currentId = prev[index];\n                    if (!currentId) return prev;\n                    const newData = [...prev];\n                    newData[index] = currentId + '_used';\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const currentId = maps[mapId].objectMapData?.[index];\n                if (currentId) {\n                    const newData = [...maps[mapId].objectMapData];\n                    newData[index] = currentId + '_used';\n                    updateMapData(mapId, { objectMapData: newData });\n                }\n            }\n        } else if (newState === 'setObjectFrame' && payload !== undefined) {\n            const { index, frame, mapId } = payload;\n            if (!mapId || mapId === activeMapId) {\n                setObjectMetadata(prev => ({\n                    ...prev,\n                    [index]: { ...prev[index], currentFrame: frame }\n                }));\n            } else if (updateMapData && maps[mapId]) {\n                const newMeta = { ...(maps[mapId].objectMetadata || {}) };\n                newMeta[index] = { ...(newMeta[index] || {}), currentFrame: frame };\n                updateMapData(mapId, { objectMetadata: newMeta });\n            }\n        } else if (newState === 'switchMap' && payload !== undefined) {\n            const { targetMapId, triggerId } = payload;\n            \n            // Check if target is a room\n            const targetMap = maps[targetMapId];\n            if (targetMap && targetMap.type === 'room') {\n                setActiveRoomIds(prev => {\n                    const next = new Set(prev);\n                    if (next.has(targetMapId)) next.delete(targetMapId);\n                    else next.add(targetMapId);\n                    return next;\n                });\n            } else if (targetMapId === 'main' && activeRoomIds.length > 0) {\n                setActiveRoomIds(new Set());\n            } else if (switchMap && targetMapId) {\n                // We keep play mode active when switching maps via teleport\n                switchMap(targetMapId, triggerId);\n            }\n        } else if (newState === 'objectDamage' && payload !== undefined) {\n            const { index, damage } = payload;\n            const objId = playModeObjectData[index];\n            const def = registryItems.find(r => r.id === objId);\n            if (!def) return;\n\n            setObjectMetadata(prev => {\n                const current = prev[index] || {};\n                const maxH = def.maxHealth || 100;\n                const newHealth = Math.max(0, (current.health !== undefined ? current.health : maxH) - damage);\n                \n                if (shouldRemoveCrackBlock(def, newHealth)) {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[index] = null;\n                            return newTiles;\n                        });\n                    }\n                }\n\n                return {\n                    ...prev,\n                    [index]: { ...current, health: newHealth }\n                };\n            });\n\n            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(index / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n            }));\n        } else if (newState === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (newState === 'shiftTile' && payload !== undefined) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapId;\n            \n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => playModeObjectData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[to] = newTiles[from];\n                            newTiles[from] = null;\n                            return newTiles;\n                        });\n                    }\n                },\n                moveObject: (from, to) => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[to] = newObjs[from];\n                        newObjs[from] = null;\n                        return newObjs;\n                    });\n                },\n                moveMetadata: (from, to) => {\n                    setObjectMetadata(prevMeta => {\n                        const newMeta = { ...prevMeta };\n                        if (newMeta[from]) {\n                            newMeta[to] = newMeta[from];\n                            delete newMeta[from];\n                        }\n                        return newMeta;\n                    });\n                },\n                removeObject: idx => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[idx] = null;\n                        return newObjs;\n                    });\n                },\n                shouldCancel: () => !isPlayModeRef.current || activeMapId !== mapIdAtStart\n            });\n        } else if (newState === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            setPlayModeWeather(prev => ({\n                ...prev,\n                [type]: value\n            }));\n            \n            // Dispatch event for any UI components that might be listening\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1);\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (newState === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        } else if (newState === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (newState === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (newState === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        }\n    }, [activeMapId, maps, updateMapData, activeRoomIds, playModeObjectData, registryItems, setPlayerPosition, setObjectMetadata, switchMap]);\n\n    const handleRevealSecret = useCallback((secretIndex) => {\n        setRevealedSecrets(prev => [...prev, secretIndex]);\n    }, []);\n\n    const gameEngineState = useGameEngine(\n        isPlayMode ? mapDataForGame : null,\n        isPlayMode ? tileMapData : EMPTY_ARRAY,\n        isPlayMode ? currentPlayObjectData : EMPTY_ARRAY,\n        isPlayMode ? currentPlaySecretData : EMPTY_ARRAY,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        Array.from(activeRoomIds)\n    );\n\n    const handlePlay = () => {\n        setEditorSnapshot({\n            tileMapData: [...tileMapData],\n            objectMapData: [...objectMapData],\n            secretMapData: [...secretMapData],\n            objectMetadata: { ...objectMetadata },\n            playerPosition: { ...playerPosition }\n        });\n\n        const playData = [...objectMapData];\n        let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n        if (spawnIndex === -1) {\n            const spawnX = Math.min(3, mapWidth - 1);\n            const spawnY = Math.min(3, mapHeight - 1);\n            spawnIndex = spawnY * mapWidth + spawnX;\n            playData[spawnIndex] = 'player';\n        }\n\n        setPlayModeObjectData(playData);\n        setPlayModeSecretData([...secretMapData]);\n        setPlayModeWeather({\n            rain: weatherRain,\n            snow: weatherSnow,\n            clouds: weatherClouds,\n            fog: weatherFog,\n            thunder: weatherThunder,\n            lavaRain: weatherLavaRain,\n            radioactiveFog: weatherRadioactiveFog,\n            meteorRain: weatherMeteorRain\n        });\n        setRevealedSecrets([]);\n        lastSyncedMapIdRef.current = activeMapId;\n        setIsPlayMode(true);\n        setIsGameOver(false); // Reset game over when starting play mode\n    };\n\n    const handlePause = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false); // Reset game over when exiting play mode\n    };\n\n    const handleReset = () => {\n        if (editorSnapshot) {\n            if (setTileMapData) {\n                setTileMapData([...editorSnapshot.tileMapData]);\n            }\n\n            const resetData = [...editorSnapshot.objectMapData];\n            let spawnIndex = resetData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                resetData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(resetData);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n            setRevealedSecrets([]);\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    };\n\n    return {\n        isPlayMode,\n        setIsPlayMode,\n        isGameOver,\n        handlePlay,\n        handlePause,\n        handleReset,\n        handleReplay,\n        handleStateUpdate,\n        playModeObjectData: currentPlayObjectData,\n        playModeSecretData: currentPlaySecretData,\n        playModeWeather,\n        gameMessage,\n        revealedSecrets,\n        activeRoomIds: Array.from(activeRoomIds),\n        gameEngineState\n    };\n};\n","import { useCallback } from 'react';\nimport { saveMap, loadMap, loadBuiltInMap, clearMap } from '../editorTools/mapOperations';\n\nexport const useEditorOperations = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    mapName, creatorName, mapDescription, createdAt,\n    selectedBackgroundImage, selectedBackgroundColor,\n    backgroundParallaxFactor, selectedBackgroundMusic, playerPosition,\n    registryItems, setCreatedAt,\n    setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n    setSelectedBackgroundImage, setSelectedBackgroundColor,\n    setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n    setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n    // Multi-map props\n    maps, setMaps, activeMapId, setActiveMapId\n) => {\n    const handleSaveMap = useCallback(() => {\n        // Construct the updated maps object with current active map data\n        // to ensure latest changes are saved even if debounce hasn't run\n        const currentMapData = {\n            ...maps[activeMapId],\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            name: mapName,\n            description: mapDescription,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weather: {\n                rain: weatherRain,\n                snow: weatherSnow,\n                clouds: weatherClouds,\n                fog: weatherFog,\n                thunder: weatherThunder,\n                lavaRain: weatherLavaRain,\n                radioactiveFog: weatherRadioactiveFog,\n                meteorRain: weatherMeteorRain\n            },\n            playerPosition\n        };\n\n        const updatedMaps = {\n            ...maps,\n            [activeMapId]: currentMapData\n        };\n\n        saveMap({\n            maps: updatedMaps, \n            activeMapId,\n            mapName, creatorName, mapDescription, createdAt,\n            registryItems, setCreatedAt\n        });\n    }, [\n        maps, activeMapId, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain\n    ]);\n\n    const handleLoadMap = useCallback((event) => {\n        loadMap({\n            event, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleLoadBuiltInMap = useCallback((mapData) => {\n        loadBuiltInMap({\n            mapData, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleClearMap = useCallback(() => {\n        clearMap({ \n            mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata \n        });\n    }, [mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    const openNewMapModal = () => {\n        setTempMapName(mapName);\n        setTempCreatorName(creatorName);\n        setTempMapDescription(mapDescription);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = (tempMapName, tempCreatorName, tempMapDescription) => {\n        setMapName(tempMapName || \"New Map\");\n        setCreatorName(tempCreatorName || \"Anonymous\");\n        setMapDescription(tempMapDescription || \"\");\n        setCreatedAt(new Date().toISOString());\n        \n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n        \n        setIsNewMapModalOpen(false);\n    };\n\n    return {\n        handleSaveMap,\n        handleLoadMap,\n        handleLoadBuiltInMap,\n        handleClearMap,\n        openNewMapModal,\n        confirmNewMap\n    };\n};\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = new Set();\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.add(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    if (startId === targetId) return currentData;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    return newData;\n};\n\nexport const paintTile = ({\n    index, brushSize, activeLayer, selectedTile,\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    isRoomAreaVisible, activeTool\n}) => {\n    const isPropsLayer = activeLayer === 'props';\n    const targetLayer = isPropsLayer ? 'object' : activeLayer;\n\n    const targetData = targetLayer === 'tile' ? tileMapData : (targetLayer === 'object' ? objectMapData : secretMapData);\n    const setTargetData = targetLayer === 'tile' ? setTileMapData : (targetLayer === 'object' ? setObjectMapData : setSecretMapData);\n    \n    const newData = [...targetData];\n    let newMetadata = objectMetadata ? { ...objectMetadata } : null;\n    let metadataChanged = false;\n\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                \n                // Protection for Room Areas\n                if (targetLayer === 'secret' && secretMapData[targetIndex] === 'room_area') {\n                    const isRoomAreaTool = activeTool === 'area' || selectedTile?.id === 'room_area';\n                    const isEraser = selectedTile === null;\n                    if (!isRoomAreaVisible && !isRoomAreaTool && !isEraser) {\n                        continue; // Skip overwriting room_area if not visible and not using room tool\n                    }\n                }\n\n                if (isPropsLayer) {\n                    // In props layer, we erase metadata and the object itself\n                    newData[targetIndex] = null;\n                    if (newMetadata && newMetadata[targetIndex]) {\n                        delete newMetadata[targetIndex];\n                        metadataChanged = true;\n                    }\n                } else {\n                    newData[targetIndex] = selectedTile ? selectedTile.id : null;\n                    // If we are painting/erasing in object layer, we should also handle metadata\n                    if (targetLayer === 'object' && selectedTile === null) {\n                        if (newMetadata && newMetadata[targetIndex]) {\n                            delete newMetadata[targetIndex];\n                            metadataChanged = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    setTargetData(newData);\n    if (metadataChanged && setObjectMetadata) {\n        setObjectMetadata(newMetadata);\n    }\n};\n","import { useState, useRef, useEffect, useCallback } from 'react';\nimport { getFloodFillIndices, floodFill, paintTile as paintTileUtil } from '../editorTools/paintingTools';\n\nexport const useEditorPainting = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n    setTileMapData, setObjectMapData, setSecretMapData,\n    activeTool, brushSize, activeLayer, selectedTile, selection, \n    setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n    setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n    objectMetadata, setObjectMetadata,\n    maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n) => {\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [resizeState, setResizeState] = useState(null); // { index, edge, startX, startY, startW, startH }\n    const [moveState, setMoveState] = useState(null); // { index, startX, startY, objId, secretId, meta }\n    const bucketTimerRef = useRef(null);\n\n    const getLinkedRoomAt = useCallback((index) => {\n        if (!showRoomMapContent || !secretMapData || !objectMetadata) return null;\n        \n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n\n        // Scan for room areas\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                const rx = idx % mapWidth;\n                const ry = Math.floor(idx / mapWidth);\n                const rw = meta.width || 1;\n                const rh = meta.height || 1;\n\n                if (x >= rx && x < rx + rw && y >= ry && y < ry + rh) {\n                    return {\n                        mapId: meta.linkedMapId,\n                        roomX: rx,\n                        roomY: ry,\n                        roomWidth: rw,\n                        roomHeight: rh,\n                        localX: x - rx,\n                        localY: y - ry,\n                        map: maps[meta.linkedMapId]\n                    };\n                }\n            }\n        }\n        return null;\n    }, [showRoomMapContent, secretMapData, objectMetadata, maps, mapWidth]);\n\n    const paintTile = useCallback((index) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        \n        if (linkedRoom && showRoomMapContent) {\n            const { mapId, localX, localY, map } = linkedRoom;\n            const rWidth = map.mapWidth;\n            const rHeight = map.mapHeight;\n            const roomIndex = localY * rWidth + localX;\n\n            const setRoomData = (layer, newData) => {\n                updateMapData(mapId, { [layer]: newData });\n            };\n\n            const setRoomMetadata = (newMeta) => {\n                updateMapData(mapId, { objectMetadata: newMeta });\n            };\n\n            paintTileUtil({\n                index: roomIndex,\n                activeTool,\n                brushSize,\n                activeLayer,\n                selectedTile,\n                mapWidth: rWidth,\n                mapHeight: rHeight,\n                tileMapData: map.tileMapData || [],\n                objectMapData: map.objectMapData || [],\n                secretMapData: map.secretMapData || [],\n                objectMetadata: map.objectMetadata || {},\n                setTileMapData: (data) => setRoomData('tileMapData', data),\n                setObjectMapData: (data) => setRoomData('objectMapData', data),\n                setSecretMapData: (data) => setRoomData('secretMapData', data),\n                setObjectMetadata: setRoomMetadata,\n                isRoomAreaVisible\n            });\n            return;\n        }\n\n        paintTileUtil({\n            index,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile,\n            mapWidth,\n            mapHeight,\n            tileMapData,\n            objectMapData,\n            secretMapData,\n            objectMetadata,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData,\n            setObjectMetadata,\n            isRoomAreaVisible\n        });\n    }, [getLinkedRoomAt, showRoomMapContent, updateMapData, activeTool, brushSize, activeLayer, selectedTile, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, isRoomAreaVisible]);\n\n    const handleResizeStart = useCallback((index, edge) => {\n        const meta = objectMetadata[index] || {};\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setResizeState({\n            index,\n            edge,\n            startX: x,\n            startY: y,\n            startW: meta.width || 1,\n            startH: meta.height || 1\n        });\n        setIsDragging(true);\n    }, [objectMetadata, mapWidth, setIsDragging]);\n\n    const handleMoveStart = useCallback((index) => {\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setMoveState({\n            index,\n            startX: x,\n            startY: y,\n            objId: objectMapData[index],\n            secretId: secretMapData[index],\n            meta: objectMetadata[index] ? { ...objectMetadata[index] } : null\n        });\n        setIsDragging(true);\n        setHighlightedIndex(index);\n    }, [objectMapData, secretMapData, objectMetadata, mapWidth, setIsDragging, setHighlightedIndex]);\n\n    const handleGridMouseDown = useCallback((index, e) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n        const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n        const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n        \n        const mTileMapData = useLinked ? linkedRoom.map.tileMapData : tileMapData;\n        const mObjectMapData = useLinked ? linkedRoom.map.objectMapData : objectMapData;\n        const mSecretMapData = useLinked ? linkedRoom.map.secretMapData : secretMapData;\n        const mObjectMetadata = useLinked ? linkedRoom.map.objectMetadata : objectMetadata;\n\n        const mSetTileMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { tileMapData: data }) : setTileMapData;\n        const mSetObjectMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMapData: data }) : setObjectMapData;\n        const mSetSecretMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { secretMapData: data }) : setSecretMapData;\n        const mSetObjectMetadata = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMetadata: data }) : setObjectMetadata;\n\n        // Quick select for configurable objects\n        const existingObjId = mObjectMapData[mIndex];\n        const existingSecretId = mSecretMapData[mIndex];\n        const isEraser = selectedTile === null && activeTool === 'brush';\n        const isRoomMap = maps[activeMapId]?.type === 'room';\n\n        if (!isEraser && (existingObjId || existingSecretId) && setActivePanel && setHighlightedIndex) {\n            const objDef = existingObjId ? registryItems?.find(r => r.id === existingObjId) : null;\n            const secretDef = existingSecretId ? registryItems?.find(r => r.id === existingSecretId) : null;\n\n            const isWeather = objDef && objDef.type === 'weather_trigger';\n            const isMessage = objDef && objDef.type === 'message_trigger';\n            const isPortalOrTarget = existingObjId && (existingObjId.includes('portal') || existingObjId.includes('target') || existingObjId === 'portal_target');\n            const isDoor = objDef && objDef.subtype === 'door';\n            const isRoomArea = secretDef && secretDef.subtype === 'room' && !isRoomMap;\n\n            if (isWeather || isMessage || isPortalOrTarget || isDoor || isRoomArea) {\n                setActivePanel('props');\n                setHighlightedIndex(useLinked ? index : mIndex);\n            }\n        }\n\n        if (activeTool === 'brush') {\n            setIsDragging(true);\n            paintTile(index);\n        } else if (activeTool === 'area') {\n            setIsDragging(true);\n            setDragStart({ x: index % mapWidth, y: Math.floor(index / mapWidth) });\n        } else if (activeTool === 'bucket') {\n            const isPropsLayer = activeLayer === 'props';\n            const targetLayer = isPropsLayer ? 'object' : activeLayer;\n            const targetData = targetLayer === 'tile' ? mTileMapData : (targetLayer === 'object' ? mObjectMapData : mSecretMapData);\n            const targetValue = targetData[mIndex];\n            const newValue = selectedTile ? selectedTile.id : null;\n            if (targetValue === newValue) return;\n\n            const newData = floodFill(mIndex, newValue, targetData, mWidth, mHeight);\n            \n            if (targetLayer === 'tile') mSetTileMapData(newData);\n            else if (targetLayer === 'object') {\n                mSetObjectMapData(newData);\n                // Clean up metadata for all affected indices if erasing\n                if (newValue === null && mObjectMetadata && mSetObjectMetadata) {\n                    const affectedIndices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                    let metaChanged = false;\n                    const newMeta = { ...mObjectMetadata };\n                    affectedIndices.forEach(idx => {\n                        if (newMeta[idx]) {\n                            delete newMeta[idx];\n                            metaChanged = true;\n                        }\n                    });\n                    if (metaChanged) mSetObjectMetadata(newMeta);\n                }\n            }\n            else mSetSecretMapData(newData);\n        } else if (activeTool === 'move') {\n            if (selection) return;\n\n            // If we clicked on an object/secret, start moving it\n            if (existingObjId || existingSecretId) {\n                handleMoveStart(mIndex); // Note: move/resize on linked rooms might still be buggy\n            } else {\n                const x = index % mapWidth;\n                const y = Math.floor(index / mapWidth);\n                setDragStart({ x, y });\n                setIsDragging(true);\n            }\n        }\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, setActivePanel, setHighlightedIndex, registryItems, activeTool, setIsDragging, paintTile, activeLayer, selectedTile, selection, handleMoveStart, setDragStart, getLinkedRoomAt, showRoomMapContent, updateMapData]);\n\n    const handleGridMouseMove = useCallback((index) => {\n        setHoverIndex(index);\n        const curX = index % mapWidth;\n        const curY = Math.floor(index / mapWidth);\n\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        if (resizeState) {\n            // Resize logic - keep on active map for now as it's complex\n            const dx = curX - resizeState.startX;\n            const dy = curY - resizeState.startY;\n            let newW = resizeState.startW;\n            let newH = resizeState.startH;\n            let newIndex = resizeState.index;\n\n            if (resizeState.edge === 'right') newW = Math.max(1, resizeState.startW + dx);\n            if (resizeState.edge === 'bottom') newH = Math.max(1, resizeState.startH + dy);\n            \n            if (resizeState.edge === 'left') {\n                const shift = Math.min(resizeState.startW - 1, dx);\n                newW = resizeState.startW - shift;\n                newIndex = resizeState.startY * mapWidth + (resizeState.startX + shift);\n            }\n            if (resizeState.edge === 'top') {\n                const shift = Math.min(resizeState.startH - 1, dy);\n                newH = resizeState.startH - shift;\n                newIndex = (resizeState.startY + shift) * mapWidth + resizeState.startX;\n            }\n\n            if (newW !== (objectMetadata[resizeState.index]?.width || 1) || \n                newH !== (objectMetadata[resizeState.index]?.height || 1) ||\n                newIndex !== resizeState.index) {\n                \n                const meta = { ...objectMetadata[resizeState.index] };\n                meta.width = newW;\n                meta.height = newH;\n                \n                setObjectMetadata(prev => {\n                    const next = { ...prev };\n                    delete next[resizeState.index];\n                    next[newIndex] = meta;\n                    return next;\n                });\n\n                if (newIndex !== resizeState.index) {\n                    const objId = objectMapData[resizeState.index];\n                    const secretId = secretMapData[resizeState.index];\n                    setObjectMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = objId;\n                        return next;\n                    });\n                    setSecretMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = secretId;\n                        return next;\n                    });\n                    setResizeState(prev => ({ ...prev, index: newIndex, startX: newIndex % mapWidth, startY: Math.floor(newIndex / mapWidth), startW: newW, startH: newH }));\n                    setHighlightedIndex(newIndex);\n                }\n            }\n        } else if (moveState) {\n            if (index === moveState.index) return;\n            \n            // Perform move\n            setObjectMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.objId;\n                return next;\n            });\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.secretId;\n                return next;\n            });\n            setObjectMetadata(prev => {\n                const next = { ...prev };\n                delete next[moveState.index];\n                if (moveState.meta) next[index] = moveState.meta;\n                return next;\n            });\n            setMoveState(prev => ({ ...prev, index, startX: curX, startY: curY }));\n            setHighlightedIndex(index);\n\n        } else if (activeTool === 'brush' && isDragging) {\n            paintTile(index);\n        } else if (activeTool === 'bucket') {\n            if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = setTimeout(() => {\n                const targetLayer = activeLayer === 'props' ? 'object' : activeLayer;\n                \n                const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n                const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n                const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n                const mData = useLinked ? linkedRoom.map : { tileMapData, objectMapData, secretMapData };\n                \n                const targetData = targetLayer === 'tile' ? mData.tileMapData : (targetLayer === 'object' ? mData.objectMapData : mData.secretMapData);\n                const indices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                \n                if (useLinked) {\n                    // We need to convert linked room indices back to main map indices for preview?\n                    // Or just skip preview for linked rooms for now to keep it simple.\n                    setBucketPreviewIndices(new Set()); \n                } else {\n                    setBucketPreviewIndices(indices);\n                }\n            }, 10);\n        }\n    }, [setHoverIndex, activeTool, isDragging, paintTile, activeLayer, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight, setBucketPreviewIndices, resizeState, moveState, objectMetadata, setObjectMetadata, setObjectMapData, setSecretMapData, setHighlightedIndex, getLinkedRoomAt, showRoomMapContent]);\n\n    const handleGridMouseUp = useCallback((index) => {\n        if (activeTool === 'area' && isDragging && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n            const baseIndex = y1 * mapWidth + x1;\n\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[baseIndex] = 'room_area';\n                return next;\n            });\n            setObjectMetadata(prev => ({\n                ...prev,\n                [baseIndex]: { ...prev[baseIndex], width: w, height: h, roomName: 'New Room' }\n            }));\n            setHighlightedIndex(baseIndex);\n            if (setActivePanel) setActivePanel('props');\n            setIsDragging(false);\n            setDragStart(null);\n            return;\n        }\n\n        if (activeTool === 'move' && isDragging && !resizeState && !moveState && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const tileData = [];\n            const objectData = [];\n            const secretData = [];\n            const selectionMetadata = {};\n\n            for (let y = y1; y <= y2; y++) {\n                for (let x = x1; x <= x2; x++) {\n                    const idx = y * mapWidth + x;\n                    tileData.push(tileMapData[idx]);\n                    objectData.push(objectMapData[idx]);\n                    secretData.push(secretMapData[idx]);\n                    if (objectMetadata[idx]) {\n                        selectionMetadata[`${x - x1},${y - y1}`] = { ...objectMetadata[idx] };\n                    }\n                }\n            }\n\n            setSelection({\n                x: x1, y: y1, w, h,\n                originalX: x1, originalY: y1,\n                tileData, objectData, secretData,\n                metadata: selectionMetadata\n            });\n            setPreviewPosition({ x: x1, y: y1 });\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            });\n            setDragStart(null);\n        }\n\n        setIsDragging(false);\n        setResizeState(null);\n        setMoveState(null);\n    }, [activeTool, isDragging, resizeState, moveState, dragStart, mapWidth, tileMapData, objectMapData, secretMapData, setSelection, setPreviewPosition, setOriginalMapData, setDragStart, setIsDragging]);\n\n    return {\n        hoverIndex,\n        setHoverIndex,\n        bucketPreviewIndices,\n        setBucketPreviewIndices,\n        handleGridMouseDown,\n        handleGridMouseMove,\n        handleGridMouseUp,\n        handleResizeStart,\n        handleMoveStart,\n        paintTile\n    };\n};\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { resizeMapData } from './editorTools/mapOperations';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './editorTools/NewMapModal';\nimport { BuiltInMapsModal } from './editorTools/BuiltInMapsModal';\nimport { EditorScene } from './EditorScene';\nimport { EditorElements } from './EditorElements';\nimport { EditorTools } from './EditorTools';\nimport PixiStage from '../game/PixiStage';\nimport styled from 'styled-components';\n\n// Custom Hooks\nimport { useEditorRegistry } from './hooks/useEditorRegistry';\nimport { useEditorSelection } from './hooks/useEditorSelection';\nimport { useEditorPlayMode } from './hooks/useEditorPlayMode';\nimport { useEditorOperations } from './hooks/useEditorOperations';\nimport { useEditorPainting } from './hooks/useEditorPainting';\nimport { useEditorMaps } from './hooks/useEditorMaps';\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst MessageOverlay = styled.div`\n    position: absolute;\n    top: 40%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 80%;\n    text-align: center;\n    pointer-events: none;\n    z-index: 1500;\n    \n    h2 {\n        font-size: 48px;\n        color: white;\n        text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);\n        margin: 0;\n        padding: 20px;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-weight: 800;\n        letter-spacing: 2px;\n        opacity: ${props => props.$isVisible ? 1 : 0};\n        transition: opacity 2s ease-in-out;\n    }\n`;\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nexport const Editor = () => {\n    const registryItems = useMemo(() => getRegistry() || [], []);\n    const playerVisuals = useMemo(() => registryItems.find(item => item.id === 'player') || EMPTY_OBJECT, [registryItems]);\n\n    // Basic Map State\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [objectMetadata, setObjectMetadata] = useState({});\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n    const [showBackgroundImage, setShowBackgroundImage] = useState(true);\n    const [showMessages, setShowMessages] = useState(() => {\n        try {\n            const v = localStorage.getItem('editor_show_messages');\n            if (v === null) return true;\n            return v !== '0';\n        } catch {\n            return true;\n        }\n    });\n\n    // Tools & Modes State\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [isRoomAreaVisible, setIsRoomAreaVisible] = useState(false);\n    const [showRoomMapContent, setShowRoomMapContent] = useState(false);\n    const [isWorldViewOpen, setIsWorldViewOpen] = useState(false);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata });\n\n    // Metadata State\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [mapDescription, setMapDescription] = useState(\"\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [highlightedIndex, setHighlightedIndex] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [isBuiltInMapsModalOpen, setIsBuiltInMapsModalOpen] = useState(false);\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n    const [tempMapDescription, setTempMapDescription] = useState(\"\");\n    const [activePanel, setActivePanel] = useState(null);\n\n    // Asset Options\n    const backgroundOptions = useMemo(() => loadBackgroundOptions(), []);\n    const musicOptions = useMemo(() => loadMusicOptions(), []);\n\n    // Background State\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#99C1F1');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    // Weather State\n    const [weatherRain, setWeatherRain] = useState(0);\n    const [weatherSnow, setWeatherSnow] = useState(0);\n    const [weatherClouds, setWeatherClouds] = useState(0);\n    const [weatherFog, setWeatherFog] = useState(0);\n    const [weatherThunder, setWeatherThunder] = useState(0);\n    const [weatherLavaRain, setWeatherLavaRain] = useState(0);\n    const [weatherRadioactiveFog, setWeatherRadioactiveFog] = useState(0);\n    const [weatherMeteorRain, setWeatherMeteorRain] = useState(0);\n\n    const [playerPosition, setPlayerPosition] = useState({ x: 100, y: 100 });\n\n    useEffect(() => {\n        try { localStorage.setItem('editor_show_messages', showMessages ? '1' : '0'); } catch {}\n    }, [showMessages]);\n\n    // Multi-map state\n    const { \n        maps, setMaps, activeMapId, setActiveMapId, createMap: createNewMap, updateMapData, deleteMap \n    } = useEditorMaps();\n\n    const lastActiveMapIdRef = useRef(activeMapId);\n\n    const switchMap = useCallback((newMapId, spawnTriggerId = null) => {\n        if (newMapId === activeMapId) return;\n\n        // 1. Save current map data to store\n        updateMapData(activeMapId, {\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            mapName, creatorName, mapDescription, createdAt,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n            weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n            playerPosition\n        });\n\n        // 2. Load new map data\n        const nextMap = maps[newMapId];\n        if (nextMap) {\n            setMapWidth(nextMap.mapWidth);\n            setMapHeight(nextMap.mapHeight);\n            setTileMapData(nextMap.tileMapData);\n            setObjectMapData(nextMap.objectMapData);\n            setSecretMapData(nextMap.secretMapData);\n            setObjectMetadata(nextMap.objectMetadata || {});\n            setMapName(nextMap.name);\n            setMapDescription(nextMap.description || \"\");\n            setCreatedAt(nextMap.createdAt || new Date().toISOString());\n            setSelectedBackgroundImage(nextMap.selectedBackgroundImage);\n            setSelectedBackgroundColor(nextMap.selectedBackgroundColor);\n            setBackgroundParallaxFactor(nextMap.backgroundParallaxFactor || 0.3);\n            setSelectedBackgroundMusic(nextMap.selectedBackgroundMusic);\n            \n            if (nextMap.weather) {\n                setWeatherRain(nextMap.weather.rain || 0);\n                setWeatherSnow(nextMap.weather.snow || 0);\n                setWeatherClouds(nextMap.weather.clouds || 0);\n                setWeatherFog(nextMap.weather.fog || 0);\n                setWeatherThunder(nextMap.weather.thunder || 0);\n                setWeatherLavaRain(nextMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(nextMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(nextMap.weather.meteorRain || 0);\n            }\n            \n            if (nextMap.playerPosition) {\n                setPlayerPosition(nextMap.playerPosition);\n            }\n            \n            // If we have a spawnTriggerId, we might want to store it temporarily\n            // so useEditorPlayMode can include it in mapDataForGame.meta\n            // But actually, we can just update the map data in the store with this triggerId.\n            if (spawnTriggerId !== null) {\n                updateMapData(newMapId, { ...nextMap, spawnTriggerId });\n            }\n\n            setActiveMapId(newMapId);\n        }\n    }, [\n        activeMapId, maps, updateMapData, setActiveMapId,\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, createdAt,\n        selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const handleCreateMap = useCallback((type, name, width, height) => {\n        const finalName = name || prompt(`Enter ${type} map name:`, `New ${type.charAt(0).toUpperCase() + type.slice(1)}`);\n        if (finalName) {\n            const finalWidth = width || mapWidth;\n            const finalHeight = height || mapHeight;\n            const newId = createNewMap(type, finalName, finalWidth, finalHeight);\n            return newId;\n        }\n    }, [createNewMap, mapWidth, mapHeight]);\n\n    // Update store when current map data changes (for minimap preview)\n    useEffect(() => {\n        // Skip update if activeMapId just changed to prevent overwriting new map data with old map state\n        if (lastActiveMapIdRef.current !== activeMapId) {\n            lastActiveMapIdRef.current = activeMapId;\n            return;\n        }\n\n        const timeout = setTimeout(() => {\n            updateMapData(activeMapId, {\n                mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n                name: mapName,\n                description: mapDescription,\n                selectedBackgroundImage, selectedBackgroundColor,\n                selectedBackgroundMusic, backgroundParallaxFactor,\n                weather: {\n                    rain: weatherRain,\n                    snow: weatherSnow,\n                    clouds: weatherClouds,\n                    fog: weatherFog,\n                    thunder: weatherThunder,\n                    lavaRain: weatherLavaRain,\n                    radioactiveFog: weatherRadioactiveFog,\n                    meteorRain: weatherMeteorRain\n                },\n                playerPosition\n            });\n        }, 1000); // Debounce store updates\n        return () => clearTimeout(timeout);\n    }, [\n        activeMapId, updateMapData, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        mapName, mapDescription, selectedBackgroundImage, selectedBackgroundColor, selectedBackgroundMusic, backgroundParallaxFactor,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    // Use Custom Hooks\n    const { \n        blocks, liquids, entities, decorations, items, interactables, hazards, secrets, weather, messages, crackableWalls, pushableWalls, obstacles \n    } = useEditorRegistry(registryItems);\n\n    const { \n        selection, setSelection, selectionMode, setSelectionMode, previewPosition, setPreviewPosition,\n        originalMapData, setOriginalMapData, moveSelection, commitSelection, cancelSelection \n    } = useEditorSelection(mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata);\n\n    const {\n        isPlayMode, handlePlay, handlePause, handleReset, handleReplay, handleStateUpdate,\n        playModeObjectData, playModeSecretData, playModeWeather, gameMessage, revealedSecrets, \n        activeRoomIds, gameEngineState, isGameOver\n    } = useEditorPlayMode(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n        registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        maps, activeMapId, switchMap, maps[activeMapId]?.spawnTriggerId,\n        setTileMapData, updateMapData\n    );\n\n    const {\n        handleSaveMap, handleLoadMap, handleLoadBuiltInMap, handleClearMap, openNewMapModal, confirmNewMap\n    } = useEditorOperations(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        maps, setMaps, activeMapId, setActiveMapId\n    );\n\n    const {\n        hoverIndex, setHoverIndex, bucketPreviewIndices, setBucketPreviewIndices,\n        handleGridMouseDown, handleGridMouseMove, handleGridMouseUp,\n        handleResizeStart, handleMoveStart, paintTile\n    } = useEditorPainting(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n        setTileMapData, setObjectMapData, setSecretMapData,\n        activeTool, brushSize, activeLayer, selectedTile, selection, \n        setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n        setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n        objectMetadata, setObjectMetadata,\n        maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n    );\n\n    // Side Effects\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    const togglePanel = (panel) => {\n        setActivePanel(prev => prev === panel ? null : panel);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n        resizeMapData({\n            newWidth, newHeight, stateRef, setMapWidth, setMapHeight,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata\n        });\n    };\n\n    const handlePaletteSelect = useCallback((item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    }, []);\n\n    // Grid Event Handlers\n    \n    const handleGridMouseLeave = useCallback(() => {\n        setHoverIndex(null);\n        setBucketPreviewIndices(new Set());\n    }, [setHoverIndex, setBucketPreviewIndices]);\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    const onAddRoomArea = useCallback(() => {\n        setIsWorldViewOpen(false);\n        setActiveTool('area');\n        setActiveLayer('secret');\n    }, []);\n\n    const handleDeleteMap = useCallback((id) => {\n        if (id === activeMapId) {\n            switchMap('main');\n        }\n        deleteMap(id);\n    }, [activeMapId, switchMap, deleteMap]);\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\n            <NewMapModal \n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                tempMapDescription={tempMapDescription}\n                setTempMapDescription={setTempMapDescription}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <BuiltInMapsModal \n                isOpen={isBuiltInMapsModalOpen}\n                onClose={() => setIsBuiltInMapsModalOpen(false)}\n                onSelect={handleLoadBuiltInMap}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', flex: 1, flexDirection: 'row',\n                filter: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'none' : 'auto',\n                overflow: 'hidden'\n            }}>\n                <EditorElements \n                    mapName={mapName}\n                    creatorName={creatorName}\n                    mapDescription={mapDescription}\n                    setMapName={setMapName}\n                    setCreatorName={setCreatorName}\n                    setMapDescription={setMapDescription}\n                    openNewMapModal={openNewMapModal}\n                    openBuiltInModal={() => setIsBuiltInMapsModalOpen(true)}\n                    saveMap={handleSaveMap}\n                    loadMap={handleLoadMap}\n                    clearMap={handleClearMap}\n                    isPlayMode={isPlayMode}\n                    handlePaletteSelect={handlePaletteSelect}\n                    selectedTile={selectedTile}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    decorations={decorations}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    weather={weather}\n                    messages={messages}\n                    crackableWalls={crackableWalls}\n                    pushableWalls={pushableWalls}\n                    obstacles={obstacles}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    objectMapData={objectMapData}\n                    secretMapData={secretMapData}\n                    objectMetadata={objectMetadata}\n                    setObjectMetadata={setObjectMetadata}\n                    registryItems={registryItems}\n                    highlightedIndex={highlightedIndex}\n                    setHighlightedIndex={setHighlightedIndex}\n                    activePanel={activePanel}\n                    setActivePanel={setActivePanel}\n                    togglePanel={togglePanel}\n                    maps={maps}\n                    activeMapId={activeMapId}\n                    createMap={handleCreateMap}\n                />\n\n                <div style={{ display: 'flex', flex: 1, flexDirection: 'column', overflow: 'hidden' }}>\n                    <EditorTools\n                        mapName={mapName}\n                        creatorName={creatorName}\n                        activePanel={activePanel}\n                        togglePanel={togglePanel}\n                        showGrid={showGrid}\n                        setShowGrid={setShowGrid}\n                        isPlayMode={isPlayMode}\n                        handlePlay={handlePlay}\n                        handlePause={handlePause}\n                        handleReset={handleReset}\n                        activeTool={activeTool}\n                        setActiveTool={setActiveTool}\n                        brushSize={brushSize}\n                        setBrushSize={setBrushSize}\n                        activeLayer={activeLayer}\n                        selection={selection}\n                        moveSelection={moveSelection}\n                        selectionMode={selectionMode}\n                        setSelectionMode={setSelectionMode}\n                        commitSelection={commitSelection}\n                        cancelSelection={cancelSelection}\n                        selectedTile={selectedTile}\n                        handlePaletteSelect={handlePaletteSelect}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        showBackgroundImage={showBackgroundImage}\n                        setShowBackgroundImage={setShowBackgroundImage}\n                        showMessages={showMessages}\n                        setShowMessages={setShowMessages}\n                        isRoomAreaVisible={isRoomAreaVisible}\n                        setIsRoomAreaVisible={setIsRoomAreaVisible}\n                        showRoomMapContent={showRoomMapContent}\n                        setShowRoomMapContent={setShowRoomMapContent}\n                    />\n                    \n                    <div style={{ display: 'flex', flex: 1, flexDirection: 'row', overflow: 'hidden', position: 'relative' }}>\n\n                    <EditorScene \n                        handleMapResize={handleMapResize}\n                        isResizeWindowOpen={isResizeWindowOpen}\n                        setIsResizeWindowOpen={setIsResizeWindowOpen}\n                        isWorldViewOpen={isWorldViewOpen}\n                        setIsWorldViewOpen={setIsWorldViewOpen}\n                        onAddRoomArea={onAddRoomArea}\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                        // Multi-map props\n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        createMap={handleCreateMap}\n                        deleteMap={handleDeleteMap}\n                        updateMapData={updateMapData}\n                        showRoomMapContent={showRoomMapContent}\n                        activeRoomIds={activeRoomIds}\n                    />\n\n                    {!isPlayMode ? (\n                        <Viewport\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            selectedBackgroundUrl={selectedBackgroundUrl}\n                            selectedBackgroundColor={selectedBackgroundColor}\n                            selectedBackgroundImage={selectedBackgroundImage}\n                            showBackgroundImage={showBackgroundImage}\n                            showGrid={showGrid}\n                            activeLayer={activeLayer}\n                            activeTool={activeTool}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            hoverIndex={hoverIndex}\n                            highlightedIndex={highlightedIndex}\n                            brushSize={brushSize}\n                            bucketPreviewIndices={bucketPreviewIndices}\n                            selection={selection}\n                            previewPosition={previewPosition}\n                            dragStart={dragStart}\n                            isDragging={isDragging}\n                            handleGridMouseDown={handleGridMouseDown}\n                            handleGridMouseEnter={handleGridMouseMove}\n                            handleGridMouseUp={handleGridMouseUp}\n                            handleGridMouseLeave={handleGridMouseLeave}\n                            handleResizeStart={handleResizeStart}\n                            handleMoveStart={handleMoveStart}\n                            setIsDragging={setIsDragging}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            mapType={maps[activeMapId]?.type || 'overworld'}\n                            isRoomAreaVisible={isRoomAreaVisible}\n                            showRoomMapContent={showRoomMapContent}\n                            showMessages={showMessages}\n                            maps={maps}\n                        />\n                    ) : (\n                        <div style={{ flex: 1, position: 'relative', backgroundColor: '#000' }}>\n                            <PixiStage\n                                mapWidth={mapWidth}\n                                mapHeight={mapHeight}\n                                tileSize={TILE_SIZE}\n                                tileMapData={tileMapData}\n                                objectMapData={playModeObjectData}\n                                secretMapData={playModeSecretData}\n                                revealedSecrets={revealedSecrets || []}\n                                registryItems={registryItems}\n                                playerState={gameEngineState}\n                                playerVisuals={playerVisuals}\n                                projectiles={gameEngineState?.projectiles || []}\n                                objectMetadata={objectMetadata}\n                                backgroundImage={showBackgroundImage ? selectedBackgroundImage : null}\n                                backgroundColor={selectedBackgroundColor}\n                                backgroundParallaxFactor={backgroundParallaxFactor}\n                                weatherRain={playModeWeather.rain}\n                                weatherLavaRain={playModeWeather.lavaRain}\n                                weatherSnow={playModeWeather.snow}\n                                weatherMeteorRain={playModeWeather.meteorRain}\n                                weatherClouds={playModeWeather.clouds}\n                                weatherFog={playModeWeather.fog}\n                                weatherRadioactiveFog={playModeWeather.radioactiveFog}\n                                weatherThunder={playModeWeather.thunder}\n                                onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                                isEditor={false}\n                                isEditorPlayMode={true}\n                                showGrid={showGrid}\n                                mapType={maps[activeMapId]?.type || 'overworld'}\n                                activeRoomIds={activeRoomIds}\n                                maps={maps}\n                            />\n                            {isGameOver && (\n                                <GameOverOverlay>\n                                    <GameOverTitle>Game Over</GameOverTitle>\n                                    <ReplayButton onClick={handleReplay}>\n                                        REPLAY \n                                    </ReplayButton>\n                                </GameOverOverlay>\n                            )}\n                            {gameMessage.text && (\n                                <MessageOverlay $isVisible={gameMessage.isVisible}>\n                                    <h2>{gameMessage.text}</h2>\n                                </MessageOverlay>\n                            )}\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    </div>\n);\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import { useState, useCallback } from 'react';\n\nexport const useEditorMaps = () => {\n    const [maps, setMaps] = useState({\n        'main': {\n            id: 'main',\n            name: 'Overworld',\n            description: '',\n            type: 'overworld',\n            mapWidth: 20,\n            mapHeight: 15,\n            tileMapData: Array(20 * 15).fill(null),\n            objectMapData: Array(20 * 15).fill(null),\n            secretMapData: Array(20 * 15).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: '#99C1F1',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: { x: 100, y: 100 },\n            worldX: 50,\n            worldY: 50\n        }\n    });\n    const [activeMapId, setActiveMapId] = useState('main');\n\n    const createMap = useCallback((type, name, width = 20, height = 15) => {\n        const id = `map_${Date.now()}`;\n        \n        // Find a good spot for new map\n        const existingMaps = Object.values(maps);\n        const maxY = Math.max(...existingMaps.map(m => m.worldY || 0), 0);\n        \n        const newMap = {\n            id,\n            name: name || (type === 'overworld' ? 'New Overworld' : 'New Underworld'),\n            description: '',\n            type,\n            mapWidth: width,\n            mapHeight: height,\n            tileMapData: Array(width * height).fill(null),\n            objectMapData: Array(width * height).fill(null),\n            secretMapData: Array(width * height).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: type === 'overworld' ? '#99C1F1' : '#1a1a1a',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: null, // Only one map should have player eventually\n            worldX: 50,\n            worldY: maxY + 150\n        };\n\n        setMaps(prev => ({\n            ...prev,\n            [id]: newMap\n        }));\n        return id;\n    }, []);\n\n    const updateMapData = useCallback((id, data) => {\n        setMaps(prev => ({\n            ...prev,\n            [id]: {\n                ...prev[id],\n                ...data\n            }\n        }));\n    }, []);\n\n    const deleteMap = useCallback((id) => {\n        if (id === 'main') return; // Cannot delete main map\n        setMaps(prev => {\n            const newMaps = { ...prev };\n            delete newMaps[id];\n            return newMaps;\n        });\n        if (activeMapId === id) {\n            setActiveMapId('main');\n        }\n    }, [activeMapId]);\n\n    return {\n        maps,\n        setMaps,\n        activeMapId,\n        setActiveMapId,\n        createMap,\n        updateMapData,\n        deleteMap\n    };\n};\n","import { useMemo } from 'react';\n\nexport const useEditorRegistry = (registryItems) => {\n    const blocks = useMemo(() => \n        registryItems.filter(item => {\n            if (!item.name || !item.name.startsWith('block.')) return false;\n            if (item.flags && item.flags.liquid) return false;\n            if (item.editor && item.editor.panel && item.editor.panel !== 'blocks') return false;\n            return true;\n        }), \n    [registryItems]);\n\n    const liquids = useMemo(() => \n        registryItems.filter(item => item.flags && item.flags.liquid), \n    [registryItems]);\n\n    const entities = useMemo(() => {\n        const baseEntities = registryItems.filter(item => {\n            if (!item.name || !item.name.toLowerCase().includes('entities.')) return false;\n            if (item.isHiddenInEditor) return false;\n            return !item.type || item.type === 'default' || item.type === 'entity' || item.subtype === 'tank';\n        });\n\n        const itemsToMove = registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            item.id !== 'hertz_item' && \n            item.id !== 'fireball_ammo'\n        );\n\n        return [...baseEntities, ...itemsToMove];\n    }, [registryItems]);\n\n    const decorations = useMemo(() => \n        registryItems.filter(item => {\n            if (item.type === 'decoration') return true;\n            if (item.name && item.name.toLowerCase().includes('decoration.')) return true;\n            if (item.id && item.id.includes('stone_pack')) return true;\n            return false;\n        }), \n    [registryItems]);\n\n    const items = useMemo(() => \n        registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            (item.id === 'hertz_item' || item.id === 'fireball_ammo')\n        ), \n    [registryItems]);\n\n    const interactables = useMemo(() => \n        registryItems.filter(item => {\n            if (item.editor && item.editor.panel) return item.editor.panel === 'interactables';\n            return item.type === 'interactable' || (item.name && item.name.startsWith('interactable.'));\n        }), \n    [registryItems]);\n\n    const hazards = useMemo(() => \n        registryItems.filter(item => item.type === 'hazard' || (item.name && item.name.startsWith('hazard.'))), \n    [registryItems]);\n\n    const secrets = useMemo(() => \n        registryItems.filter(item => item.type === 'secret'), \n    [registryItems]);\n\n    const weather = useMemo(() => \n        registryItems.filter(item => item.type === 'weather_trigger'), \n    [registryItems]);\n\n    const messages = useMemo(() => \n        registryItems.filter(item => item.type === 'message_trigger'), \n    [registryItems]);\n\n    const crackableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'crack_block'),\n    [registryItems]);\n\n    const pushableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'wolf_secret'),\n    [registryItems]);\n\n    const obstacles = useMemo(() => \n        registryItems.filter(item => item.type === 'obstacle' || (item.name && item.name.startsWith('obstacle.'))), \n    [registryItems]);\n\n    return {\n        blocks,\n        liquids,\n        entities,\n        decorations,\n        items,\n        interactables,\n        hazards,\n        secrets,\n        weather,\n        messages,\n        crackableWalls,\n        pushableWalls,\n        obstacles\n    };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nexport const useEditorSelection = (mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata) => {\n    const [selection, setSelection] = useState(null);\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n\n    const moveSelection = useCallback((dx, dy) => {\n        if (!selection || !previewPosition) return;\n        setPreviewPosition({ \n            x: previewPosition.x + dx, \n            y: previewPosition.y + dy \n        });\n    }, [selection, previewPosition]);\n\n    const cancelSelection = useCallback(() => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, []);\n\n    const commitSelection = useCallback(() => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n        const newObjectMetadata = { ...originalMapData.objectMetadata };\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                        delete newObjectMetadata[idx];\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                    \n                    if (selection.metadata && selection.metadata[`${px},${py}`]) {\n                        newObjectMetadata[destIdx] = { ...selection.metadata[`${px},${py}`] };\n                    }\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setObjectMetadata(newObjectMetadata);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, [selection, previewPosition, originalMapData, selectionMode, mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode, commitSelection, cancelSelection]);\n\n    return {\n        selection,\n        setSelection,\n        selectionMode,\n        setSelectionMode,\n        previewPosition,\n        setPreviewPosition,\n        originalMapData,\n        setOriginalMapData,\n        moveSelection,\n        commitSelection,\n        cancelSelection\n    };\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/Editor\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n","var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8815;"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","activeMapData","tileMapData","objectMapData","secretMapData","objectMetadata","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","projectMaps","isLoading","error","isPaused","isGameOver","activeRoomIds","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","meta","maps","updateObjectMap","updateObjectMetadata","index","metadata","mapId","removeObjectAtIndex","room","layerData","layers","find","l","type","data","length","undefined","removeTileAtIndex","moveTileInMap","fromIndex","toIndex","len","moveObjectInMap","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","forEach","idx","includes","push","toggleRoom","roomId","filter","clearRooms","setLoading","setError","setPaused","setGameOver","resetGame","actions","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","ui","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","no_navigation","en_navigation","ru_navigation","ja_navigation","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","no","en","ru","ja","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","DropdownContainer","div","DropdownMenu","MenuItem","ToggleSwitch","props","$active","SectionHeaderNavigationLanguages","dropdownRef","useRef","isMenuOpen","setIsMenuOpen","useState","soundEnabled","setSoundEnabled","v","localStorage","getItem","currentLang","language","handleLanguageChange","newLang","changeLanguage","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","ref","title","toggleSound","next","setItem","CustomEvent","detail","enabled","height","backgroundColor","margin","padding","color","StyledLogo","p","SectionHeaderNavigationLogo","tag","trim","toLowerCase","StyledSectionHeaderNavigation","StyledSectionContent","_registry","_registryMap","initRegistry","console","time","jsonContext","require","imageContext","soundContext","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","key","item","resolvedTexture","texture","resolvedTextures","textures","Array","isArray","path","sfx","sfxResolved","defaultAnimation","animItem","r","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","Map","set","__byId","log","timeEnd","getRegistry","findItemById","get","items","flexDirection","justifyContent","alignItems","width","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","apiUrl","env","REACT_APP_API_URL","logo","URL_LOGO_01","URL_LOGO_02","URL_LOGO_03","URL_LOGO_04","URL_LOGO_05","HomeContainer","Home","LOGO_01","config","LOGO_02","LOGO_03","LOGO_04","LOGO_05","src","alt","TextureCache","constructor","this","_map","url","m","has","tex","Texture","from","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","maxParticles","resize","area","Math","max","floor","setIntensity","min","Number","spawnOne","g","Graphics","rect","fill","alpha","viewport","getViewport","x","y","random","speed","vx","vy","rotation","addChild","bounces","alive","update","dtMs","targetIntensity","abs","lerpFactor","exp","norm","scaled","pow","deficit","maxPerFrame","smooth","ceil","toSpawn","i","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","strength","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","vY","vH","j","splice","WeatherSnow","flakes","seeded","maxFlakes","options","circle","minY","maxY","drift","settled","life","phase","restMs","viewportH","viewportY","seedCount","f","sin","sYwater","sYlava","gAcc","WeatherClouds","bandHeight","patches","windDirection","filters","BlurFilter","quality","rebuild","isInitial","w","h","vX","vW","range","rx","ry","circles","baseR","k","PI","dist","cx","cos","cy","targetAlpha","currentAlpha","dying","targetCount","W","bandTop","bandBottom","activePatches","_spawnTimer","toKill","osc","leftBound","rightBound","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","nv","_applyAlphas","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","moveTo","lineTo","stroke","alignment","cap","join","branchCount","ang","bx","by","worldX","maxH","isSolid","WeatherLavaRain","waterY","WeatherRadioactiveFog","WeatherMeteorRain","size","isLarge","atan2","onMeteorHit","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","count","spd","d","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","cur","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","bgContainer","_regions","_waterTex","_lavaTex","_quicksandTex","_waterfallTex","_lavaWaterfallTex","_radioactiveWaterTex","_radioactiveWaterfallTex","_time","_noiseTex","_lavaDetailTex","_waterDetailTex","_quicksandDetailTex","_playerState","setPlayerState","playerState","_checkPlayerInRegion","region","px","py","pw","ph","pt","tileIndicesSet","getSurfaceY","X","topEdges","bgNode","_gradTextures","mw","mh","ts","changed","waterDrift","lavaDrift","quicksandDrift","waterfallDrift","lavaWaterfallDrift","radioactiveWaterDrift","radioactiveWaterfallDrift","sprite","alphaDiff","splashG","bottomEdges","F","splashHeight","splashColor","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","ampNow","amp","capG","dy","centerX","dx","sigma","gauss","maxDisp","build","typeAt","liquid","lava_waterfall","radioactive_waterfall","waterfall","radioactive_water","quicksand","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","Set","bleed","_createLavaTexture","_createQuicksandTexture","_createWaterfallTexture","_createLavaWaterfallTexture","_createRadioactiveWaterfallTexture","_createRadioactiveWaterTexture","_createWaterTexture","source","addressMode","tiling","detailTex1","detailTex2","_createLavaDetailTexture","_createQuicksandDetailTexture","_createWaterDetailTexture","bgMask","bottomColor","_createGradientTexture","bgSprite","Sprite","_computeTopEdgeSpans","_computeBottomEdgeSpans","topColor","createLinearGradient","addColorStop","fillStyle","fillRect","globalAlpha","beginPath","arc","sw","sh","tilesByRow","above","rowList","cols","entries","sort","start","prev","below","addWave","HealthBar","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","visible","c","pct","_redrawFill","roundRect","innerW","freeze","parallax","tiles","tilesAnim","liquidBackground","objBehind","secretsBelow","player","projectiles","objFront","secretsAbove","weather","fog","liquids","liquidFx","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","isWaterfallDef","isLavaWaterfallDef","isRadioactiveWaterDef","isRadioactiveWaterfallDef","ParallaxBackground","textureCache","cache","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","minWidth","minHeight","hex","parseInt","slice","solid","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","editorIcon","Text","dropShadow","dropShadowColor","dropShadowBlur","dropShadowDistance","anchor","createPlayerContainer","playerVisuals","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","hit","renderMapContent","refs","secretOverlays","targetBg","targetObjBehind","targetObjFront","isEditor","isEditorPlayMode","mapType","secretLayerRef","activeRoomIndices","roomWindowIndices","idxStr","linkedMapId","roomMap","rw","rh","rMapW","worldIdx","localIdx","roomTiles","roomObjs","add","bgColorStr","bgColorHex","substring","roomBg","objId","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","filterColor","filterColorInGame","renderAbove","renderAbovePlayer","renderOnSecretLayer","backingSprite","backing","isPushable","maxHealth","health","visualElement","spriteSheet","totalSprites","columns","healthPercent","frameIndex","currentFrame","interaction","inside","frameWidth","frameHeight","col","row","Rectangle","frame","objWidth","objHeight","isRoomContent","isWeatherTrigger","isMessageTrigger","isWolfSecret","shouldShowAnyway","isHiddenInGame","isDestructible","hb","renderSecretOverlays","overlays","drawOverlay","split","match","parseFloat","setPreferences","skipCacheIdWarning","preferCreateImageBitmap","EMPTY_ARRAY","EMPTY_OBJECT","PixiStage","backgroundImage","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherLavaRain","weatherRadioactiveFog","weatherMeteorRain","healthBarEnabled","weatherFog","weatherThunder","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","showGrid","renderLayers","pointerEvents","onWeatherEffectHit","roomBlurEnabled","debugOverlayEnabled","isPixiReady","setIsPixiReady","mountRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","cameraPosRef","bgRef","bgAnimRef","bgImageRef","bgColorRef","objBehindRef","objFrontRef","roomBgRef","roomObjBehindRef","roomObjFrontRef","playerRef","playerLayerRef","playerSpriteRefs","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidBgLayerRef","liquidSystemRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","lavaRain","radioactiveFog","meteorRain","weatherPropsRef","projectilesLayerRef","projectileSpritesRef","entitiesLayerRef","entitySpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","overlayLayerRef","underwaterRef","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","inWater","headUnder","gridRef","showGridRef","roomBlurEnabledRef","blurFilterRef","darkenFilterRef","ColorMatrixFilter","roomBrightnessFilterRef","vignetteRef","floatingLayerRef","debugLayerRef","debugEnabledRef","floatingManagerRef","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","createSolidChecker","wx","wy","collision","top","bottom","left","right","rebuildParallax","useCallback","layer","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","screen","destroyed","async","app","Application","resizeTo","backgroundAlpha","antialias","autoDensity","stage","sortableChildren","renderer","bg","bgAnim","roomObjBehind","roomObjFront","secretBelowLayer","secretAboveLayer","playerLayer","entitiesLayer","weatherLayer","liquidBgLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","vignetteLayer","overlayLayer","floatingLayer","LAYERS","cfg","floatConfig","defaultCfg","critCfg","crit","ttlMs","amount","amountValue","critThreshold","threshold","isCrit","baseColor","finalColor","finalFontSize","finalTtl","riseSpeed","jitterY","finalText","prefix","suffix","label","String","fontFamily","strokeThickness","jitterXValue","jitterYValue","position","ttl","total","deltaMs","createFloatingTextManager","gridGraphics","debugGraphics","allLayersMap","objects","layerName","urlSet","addUrl","urls","playerComponents","innerHTML","appendChild","hbOverlay","oxyColors","oxyBar","lavaColors","lvBar","preventDefault","ticker","updatePlayerSprite","inLava","liquidType","effectiveWidth","isHit","hitTimerMs","dir","direction","mag","scale","camX","camY","lastCam","rawX","rawY","smoothing","nextRawX","nextRawY","pivot","__PLAYER_POS__","deltaMS","systems","swNow","shNow","sNow","overlayL","headUnderWater","overlayCfg","liquidOverlay","showOverlay","overlayColor","maxTargetAlpha","pulseBase","fadeSpeed","lastLiquidType","fadeOutSpeed","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","baseX","baseY","hbO","show","nextBarY","maxOxy","maxOxygen","curOxy","oxygen","maxLv","maxLavaResist","curLv","lavaResist","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","syncEntities","entitySpritesMap","entitiesList","ent","_lastFrameIndex","isTextureReady","currentSpriteIndex","texWidth","texHeight","effectiveColumns","targetWidth","targetHeight","isNaN","absScaleX","entities","appToDestroy","values","cleanupProjectiles","cleanupEntities","handler","isInsideRoom","targetBlur","roomBrightness","reset","desaturate","brightness","grad","createRadialGradient","_vignetteSprite","getDefById","tileCount","tileId","isLiquid","isRadio","radioactive","hasCollision","active","rebuildLayers","safeDestroy","removeChildren","child","roomAreaIndex","ox","oy","roomSecrets","roomOptions","selectedBackgroundColor","pLayer","tileDataString","JSON","stringify","prevTileDataString","_lastTileData","prepare","upload","runRebuild","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","getFogIntensity","getLavaRainIntensity","getRadioactiveFogIntensity","getMeteorRainIntensity","propTypes","PropTypes","isRequired","resolveInteractableContext","objectLayerData","mainObjectMetadata","activeRoomIdsProp","centerY","TILE_SIZE","activeTargetMap","activeObjectData","activeMetadata","activeMapWidth","activeMapHeight","currentMapId","mainMetadata","findSpawnPosition","triggerId","mapW","objLayer","objData","spawnIdx","triggerRequested","findIndex","handleDoorInteraction","objDef","currentMeta","actualIndex","gameState","onStateUpdate","playShotSfx","lastETime","sound","sfxVolume","opening","delayS","delaySeconds","targetMapId","setTimeout","targetMap","isRoom","newX","newY","roomAreaEntry","raIdx","spawn","spawnTriggerId","handleTeleportInteraction","vol","destId","destMeta","tx","ty","applyInteractableEffects","MAX_HEALTH","effect","interactableKey","usedInteractables","healthBonus","fireball","ammoBonus","ammo","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","revealedSet","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerIndex","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","handleWeatherTrigger","weatherType","weatherAction","value","lastWeatherTrigger","handleMessageTrigger","message","lastMessageTrigger","duration","triggerWolfSecret","playerCenterX","playerCenterY","objCenterX","objCenterY","playerGridX","playerGridY","objGridX","objGridY","moveX","moveY","eps","applyWolfSecretShift","getObjectId","getObjectDef","moveTile","moveObject","moveMetadata","removeObject","stepDelayMs","setTimeoutFn","shouldCancel","currentIdx","remainingDx","remainingDy","originId","moveStep","currentId","stepX","stepY","targetIndex","targetObjId","extraX","extraY","shouldRemoveCrackBlock","newHealth","passableHealthThreshold","checkInteractables","input","localX","localY","gridX","gridY","upIndex","upObjId","upDef","downIndex","downObjId","downDef","frontX","frontIndex","frontObjId","frontDef","foundIndex","isWinning","winCounter","winCountSpeed","beepFallback","muffled","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","lastNode","createBiquadFilter","frequency","setValueAtTime","connect","exponentialRampToValueAtTime","destination","stop","moveHorizontal","MOVE_SPEED","checkCollision","friction","acceleration","timeScale","targetVx","sign","proposedX","step","safeX","moveDist","nextX","applyVerticalPhysics","isGrounded","animation","GRAVITY","TERMINAL_VELOCITY","JUMP_FORCE","isLiquidAt","prevInWater","liqBuoyancy","liqDragY","liqTerminal","swimImpulseMult","atSurface","activeLiquidType","headY","chestY","feetLiq","chestLiq","space","swimImpulse","proposedY","getLiquidAtPixel","mapWidthTiles","mapHeightTiles","tileData","overlayColorRaw","tintBelowSurface","overlayAlphaRaw","overlayAlpha","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","feet","chest","head","candidate","inLiquid","defaultOverlay","rawOverlayColor","rawOverlayAlpha","tickLiquidDamage","accRef","HIT_FLASH_MS","getWeatherConfig","weatherDamageConfig","getMapWeather","metaWeather","activeId","activeMapId","activeMap","runtime","rt","__GAME_RUNTIME_SETTINGS__","merged","getWeatherDps","clampIntensity","maxDps","minDps","weatherAffectsPlayer","affects","weatherAffectsEnemy","enemyId","enemyName","enemies","mode","excluded","exclude","isExcluded","some","ex","weatherBlockedByCover","blockedByCover","isSolidAtPixel","secretData","objectData","ignoreEntityId","insideAnyRoom","localWx","localWy","roomTileW","roomTileH","roomObjects","closed","isExploding","isEntity","tileDef","getSurfaceProperties","feetY","slipperiness","isCoveredFromAbove","isInsideActiveRoom","updateFrame","constants","helpers","isInitialized","lastTimeRef","projectilesRef","entitiesRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","weatherDamageAccRef","activeRoomIdsRef","getLiquidSample","collectItem","checkHazardDamage","checkSecrets","spawnProjectile","playSfx","updateProjectiles","setPlayer","onGameOver","continue","iceResist","maxIceResist","physicsDt","backgroundLayer","secretLayer","isSlippery","currentIceRes","maxIce","effectiveFriction","ratio","targetFriction","checkCollisionExtended","isPushing","pushTarget","currentStrength","isAlreadyAtMax","lastPushTime","pushDist","overlapDist","isNextToLeft","isNextToRight","pushForce","sounds","lastPushSoundTime","vp","remaining","steps","stepMs","liquidParams","sample","resourceParams","parseNumber","maxLava","oxy","lavaRes","oxyParams","lavaParams","iceParams","strengthParams","oxygenApplies","oxygenEnabled","oxyDrain","oxyRegen","lavaApplies","lavaEnabled","lavaDrain","lavaRegen","applyResource","maxKey","drain","regen","maxVal","weatherNow","radioFogInt","fogActive","maxRadio","maxRadioactivity","radio","radioactivity","radioParams","radioEnabled","radioBaseline","baselinePercent","radioGain","gainPerSecond","radioDecay","decayPerSecond","radioRecover","recoverPerSecond","baseline","rates","getRadioactivityRates","inc","radioactivityPerSecond","dec","radioactivityRegenPerSecond","increase","tickDepleteDps","dpsValue","lavaRainInt","lavaDps","radioDps","totalWeatherDps","damage","healthDpsOverride","effectiveDps","currentAmmo","mouseLeft","playerX","playerY","entity","animFrame","animTimer","totalFrames","animations","explode","frameDuration","shouldRemove","liquidSample","liquidDamageAcc","dmg","weatherDamageAcc","prevInLiquid","water_splash","lava_splash","ew","eh","sinkingSpeed","fallDistance","other","kill_enemy","isRound","checkEmpty","leftX","rightX","idle","mapH","arrowId","foundArrowDef","arrowsLayer","aDef","nextY","ai","reactionDist","reactionDistance","shootDist","shootDistance","sqrt","canJump","shootCooldown","isShooting","patrol","hitSomething","stayOnPlatform","groundX","groundY","frameSpeed","checkEntityCollision","explodeAnim","anims","currentAnim","frameDur","updateEntities","knockbackDir","maxX","onIce","floatState","floatingText","acc","res","diff","amt","MAX_OXYGEN","MAX_LAVA_RESIST","MAX_RADIOACTIVITY","errorHandler","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","logData","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","useGameEngine","onRevealSecret","useInput","clearKeys","handleKeyDown","tagName","typing","isContentEditable","repeat","handleMouseDown","handleMouseUp","handleKeyUp","onToggleTerminal","passive","maxStrength","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","projectileIdRef","soundEnabledRef","audioCtxUnlockedRef","onStateUpdateRef","onRevealSecretRef","onGameOverRef","objectMetadataRef","revealedSecretsRef","mapWidthRef","mapHeightRef","tileDataRef","objectDataRef","secretDataRef","onToggle","onUserGesture","volume","audio","Audio","pause","once","checkHazardDamageWrapper","candidates","pushCandidate","touch","damageDirections","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","overlapTop","overlapBottom","overlapLeft","overlapRight","sideScore","chosen","prevIndex","damageOnce","baseDamage","immediate","TICK_MS","component","function","playerPosition","damageType","localRevealedRef","handleWeatherEffectHitWrapper","handleWeatherEffectHit","edx","edy","edist","onHit","lastMapIdRef","projectName","date_map_last_updated","date_map_created_at","isNewMapLoad","initialEntities","startX","startY","playerId","registryPlayer","pW","pH","maxXAtStart","checkCollisionExternal","TILE_SIZE_OVERRIDE","tileDataOverride","registryItemsOverride","secretDataOverride","objectDataOverride","objectMetadataOverride","ignoreId","isSolidAtPixelExternal","originX","originY","ownerId","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","proj","cwt","collisionWithTiles","hbs","hitboxScale","ric","spawnProjectileExternal","getLiquidTypeAtPixel","liq","sampleLiquid","aabb","objectLayer","collectedItems","rWidth","rgX","rIndex","itemKey","rObjectData","rItemId","rItemDef","pickup","pickedUp","itemId","itemDef","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","checkObjectHit","checkEntityHit","ey","checkPlayerHit","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","stepTime","removed","hitEntX","hitIdxX","sp","hypot","jitter","hitEntY","hitIdxY","requestAnimationFrame","cancelAnimationFrame","AnimatedItem","setIndex","interval","setInterval","clearInterval","imgSrc","rows","maxWidth","maxHeight","draggable","HeaderContainer","AmmoDisplay","AmmoIcon","span","RightSection","BarsContainer","BarRow","BarWrapper","BarFill","attrs","$percent","$color","BarLabel","GameHeader","hpPercent","oxyPercent","lavaPercent","icePercent","strengthPercent","radioPercent","fireballFrames","fireballA","fireballB","fireballC","fireballD","imageRendering","commands","register","cmd","listCommands","description","executeCommand","raw","panelStyleBase","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","focus","onKey","scrollTop","scrollHeight","transform","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setLavaRain","setRadioactiveFog","setMeteorRain","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setDebugOverlayEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","setRoomBlurEnabled","showCoordinates","setShowCoordinates","minimized","setMinimized","pos","setPos","parse","setSize","draggingRef","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onSettingsUpdate","patch","onOpen","onMove","clientX","clientY","onUp","onResize","emitUpdate","panelStyle","userSelect","contentStyle","buttonStyle","marginLeft","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","defaultValue","_Fragment","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","BackgroundMusicPlayer","audioRef","currentSrcRef","sourceNodeRef","filterNodeRef","gainNodeRef","musicContext","cleanup","close","resolveUrl","loop","createMediaElementSource","setupWebAudio","setTargetAtTime","onGesture","val","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapDescription","MapInfo","WinCounterOverlay","GameOverOverlay","GameOverTitle","h1","ReplayButton","ModalDivider","FileUploadLabel","HiddenFileInput","Viewport","$blurred","GameCanvas","PlaceholderMessage","MessageOverlay","$isVisible","Game","dispatch","useDispatch","viewportRef","useSelector","uiState","runtimeSettings","setRuntimeSettings","gameMessage","setGameMessage","isVisible","messageTimerRef","activeMapIdRef","isGameOverRef","handleStateUpdate","spawnObjId","spawnDef","projectToLoad","loadMapData","mapIdAtStart","ps","alert","settingKey","charAt","clearTimeout","handleGameOver","indices","handleOpenModalEvent","weatherFogLegacy","effectiveMapData","version","backgroundMusic","bgLayer","mapName","dimensions","debugMapId","handleReplay","mapToLoad","isV2","author","sizeInfo","subMapInfo","mainMap","mapValues","accept","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","contents","suggestedName","mimeType","showSaveFilePicker","types","writable","createWritable","blob","Blob","write","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","applyMapData","setMapWidth","setMapHeight","setMapName","setCreatorName","setMapDescription","setCreatedAt","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","setSelectedBackgroundMusic","setPlayerPosition","setTileMapData","setObjectMapData","setSecretMapData","setObjectMetadata","setWeatherRain","setWeatherSnow","setWeatherClouds","setWeatherFog","setWeatherThunder","setWeatherLavaRain","setWeatherRadioactiveFog","setWeatherMeteorRain","setMaps","setActiveMapId","selectedBackgroundImage","selectedBackgroundMusic","worldY","date_created","ObjectLinks","React","links","portals","targets","x1","y1","x2","y2","strokeWidth","strokeDasharray","opacity","EditorTile","activeTool","tileObj","objObj","secretObj","isHighlighted","parentRegionIndex","borderStyle","bgStyle","handleGridMouseDown","handleGridMouseEnter","handleResizeStart","handleMoveStart","isRoomAreaVisible","showRoomMapContent","showMessages","isLiquidTile","isWaterTile","isLavaTile","isQuicksandTile","isWaterfallTile","isLavaWaterfallTile","isRadioactiveWaterTile","isRadioactiveWaterfallTile","messageText","isResizable","hasObjectOrSecret","onMouseEnter","boxSizing","objectFit","filterColorInEditor","hasIntensity","borderLeft","borderRight","textShadow","roomName","selectedBackgroundUrl","showBackgroundImage","activeLayer","hoverIndex","highlightedIndex","brushSize","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseUp","handleGridMouseLeave","setIsDragging","selectedTile","isEraserActive","isBrushActive","isBucketActive","regions","roomAreas","getLayerColor","getLayerFilter","onMouseUp","onMouseLeave","backgroundRepeat","backgroundSize","getGridStyles","gridTemplateColumns","gridTemplateRows","_","dTileId","dObjId","dSecId","layerColor","hx","hy","minX","selX","selY","originalX","originalY","parentRegion","EditorToolsContainer","HeaderBar","ToolsSection","ToolsGroup","ToolsInnerGroup","ToolsRow","ToolsEditorButton","$variant","$small","$square","$disabled","StrikeThrough","LayerIndicator","$bgColor","$borderColor","$textColor","BgColorContainer","BgColorInputWrapper","BgColorInput","disabled","BgTransparentButton","PlayButtonContainer","PlayButtonInner","InfoContainer","InfoItem","InfoLabel","InfoValue","EraserButtonContainer","EraserButtonInner","SelectionActions","ConfirmButton","CancelButton","GridIcon","SidebarContainer","ElementEditorButton","PanelContainer","$isOpen","PanelHeader","PanelBody","CloseButton","OperationButton","$danger","OperationLabel","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","tempMapDescription","setTempMapDescription","confirmNewMap","ModalHeader","BuiltInMapsModal","onSelect","topZIndex","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","setZIndex","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","lastHeightRef","offsetHeight","handleMouseMove","getBoundingClientRect","EditorMapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","objectId","tile","obj","strokeStyle","lineWidth","portal","setLineDash","WorldView","switchMap","currentMapData","createMap","deleteMap","updateMapData","onAddRoomArea","mapLayoutsRef","dragRef","allMaps","draw","layouts","currentIds","layout","tileW","tileH","strokeRect","font","fillText","rAreaW","rAreaH","rTileW","rTileH","ri","sourceLayout","sourceMap","sx","isPortalSource","isDoorSource","linkId","targetLayout","tw","th","tTileW","tTileH","tObjId","tObjDef","isTarget","isDoorTarget","tMeta","endX","cp1X","cp1Y","cp2X","cp2Y","bezierCurveTo","angle","save","translate","rotate","closePath","restore","btnX","btnY","confirm","mapStartX","mapStartY","onMouseMove","BackgroundPanel","backgroundOptions","paddingTop","MusicPanel","musicOptions","fontStyle","WeatherPanel","weatherItems","setter","icon","SceneEditorButton","RightSidebarContainer","EditorScene","handleMapResize","isResizeWindowOpen","setIsResizeWindowOpen","isWorldViewOpen","setIsWorldViewOpen","isMinimapOpen","setIsMinimapOpen","setIsSettingsOpen","isBackgroundOpen","setIsBackgroundOpen","isMusicOpen","setIsMusicOpen","OperationsPanel","openNewMapModal","saveMap","loadMap","openBuiltInModal","clearMap","creatorName","mapDescription","inputStyle","handleFocus","handleBlur","onFocus","onBlur","CollapsiblePanel","setIsOpen","PalettePanel","isPlayMode","category","blocks","decorations","interactables","hazards","secrets","messages","crackableWalls","pushableWalls","obstacles","handlePaletteSelect","renderPaletteItem","hasImage","isWater","isQuicksand","isWaterfall","isLavaWaterfall","isRadioactive","isRadioactiveWaterfall","isSecret","swatchStyle","displayName","getBlockGroup","editor","group","groupOrder","withGroups","sortBlocks","ao","order","bo","localeCompare","groupPanels","flexWrap","otherItems","getLiquidGroup","li","sortLiquids","getEntityGroup","sortEntities","groupItems","getItemGroup","sortItems","getInteractableGroup","sortInteractables","getHazardGroup","sortHazards","StatisticsPanel","totalTiles","filledBlocks","objectsCount","emptyBlocks","ObjectPropsPanel","setHighlightedIndex","mapList","listRef","highlightedElement","querySelector","scrollIntoView","behavior","block","isWeather","isMessage","isPortalOrTarget","isDoor","isRoomArea","el","scrollX","clientWidth","scrollY","clientHeight","scrollTo","EditorElements","activePanel","setActivePanel","togglePanel","lastPanel","setLastPanel","pinnedPanel","setPinnedPanel","hoverTimerRef","displayPanel","clearHoverTimer","handleIconClick","panel","handleIconMouseEnter","handleIconMouseLeave","handlePanelMouseEnter","handlePanelMouseLeave","stats","EditorTools","setShowGrid","handlePlay","handlePause","handleReset","setActiveTool","setBrushSize","moveSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","setShowBackgroundImage","setShowMessages","setIsRoomAreaVisible","setShowRoomMapContent","tool","isDisabled","roman","getLayerIndicatorData","object","secret","textColor","getEraserData","useEditorOperations","createdAt","setIsNewMapModalOpen","handleSaveMap","currentDate","projectData","date_last_updated","statistics","total_tiles","filled_tiles","total_objects","json","saveFile","mapsCount","handleLoadMap","setters","handleLoadBuiltInMap","loadBuiltInMap","handleClearMap","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","isPropsLayer","targetLayer","setTargetData","newData","newMetadata","metadataChanged","targetX","useEditorPainting","setSelection","setPreviewPosition","setOriginalMapData","setDragStart","setHoverIndex","setBucketPreviewIndices","resizeState","setResizeState","moveState","setMoveState","bucketTimerRef","getLinkedRoomAt","roomX","roomY","roomWidth","roomHeight","linkedRoom","rHeight","setRoomData","setRoomMetadata","newMeta","paintTileUtil","edge","useLinked","mWidth","mHeight","mIndex","mTileMapData","mObjectMapData","mSecretMapData","mObjectMetadata","mSetTileMapData","mSetObjectMapData","mSetSecretMapData","mSetObjectMetadata","existingObjId","existingSecretId","isEraser","isRoomMap","targetData","targetValue","newValue","floodFill","targetId","affectedIndices","metaChanged","handleGridMouseMove","curX","curY","newW","newH","newIndex","mData","baseIndex","selectionMetadata","tileMap","objectMap","secretMap","Editor","setSelectedTile","setActiveLayer","stateRef","isNewMapModalOpen","isBuiltInMapsModalOpen","setIsBuiltInMapsModalOpen","loadBackgroundOptions","loadMusicOptions","createNewMap","useEditorMaps","existingMaps","newMap","newMaps","lastActiveMapIdRef","newMapId","nextMap","handleCreateMap","finalName","prompt","timeout","selectedBgOption","useEditorRegistry","originalMapData","useEditorSelection","newTileMap","newObjectMap","newSecretMap","newObjectMetadata","destX","destY","destIdx","srcDataIdx","playModeObjectData","playModeSecretData","playModeWeather","gameEngineState","useEditorPlayMode","setIsPlayMode","setIsGameOver","restartCounter","setRestartCounter","editorSnapshot","setEditorSnapshot","setRevealedSecrets","setActiveRoomIds","setPlayModeObjectData","setPlayModeSecretData","setPlayModeWeather","lastSyncedMapIdRef","isPlayModeRef","engineInitId","currentPlayObjectData","playData","spawnIndex","spawnX","currentPlaySecretData","mapDataForGame","newState","prevTiles","newTiles","prevObjs","newObjs","prevMeta","handleRevealSecret","secretIndex","resetData","handleDeleteMap","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","oldMeta","resizeArray","oldArr","newArr","oldM","newM","oldIdx","newIdx","resizeMetadata","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","render","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App"],"ignoreList":[],"sourceRoot":""}