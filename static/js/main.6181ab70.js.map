{"version":3,"file":"static/js/main.6181ab70.js","mappings":"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","sources":["webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe","webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/config.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/weather/LavaRain.js","webpack://element_masters/./src/Pixi/effects/weather/RadioactiveFog.js","webpack://element_masters/./src/Pixi/effects/weather/MeteorRain.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/BubbleFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/floatingTextManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/breakEffectManager.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/engine/gameplay/seaRescue.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/entityManager.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables/context.js","webpack://element_masters/./src/engine/gameplay/interactables/spawn.js","webpack://element_masters/./src/engine/gameplay/interactables/doors.js","webpack://element_masters/./src/engine/gameplay/interactables/teleport.js","webpack://element_masters/./src/engine/gameplay/interactables/effects.js","webpack://element_masters/./src/engine/gameplay/secrets/reveal.js","webpack://element_masters/./src/i18n/tutorialMessages.js","webpack://element_masters/./src/engine/gameplay/secrets/triggers.js","webpack://element_masters/./src/engine/gameplay/secrets/wolfSecret.js","webpack://element_masters/./src/engine/gameplay/secrets/crackBlock.js","webpack://element_masters/./src/engine/gameplay/interactables/checkInteractables.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/gameplay/meteorBreakEffects.js","webpack://element_masters/./src/engine/gameplay/biologicalBreakEffects.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/engine/gameplay/weatherDamage.js","webpack://element_masters/./src/engine/gameplay/weatherCover.js","webpack://element_masters/./src/engine/gameplay/entities.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/weatherEffects.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/engine/gameplay/breakEffects.js","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/sections/chapters/shared/MessageOverlay.jsx","webpack://element_masters/./src/constants/builtInMaps.js","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/mapOperations.js","webpack://element_masters/./src/sections/chapters/editor/viewport/ObjectLinks.jsx","webpack://element_masters/./src/sections/chapters/editor/viewport/EditorTile.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorToolsButton.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorElementsButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorTools/BuiltInMapsModal.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/EditorMapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WorldView.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/BackgroundPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/MusicPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorScene/WeatherPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/styles/EditorSceneButtonStyle.js","webpack://element_masters/./src/sections/chapters/editor/EditorScene.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/OperationsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/CollapsiblePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/PalettePanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/StatisticsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/editorElements/ObjectPropsPanel.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorElements.jsx","webpack://element_masters/./src/sections/chapters/editor/EditorTools.jsx","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPlayMode.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorOperations.js","webpack://element_masters/./src/sections/chapters/editor/editorTools/paintingTools.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorPainting.js","webpack://element_masters/./src/sections/chapters/editor/Editor.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorMaps.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorRegistry.js","webpack://element_masters/./src/sections/chapters/editor/hooks/useEditorSelection.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.(ogg%7Cmp3%7Cwav%7Cm4a)$i"],"sourcesContent":["var map = {\n\t\"./blocks/block_pack_01/block_pack_01.png\": 8473,\n\t\"./blocks/block_pack_01/ice_block_0001.png\": 9745,\n\t\"./blocks/brick_block_0001.png\": 3611,\n\t\"./blocks/desert_pack_01/desert_pack_0001.png\": 7741,\n\t\"./blocks/desert_pack_01/desert_pack_0002.png\": 182,\n\t\"./blocks/desert_pack_01/desert_pack_0003.png\": 1727,\n\t\"./blocks/desert_pack_01/desert_pack_0004.png\": 6352,\n\t\"./blocks/desert_pack_01/desert_pack_0005.png\": 2601,\n\t\"./blocks/desert_pack_01/desert_pack_0006.png\": 6018,\n\t\"./blocks/desert_pack_01/desert_pack_0007.png\": 6523,\n\t\"./blocks/desert_pack_01/desert_pack_0008.png\": 5132,\n\t\"./blocks/desert_pack_01/desert_pack_0009.png\": 1045,\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 9538,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./decorations/stone_pack_01/stone_pack_01_001.png\": 1978,\n\t\"./decorations/stone_pack_01/stone_pack_01_002.png\": 4526,\n\t\"./decorations/stone_pack_01/stone_pack_01_003.png\": 7928,\n\t\"./decorations/stone_pack_01/stone_pack_01_004.png\": 9447,\n\t\"./decorations/stone_pack_01/stone_pack_01_005.png\": 1134,\n\t\"./decorations/stone_pack_01/stone_pack_01_006.png\": 8485,\n\t\"./decorations/stone_pack_01/stone_pack_01_007.png\": 3036,\n\t\"./decorations/stone_pack_01/stone_pack_01_008.png\": 7195,\n\t\"./decorations/stone_pack_01/stone_pack_01_009.png\": 9330,\n\t\"./decorations/stone_pack_01/stone_pack_01_010.png\": 2952,\n\t\"./decorations/trees/01_umbrella_acacia_544x544.png\": 3353,\n\t\"./entities/animals/fish_01.png\": 6781,\n\t\"./entities/animals/fish_catfish.png\": 5756,\n\t\"./entities/animals/fish_clownfish.png\": 2287,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 8905,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./entities/tanks/tank_0000.png\": 2386,\n\t\"./entities/tanks/tank_0001.png\": 3563,\n\t\"./entities/tanks/tank_0002.png\": 5232,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./hazards/death_block_0001.png\": 3527,\n\t\"./interactables/arrows/arrow_down.png\": 7152,\n\t\"./interactables/arrows/arrow_left.png\": 8047,\n\t\"./interactables/arrows/arrow_right.png\": 592,\n\t\"./interactables/arrows/arrow_up.png\": 7263,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./interactables/doors/door_0001.png\": 175,\n\t\"./interactables/ends/end_0001.png\": 8597,\n\t\"./interactables/ledders/ledder_steel_01.png\": 5227,\n\t\"./interactables/ledders/ledder_wooden_01.png\": 3368,\n\t\"./interactables/platforms/platform_0001.png\": 9427,\n\t\"./interactables/portals/portal_01/portal_A_001.png\": 8518,\n\t\"./interactables/portals/portal_01/portal_A_002.png\": 3933,\n\t\"./interactables/portals/portal_01/portal_A_003.png\": 692,\n\t\"./interactables/portals/portal_01/portal_A_004.png\": 5499,\n\t\"./interactables/portals/portal_01/portal_A_005.png\": 3954,\n\t\"./interactables/portals/portal_01/portal_A_006.png\": 8489,\n\t\"./interactables/portals/portal_01/portal_A_007.png\": 4288,\n\t\"./interactables/portals/portal_01/portal_A_008.png\": 8519,\n\t\"./interactables/portals/portal_01/portal_A_009.png\": 2734,\n\t\"./interactables/portals/portal_01/portal_A_010.png\": 3124,\n\t\"./interactables/portals/portal_01/portal_A_011.png\": 4253,\n\t\"./interactables/portals/portal_01/portal_A_012.png\": 6838,\n\t\"./interactables/portals/portal_01/portal_A_013.png\": 5583,\n\t\"./interactables/portals/portal_01/portal_A_014.png\": 9712,\n\t\"./interactables/portals/portal_01/portal_A_015.png\": 5465,\n\t\"./interactables/portals/portal_01/portal_A_016.png\": 1458,\n\t\"./interactables/stone_0001.png\": 1020,\n\t\"./interactables/wooden_box_0001.png\": 1169,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box.png\": 9003,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_ship.png\": 1580,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205,\n\t\"./secrets/crack_block.png\": 2789,\n\t\"./signs/sign01.png\": 9784\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","var map = {\n\t\"./City.png\": 3676,\n\t\"./Forest.png\": 6370,\n\t\"./Preview_143.png\": 574,\n\t\"./UndergroundCave.png\": 2445,\n\t\"./lv8kgjusouta1.png\": 3789,\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719,\n\t\"./seamless_07.png\": 6390\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 2201;","/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  objectMetadata: {}, // Track metadata per object position { index: { health: 100, etc } }\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  projectMaps: {}, // For Project v2.0 (multi-map)\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n  activeRoomIds: [], // IDs of currently active rooms (overlays)\n  seaRescuePoints: 0,\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      let { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n\n      // Migration for Sea Rescue boxes (ID change)\n      const migrateBoxes = (data) => {\n        if (!data || !Array.isArray(data)) return;\n        for (let i = 0; i < data.length; i++) {\n          if (data[i] === 'minispill_sea_rescue_box') {\n            data[i] = 'minispill_sea_rescue_box0';\n          }\n        }\n      };\n\n      if (objectMapData) migrateBoxes(objectMapData);\n      \n      // Migrate all maps in project\n      if (mapData?.maps) {\n        Object.values(mapData.maps).forEach(m => {\n          const mapObjectData = m.objectMapData || m.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          if (mapObjectData) migrateBoxes(mapObjectData);\n        });\n      }\n\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.objectMetadata = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {}; // Load initial metadata from map\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.activeRoomIds = []; // Reset active rooms on new map load\n      state.isGameOver = false;\n      state.seaRescuePoints = 0; // Reset points on new map load\n\n      // If this is a project (v2.0) with multiple maps\n      if (mapData?.maps) {\n        state.projectMaps = mapData.maps;\n      }\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    updateObjectMetadata: (state, action) => {\n      const { index, metadata, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        state.objectMetadata[index] = {\n          ...(state.objectMetadata[index] || {}),\n          ...metadata\n        };\n        if (state.projectMaps[targetId]) {\n          if (!state.projectMaps[targetId].objectMetadata) {\n            state.projectMaps[targetId].objectMetadata = {};\n          }\n          state.projectMaps[targetId].objectMetadata[index] = {\n            ...(state.projectMaps[targetId].objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          state.objectMetadata[index] = {\n            ...(state.objectMetadata[index] || {}),\n            ...metadata\n          };\n        }\n        if (!state.projectMaps[mapId].objectMetadata) {\n          state.projectMaps[mapId].objectMetadata = {};\n        }\n        state.projectMaps[mapId].objectMetadata[index] = {\n          ...(state.projectMaps[mapId].objectMetadata[index] || {}),\n          ...metadata\n        };\n      }\n    },\n    removeObjectAtIndex: (state, action) => {\n      const { index, mapId } = typeof action.payload === 'object' ? action.payload : { index: action.payload, mapId: null };\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = null;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = null;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = null;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          // Make sure we are working with a fresh array if we want to trigger changes reliably\n          room.objectMapData = [...room.objectMapData];\n        }\n        \n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = null;\n        }\n      }\n    },\n    removeTileAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.tileMapData[index] !== undefined) {\n        state.tileMapData[index] = null;\n      }\n    },\n    moveTileInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.tileMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.tileMapData[fromIndex] === undefined) return;\n      state.tileMapData[toIndex] = state.tileMapData[fromIndex];\n      state.tileMapData[fromIndex] = null;\n    },\n    moveObjectInMap: (state, action) => {\n      const { fromIndex, toIndex } = action.payload;\n      const len = state.objectMapData.length;\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= len || toIndex >= len) return;\n      if (state.objectMapData[fromIndex] === undefined) return;\n      state.objectMapData[toIndex] = state.objectMapData[fromIndex];\n      state.objectMapData[fromIndex] = null;\n      \n      // Move metadata as well\n      if (state.objectMetadata[fromIndex]) {\n        state.objectMetadata[toIndex] = state.objectMetadata[fromIndex];\n        delete state.objectMetadata[fromIndex];\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId, mapId } = action.payload;\n      const activeId = state.activeMapData?.meta?.activeMapId || state.activeMapData?.meta?.activeMap || 'main';\n      const targetId = mapId || activeId;\n      if (!mapId || mapId === 'main') {\n        if (state.objectMapData[index] !== undefined) {\n          state.objectMapData[index] = newId;\n        }\n        if (state.projectMaps[targetId]) {\n          const room = state.projectMaps[targetId];\n          if (!room.objectMapData) {\n            const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            room.objectMapData = layerData ? [...layerData] : [];\n          } else {\n            room.objectMapData = [...room.objectMapData];\n          }\n          if (index >= 0 && index < room.objectMapData.length) {\n            room.objectMapData[index] = newId;\n          }\n        }\n      } else if (state.projectMaps[mapId]) {\n        if (mapId === activeId) {\n          if (state.objectMapData[index] !== undefined) {\n            state.objectMapData[index] = newId;\n          }\n        }\n        const room = state.projectMaps[mapId];\n        if (!room.objectMapData) {\n          const layerData = room.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n          room.objectMapData = layerData ? [...layerData] : [];\n        } else {\n          room.objectMapData = [...room.objectMapData];\n        }\n        if (index >= 0 && index < room.objectMapData.length) {\n          room.objectMapData[index] = newId;\n        }\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    toggleRoom: (state, action) => {\n      const roomId = action.payload;\n      if (state.activeRoomIds.includes(roomId)) {\n        state.activeRoomIds = state.activeRoomIds.filter(id => id !== roomId);\n      } else {\n        state.activeRoomIds.push(roomId);\n      }\n    },\n    clearRooms: (state) => {\n      state.activeRoomIds = [];\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    addSeaRescuePoints: (state, action) => {\n      state.seaRescuePoints += action.payload;\n    },\n    captureSeaRescueBox: (state, action) => {\n      const { triggerIndex, boxId, mapWidth } = action.payload;\n      \n      // Find the lowest available trigger in the same column\n      const col = triggerIndex % mapWidth;\n      const mapHeight = state.mapHeight;\n      let targetIndex = -1;\n\n      // Scan from bottom to top in the same column\n      for (let y = mapHeight - 1; y >= 0; y--) {\n        const idx = y * mapWidth + col;\n        const objId = state.objectMapData[idx];\n        \n        if (objId === 'minispill_sea_rescue_trigger') {\n          const meta = state.objectMetadata[idx] || {};\n          if (!meta.capturedBoxId) {\n            targetIndex = idx;\n            break;\n          }\n        }\n      }\n\n      // If no empty trigger in column, use the one that was hit (fallback)\n      const finalIndex = targetIndex !== -1 ? targetIndex : triggerIndex;\n      \n      state.objectMetadata[finalIndex] = {\n        ...(state.objectMetadata[finalIndex] || {}),\n        capturedBoxId: boxId\n      };\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  updateObjectMetadata,\n  removeObjectAtIndex,\n  removeTileAtIndex,\n  moveTileInMap,\n  moveObjectInMap,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  toggleRoom,\n  clearRooms,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  addSeaRescuePoints,\n  captureSeaRescueBox,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\nimport lv_tutorial_messages from \"./translations/lv/tutorial_messages.json\"\nimport no_tutorial_messages from \"./translations/no/tutorial_messages.json\"\nimport en_tutorial_messages from \"./translations/en/tutorial_messages.json\"\nimport ru_tutorial_messages from \"./translations/ru/tutorial_messages.json\"\nimport ja_tutorial_messages from \"./translations/ja/tutorial_messages.json\"\nimport en_game_map_selector from \"./translations/en/game_map_selector.json\"\nimport en_editor_elements from \"./translations/en/editor_elements.json\"\nimport en_editor_scene from \"./translations/en/editor_scene.json\"\nimport en_editor_tools from \"./translations/en/editor_tools.json\"\nimport lv_game_map_selector from \"./translations/lv/game_map_selector.json\"\nimport no_game_map_selector from \"./translations/no/game_map_selector.json\"\nimport ru_game_map_selector from \"./translations/ru/game_map_selector.json\"\nimport ja_game_map_selector from \"./translations/ja/game_map_selector.json\"\nimport lv_editor_elements from \"./translations/lv/editor_elements.json\"\nimport no_editor_elements from \"./translations/no/editor_elements.json\"\nimport ru_editor_elements from \"./translations/ru/editor_elements.json\"\nimport ja_editor_elements from \"./translations/ja/editor_elements.json\"\nimport lv_editor_scene from \"./translations/lv/editor_scene.json\"\nimport no_editor_scene from \"./translations/no/editor_scene.json\"\nimport ru_editor_scene from \"./translations/ru/editor_scene.json\"\nimport ja_editor_scene from \"./translations/ja/editor_scene.json\"\nimport lv_editor_tools from \"./translations/lv/editor_tools.json\"\nimport no_editor_tools from \"./translations/no/editor_tools.json\"\nimport ru_editor_tools from \"./translations/ru/editor_tools.json\"\nimport ja_editor_tools from \"./translations/ja/editor_tools.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"en\",\n        fallbackLng: \"en\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\", \"tutorial\", \"game\", \"editor_elements\", \"editor_scene\", \"editor_tools\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation,\n                tutorial: lv_tutorial_messages,\n                game: lv_game_map_selector,\n                editor_elements: lv_editor_elements,\n                editor_scene: lv_editor_scene,\n                editor_tools: lv_editor_tools\n            },\n            no: {\n                navigation: no_navigation,\n                tutorial: no_tutorial_messages,\n                game: no_game_map_selector,\n                editor_elements: no_editor_elements,\n                editor_scene: no_editor_scene,\n                editor_tools: no_editor_tools\n            },\n            en: {\n                navigation: en_navigation,\n                tutorial: en_tutorial_messages,\n                game: en_game_map_selector,\n                editor_elements: en_editor_elements,\n                editor_scene: en_editor_scene,\n                editor_tools: en_editor_tools\n            },\n            ru: {\n                navigation: ru_navigation,\n                tutorial: ru_tutorial_messages,\n                game: ru_game_map_selector,\n                editor_elements: ru_editor_elements,\n                editor_scene: ru_editor_scene,\n                editor_tools: ru_editor_tools\n            },\n            ja: {\n                navigation: ja_navigation,\n                tutorial: ja_tutorial_messages,\n                game: ja_game_map_selector,\n                editor_elements: ja_editor_elements,\n                editor_scene: ja_editor_scene,\n                editor_tools: ja_editor_tools\n            },\n        },\n    })\n\nexport default i18n\n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n\n        </nav>\n    )\n}\n\n/*\n<NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n* */","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\nimport { useState, useRef, useEffect } from \"react\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    height: 36px;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nconst SettingsButton = styled(NavButton)`\n    ${props => props.$soundOff ? `\n        animation: soundOffPulse 2s ease-in-out infinite;\n        @keyframes soundOffPulse {\n            0% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n            50% { box-shadow: 0 0 12px rgba(86, 255, 138, 0.5); border-color: rgba(86, 255, 138, 0.9); color: #e8fff2; }\n            100% { box-shadow: 0 0 0 rgba(86, 255, 138, 0.0); border-color: rgba(86, 255, 138, 0.3); color: #7dffb4; }\n        }\n    ` : ''}\n`;\n\nconst DropdownContainer = styled.div`\n    position: relative;\n    display: flex;\n`\n\nconst DropdownMenu = styled.div`\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background-color: #333;\n    border: 1px solid #444;\n    border-radius: 4px;\n    padding: 10px;\n    z-index: 2000;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n    min-width: 150px;\n    margin-top: 5px;\n`\n\nconst MenuItem = styled.div`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px;\n    color: white;\n    font-size: 12px;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &:hover {\n        background-color: #444;\n    }\n`\n\nconst ToggleSwitch = styled.div`\n    width: 34px;\n    height: 18px;\n    background-color: ${props => props.$active ? '#f4c542' : '#666'};\n    border-radius: 9px;\n    position: relative;\n    transition: background-color 0.3s;\n\n    &::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        left: ${props => props.$active ? '18px' : '2px'};\n        width: 14px;\n        height: 14px;\n        background-color: white;\n        border-radius: 50%;\n        transition: left 0.3s;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const dropdownRef = useRef(null);\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    const currentLang = i18n.language || 'en'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    const toggleSound = () => {\n        const next = !soundEnabled;\n        setSoundEnabled(next);\n        try { localStorage.setItem('game_sound_enabled', next ? '1' : '0'); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n    };\n\n    useEffect(() => {\n        const handleClickOutside = (event) => {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n                setIsMenuOpen(false);\n            }\n        };\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n\n            <DropdownContainer ref={dropdownRef}>\n                <SettingsButton\n                    onClick={() => setIsMenuOpen(!isMenuOpen)}\n                    title=\"Settings\"\n                    $soundOff={!soundEnabled}\n                >\n                    \n                </SettingsButton>\n                {isMenuOpen && (\n                    <DropdownMenu>\n                        <MenuItem onClick={toggleSound}>\n                            <span>Sound Effects</span>\n                            <ToggleSwitch $active={soundEnabled} />\n                        </MenuItem>\n                        <div style={{ height: '1px', backgroundColor: '#444', margin: '5px 0' }} />\n                        <div style={{ padding: '5px 8px', fontSize: '10px', color: '#888' }}>\n                            GAME SETTINGS\n                        </div>\n                    </DropdownMenu>\n                )}\n            </DropdownContainer>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    text-transform: uppercase;\n    margin: 0;\n    line-height: 1.1;\n\n    .tagline {\n        font-size: 0.7rem;\n        letter-spacing: 0.04em;\n        text-transform: lowercase;\n        opacity: 0.7;\n    }\n`\n\nexport function SectionHeaderNavigationLogo() {\n    const tag = (process.env.APP_GIT_TAG || '').trim();\n\n    return (\n        <StyledLogo>\n            <span>Element Masters</span>\n            {tag ? <span className=\"tagline\">{tag.toLowerCase()}</span> : null}\n        </StyledLogo>\n    )\n}\n","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\nlet _registryMap = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        const resolveSoundsMap = (sounds) => {\n            if (!sounds || typeof sounds !== 'object') return sounds;\n            const out = Array.isArray(sounds) ? [] : {};\n            for (const [k, v] of Object.entries(sounds)) {\n                if (typeof v === 'string') {\n                    out[k] = resolveSound(v);\n                } else if (v && typeof v === 'object') {\n                    out[k] = resolveSoundsMap(v);\n                } else {\n                    out[k] = v;\n                }\n            }\n            return out;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null),\n                sounds: resolveSoundsMap(item.sounds)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        _registryMap = new Map();\n        _registry.forEach(item => {\n            if (item && item.id) _registryMap.set(item.id, item);\n        });\n        _registry.__byId = _registryMap;\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    if (!_registry) return null;\n    if (_registryMap) return _registryMap.get(id) || null;\n    return _registry.find(item => item.id === id);\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n\n        </div>\n      )\n    }\n\nexport default App\n/*\n <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n* */","import Logo1 from './assets/logo/Logo1.png';\nimport Logo2 from './assets/logo/Logo2.png';\nimport Logo3 from './assets/logo/Logo3.png';\nimport Logo4 from './assets/logo/Logo4.png';\nimport Logo5 from './assets/logo/Logo5.png';\n\nconst config = {\n    apiUrl: (typeof process !== 'undefined' && process.env?.REACT_APP_API_URL) || 'http://localhost:8000',\n\n    logo: {\n        URL_LOGO_01: Logo1,\n        URL_LOGO_02: Logo2,\n        URL_LOGO_03: Logo3,\n        URL_LOGO_04: Logo4,\n        URL_LOGO_05: Logo5,\n    },\n\n};\n\nexport default config\n","import React from 'react'\nimport styled from 'styled-components'\nimport config from '../../config'\n\nconst HomeContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    //background-color: darkred;\n    \n    .logoRow{\n        display: flex;\n        flex-direction: row;\n        justify-content: space-between;\n        width: 100%;\n        height: auto;\n        margin: 10px;\n        //border: solid 1px red;\n        \n        & img {\n            width: 350px;\n        }\n    }\n`\n\nexport default function Home() {\n    const LOGO_01 = config.logo.URL_LOGO_01\n    const LOGO_02 = config.logo.URL_LOGO_02\n    const LOGO_03 = config.logo.URL_LOGO_03\n    const LOGO_04 = config.logo.URL_LOGO_04\n    const LOGO_05 = config.logo.URL_LOGO_05\n    console.log(LOGO_01, LOGO_02, LOGO_03, LOGO_04, LOGO_05)\n\n    return (\n        <HomeContainer>\n           <div className={\"logoRow\"}>\n               <img src={LOGO_01} alt=\"logo\" />\n               <img src={LOGO_02} alt=\"logo\" />\n               <img src={LOGO_03} alt=\"logo\" />\n               <img src={LOGO_04} alt=\"logo\" />\n\n           </div>\n        </HomeContainer>\n    )\n}\n","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on viewport area to keep FPS stable\n    this.maxParticles = 400; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(160, Math.floor(area / 2300));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.rect(0, 0, 1.3, 9);\n    g.fill({ color: 0x4aa3ff, alpha: 0.92 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus a small margin for slanted fall\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 100 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    this.seeded = false;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = 300; // Base for 1280x720\n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxFlakes = Math.max(120, Math.floor(area / 3000));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(options = null) {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.circle(0, 0, r);\n    g.fill({ color: 0xffffff, alpha: 0.97 });\n\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    let x, y;\n    if (viewport) {\n      // Spawn within viewport plus margin\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      const minY = options && Number.isFinite(options.minY) ? options.minY : (viewport.y - 10);\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : (viewport.y - 40);\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    } else {\n      x = Math.random() * this.width;\n      const minY = options && Number.isFinite(options.minY) ? options.minY : -10;\n      const maxY = options && Number.isFinite(options.maxY) ? options.maxY : -40;\n      y = minY + Math.random() * Math.max(1, (maxY - minY));\n    }\n\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      // Exponential smoothing (approx 2s to reach 95% of target)\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    if (target === 0) {\n      this.seeded = false;\n    }\n\n    const deficit = target - this.flakes.length;\n    if (!this.seeded && target > 0) {\n      const viewportH = viewport ? viewport.height : this.height;\n      const viewportY = viewport ? viewport.y : 0;\n      const seedCount = Math.min(target, Math.max(24, Math.floor(this.maxFlakes * 0.35)));\n      for (let i = 0; i < seedCount; i++) {\n        this.spawnOne({\n          minY: viewportY - viewportH * 0.35,\n          maxY: viewportY + viewportH * 0.9\n        });\n      }\n      this.seeded = true;\n    }\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40 || (viewport && f.y > viewport.y + viewport.height + 100)) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n    this.windDirection = 1; // 1: from left to right, -1: from right to left\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne(isInitial = false) {\n    const g = new Graphics();\n    const w = 140 + Math.random() * 300; // cloud size\n    const h = 80 + Math.random() * 160;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : this.width;\n\n    let x;\n    if (isInitial) {\n      // Initial scatter across the whole viewport (or map if no viewport)\n      const range = Math.max(vW, this.width) + 800;\n      const startX = viewport ? vX - 400 : -400;\n      x = startX + Math.random() * range;\n    } else if (viewport) {\n      // Dynamic spawn: place in or near viewport so the user sees results quickly\n      // We scatter them in a wider area around viewport [x-400, x+width+400]\n      x = viewport.x - 400 + Math.random() * (viewport.width + 800);\n    } else {\n      // Fallback to edges\n      x = (Math.random() < 0.5 ? -180 : this.width + 180);\n    }\n    \n    const y = vY - 40 + Math.random() * (this.bandHeight - 20); // only in band\n    const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n    const speed = 8 + Math.random() * 22; // horizontal drift speed\n    const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n    // Draw an organic cloud using overlapping circles (soft edges)\n    const rx = w * 0.5;\n    const ry = h * 0.5;\n    const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n    const baseR = Math.min(rx, ry) * 0.55;\n    for (let k = 0; k < circles; k++) {\n      const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n      const dist = 0.2 + Math.random() * 0.35;\n      const cx = Math.cos(t) * rx * dist;\n      const cy = Math.sin(t) * ry * dist;\n      const r = baseR * (0.7 + Math.random() * 0.7);\n      g.circle(cx, cy, r);\n    }\n    // central mass\n    g.circle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n    g.fill({ color: 0xffffff, alpha: 1.0 });\n    g.alpha = 0; // Start invisible for fade-in\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.patches.push({ \n      g, w, h, \n      vx: speed * this.windDirection, \n      vy, \n      targetAlpha: alpha, \n      currentAlpha: 0,\n      phase: Math.random() * Math.PI * 2,\n      dying: false\n    });\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    // We don't change this.width/height here as they are map bounds,\n    // but we can update bandHeight if the screen height changed significantly.\n    this.bandHeight = Math.max(1, Math.floor(h * 0.3)); \n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vW = viewport ? viewport.width : 1280;\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    for (let i = 0; i < targetCount; i++) {\n      this.spawnOne(true);\n      // For initial ones, set alpha immediately\n      if (this.patches.length > 0) {\n        const p = this.patches[this.patches.length - 1];\n        p.currentAlpha = p.targetAlpha;\n        p.g.alpha = p.currentAlpha;\n      }\n    }\n  }\n\n  update(dtMs) {\n    // Live intensity update with smoothing\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else if (this.intensity !== targetIntensity) {\n      this.intensity = targetIntensity;\n    }\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    const vX = viewport ? viewport.x : 0;\n    const vY = viewport ? viewport.y : 0;\n    const vW = viewport ? viewport.width : 1280;\n    const vH = viewport ? viewport.height : 720;\n\n    const bandTop = vY - 100;\n    const bandBottom = vY + this.bandHeight;\n\n    // Adjust cloud count gradually\n    // We scale target count based on viewport width (default 18 for 1280px)\n    const targetCount = Math.round((this.intensity / 100) * 18 * (vW / 1280));\n    \n    const activePatches = this.patches.filter(p => {\n      if (p.dying) return false;\n      if (!viewport) return true;\n      // Only count patches that are within a reasonable distance of the viewport\n      return p.g.x > vX - 1000 && p.g.x < vX + vW + 1000;\n    });\n    \n    if (activePatches.length < targetCount) {\n      // Spawn one cloud per ~300ms if needed, to avoid sudden pops\n      this._spawnTimer = (this._spawnTimer || 0) + dtMs;\n      if (this._spawnTimer > 300 || activePatches.length === 0) {\n        this.spawnOne(activePatches.length === 0);\n        this._spawnTimer = 0;\n      }\n    } else if (activePatches.length > targetCount) {\n      // Mark one for death\n      const toKill = activePatches[0];\n      if (toKill) toKill.dying = true;\n    }\n\n    const toRemove = [];\n    for (let i = 0; i < this.patches.length; i++) {\n      const p = this.patches[i];\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // Alpha handling\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      \n      // Cleanup if too far from viewport (e.g. teleport)\n      if (viewport && !p.dying && (p.g.x < vX - 2500 || p.g.x > vX + vW + 2500)) {\n        p.dying = true;\n      }\n\n      if (p.dying) {\n        p.currentAlpha -= dt * 0.1; // Fade out slowly\n        if (p.currentAlpha <= 0) {\n          toRemove.push(i);\n          continue;\n        }\n      } else if (p.currentAlpha < p.targetAlpha) {\n        p.currentAlpha += dt * 0.05; // Fade in slowly\n        if (p.currentAlpha > p.targetAlpha) p.currentAlpha = p.targetAlpha;\n      }\n\n      p.g.alpha = Math.max(0, Math.min(0.55, p.currentAlpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      const margin = 800; // Increased margin to ensure they don't pop out visibly\n      if (viewport) {\n          const leftBound = vX - margin;\n          const rightBound = vX + vW + margin;\n          if (p.g.x < leftBound) p.g.x = rightBound;\n          if (p.g.x > rightBound) p.g.x = leftBound;\n      } else {\n          if (p.g.x < -margin) p.g.x = W + margin;\n          if (p.g.x > W + margin) p.g.x = -margin;\n      }\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n\n    // Remove dead patches\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.patches[idx];\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n      this.patches.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    // We draw a large rectangle to cover the viewport\n    g.rect(0, 0, w, h);\n    g.fill({ color: 0x9fb7c9, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      // Follow camera\n      if (this.g) this.g.x = viewport.x;\n      if (this.layer1) this.layer1.x = viewport.x;\n      if (this.layer2) this.layer2.x = viewport.x;\n      \n      // We also need to follow Y if the map is tall\n      if (this.g) this.g.y = viewport.y;\n      if (this.layer1) this.layer1.y = viewport.y;\n      if (this.layer2) this.layer2.y = viewport.y;\n    }\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n    this.soundCounter = 0;\n    this.soundStride = 1;\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // Smooth intensity transition\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else if (this.intensity !== targetIntensity) {\n      this.setIntensity(targetIntensity);\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.35, 0.95, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.9, 1.1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    \n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      g.x = viewport.x;\n      g.y = viewport.y;\n      g.rect(0, 0, viewport.width, viewport.height);\n    } else {\n      g.rect(0, 0, this.width, this.height);\n    }\n    g.fill({ color: 0xffffff, alpha: this.flashAlpha });\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    \n    // Get viewport info if available\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, topY;\n    if (viewport) {\n      // Strike within viewport\n      x = Math.floor(viewport.x + this._rand(8, viewport.width - 8));\n      topY = viewport.y - Math.floor(this._rand(10, 40));\n    } else {\n      x = Math.floor(this._rand(8, W - 8));\n      topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    }\n\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2.5, 6, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xE6F8FF;\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n    g.stroke({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n      g.stroke({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n    this._maybeEmitSound();\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _maybeEmitSound() {\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    let stride = 1;\n    if (t >= 0.6) {\n      stride = Math.random() < 0.5 ? 3 : 4;\n    } else if (t >= 0.2) {\n      stride = 2;\n    }\n\n    if (stride <= 1) {\n      this.soundCounter = 0;\n      this.soundStride = 1;\n      if (typeof this.api?.onThunderStrike === 'function') {\n        try { this.api.onThunderStrike(); } catch {}\n      }\n      return;\n    }\n\n    if (this.soundStride !== stride) {\n      this.soundStride = stride;\n      this.soundCounter = 0;\n    }\n\n    this.soundCounter += 1;\n    if (this.soundCounter >= this.soundStride) {\n      this.soundCounter = 0;\n      if (typeof this.api?.onThunderStrike === 'function') {\n        try { this.api.onThunderStrike(); } catch {}\n      }\n    }\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Graphics } from 'pixi.js';\n\n// Lava rain system: similar to rain but red/orange and potentially deals damage (handled by engine)\nexport default class WeatherLavaRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 300; \n  }\n\n  resize(width, height) {\n    const area = width * height;\n    this.maxParticles = Math.max(120, Math.floor(area / 3000));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Lava drops are slightly thicker and more glowing\n    g.rect(0, 0, 2, 10);\n    // Glowing yellow/orange color\n    const color = Math.random() > 0.3 ? 0xffaa00 : 0xffcc00;\n    g.fill({ color, alpha: 0.95 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 100 + Math.random() * (viewport.width + 200);\n      y = viewport.y - 10 - Math.random() * 30;\n    } else {\n      x = Math.random() * this.width;\n      y = -10 - Math.random() * 30;\n    }\n\n    const speed = 400 + Math.random() * 400; // slightly slower/heavier than water rain\n    const vx = (Math.random() * 40 - 20); \n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.1; \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, alive: true });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    let target = Math.floor(this.maxParticles * norm);\n    if (norm > 0 && target < 5) target = 5;\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      const toSpawn = Math.min(deficit, Math.max(1, Math.ceil(target * 0.02)), 30);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    \n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (p) {\n          try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n        }\n      }\n    }\n\n    const dt = dtMs / 1000;\n    const gAcc = 1200; \n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.vy += gAcc * dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Interaction with surfaces / water\n      if (this.api.getLiquidSurfaceY) {\n        const waterY = this.api.getLiquidSurfaceY('water', p.x);\n        if (Number.isFinite(waterY) && p.y >= waterY) {\n          if (typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: waterY, strength: 0.9 });\n          }\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Interaction with solid surfaces\n      if (this.api.isSolidAt(p.x, p.y)) {\n         // Lava drops just vanish on hit with a tiny \"ember\" effect (optional)\n         if (typeof this.api.onLavaImpact === 'function' && Math.random() > 0.5) {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: 0.2 });\n         }\n         p.alive = false;\n         toRemove.push(i);\n         continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      const vY = viewport ? viewport.y : 0;\n      const vH = viewport ? viewport.height : this.height;\n      if (p.y > vY + vH + 50 || p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Radioactive fog overlay: similar to fog but toxic green\nexport default class WeatherRadioactiveFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0;\n\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    this.noiseTex = WeatherRadioactiveFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    this.layer2 = new TilingSprite({ texture: this.noiseTex, width: this.width, height: this.height });\n    \n    this.layer1.tileScale.set(1.2, 1.2);\n    this.layer2.tileScale.set(0.7, 0.9);\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100;\n    return Math.max(0, Math.min(0.75, t * 0.75));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0);\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    g.rect(0, 0, w, h);\n    // Toxic green tint\n    g.fill({ color: 0x1a5c1a, alpha: 1 });\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0015 * dtMs);\n      this.setIntensity(this.intensity + (targetIntensity - this.intensity) * lerpFactor);\n    } else {\n      this.setIntensity(targetIntensity);\n    }\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    if (viewport) {\n      if (this.g) { this.g.x = viewport.x; this.g.y = viewport.y; }\n      if (this.layer1) { this.layer1.x = viewport.x; this.layer1.y = viewport.y; }\n      if (this.layer2) { this.layer2.x = viewport.x; this.layer2.y = viewport.y; }\n    }\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    const pulse = 1 + 0.06 * Math.sin(this.time * 0.001);\n    this._applyAlphas(pulse);\n\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    if (this.layer1) { try { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); } catch {} }\n    if (this.layer2) { try { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); } catch {} }\n    this.layer1 = null; this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.3 + 0.4 * t);\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.7;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    this.speed1 = { x: lerp(0.004, 0.02, t), y: lerp(0.0, 0.01, t) };\n    this.speed2 = { x: lerp(-0.005, -0.015, t), y: lerp(0.003, 0.015, t) };\n  }\n\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 180 + Math.floor(Math.random() * 75); \n      img.data[i] = v * 0.4;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v * 0.4;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Meteor rain system: large falling fireballs that can deal damage via API callback\nexport default class WeatherMeteorRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    this.maxParticles = 15; // Meteors are rare and large\n  }\n\n  resize(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n  spawnOne() {\n    const size = 4 + Math.random() * 8; // Meteor radius\n    const isLarge = size > 9;\n    \n    const g = new Graphics();\n    g.clear();\n    \n    // Core\n    g.circle(0, 0, size);\n    g.fill({ color: 0x555555, alpha: 1 });\n    \n    // Glow/Fire\n    g.circle(0, 0, size * 1.5);\n    g.fill({ color: 0xff4500, alpha: 0.4 });\n    \n    // Tail\n    g.moveTo(-size, 0);\n    g.lineTo(0, -size * 4);\n    g.lineTo(size, 0);\n    g.fill({ color: 0xff8c00, alpha: 0.6 });\n\n    const viewport = this.api.getViewport ? this.api.getViewport() : null;\n    \n    let x, y;\n    if (viewport) {\n      x = viewport.x - 200 + Math.random() * (viewport.width + 400);\n      y = viewport.y - 100 - Math.random() * 200;\n    } else {\n      x = Math.random() * this.width;\n      y = -100 - Math.random() * 200;\n    }\n\n    const vx = 100 + Math.random() * 100; // slanted fall\n    const vy = 400 + Math.random() * 300;\n    \n    g.x = x;\n    g.y = y;\n    // Rotate towards fall direction\n    g.rotation = Math.atan2(vy, vx) - Math.PI/2;\n    \n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, size, isLarge, alive: true, waterTouched: false });\n  }\n\n  update(dtMs) {\n    const targetIntensity = Math.max(0, Math.min(100, this.getIntensity()));\n    if (Math.abs(targetIntensity - this.intensity) > 0.1) {\n      const lerpFactor = 1 - Math.exp(-0.0005 * dtMs);\n      this.intensity += (targetIntensity - this.intensity) * lerpFactor;\n    } else {\n      this.intensity = targetIntensity;\n    }\n\n    const norm = this.intensity / 100;\n    const target = Math.floor(this.maxParticles * norm);\n\n    if (this.particles.length < target && Math.random() < 0.02 * norm) {\n      this.spawnOne();\n    }\n\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      const playerState = typeof this.api.getPlayerState === 'function'\n        ? this.api.getPlayerState()\n        : null;\n      let hitEntity = false;\n      if (playerState) {\n        const px = (playerState.x || 0) + (playerState.width || 0) / 2;\n        const py = (playerState.y || 0) + (playerState.height || 0) / 2;\n        const pr = Math.max(6, Math.max(playerState.width || 0, playerState.height || 0) / 2);\n        const dx = px - p.x;\n        const dy = py - p.y;\n        if ((dx * dx + dy * dy) <= Math.pow(p.size + pr, 2)) {\n          hitEntity = true;\n        } else if (Array.isArray(playerState.entities)) {\n          for (const ent of playerState.entities) {\n            const ex = (ent.x || 0) + (ent.width || 0) / 2;\n            const ey = (ent.y || 0) + (ent.height || 0) / 2;\n            const er = Math.max(6, Math.max(ent.width || 0, ent.height || 0) / 2);\n            const edx = ex - p.x;\n            const edy = ey - p.y;\n            if ((edx * edx + edy * edy) <= Math.pow(p.size + er, 2)) {\n              hitEntity = true;\n              break;\n            }\n          }\n        }\n      }\n\n      if (hitEntity) {\n        if (typeof this.api.onMeteorHit === 'function') {\n          this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'air' });\n        }\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const liquidType = typeof this.api.getLiquidTypeAt === 'function'\n        ? this.api.getLiquidTypeAt(p.x, p.y)\n        : null;\n\n      if (liquidType) {\n        if (liquidType === 'water' && typeof this.api.onWaterImpact === 'function') {\n          if (!p.waterTouched) {\n            this.api.onWaterImpact({ x: p.x, strength: p.isLarge ? 1.4 : 0.8 });\n            p.waterTouched = true;\n          }\n          // Meteors pass through water until hitting solid ground\n        } else {\n          if (liquidType === 'lava' && typeof this.api.onLavaImpact === 'function') {\n            this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.6 : 0.9 });\n          }\n\n          if (typeof this.api.onMeteorHit === 'function') {\n            this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: liquidType });\n          }\n\n          p.alive = false;\n          toRemove.push(i);\n          continue;\n        }\n      }\n\n      // Check collision with solid world\n      if (this.api.isSolidAt(p.x, p.y)) {\n        // Explosion effect\n        if (typeof this.api.onLavaImpact === 'function') {\n           this.api.onLavaImpact({ x: p.x, y: p.y, strength: p.isLarge ? 1.5 : 0.8 });\n        }\n        \n        // Notify engine about meteor hit for damage\n        if (typeof this.api.onMeteorHit === 'function') {\n           this.api.onMeteorHit({ x: p.x, y: p.y, size: p.size, isLarge: p.isLarge, surfaceType: 'ground' });\n        }\n\n        p.alive = false;\n        toRemove.push(i);\n        continue;\n      }\n\n      const viewport = this.api.getViewport ? this.api.getViewport() : null;\n      if (viewport && (p.y > viewport.y + viewport.height + 100 || p.x > viewport.x + viewport.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      } else if (!viewport && (p.y > this.height + 100 || p.x > this.width + 100)) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g) {\n        try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n      }\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.circle(d.x, d.y, size);\n      g.fill({ color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.circle(r.x, r.y, r.r);\n      g.stroke({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// BubbleFX: lightweight bubble particles for underwater ambience\nexport default class BubbleFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.bubbles = [];\n    this.maxBubbles = 120;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.bubbles = [];\n  }\n\n  trigger({ x = 0, y = 0, size = 2, rise = 0.03, life = 1200, drift = 0.02, color = 0xc9ecff } = {}) {\n    if (this.bubbles.length >= this.maxBubbles) return;\n    const g = new Graphics();\n    g.x = 0;\n    g.y = 0;\n    this.node.addChild(g);\n    this.bubbles.push({\n      g,\n      x,\n      y,\n      size,\n      rise,\n      drift,\n      life: 0,\n      max: life,\n      color\n    });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.bubbles.length - 1; i >= 0; i--) {\n      const b = this.bubbles[i];\n      b.life += dt;\n      b.y -= b.rise * dt;\n      b.x += (Math.random() - 0.5) * b.drift * dt;\n      const t = Math.min(1, b.life / b.max);\n      const alpha = 0.7 * (1 - t);\n      const size = Math.max(0.5, b.size * (1 - t * 0.2));\n      const g = b.g;\n      g.clear();\n      g.circle(b.x, b.y, size);\n      g.stroke({ width: 1, color: b.color || 0xc9ecff, alpha: Math.max(0, alpha) });\n      if (b.life >= b.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.bubbles.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      g.stroke({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n\n      // glowing ember\n      g.circle(e.x, e.y, emberSize);\n      g.fill({ color: 0xffa229, alpha: 0.9 * emberAlpha });\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.circle(p.x, p.y, radius);\n      g.fill({ color: 0xdfdad2, alpha: Math.max(0, alpha) });\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite, Sprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.bgContainer = opts.bgContainer || null;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n\n    // Use multiple sample points for better precision\n    // 1. Center\n    const points = [\n      { x: px + pw * 0.5, y: py + ph * 0.5 },\n      { x: px + pw * 0.5, y: py + ph * 0.1 }, // Top\n      { x: px + pw * 0.5, y: py + ph * 0.9 }, // Bottom\n    ];\n\n    for (const pt of points) {\n      const gx = Math.floor(pt.x / this.tileSize);\n      const gy = Math.floor(pt.y / this.tileSize);\n      const idx = gy * this.mapWidth + gx;\n      if (region.tileIndicesSet && region.tileIndicesSet.has(idx)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { if (r.bgNode && r.bgNode.parent) r.bgNode.parent.removeChild(r.bgNode); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n        try { r.bgNode?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._quicksandTex?.destroy(true); } catch {}\n    try { this._waterfallTex?.destroy(true); } catch {}\n    try { this._lavaWaterfallTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterTex?.destroy(true); } catch {}\n    try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    try { this._lavaDetailTex?.destroy(true); } catch {}\n    try { this._waterDetailTex?.destroy(true); } catch {}\n    try { this._quicksandDetailTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._quicksandTex = null;\n    this._waterfallTex = null;\n    this._lavaWaterfallTex = null;\n    this._radioactiveWaterTex = null;\n    this._radioactiveWaterfallTex = null;\n    this._noiseTex = null;\n    this._lavaDetailTex = null;\n    this._waterDetailTex = null;\n    this._quicksandDetailTex = null;\n    if (this._gradTextures) {\n      for (const k in this._gradTextures) {\n        try { this._gradTextures[k].destroy(true); } catch {}\n      }\n      this._gradTextures = null;\n    }\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.bgNode?.parent && r.bgNode.parent.removeChild(r.bgNode); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n      try { r.bgNode?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      try { this._quicksandTex?.destroy(true); } catch {}\n      try { this._waterfallTex?.destroy(true); } catch {}\n      try { this._lavaWaterfallTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterTex?.destroy(true); } catch {}\n      try { this._radioactiveWaterfallTex?.destroy(true); } catch {}\n      try { this._lavaDetailTex?.destroy(true); } catch {}\n      try { this._waterDetailTex?.destroy(true); } catch {}\n      try { this._quicksandDetailTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null; this._quicksandTex = null; this._waterfallTex = null;\n      this._lavaWaterfallTex = null;\n      this._radioactiveWaterTex = null; this._radioactiveWaterfallTex = null;\n      this._lavaDetailTex = null; this._waterDetailTex = null; this._quicksandDetailTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0, y: 0 }; // Static (bubbles added via texture/noise)\n    const lavaDrift = { x: 0, y: 0 }; // Static (floating pieces added via noise/texture)\n    const quicksandDrift = { x: 0, y: 0 }; // Static (pixels fade via noise)\n    const waterfallDrift = { x: 0, y: 0.15 }; // Fast vertical drift\n    const lavaWaterfallDrift = { x: 0, y: 0.12 }; // Lava falls a bit slower/thicker\n    const radioactiveWaterDrift = { x: 0, y: 0 }; // Static\n    const radioactiveWaterfallDrift = { x: 0, y: 0.12 }; // Match lava waterfall speed or similar\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : (r.type === 'quicksand' ? quicksandDrift : (r.type === 'waterfall' ? waterfallDrift : (r.type === 'lava_waterfall' ? lavaWaterfallDrift : (r.type === 'radioactive_waterfall' ? radioactiveWaterfallDrift : (r.type === 'radioactive_water' ? radioactiveWaterDrift : waterDrift)))));\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly with smooth transitions)\n      let targetAlpha = 0.95;\n      if (r.type === 'water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.35 : 0.45;\n      } else if (r.type === 'quicksand') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.55 : 0.75;\n      } else if (r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.30 : 0.45;\n      } else if (r.type === 'radioactive_water') {\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.40 : 0.50;\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        targetAlpha = playerInRegion ? 0.45 : 0.60;\n      }\n\n      // Smooth transition (lerp)\n      if (r.currentAlpha === undefined) r.currentAlpha = sprite.alpha;\n      const lerpFactor = 0.005; // Adjust for speed of transition\n      const alphaDiff = targetAlpha - r.currentAlpha;\n      r.currentAlpha += alphaDiff * Math.min(1, dt * lerpFactor);\n      sprite.alpha = r.currentAlpha;\n\n      // Splash animation for waterfalls\n      if ((r.type === 'waterfall' || r.type === 'lava_waterfall' || r.type === 'radioactive_waterfall') && r.splashG && Array.isArray(r.bottomEdges)) {\n        const g = r.splashG;\n        g.clear();\n        const thickness = Math.max(2, Math.floor(this.tileSize * 0.25));\n        const F = 1000;\n        const cycle = (this._time % F) / F;\n        \n        for (const e of r.bottomEdges) {\n          // Animated foam/splash at the bottom\n          const splashHeight = thickness * (0.8 + Math.sin(this._time * 0.01 + e.x) * 0.2);\n          g.rect(e.x, e.y + this.tileSize - splashHeight, e.w, splashHeight);\n          \n          // Bubbles\n          for (let k = 0; k < 5; k++) {\n             const bx = e.x + ((e.x * 13 + k * 37 + this._time * 0.05) % e.w);\n             const by = e.y + this.tileSize - (Math.random() * thickness * 2);\n             g.circle(bx, by, 1 + Math.random() * 2);\n          }\n        }\n        const splashColor = r.type === 'lava_waterfall' ? 0xffcc00 : (r.type === 'radioactive_waterfall' ? 0xadff2f : 0xffffff);\n        g.fill({ color: splashColor, alpha: 0.5 + Math.sin(this._time * 0.02) * 0.2 });\n      }\n\n      // Animate noise/detail overlays\n      if (r.noise1) {\n        if (r.type === 'water') {\n          r.noise1.tilePosition.y -= 0.015 * dt; // Bubbles go UP\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.001) * 0.005 * dt; \n        } else if (r.type === 'lava') {\n          r.noise1.tilePosition.x += 0.004 * dt; \n          r.noise1.tilePosition.y += 0.002 * dt;\n        } else if (r.type === 'quicksand') {\n          // Fade effect for pixels\n          r.noise1.alpha = 0.4 + Math.sin(this._time * 0.001) * 0.2;\n          r.noise1.tilePosition.x += 0.001 * dt;\n        } else if (r.type.includes('waterfall')) {\n          r.noise1.tilePosition.y += drift.y * 0.8 * dt;\n          r.noise1.tilePosition.x += Math.sin(this._time * 0.002) * 0.02 * dt;\n        } else {\n          r.noise1.tilePosition.x += 0.008 * dt;\n          r.noise1.tilePosition.y += 0.004 * dt;\n        }\n      }\n      if (r.noise2) {\n        if (r.type === 'quicksand') {\n          r.noise2.alpha = 0.2 + Math.cos(this._time * 0.0015) * 0.1;\n        } else if (r.type.includes('waterfall')) {\n          r.noise2.tilePosition.y += drift.y * 1.2 * dt;\n        } else {\n          r.noise2.tilePosition.x -= 0.005 * dt;\n          r.noise2.tilePosition.y += 0.003 * dt;\n        }\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.rect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.fill({ color: 0xc9ecff, alpha: 0.35 });\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.lava_waterfall) return 'lava_waterfall';\n      if (def.flags.radioactive_waterfall) return 'radioactive_waterfall';\n      if (def.flags.waterfall) return 'waterfall';\n      if (def.flags.radioactive_water) return 'radioactive_water';\n      if (def.flags.quicksand) return 'quicksand';\n      if (def.flags.lava) return 'lava';\n      if (def.flags.water) return 'water';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n      _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n        const node = new Container();\n        const mask = new Graphics();\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        const tileIndicesSet = new Set(tileIndices);\n\n        mask.clear();\n        const bleed = 1; // Palielints bleed, lai nosegtu spraugas\n        for (let k = 0; k < tileIndices.length; k++) {\n          const idx = tileIndices[k];\n          const gx = (idx % mapWidth);\n          const gy = Math.floor(idx / mapWidth);\n          mask.rect(\n            gx * tileSize - bleed,\n            gy * tileSize - bleed,\n            tileSize + bleed * 2,\n            tileSize + bleed * 2\n          );\n        }\n        mask.fill({ color: 0xffffff, alpha: 1 });\n\n        const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                     : (type === 'quicksand' ? (this._quicksandTex || (this._quicksandTex = this._createQuicksandTexture(tileSize)))\n                                     : (type === 'waterfall' ? (this._waterfallTex || (this._waterfallTex = this._createWaterfallTexture(tileSize)))\n                                     : (type === 'lava_waterfall' ? (this._lavaWaterfallTex || (this._lavaWaterfallTex = this._createLavaWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_waterfall' ? (this._radioactiveWaterfallTex || (this._radioactiveWaterfallTex = this._createRadioactiveWaterfallTexture(tileSize)))\n                                     : (type === 'radioactive_water' ? (this._radioactiveWaterTex || (this._radioactiveWaterTex = this._createRadioactiveWaterTexture(tileSize)))\n                                     : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize))))))));\n        \n        // v8 addressMode iestatana\n        if (tex.source && tex.source.style) {\n          tex.source.style.addressMode = 'repeat';\n        }\n\n        const tiling = new TilingSprite({\n          texture: tex,\n          width: worldW,\n          height: worldH\n        });\n        \n        tiling.tileScale.set(1, 1);\n        tiling.alpha = type === 'lava' ? 0.60 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.45 : (type === 'quicksand' ? 0.75 : 0.45));\n        node.addChild(tiling);\n\n        // Noise/Detail sli\n        let detailTex1, detailTex2;\n        if (type.includes('lava')) {\n          detailTex1 = this._lavaDetailTex || (this._lavaDetailTex = this._createLavaDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type === 'quicksand') {\n          detailTex1 = this._quicksandDetailTex || (this._quicksandDetailTex = this._createQuicksandDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        } else if (type.includes('radioactive')) {\n          detailTex1 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n          detailTex2 = this._noiseTex;\n        } else {\n          // water, waterfall\n          detailTex1 = this._waterDetailTex || (this._waterDetailTex = this._createWaterDetailTexture());\n          detailTex2 = this._noiseTex || (this._noiseTex = this._createNoiseTexture());\n        }\n\n        if (detailTex1.source && detailTex1.source.style) detailTex1.source.style.addressMode = 'repeat';\n        if (detailTex2.source && detailTex2.source.style) detailTex2.source.style.addressMode = 'repeat';\n\n        const noise1 = new TilingSprite({ texture: detailTex1, width: worldW, height: worldH });\n        const noise2 = new TilingSprite({ texture: detailTex2, width: worldW, height: worldH });\n        \n        if (type === 'water' || type === 'radioactive_water') {\n          noise1.alpha = 0.25; noise2.alpha = 0.15;\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          noise1.alpha = 0.2; noise2.alpha = 0.15;\n        } else if (type === 'lava') {\n          noise1.alpha = 0.4; noise2.alpha = 0.2;\n        } else if (type === 'quicksand') {\n          noise1.alpha = 0.6; noise2.alpha = 0.3;\n        } else {\n          noise1.alpha = 0.12; noise2.alpha = 0.15;\n        }\n        node.addChild(noise1, noise2);\n\n        // LABOJUMS: Maska tiek pievienota k brns, lai t sekotu ldzi node koordintm\n        node.addChild(mask);\n        node.mask = mask;\n\n        // Background slnis (zIndex 28) - lai aizsegtu fonu caur deni\n        let bgNode = null;\n        if (this.bgContainer) {\n          bgNode = new Container();\n          const bgMask = new Graphics();\n          bgMask.clear();\n          for (let k = 0; k < tileIndices.length; k++) {\n            const idx = tileIndices[k];\n            const gx = (idx % mapWidth);\n            const gy = Math.floor(idx / mapWidth);\n            bgMask.rect(gx * tileSize - bleed, gy * tileSize - bleed, tileSize + bleed * 2, tileSize + bleed * 2);\n          }\n          bgMask.fill({ color: 0xffffff, alpha: 1 });\n          bgNode.addChild(bgMask);\n          bgNode.mask = bgMask;\n\n          const bgG = new Graphics();\n          let minY = Infinity, maxY = -Infinity;\n          for (let k = 0; k < tileIndices.length; k++) {\n            const gy = Math.floor(tileIndices[k] / mapWidth) * tileSize;\n            if (gy < minY) minY = gy;\n            if (gy + tileSize > maxY) maxY = gy + tileSize;\n          }\n\n          if (!this._gradTextures) this._gradTextures = {};\n          if (!this._gradTextures[type]) {\n            let color, bottomColor;\n            if (type.includes('lava')) {\n              color = '#ffaa00'; bottomColor = '#884400';\n            } else if (type.includes('radioactive')) {\n              color = '#004400'; bottomColor = '#001100';\n            } else if (type === 'quicksand') {\n              color = '#5d4037'; bottomColor = '#2d1d19';\n            } else { \n              color = '#3a7fb8'; bottomColor = '#0b1d2e';\n            }\n            this._gradTextures[type] = this._createGradientTexture(color, bottomColor);\n          }\n\n          const bgSprite = new Sprite(this._gradTextures[type]);\n          bgSprite.width = worldW;\n          bgSprite.height = worldH;\n          bgSprite.y = 0;\n          \n          bgNode.addChild(bgSprite);\n          this.bgContainer.addChild(bgNode);\n        }\n\n        const baseAlpha = type === 'lava' ? 0.60 : ((type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') ? 0.45 : (type === 'quicksand' ? 0.75 : 0.45));\n\n        if (type === 'water' || type === 'radioactive_water') {\n          const capG = new Graphics();\n          node.addChild(capG);\n          const topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n          // Saglabjam atsauces uz r reistr\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        } else if (type === 'waterfall' || type === 'lava_waterfall' || type === 'radioactive_waterfall') {\n          const splashG = new Graphics();\n          node.addChild(splashG);\n          const bottomEdges = this._computeBottomEdgeSpans(tileIndices, mapWidth, tileSize);\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, splashG, bottomEdges, tileIndicesSet, currentAlpha: baseAlpha });\n        } else {\n          this._regions.push({ type, node, bgNode, mask, sprite: tiling, noise1, noise2, waves: [], tileIndicesSet, currentAlpha: baseAlpha });\n        }\n\n        this.container.addChild(node);\n      }\n\n      _createGradientTexture(topColor, bottomColor) {\n        const canvas = document.createElement('canvas');\n        const size = 64; \n        canvas.width = 2; canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        const g = ctx.createLinearGradient(0, 0, 0, size);\n        g.addColorStop(0, topColor);\n        g.addColorStop(1, bottomColor);\n        ctx.fillStyle = g;\n        ctx.fillRect(0, 0, 2, size);\n        return Texture.from(canvas);\n      }\n\n  _createWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient to remove horizontal bars\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid color instead of gradient\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // No horizontal gradient to remove bars\n    ctx.fillStyle = '#ffcc00';\n    ctx.fillRect(0, 0, size, size);\n\n    // Lava pieces/streaks (vertical) - these go down\n    ctx.fillStyle = '#ffed8a';\n    for (let k = 0; k < 10; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 15;\n      const w = 3 + Math.random() * 4; // Wider \"chunks\"\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid sand color\n    ctx.fillStyle = '#a6915b';\n    ctx.fillRect(0, 0, size, size);\n\n    // grainy texture (static here, will animate pixels via noise)\n    ctx.globalAlpha = 0.3;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 25; k++) {\n      ctx.fillRect(Math.random() * size, Math.random() * size, 1, 1);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Background color\n    ctx.fillStyle = '#3a7fb8';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 15; k++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.4;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 10 + Math.random() * 25;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid toxic green\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Some mini bubbles (static here, noise provides movement)\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random() * 1.5, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createRadioactiveWaterfallTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = 64; \n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    ctx.fillStyle = '#1a5c1a';\n    ctx.fillRect(0, 0, size, size);\n\n    // Vertical streaks\n    ctx.fillStyle = '#adff2f';\n    for (let k = 0; k < 12; k++) {\n      ctx.globalAlpha = 0.15 + Math.random() * 0.3;\n      const x = Math.random() * size;\n      const y = Math.random() * size;\n      const h = 8 + Math.random() * 15;\n      const w = 1 + Math.random() * 2;\n      ctx.fillRect(x, y, w, h);\n      if (y + h > size) ctx.fillRect(x, y - size, w, h);\n    }\n    \n    // Pievienojam burbuus (prasba: \"var pieveinot burbuus kuri iet uzleju k radioactive water\")\n    ctx.fillStyle = '#ffffff';\n    for (let k = 0; k < 6; k++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.3;\n      ctx.beginPath();\n      ctx.arc(Math.random() * size, Math.random() * size, 1 + Math.random(), 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ff8800'; \n    for (let i = 0; i < 10; i++) {\n      ctx.globalAlpha = 0.3 + Math.random() * 0.4;\n      const sw = 12 + Math.random() * 24;\n      const sh = 10 + Math.random() * 20;\n      ctx.fillRect(Math.random() * w, Math.random() * h, sw, sh);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createWaterDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < 12; i++) {\n      ctx.globalAlpha = 0.2 + Math.random() * 0.4;\n      ctx.beginPath();\n      ctx.arc(Math.random() * w, Math.random() * h, 1 + Math.random() * 2, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    return Texture.from(canvas);\n  }\n\n  _createQuicksandDetailTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#5c5031';\n    for (let i = 0; i < 100; i++) {\n      ctx.globalAlpha = 0.1 + Math.random() * 0.5;\n      ctx.fillRect(Math.random() * w, Math.random() * h, 1, 1);\n    }\n    return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 256, h = 256) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = '#ffffff';\n    for(let i=0; i<500; i++) {\n      ctx.globalAlpha = Math.random() * 0.05;\n      ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);\n    }\n\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its bottom boundary per row.\n  _computeBottomEdgeSpans(tileIndices, mapWidth, tileSize) {\n    const set = new Set(tileIndices);\n    const spans = [];\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const below = idx + mapWidth;\n      if (!set.has(below)) {\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.roundRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.fill({ color: this._trackColor, alpha: 0.85 });\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.roundRect(0, 0, innerW, h, radius);\n    this._fill.fill({ color: this._color, alpha: 1 });\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  tiles: 20,\n  tilesAnim: 25,\n  liquidBackground: 28,\n  objBehind: 30,\n  secretsBelow: 35,\n  player: 40,\n  liquids: 45,\n  liquidFx: 48,\n  projectiles: 50,\n  objFront: 60,\n  secretsAbove: 65,\n  weather: 70,\n  fog: 80,\n  overlay: 110,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#3a7fb8');\n    g.addColorStop(0.5, '#5ba3d9');\n    g.addColorStop(1, '#3a7fb8');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (yellow to golden)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#ffaa00');\n    g.addColorStop(1, '#ffcc00');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffff00');\n      grad.addColorStop(1, '#ffaa00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffffff';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\nexport const isQuicksandDef = (def) => !!(def && def.flags && def.flags.quicksand);\nexport const isWaterfallDef = (def) => !!(def && def.flags && def.flags.waterfall);\nexport const isLavaWaterfallDef = (def) => !!(def && def.flags && def.flags.lava_waterfall);\nexport const isRadioactiveWaterDef = (def) => !!(def && def.flags && def.flags.radioactive_water);\nexport const isRadioactiveWaterfallDef = (def) => !!(def && def.flags && def.flags.radioactive_waterfall);\n\n// Generate procedural quicksand frames (cached per tile size)\nexport const createQuicksandFrames = (tileSize) => {\n  const frames = [];\n  const F = 12; // slightly more frames for smoother slow movement\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base sand color (brownish yellow)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#a6915b');\n    g.addColorStop(1, '#7d6d42');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // grainy texture / swirling patterns\n    const t = i / F;\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#5c5031';\n    for (let k = 0; k < 4; k++) {\n       const y = Math.floor((tileSize / 4) * k + (t * tileSize)) % tileSize;\n       ctx.fillRect(0, y, tileSize, 1);\n    }\n    \n    // random grains\n    ctx.globalAlpha = 0.15;\n    ctx.fillStyle = '#d1ba7d';\n    const count = Math.max(5, Math.floor(tileSize * 0.25));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 43 + i * 7) % tileSize);\n      const ry = Math.floor((k * 61 + i * 11) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural waterfall frames\nexport const createWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent blue (izmantojam dens krsas)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(42, 93, 143, 0.5)');\n    g.addColorStop(0.5, 'rgba(91, 163, 217, 0.5)');\n    g.addColorStop(1, 'rgba(42, 93, 143, 0.5)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // sas vertiklas svtrias\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    const count = 6;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.3);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava waterfall frames\nexport const createLavaWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 10;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base transparent lava colors\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(255, 170, 0, 0.6)');\n    g.addColorStop(0.5, 'rgba(255, 204, 0, 0.6)');\n    g.addColorStop(1, 'rgba(255, 170, 0, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated lava streaks\n    const t = i / F;\n    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';\n    const count = 5;\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.4);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive water frames\nexport const createRadioactiveWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 12;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient (toxic green)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#1a5c1a');\n    g.addColorStop(1, '#0d2e0d');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    \n    // Bubbles\n    ctx.globalAlpha = 0.6;\n    ctx.fillStyle = '#32cd32';\n    const bubbleCount = 4;\n    for (let k = 0; k < bubbleCount; k++) {\n      const bx = Math.floor((k * 137 + i * 2) % tileSize);\n      const by = Math.floor((tileSize + k * 43 - (t * tileSize + k * 10)) % tileSize);\n      const size = 1 + (Math.sin(t * Math.PI + k) * 0.5 + 0.5) * 2;\n      ctx.beginPath();\n      ctx.arc(bx, by, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    // Glow streaks\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#adff2f';\n    for (let b = 0; b < 2; b++) {\n      const y = Math.floor((tileSize / 2) * b + Math.sin((t + b * 0.5) * Math.PI * 2) * (tileSize * 0.1));\n      ctx.fillRect(0, y, tileSize, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural radioactive waterfall frames\nexport const createRadioactiveWaterfallFrames = (tileSize) => {\n  const frames = [];\n  const F = 16; // more frames for slower motion\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, 'rgba(26, 92, 26, 0.6)');\n    g.addColorStop(0.5, 'rgba(50, 205, 50, 0.6)');\n    g.addColorStop(1, 'rgba(26, 92, 26, 0.6)');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    const t = i / F;\n    ctx.fillStyle = 'rgba(173, 255, 47, 0.5)';\n    const count = 4; // fewer streaks\n    for (let k = 0; k < count; k++) {\n      const x = Math.floor((tileSize / count) * k + (tileSize / (count*2)) + Math.sin(t * Math.PI * 2 + k) * 2);\n      const h = Math.floor(tileSize * 0.2);\n      const y = Math.floor((t * tileSize + k * (tileSize / count)) % tileSize);\n      ctx.fillRect(x, y, 2, h);\n      if (y + h > tileSize) {\n        ctx.fillRect(x, y - tileSize, 2, h);\n      }\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3, minWidth = 0, minHeight = 0 }) {\n    if (!this.container) return;\n    this.clear();\n\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = w;\n    solid.height = h;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: w, height: h });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = h / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight, minWidth = 0, minHeight = 0) {\n    const w = Math.max(worldWidth, minWidth);\n    const h = Math.max(worldHeight, minHeight);\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = w;\n      this.bgSprite.height = h;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = w;\n      this.imgSprite.height = h;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = h / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl, minWidth = 0, minHeight = 0 } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n      minWidth,\n      minHeight\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const resize = (worldWidth, worldHeight, minWidth = 0, minHeight = 0) => {\n    if (parallaxHelper) {\n      parallaxHelper.resize(worldWidth, worldHeight, minWidth, minHeight);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    resize,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container, Text, Rectangle } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n\n  // Static sprite sheet frame (grid-based)\n  if (!spr && def.spriteSheet && def.spriteSheet.enabled && def.texture && Number.isFinite(Number(def.spriteSheet.frameIndex))) {\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    if (source && source.width > 1 && source.height > 1) {\n      const totalSprites = Math.max(1, Number(def.spriteSheet.totalSprites) || 1);\n      const columns = Math.max(1, Number(def.spriteSheet.columns) || 1);\n      const rows = Math.ceil(totalSprites / columns);\n      const frameWidth = Number(def.spriteSheet.frameWidth) || (source.width / columns);\n      const frameHeight = Number(def.spriteSheet.frameHeight) || (source.height / rows);\n      const frameIndex = Math.max(0, Math.min(totalSprites - 1, Number(def.spriteSheet.frameIndex)));\n      const col = frameIndex % columns;\n      const row = Math.floor(frameIndex / columns);\n      const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n      spr = new Sprite(new Texture({ source, frame: rect }));\n    }\n  }\n\n  // Ja nav tekstru masva vai tas ir tuks, minm parasto tekstru\n  if (!spr && def.texture) {\n    const tex = getTexture(def.texture);\n    if (tex) {\n      spr = new Sprite(tex);\n    }\n  }\n\n  // Ja joprojm nav spr (piemram, nav tekstras), prbaudm editorIcon\n  if (!spr && def.editorIcon) {\n    spr = new Text({\n        text: def.editorIcon,\n        style: {\n            fontSize: 24,\n            fill: 0xffffff,\n            fontWeight: 'bold',\n            dropShadow: true,\n            dropShadowColor: 0x000000,\n            dropShadowBlur: 4,\n            dropShadowDistance: 2\n        }\n    });\n    // Centrjam tekstu tile ietvaros\n    spr.anchor.set(0.5, 0.5);\n    // T k ms lietojam anchor 0.5, mums bs jpielgo pozcija vlk vai eit\n    // Bet buildSpriteFromDef parasti atgrie objektu, kura anchor ir (0,0) pc noklusjuma\n    // lai tas atbilstu tileSize pozicionanai.\n    // Tpc iestatsim anchor uz 0, bet nedaudz nobdsim?\n    // Labk lietot anchor 0.5 un layerBuilder- pieskaitt tileSize/2.\n  }\n\n  if (!spr) {\n    spr = new Sprite(Texture.WHITE);\n  }\n\n  if (spr instanceof Sprite) {\n    spr.anchor.set(0, 0);\n  } else if (spr instanceof Text) {\n    // Tekstam ms gribam, lai tas btu centr, tpc atstjam 0.5\n  }\n  \n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = Math.round(dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth));\n  container.y = Math.round(playerState.y || 0);\n};\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef, isQuicksandDef, isWaterfallDef, isLavaWaterfallDef, isRadioactiveWaterDef, isRadioactiveWaterfallDef, createWaterFrames, createLavaFrames, createQuicksandFrames } from './liquidRendering';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const { bgRef, objBehindRef, objFrontRef, roomBgRef, roomObjBehindRef, roomObjFrontRef, secretLayerRef } = refs;\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous and destroy old children to prevent memory leaks/ticker buildup\n  const safeDestroy = (container) => {\n    if (!container) return;\n    const children = container.removeChildren();\n    children.forEach(child => {\n      try {\n        // Destroy child but KEEP textures in cache\n        child.destroy({ children: true, texture: false });\n      } catch (e) {}\n    });\n  };\n\n  safeDestroy(bgRef);\n  safeDestroy(objBehindRef);\n  safeDestroy(objFrontRef);\n  safeDestroy(roomBgRef);\n  safeDestroy(roomObjBehindRef);\n  safeDestroy(roomObjFrontRef);\n  safeDestroy(secretLayerRef?.below);\n  safeDestroy(secretLayerRef?.above);\n\n  const secretOverlays = {\n    below: new Map(),\n    above: new Map()\n  };\n\n  // 1. Render main map\n  renderMapContent(refs, options, 0, 0, secretOverlays, bgRef, objBehindRef, objFrontRef);\n\n  // 2. Render active rooms\n  const { activeRoomIds, maps, objectMetadata, secretMapData, mapWidth, tileSize } = options;\n  if (activeRoomIds && activeRoomIds.length > 0 && maps && objectMetadata && secretMapData) {\n    activeRoomIds.forEach(roomId => {\n      const roomMap = maps[roomId];\n      if (!roomMap) return;\n\n      // Find the room_area on the current map that links to this room\n      const roomAreaIndex = Object.keys(objectMetadata).find(idx => \n        secretMapData[idx] === 'room_area' && objectMetadata[idx].linkedMapId === roomId\n      );\n\n      if (roomAreaIndex !== undefined) {\n        const idx = parseInt(roomAreaIndex);\n        const ox = Math.round((idx % mapWidth) * tileSize);\n        const oy = Math.round(Math.floor(idx / mapWidth) * tileSize);\n        \n        const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n        \n        const roomOptions = {\n          ...options,\n          mapWidth: roomMap.mapWidth || roomMap.width,\n          mapHeight: roomMap.mapHeight || roomMap.height,\n          tileMapData: roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [],\n          objectMapData: roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [],\n          secretMapData: roomSecrets,\n          objectMetadata: roomMap.objectMetadata || {},\n          mapType: 'room',\n          backgroundColor: roomMap.selectedBackgroundColor,\n          activeRoomIds: [] // Avoid recursion\n        };\n\n        renderMapContent(refs, roomOptions, ox, oy, secretOverlays, roomBgRef, roomObjBehindRef, roomObjFrontRef);\n      }\n    });\n  }\n\n  // 3. Render collected secret overlays\n  renderSecretOverlays(refs, options, secretOverlays);\n};\n\nconst renderMapContent = (refs, options, offsetX, offsetY, secretOverlays, targetBg, targetObjBehind, targetObjFront) => {\n  const {\n    mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData,\n    revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType,\n    activeRoomIds, maps\n  } = options;\n\n  const { secretLayerRef } = refs;\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Pre-calculate indices covered by active rooms to hide main map content under them\n  const activeRoomIndices = new Set();\n  const roomWindowIndices = new Set(); // Store indices where rooms have windows\n\n  if (mapType !== 'room' && activeRoomIds && activeRoomIds.length > 0 && maps) {\n      Object.entries(objectMetadata || {}).forEach(([idxStr, meta]) => {\n          const idx = parseInt(idxStr);\n          if (secretMapData?.[idx] === 'room_area' && meta?.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n              const roomMap = maps[meta.linkedMapId];\n              if (!roomMap) return;\n\n              const roomSecrets = roomMap.secretMapData || (roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data) || [];\n              const rw = meta.width || 1;\n              const rh = meta.height || 1;\n              const rx = idx % mapWidth;\n              const ry = Math.floor(idx / mapWidth);\n              const rMapW = roomMap.mapWidth || roomMap.width || rw;\n\n              for (let dy = 0; dy < rh; dy++) {\n                  for (let dx = 0; dx < rw; dx++) {\n                      const worldIdx = (ry + dy) * mapWidth + (rx + dx);\n                      const localIdx = dy * rMapW + dx;\n                      \n                      // In the main map context, roomWindowIndices are spots where we DON'T hide the main map\n                      // because the room has a \"hole\" (window) there.\n                      // A \"hole\" is defined as no tile AND no object in the room map.\n                      const roomTiles = roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data) || [];\n                      const roomObjs = roomMap.objectMapData || (roomMap.layers?.find(l => l.name === 'entities')?.data) || [];\n                      \n                      if (!roomTiles[localIdx] && !roomObjs[localIdx]) {\n                          roomWindowIndices.add(worldIdx);\n                          activeRoomIndices.add(worldIdx); // Also hide main map tiles here to see background through windows\n                      } else {\n                          activeRoomIndices.add(worldIdx);\n                      }\n                  }\n              }\n          }\n      });\n  }\n\n  // Add background color for rooms\n  if (mapType === 'room') {\n    const bgColorStr = options.backgroundColor || '#1a1a1a';\n    const bgColorHex = bgColorStr.startsWith('#') ? \n        parseInt(bgColorStr.substring(1), 16) : \n        0x1a1a1a;\n    \n    const roomBg = new Graphics();\n    const floorTileIds = new Set(tileMapData.filter(id => id));\n    const floorObjIds = new Set(objectMapData.filter(id => id && !id.includes('player')));\n\n    for (let i = 0; i < mapWidth * mapHeight; i++) {\n        const id = tileMapData[i];\n        const objId = objectMapData[i];\n        \n        // Window logic: if there is no tile AND no object, it's a window (transparent)\n        // Be very strict about what counts as content\n        const hasContent = (id && id !== \"0\") || (objId && objId !== \"0\" && !objId.includes('player'));\n\n        if (hasContent) {\n            const tx = i % mapWidth;\n            const ty = Math.floor(i / mapWidth);\n            const x = offsetX + tx * tileSize;\n            const y = offsetY + ty * tileSize;\n            \n            // Use a slightly larger rect (0.5px) to prevent gaps/bleeding between tiles\n            // but keep the overall room boundary sharp\n            roomBg.rect(x - 0.25, y - 0.25, tileSize + 0.5, tileSize + 0.5);\n        }\n    }\n    roomBg.fill({ color: bgColorHex, alpha: 1 });\n    targetBg.addChild(roomBg);\n  }\n\n  // Background tiles\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    const secretId = secretMapData?.[i];\n\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    // Hide content if it's under an active room\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area'; // Don't treat room_area as a classic secret filter if it's used as a window\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n\n    if (isInSecretArea && isSecretRevealed) {\n      const filterColor = secretDef?.filterColorInGame || secretDef?.filterColor || 'rgba(0, 0, 0, 0.6)';\n      const renderAbove = secretDef?.renderAbovePlayer;\n      const key = `${x},${y}`;\n      if (renderAbove) {\n        secretOverlays.above.set(key, filterColor);\n      } else {\n        secretOverlays.below.set(key, filterColor);\n      }\n    }\n\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      renderOnSecretLayer = true;\n    } else if (isInSecretArea && isSecretRevealed) {\n      renderOnSecretLayer = true;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def) || isWaterfallDef(def) || isLavaWaterfallDef(def) || isRadioactiveWaterDef(def) || isRadioactiveWaterfallDef(def) || def.type === 'entity' || def.subtype === 'platform') {\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    if (renderOnSecretLayer) {\n      let backingSprite;\n      if (frames && frames.length > 0) {\n        backingSprite = new AnimatedSprite(frames);\n        backingSprite.animationSpeed = sprite.animationSpeed;\n        backingSprite.play();\n      } else if (sprite.texture) {\n        backingSprite = new Sprite(sprite.texture);\n      }\n\n      if (backingSprite) {\n        backingSprite.x = x;\n        backingSprite.y = y;\n        backingSprite.width = tileSize;\n        backingSprite.height = tileSize;\n        targetBg.addChild(backingSprite);\n      }\n\n      const backing = new Graphics();\n      backing.rect(x, y, tileSize, tileSize);\n      backing.fill({ color: 0x000000, alpha: 0.7 });\n      targetBg.addChild(backing);\n\n      sprite.alpha = 0.4;\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        targetBg.addChild(sprite);\n      }\n    } else {\n      targetBg.addChild(sprite);\n    }\n  }\n\n  // Objects\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n\n    const secretId = secretMapData?.[i];\n    if (mapType === 'room' && secretId === 'room_area') {\n        continue;\n    }\n\n    if (activeRoomIndices.has(i)) {\n        continue;\n    }\n\n    const def = getDef(id);\n    if (!def || def.type === 'entity' || def.subtype === 'platform' || def.subtype === 'pushable' || def.isPushable) continue;\n\n    const meta = (objectMetadata && objectMetadata[i]) || {};\n    const maxH = def.maxHealth || 100;\n    const health = meta.health !== undefined ? meta.health : maxH;\n\n    let visualElement;\n    if (def.spriteSheet && def.spriteSheet.enabled) {\n      const totalSprites = def.spriteSheet.totalSprites || 1;\n      const columns = def.spriteSheet.columns || totalSprites;\n      \n      const healthPercent = Math.max(0, Math.min(100, (health / maxH) * 100));\n      let frameIndex = 0;\n      \n      if (meta.currentFrame !== undefined) {\n        frameIndex = meta.currentFrame;\n      } else if (def.subtype === 'door' && mapType === 'room') {\n        frameIndex = def.interaction?.frames?.inside || 2;\n      } else if (Number.isFinite(Number(def.spriteSheet?.frameIndex))) {\n        frameIndex = Number(def.spriteSheet.frameIndex);\n      } else {\n        frameIndex = Math.floor((1 - healthPercent / 100) * (totalSprites - 1));\n      }\n      \n      frameIndex = Math.max(0, Math.min(totalSprites - 1, frameIndex));\n\n      const baseTexture = getTexture(def.texture);\n      const source = baseTexture?.source;\n      if (source && source.width > 1) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const frameWidth = texWidth / columns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / columns);\n        const col = frameIndex % columns;\n        const row = Math.floor(frameIndex / columns);\n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        visualElement = new Sprite(new Texture({ source: source, frame: rect }));\n      } else {\n        visualElement = buildSpriteFromDef(def);\n      }\n    } else {\n      visualElement = buildSpriteFromDef(def);\n    }\n\n    if (!visualElement) continue;\n\n    const x = offsetX + (i % mapWidth) * tileSize;\n    const y = offsetY + Math.floor(i / mapWidth) * tileSize;\n    \n    const renderOffsetX = Number(def.render?.offsetX) || 0;\n    const renderOffsetY = Number(def.render?.offsetY) || 0;\n    const overlapX = Number(def.render?.overlapX) || 0;\n    const overlapY = Number(def.render?.overlapY) || 0;\n    if (visualElement.anchor && visualElement.anchor.x === 0.5) {\n      visualElement.x = tileSize / 2 + renderOffsetX - overlapX / 2;\n      visualElement.y = tileSize / 2 + renderOffsetY - overlapY / 2;\n    } else {\n      visualElement.x = renderOffsetX - overlapX / 2;\n      visualElement.y = renderOffsetY - overlapY / 2;\n    }\n    \n    const tileW = meta.width || def.width || 1;\n    const tileH = meta.height || def.height || 1;\n    const objWidth = tileW * tileSize;\n    const objHeight = tileH * tileSize;\n    visualElement.width = objWidth + overlapX;\n    visualElement.height = objHeight + overlapY;\n\n    const container = new Container();\n    const isLargeDecoration = def.type === 'decoration' && (tileW > 1 || tileH > 1);\n    const anchorOffsetX = isLargeDecoration ? -Math.floor(tileW / 2) * tileSize : 0;\n    const anchorOffsetY = isLargeDecoration ? -(tileH - 1) * tileSize : 0;\n    container.x = x + anchorOffsetX;\n    container.y = y + anchorOffsetY;\n    container.isRoomContent = mapType === 'room';\n    \n    if (id === 'minispill_sea_rescue_ship' || id === 'minispill_sea_rescue_trigger') {\n      container.isSeaRescueShipPart = true;\n      container.baseX = container.x;\n      container.baseY = container.y;\n    }\n    \n    if (id.startsWith('minispill_sea_rescue_box')) {\n      container.isSeaRescueBox = true;\n      container.baseY = container.y;\n      container.bubbles = def.bubbles;\n      container.boxWidth = def.width || 1;\n      container.boxHeight = def.height || 1;\n    }\n    \n    const isWeatherTrigger = def.type === 'weather_trigger';\n    const isMessageTrigger = def.type === 'message_trigger';\n    const isWolfSecret = def.type === 'wolf_secret';\n    const shouldShowAnyway = (isWeatherTrigger || isMessageTrigger || isWolfSecret) && (isEditor || isEditorPlayMode);\n    \n    if (def.isHiddenInGame && !isEditor && !shouldShowAnyway) {\n      if (meta.capturedBoxId) {\n        visualElement.visible = false;\n      } else {\n        container.visible = false;\n      }\n    }\n\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInSecretArea = (secretSubtype === 'secret' || secretSubtype === 'above') && secretId !== 'room_area';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    if (isInSecretArea && !isSecretRevealed && !isEditor) {\n      container.visible = false;\n    }\n\n    container.addChild(visualElement);\n\n    if (meta.capturedBoxId) {\n      const boxDef = getDef(meta.capturedBoxId);\n      if (boxDef) {\n        let boxSprite;\n        if (boxDef.spriteSheet && boxDef.spriteSheet.enabled) {\n          const bBaseTexture = getTexture(boxDef.texture);\n          const bSource = bBaseTexture?.source;\n          if (bSource && bSource.width > 1) {\n            const bCols = boxDef.spriteSheet.columns || boxDef.spriteSheet.totalSprites || 1;\n            const bTotal = boxDef.spriteSheet.totalSprites || 1;\n            const bFrameIndex = Math.max(0, Math.min(bTotal - 1, Number(boxDef.spriteSheet.frameIndex) || 0));\n            const bFrameWidth = bSource.width / bCols;\n            const bFrameHeight = bSource.height / Math.ceil(bTotal / bCols);\n            const bCol = bFrameIndex % bCols;\n            const bRow = Math.floor(bFrameIndex / bCols);\n            const bRect = new Rectangle(bCol * bFrameWidth, bRow * bFrameHeight, bFrameWidth, bFrameHeight);\n            boxSprite = new Sprite(new Texture({ source: bSource, frame: bRect }));\n          }\n        }\n        if (!boxSprite) {\n          boxSprite = buildSpriteFromDef(boxDef);\n        }\n        if (boxSprite) {\n          boxSprite.width = tileSize * 0.8;\n          boxSprite.height = tileSize * 0.8;\n          boxSprite.x = (objWidth - boxSprite.width) / 2;\n          boxSprite.y = (objHeight - boxSprite.height) / 2 - 4;\n          container.addChild(boxSprite);\n        }\n      }\n    }\n\n    if (def.isDestructible && health < maxH && health > 0) {\n      try {\n        const hb = new HealthBar({\n          width: objWidth,\n          height: 4,\n          offsetX: 0,\n          offsetY: -5\n        });\n        hb.update(health, maxH);\n        container.addChild(hb);\n      } catch (e) {}\n    }\n\n    const renderAbove = meta.renderAbovePlayer !== undefined ? !!meta.renderAbovePlayer : !!def.renderAbovePlayer;\n    if (renderAbove) {\n      targetObjFront.addChild(container);\n    } else {\n      targetObjBehind.addChild(container);\n    }\n  }\n};\n\nconst renderSecretOverlays = (refs, options, overlays) => {\n  const { tileSize } = options;\n  const { secretLayerRef } = refs;\n\n  const drawOverlay = (map, container) => {\n    if (!container || map.size === 0) return;\n    const overlay = new Graphics();\n    map.forEach((filterColor, key) => {\n      const [x, y] = key.split(',').map(Number);\n      const match = filterColor.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n      if (match) {\n        const r = parseInt(match[1]);\n        const g = parseInt(match[2]);\n        const b = parseInt(match[3]);\n        const a = match[4] ? parseFloat(match[4]) : 1;\n        overlay.rect(x, y, tileSize, tileSize);\n        overlay.fill({ color: (r << 16) | (g << 8) | b, alpha: a });\n      }\n    });\n    container.addChild(overlay);\n  };\n\n  drawOverlay(overlays.below, secretLayerRef?.below);\n  drawOverlay(overlays.above, secretLayerRef?.above);\n};\n","import { Container, Text } from 'pixi.js';\nimport floatConfig from '../../../../assets/json/system/floating_text.json';\n\nexport const createFloatingTextManager = (layer) => {\n  const items = [];\n  const cfg = floatConfig || {};\n  const defaultCfg = cfg.default || {};\n  const critCfg = cfg.crit || {};\n\n  const add = ({\n    x,\n    y,\n    text,\n    color,\n    fontSize = 14,\n    ttlMs = 900,\n    amount,\n    crit\n  }) => {\n    if (!layer || !Number.isFinite(x) || !Number.isFinite(y) || !text) return;\n\n    const amountValue = Number.isFinite(amount) ? amount : null;\n    const critThreshold = Number.isFinite(critCfg.threshold) ? critCfg.threshold : null;\n    const isCrit = !!crit || (amountValue !== null && critThreshold !== null && Math.abs(amountValue) >= critThreshold);\n\n    const baseColor = color ? String(color) : (defaultCfg.color || '#ff3b3b');\n    const finalColor = isCrit ? (critCfg.color || baseColor) : baseColor;\n    const finalFontSize = isCrit ? (critCfg.fontSize || Math.round((defaultCfg.fontSize || fontSize) * 1.2)) : (defaultCfg.fontSize || fontSize);\n    const finalTtl = isCrit ? (critCfg.ttlMs || defaultCfg.ttlMs || ttlMs) : (defaultCfg.ttlMs || ttlMs);\n    const riseSpeed = isCrit ? (critCfg.riseSpeed || defaultCfg.riseSpeed || 0.04) : (defaultCfg.riseSpeed || 0.04);\n    const jitterX = Number.isFinite(defaultCfg.jitterX) ? defaultCfg.jitterX : 6;\n    const jitterY = Number.isFinite(defaultCfg.jitterY) ? defaultCfg.jitterY : 2;\n    const prefix = isCrit && typeof critCfg.prefix === 'string' ? critCfg.prefix : '';\n    const suffix = isCrit && typeof critCfg.suffix === 'string' ? critCfg.suffix : '';\n    const finalText = `${prefix}${text}${suffix}`;\n\n    const label = new Text({\n      text: String(finalText),\n      style: {\n        fontFamily: 'monospace',\n        fontSize: finalFontSize,\n        fill: finalColor,\n        stroke: '#000000',\n        strokeThickness: 2,\n        dropShadow: true,\n        dropShadowColor: '#000000',\n        dropShadowBlur: 2,\n        dropShadowDistance: 1\n      }\n    });\n\n    label.anchor.set(0.5, 1);\n    const jitterXValue = (Math.random() * 2 - 1) * jitterX;\n    const jitterYValue = (Math.random() * 2 - 1) * jitterY;\n    label.position.set(x + jitterXValue, y + jitterYValue);\n    layer.addChild(label);\n\n    items.push({\n      label,\n      ttl: finalTtl,\n      total: finalTtl,\n      vy: -riseSpeed\n    });\n  };\n\n  const update = (deltaMs) => {\n    if (!items.length) return;\n    for (let i = items.length - 1; i >= 0; i--) {\n      const item = items[i];\n      item.ttl -= deltaMs;\n      if (item.ttl <= 0) {\n        try { item.label.destroy(); } catch {}\n        items.splice(i, 1);\n        continue;\n      }\n      item.label.y += item.vy * deltaMs;\n      item.label.alpha = Math.max(0, item.ttl / item.total);\n    }\n  };\n\n  return { add, update };\n};\n\nexport const createFloatingTextLayer = () => new Container();\n","import { Container, Graphics } from 'pixi.js';\n\nexport const createBreakEffectLayer = () => {\n  const layer = new Container();\n  layer.sortableChildren = true;\n  return layer;\n};\n\nexport const createBreakEffectManager = (layer) => {\n  const particles = [];\n\n  const add = ({ x, y, config }) => {\n    if (!layer || !config) return;\n    const count = Math.max(1, Number(config.count) || 12);\n    const speed = Math.max(0.2, Number(config.speed) || 2);\n    const lifeMs = Math.max(120, Number(config.lifeMs) || 600);\n    const size = Math.max(1, Number(config.size) || 2);\n    const gravity = Number.isFinite(Number(config.gravity)) ? Number(config.gravity) : 0.02;\n    const shape = config.shape === 'circle' ? 'circle' : 'square';\n    const angleRange = Array.isArray(config.angleRange) && config.angleRange.length >= 2 ? config.angleRange : null;\n    const colors = Array.isArray(config.colors) && config.colors.length ? config.colors : [0xffffff];\n    const chunks = config.chunks && typeof config.chunks === 'object' ? config.chunks : null;\n\n    for (let i = 0; i < count; i++) {\n      const angle = angleRange\n        ? (Number(angleRange[0]) + Math.random() * (Number(angleRange[1]) - Number(angleRange[0])))\n        : (Math.random() * Math.PI * 2);\n      const sp = speed * (0.5 + Math.random() * 0.9);\n      const g = new Graphics();\n      if (shape === 'circle') {\n        g.circle(0, 0, size * 0.6);\n      } else {\n        g.rect(-size / 2, -size / 2, size, size);\n      }\n      g.fill({ color: colors[i % colors.length], alpha: 1 });\n      g.x = x;\n      g.y = y;\n      layer.addChild(g);\n      particles.push({\n        g,\n        x,\n        y,\n        vx: Math.cos(angle) * sp,\n        vy: Math.sin(angle) * sp,\n        life: lifeMs,\n        maxLife: lifeMs,\n        gravity\n      });\n    }\n\n    if (chunks) {\n      const chunkCount = Math.max(0, Number(chunks.count) || 0);\n      const chunkSpeed = Math.max(0.3, Number(chunks.speed) || speed * 1.2);\n      const chunkLife = Math.max(160, Number(chunks.lifeMs) || lifeMs * 1.1);\n      const chunkSize = Math.max(size, Number(chunks.size) || size * 1.6);\n      const chunkGravity = Number.isFinite(Number(chunks.gravity)) ? Number(chunks.gravity) : gravity;\n      const chunkShape = chunks.shape === 'square' ? 'square' : 'circle';\n      const chunkAngle = Array.isArray(chunks.angleRange) && chunks.angleRange.length >= 2 ? chunks.angleRange : angleRange;\n      const chunkColors = Array.isArray(chunks.colors) && chunks.colors.length ? chunks.colors : colors;\n\n      for (let i = 0; i < chunkCount; i++) {\n        const angle = chunkAngle\n          ? (Number(chunkAngle[0]) + Math.random() * (Number(chunkAngle[1]) - Number(chunkAngle[0])))\n          : (Math.random() * Math.PI * 2);\n        const sp = chunkSpeed * (0.6 + Math.random() * 0.9);\n        const g = new Graphics();\n        if (chunkShape === 'circle') {\n          g.circle(0, 0, chunkSize * 0.6);\n        } else {\n          g.rect(-chunkSize / 2, -chunkSize / 2, chunkSize, chunkSize);\n        }\n        g.fill({ color: chunkColors[i % chunkColors.length], alpha: 1 });\n        g.x = x;\n        g.y = y;\n        layer.addChild(g);\n        particles.push({\n          g,\n          x,\n          y,\n          vx: Math.cos(angle) * sp,\n          vy: Math.sin(angle) * sp,\n          life: chunkLife,\n          maxLife: chunkLife,\n          gravity: chunkGravity\n        });\n      }\n    }\n  };\n\n  const update = (dt) => {\n    if (!particles.length) return;\n    const delta = Math.max(0, Number(dt) || 0);\n    for (let i = particles.length - 1; i >= 0; i--) {\n      const p = particles[i];\n      p.life -= delta;\n      if (p.life <= 0) {\n        if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n        particles.splice(i, 1);\n        continue;\n      }\n      p.x = (p.x || 0) + p.vx * (delta / 16.67);\n      p.y = (p.y || 0) + p.vy * (delta / 16.67);\n      p.vy += (Number(p.gravity) || 0.02) * (delta / 16.67);\n      if (p.g) {\n        p.g.x = p.x;\n        p.g.y = p.y;\n        p.g.alpha = Math.max(0, p.life / p.maxLife);\n      }\n    }\n  };\n\n  const clear = () => {\n    for (const p of particles) {\n      if (p.g && p.g.parent) p.g.parent.removeChild(p.g);\n    }\n    particles.length = 0;\n  };\n\n  return { add, update, clear };\n};\n\nexport default {\n  createBreakEffectLayer,\n  createBreakEffectManager\n};\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = getDefById(registryItems, id);\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.lava_waterfall ? 'lava_waterfall' :\n               (def.flags.radioactive_waterfall ? 'radioactive_waterfall' :\n               (def.flags.waterfall ? 'waterfall' :\n               (def.flags.radioactive_water ? 'radioactive_water' :\n               (def.flags.quicksand ? 'quicksand' :\n               (def.flags.lava ? 'lava' :\n               (def.flags.water ? 'water' : 'liquid'))))));\n  const overlayColorRaw = def?.liquid?.overlay?.color ?? def?.liquid?.overlayColor ?? def?.tintBelowSurface;\n  const overlayAlphaRaw = def?.liquid?.overlay?.alpha ?? def?.liquid?.overlayAlpha;\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    overlay: {\n      color: Number(overlayColorRaw),\n      alpha: Number(overlayAlphaRaw)\n    },\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    },\n    resources: def?.liquid?.resources || {}\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  const defaultOverlay = (() => {\n    if (type.includes('lava')) return { color: 10914816, alpha: 0.25 };\n    if (type === 'quicksand') return { color: 10916187, alpha: 0.2 };\n    if (type === 'radioactive_water' || type === 'radioactive_waterfall') return { color: 1727514, alpha: 0.18 };\n    return { color: 1919093, alpha: 0.15 };\n  })();\n  const rawOverlayColor = candidate.params?.overlay?.color;\n  const rawOverlayAlpha = candidate.params?.overlay?.alpha;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    overlay: {\n      color: Number.isFinite(rawOverlayColor) ? rawOverlayColor : defaultOverlay.color,\n      alpha: Number.isFinite(rawOverlayAlpha) ? rawOverlayAlpha : defaultOverlay.alpha\n    },\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    },\n    resources: candidate.params?.resources || {}\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","import React, { useEffect, useRef, useMemo, useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets, BlurFilter, ColorMatrixFilter, Texture, Sprite } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder, LavaRain as WeatherLavaRain, RadioactiveFog as WeatherRadioactiveFog, MeteorRain as WeatherMeteorRain } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, BubbleFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { syncEntities, cleanupEntities } from './entityManager';\nimport { drawSeaRescueTrajectory } from '../../../../engine/gameplay/seaRescue';\nimport { rebuildLayers } from './layerBuilder';\nimport { createFloatingTextLayer, createFloatingTextManager } from './floatingTextManager';\nimport { createBreakEffectLayer, createBreakEffectManager } from './breakEffectManager';\nimport { getLiquidAtPixel } from '../../../../engine/liquids/liquidUtils';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({\n  skipCacheIdWarning: true,\n  preferCreateImageBitmap: false, // Prevents WebGL warning: texImage: Alpha-premult and y-flip are deprecated\n});\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\nconst LIQUID_SURFACE_MAP = [\n  { key: 'lava', surface: 'lava' },\n  { key: 'radioactive', surface: 'radiation' },\n  { key: 'quicksand', surface: 'quicksand' },\n  { key: 'water', surface: 'water' },\n];\n\nconst toSurfaceType = (liquidType) => {\n  if (!liquidType) return null;\n  for (const entry of LIQUID_SURFACE_MAP) {\n    if (liquidType.includes(entry.key)) return entry.surface;\n  }\n  return null;\n};\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = EMPTY_ARRAY,\n  objectMapData = EMPTY_ARRAY,\n  secretMapData = EMPTY_ARRAY,\n  revealedSecrets = EMPTY_ARRAY,\n  registryItems = EMPTY_ARRAY,\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  weatherLavaRain = 0,\n  weatherRadioactiveFog = 0,\n  weatherMeteorRain = 0,\n  projectiles = EMPTY_ARRAY,\n  healthBarEnabled = true,\n  objectMetadata = EMPTY_OBJECT,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n  isEditor = false,\n  isEditorPlayMode = false,\n  mapType = 'overworld',\n  activeRoomIds = EMPTY_ARRAY,\n  maps = EMPTY_OBJECT,\n  showGrid = false,\n  renderLayers = null, // null means all layers, otherwise an array of layer names to show\n  pointerEvents = 'auto',\n  onWeatherEffectHit = null,\n  roomBlurEnabled = true,\n  debugOverlayEnabled = false,\n  engineInput = null,\n  engineRefs = null,\n  mapData = null,\n}) => {\n  const [isPixiReady, setIsPixiReady] = useState(false);\n\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const cameraPosRef = useRef({ x: 0, y: 0 });\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const roomBgRef = useRef(null);\n  const roomObjBehindRef = useRef(null);\n  const roomObjFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerLayerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidBgLayerRef = useRef(null);\n  const trajectoryLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const engineInputRef = useRef(engineInput);\n  const engineRefsRef = useRef(engineRefs);\n  const mapTypeRef = useRef(mapType);\n  const mapDataRef = useRef(mapData);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null, fog: null, lavaRain: null, radioactiveFog: null, meteorRain: null });\n  const weatherPropsRef = useRef({ rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0, lavaRain: 0, radioactiveFog: 0, meteorRain: 0 });\n  const tileMapDataRef = useRef(tileMapData);\n  const registryItemsRef = useRef(registryItems);\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const entitiesLayerRef = useRef(null);\n  const entitySpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef(EMPTY_ARRAY);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const driftSettingsRef = useRef({ enabled: true, amplitude: 5, speed: 0.002 });\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0, targetAlpha: 0, currentAlpha: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const bubbleFxRef = useRef(null);\n  const fishBubbleStateRef = useRef(new Map());\n  const entityWaterStateRef = useRef(new Map());\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n  const gridRef = useRef(null);\n  const showGridRef = useRef(showGrid);\n  const roomBlurEnabledRef = useRef(roomBlurEnabled);\n  const blurFilterRef = useRef(new BlurFilter({ strength: 0 }));\n  const darkenFilterRef = useRef(new ColorMatrixFilter());\n  const roomBrightnessFilterRef = useRef(new ColorMatrixFilter());\n  const vignetteRef = useRef(null);\n  const floatingLayerRef = useRef(null);\n  const debugLayerRef = useRef(null);\n  const debugEnabledRef = useRef(!!debugOverlayEnabled);\n  const floatingManagerRef = useRef(null);\n  const breakFxLayerRef = useRef(null);\n  const breakFxManagerRef = useRef(null);\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { showGridRef.current = showGrid; }, [showGrid]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { roomBlurEnabledRef.current = roomBlurEnabled; }, [roomBlurEnabled]);\n  useEffect(() => { debugEnabledRef.current = !!debugOverlayEnabled; }, [debugOverlayEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { engineInputRef.current = engineInput; }, [engineInput]);\n  useEffect(() => { engineRefsRef.current = engineRefs; }, [engineRefs]);\n  useEffect(() => { mapTypeRef.current = mapType; }, [mapType]);\n  useEffect(() => { mapDataRef.current = mapData; }, [mapData]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n  useEffect(() => { tileMapDataRef.current = tileMapData; }, [tileMapData]);\n  useEffect(() => { registryItemsRef.current = registryItems; }, [registryItems]);\n\n  useEffect(() => {\n    if (mapType === 'sea_rescue') {\n      fetch('/assets/json/mini_spill/sea_rescue/sea_rescue_settings.json')\n        .then(r => r.json())\n        .then(data => {\n          if (data.drift) driftSettingsRef.current = data.drift;\n        })\n        .catch(err => console.warn('Failed to load drift settings:', err));\n    }\n  }, [mapType]);\n\n  // Sync weather props to ref for systems to read live\n  useEffect(() => {\n    weatherPropsRef.current = {\n      rain: Number(weatherRain) || 0,\n      snow: Number(weatherSnow) || 0,\n      clouds: Number(weatherClouds) || 0,\n      fog: Number(weatherFog) || 0,\n      thunder: Number(weatherThunder) || 0,\n      lavaRain: Number(weatherLavaRain) || 0,\n      radioactiveFog: Number(weatherRadioactiveFog) || 0,\n      meteorRain: Number(weatherMeteorRain) || 0,\n    };\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl,\n      minWidth: appRef.current?.screen?.width || 0,\n      minHeight: appRef.current?.screen?.height || 0\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      if (appRef.current) return;\n\n      const app = new Application();\n      try {\n        await app.init({\n          resizeTo: mountRef.current,\n          backgroundAlpha: 0,\n          antialias: false,\n          autoDensity: true,\n        });\n\n        // Enable z-index sorting for the main stage\n        app.stage.sortableChildren = true;\n        app.stage.eventMode = 'static';\n        app.stage.hitArea = app.screen;\n\n        if (destroyed) {\n          app.destroy(true, { children: true, texture: true });\n          return;\n        }\n\n        if (!app.renderer) return;\n\n        appRef.current = app;\n        app.stage.sortableChildren = true;\n\n        // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const roomBg = new Container();\n      const roomObjBehind = new Container();\n      const roomObjFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const entitiesLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidBgLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const vignetteLayer = new Container();\n      const overlayLayer = new Container();\n      const floatingLayer = createFloatingTextLayer();\n      const breakFxLayer = createBreakEffectLayer();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      roomBg.zIndex = LAYERS.tiles + 1;\n      objBehind.zIndex = LAYERS.objBehind;\n      roomObjBehind.zIndex = LAYERS.objBehind + 1;\n      objFront.zIndex = LAYERS.objFront;\n      roomObjFront.zIndex = LAYERS.objFront + 1;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      entitiesLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidBgLayer.zIndex = LAYERS.liquidBackground;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      vignetteLayer.zIndex = LAYERS.overlay - 1;\n      overlayLayer.zIndex = LAYERS.overlay;\n      floatingLayer.zIndex = LAYERS.overlay + 1;\n      breakFxLayer.zIndex = LAYERS.overlay + 2;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      roomBgRef.current = roomBg;\n      roomObjBehindRef.current = roomObjBehind;\n      roomObjFrontRef.current = roomObjFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      playerLayerRef.current = playerLayer;\n      liquidBgLayerRef.current = liquidBgLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      entitiesLayerRef.current = entitiesLayer;\n      vignetteRef.current = vignetteLayer;\n      overlayLayerRef.current = overlayLayer;\n      floatingLayerRef.current = floatingLayer;\n      floatingManagerRef.current = createFloatingTextManager(floatingLayer);\n      breakFxLayerRef.current = breakFxLayer;\n      breakFxManagerRef.current = createBreakEffectManager(breakFxLayer);\n    \n      const gridGraphics = new Graphics();\n      gridRef.current = gridGraphics;\n      overlayLayer.addChild(gridGraphics);\n\n      const trajectoryGraphics = new Graphics();\n      trajectoryLayerRef.current = trajectoryGraphics;\n      overlayLayer.addChild(trajectoryGraphics);\n\n      overlayLayer.addChild(breakFxLayer);\n\n      const debugGraphics = new Graphics();\n      debugLayerRef.current = debugGraphics;\n      overlayLayer.addChild(debugGraphics);\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      const allLayersMap = {\n        background: [bg, bgAnim],\n        parallax: [parallaxLayer],\n        tiles: [bg, bgAnim], // Aliased for convenience\n        objects: [objBehind, objFront, secretBelowLayer, secretAboveLayer, entitiesLayer, projLayer],\n        player: [playerLayer],\n        weather: [weatherLayer, fogLayer],\n        liquids: [liquidBgLayer, liquidLayer, liquidFxLayer],\n        overlay: [overlayLayer]\n      };\n\n      if (renderLayers) {\n        renderLayers.forEach(layerName => {\n          const layers = allLayersMap[layerName];\n          if (layers) layers.forEach(l => {\n            if (!app.stage.children.includes(l)) app.stage.addChild(l);\n          });\n        });\n      } else {\n        // Add layers in z-order priority (back to front) for stability\n        app.stage.addChild(\n          parallaxLayer,\n          bg, bgAnim, \n          roomBg,\n          liquidBgLayer, \n          objBehind, \n          roomObjBehind,\n          secretBelowLayer, \n          playerLayer, \n          entitiesLayer, \n          projLayer, \n          objFront, \n          roomObjFront,\n          secretAboveLayer, \n          weatherLayer, \n          fogLayer, \n          liquidLayer, \n          liquidFxLayer,\n          vignetteLayer,\n          overlayLayer,\n          floatingLayer\n        );\n      }\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas - DROA PIEVIENOANA\n      if (mountRef.current && app.renderer && app.canvas) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.rect(0, 0, W, H);\n      g.fill({ color: 0x1d4875, alpha: 1 });\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffcc00, warn: 0xffaa00, danger: 0xff8800 };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas && app.renderer) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          // No need to manually rebuild here as the main useEffect will catch app state or we can just trigger a state change if needed.\n          // But Pixi v8 often recovers automatically. To be safe, we can force a rebuild by just waiting for next tick.\n        });\n      }\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n            mapWidth, \n            mapHeight, \n            tileSize,\n            bgContainer: liquidBgLayerRef.current\n          });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { bubbleFxRef.current = new BubbleFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      \n      if (engineRefs) {\n        engineRefs.fx = {\n          triggerSplash: (x, y, color) => waterFxRef.current?.trigger({ x, y, color }),\n          triggerBubbles: (x, y, color) => bubbleFxRef.current?.trigger({ x, y, color })\n        };\n      }\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n      } catch {}\n\n      rebuildParallax();\n\n      // Finalize initialization by setting appRef\n      // This will trigger the second useEffect to build layers and player\n      appRef.current = app;\n      setIsPixiReady(true);\n      app.ticker.add(() => {\n        if (gridRef.current) {\n          gridRef.current.clear();\n          if (showGridRef.current) {\n            for (let x = 0; x <= mapWidth; x++) {\n              gridRef.current.moveTo(x * tileSize, 0);\n              gridRef.current.lineTo(x * tileSize, mapHeight * tileSize);\n            }\n            for (let y = 0; y <= mapHeight; y++) {\n              gridRef.current.moveTo(0, y * tileSize);\n              gridRef.current.lineTo(mapWidth * tileSize, y * tileSize);\n            }\n            gridRef.current.stroke({ width: 0.5, color: 0xffffff, alpha: 0.2 });\n          }\n        }\n\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          playerRef.current.visible = mapTypeRef.current !== 'sea_rescue';\n          if (playerRef.current.visible) {\n            updatePlayerSprite(\n                { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n                s,\n                tileSize,\n                hbEnabledRef.current\n            );\n          }\n        }\n\n        // Camera Follow\n        const sw = app.screen.width;\n        const sh = app.screen.height;\n        const worldW = mapWidth * tileSize;\n        const worldH = mapHeight * tileSize;\n\n        if (s) {\n          const isSeaRescue = mapTypeRef.current === 'sea_rescue';\n          const baseX = (isSeaRescue && Number.isFinite(s.shipWorldX)) ? s.shipWorldX : (s.x || 0);\n          const baseY = (isSeaRescue && Number.isFinite(s.shipWorldY)) ? s.shipWorldY : (s.y || 0);\n          const sW = (isSeaRescue && Number.isFinite(s.shipWorldWidth)) ? s.shipWorldWidth : (s.width || tileSize);\n          const sH = (isSeaRescue && Number.isFinite(s.shipWorldHeight)) ? s.shipWorldHeight : (s.height || tileSize);\n          const targetX = baseX + sW / 2;\n          const targetY = baseY + sH / 2;\n\n          let camX = targetX - sw / 2;\n          let camY = targetY - sh / 2;\n\n          // Constraints with centering for small maps\n          if (worldW < sw) {\n            camX = (worldW - sw) / 2;\n          } else {\n            camX = Math.max(0, Math.min(camX, worldW - sw));\n          }\n\n          if (worldH < sh) {\n            camY = (worldH - sh) / 2;\n          } else {\n            camY = Math.max(0, Math.min(camY, worldH - sh));\n          }\n\n          // Use a small dead-zone/smooth follow to prevent 1px jitter from sub-pixel player movement\n          const lastCam = cameraPosRef.current || { x: camX, y: camY, rawX: camX, rawY: camY };\n          const smoothing = 0.2; // Lerp factor (0 to 1, higher is faster)\n          const rawX = lastCam.rawX !== undefined ? lastCam.rawX : camX;\n          const rawY = lastCam.rawY !== undefined ? lastCam.rawY : camY;\n          \n          const nextRawX = rawX + (camX - rawX) * smoothing;\n          const nextRawY = rawY + (camY - rawY) * smoothing;\n\n          cameraPosRef.current = { \n            x: Math.round(nextRawX), \n            y: Math.round(nextRawY),\n            rawX: nextRawX,\n            rawY: nextRawY\n          };\n\n          if (engineRefsRef.current) {\n            if (!engineRefsRef.current.cameraRef) engineRefsRef.current.cameraRef = { x: 0, y: 0 };\n            engineRefsRef.current.cameraRef.x = nextRawX;\n            engineRefsRef.current.cameraRef.y = nextRawY;\n\n            // Update world mouse position for gameplay logic\n            const mouseData = app.renderer.events.pointer.global;\n            const worldMouse = app.stage.toLocal(mouseData);\n            if (!engineRefsRef.current.mouseWorldPos) engineRefsRef.current.mouseWorldPos = { x: 0, y: 0 };\n            engineRefsRef.current.mouseWorldPos.x = worldMouse.x;\n            engineRefsRef.current.mouseWorldPos.y = worldMouse.y;\n          }\n          \n          app.stage.pivot.set(Math.round(nextRawX), Math.round(nextRawY));\n          \n          window.__PLAYER_POS__ = { x: baseX, y: baseY };\n\n          if (parallaxRef.current) {\n            parallaxRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          if (vignetteRef.current && vignetteRef.current.visible) {\n            vignetteRef.current.position.set(nextRawX, nextRawY);\n          }\n\n          const f = parallaxFactorRef.current;\n          if (parallaxManagerRef.current) {\n            parallaxManagerRef.current.resize(worldW, worldH, sw, sh);\n            parallaxManagerRef.current.setScroll(nextRawX, f);\n          }\n\n          // Sea Rescue Trajectory\n          if (trajectoryLayerRef.current) {\n            trajectoryLayerRef.current.clear();\n            if (mapTypeRef.current === 'sea_rescue') {\n                const time = app.ticker.lastTime;\n                const driftY = driftSettingsRef.current.enabled \n                  ? Math.sin(time * driftSettingsRef.current.speed) * driftSettingsRef.current.amplitude \n                  : 0;\n\n                if (engineRefsRef.current) {\n                  engineRefsRef.current.driftY = driftY;\n                }\n\n                const drawCtx = {\n                    input: engineInputRef.current,\n                    refs: engineRefsRef.current,\n                    cameraX: nextRawX,\n                    cameraY: nextRawY,\n                    mapData: mapDataRef.current,\n                    tileSize: tileSize,\n                    driftY: driftY\n                };\n                drawSeaRescueTrajectory(drawCtx, trajectoryLayerRef.current);\n            }\n          }\n        }\n\n        // Sea Rescue Drift & Bubbles\n        if (mapTypeRef.current === 'sea_rescue') {\n          const time = app.ticker.lastTime;\n          const driftY = driftSettingsRef.current.enabled \n            ? Math.sin(time * driftSettingsRef.current.speed) * driftSettingsRef.current.amplitude \n            : 0;\n          \n          const now = Date.now();\n          const updateSeaRescueVisuals = (container) => {\n            if (!container) return;\n            const shipOffset = (mapTypeRef.current === 'sea_rescue' && s) ? (s.x || 0) : 0;\n            container.children.forEach(child => {\n              // Drift (Ship, Triggers & Boxes)\n              if (child.isSeaRescueShipPart || child.isSeaRescueBox) {\n                if (child.isSeaRescueShipPart) {\n                    child.x = (child.baseX || child.x) + shipOffset;\n                }\n                const phase = child.isSeaRescueBox ? ((child.x * 0.1) + (child.y * 0.1)) : 0;\n                child.y = (child.baseY || child.y) + Math.sin((time * driftSettingsRef.current.speed) + phase) * driftSettingsRef.current.amplitude;\n              }\n              // Bubbles (Boxes)\n              if (child.isSeaRescueBox && child.bubbles?.enabled && bubbleFxRef.current) {\n                if (!child.lastBubbleTime || now - child.lastBubbleTime > (child.bubbles.intervalMs || 1000)) {\n                  const w = (child.boxWidth || 1) * tileSize;\n                  const h = (child.boxHeight || 1) * tileSize;\n                  const bx = child.x + Math.random() * w;\n                  const by = child.y + Math.random() * h;\n                  \n                  bubbleFxRef.current.trigger({\n                    x: bx,\n                    y: by,\n                    color: child.bubbles.color ? parseInt(child.bubbles.color.replace('#', '0x'), 16) : 0xc9ecff,\n                    rise: 0.02 + Math.random() * 0.02,\n                    life: 1500 + Math.random() * 1000\n                  });\n                  child.lastBubbleTime = now;\n                }\n              }\n            });\n          };\n          updateSeaRescueVisuals(objBehindRef.current);\n          updateSeaRescueVisuals(objFrontRef.current);\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        const swNow = app.screen.width;\n        const shNow = app.screen.height;\n\n        if (systems.rain) {\n          if (systems.rain.resize) systems.rain.resize(swNow, shNow);\n          systems.rain.update(dt);\n        }\n        if (systems.lavaRain) {\n          if (systems.lavaRain.resize) systems.lavaRain.resize(swNow, shNow);\n          systems.lavaRain.update(dt);\n        }\n        if (systems.snow) {\n          if (systems.snow.resize) systems.snow.resize(swNow, shNow);\n          systems.snow.update(dt);\n        }\n        if (systems.meteorRain) {\n          if (systems.meteorRain.resize) systems.meteorRain.resize(swNow, shNow);\n          systems.meteorRain.update(dt);\n        }\n        if (systems.clouds) {\n          if (systems.clouds.resize) systems.clouds.resize(swNow, shNow);\n          systems.clouds.update(dt);\n        }\n        if (systems.fog) {\n          if (systems.fog.resize) systems.fog.resize(swNow, shNow);\n          systems.fog.update(dt);\n        }\n        if (systems.radioactiveFog) {\n          if (systems.radioactiveFog.resize) systems.radioactiveFog.resize(swNow, shNow);\n          systems.radioactiveFog.update(dt);\n        }\n        if (systems.thunder) {\n          if (systems.thunder.resize) systems.thunder.resize(swNow, shNow);\n          systems.thunder.update(dt);\n        }\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { bubbleFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater/lava overlay with smooth fade-in/out\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n\n          // Safety check: ensure graphics object exists and is attached\n          if (u && (!u.g || u.g.destroyed)) {\n            const overlayL = overlayLayerRef.current;\n            if (overlayL) {\n              const g = new Graphics();\n              overlayL.addChild(g);\n              u.g = g;\n              u.currentAlpha = 0;\n              u.targetAlpha = 0;\n              u.time = 0;\n            }\n          }\n\n          if (u && u.g) {\n            // Check if player's head is in water/lava for full overlay\n            // If only body is in liquid, use a much subtler effect or none\n            const liquidType = sNow.liquidType;\n            const headUnder = !!(sNow && sNow.headUnderWater);\n            const inLiquid = !!(sNow && sNow.inWater);\n            \n            const overlayCfg = sNow.liquidOverlay || null;\n            const showOverlay = headUnder && !!overlayCfg;\n\n            let overlayColor = 0x1d4875;\n            let maxTargetAlpha = 0.15;\n\n            if (overlayCfg) {\n              if (Number.isFinite(overlayCfg.color)) overlayColor = overlayCfg.color;\n              if (Number.isFinite(overlayCfg.alpha)) maxTargetAlpha = overlayCfg.alpha;\n            }\n\n            if (showOverlay) {\n              u.time += dt;\n              // Target alpha with pulse effect\n              const pulseBase = (maxTargetAlpha * 0.8) + (maxTargetAlpha * 0.2) * Math.sin(u.time * 0.0025);\n              u.targetAlpha = pulseBase;\n\n              // Smooth fade-in: gradually approach target alpha\n              const fadeSpeed = 0.01; // Faster fade-in for immediate visibility\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeSpeed);\n\n              // Update color if liquid type changed (only when needed to avoid constant redraw)\n              if (!u.g.visible || u.lastLiquidType !== liquidType) {\n                u.g.clear();\n                u.g.rect(0, 0, mapWidth * tileSize, mapHeight * tileSize);\n                u.g.fill({ color: overlayColor, alpha: 1 });\n                u.lastLiquidType = liquidType;\n              }\n\n              u.g.visible = true;\n              u.g.alpha = u.currentAlpha;\n            } else {\n              // Smooth fade-out\n              u.targetAlpha = 0;\n              const fadeOutSpeed = 0.008; // Faster fade-out\n              const alphaDiff = u.targetAlpha - u.currentAlpha;\n              u.currentAlpha += alphaDiff * Math.min(1, dt * fadeOutSpeed);\n              u.g.alpha = u.currentAlpha;\n\n              if (u.currentAlpha < 0.01) {\n                u.currentAlpha = 0;\n                u.g.alpha = 0;\n                u.g.visible = false;\n                u.time = 0; // Reset time for next submersion\n              }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n\n        // Entities\n        const sNow = playerStateRef.current || {};\n        syncEntities(entitiesLayerRef.current, entitySpritesRef.current, sNow.entities, registryItems, tileSize);\n\n        try {\n          const ents = sNow.entities || [];\n          const tileData = tileMapDataRef.current;\n          const regs = registryItemsRef.current;\n          const seen = new Set();\n\n          for (const ent of ents) {\n            if (!ent) continue;\n            const id = ent.id;\n            seen.add(id);\n            const def = ent.def || {};\n            const cx = (ent.x || 0) + (ent.width || tileSize) * 0.5;\n            const cy = (ent.y || 0) + (ent.height || tileSize) * 0.5;\n            const liq = (tileData && regs)\n              ? getLiquidAtPixel(cx, cy, mapWidth, mapHeight, tileSize, tileData, regs)\n              : null;\n            const inWater = !!(liq && (liq.type === 'water' || liq.type === 'waterfall'));\n\n            const prev = entityWaterStateRef.current.get(id) || { inWater: false };\n            if (inWater && !prev.inWater && waterFxRef.current && liquidSystemRef.current) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', cx);\n              const strength = Math.min(2, Math.max(0.3, Math.abs(ent.vy || 0) * 0.08 + 0.4));\n              if (Number.isFinite(sy)) {\n                waterFxRef.current?.trigger({ x: cx, y: sy, strength, upward: false });\n                try { liquidSystemRef.current?.addWave?.('water', cx, Math.min(2.2, strength)); } catch {}\n              }\n            }\n            entityWaterStateRef.current.set(id, { inWater });\n\n            const isFish = def.subtype === 'fish' || def.ai?.type === 'fish' || def.fish;\n            const isAlive = Number(ent.health) > 0;\n            if (isFish && isAlive && !ent.isDormant && inWater && bubbleFxRef.current) {\n              const cfg = def.fish || {};\n              const interval = Math.max(200, Number(cfg.bubbleIntervalMs) || 900);\n              const jitter = Math.max(0, Number(cfg.bubbleJitter) || 0.4);\n              const state = fishBubbleStateRef.current.get(id) || { t: 0 };\n              state.t += dt;\n              if (state.t >= interval) {\n                state.t = 0;\n                const bx = cx + (Math.random() - 0.5) * tileSize * jitter;\n                const by = cy + (Math.random() - 0.5) * tileSize * jitter;\n                bubbleFxRef.current.trigger({\n                  x: bx,\n                  y: by,\n                  size: 2,\n                  rise: 0.025 + Math.random() * 0.02,\n                  life: 1000 + Math.random() * 400,\n                  drift: 0.015 + Math.random() * 0.02\n                });\n              }\n              fishBubbleStateRef.current.set(id, state);\n            } else if (isFish) {\n              fishBubbleStateRef.current.delete(id);\n            }\n          }\n\n          for (const key of fishBubbleStateRef.current.keys()) {\n            if (!seen.has(key)) fishBubbleStateRef.current.delete(key);\n          }\n          for (const key of entityWaterStateRef.current.keys()) {\n            if (!seen.has(key)) entityWaterStateRef.current.delete(key);\n          }\n        } catch {}\n\n        // Floating texts\n        floatingManagerRef.current?.update(dt);\n        // Break FX\n        breakFxManagerRef.current?.update(dt);\n      });\n    } catch (error) {\n      console.error('PixiStage init failed:', error);\n    }\n  };\n\n  init();\n\n  return () => {\n    destroyed = true;\n    if (appRef.current) {\n      const appToDestroy = appRef.current;\n      appRef.current = null;\n      appToDestroy.destroy(true, { children: true, texture: true });\n    }\n    try { liquidSystemRef.current?.destroy(); } catch {}\n    try { waterFxRef.current?.destroy(); } catch {}\n    try { bubbleFxRef.current?.destroy(); } catch {}\n    try { lavaEmbersRef.current?.destroy(); } catch {}\n    try { lavaSteamRef.current?.destroy(); } catch {}\n    try { parallaxManagerRef.current?.destroy(); } catch {}\n    parallaxManagerRef.current = null;\n    try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n    try {\n      weatherSystemsRef.current.rain?.destroy();\n      weatherSystemsRef.current.snow?.destroy();\n      weatherSystemsRef.current.fog?.destroy();\n    } catch {}\n    cleanupProjectiles(projectileSpritesRef.current);\n    cleanupEntities(entitySpritesRef.current);\n    clearTextureCache();\n  };\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      floatingManagerRef.current?.add(detail);\n    };\n    window.addEventListener('game-floating-text', handler);\n    return () => window.removeEventListener('game-floating-text', handler);\n  }, []);\n\n  useEffect(() => {\n    const handler = (e) => {\n      const detail = e?.detail || {};\n      if (Number.isFinite(detail.x) && Number.isFinite(detail.y) && detail.config) {\n        breakFxManagerRef.current?.add(detail);\n      }\n    };\n    window.addEventListener('game-break-effect', handler);\n    return () => window.removeEventListener('game-break-effect', handler);\n  }, []);\n\n  useEffect(() => {\n    const isInsideRoom = activeRoomIds && activeRoomIds.length > 0;\n    const targetBlur = (isInsideRoom && roomBlurEnabled) ? 4 : 0;\n    const roomBrightness = isInsideRoom ? 1.25 : 1.0; // Slightly brighter interior\n    \n    if (blurFilterRef.current) {\n      blurFilterRef.current.strength = targetBlur;\n    }\n\n    if (darkenFilterRef.current) {\n      darkenFilterRef.current.reset();\n      if (isInsideRoom) {\n        // Desaturate and darken background when inside\n        darkenFilterRef.current.desaturate();\n        darkenFilterRef.current.brightness(0.75, true);\n      }\n    }\n\n    if (roomBrightnessFilterRef.current) {\n      roomBrightnessFilterRef.current.reset();\n      roomBrightnessFilterRef.current.brightness(roomBrightness, false);\n    }\n\n    if (vignetteRef.current) {\n      vignetteRef.current.visible = isInsideRoom;\n      if (isInsideRoom && !vignetteRef.current.children.length) {\n        const sw = appRef.current?.screen?.width || 800;\n        const sh = appRef.current?.screen?.height || 600;\n        \n        // Create programmatic vignette texture using canvas\n        const canvas = document.createElement('canvas');\n        canvas.width = 512;\n        canvas.height = 512;\n        const ctx = canvas.getContext('2d');\n        const grad = ctx.createRadialGradient(256, 256, 100, 256, 256, 360);\n        grad.addColorStop(0, 'rgba(0,0,0,0)');\n        grad.addColorStop(1, 'rgba(0,0,0,0.6)');\n        ctx.fillStyle = grad;\n        ctx.fillRect(0, 0, 512, 512);\n        \n        const tex = Texture.from(canvas);\n        const sprite = new Sprite(tex);\n        sprite.width = sw;\n        sprite.height = sh;\n        vignetteRef.current.addChild(sprite);\n        \n        // Also update sprite size on resize\n        vignetteRef.current._vignetteSprite = sprite;\n      }\n      \n      // Sync vignette position to camera (it should be screen-space)\n      if (isInsideRoom && vignetteRef.current._vignetteSprite) {\n        vignetteRef.current.x = cameraPosRef.current.x;\n        vignetteRef.current.y = cameraPosRef.current.y;\n        vignetteRef.current._vignetteSprite.width = appRef.current?.screen?.width || 800;\n        vignetteRef.current._vignetteSprite.height = appRef.current?.screen?.height || 600;\n      }\n    }\n\n    const layersToBlur = [\n      bgRef.current,\n      bgAnimRef.current,\n      objBehindRef.current,\n      objFrontRef.current,\n      secretLayerRef.current?.below,\n      secretLayerRef.current?.above,\n      liquidBgLayerRef.current,\n      liquidLayerRef.current,\n      parallaxRef.current\n    ];\n\n    layersToBlur.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        \n        // Blur filter\n        if (targetBlur > 0) {\n          if (!layer.filters.includes(blurFilterRef.current)) {\n            layer.filters = [...layer.filters, blurFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== blurFilterRef.current);\n        }\n\n        // Darken/Desaturate filter (Background only)\n        if (isInsideRoom) {\n          if (!layer.filters.includes(darkenFilterRef.current)) {\n            layer.filters = [...layer.filters, darkenFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== darkenFilterRef.current);\n        }\n\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n\n    // Apply brightness to room layers\n    const roomLayers = [\n      roomBgRef.current,\n      roomObjBehindRef.current,\n      roomObjFrontRef.current\n    ];\n\n    roomLayers.forEach(layer => {\n      if (layer) {\n        if (!layer.filters) layer.filters = [];\n        if (isInsideRoom) {\n          if (!layer.filters.includes(roomBrightnessFilterRef.current)) {\n            layer.filters = [...layer.filters, roomBrightnessFilterRef.current];\n          }\n        } else {\n          layer.filters = layer.filters.filter(f => f !== roomBrightnessFilterRef.current);\n        }\n        if (layer.filters.length === 0) layer.filters = null;\n      }\n    });\n  }, [activeRoomIds, roomBlurEnabled]);\n\n  useEffect(() => {\n    const g = debugLayerRef.current;\n    if (!g) return;\n    g.clear();\n    if (!debugEnabledRef.current) {\n      g.visible = false;\n      return;\n    }\n    g.visible = true;\n\n    const getDefById = (id) => {\n      if (!id) return null;\n      const map = registryItems && registryItems.__byId;\n      if (map && typeof map.get === 'function') return map.get(id) || null;\n      return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    const tileCount = mapWidth * mapHeight;\n    for (let i = 0; i < tileCount; i++) {\n      const tileId = tileMapData[i];\n      if (!tileId) continue;\n      const def = getDefById(tileId);\n      if (!def) continue;\n      const x = (i % mapWidth) * tileSize;\n      const y = Math.floor(i / mapWidth) * tileSize;\n      const isLiquid = !!def.flags?.liquid;\n      const isLava = !!def.flags?.lava || !!def.flags?.lava_waterfall;\n      const isRadio = !!def.flags?.radioactive || !!def.flags?.radioactive_waterfall;\n      const hasCollision = !!def.collision;\n\n      if (isLiquid) {\n        const color = isLava ? 0xffa500 : (isRadio ? 0x32cd32 : 0x2ecdf1);\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color, alpha: 0.18 });\n      } else if (hasCollision) {\n        g.rect(x, y, tileSize, tileSize);\n        g.fill({ color: 0xff3b3b, alpha: 0.12 });\n      }\n    }\n\n    if (Array.isArray(secretMapData) && secretMapData.length) {\n      g.stroke({ width: 1, color: 0xb57bff, alpha: 0.6 });\n      for (let i = 0; i < secretMapData.length; i++) {\n        if (secretMapData[i] !== 'room_area') continue;\n        const x = (i % mapWidth) * tileSize;\n        const y = Math.floor(i / mapWidth) * tileSize;\n        g.rect(x, y, tileSize, tileSize);\n      }\n    }\n  }, [debugOverlayEnabled, tileMapData, secretMapData, mapWidth, mapHeight, tileSize, registryItems]);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n\n    let active = true;\n\n    const runRebuild = async () => {\n        // Collect all textures to preload\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n            addUrl(def?.texture);\n            if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n            addUrl(playerVisuals.texture);\n            if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n            await Assets.load(urls);\n        }\n\n        if (!active || !appRef.current) return;\n\n        if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n            rebuildLayers(\n                { \n                  bgRef: bgRef.current, \n                  objBehindRef: objBehindRef.current, \n                  objFrontRef: objFrontRef.current, \n                  roomBgRef: roomBgRef.current,\n                  roomObjBehindRef: roomObjBehindRef.current,\n                  roomObjFrontRef: roomObjFrontRef.current,\n                  secretLayerRef: secretLayerRef.current \n                },\n                { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems, objectMetadata, isEditor, isEditorPlayMode, mapType, backgroundColor, activeRoomIds, maps }\n            );\n\n            // Rebuild player visuals if visuals changed or player not created yet\n            const pLayer = playerLayerRef.current;\n            if (pLayer) {\n                if (playerRef.current) {\n                    pLayer.removeChild(playerRef.current);\n                    try { playerRef.current.destroy({ children: true }); } catch {}\n                }\n                \n                const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerStateRef.current, tileSize);\n                pLayer.addChild(playerComponents.container);\n                playerRef.current = playerComponents.container;\n                playerSpriteRefs.current = playerComponents.sprites;\n                playerHealthBarRef.current = playerComponents.healthBar;\n            }\n\n            // Rebuild liquid regions only if tileMapData changed (not just revealedSecrets)\n            // This prevents liquid \"jumping\" when revealing secrets\n            const tileDataString = JSON.stringify(tileMapData);\n            const prevTileDataString = liquidSystemRef.current?._lastTileData;\n            if (tileDataString !== prevTileDataString) {\n                try {\n                    if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n                    if (liquidLayerRef.current) {\n                        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { \n                            mapWidth, \n                            mapHeight, \n                            tileSize,\n                            bgContainer: liquidBgLayerRef.current\n                        });\n                        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n                        liquidSystemRef.current._lastTileData = tileDataString; // Track what we built\n                    }\n                } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n                try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n            }\n\n            // Upload to GPU to avoid lazy initialization warnings\n            if (app.renderer && app.renderer.prepare) {\n                try {\n                    await app.renderer.prepare.upload(app.stage);\n                } catch (e) {\n                    // Prepare might fail in some edge cases or context loss\n                }\n            }\n        }\n    };\n\n    runRebuild();\n\n    return () => { active = false; };\n  }, [tileMapData, objectMapData, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets, objectMetadata, playerVisuals, isPixiReady, activeRoomIds, maps, mapType, backgroundColor]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer || !isPixiReady) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getPlayerState: () => playerStateRef.current,\n      getLiquidTypeAt: (x, y) => {\n        const tmd = tileMapDataRef.current;\n        const regs = registryItemsRef.current;\n        if (!tmd || !regs) return null;\n        const liq = getLiquidAtPixel(x, y, mapWidth, mapHeight, tileSize, tmd, regs);\n        if (!liq) return null;\n        return toSurfaceType(liq.type);\n      },\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      },\n      onMeteorHit: (data) => {\n        if (typeof onWeatherEffectHit === 'function') {\n          onWeatherEffectHit('meteor', data);\n        }\n      },\n      onThunderStrike: () => {\n        try {\n          window.dispatchEvent(new CustomEvent('weather-thunder-strike'));\n        } catch {}\n      },\n      getViewport: () => ({\n        x: cameraPosRef.current.x,\n        y: cameraPosRef.current.y,\n        width: app.screen?.width || 800,\n        height: app.screen?.height || 600\n      })\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.rain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.snow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.clouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.thunder) || 0));\n    const getFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.fog) || 0));\n    const getLavaRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.lavaRain) || 0));\n    const getRadioactiveFogIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.radioactiveFog) || 0));\n    const getMeteorRainIntensity = () => Math.max(0, Math.min(100, Number(weatherPropsRef.current.meteorRain) || 0));\n\n    // Initialize systems if they don't exist\n    if (!weatherSystemsRef.current.rain) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n    }\n    if (!weatherSystemsRef.current.lavaRain) {\n      weatherSystemsRef.current.lavaRain = new WeatherLavaRain(weatherLayer, api, getLavaRainIntensity);\n    }\n    if (!weatherSystemsRef.current.snow) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n    }\n    if (!weatherSystemsRef.current.meteorRain) {\n      weatherSystemsRef.current.meteorRain = new WeatherMeteorRain(weatherLayer, api, getMeteorRainIntensity);\n    }\n    if (!weatherSystemsRef.current.clouds) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n    }\n    if (!weatherSystemsRef.current.fog) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, getFogIntensity);\n    }\n    if (!weatherSystemsRef.current.radioactiveFog) {\n      weatherSystemsRef.current.radioactiveFog = new WeatherRadioactiveFog(fogLayer, api, getRadioactiveFogIntensity);\n    }\n    if (!weatherSystemsRef.current.thunder) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n    }\n\n    // Return cleanup to destroy all when stage unmounts or map changes\n    return () => {\n      try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.lavaRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n      try { weatherSystemsRef.current.meteorRain?.destroy(); } catch {}\n      try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n      try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.radioactiveFog?.destroy(); } catch {}\n      try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n      weatherSystemsRef.current = { rain: null, lavaRain: null, snow: null, meteorRain: null, clouds: null, thunder: null, fog: null, radioactiveFog: null };\n    };\n  }, [mapWidth, mapHeight, tileSize, isSolidAt, isPixiReady]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%', pointerEvents }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  objectMetadata: PropTypes.object,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  weatherLavaRain: PropTypes.number,\n  weatherRadioactiveFog: PropTypes.number,\n  weatherMeteorRain: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n  roomBlurEnabled: PropTypes.bool,\n  debugOverlayEnabled: PropTypes.bool,\n  renderLayers: PropTypes.arrayOf(PropTypes.string),\n  pointerEvents: PropTypes.string,\n  onWeatherEffectHit: PropTypes.func,\n};\n\nexport default PixiStage;\n","export function updateSeaRescue(ctx, deltaMs) {\n  const {\n    mapData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions,\n    registryItems\n  } = ctx;\n\n  const { gameState, projectilesRef, projectileIdRef, objectMetadata: objMetaRef } = refs;\n  const { TILE_SIZE } = constants;\n  const { isSolidAtPixel, findItemById } = helpers;\n  const { playSfx, onStateUpdate } = actions;\n  \n  const objectMetadata = objMetaRef?.current || mapData.meta?.objectMetadata || {};\n  \n  const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n  const activeMap = mapData.maps ? mapData.maps[activeId] : mapData;\n  if (activeMap.type !== 'sea_rescue') return;\n\n  const keys = input.current;\n  const mousePos = keys.mousePos;\n  const isMouseDown = keys.mouseLeft;\n\n  // We need a way to track the currently dragged box\n  if (!refs.seaRescueRef || refs.seaRescueRef.mapId !== activeId) {\n    refs.seaRescueRef = {\n      mapId: activeId,\n      draggedBox: null, // { index, startX, startY }\n      points: 0,\n      triggeredSeagulls: new Set(),\n      soundState: {\n        isMoving: false,\n        engineSoundTimer: 0\n      }\n    };\n  }\n  const sr = refs.seaRescueRef;\n  if (!sr.triggeredSeagulls) sr.triggeredSeagulls = new Set();\n  if (!sr.soundState) sr.soundState = { isMoving: false, engineSoundTimer: 0 };\n\n  const objectData = ctx.objectData || activeMap.layers?.find(l => l.name === 'objects' || l.name === 'entities' || l.type === 'object')?.data || [];\n  const secretData = activeMap.secretMapData || activeMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n  const mapWidth = activeMap.width || mapData.meta?.width || 20;\n\n  // Implement Seagull trigger logic\n  const shipX = gameState.current.x;\n  const shipY = gameState.current.y;\n  const shipDef = findItemById('minispill_sea_rescue_ship');\n  const shipW = (shipDef?.width || 27) * TILE_SIZE;\n  const shipH = (shipDef?.height || 7) * TILE_SIZE;\n  if (sr.shipBaseMapId !== activeId || sr.shipBaseX === undefined || sr.shipBaseY === undefined) {\n    const shipIdx = objectData.findIndex(id => id === 'minispill_sea_rescue_ship');\n    if (shipIdx >= 0) {\n      sr.shipBaseX = (shipIdx % mapWidth) * TILE_SIZE;\n      sr.shipBaseY = Math.floor(shipIdx / mapWidth) * TILE_SIZE;\n    } else {\n      sr.shipBaseX = 0;\n      sr.shipBaseY = 0;\n    }\n    sr.shipBaseMapId = activeId;\n  }\n  const shipWorldX = (sr.shipBaseX || 0) + shipX;\n  const shipWorldY = (sr.shipBaseY || 0) + shipY;\n\n  // Ship sounds logic\n  const isMoving = Math.abs(gameState.current.vx) > 5 || keys.a || keys.d || keys.ArrowLeft || keys.ArrowRight;\n  const ss = sr.soundState;\n\n  if (isMoving && !ss.isMoving) {\n    const hornSound = shipDef?.sounds?.horn;\n    if (hornSound) {\n      const audio = playSfx(hornSound, 0.6);\n      if (audio && shipDef.horn) {\n        const stopTime = (audio.duration || 2) * 1000 * shipDef.horn;\n        if (audio.duration) {\n          setTimeout(() => { try { audio.pause(); } catch {} }, stopTime);\n        } else {\n          audio.addEventListener('loadedmetadata', () => {\n            setTimeout(() => { try { audio.pause(); } catch {} }, audio.duration * 1000 * shipDef.horn);\n          }, { once: true });\n        }\n      }\n    }\n  }\n\n  if (isMoving) {\n    ss.engineSoundTimer -= deltaMs;\n    if (ss.engineSoundTimer <= 0) {\n      const engineSound = shipDef?.sounds?.engine;\n      if (engineSound) {\n        playSfx(engineSound, 0.35);\n        ss.engineSoundTimer = 1800; // Engine sound interval\n      }\n    }\n  } else {\n    ss.engineSoundTimer = 0;\n  }\n  ss.isMoving = isMoving;\n\n  const shipGridXStart = Math.floor(shipWorldX / TILE_SIZE);\n  const shipGridXEnd = Math.floor((shipWorldX + shipW) / TILE_SIZE);\n  const shipGridYStart = Math.floor(shipWorldY / TILE_SIZE);\n  const shipGridYEnd = Math.floor((shipWorldY + shipH) / TILE_SIZE);\n\n  for (let gy = shipGridYStart; gy <= shipGridYEnd; gy++) {\n    for (let gx = shipGridXStart; gx <= shipGridXEnd; gx++) {\n      if (gx < 0 || gy < 0 || gx >= mapWidth) continue;\n      const idx = gy * mapWidth + gx;\n      const objId = objectData[idx] || secretData[idx];\n      if (objId === 'minispill_sea_rescue_seagull' && !sr.triggeredSeagulls.has(idx)) {\n        sr.triggeredSeagulls.add(idx);\n        const seagullDef = findItemById(objId);\n        const sound = seagullDef?.sounds?.trigger || \"/assets/sound/sfx/target/seagulls-3-34057.ogg\";\n        playSfx(sound, 0.7);\n      }\n    }\n  }\n\n  // World mouse position\n  // Note: We need to account for camera scroll\n  // In updateFrame, camera scroll isn't directly passed, but we can infer it or pass it.\n  // PixiStage uses cameraScrollX/Y.\n  \n  const cameraX = ctx.cameraX || refs.cameraRef?.x || 0;\n  const cameraY = ctx.cameraY || refs.cameraRef?.y || 0;\n  \n  const worldMouseX = refs.mouseWorldPos?.x || (mousePos.x + cameraX);\n  const worldMouseY = refs.mouseWorldPos?.y || (mousePos.y + cameraY);\n\n  // Load physics settings\n  const settings = findItemById('sea_rescue_settings')?.physics || {};\n  const G = settings.gravity || 1600;\n  const POWER = settings.power || 6;\n  const MAX_DRAG = settings.maxDrag || 140;\n\n  if (isMouseDown) {\n    if (!sr.draggedBox) {\n      // Try to find a box under the mouse\n      const gx = Math.floor(worldMouseX / TILE_SIZE);\n      const gy = Math.floor(worldMouseY / TILE_SIZE);\n      let index = gy * mapWidth + gx;\n      let objId = objectData[index];\n      \n      // Ja tie flz nek nav, mekljam lielus objektus (meta data vai root flzes), kas vartu prklt o flzi\n      if (!objId) {\n        // 1. Mekljam metadata (ja tda ir)\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n          const idx = parseInt(idxStr, 10);\n          const w = meta.width || 1;\n          const h = meta.height || 1;\n          if (w <= 1 && h <= 1) continue;\n          \n          const ox = idx % mapWidth;\n          const oy = Math.floor(idx / mapWidth);\n          if (gx >= ox && gx < ox + w && gy >= oy && gy < oy + h) {\n            objId = objectData[idx];\n            index = idx;\n            break;\n          }\n        }\n\n        // 2. Ja joprojm nek nav, mekljam root flzes apkrtn (jo kastes ir 3x2)\n        if (!objId) {\n          for (let dy = 0; dy <= 2; dy++) {\n            for (let dx = 0; dx <= 3; dx++) {\n              const rx = gx - dx;\n              const ry = gy - dy;\n              if (rx < 0 || ry < 0) continue;\n              const rIdx = ry * mapWidth + rx;\n              const rId = objectData[rIdx];\n              if (rId && rId.startsWith('minispill_sea_rescue_box')) {\n                const def = findItemById(rId);\n                const w = def?.width || 3;\n                const h = def?.height || 2;\n                if (gx >= rx && gx < rx + w && gy >= ry && gy < ry + h) {\n                  objId = rId;\n                  index = rIdx;\n                  break;\n                }\n              }\n            }\n            if (objId) break;\n          }\n        }\n      }\n\n      if (objId && objId.startsWith('minispill_sea_rescue_box')) {\n        const def = findItemById(objId);\n        const meta = objectMetadata[index] || {};\n        const w = meta.width || def?.width || 1;\n        const h = meta.height || def?.height || 1;\n        \n        // Calculate object center\n        const ox = index % mapWidth;\n        const oy = Math.floor(index / mapWidth);\n        \n        sr.draggedBox = {\n          index,\n          startX: (ox + w / 2) * TILE_SIZE,\n          startY: (oy + h / 2) * TILE_SIZE,\n          objId\n        };\n      }\n    }\n  } else {\n    if (sr.draggedBox) {\n      // Launch!\n      const { startX, startY, index, objId } = sr.draggedBox;\n      const driftY = refs.driftY || ctx.driftY || 0;\n      const currentStartY = startY + driftY;\n      \n      const dragX = startX - worldMouseX;\n      const dragY = currentStartY - worldMouseY;\n      const dist = Math.sqrt(dragX * dragX + dragY * dragY);\n      const limitedDist = Math.min(dist, MAX_DRAG);\n      const ratio = limitedDist / (dist || 1);\n      \n      const vx = dragX * ratio * POWER;\n      const vy = dragY * ratio * POWER;\n      \n      // Spawn a special projectile that looks like the box\n      const id = projectileIdRef.current++;\n      \n      const def = findItemById(objId);\n      const meta = objectMetadata[index] || {};\n      const w = (meta.width || def?.width || 1) * TILE_SIZE;\n      const h = (meta.height || def?.height || 1) * TILE_SIZE;\n      const frameIndex = meta.frameIndex !== undefined ? meta.frameIndex : (def?.spriteSheet?.frameIndex || 0);\n\n      const proj = {\n        id,\n        ownerId: 'player',\n        x: startX,\n        y: currentStartY,\n        vx,\n        vy,\n        dir: vx >= 0 ? 1 : -1,\n        w: w,\n        h: h,\n        life: 30000,\n        defId: objId,\n        isSeaRescueBox: true,\n        frameIndex: frameIndex,\n        gravity: G, // px/s^2\n        useSimplePhysics: true // Flag for updateProjectiles\n      };\n      \n      projectilesRef.current.push(proj);\n      \n      // Remove box from map via state update (avoid direct modification of read-only objectData)\n      if (typeof onStateUpdate === 'function') {\n        onStateUpdate('collectItem', { index });\n      }\n      \n      sr.draggedBox = null;\n\n      // Effects and Sounds\n      if (typeof playSfx === 'function') {\n        const outSound = def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\";\n        playSfx(outSound, 0.6);\n      }\n      if (refs.fx?.triggerSplash) {\n        refs.fx.triggerSplash(startX, currentStartY);\n      }\n    }\n  }\n}\n\nexport function drawSeaRescueTrajectory(ctx, graphics) {\n  const sr = ctx.refs.seaRescueRef;\n  if (!sr || !sr.draggedBox) return;\n  \n  const { startX, startY } = sr.draggedBox;\n  const driftY = ctx.driftY || 0;\n  const currentStartY = startY + driftY;\n  \n  const { mousePos } = ctx.input.current;\n  const cameraX = ctx.cameraX || ctx.refs?.cameraRef?.x || 0;\n  const cameraY = ctx.cameraY || ctx.refs?.cameraRef?.y || 0;\n  \n  const worldMouseX = ctx.refs?.mouseWorldPos?.x || (mousePos.x + cameraX);\n  const worldMouseY = ctx.refs?.mouseWorldPos?.y || (mousePos.y + cameraY);\n  \n  // Load physics settings\n  const findItemById = ctx.helpers?.findItemById || ((id) => null);\n  const settings = findItemById('sea_rescue_settings')?.physics || {};\n  const G = settings.gravity || 1600;\n  const POWER = settings.power || 6;\n  const MAX_DRAG = settings.maxDrag || 140;\n  const STEPS = settings.trajectorySteps || 35;\n  const DT = settings.dt || 0.06;\n  \n  const dragX = startX - worldMouseX;\n  const dragY = currentStartY - worldMouseY;\n  const dist = Math.sqrt(dragX * dragX + dragY * dragY);\n  const limitedDist = Math.min(dist, MAX_DRAG);\n  const ratio = limitedDist / (dist || 1);\n  \n  const vx = dragX * ratio * POWER;\n  const vy = dragY * ratio * POWER;\n  \n  graphics.clear();\n  graphics.beginFill(0xffffff, 0.8);\n  \n  // Get map bounds to stop trajectory\n  const activeId = ctx.mapData.meta?.activeMapId || ctx.mapData.meta?.activeMap || 'main';\n  const activeMap = ctx.mapData.maps ? ctx.mapData.maps[activeId] : ctx.mapData;\n  const ts = ctx.tileSize || 32;\n  const mapWidthPx = (activeMap.width || 20) * ts;\n  const mapHeightPx = (activeMap.height || 20) * ts;\n\n  for (let i = 1; i <= STEPS; i++) {\n    const t = i * DT;\n    const px = startX + vx * t;\n    const py = currentStartY + vy * t + 0.5 * G * t * t;\n    \n    // Stop if out of bounds\n    if (px < 0 || px > mapWidthPx || py > mapHeightPx) break;\n    \n    // Draw dot\n    graphics.drawCircle(px, py, 3);\n  }\n  graphics.endFill();\n}\n","import { Sprite, AnimatedSprite, Texture, Rectangle, Container, Graphics } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Sea Rescue boxes use a container for 50/50 water effect\n      if (p.isSeaRescueBox) {\n        spr = new Container();\n        spr.isSeaRescueBox = true;\n      }\n\n      const def = getRegItem(registryItems, p.defId);\n      if (def) {\n        if (Array.isArray(def.textures) && def.textures.length > 1) {\n          const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n          if (frames.length > 0) {\n            const anim = new AnimatedSprite(frames);\n            anim.animationSpeed = msToSpeed(def.animationSpeed);\n            anim.play();\n            if (spr instanceof Container) {\n              spr.addChild(anim);\n              spr.mainVisual = anim;\n            } else {\n              spr = anim;\n            }\n          }\n        } else if (def.spriteSheet && def.spriteSheet.enabled) {\n          const totalSprites = def.spriteSheet.totalSprites || 1;\n          const columns = def.spriteSheet.columns || totalSprites;\n          const frameIndex = p.frameIndex !== undefined ? p.frameIndex : (def.spriteSheet.frameIndex || 0);\n          \n          const baseTexture = getTexture(def.texture);\n          const source = baseTexture?.source;\n          if (source && source.width > 1) {\n            const frameWidth = source.width / columns;\n            const frameHeight = source.height / Math.ceil(totalSprites / columns);\n            const col = frameIndex % columns;\n            const row = Math.floor(frameIndex / columns);\n            const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n            const tex = new Texture({ source: source, frame: rect });\n            const s = new Sprite(tex);\n            if (spr instanceof Container) {\n              spr.addChild(s);\n              spr.mainVisual = s;\n            } else {\n              spr = s;\n            }\n          }\n        }\n      }\n      \n      if (!spr || (spr instanceof Container && spr.children.length === 0)) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        const s = new Sprite(tex);\n        if (spr instanceof Container) {\n          spr.addChild(s);\n          spr.mainVisual = s;\n        } else {\n          spr = s;\n        }\n      }\n      \n      if (spr.anchor) {\n        spr.anchor.set(0.5, 0.5);\n      } else if (spr.mainVisual && spr.mainVisual.anchor) {\n        spr.mainVisual.anchor.set(0.5, 0.5);\n      }\n      \n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x;\n    spr.y = p.y;\n    spr.rotation = p.rotation || 0;\n    \n    // Sea Rescue 50/50 Floating effect\n    if (spr.isSeaRescueBox && spr.mainVisual) {\n      if (p.floating) {\n        if (!spr.splitContainer) {\n          spr.mainVisual.visible = false;\n          spr.splitContainer = new Container();\n          spr.addChild(spr.splitContainer);\n          \n          // Full box sprite for above water\n          const topPart = new Sprite(spr.mainVisual.texture);\n          topPart.anchor.set(0.5, 0.5);\n          \n          // Full box sprite for below water (with tint)\n          const bottomPart = new Sprite(spr.mainVisual.texture);\n          bottomPart.anchor.set(0.5, 0.5);\n          bottomPart.tint = 0x4488ff;\n          bottomPart.alpha = 0.8;\n\n          // Masks to cut them horizontally\n          const topMask = new Graphics();\n          const bottomMask = new Graphics();\n          \n          spr.splitContainer.addChild(bottomPart);\n          spr.splitContainer.addChild(topPart);\n          spr.splitContainer.addChild(topMask);\n          spr.splitContainer.addChild(bottomMask);\n          \n          topPart.mask = topMask;\n          bottomPart.mask = bottomMask;\n          \n          spr.topMask = topMask;\n          spr.bottomMask = bottomMask;\n          spr.topPart = topPart;\n          spr.bottomPart = bottomPart;\n        }\n        \n        spr.splitContainer.visible = true;\n        \n        // Update masks to stay horizontal regardless of container rotation\n        // We want the water line to be at the container's center (spr.y)\n        // Since masks are children of spr, they move/rotate with spr.\n        // To keep them horizontal, we must counter-rotate them and adjust their shape.\n        \n        const baseY = p.baseY !== undefined ? p.baseY : p.y;\n        const dy = baseY - p.y; // World vertical offset from center to water line\n        const rotation = spr.rotation || 0;\n        const pWidth = Number(p.w) || tileSize;\n        const pHeight = Number(p.h) || tileSize;\n        const maskW = pWidth * 2; // Extra wide to cover during rotation\n        const maskH = Math.max(pHeight * 2, Math.abs(dy) + pHeight);\n        \n        if (!isNaN(pWidth) && !isNaN(pHeight)) {\n          // Calculate local coordinates for the water surface point (0, dy) in world space\n          // mx = dy * sin(rotation), my = dy * cos(rotation)\n          const mx = dy * Math.sin(rotation);\n          const my = dy * Math.cos(rotation);\n\n          spr.topMask.clear();\n          spr.topMask.rect(-maskW/2, -maskH, maskW, maskH);\n          spr.topMask.fill({ color: 0xffffff, alpha: 1 });\n          spr.topMask.position.set(mx, my);\n          spr.topMask.rotation = -rotation;\n          \n          spr.bottomMask.clear();\n          spr.bottomMask.rect(-maskW/2, 0, maskW, maskH);\n          spr.bottomMask.fill({ color: 0xffffff, alpha: 1 });\n          spr.bottomMask.position.set(mx, my);\n          spr.bottomMask.rotation = -rotation;\n        }\n\n        // Keep parts synced with main visual in case of animation\n        if (spr.mainVisual instanceof AnimatedSprite) {\n          spr.topPart.texture = spr.mainVisual.texture;\n          spr.bottomPart.texture = spr.mainVisual.texture;\n        }\n      } else {\n        if (spr.splitContainer) spr.splitContainer.visible = false;\n        spr.mainVisual.visible = true;\n      }\n    }\n    \n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = (p.dir === undefined || p.dir >= 0) ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","import { Sprite, Texture, Rectangle } from 'pixi.js';\nimport { getTexture } from './helpers';\n\n/**\n * Sinhroniz un atjaunina kustgo enttiju (piem. tanku) spraitus.\n * @param {Container} entitiesLayer PixiJS konteiners enttijm\n * @param {Map} entitySpritesMap Map, kur glabjas esoie spraiti (pc ID)\n * @param {Array} entitiesList Enttiju saraksts no dzinja\n * @param {Array} registryItems Reistra elementi\n * @param {number} tileSize Flzes izmrs pikseos\n */\nexport const syncEntities = (entitiesLayer, entitySpritesMap, entitiesList, registryItems, tileSize) => {\n  if (!entitiesLayer) return;\n\n  const seen = new Set();\n  const list = entitiesList || [];\n\n  for (const ent of list) {\n    const key = ent.id;\n    seen.add(key);\n\n    let spr = entitySpritesMap.get(key);\n    const def = ent.def || {};\n\n    if (!spr) {\n      // Izveidojam jaunu spraitu ar baltu tekstru k aizvietotju, kamr ldjas st\n      spr = new Sprite(Texture.WHITE);\n      spr.anchor.set(0, 0);\n      entitiesLayer.addChild(spr);\n      entitySpritesMap.set(key, spr);\n      spr._lastFrameIndex = -1;\n    }\n\n    // Atjaunojam tekstru no spritesheet, ja nepiecieams\n    const baseTexture = getTexture(def.texture);\n    const source = baseTexture?.source;\n    const isTextureReady = source && source.width > 1;\n\n    if (def.spriteSheet && def.spriteSheet.enabled && isTextureReady) {\n      const columns = def.spriteSheet.columns || 1;\n      const frameIndex = ent.currentSpriteIndex !== undefined ? ent.currentSpriteIndex : 0;\n      \n      if (spr._lastFrameIndex !== frameIndex) {\n        const texWidth = source.width;\n        const texHeight = source.height;\n        const totalSprites = def.spriteSheet.totalSprites || 1;\n\n        // Ja kolonnu skaits JSON ir nepareizs vai trkst, minm to aprint\n        let effectiveColumns = columns;\n        if (!effectiveColumns || effectiveColumns <= 0) {\n            effectiveColumns = Math.floor(texWidth / (def.spriteSheet.frameWidth || 32)) || 1;\n        }\n\n        const frameWidth = texWidth / effectiveColumns;\n        const frameHeight = texHeight / Math.ceil(totalSprites / effectiveColumns);\n        \n        const col = frameIndex % effectiveColumns;\n        const row = Math.floor(frameIndex / effectiveColumns);\n        \n        const rect = new Rectangle(col * frameWidth, row * frameHeight, frameWidth, frameHeight);\n        \n        try {\n            spr.texture = new Texture({\n              source: source,\n              frame: rect\n            });\n            spr._lastFrameIndex = frameIndex;\n        } catch (e) {\n            console.warn(`Failed to create texture for entity ${key} frame ${frameIndex}`, e);\n            spr.texture = baseTexture;\n        }\n      }\n    } else if (isTextureReady) {\n      if (spr.texture !== baseTexture) {\n        spr.texture = baseTexture;\n        spr._lastFrameIndex = -1;\n      }\n    } else if (def.editorIcon) {\n        // Ja nav tekstras, bet ir ikona (piemram, bultia, kaut gan ts te nevajadztu bt k enttijai)\n        if (spr.texture !== Texture.WHITE) spr.texture = Texture.WHITE;\n    }\n\n    // Pozcija un izmrs\n    const targetWidth = ent.width || tileSize;\n    const targetHeight = ent.height || tileSize;\n    \n    spr.width = targetWidth;\n    spr.height = targetHeight;\n    \n    // Nodroinm, ka scale nav 0 vai NaN (ja tekstra bija dvaina skum)\n    if (!spr.scale.x || isNaN(spr.scale.x)) spr.scale.x = 1;\n    if (!spr.scale.y || isNaN(spr.scale.y)) spr.scale.y = 1;\n\n    // Virziens (flipping)\n    const direction = ent.direction !== undefined ? ent.direction : 1;\n    const flipY = !!ent.flipY;\n    const alpha = Number.isFinite(ent.alpha) ? ent.alpha : 1;\n    \n    // Ja ir definta rotcija (piem. akmeiem), izmantojam centru k enkuru\n    if (ent.rotation !== undefined) {\n        spr.anchor.set(0.5, 0.5);\n        spr.x = ent.x + targetWidth / 2;\n        spr.y = ent.y + targetHeight / 2;\n        spr.rotation = ent.rotation;\n        spr.alpha = alpha;\n        \n        // Flipping ar centru enkuru\n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n    } else {\n        // Standarta enkurs (augjais kreisais stris)\n        spr.anchor.set(0, 0);\n        spr.rotation = 0;\n        spr.alpha = alpha;\n        \n        const absScaleX = Math.abs(spr.scale.x);\n        const absScaleY = Math.abs(spr.scale.y);\n        spr.scale.x = direction >= 0 ? absScaleX : -absScaleX;\n        spr.scale.y = flipY ? -absScaleY : absScaleY;\n        \n        // Pozicionana emot vr flipping pie enkura (0,0)\n        spr.x = ent.x + (direction < 0 ? targetWidth : 0);\n        spr.y = ent.y + (flipY ? targetHeight : 0);\n    }\n  }\n\n  // Noemam spraitus enttijm, kas vairs neeksist\n  for (const [key, spr] of entitySpritesMap.entries()) {\n    if (!seen.has(key)) {\n      if (spr.parent) spr.parent.removeChild(spr);\n      spr.destroy({ children: true, texture: false }); // Tekstras koplietoanas d ts neizncinm\n      entitySpritesMap.delete(key);\n    }\n  }\n};\n\n/**\n * Attra visus enttiju spraitus.\n */\nexport const cleanupEntities = (entitySpritesMap) => {\n  for (const spr of entitySpritesMap.values()) {\n    if (spr.parent) spr.parent.removeChild(spr);\n    spr.destroy({ children: true, texture: false });\n  }\n  entitySpritesMap.clear();\n};\n","// Item collection extracted from useGameEngine.js\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState, maps, activeRoomIds, objectMetadata: mainMetadata, secretMapData, activeMapId } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  // --- ROOM OVERLAY LOGIC ---\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && mainMetadata) {\n    if (!gameState.current.collectedItems) {\n      gameState.current.collectedItems = new Set();\n    }\n\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          // Inside a room!\n          const localX = centerX - rx;\n          const localY = centerY - ry;\n          const rWidth = roomMap.mapWidth || roomMap.width || 20;\n          const rgX = Math.floor(localX / TILE_SIZE);\n          const rgY = Math.floor(localY / TILE_SIZE);\n          const rIndex = rgY * rWidth + rgX;\n          \n          const itemKey = `${meta.linkedMapId}:${rIndex}`;\n          if (gameState.current.collectedItems.has(itemKey)) return;\n\n          const rObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          if (rObjectData && rObjectData[rIndex]) {\n            // Call collectItem recursively or just handle it here\n            const rItemId = rObjectData[rIndex];\n            const rItemDef = getDefById(registryItems, rItemId);\n            \n            if (rItemDef && rItemDef.pickup && !rItemId.includes('player')) {\n               if (rItemDef.name && rItemDef.name.startsWith('interactable.')) return;\n\n               // Pick it up\n               let pickedUp = false;\n               if (rItemDef.effect && rItemDef.effect.health) {\n                 const healthBonus = parseInt(rItemDef.effect.health, 10);\n                 if (gameState.current.health < MAX_HEALTH) {\n                   gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n                   pickedUp = true;\n                 }\n               } else if (rItemDef.effect && rItemDef.effect.fireball) {\n                 const ammoBonus = parseInt(rItemDef.effect.fireball, 10) || 0;\n                 gameState.current.ammo = (gameState.current.ammo || 0) + ammoBonus;\n                 pickedUp = true;\n               }\n\n               if (pickedUp) {\n                 gameState.current.collectedItems.add(itemKey);\n                 try {\n                   playShotSfx(rItemDef?.sfx, Math.max(0, Math.min(1, rItemDef?.sfxVolume ?? 1)));\n                 } catch {}\n                 if (onStateUpdate) {\n                   onStateUpdate('collectItem', { index: rIndex, mapId: meta.linkedMapId });\n                 }\n                 return;\n               }\n            }\n          }\n          // If we are in a room, we don't pick up items from the main map below\n          return;\n        }\n      }\n    }\n  }\n  // --- END ROOM OVERLAY LOGIC ---\n\n  if (!gameState.current.collectedItems) {\n    gameState.current.collectedItems = new Set();\n  }\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const mapKey = activeMapId || 'main';\n  const itemKey = `${mapKey}:${index}`;\n  if (gameState.current.collectedItems.has(itemKey)) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = getDefById(registryItems, itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', { index, mapId: mapKey });\n    return;\n  }\n}\n","export function resolveInteractableContext({\n  mapData,\n  mapWidth,\n  mapHeight,\n  objectLayerData,\n  mainObjectMetadata,\n  secretMapData,\n  activeRoomIds: activeRoomIdsProp,\n  centerX,\n  centerY,\n  TILE_SIZE\n}) {\n  const hasMainMetadata = mainObjectMetadata && Object.keys(mainObjectMetadata).length > 0;\n  let activeTargetMap = mapData;\n  let activeObjectData = objectLayerData;\n  let activeMetadata = hasMainMetadata\n    ? mainObjectMetadata\n    : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n  let activeMapWidth = mapWidth;\n  let activeMapHeight = mapHeight;\n  let offsetX = 0;\n  let offsetY = 0;\n  let currentMapId = mapData?.id || 'main';\n\n  const projectMaps = mapData?.maps || mapData?.projectMaps || {};\n  const activeRoomIds = activeRoomIdsProp || mapData?.meta?.activeRoomIds || [];\n\n  if (activeRoomIds.length > 0) {\n    const mainMetadata = hasMainMetadata\n      ? mainObjectMetadata\n      : (mapData?.objectMetadata || mapData?.meta?.objectMetadata || {});\n    for (const [idxStr, meta] of Object.entries(mainMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      if (secretMapData && secretMapData[idx] !== 'room_area') continue;\n      if (meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = projectMaps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidth) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidth) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (centerX >= rx && centerX < rx + rw && centerY >= ry && centerY < ry + rh) {\n          activeTargetMap = roomMap;\n          activeMapWidth = roomMap.mapWidth || roomMap.width || 20;\n          activeMapHeight = roomMap.mapHeight || roomMap.height || 15;\n          activeObjectData = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities')?.data;\n          activeMetadata = roomMap.objectMetadata || {};\n          offsetX = rx;\n          offsetY = ry;\n          currentMapId = meta.linkedMapId;\n          break;\n        }\n      }\n    }\n  }\n\n  return {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps,\n    activeRoomIds\n  };\n}\n\nexport default { resolveInteractableContext };\n","/**\n * Finds spawn position in a map by trigger ID or player start\n */\nexport function findSpawnPosition(map, triggerId, tileSize) {\n  if (!map) return null;\n\n  const mapW = map.width || map.mapWidth || map.meta?.width || 20;\n  const metadata = map.objectMetadata || map.meta?.objectMetadata || {};\n\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data;\n\n  if (!objData) return null;\n\n  let spawnIdx = -1;\n\n  const triggerRequested = triggerId !== undefined && triggerId !== null && triggerId !== '';\n  if (triggerRequested) {\n    for (let i = 0; i < objData.length; i++) {\n      if (!objData[i]) continue;\n      if (metadata[i] && metadata[i].triggerId === triggerId) {\n        spawnIdx = i;\n        break;\n      }\n    }\n  }\n\n  if (spawnIdx === -1 && !triggerRequested) {\n    spawnIdx = objData.findIndex(id => id && id.includes('player'));\n  }\n\n  if (spawnIdx !== -1) {\n    return {\n      x: (spawnIdx % mapW) * tileSize,\n      y: Math.floor(spawnIdx / mapW) * tileSize\n    };\n  }\n\n  return null;\n}\n\nexport default { findSpawnPosition };\n","import { findSpawnPosition } from './spawn';\n\nconst resolveMapObjects = (map) => {\n  if (!map) return { mapW: 20, objData: [], metadata: {} };\n  const mapW = map.mapWidth || map.width || map.meta?.width || 20;\n  const objLayer = map.layers?.find(l => l.name === 'entities' || l.type === 'object');\n  const objData = map.objectMapData || objLayer?.data || [];\n  const metadata = map.objectMetadata || map.meta?.objectMetadata || {};\n  return { mapW, objData, metadata };\n};\n\nconst findExitDoorSpawn = ({ map, targetRoomId, roomMeta, tileSize }) => {\n  const { mapW, objData, metadata } = resolveMapObjects(map);\n  if (!Array.isArray(objData) || objData.length === 0) return null;\n\n  const matchIds = [];\n  if (roomMeta?.spawnTriggerId !== undefined && roomMeta?.spawnTriggerId !== null && roomMeta?.spawnTriggerId !== '') {\n    matchIds.push(roomMeta.spawnTriggerId);\n  }\n  if (roomMeta?.triggerId !== undefined && roomMeta?.triggerId !== null && roomMeta?.triggerId !== '') {\n    if (!matchIds.includes(roomMeta.triggerId)) {\n      matchIds.push(roomMeta.triggerId);\n    }\n  }\n  let candidateIdx = -1;\n  let matchedIdx = -1;\n\n  for (let i = 0; i < objData.length; i++) {\n    const id = objData[i];\n    if (!id || !String(id).includes('door')) continue;\n    const meta = metadata[i];\n    if (!meta || meta.targetMapId !== targetRoomId) continue;\n    if (candidateIdx === -1) candidateIdx = i;\n    if (matchIds.length) {\n      if (matchIds.some(id => meta.spawnTriggerId === id || meta.triggerId === id)) {\n        matchedIdx = i;\n        break;\n      }\n    }\n  }\n\n  const doorIdx = matchedIdx !== -1 ? matchedIdx : candidateIdx;\n  if (doorIdx === -1) return null;\n  return {\n    index: doorIdx,\n    x: (doorIdx % mapW) * tileSize,\n    y: Math.floor(doorIdx / mapW) * tileSize,\n    meta: metadata[doorIdx] || {}\n  };\n};\n\nexport function handleDoorInteraction({\n  objDef,\n  currentMeta,\n  actualIndex,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  mapData,\n  mapWidth,\n  TILE_SIZE,\n  activeTargetMap,\n  projectMaps\n}) {\n  if (!objDef || objDef.subtype !== 'door') return false;\n  if (!keys?.e) return true;\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 600) return true;\n  gameState.current.lastETime = now;\n\n  const sound = currentMeta?.sound || objDef.interaction?.sound;\n  if (sound) {\n    try { playShotSfx(sound, objDef.sfxVolume || 0.5); } catch {}\n  }\n\n  if (onStateUpdate) {\n    onStateUpdate('setObjectFrame', {\n      index: actualIndex,\n      frame: objDef.interaction?.frames?.opening || 1,\n      mapId: activeTargetMap === mapData ? null : activeTargetMap.id\n    });\n  }\n\n  const delayS = currentMeta?.delaySeconds !== undefined ? currentMeta.delaySeconds : (objDef.interaction?.delaySeconds || 0.5);\n  const targetMapId = currentMeta?.targetMapId;\n\n  if (onStateUpdate && targetMapId) {\n    setTimeout(() => {\n      const targetMap = projectMaps[targetMapId];\n      const isRoom = targetMap && targetMap.type === 'room';\n      const isExitingRoom = !isRoom && activeTargetMap !== mapData && targetMapId === 'main';\n\n      if (isRoom || isExitingRoom) {\n        let newX = gameState.current.x;\n        let newY = gameState.current.y;\n        let exitTriggerId = currentMeta?.spawnTriggerId;\n        if (exitTriggerId === undefined || exitTriggerId === null || exitTriggerId === '') {\n          exitTriggerId = currentMeta?.triggerId;\n        }\n\n        if (isRoom) {\n          const roomAreaMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {};\n          const roomAreaEntry = Object.entries(roomAreaMeta)\n            .find(([, m]) => m.linkedMapId === targetMapId);\n          let rx = 0;\n          let ry = 0;\n          if (roomAreaEntry) {\n            const raIdx = parseInt(roomAreaEntry[0], 10);\n            rx = (raIdx % mapWidth) * TILE_SIZE;\n            ry = Math.floor(raIdx / mapWidth) * TILE_SIZE;\n          }\n          const spawn = findSpawnPosition(targetMap, currentMeta.spawnTriggerId, TILE_SIZE);\n          if (spawn) {\n            newX = rx + spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n            newY = ry + spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n          }\n        } else {\n          const roomAreaMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata || {};\n          const roomAreaEntry = Object.entries(roomAreaMeta)\n            .find(([, m]) => m.linkedMapId === activeTargetMap.id);\n          if (roomAreaEntry) {\n            let spawnFound = false;\n            if (exitTriggerId !== undefined && exitTriggerId !== null && exitTriggerId !== '') {\n              const spawn = findSpawnPosition(mapData, exitTriggerId, TILE_SIZE);\n              if (spawn) {\n                newX = spawn.x + (TILE_SIZE - gameState.current.width) / 2;\n                newY = spawn.y + (TILE_SIZE - gameState.current.height) / 2;\n                spawnFound = true;\n              }\n            }\n            if (!spawnFound) {\n              const fallback = findExitDoorSpawn({\n                map: mapData,\n                targetRoomId: activeTargetMap.id,\n                roomMeta: currentMeta,\n                tileSize: TILE_SIZE\n              });\n              if (fallback) {\n                newX = fallback.x + (TILE_SIZE - gameState.current.width) / 2;\n                newY = fallback.y + (TILE_SIZE - gameState.current.height) / 2;\n                spawnFound = true;\n                if (exitTriggerId === undefined || exitTriggerId === null || exitTriggerId === '') {\n                  if (fallback.meta?.triggerId !== undefined) {\n                    exitTriggerId = fallback.meta.triggerId;\n                  } else if (fallback.meta?.spawnTriggerId !== undefined) {\n                    exitTriggerId = fallback.meta.spawnTriggerId;\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        gameState.current.x = newX;\n        gameState.current.y = newY;\n        gameState.current.vx = 0;\n        gameState.current.vy = 0;\n        const triggerId = isExitingRoom ? exitTriggerId : currentMeta.spawnTriggerId;\n        onStateUpdate('switchMap', { targetMapId, triggerId });\n      } else {\n        onStateUpdate('switchMap', { targetMapId, triggerId: currentMeta.spawnTriggerId });\n      }\n    }, delayS * 1000);\n  }\n\n  return true;\n}\n\nexport default { handleDoorInteraction };\n","export function handleTeleportInteraction({\n  objId,\n  objDef,\n  currentMeta,\n  actualIndex,\n  activeObjectData,\n  activeMetadata,\n  activeMapWidth,\n  offsetX,\n  offsetY,\n  projectMaps,\n  onStateUpdate,\n  playShotSfx,\n  gameState,\n  TILE_SIZE\n}) {\n  if (!objId || !objId.includes('portal')) return false;\n  if (!currentMeta || currentMeta.triggerId === undefined || currentMeta.triggerId === null) return true;\n\n  const targetMapId = currentMeta.targetMapId;\n  if (targetMapId && projectMaps && projectMaps[targetMapId]) {\n    if (onStateUpdate) {\n      onStateUpdate('switchMap', {\n        targetMapId,\n        triggerId: currentMeta.triggerId\n      });\n      try {\n        const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n        playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n      } catch {}\n    }\n    return true;\n  }\n\n  for (let i = 0; i < (activeObjectData?.length || 0); i++) {\n    if (i === actualIndex) continue;\n    const destId = activeObjectData[i];\n    if (destId && (destId.includes('target') || destId === 'portal_target')) {\n      const destMeta = activeMetadata?.[i];\n      if (destMeta && destMeta.triggerId === currentMeta.triggerId) {\n        const tx = offsetX + (i % activeMapWidth) * TILE_SIZE;\n        const ty = offsetY + Math.floor(i / activeMapWidth) * TILE_SIZE;\n\n        gameState.current.x = tx;\n        gameState.current.y = ty;\n\n        try {\n          const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n          playShotSfx(objDef?.sfx || \"/assets/sound/sfx/teleport.ogg\", vol);\n        } catch {}\n        return true;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport default { handleTeleportInteraction };\n","export function applyInteractableEffects({\n  objDef,\n  actualIndex,\n  currentMapId,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  MAX_HEALTH\n}) {\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return false;\n  if (!objDef.effect) return true;\n\n  const interactableKey = currentMapId === 'main' ? `${actualIndex}` : `${currentMapId}:${actualIndex}`;\n  if (gameState.current.usedInteractables.has(interactableKey)) return true;\n\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return true;\n\n    gameState.current.health = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(interactableKey);\n    if (onStateUpdate) onStateUpdate('interactable', { index: actualIndex, mapId: currentMapId === 'main' ? null : currentMapId });\n    return true;\n  }\n\n  return true;\n}\n\nexport default { applyInteractableEffects };\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = getDefById(registryItems, startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n  const revealedSet = (revealedSecrets instanceof Set)\n    ? revealedSecrets\n    : new Set(revealedSecrets || []);\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSet.has(idx)) continue;\n\n      const def = getDefById(registryItems, secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSet.has(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","import i18n from './i18n';\nimport enMessages from './translations/en/tutorial_messages.json';\nimport lvMessages from './translations/lv/tutorial_messages.json';\nimport noMessages from './translations/no/tutorial_messages.json';\nimport ruMessages from './translations/ru/tutorial_messages.json';\nimport jaMessages from './translations/ja/tutorial_messages.json';\n\nconst MESSAGES = {\n  en: enMessages,\n  lv: lvMessages,\n  no: noMessages,\n  ru: ruMessages,\n  ja: jaMessages\n};\n\nconst getLang = (lang) => {\n  const raw = lang || i18n?.language || 'en';\n  const base = raw.includes('-') ? raw.split('-')[0] : raw;\n  return MESSAGES[base] ? base : 'en';\n};\n\nexport const getTutorialChapters = (lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  return Array.from(new Set([...Object.keys(fallback), ...Object.keys(data)])).sort();\n};\n\nexport const getTutorialItems = (chapter, lang) => {\n  const l = getLang(lang);\n  const data = MESSAGES[l] || {};\n  const fallback = MESSAGES.en || {};\n  const chapterData = (data[chapter] && Object.keys(data[chapter]).length)\n    ? data[chapter]\n    : (fallback[chapter] || {});\n  return Object.keys(chapterData)\n    .sort((a, b) => Number(a) - Number(b))\n    .map((id) => ({ id, text: chapterData[id] }));\n};\n\nexport const getTutorialText = (chapter, id, lang) => {\n  if (!chapter || id === undefined || id === null) return '';\n  const l = getLang(lang);\n  const data = MESSAGES[l] || MESSAGES.en || {};\n  const fallback = (MESSAGES.en || {})[chapter]?.[String(id)] || '';\n  return data[chapter]?.[String(id)] || fallback;\n};\n\nexport default {\n  getTutorialChapters,\n  getTutorialItems,\n  getTutorialText\n};\n","// Secret-related trigger handlers (weather, messages)\nimport { getTutorialText } from '../../../i18n/tutorialMessages';\n\nexport function handleWeatherTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx\n}) {\n  if (!objDef || objDef.type !== 'weather_trigger') return false;\n\n  const weatherType = objDef.weatherType; // rain, snow, clouds, fog, thunder\n  const action = objDef.weatherAction; // on, off, set\n  let value = 0;\n\n  if (action === 'set' || action === 'on') {\n    value = currentMeta?.intensity !== undefined ? currentMeta.intensity : (action === 'on' ? 100 : 50);\n  } else if (action === 'off') {\n    value = 0;\n  }\n\n  if (!gameState.current.lastWeatherTrigger) {\n    gameState.current.lastWeatherTrigger = {};\n  }\n\n  const lastVal = gameState.current.lastWeatherTrigger[index];\n  if (lastVal !== value) {\n    if (onStateUpdate) {\n      onStateUpdate('updateWeather', { type: weatherType, value });\n    }\n    gameState.current.lastWeatherTrigger[index] = value;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport function handleMessageTrigger({\n  objDef,\n  currentMeta,\n  index,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  keys\n}) {\n  if (!objDef || objDef.type !== 'message_trigger') return false;\n\n  const requiresActionKey = !!(objDef.requiresActionKey || objDef.interaction?.requiresKey);\n  if (requiresActionKey && !keys?.e) {\n    return false;\n  }\n\n  const i18nChapter = currentMeta?.i18nChapter;\n  const i18nId = currentMeta?.i18nId;\n  const message = (currentMeta?.message && String(currentMeta.message).trim())\n    ? currentMeta.message\n    : (i18nChapter && i18nId ? getTutorialText(i18nChapter, i18nId) : null);\n  if (!message) return true;\n\n  if (!gameState.current.lastMessageTrigger) {\n    gameState.current.lastMessageTrigger = {};\n  }\n\n  const lastMsg = gameState.current.lastMessageTrigger[index];\n  if (lastMsg !== message) {\n    if (onStateUpdate) {\n      onStateUpdate('showMessage', { text: message, duration: 8000 });\n    }\n    gameState.current.lastMessageTrigger[index] = message;\n\n    if (objDef.sfx) {\n      try {\n        playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5);\n      } catch {}\n    }\n  }\n  return true;\n}\n\nexport default { handleWeatherTrigger, handleMessageTrigger };\n","// Wolfenstein-style secret triggers and movement handling\n\nexport function triggerWolfSecret({\n  objDef,\n  index,\n  keys,\n  gameState,\n  onStateUpdate,\n  playShotSfx,\n  playerCenterX,\n  playerCenterY,\n  objCenterX,\n  objCenterY,\n  playerGridX,\n  playerGridY,\n  objGridX,\n  objGridY\n}) {\n  if (!objDef || objDef.type !== 'wolf_secret') return false;\n  if (!keys?.e) return true;\n\n  const moveX = objDef.moveX || 0;\n  const moveY = objDef.moveY || 0;\n  if (moveX !== 0 || moveY !== 0) {\n    const hasGrid = Number.isFinite(playerGridX) && Number.isFinite(playerGridY) && Number.isFinite(objGridX) && Number.isFinite(objGridY);\n    if (hasGrid) {\n      if (moveX < 0 && !(playerGridX > objGridX)) return true;\n      if (moveX > 0 && !(playerGridX < objGridX)) return true;\n      if (moveY < 0) {\n        if (!keys?.w) return true;\n        if (!(playerGridY > objGridY)) return true;\n      }\n      if (moveY > 0) {\n        if (!keys?.s) return true;\n        if (!(playerGridY < objGridY)) return true;\n      }\n    } else {\n      const eps = 0.01;\n      if (moveX < 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX > objCenterX + eps)) return true;\n      }\n      if (moveX > 0 && playerCenterX !== undefined && objCenterX !== undefined) {\n        if (!(playerCenterX < objCenterX - eps)) return true;\n      }\n      if (moveY < 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.w) return true;\n        if (!(playerCenterY > objCenterY + eps)) return true;\n      }\n      if (moveY > 0 && playerCenterY !== undefined && objCenterY !== undefined) {\n        if (!keys?.s) return true;\n        if (!(playerCenterY < objCenterY - eps)) return true;\n      }\n    }\n  }\n\n  if (!gameState.current.lastETime) gameState.current.lastETime = 0;\n  const now = Date.now();\n  if (now - gameState.current.lastETime < 1000) return true;\n  gameState.current.lastETime = now;\n\n  if (onStateUpdate) {\n    const dx = moveX;\n    const dy = moveY;\n    onStateUpdate('shiftTile', { index, dx, dy });\n\n    if (objDef.sfx) {\n      try { playShotSfx(objDef.sfx, objDef.sfxVolume || 0.5); } catch {}\n    }\n  }\n  return true;\n}\n\nexport function applyWolfSecretShift({\n  index,\n  dx,\n  dy,\n  mapWidth,\n  mapHeight,\n  getObjectId,\n  getObjectDef,\n  moveTile,\n  moveObject,\n  moveMetadata,\n  removeObject,\n  stepDelayMs = 250,\n  setTimeoutFn = setTimeout,\n  shouldCancel\n}) {\n  let currentIdx = index;\n  let remainingDx = dx;\n  let remainingDy = dy;\n  const originId = getObjectId(currentIdx);\n  if (!originId) return;\n\n  const moveStep = () => {\n    if (shouldCancel && shouldCancel()) return;\n    const currentId = getObjectId(currentIdx);\n    if (!currentId || currentId !== originId) return;\n    if (remainingDx === 0 && remainingDy === 0) {\n      if (removeObject) removeObject(currentIdx);\n      return;\n    }\n\n    const stepX = remainingDx > 0 ? 1 : (remainingDx < 0 ? -1 : 0);\n    const stepY = remainingDy > 0 ? 1 : (remainingDy < 0 ? -1 : 0);\n\n    const tx = (currentIdx % mapWidth) + stepX;\n    const ty = Math.floor(currentIdx / mapWidth) + stepY;\n\n    if (tx >= 0 && tx < mapWidth && ty >= 0 && ty < mapHeight) {\n      const targetIndex = ty * mapWidth + tx;\n\n      const isLastStepOfBatch = (Math.abs(remainingDx) === 1 && remainingDy === 0) ||\n        (Math.abs(remainingDy) === 1 && remainingDx === 0);\n      if (isLastStepOfBatch) {\n        const targetObjId = getObjectId(targetIndex);\n        const targetDef = getObjectDef(targetObjId);\n        if (targetDef && targetDef.type === 'wolf_secret') {\n          const extraX = Math.abs(targetDef.moveX || 3);\n          const extraY = Math.abs(targetDef.moveY || 3);\n          if (remainingDx !== 0) remainingDx += (remainingDx > 0 ? extraX : -extraX);\n          if (remainingDy !== 0) remainingDy += (remainingDy > 0 ? extraY : -extraY);\n        }\n      }\n\n      if (moveTile) moveTile(currentIdx, targetIndex);\n      if (moveObject) moveObject(currentIdx, targetIndex);\n      if (moveMetadata) moveMetadata(currentIdx, targetIndex);\n\n      currentIdx = targetIndex;\n      remainingDx -= stepX;\n      remainingDy -= stepY;\n\n      if (remainingDx !== 0 || remainingDy !== 0) {\n        setTimeoutFn(moveStep, stepDelayMs);\n      } else {\n        if (removeObject) removeObject(currentIdx);\n      }\n    } else {\n      if (removeObject) removeObject(currentIdx);\n    }\n  };\n\n  moveStep();\n}\n\nexport default { triggerWolfSecret, applyWolfSecretShift };\n","// Helpers for crack_block secret behavior\n\nexport function shouldRemoveCrackBlock(def, newHealth) {\n  if (!def || def.type !== 'crack_block') return false;\n  const threshold = def.passableHealthThreshold || 0;\n  return newHealth <= threshold;\n}\n\nexport default { shouldRemoveCrackBlock };\n","import { resolveInteractableContext } from './context';\nimport { handleDoorInteraction } from './doors';\nimport { handleTeleportInteraction } from './teleport';\nimport { applyInteractableEffects } from './effects';\nimport { handleWeatherTrigger, handleMessageTrigger, triggerWolfSecret } from '../secrets';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, mapHeight, objectLayerData) {\n  const {\n    registryItems,\n    TILE_SIZE,\n    MAX_HEALTH,\n    playShotSfx,\n    onStateUpdate,\n    gameState,\n    mapData,\n    activeRoomIds: activeRoomIdsProp,\n    objectMetadata: mainObjectMetadata,\n    secretMapData\n  } = ctx;\n  if (!objectLayerData) return;\n\n  const keys = ctx.input?.current || {};\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const {\n    activeTargetMap,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    activeMapHeight,\n    offsetX,\n    offsetY,\n    currentMapId,\n    projectMaps\n  } = resolveInteractableContext({\n    mapData,\n    mapWidth,\n    mapHeight,\n    objectLayerData,\n    mainObjectMetadata,\n    secretMapData,\n    activeRoomIds: activeRoomIdsProp,\n    centerX,\n    centerY,\n    TILE_SIZE\n  });\n\n  const localX = centerX - offsetX;\n  const localY = centerY - offsetY;\n\n  const gridX = Math.floor(localX / TILE_SIZE);\n  const gridY = Math.floor(localY / TILE_SIZE);\n  let index = gridY * activeMapWidth + gridX;\n\n  if (keys.e) {\n    let targetIndex = null;\n\n    if (keys.w) {\n        const upIndex = (gridY - 1) * activeMapWidth + gridX;\n        if (gridY - 1 >= 0) {\n          const upObjId = activeObjectData?.[upIndex];\n          const upDef = getDefById(registryItems, upObjId);\n          if (upDef && upDef.type === 'wolf_secret') {\n            targetIndex = upIndex;\n          }\n        }\n      }\n\n    if (targetIndex === null && keys.s) {\n      const downIndex = (gridY + 1) * activeMapWidth + gridX;\n      const limitHeight = activeMapHeight || mapHeight || 0;\n      if (gridY + 1 < limitHeight) {\n        const downObjId = activeObjectData?.[downIndex];\n        const downDef = getDefById(registryItems, downObjId);\n        if (downDef && downDef.type === 'wolf_secret') {\n          targetIndex = downIndex;\n        }\n      }\n    }\n\n    if (targetIndex === null) {\n      const dir = keys.d ? 1 : (keys.a ? -1 : (gameState.current.direction || 1));\n      const frontX = localX + dir * (TILE_SIZE * 0.8);\n      const frontGridX = Math.floor(frontX / TILE_SIZE);\n      const frontIndex = gridY * activeMapWidth + frontGridX;\n\n      if (frontIndex >= 0 && frontIndex < (activeObjectData?.length || 0)) {\n        const frontObjId = activeObjectData[frontIndex];\n        if (frontObjId) {\n          const frontDef = getDefById(registryItems, frontObjId);\n          if (frontDef && (\n            frontDef.type === 'wolf_secret' ||\n            frontDef.subtype === 'door' ||\n            frontDef.name?.startsWith('interactable.') ||\n            (frontDef.type === 'message_trigger' && (frontDef.requiresActionKey || frontDef.interaction?.requiresKey))\n          )) {\n            targetIndex = frontIndex;\n          }\n        }\n      }\n    }\n\n    if (targetIndex !== null) {\n      index = targetIndex;\n    }\n  }\n\n  let foundIndex = -1;\n  const directObjId = activeObjectData ? activeObjectData[index] : null;\n  if (directObjId) {\n    foundIndex = index;\n  } else if (activeMetadata) {\n    for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n      const idx = parseInt(idxStr, 10);\n      const w = meta.width || 1;\n      const h = meta.height || 1;\n      if (w > 1 || h > 1) {\n        const ox = idx % activeMapWidth;\n        const oy = Math.floor(idx / activeMapWidth);\n        if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n          if (activeObjectData && activeObjectData[idx]) {\n            foundIndex = idx;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (foundIndex === -1) return;\n  const actualIndex = foundIndex;\n\n  let currentMeta = activeMetadata?.[actualIndex];\n  if (!currentMeta && mapData) {\n    const fromMap = mapData?.maps?.[currentMapId]?.objectMetadata;\n    const fromMeta = mapData?.meta?.objectMetadata || mapData?.objectMetadata;\n    currentMeta = (fromMap && fromMap[actualIndex]) || (fromMeta && fromMeta[actualIndex]) || currentMeta;\n  }\n  const objId = activeObjectData[actualIndex];\n  if (!objId) return;\n\n  const objDef = getDefById(registryItems, objId);\n  if (!objDef) return;\n\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (handleWeatherTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx })) return;\n  if (handleMessageTrigger({ objDef, currentMeta, index: actualIndex, gameState, onStateUpdate, playShotSfx, keys })) return;\n  if (triggerWolfSecret({\n    objDef,\n    index: actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    playerCenterX: localX,\n    playerCenterY: localY,\n    objCenterX: ((actualIndex % activeMapWidth) + 0.5) * TILE_SIZE,\n    objCenterY: (Math.floor(actualIndex / activeMapWidth) + 0.5) * TILE_SIZE,\n    playerGridX: gridX,\n    playerGridY: gridY,\n    objGridX: actualIndex % activeMapWidth,\n    objGridY: Math.floor(actualIndex / activeMapWidth)\n  })) return;\n\n  if (handleDoorInteraction({\n    objDef,\n    currentMeta,\n    actualIndex,\n    keys,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    mapData,\n    mapWidth,\n    TILE_SIZE,\n    activeTargetMap,\n    projectMaps\n  })) return;\n\n  if (handleTeleportInteraction({\n    objId,\n    objDef,\n    currentMeta,\n    actualIndex,\n    activeObjectData,\n    activeMetadata,\n    activeMapWidth,\n    offsetX,\n    offsetY,\n    projectMaps,\n    onStateUpdate,\n    playShotSfx,\n    gameState,\n    TILE_SIZE\n  })) return;\n\n  if (objDef.subtype === 'end' && !gameState.current.isWinning) {\n    gameState.current.isWinning = true;\n    gameState.current.winCounter = 0;\n    gameState.current.winCountSpeed = objDef.winCountSpeed || 10;\n    return;\n  }\n\n  applyInteractableEffects({\n    objDef,\n    actualIndex,\n    currentMapId,\n    gameState,\n    onStateUpdate,\n    playShotSfx,\n    MAX_HEALTH\n  });\n}\n\nexport default { checkInteractables };\n","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor(playerRight / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor(playerBottom / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = getDefById(registryItems, objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight >= tileLeft && playerLeft <= tileRight;\n      const overlapsVertically = playerBottom >= tileTop && playerTop <= tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const overlapTop = playerBottom - tileTop;\n        const overlapBottom = tileBottom - playerTop;\n        const overlapLeft = playerRight - tileLeft;\n        const overlapRight = tileRight - playerLeft;\n        const min = Math.min(overlapTop, overlapBottom, overlapLeft, overlapRight);\n        touchingTop = (min === overlapTop);\n        touchingBottom = (!touchingTop && min === overlapBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === overlapLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","import meteorBreakEffectsConfig from '../../assets/json/system/meteor_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst clamp01 = (v) => Math.max(0, Math.min(1, v));\n\nconst getConfig = () => {\n  if (!meteorBreakEffectsConfig || meteorBreakEffectsConfig.enabled === false) return null;\n  return meteorBreakEffectsConfig;\n};\n\nconst lerp = (a, b, t) => a + (b - a) * t;\n\nconst scaleFromRange = (range, fallback, t) => {\n  if (!Array.isArray(range) || range.length < 2) return fallback;\n  const a = Number(range[0]);\n  const b = Number(range[1]);\n  if (!Number.isFinite(a) || !Number.isFinite(b)) return fallback;\n  return lerp(a, b, t);\n};\n\nconst readNumber = (value, fallback) => {\n  const n = Number(value);\n  return Number.isFinite(n) ? n : fallback;\n};\n\nexport const getMeteorBreakEffectConfig = ({ size, surfaceType }) => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n\n  const defaults = cfg.defaults || {};\n  const sizeScale = cfg.sizeScale || {};\n  const minSize = readNumber(sizeScale.min, 4);\n  const maxSize = readNumber(sizeScale.max, 12);\n  const denom = Math.max(1, maxSize - minSize);\n  const t = clamp01((readNumber(size, minSize) - minSize) / denom);\n\n  let count = scaleFromRange(sizeScale.count, defaults.count, t);\n  let speed = scaleFromRange(sizeScale.speed, defaults.speed, t);\n  let lifeMs = scaleFromRange(sizeScale.lifeMs, defaults.lifeMs, t);\n  let particleSize = scaleFromRange(sizeScale.size, defaults.size, t);\n  let gravity = readNumber(defaults.gravity, 0.02);\n  let shape = defaults.shape || 'square';\n  let angleRange = Array.isArray(defaults.angleRange) ? defaults.angleRange : null;\n\n  const surfaces = cfg.surfaces || {};\n  const surface = surfaceType && surfaces[surfaceType] ? surfaces[surfaceType] : surfaces.ground;\n  if (surface) {\n    count = readNumber(surface.count, count);\n    speed = readNumber(surface.speed, speed);\n    lifeMs = readNumber(surface.lifeMs, lifeMs);\n    particleSize = readNumber(surface.size, particleSize);\n    gravity = readNumber(surface.gravity, gravity);\n    shape = surface.shape || shape;\n    angleRange = Array.isArray(surface.angleRange) ? surface.angleRange : angleRange;\n  }\n\n  const colorsRaw = (surface && Array.isArray(surface.colors)) ? surface.colors : defaults.colors;\n  const colors = Array.isArray(colorsRaw) && colorsRaw.length ? colorsRaw.map(normalizeColor) : [0xffffff];\n\n  return {\n    count: readNumber(count, 12),\n    speed: readNumber(speed, 2.4),\n    lifeMs: readNumber(lifeMs, 700),\n    size: readNumber(particleSize, 3),\n    colors,\n    gravity,\n    shape,\n    angleRange\n  };\n};\n\nexport default {\n  getMeteorBreakEffectConfig\n};\n","import biologicalBreakEffectsConfig from '../../assets/json/system/biological_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!biologicalBreakEffectsConfig || biologicalBreakEffectsConfig.enabled === false) return null;\n  return biologicalBreakEffectsConfig;\n};\n\nexport const getBiologicalBreakEffectConfig = () => {\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const base = cfg.default || {};\n  const chunks = cfg.chunks && typeof cfg.chunks === 'object' ? cfg.chunks : null;\n  const colors = Array.isArray(base.colors) && base.colors.length ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 18,\n    speed: Number(base.speed) || 2.4,\n    lifeMs: Number(base.lifeMs) || 700,\n    size: Number(base.size) || 2,\n    gravity: Number.isFinite(Number(base.gravity)) ? Number(base.gravity) : 0.02,\n    shape: base.shape || 'circle',\n    angleRange: Array.isArray(base.angleRange) ? base.angleRange : null,\n    colors,\n    chunks: chunks || null\n  };\n};\n\nexport default {\n  getBiologicalBreakEffectConfig\n};\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef, isInsideRoom } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    \n    let vol = Math.max(0, Math.min(1, volume ?? 1));\n    let muffled = !!isInsideRoom;\n\n    if (muffled) {\n        vol *= 0.5; // Reduce volume if inside\n    }\n\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        \n        // If we wanted a filter for SFX, we'd need to set up Web Audio context for each sound,\n        // which might be heavy for many sounds. Let's stick to volume reduction for simplicity \n        // unless Web Audio context is already available and passed in.\n\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return audio;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol, muffled);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol, muffled = false) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    \n    // Lowpass filter if muffled\n    let lastNode = osc;\n    if (muffled) {\n        const filter = audioCtx.createBiquadFilter();\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(600, now);\n        osc.connect(filter);\n        lastNode = filter;\n    }\n\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(muffled ? 260 : 520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    \n    lastNode.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  friction = 0.8,\n  acceleration = 0.2,\n  deltaMs = 16.67\n}) {\n  let { x, vx, width, direction, y, height } = state;\n  \n  const timeScale = deltaMs / 16.67;\n  const targetVx = keys?.a ? -MOVE_SPEED : (keys?.d ? MOVE_SPEED : 0);\n  \n  if (targetVx !== 0) {\n    // Accelerate\n    vx += targetVx * acceleration * timeScale;\n    if (Math.abs(vx) > MOVE_SPEED) vx = Math.sign(vx) * MOVE_SPEED;\n    direction = Math.sign(targetVx);\n  } else {\n    // Apply friction (time-scaled)\n    const effectiveFriction = Math.pow(friction, timeScale);\n    vx *= effectiveFriction;\n    if (Math.abs(vx) < 0.1) vx = 0;\n  }\n\n  const proposedX = x + vx * timeScale;\n  const py = y ?? 0;\n  if (checkCollision(proposedX, py, mapWidth, mapHeight, width, height)) {\n    // Precza apstans pie ra\n    const step = 0.05;\n    const sign = Math.sign(vx);\n    let safeX = x;\n    const moveDist = Math.abs(vx * timeScale);\n    \n    for (let d = step; d <= moveDist; d += step) {\n      const nextX = x + d * sign;\n      if (!checkCollision(nextX, py, mapWidth, mapHeight, width, height)) {\n        safeX = nextX;\n      } else {\n        break;\n      }\n    }\n    x = safeX;\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  // Sanitize coordinates to avoid sub-pixel noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  x = Math.round(x * 1000) / 1000;\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isLiquidAt(wx, wy): optional helper to detect liquid type at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isLiquidAt,\n  prevInWater,\n  deltaMs = 16.67\n}) {\n  const timeScale = deltaMs / 16.67;\n  \n  // Liquid defaults\n  let liqBuoyancy = 0.5; // reduces effective gravity by 50%\n  let liqDragY = 0.88;  // vertical damping per frame when in liquid\n  let liqTerminal = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n  let swimImpulseMult = 0.55;\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  let activeLiquidType = null;\n\n  if (typeof isLiquidAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    \n    const feetLiq = isLiquidAt(cx, feetY);\n    const chestLiq = isLiquidAt(cx, chestY);\n    const headLiq = isLiquidAt(cx, headY);\n    \n    activeLiquidType = feetLiq || chestLiq;\n    inWater = !!activeLiquidType;\n    headUnderWater = !!headLiq;\n    atSurface = inWater && !headUnderWater;\n\n    // Apply per-liquid physics overrides\n    if (activeLiquidType === 'quicksand') {\n      liqBuoyancy = -0.15; // Negative buoyancy makes player sink!\n      liqDragY = 0.85;     // Higher drag\n      liqTerminal = 1.2;   // Very slow terminal velocity for sinking\n      swimImpulseMult = 0.35; // Harder to jump/swim\n    } else if (activeLiquidType === 'lava') {\n      liqBuoyancy = 0.3;\n      liqDragY = 0.82;\n    } else if (activeLiquidType === 'waterfall') {\n      liqBuoyancy = -0.5; // Acts like extra gravity\n      liqDragY = 0.95;     // Very low resistance\n      liqTerminal = TERMINAL_VELOCITY * 1.5; // Allow falling faster than usual terminal velocity\n    } else if (activeLiquidType === 'lava_waterfall') {\n      liqBuoyancy = -0.4; // Slightly more viscous than water\n      liqDragY = 0.92;\n      liqTerminal = TERMINAL_VELOCITY * 1.3;\n    } else if (activeLiquidType === 'radioactive_waterfall') {\n      liqBuoyancy = -0.2; // Slower fall than normal waterfall\n      liqDragY = 0.94;\n      liqTerminal = TERMINAL_VELOCITY * 0.7; // Slower speed\n    } else if (activeLiquidType === 'radioactive_water') {\n      liqBuoyancy = 0.45; // Slightly less buoyant than water\n      liqDragY = 0.86;\n    }\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * swimImpulseMult));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5 * timeScale; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - liqBuoyancy) * timeScale;\n    vy *= Math.pow(liqDragY, timeScale);\n    if (vy > liqTerminal) vy = liqTerminal;\n  } else {\n    vy += GRAVITY * timeScale;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  const proposedY = y + vy * timeScale;\n  if (checkCollision(x, proposedY, mapWidth, mapHeight, width, height)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      // Snapping to the pixel above the tile - use a small offset consistent with collision inset\n      y = Math.floor((proposedY + height - 0.1) / TILE_SIZE) * TILE_SIZE - height;\n      \n      if (Math.abs(vx || 0) > 0.1) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((proposedY + 0.1) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y = proposedY;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  // Sanitize coordinates to prevent floating point noise jitter\n  // We use 3 decimal places for physics calculations to keep it smooth and stable\n  y = Math.round(y * 1000) / 1000;\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Collision helpers (migrated from GameEngine/collision.js)\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile or an object)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve definitions\n// - secretData: secret layer array (ids)\n// - objectData: object layer array (ids)\n// - objectMetadata: metadata for objects (e.g. health)\n// - entities: array of active entities (optional)\n// - ignoreEntityId: ID of the entity to ignore in check (optional)\n// - maps: all project maps (optional, for room overlays)\n// - activeRoomIds: IDs of currently active/open rooms (optional)\n// - isRoom: boolean, whether we are checking collision for a room sub-map\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds, isRoom = false) {\n  try {\n    const gx = Math.floor(wx / TILE_SIZE);\n    const gy = Math.floor(wy / TILE_SIZE);\n\n    // Boundary check\n    if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n        // Rooms have strict boundaries. Main map allows falling off the bottom.\n        // checkCollision handles top/left/right boundaries for main map.\n        return isRoom; \n    }\n\n    // Allow movement above the map (already handled by gx,gy check usually, but just in case)\n    if (wy < 0) return false;\n\n    // 0. Check for active rooms (sub-maps) - Priority check\n    if (!isRoom && maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n      let insideAnyRoom = false;\n      \n      for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n        const idx = parseInt(idxStr);\n        if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n          const roomMap = maps[meta.linkedMapId];\n          if (!roomMap) continue;\n\n          const rx = (idx % mapWidthTiles) * TILE_SIZE;\n          const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n          const rw = (meta.width || 1) * TILE_SIZE;\n          const rh = (meta.height || 1) * TILE_SIZE;\n\n          // Boundary check with pixel precision\n          // Pievienojam nelielu pielaidi (0.2px) apak, lai snapping loika vertical.js \n          // (kas izmanto y + height - 0.1) nepalaistu garm istabas grdu.\n          if (wx >= rx && wx < rx + rw && wy >= ry && wy < ry + rh + 0.2) {\n            insideAnyRoom = true;\n            \n            const localWx = wx - rx;\n            const localWy = wy - ry;\n            \n            const roomTileW = roomMap.mapWidth || roomMap.width;\n            const roomTileH = roomMap.mapHeight || roomMap.height;\n            \n            const roomTiles = roomMap.tileMapData || roomMap.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data;\n            const roomObjects = roomMap.objectMapData || roomMap.layers?.find(l => l.name === 'entities' || l.type === 'object')?.data;\n            const roomSecrets = roomMap.secretMapData || roomMap.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data;\n\n            const solidInRoom = isSolidAtPixel(\n              localWx, localWy, \n              roomTileW, roomTileH, TILE_SIZE, \n              roomTiles, \n              registryItems, \n              roomSecrets, \n              roomObjects, \n              roomMap.objectMetadata, \n              null, \n              ignoreEntityId,\n              null,\n              null,\n              true // WE ARE IN A ROOM\n            );\n\n            if (solidInRoom) return true;\n            \n            // If the room map has NO content at this spot, it's a window/open area.\n            // The recursive call with isRoom=true already blocked the boundaries of the room map.\n            return false;\n          }\n        }\n      }\n      \n      if (!insideAnyRoom) {\n        // Izmums: aujam atrasties uz durvm, kas ir atvrtas, pat ja ts ir rpus room_area.\n        // Tas ir nepiecieams, lai spltjs neiestrgtu teleportcijas brd, izejot no istabas.\n        const index = gy * mapWidthTiles + gx;\n        const objId = objectData && objectData[index];\n        if (objId) {\n        const objDef = getDefById(registryItems, objId);\n          if (objDef && objDef.subtype === 'door') {\n            const meta = (objectMetadata && objectMetadata[index]) || {};\n            let frame = meta.currentFrame;\n            if (frame === undefined) frame = 0;\n            \n            const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n            if (frame !== closedFrame) {\n              return false; // Durvis ir atvrtas, aujam te atrasties\n            }\n          }\n        }\n        return true; \n      }\n    }\n\n    const index = gy * mapWidthTiles + gx;\n    \n    // 0. Check entities first (dynamic obstacles)\n    if (entities) {\n      for (const ent of entities) {\n        if (ent.id === ignoreEntityId) continue;\n        if (ent.health <= 0 || ent.isExploding) continue;\n        // Platforms are stand-on-able but not usually \"solid\" for other entities' horizontal physics\n        if (ent.subtype === 'platform') continue;\n        // Fish should not block movement (player or other entities)\n        if (ent.subtype === 'fish' || ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish) continue;\n\n        if (wx >= ent.x && wx < ent.x + ent.width && wy >= ent.y && wy < ent.y + ent.height) {\n          return true;\n        }\n      }\n    }\n\n    // Check if this tile has a secret - secrets make tiles passable\n    if (secretData && secretData[index]) {\n      return false;\n    }\n\n    // 1. Check objects layer first (like the wooden box)\n    if (objectData && objectData[index]) {\n      const objId = objectData[index];\n      const objDef = getDefById(registryItems, objId);\n      \n      const isEntity = objDef && (\n        objDef.type === 'entity' || \n        objDef.subtype === 'tank' || \n        objDef.subtype === 'platform' ||\n        objDef.subtype === 'pushable' ||\n        objDef.isPushable ||\n        (objDef.name && objDef.name.toLowerCase().includes('entities.'))\n      );\n\n      if (objDef && objDef.collision && !isEntity) {\n        // Durvju specil loika: atvrtas/lietotas durvis nav cietas\n        if (objDef.subtype === 'door') {\n          const meta = (objectMetadata && objectMetadata[index]) || {};\n          let frame = meta.currentFrame;\n          \n          if (frame === undefined) {\n              // Default frame for rooms is 'inside' (open)\n              if (isRoom) {\n                  frame = objDef.interaction?.frames?.inside ?? 0;\n              } else {\n                  frame = 0; // Default for main map is closed\n              }\n          }\n\n          const closedFrame = objDef.interaction?.frames?.closed ?? 0;\n          \n          // Ja durvis nav aizvrtas (ir atvrans fz vai atvrtas), ts nav cietas\n          if (frame !== closedFrame) {\n            return false;\n          }\n        }\n\n        // Special logic for destructible objects like the wooden box\n        if (objDef.isDestructible && objectMetadata && objectMetadata[index]) {\n          const health = objectMetadata[index].health !== undefined ? objectMetadata[index].health : objDef.maxHealth;\n          const threshold = objDef.passableHealthThreshold || 0;\n          if (health <= threshold) {\n            return false; // Box is broken, can pass through\n          }\n        }\n        return true;\n      }\n    }\n\n    // 2. Check tiles layer\n    const tileId = tileData[index];\n    if (!tileId) return false;\n    const tileDef = getDefById(registryItems, tileId);\n    if (!tileDef || !tileDef.collision) return false;\n    if (tileDef.collision === true) return true;\n    if (typeof tileDef.collision === 'object') {\n      return !!(\n        tileDef.collision.top ||\n        tileDef.collision.bottom ||\n        tileDef.collision.left ||\n        tileDef.collision.right\n      );\n    }\n    return false;\n  } catch (error) {\n    console.error('Error in isSolidAtPixel:', error);\n    return false;\n  }\n}\n\n// AABB collision check for player rectangle at (newX, newY)\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds) {\n  // Insets and epsilon values to prevent \"sticking\" and ensure stable grounding.\n  // inset: distance from corners for edge-mid points to avoid catching perpendicular walls.\n  // eps: small offset from the actual edge to ensure we stay within the intended tile/boundary.\n  const inset = 1.0; \n  const eps = 0.1;\n  \n  const points = [\n    // Vertical checks (Top/Bottom)\n    { x: newX + inset, y: newY + eps }, \n    { x: newX + width - inset, y: newY + eps },\n    { x: newX + width / 2, y: newY + eps },\n    \n    { x: newX + inset, y: newY + height - eps },\n    { x: newX + width - inset, y: newY + height - eps },\n    { x: newX + width / 2, y: newY + height - eps },\n\n    // Horizontal checks (Left/Right)\n    { x: newX + eps, y: newY + inset },\n    { x: newX + eps, y: newY + height - inset },\n    { x: newX + eps, y: newY + height / 2 },\n\n    { x: newX + width - eps, y: newY + inset },\n    { x: newX + width - eps, y: newY + height - inset },\n    { x: newX + width - eps, y: newY + height / 2 }\n  ];\n\n  for (let p of points) {\n    const gx = Math.floor(p.x / TILE_SIZE);\n    const gy = Math.floor(p.y / TILE_SIZE);\n    \n    // Boundary checks: block left, right, and top edges of the world.\n    // Allow falling off the bottom (gy >= mapHeightTiles).\n    if (gx < 0 || gx >= mapWidthTiles || gy < 0) return true;\n\n    if (isSolidAtPixel(p.x, p.y, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, entities, ignoreEntityId, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Gets physical properties of the surface below the player (friction, acceleration)\n */\nexport function getSurfaceProperties(x, y, width, height, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData, objectMetadata, maps, activeRoomIds) {\n  const cx = x + width / 2;\n  const feetY = y + height + 1; // 1 pixel below feet\n\n  // Check for active rooms (sub-maps) - Priority check\n  if (maps && activeRoomIds && activeRoomIds.length > 0 && objectMetadata && secretData) {\n    for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n      const idx = parseInt(idxStr);\n      if (secretData[idx] === 'room_area' && meta.linkedMapId && activeRoomIds.includes(meta.linkedMapId)) {\n        const roomMap = maps[meta.linkedMapId];\n        if (!roomMap) continue;\n\n        const rx = (idx % mapWidthTiles) * TILE_SIZE;\n        const ry = Math.floor(idx / mapWidthTiles) * TILE_SIZE;\n        const rw = (meta.width || 1) * TILE_SIZE;\n        const rh = (meta.height || 1) * TILE_SIZE;\n\n        if (cx >= rx && cx < rx + rw && feetY >= ry && feetY < ry + rh + 2) {\n          // Point is inside an active room!\n          const localCx = cx - rx;\n          const localFeetY = feetY - ry;\n          \n          const roomTileW = roomMap.mapWidth || roomMap.width;\n          const roomTileH = roomMap.mapHeight || roomMap.height;\n          \n          return getSurfaceProperties(\n            localCx - width/2, localFeetY - height - 1, width, height,\n            roomTileW, roomTileH, TILE_SIZE,\n            roomMap.tileMapData || (roomMap.layers?.find(l => l.name === 'background')?.data),\n            registryItems,\n            roomMap.secretMapData,\n            roomMap.objectMetadata,\n            null,\n            null\n          );\n        }\n      }\n    }\n  }\n\n  const gx = Math.floor(cx / TILE_SIZE);\n  const gy = Math.floor(feetY / TILE_SIZE);\n  \n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) {\n    return { friction: 0.8, acceleration: 0.2 };\n  }\n  \n  const index = gy * mapWidthTiles + gx;\n  const tileId = tileData ? tileData[index] : null;\n  if (!tileId) return { friction: 0.8, acceleration: 0.2 };\n  \n    const tileDef = getDefById(registryItems, tileId);\n  if (!tileDef) return { friction: 0.8, acceleration: 0.2 };\n  \n  // If block has slipperiness, use it. Default friction is 0.8.\n  const slipperiness = tileDef.slipperiness !== undefined ? tileDef.slipperiness : 0.8;\n  \n  return {\n    friction: slipperiness,\n    // When slippery, acceleration is lower (harder to start/change direction)\n    acceleration: tileDef.slipperiness !== undefined ? (1 - slipperiness) * 2 + 0.05 : 0.2\n  };\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n  getSurfaceProperties\n};\n","import weatherDamageConfig from '../../assets/json/system/weather_damage.json';\n\nconst clampIntensity = (v) => {\n  const n = Number(v) || 0;\n  return Math.max(0, Math.min(100, n));\n};\n\nconst getWeatherConfig = (type) => {\n  return weatherDamageConfig?.weather?.[type] || null;\n};\n\nexport const getMapWeather = (mapData) => {\n  if (!mapData) return {};\n  let base = {};\n  if (mapData.weather) base = mapData.weather;\n  else {\n    const metaWeather = mapData.meta?.weather;\n    if (metaWeather && Object.keys(metaWeather).length > 0) {\n      base = metaWeather;\n    } else {\n      const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap;\n      if (activeId && mapData.maps && mapData.maps[activeId] && mapData.maps[activeId].weather) {\n        base = mapData.maps[activeId].weather;\n      } else {\n        base = mapData.meta?.weather || {};\n      }\n    }\n  }\n  let runtime = {};\n  try {\n    const rt = window.__GAME_RUNTIME_SETTINGS__ || {};\n    runtime = {\n      rain: rt.weatherRain,\n      snow: rt.weatherSnow,\n      clouds: rt.weatherClouds,\n      fog: rt.weatherFog,\n      thunder: rt.weatherThunder,\n      lavaRain: rt.weatherLavaRain,\n      radioactiveFog: rt.weatherRadioactiveFog,\n      meteorRain: rt.weatherMeteorRain\n    };\n  } catch {}\n  const merged = { ...base };\n  Object.keys(runtime).forEach(key => {\n    if (runtime[key] !== undefined && runtime[key] !== null) {\n      merged[key] = runtime[key];\n    }\n  });\n  return merged;\n};\n\nexport const getWeatherDps = (type, intensity) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return 0;\n  const pct = clampIntensity(intensity);\n  if (pct <= 0) return 0;\n  const maxDps = Number(cfg.maxDps) || 0;\n  const minDps = Number(cfg.minDps) || 0;\n  const dps = (pct / 100) * maxDps;\n  return Math.max(minDps, dps);\n};\n\nexport const getRadioactivityRates = () => {\n  const cfg = getWeatherConfig('radioactiveFog') || {};\n  const inc = Number(cfg.radioactivityPerSecond);\n  const dec = Number(cfg.radioactivityRegenPerSecond);\n  return {\n    increase: Number.isFinite(inc) ? inc : 0,\n    decay: Number.isFinite(dec) ? dec : 0\n  };\n};\n\nexport const weatherAffectsPlayer = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  return !!cfg.affects?.player;\n};\n\nexport const weatherAffectsEnemy = (type, enemyId, enemyName) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg || cfg.enabled === false) return false;\n  const enemies = cfg.affects?.enemies;\n  if (enemies === 'true') return true;\n  if (enemies === true || enemies === 'all') return true;\n  if (enemies && typeof enemies === 'object' && enemies.mode === 'all') {\n    const excluded = Array.isArray(enemies.exclude) ? enemies.exclude : [];\n    const isExcluded = (value) => value && excluded.some(ex => value === ex || value.includes(ex));\n    if (isExcluded(enemyId)) return false;\n    if (isExcluded(enemyName)) return false;\n    return true;\n  }\n  if (Array.isArray(enemies)) {\n    if (enemyId && enemies.some(ex => enemyId === ex || enemyId.includes(ex))) return true;\n    if (enemyName && enemies.some(ex => enemyName === ex || enemyName.includes(ex))) return true;\n    return false;\n  }\n  return false;\n};\n\nexport const weatherBlockedByCover = (type) => {\n  const cfg = getWeatherConfig(type);\n  if (!cfg) return false;\n  return !!cfg.blockedByCover;\n};\n","import { isSolidAtPixel } from '../physics/collision';\n\nconst isInsideActiveRoom = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  secretData,\n  objectMetadata,\n  activeRoomIds\n}) => {\n  if (!activeRoomIds || !activeRoomIds.length) return false;\n  if (!secretData || !objectMetadata) return false;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false;\n  for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n    const idx = parseInt(idxStr, 10);\n    if (secretData[idx] !== 'room_area') continue;\n    if (!meta?.linkedMapId || !activeRoomIds.includes(meta.linkedMapId)) continue;\n    const rx = idx % mapWidth;\n    const ry = Math.floor(idx / mapWidth);\n    const rw = meta.width || 1;\n    const rh = meta.height || 1;\n    if (gx >= rx && gx < rx + rw && gy >= ry && gy < ry + rh) return true;\n  }\n  return false;\n};\n\nexport const isCoveredFromAbove = ({\n  x,\n  y,\n  mapWidth,\n  mapHeight,\n  TILE_SIZE,\n  tileData,\n  registryItems,\n  secretData,\n  objectData,\n  objectMetadata,\n  maps,\n  activeRoomIds\n}) => {\n  if (!Number.isFinite(x) || !Number.isFinite(y)) return false;\n  if (isInsideActiveRoom({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectMetadata, activeRoomIds })) {\n    return true;\n  }\n  const gridX = Math.floor(x / TILE_SIZE);\n  if (gridX < 0 || gridX >= mapWidth) return false;\n  let gridY = Math.floor(y / TILE_SIZE) - 1;\n  for (; gridY >= 0; gridY--) {\n    const wx = gridX * TILE_SIZE + TILE_SIZE / 2;\n    const wy = gridY * TILE_SIZE + TILE_SIZE / 2;\n    if (isSolidAtPixel(wx, wy, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, null, maps, activeRoomIds)) {\n      return true;\n    }\n  }\n  return false;\n};\n","import { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { isSolidAtPixel } from '../physics';\nimport { getWeatherDps, getMapWeather, weatherAffectsEnemy, weatherBlockedByCover } from './weatherDamage';\nimport { isCoveredFromAbove } from './weatherCover';\n\nconst getDefById = (registryItems, id) => {\n  if (!id) return null;\n  const map = registryItems && registryItems.__byId;\n  if (map && typeof map.get === 'function') return map.get(id) || null;\n  return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n};\n\nconst getTileLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.tileMapData)) return mapData.tileMapData;\n  const layer = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile');\n  return layer?.data || [];\n};\n\nconst getSecretLayerData = (mapData) => {\n  if (!mapData) return [];\n  if (Array.isArray(mapData.secretMapData)) return mapData.secretMapData;\n  const layer = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret');\n  return layer?.data || [];\n};\n\nconst liquidTypeToHabitat = (liquidType) => {\n  if (!liquidType) return 'none';\n  if (liquidType.includes('radioactive')) return 'radioactive';\n  if (liquidType.includes('lava')) return 'lava';\n  if (liquidType.includes('quicksand')) return 'quicksand';\n  if (liquidType.includes('water')) return 'water';\n  return 'none';\n};\n\nconst isFishEntity = (ent) => {\n  if (!ent) return false;\n  const def = ent.def || {};\n  return ent.subtype === 'fish' || def.subtype === 'fish' || def.ai?.type === 'fish' || !!def.fish;\n};\n\nconst getFishTriggerAt = ({ x, y, mapWidth, mapHeight, TILE_SIZE, secretData, objectData, registryItems }) => {\n  if (!registryItems) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  const gy = Math.floor(y / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return null;\n  const idx = gy * mapWidth + gx;\n  const secretId = secretData ? secretData[idx] : null;\n  const objectId = objectData ? objectData[idx] : null;\n  const def = getDefById(registryItems, secretId) || getDefById(registryItems, objectId);\n  if (!def) return null;\n  if (def.type === 'secret' && def.subtype === 'animal_trigger' && def.triggerType === 'fish') return def;\n  return null;\n};\n\nconst getWaterSurfaceY = ({ x, mapWidth, mapHeight, tileData, registryItems, TILE_SIZE }) => {\n  if (!tileData || mapWidth <= 0 || mapHeight <= 0) return null;\n  const gx = Math.floor(x / TILE_SIZE);\n  if (gx < 0 || gx >= mapWidth) return null;\n  for (let gy = 0; gy < mapHeight; gy++) {\n    const idx = gy * mapWidth + gx;\n    const id = tileData[idx];\n    if (!id) continue;\n    const def = getDefById(registryItems, id);\n    if (!def || !def.flags || !def.flags.liquid) continue;\n    if (def.flags.water || def.flags.waterfall) {\n      return gy * TILE_SIZE;\n    }\n  }\n  return null;\n};\n\n/**\n * Atjaunina visas aktvs enttijas (piemram, tankus).\n * @param {Object} ctx Konteksts ar nepiecieamajiem datiem un funkcijm\n * @param {number} deltaMs Laiks kop pdj kadra\n */\nexport function updateEntities(ctx, deltaMs) {\n  const {\n    entitiesRef,\n    gameState,\n    mapWidth,\n    mapHeight,\n    TILE_SIZE,\n    checkCollision,\n    isLiquidAt,\n    getLiquidSample,\n    spawnProjectile,\n    playSfx,\n    constants,\n    objectData,\n    mapData,\n    registryItems,\n    onStateUpdate,\n    activeRoomIds\n  } = ctx;\n\n  if (!entitiesRef.current || entitiesRef.current.length === 0) return;\n\n  const { GRAVITY, TERMINAL_VELOCITY } = constants;\n  const playerX = gameState.current.x;\n  const playerY = gameState.current.y;\n  const weatherNow = getMapWeather(mapData);\n  const lavaRainInt = Number(weatherNow.lavaRain || 0);\n  const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n\n  // Ms modificjam enttijas pa tieo ref\n  const entities = entitiesRef.current;\n  const activeMapId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n  const activeMap = mapData.maps ? mapData.maps[activeMapId] : mapData;\n  const isSeaRescue = activeMap?.type === 'sea_rescue';\n\n  for (let i = entities.length - 1; i >= 0; i--) {\n    const entity = entities[i];\n    const def = entity.def || {};\n    const isFish = def?.subtype === 'fish' || def?.ai?.type === 'fish' || !!def?.fish;\n    // 1. Ja enttija ir mirusi, apstrdjam sprdzienu vai noemanu\n    if (entity.health <= 0 && !isFish) {\n      if (!entity.isExploding) {\n        entity.isExploding = true;\n        entity.animation = 'explode';\n        entity.animFrame = 0;\n        entity.animTimer = 0;\n        entity.vx = 0; // Apstjamies sprdziena laik\n        entity.vy = 0;\n        entity.isGrounded = true; // Sprgst uz zemes\n      }\n      \n      const explodeAnim = def.spriteSheet?.animations?.explode || [];\n      const totalFrames = explodeAnim.length;\n      const frameDuration = 100; // ms uz kadru\n      \n      entity.animTimer += deltaMs;\n      if (entity.animTimer >= frameDuration) {\n        entity.animTimer = 0;\n        entity.animFrame++;\n        if (entity.animFrame >= totalFrames) {\n          entity.shouldRemove = true;\n        }\n      }\n      if (entity.shouldRemove) {\n        entities.splice(i, 1);\n      }\n      continue;\n    }\n\n    // 1.2. Liquid damage (e.g. lava, radioactive water)\n    const liquidSample = getLiquidSample ? getLiquidSample({\n      x: entity.x,\n      y: entity.y,\n      width: entity.width,\n      height: entity.height,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight\n    }) : { inLiquid: false };\n\n    if (isFish) {\n      const { projectilesRef } = ctx;\n      const cfg = def.fish || {};\n      const activeRadiusPx = (Number(cfg.activeRadius) || 18) * TILE_SIZE;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      \n      // 0. Attached to projectile logic (Sea Rescue)\n      if (entity.attachedToProjectileId) {\n          const projectiles = projectilesRef?.current || [];\n          const target = projectiles.find(p => p.id === entity.attachedToProjectileId);\n          if (target && !target.floating) {\n              entity.x = target.x - entity.width / 2;\n              entity.y = target.y - entity.height / 2;\n              entity.vx = target.vx;\n              entity.vy = target.vy;\n              entity.animation = 'panic';\n              entity.fishState = entity.fishState || {};\n              entity.fishState.isAttached = true;\n              \n              const anims = def.spriteSheet?.animations || {};\n              const currentAnim = anims['panic'] || anims['swim'] || [0];\n              entity.currentSpriteIndex = currentAnim[Math.floor(Date.now() / 100) % currentAnim.length];\n              continue;\n          } else {\n              if (target) {\n                  entity.fishState = entity.fishState || {};\n                  entity.fishState.isJumping = true;\n                  entity.fishState.jumpVx = -target.vx * 0.5;\n                  entity.fishState.jumpVy = -500;\n                  entity.fishState.jumpGravity = 800;\n              }\n              entity.attachedToProjectileId = null;\n              if (entity.fishState) entity.fishState.isAttached = false;\n          }\n      }\n\n      const dxView = (playerX + gameState.current.width / 2) - ex;\n      const dyView = (playerY + gameState.current.height / 2) - ey;\n      const distView = Math.sqrt(dxView * dxView + dyView * dyView);\n      const isActive = distView <= activeRadiusPx || isSeaRescue;\n\n      if (!isActive && entity.health > 0) {\n        entity.isDormant = true;\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.animation = 'idle';\n        const idleAnim = def.spriteSheet?.animations?.idle || [0];\n        entity.currentSpriteIndex = idleAnim[0] || 0;\n        continue;\n      }\n      entity.isDormant = false;\n    }\n\n    if (liquidSample.inLiquid && liquidSample.params && liquidSample.params.dps > 0) {\n      entity.liquidDamageAcc = (entity.liquidDamageAcc || 0) + deltaMs;\n      while (entity.liquidDamageAcc >= 1000) {\n        entity.liquidDamageAcc -= 1000;\n        const dmg = liquidSample.params.dps;\n        entity.health = Math.max(0, entity.health - dmg);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: dmg\n          });\n        }\n      }\n    } else {\n      entity.liquidDamageAcc = 0;\n    }\n\n    // 1.3. Weather damage (Lava Rain, Radioactive Fog)\n    const enemyId = entity.defId || def?.id;\n    const enemyName = def?.name;\n    let lavaDps = weatherAffectsEnemy('lavaRain', enemyId, enemyName) ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    if (lavaDps > 0 && liquidSample.inLiquid && liquidSample.type && liquidSample.type.includes('water')) {\n      lavaDps = 0;\n    }\n    const radioDps = weatherAffectsEnemy('radioactiveFog', enemyId, enemyName) ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = mapData.layers?.find(l => l.name === 'background' || l.type === 'tile')?.data || [];\n        const secretData = mapData.layers?.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n        const objectMetadata = mapData.meta?.objectMetadata || {};\n        const covered = isCoveredFromAbove({\n          x: entity.x + entity.width / 2,\n          y: entity.y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIds || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const totalWeatherDps = lavaDps + radioDps;\n\n    if (totalWeatherDps > 0) {\n      entity.weatherDamageAcc = (entity.weatherDamageAcc || 0) + deltaMs;\n      if (entity.weatherDamageAcc >= 1000) {\n        entity.weatherDamageAcc -= 1000;\n        entity.health = Math.max(0, entity.health - totalWeatherDps);\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: entity.x + entity.width / 2,\n            y: entity.y,\n            amount: totalWeatherDps\n          });\n        }\n      }\n    } else {\n      entity.weatherDamageAcc = 0;\n    }\n\n    if (isFish) {\n      const cfg = def.fish || {};\n      const habitat = cfg.habitat || {};\n      const now = Number(gameState.current.timeMs) || 0;\n      const dt = Math.max(0, Number(deltaMs) || 0) / 1000;\n      const liquidType = liquidSample?.type || null;\n      const habitatKey = liquidTypeToHabitat(liquidType);\n      const isAllowed = !!(liquidSample?.inLiquid && habitatKey && habitat[habitatKey] !== false);\n      const requireLiquid = cfg.requireLiquid !== false;\n      const inWaterNow = !!(liquidSample?.inLiquid && habitatKey === 'water');\n\n      entity.fishState = entity.fishState || {};\n      const fs = entity.fishState;\n\n      if (!fs.initialized) {\n        fs.initialized = true;\n        entity.direction = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.animFrame = 0;\n        fs.animTimer = 0;\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health > 0) {\n        const prevInWater = !!fs.prevInWater;\n        if (prevInWater && !inWaterNow && def.sounds?.water_out) {\n          playSfx(def.sounds.water_out, 0.35);\n        } else if (!prevInWater && inWaterNow && def.sounds?.water_in) {\n          playSfx(def.sounds.water_in, 0.35);\n        }\n        fs.prevInWater = inWaterNow;\n      }\n\n      if (entity.health <= 0) {\n        const player = gameState.current;\n        const hit = (\n          player.x < entity.x + entity.width &&\n          player.x + player.width > entity.x &&\n          player.y < entity.y + entity.height &&\n          player.y + player.height > entity.y\n        );\n        if (hit) {\n          gameState.current.fishCount = Math.max(0, (Number(gameState.current.fishCount) || 0) + 1);\n          entities.splice(i, 1);\n          continue;\n        }\n        if (entity.fishState?.removeOnNext) {\n          entities.splice(i, 1);\n          continue;\n        }\n        const tileData = getTileLayerData(mapData);\n        const secretData = getSecretLayerData(mapData);\n        const objectMetadata = mapData?.meta?.objectMetadata;\n        const cx = entity.x + entity.width / 2;\n        const headY = entity.y + Math.min(4, entity.height * 0.125);\n        const chestY = entity.y + entity.height * 0.45;\n        const feetY = entity.y + entity.height - 2;\n        const solidAtSample = isSolidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds) ||\n          isSolidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata, null, entity.id, mapData?.maps, activeRoomIds);\n        const canFloat = !!(liquidSample?.inLiquid && liquidSample?.type && liquidSample.type.includes('water') && !solidAtSample);\n        if (canFloat) {\n          const surfaceY = getWaterSurfaceY({\n            x: entity.x + entity.width / 2,\n            mapWidth,\n            mapHeight,\n            tileData,\n            registryItems,\n            TILE_SIZE\n          });\n          const surfaceOffset = Number.isFinite(cfg.deathSurfaceOffset) ? cfg.deathSurfaceOffset : 0.5;\n          if (Number.isFinite(surfaceY)) {\n            const targetY = surfaceY - entity.height * surfaceOffset;\n            const floatSpeed = (Number(cfg.deathFloatSpeed) || 0.25) * TILE_SIZE;\n            if (entity.y > targetY) {\n              entity.y = Math.max(targetY, entity.y - floatSpeed * dt);\n            } else {\n              entity.y = targetY;\n            }\n          }\n        }\n        entity.vx = 0;\n        entity.vy = 0;\n        entity.isGrounded = canFloat ? false : checkCollision(entity.x, entity.y + 1, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n        entity.flipY = true;\n        entity.animation = 'dead';\n        const deadAnim = def.spriteSheet?.animations?.dead || [];\n        entity.currentSpriteIndex = deadAnim.length ? deadAnim[0] : (cfg.meteorShockFrame || 2);\n        continue;\n      }\n\n      entity.flipY = false;\n      entity.alpha = 1;\n\n      if (requireLiquid && !isAllowed && !fs.isJumping) {\n        entities.splice(i, 1);\n        continue;\n      }\n\n      const panicRadiusPx = (Number(cfg.panicRadius) || 6) * TILE_SIZE;\n      const panicSpeed = (Number(cfg.panicSpeed) || 2.2) * TILE_SIZE;\n      const baseSpeed = (Number(cfg.swimSpeed) || 0.6) * TILE_SIZE;\n      const verticalDrift = (Number(cfg.verticalDrift) || 0.25) * TILE_SIZE;\n      const isWaterfall = !!(liquidType && liquidType.includes('waterfall'));\n      const waterfallDriftMultiplier = Number.isFinite(cfg.waterfallDriftMultiplier) ? cfg.waterfallDriftMultiplier : 0.4;\n      const waterfallSpeedMultiplier = Number.isFinite(cfg.waterfallSpeedMultiplier) ? cfg.waterfallSpeedMultiplier : 0.7;\n\n      const triggerDef = getFishTriggerAt({\n        x: entity.x + entity.width / 2,\n        y: entity.y + entity.height / 2,\n        mapWidth,\n        mapHeight,\n        TILE_SIZE,\n        secretData: getSecretLayerData(mapData),\n        objectData,\n        registryItems\n      });\n      const triggerCfg = triggerDef?.fishTrigger || {};\n      const fishJumpCfg = cfg.jump || {};\n      const mergedJumpCfg = { ...triggerCfg, ...fishJumpCfg };\n      const nowMs = Number(gameState.current.timeMs) || 0;\n      const nextJumpAt = Number(fs.nextJumpAt) || 0;\n      const canJump = !fs.isJumping && nowMs >= nextJumpAt && triggerDef && liquidSample?.inLiquid && liquidTypeToHabitat(liquidType) === 'water';\n\n      if (canJump) {\n        const chance = Math.max(0, Math.min(1, Number(mergedJumpCfg.chance ?? 1)));\n        if (Math.random() <= chance) {\n          const jumpDir = Math.random() < 0.5 ? -1 : 1;\n          entity.direction = jumpDir;\n          fs.isJumping = true;\n          fs.jumpVx = (Number(mergedJumpCfg.speedX) || 3.5) * TILE_SIZE * jumpDir;\n          fs.jumpVy = -(Number(mergedJumpCfg.speedY) || 6) * TILE_SIZE;\n          fs.jumpGravity = (Number(mergedJumpCfg.gravity) || 18) * TILE_SIZE;\n          fs.jumpBounce = Number.isFinite(mergedJumpCfg.bounce) ? Number(mergedJumpCfg.bounce) : 0.35;\n          fs.nextJumpAt = nowMs + (Number(mergedJumpCfg.cooldownMs) || 1400);\n        }\n      }\n\n      if (fs.isJumping) {\n        const dtSec = Math.max(0, Number(deltaMs) || 0) / 1000;\n        fs.jumpVy = (Number(fs.jumpVy) || 0) + (Number(fs.jumpGravity) || (GRAVITY * 60)) * dtSec;\n        let nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        let nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n\n        if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          fs.jumpVx = -(Number(fs.jumpVx) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextX = entity.x + (Number(fs.jumpVx) || 0) * dtSec;\n        }\n\n        if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n          if ((Number(fs.jumpVy) || 0) > 0) {\n            entity.health = 0;\n            fs.isJumping = false;\n            entity.vx = 0;\n            entity.vy = 0;\n            entity.isGrounded = true;\n            entity.x = nextX;\n            entity.y = Math.floor((nextY + entity.height - 0.1) / TILE_SIZE) * TILE_SIZE - entity.height;\n            continue;\n          }\n          fs.jumpVy = Math.abs(Number(fs.jumpVy) || 0) * (Number(fs.jumpBounce) || 0.35);\n          nextY = entity.y + (Number(fs.jumpVy) || 0) * dtSec;\n        }\n\n        const landingSample = getLiquidSample ? getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        }) : { inLiquid: false };\n\n        if (landingSample?.inLiquid && liquidTypeToHabitat(landingSample?.type) === 'water' && (Number(fs.jumpVy) || 0) > 0) {\n          fs.isJumping = false;\n          entity.vx = 0;\n          entity.vy = 0;\n        } else {\n          entity.vx = Number(fs.jumpVx) || 0;\n          entity.vy = Number(fs.jumpVy) || 0;\n        }\n\n        entity.x = nextX;\n        entity.y = nextY;\n        entity.isGrounded = false;\n        continue;\n      }\n\n      const px = playerX + gameState.current.width / 2;\n      const py = playerY + gameState.current.height / 2;\n      const ex = entity.x + entity.width / 2;\n      const ey = entity.y + entity.height / 2;\n      const dx = px - ex;\n      const dy = py - ey;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (fs.shockUntil && fs.shockUntil > now) {\n        const shockFrame = Number(cfg.meteorShockFrame) || 2;\n        entity.animation = 'shock';\n        entity.currentSpriteIndex = shockFrame;\n      }\n\n      const lastWaterEnter = gameState.current.lastWaterEnter;\n      if (lastWaterEnter && Number(lastWaterEnter.time) && now - Number(lastWaterEnter.time) < 1200) {\n        const waveRadiusPx = (Number(cfg.playerWaveRadius) || 10) * TILE_SIZE;\n        if (dist <= waveRadiusPx) {\n          fs.waveImpulse = Number(cfg.playerWaveImpulse) || 0.35;\n          fs.waveUntil = now + 400;\n        }\n        if (dist <= panicRadiusPx) {\n          fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n        }\n      }\n      if (gameState.current.inWater && dist <= panicRadiusPx) {\n        fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n      }\n\n      // Sea Rescue Ship reaction\n      if (isSeaRescue) {\n        const shipDef = getDefById(registryItems, 'minispill_sea_rescue_ship');\n        const shipReactionRadius = (shipDef?.fishReactionRadius || 15) * TILE_SIZE;\n        if (dist <= shipReactionRadius) {\n          fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n        }\n\n        // Engine panic logic (fishes under moving ship)\n        const isShipMoving = Math.abs(gameState.current.vx) > 5;\n        if (isShipMoving) {\n          const shipX = gameState.current.x;\n          const shipW = (shipDef?.width || 27) * TILE_SIZE;\n          const shipBottomY = gameState.current.y + (shipDef?.height || 7) * TILE_SIZE;\n          const enginePanicRadius = (shipDef?.enginePanicRadius || 10) * TILE_SIZE;\n\n          if (ex >= shipX && ex <= shipX + shipW && ey >= shipBottomY && ey <= shipBottomY + enginePanicRadius) {\n            fs.panicUntil = now + (Number(cfg.panicDurationMs) || 1200);\n          }\n        }\n      }\n\n      const isPanicking = fs.panicUntil && fs.panicUntil > now;\n      let dir = entity.direction || 1;\n      if (isPanicking) {\n        dir = dx >= 0 ? -1 : 1;\n      } else if (now >= (fs.nextTurnAt || 0)) {\n        dir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextTurnAt = now + (cfg.turnMinMs || 900) + Math.random() * ((cfg.turnMaxMs || 2600) - (cfg.turnMinMs || 900));\n      }\n      entity.direction = dir;\n\n      if (now >= (fs.nextVerticalAt || 0)) {\n        fs.verticalDir = Math.random() < 0.5 ? -1 : 1;\n        fs.nextVerticalAt = now + 500 + Math.random() * 1500;\n      }\n\n      let vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n      let vy = (fs.verticalDir || 1) * verticalDrift;\n      if (isWaterfall) {\n        vx *= waterfallSpeedMultiplier;\n        vy *= waterfallDriftMultiplier;\n        const downSpeed = (Number(cfg.waterfallDownSpeed) || 2.4) * TILE_SIZE;\n        vy = Math.max(Math.abs(vy), downSpeed);\n        entity.alpha = Number.isFinite(cfg.waterfallAlpha) ? cfg.waterfallAlpha : 1;\n      }\n\n      if (fs.waveUntil && fs.waveUntil > now) {\n        const impulse = Math.max(0, Number(fs.waveImpulse) || 0.35) * TILE_SIZE;\n        vx += (Math.random() - 0.5) * impulse;\n        vy += (Math.random() - 0.5) * impulse * 0.5;\n      }\n\n      let nextX = entity.x + vx * dt;\n      let nextY = entity.y + vy * dt;\n\n      if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        dir *= -1;\n        entity.direction = dir;\n        vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n        nextX = entity.x + vx * dt;\n      }\n\n      if (checkCollision(entity.x, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n        fs.verticalDir *= -1;\n        vy = fs.verticalDir * verticalDrift;\n        nextY = entity.y + vy * dt;\n      }\n\n      if (typeof getLiquidSample === 'function') {\n        const sampleNext = getLiquidSample({\n          x: nextX,\n          y: nextY,\n          width: entity.width,\n          height: entity.height,\n          TILE_SIZE,\n          mapWidth,\n          mapHeight\n        });\n        const nextType = liquidTypeToHabitat(sampleNext?.type);\n        const nextAllowed = !!(sampleNext?.inLiquid && nextType && habitat[nextType] !== false);\n        if (!nextAllowed) {\n          fs.verticalDir *= -1;\n          dir *= -1;\n          entity.direction = dir;\n          vx = dir * (isPanicking ? panicSpeed : baseSpeed);\n          vy = fs.verticalDir * verticalDrift;\n          nextX = entity.x + vx * dt;\n          nextY = entity.y + vy * dt;\n        }\n      }\n\n      if (entitiesRef?.current?.length) {\n        const cx = nextX + entity.width / 2;\n        const cy = nextY + entity.height / 2;\n        const gx = Math.floor(cx / TILE_SIZE);\n        const gy = Math.floor(cy / TILE_SIZE);\n        for (const other of entitiesRef.current) {\n          if (other.id === entity.id) continue;\n          if (!isFishEntity(other) || other.health <= 0) continue;\n          const ocx = other.x + other.width / 2;\n          const ocy = other.y + other.height / 2;\n          if (Math.floor(ocx / TILE_SIZE) !== gx || Math.floor(ocy / TILE_SIZE) !== gy) continue;\n          const dir = String(entity.id) < String(other.id) ? -1 : 1;\n          const nudge = dir * TILE_SIZE * 0.25;\n          const tryX = nextX + nudge;\n          if (!checkCollision(tryX, nextY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextX = tryX;\n            entity.direction = dir;\n            break;\n          }\n          const tryY = nextY + nudge;\n          if (!checkCollision(nextX, tryY, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n            nextY = tryY;\n            break;\n          }\n        }\n      }\n\n      entity.x = nextX;\n      entity.y = nextY;\n      entity.vx = vx;\n      entity.vy = vy;\n      entity.isGrounded = false;\n\n      const anims = def.spriteSheet?.animations || {};\n      let animKey = 'swim';\n      if (isPanicking && anims.panic) animKey = 'panic';\n      if (Math.abs(vx) < 0.02 && anims.idle) animKey = 'idle';\n\n      if (!(fs.shockUntil && fs.shockUntil > now)) {\n        const currentAnim = anims[animKey] || anims.swim || anims.idle || [0];\n        fs.animTimer = (fs.animTimer || 0) + deltaMs;\n        const frameDur = 180;\n        if (fs.animTimer >= frameDur) {\n          fs.animTimer = 0;\n          fs.animFrame = (fs.animFrame || 0) + 1;\n          if (fs.animFrame >= currentAnim.length) fs.animFrame = 0;\n        }\n        entity.currentSpriteIndex = currentAnim[fs.animFrame % currentAnim.length];\n      }\n\n      continue;\n    }\n\n    // 1.5. Pushable objektu (Akmeu) fizika\n    if (entity.subtype === 'pushable' || def?.isPushable) {\n      const inLiquid = liquidSample.inLiquid;\n      const liquidType = liquidSample.type;\n\n      // Skaas, ja iekrt idrum\n      if (inLiquid && !entity.prevInLiquid) {\n        if (liquidType === 'water' && def.sounds?.water_splash) {\n          playSfx(def.sounds.water_splash, 0.4);\n        } else if (liquidType === 'lava' && def.sounds?.lava_splash) {\n          playSfx(def.sounds.lava_splash, 0.4);\n        }\n      }\n      entity.prevInLiquid = inLiquid;\n\n        // Horizontl kustba ar berzi\n        const mh = moveHorizontal({\n          keys: {}, \n          state: { x: entity.x, y: entity.y, vx: entity.vx || 0, width: entity.width, height: entity.height, direction: entity.direction },\n          MOVE_SPEED: 6.0, // Palielints max trums akmeiem (Supaplex stil)\n          TILE_SIZE,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) return true;\n            \n            // Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            return (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n          },\n          friction: inLiquid ? 0.7 : 0.85,\n          acceleration: 0.2\n        });\n        entity.x = mh.x;\n        entity.vx = mh.vx;\n        entity.direction = mh.direction;\n\n      // Vertikl fizika\n      if (inLiquid && liquidType === 'lava') {\n        // Lna slkana lav\n        const sinkingSpeed = def.sinkingSpeed || 0.2;\n        entity.vy = sinkingSpeed;\n        entity.y += entity.vy;\n        entity.isGrounded = false;\n        \n        // Prbaudm vai neesam izgjui cauri zemei lav\n        if (checkCollision(entity.x, entity.y, mapWidth, mapHeight, entity.width, entity.height, entity.id)) {\n           // Atstumjam atpaka, ja atduras pret dibenu\n           entity.y -= entity.vy;\n           entity.vy = 0;\n           entity.isGrounded = true;\n        }\n      } else {\n        // Fall distance tracking: if falling, accumulate distance\n        if (entity.isGrounded) {\n          entity.fallDistance = 0;\n        } else if ((entity.vy || 0) > 0) {\n          entity.fallDistance = (entity.fallDistance || 0) + (entity.vy || 0);\n        }\n\n        // Standarta gravitcija (den lnka)\n        const vp = applyVerticalPhysics({\n          keys: {}, \n          x: entity.x,\n          y: entity.y,\n          vy: entity.vy || 0,\n          isGrounded: entity.isGrounded,\n          animation: 'idle',\n          GRAVITY: inLiquid ? GRAVITY * 0.3 : GRAVITY,\n          TERMINAL_VELOCITY,\n          JUMP_FORCE: 0,\n          TILE_SIZE,\n          width: entity.width,\n          height: entity.height,\n          mapWidth,\n          mapHeight,\n          checkCollision: (nx, ny, mw, mh, w, h) => {\n            // 1. Prbaudm statisko pasauli un citas enttijas\n            if (checkCollision(nx, ny, mw, mh, w, h, entity.id)) {\n              // Ja ms kaut kam uzkrtam un esam kritui pietiekami ilgi\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                // Atrodam kuru enttiju ms aizskrm (lai nogalintu ienaidniekus)\n                if (entitiesRef.current) {\n                  for (const other of entitiesRef.current) {\n                    if (other.id === entity.id || other.health <= 0 || other.subtype === 'platform' || other.subtype === 'pushable') continue;\n                    \n                    const hitOther = (\n                      nx < other.x + other.width &&\n                      nx + (w || entity.width) > other.x &&\n                      ny < other.y + other.height &&\n                      ny + (h || entity.height) > other.y\n                    );\n                    \n                    if (hitOther) {\n                      other.health = 0; // Nogalinm ienaidnieku\n                      // Vartu atskaot skau, ja tda definta\n                      if (def.sounds?.kill_enemy) {\n                        playSfx(def.sounds.kill_enemy, 0.5);\n                      }\n                    }\n                  }\n                }\n              }\n              return true;\n            }\n            \n            // 2. Prbaudm kolziju ar spltju\n            const p = gameState.current;\n            const ew = w || entity.width;\n            const eh = h || entity.height;\n            const hitPlayer = (nx < p.x + p.width && nx + ew > p.x && ny < p.y + p.height && ny + eh > p.y);\n            \n            if (hitPlayer) {\n              // Ja akmens uzkrt spltjam pc brva kritiena (vismaz 1 tuks bloks)\n              if ((entity.fallDistance || 0) >= TILE_SIZE * 0.8) {\n                gameState.current.health = 0; // Fatal impact\n              }\n              return true;\n            }\n            \n            return false;\n          },\n          isLiquidAt,\n          vx: entity.vx\n        });\n        entity.y = vp.y;\n        entity.vy = vp.vy;\n        entity.isGrounded = vp.isGrounded;\n\n        // --- ROLLING LOGIC (Supaplex style) ---\n        // Akmei ripo lej no citiem apaiem objektiem vai pakpieniem, ja ir brva vieta sn un pa diagonli\n        if (entity.isGrounded && Math.abs(entity.vx) < 0.1 && def.isRound) {\n          const checkEmpty = (tx, ty) => !checkCollision(tx, ty, mapWidth, mapHeight, entity.width, entity.height, entity.id);\n          \n          // Minm ripot pa KREISI\n          const leftX = entity.x - TILE_SIZE;\n          // canRollLeft: vai flze pa kreisi ir brva UN vai flze pa kreisi uz leju ir brva (tukums/pakpiens)\n          const canRollLeft = checkEmpty(leftX, entity.y) && checkEmpty(leftX, entity.y + TILE_SIZE);\n          \n          if (canRollLeft) {\n            // Ripojam pa kreisi. Palielints trums (6.0), lai \"veas\" trk\n            entity.vx = -6.0; \n          } else {\n            // Minm ripot pa LABI\n            const rightX = entity.x + TILE_SIZE;\n            const canRollRight = checkEmpty(rightX, entity.y) && checkEmpty(rightX, entity.y + TILE_SIZE);\n            if (canRollRight) {\n              entity.vx = 6.0;\n            }\n          }\n        }\n\n        // Atjaunojam rotciju, ja akmens veas (horizontal movement while grounded)\n      if (entity.isGrounded && Math.abs(entity.vx) > 0.1 && def.isRound) {\n        // Rotcija proporcionla trumam (0.07 rad/px * vx)\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.07);\n        if (def.sounds?.roll) {\n          const nowMs = Number(gameState.current.timeMs) || 0;\n          const lastAt = Number(entity.lastRollSfxAt) || 0;\n          if (!lastAt || nowMs - lastAt >= 450) {\n            playSfx(def.sounds.roll, 0.35);\n            entity.lastRollSfxAt = nowMs;\n          }\n        }\n      } else if (!entity.isGrounded && def.isRound) {\n        // Ar krtot var nedaudz rott, ja ir bijis horizontls trums\n        entity.rotation = (entity.rotation || 0) + (entity.vx * (deltaMs / 16.67) * 0.03);\n      }\n      }\n\n      // Animcija akmenim parasti ir statiska\n      entity.animation = 'idle';\n      entity.currentSpriteIndex = def.spriteSheet?.animations?.idle?.[0] || 0;\n\n      continue;\n    }\n\n    // Platformu loika\n    if (entity.subtype === 'platform') {\n      const speed = def.speed || 1.5;\n      const mapW = mapWidth;\n      const mapH = mapHeight;\n      \n      // Mekljam bultias vairkos punktos (centr un mals), lai nepalaistu garm\n      const points = [\n        { x: entity.x + entity.width / 2, y: entity.y + entity.height / 2 }, // Centrs\n        { x: entity.x + 5, y: entity.y + entity.height / 2 },                // Kreis mala\n        { x: entity.x + entity.width - 5, y: entity.y + entity.height / 2 }  // Lab mala\n      ];\n      \n      let arrowId = null;\n      let foundArrowDef = null;\n\n      for (const p of points) {\n        const tx = Math.floor(p.x / TILE_SIZE);\n        const ty = Math.floor(p.y / TILE_SIZE);\n        \n        if (tx < 0 || tx >= mapW || ty < 0 || ty >= mapH) continue;\n        const idx = ty * mapW + tx;\n\n        // 1. Specilais arrows slnis\n        const arrowsLayer = ctx.mapData?.layers?.find(l => l.name === 'arrows' || l.name === 'Arrows')?.data;\n        let id = arrowsLayer ? arrowsLayer[idx] : null;\n        \n        // 2. Objektu slnis\n        if (!id && ctx.objectData) {\n          id = ctx.objectData[idx];\n        }\n\n        if (id) {\n          const aDef = getDefById(ctx.registryItems, id);\n          if (aDef && aDef.subtype === 'arrow') {\n            arrowId = id;\n            foundArrowDef = aDef;\n            break; \n          }\n        }\n      }\n      \n      if (foundArrowDef) {\n        // Mainm kustbas virzienu atbilstoi bultiai\n        if (foundArrowDef.direction === 'up') { entity.vx = 0; entity.vy = -speed; }\n        else if (foundArrowDef.direction === 'down') { entity.vx = 0; entity.vy = speed; }\n        else if (foundArrowDef.direction === 'left') { entity.vx = -speed; entity.vy = 0; }\n        else if (foundArrowDef.direction === 'right') { entity.vx = speed; entity.vy = 0; }\n      }\n\n      // Ja platforma vl nekustas, iedodam tai skuma impulsu\n      if (entity.vx === 0 && entity.vy === 0) {\n        entity.vx = speed;\n      }\n\n      // Kustba\n      let nextX = entity.x + entity.vx * (deltaMs / 16.6);\n      let nextY = entity.y + entity.vy * (deltaMs / 16.6);\n      \n      // Robeu prbaude (neaujam aizbraukt aiz kartes)\n      const worldW = mapWidth * TILE_SIZE;\n      const worldH = mapHeight * TILE_SIZE;\n      \n      if (nextX < 0) { \n        nextX = 0; \n        entity.vx = Math.abs(entity.vx); // Move Right\n      } else if (nextX + entity.width > worldW) { \n        nextX = worldW - entity.width; \n        entity.vx = -Math.abs(entity.vx); // Move Left\n      }\n      \n      if (nextY < 0) { \n        nextY = 0; \n        entity.vy = Math.abs(entity.vy); // Move Down\n      } else if (nextY + entity.height > worldH) { \n        nextY = worldH - entity.height; \n        entity.vy = -Math.abs(entity.vy); // Move Up\n      }\n      \n      entity.x = nextX;\n      entity.y = nextY;\n\n      // Spltja \"prveana\"\n      const player = gameState.current;\n      const stepScale = deltaMs / 16.6;\n      const feetNow = player.y + player.height;\n      const feetPrev = feetNow - (Number(player.vy) || 0) * stepScale;\n      const overlapsX = player.x + player.width > entity.x && player.x < entity.x + entity.width;\n      const onTop = Math.abs(feetNow - entity.y) < 6;\n      const crossedTop = feetPrev <= entity.y + 2 && feetNow >= entity.y - 2;\n      const falling = (player.vy || 0) >= 0;\n\n      if (overlapsX && falling && (onTop || crossedTop)) {\n        player.x += entity.vx * stepScale;\n        player.y = entity.y - player.height;\n        player.vy = 0;\n        player.isGrounded = true;\n        \n        // Atjauninam animciju, lai nebtu \"fall\" uz platformas\n        if (Math.abs(player.vx) > 0.1) {\n          player.animation = 'run';\n        } else {\n          player.animation = 'idle';\n        }\n      }\n\n      continue;\n    }\n\n    const ai = def.ai || {};\n    const reactionDist = (ai.reactionDistance || 10) * TILE_SIZE;\n    const shootDist = (ai.shootDistance || 8) * TILE_SIZE;\n    const speed = def.speed || 1.2;\n\n    const dx = playerX - entity.x;\n    const dy = playerY - entity.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    let keys = { a: false, d: false, w: false };\n\n    // 2. AI Uzvedba\n    if (dist < reactionDist) {\n      // Sekojam spltjam\n      if (dx > TILE_SIZE * 0.5) {\n          keys.d = true;\n          entity.direction = 1;\n      } else if (dx < -TILE_SIZE * 0.5) {\n          keys.a = true;\n          entity.direction = -1;\n      }\n\n      // Lkana, ja AI to atbalsta un priek ir rslis\n      if (ai.canJump && entity.isGrounded) {\n          const nextX = entity.x + entity.direction * 10;\n          if (checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height)) {\n              keys.w = true;\n          }\n      }\n\n      // auana\n      if (dist < shootDist) {\n        if (entity.shootCooldown <= 0) {\n           const facingPlayer = (dx > 0 && entity.direction > 0) || (dx < 0 && entity.direction < 0);\n           // Tanks auj, ja skats uz spltju vai ja tas ir pietiekami tuvu\n           if (facingPlayer || dist < TILE_SIZE * 2) {\n             entity.isShooting = true;\n             entity.shootCooldown = ai.shootCooldown || 2000;\n             \n             // Izsaucam via izveidi\n             if (typeof spawnProjectile === 'function') {\n                // Novietojam viu rpus tanka korpusa (atkarb no virziena)\n                const spawnX = entity.x + (entity.width / 2) + (entity.direction * (entity.width / 2 + 10));\n                const spawnY = entity.y + (entity.height * 0.4); // Nedaudz augstk par centru (stobrs)\n                \n                spawnProjectile(\n                  spawnX, \n                  spawnY, \n                  entity.direction,\n                  entity.id\n                );\n             }\n           }\n        }\n      }\n    } else if (ai.patrol) {\n      // Patruanas rems\n      if (entity.direction > 0) keys.d = true;\n      else keys.a = true;\n\n    // Sienas un ru prbaude, lai grieztos atpaka\n    const nextX = entity.x + entity.direction * 10;\n    let hitSomething = checkCollision(nextX, entity.y, mapWidth, mapHeight, entity.width, entity.height);\n\n    // Tanku specifisk kolzija (ar spltju un citiem tankiem)\n    if (!hitSomething && entity.subtype === 'tank') {\n      // 1. Prbaude ar spltju\n      const p = gameState.current;\n      if (nextX < p.x + p.width && nextX + entity.width > p.x && entity.y < p.y + p.height && entity.y + entity.height > p.y) {\n        hitSomething = true;\n      }\n\n      // 2. Prbaude ar citiem tankiem\n      if (!hitSomething) {\n        for (const other of entitiesRef.current) {\n          if (other === entity || other.health <= 0 || other.isExploding) continue;\n          if (other.subtype !== 'tank') continue;\n\n          if (nextX < other.x + other.width && nextX + entity.width > other.x && entity.y < other.y + other.height && entity.y + entity.height > other.y) {\n            hitSomething = true;\n            // Liekam ar otram tankam maint virzienu, ja tie brauc viens otram virs\n            if ((entity.direction > 0 && other.direction < 0) || (entity.direction < 0 && other.direction > 0)) {\n               other.direction *= -1;\n            }\n            break;\n          }\n        }\n      }\n    }\n\n    if (hitSomething) {\n      entity.direction *= -1;\n    }\n    \n    // Platformas malas prbaude\n      if (ai.stayOnPlatform && entity.isGrounded) {\n          const groundX = entity.x + (entity.direction > 0 ? entity.width : 0) + entity.direction * 5;\n          const groundY = entity.y + entity.height + 5;\n          if (!checkCollision(groundX, groundY, mapWidth, mapHeight, 2, 2)) {\n              entity.direction *= -1;\n          }\n      }\n    }\n\n    // Cooldown atjaunoana\n    if (entity.shootCooldown > 0) {\n      entity.shootCooldown -= deltaMs;\n      // Pc 300ms prtraucam auanas animciju\n      if (entity.shootCooldown < (ai.shootCooldown || 2000) - 300) {\n        entity.isShooting = false;\n      }\n    }\n\n    // 3. Fizika un kustba\n    const frameSpeed = speed * (deltaMs / 16.67);\n    \n    const checkEntityCollision = (nx, ny) => {\n        // Statisk pasaule\n        if (checkCollision(nx, ny, mapWidth, mapHeight, entity.width, entity.height)) return true;\n        \n        // Tankiem blojam ceu, ja priek ir spltjs vai cits tanks\n        if (entity.subtype === 'tank') {\n            const p = gameState.current;\n            if (nx < p.x + p.width && nx + entity.width > p.x && ny < p.y + p.height && ny + entity.height > p.y) return true;\n            \n            for (const other of entitiesRef.current) {\n                if (other === entity || other.health <= 0 || other.isExploding) continue;\n                if (other.subtype !== 'tank') continue;\n                if (nx < other.x + other.width && nx + entity.width > other.x && ny < other.y + other.height && ny + entity.height > other.y) return true;\n            }\n        }\n        return false;\n    };\n\n    const mh = moveHorizontal({\n      keys,\n      state: { \n        x: entity.x, \n        y: entity.y, \n        vx: entity.vx || 0,\n        width: entity.width, \n        direction: entity.direction \n      },\n      MOVE_SPEED: frameSpeed,\n      TILE_SIZE,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision\n    });\n    entity.x = mh.x;\n    entity.vx = mh.vx;\n    entity.direction = mh.direction;\n\n    const vp = applyVerticalPhysics({\n      keys,\n      x: entity.x,\n      y: entity.y,\n      vy: entity.vy,\n      isGrounded: entity.isGrounded,\n      animation: entity.animation,\n      GRAVITY,\n      TERMINAL_VELOCITY,\n      JUMP_FORCE: ai.canJump ? 8 : 0,\n      TILE_SIZE,\n      width: entity.width,\n      height: entity.height,\n      mapWidth,\n      mapHeight,\n      checkCollision: checkEntityCollision,\n      isLiquidAt: ctx.isLiquidAt,\n      vx: entity.vx\n    });\n    entity.y = vp.y;\n    entity.vy = vp.vy;\n    entity.isGrounded = vp.isGrounded;\n\n    // 4. Animcijas stvoka noteikana\n    if (entity.isShooting) {\n      entity.animation = 'shoot';\n    } else if (entity.health <= (def.maxHealth || 100) * 0.5) {\n      entity.animation = 'move_damaged';\n    } else if (entity.vx === 0 && entity.isGrounded) {\n      entity.animation = 'idle';\n    } else {\n      entity.animation = 'move';\n    }\n\n    // Atjaunojam animcijas rmi, ja tas nav sprdziens\n    if (!entity.isExploding) {\n        const anims = def.spriteSheet?.animations || {};\n        let currentAnim = anims[entity.animation];\n        \n        // Rezerves varianti, ja specifisk animcija nav atrasta\n        if (!currentAnim || !Array.isArray(currentAnim) || currentAnim.length === 0) {\n            currentAnim = anims['move'] || anims['idle'] || [0];\n        }\n        \n        entity.animTimer = (entity.animTimer || 0) + deltaMs;\n        const frameDur = 100; // ms\n        if (entity.animTimer >= frameDur) {\n            entity.animTimer = 0;\n            entity.animFrame = (entity.animFrame || 0) + 1;\n            if (entity.animFrame >= currentAnim.length) {\n                entity.animFrame = 0;\n            }\n        }\n        entity.currentSpriteIndex = currentAnim[entity.animFrame % currentAnim.length];\n    } else {\n        const explodeAnim = def.spriteSheet?.animations?.explode || [39];\n        // Sprdziena animcija tiek vadta augstk (death sekcij)\n        entity.currentSpriteIndex = explodeAnim[Math.min(entity.animFrame, explodeAnim.length - 1)];\n    }\n\n    if (entity.shouldRemove) {\n      entities.splice(i, 1);\n    }\n  }\n}\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { resolveInteractableContext } from '../gameplay/interactables/context';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\nimport { updateEntities } from '../gameplay/entities';\nimport { updateSeaRescue } from '../gameplay/seaRescue';\nimport { getWeatherDps, getMapWeather, getRadioactivityRates, weatherAffectsPlayer, weatherBlockedByCover } from '../gameplay/weatherDamage';\nimport { isCoveredFromAbove } from '../gameplay/weatherCover';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isLiquidAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions,\n    registryItems\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, entitiesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef, weatherDamageAccRef, activeRoomIdsRef, soundEnabledRef, ambientAudioRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isLiquidAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, playSfx, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n  const activeMap = mapData.maps ? mapData.maps[activeId] : mapData;\n  const mapType = activeMap?.type;\n\n  const mapWidth = activeMap?.width || mapData.meta?.width || mapData.width || 20;\n  const mapHeight = activeMap?.height || mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  const getDefById = (id) => {\n    if (!id) return null;\n    const map = registryItems && registryItems.__byId;\n    if (map && typeof map.get === 'function') return map.get(id) || null;\n    return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n  };\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo,\n    iceResist,\n    maxIceResist\n  } = gameState.current;\n\n  const dt = Math.max(0, deltaMs || 0);\n  const physicsDt = Math.min(dt, 100);\n\n    // Sea Rescue logic\n  if (mapType === 'sea_rescue') {\n    updateSeaRescue(ctx, dt);\n    \n    // Update projectiles in sea rescue too\n    if (actions.updateProjectiles) {\n      actions.updateProjectiles(physicsDt, mapWidth, mapHeight);\n    }\n\n    // Update entities (fishes) in sea rescue\n    try {\n      updateEntities({\n        entitiesRef,\n        projectilesRef: refs.projectilesRef,\n        gameState,\n        mapData,\n        objectData,\n        mapWidth,\n        mapHeight,\n        TILE_SIZE,\n        checkCollision,\n        isLiquidAt,\n        getLiquidSample,\n        spawnProjectile,\n        playSfx,\n        constants,\n        registryItems: ctx.registryItems,\n        onStateUpdate: actions.onStateUpdate,\n        activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n      }, Math.min(dt, 100));\n    } catch (e) {\n      console.error(\"Sea Rescue Entity update failed:\", e);\n    }\n\n    // Ship control (A/D)\n    const shipAccel = 400;\n    const shipFriction = 0.95;\n    const maxShipSpeed = 250;\n    \n    if (keys.a || keys.ArrowLeft) {\n        vx -= shipAccel * (dt / 1000);\n    } else if (keys.d || keys.ArrowRight) {\n        vx += shipAccel * (dt / 1000);\n    } else {\n        vx *= shipFriction;\n        if (Math.abs(vx) < 1) vx = 0;\n    }\n    \n    vx = Math.max(-maxShipSpeed, Math.min(maxShipSpeed, vx));\n    x += vx * (dt / 1000);\n    \n    // Constrain ship within map\n    x = Math.max(0, Math.min(x, (mapWidth - 27) * TILE_SIZE)); // Ship width is 27 tiles\n\n    // Update state and exit early (no normal player physics)\n    const shipDef = getDefById('minispill_sea_rescue_ship');\n    const shipBaseX = refs.seaRescueRef?.shipBaseX || 0;\n    const shipBaseY = refs.seaRescueRef?.shipBaseY || 0;\n    const shipWorldX = shipBaseX + x;\n    const shipWorldY = shipBaseY + y;\n    const shipWorldWidth = (shipDef?.width || 27) * TILE_SIZE;\n    const shipWorldHeight = (shipDef?.height || 7) * TILE_SIZE;\n    gameState.current = {\n        ...gameState.current,\n        x, vx, y, vy, \n        isGrounded: true, \n        animation: 'idle',\n        shipWorldX,\n        shipWorldY,\n        shipWorldWidth,\n        shipWorldHeight,\n        timeMs: Number(timestamp) || 0\n    };\n    setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n    return { continue: true };\n  }\n\n  // 0.5) Resources update (before physics to affect them)\n  // Ice resistance depletion: drains while on slippery surface; regenerates otherwise\n  const layers = ctx.mapData.layers || [];\n  const backgroundLayer = layers.find(l => l.name === 'background')?.data || [];\n  const secretLayer = layers.find(l => l.name === 'secrets' || l.type === 'secret')?.data || [];\n  const objectMetadata = mapData.meta?.objectMetadata || {};\n  const surface = helpers.getSurfaceProperties ? helpers.getSurfaceProperties(x, y, width, height, mapWidth, mapHeight, TILE_SIZE, backgroundLayer, ctx.registryItems) : { friction: 0.8, acceleration: 0.2 };\n  \n  const isSlippery = surface.friction >= 0.9;\n  let currentIceRes = Number(iceResist);\n  const maxIce = Math.max(1, Number(maxIceResist || 100));\n  if (!Number.isFinite(currentIceRes)) currentIceRes = maxIce;\n\n  if (isSlippery) {\n    currentIceRes -= (20 * dt) / 1000;\n  } else {\n    currentIceRes += (35 * dt) / 1000;\n  }\n  currentIceRes = Math.max(0, Math.min(maxIce, currentIceRes));\n  gameState.current.iceResist = currentIceRes;\n\n  let effectiveFriction = surface.friction;\n  if (isSlippery && currentIceRes > 0) {\n      const ratio = currentIceRes / maxIce;\n      const targetFriction = 0.8;\n      effectiveFriction = surface.friction - (surface.friction - targetFriction) * ratio;\n  }\n\n  // 1) Horizontal movement\n  const checkCollisionExtended = (nx, ny, mw, mh, w, h) => {\n    return checkCollision(nx, ny, mw, mh, w, h);\n  };\n\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, vx, width, direction, height },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision: checkCollisionExtended,\n    friction: effectiveFriction,\n    acceleration: isSlippery ? (currentIceRes > 0 ? 0.15 : surface.acceleration) : surface.acceleration,\n    deltaMs: physicsDt\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 1.1) Pushable objects logic (Stone pushing)\n  let isPushing = false;\n  let pushTarget = null;\n  \n  const currentStrength = gameState.current.strength || 30;\n  const isAlreadyAtMax = currentStrength >= 99;\n  const lastPushTime = gameState.current.lastPushTime || 0;\n  const gracePeriod = 300; // ms, kur strength nesamazins pat ja kontakts pazd uz brdi\n\n  if (entitiesRef.current) {\n    // Ja jau stumjam ar pilnu jaudu, esam pielaidgki pret attlumu (histerze), \n    // lai kompenstu nelielas fizikas dzinja nobdes.\n    const pushDist = isAlreadyAtMax ? 15 : 5;\n    const overlapDist = isAlreadyAtMax ? 12 : 5;\n\n    for (const ent of entitiesRef.current) {\n      if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n        // Prbaudm vai spltjs ir blakus akmenim\n        const isNextToLeft = (x + width + pushDist > ent.x) && (x + width <= ent.x + overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n        const isNextToRight = (x - pushDist < ent.x + ent.width) && (x >= ent.x + ent.width - overlapDist) && (y + height > ent.y + 2) && (y < ent.y + ent.height - 2);\n\n        if ((isNextToLeft && keys.d) || (isNextToRight && keys.a)) {\n          isPushing = true;\n          pushTarget = ent;\n          break;\n        }\n      }\n    }\n  }\n\n  if (isPushing) {\n    gameState.current.strength = Math.min(100, currentStrength + (65 * dt) / 1000); // Aug par ~65% sekund\n    if (gameState.current.strength >= 100 && pushTarget) {\n      // Pastumjam akmeni\n      const pushForce = 2.0;\n      pushTarget.vx = (x < pushTarget.x ? 1 : -1) * pushForce;\n      gameState.current.lastPushTime = timestamp; \n      \n      // Atskaojam skau\n      if (pushTarget.def?.sounds?.push && (!pushTarget.lastPushSoundTime || timestamp - pushTarget.lastPushSoundTime > 450)) {\n        playSfx(pushTarget.def.sounds.push, 0.3);\n        pushTarget.lastPushSoundTime = timestamp;\n      }\n    }\n  } else {\n    // Prbaudm grace periodu pirms skam samazint spku\n    const timeSincePush = timestamp - lastPushTime;\n    if (timeSincePush > gracePeriod) {\n      if (currentStrength > 30) {\n        gameState.current.strength = Math.max(30, currentStrength - (35 * dt) / 1000);\n      } else {\n        gameState.current.strength = 30;\n      }\n    }\n  }\n\n  // 1.9) Ladder check (allow climbing when overlapping ladder objects)\n  const findLadderAtPlayer = () => {\n    if (!objectData || !registryItems) return null;\n    const centerX = x + width / 2;\n    const centerY = y + height / 2;\n    const ctxResolved = resolveInteractableContext({\n      mapData,\n      mapWidth,\n      mapHeight,\n      objectLayerData: objectData,\n      mainObjectMetadata: objectMetadata,\n      secretMapData: secretLayer,\n      activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n      centerX,\n      centerY,\n      TILE_SIZE\n    });\n    const { activeObjectData, activeMetadata, activeMapWidth, activeMapHeight, offsetX, offsetY } = ctxResolved;\n    if (!activeObjectData) return null;\n    const resolveObjectAt = (gridX, gridY) => {\n      if (gridX < 0 || gridY < 0 || gridX >= activeMapWidth || gridY >= activeMapHeight) return null;\n      let idx = gridY * activeMapWidth + gridX;\n      let objId = activeObjectData[idx];\n      if (!objId && activeMetadata) {\n        for (const [idxStr, meta] of Object.entries(activeMetadata)) {\n          const baseIdx = parseInt(idxStr, 10);\n          const w = meta.width || 1;\n          const h = meta.height || 1;\n          if (w <= 1 && h <= 1) continue;\n          const ox = baseIdx % activeMapWidth;\n          const oy = Math.floor(baseIdx / activeMapWidth);\n          if (gridX >= ox && gridX < ox + w && gridY >= oy && gridY < oy + h) {\n            objId = activeObjectData[baseIdx];\n            idx = baseIdx;\n            break;\n          }\n        }\n      }\n      if (!objId) return null;\n      return { objId, idx };\n    };\n\n    const samplePoints = [\n      { x: centerX, y: centerY },\n      { x: centerX, y: y + height - 2 }\n    ];\n\n    for (const pt of samplePoints) {\n      const localX = pt.x - offsetX;\n      const localY = pt.y - offsetY;\n      const gridX = Math.floor(localX / TILE_SIZE);\n      const gridY = Math.floor(localY / TILE_SIZE);\n      const hit = resolveObjectAt(gridX, gridY);\n      if (!hit) continue;\n      const def = getDefById(hit.objId);\n      if (!def) continue;\n      const isLadder = !!(def.flags?.ladder || def.subtype === 'ladder' || def.type === 'ladder');\n      if (!isLadder) continue;\n      let hasLadderAbove = false;\n      if (gridY > 0) {\n        const above = resolveObjectAt(gridX, gridY - 1);\n        const aboveDef = above ? getDefById(above.objId) : null;\n        hasLadderAbove = !!(aboveDef && (aboveDef.flags?.ladder || aboveDef.subtype === 'ladder' || aboveDef.type === 'ladder'));\n      }\n      const topY = offsetY + gridY * TILE_SIZE;\n      return { def, index: hit.idx, hasLadderAbove, topY };\n    }\n    return null;\n  };\n\n  const ladderInfo = findLadderAtPlayer();\n\n  // 2) Vertical physics\n  let vp = null;\n  let remaining = physicsDt;\n  let steps = 0;\n  const prevInWaterFrame = !!gameState.current.inWater;\n  let prevInWater = prevInWaterFrame;\n  if (ladderInfo && !keys?.space) {\n    const ladderSpeed = Math.max(40, Number(ladderInfo.def?.ladder?.speed) || 120);\n    const climbDir = (keys.w ? -1 : 0) + (keys.s ? 1 : 0);\n    const standY = !ladderInfo.hasLadderAbove ? ladderInfo.topY - height : null;\n    let snappedToTop = false;\n\n    if (standY !== null && y <= standY + 1) {\n      y = standY;\n      vy = 0;\n      isGrounded = true;\n      animation = Math.abs(vx || 0) > 0.1 ? 'run' : 'idle';\n      snappedToTop = true;\n    }\n\n    if (!snappedToTop && climbDir !== 0) {\n      const proposedY = y + (climbDir * ladderSpeed) * (physicsDt / 1000);\n      if (standY !== null && climbDir < 0 && proposedY <= standY) {\n        y = standY;\n        vy = 0;\n        isGrounded = true;\n        animation = Math.abs(vx || 0) > 0.1 ? 'run' : 'idle';\n        snappedToTop = true;\n      } else if (!checkCollisionExtended(x, proposedY, mapWidth, mapHeight, width, height)) {\n        y = proposedY;\n      }\n      if (!snappedToTop) {\n        animation = 'climb';\n      }\n    }\n\n    if (!snappedToTop) {\n      vy = 0;\n      isGrounded = false;\n    }\n    vp = { y, vy, isGrounded, animation, inWater: false, headUnderWater: false, atSurface: false };\n  } else {\n    while (remaining > 0 && steps < 10) {\n      const stepMs = Math.min(16.67, remaining);\n      vp = applyVerticalPhysics({\n        keys,\n        x,\n        y,\n        vy,\n        isGrounded,\n        animation,\n        GRAVITY,\n        TERMINAL_VELOCITY,\n        JUMP_FORCE,\n        TILE_SIZE,\n        width,\n        height,\n        mapWidth,\n        mapHeight,\n        checkCollision: checkCollisionExtended,\n        vx,\n        isLiquidAt: (wx, wy) => {\n          try { return typeof isLiquidAt === 'function' ? isLiquidAt(wx, wy) : null; } catch { return null; }\n        },\n        prevInWater,\n        deltaMs: stepMs\n      });\n      y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n      prevInWater = !!vp.inWater;\n      remaining -= stepMs;\n      steps++;\n    }\n  }\n  const inWater = !!(vp ? vp.inWater : gameState.current.inWater);\n  const headUnderWater = !!(vp ? vp.headUnderWater : gameState.current.headUnderWater);\n  const atSurface = !!(vp ? vp.atSurface : gameState.current.atSurface);\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else if (liquidType === 'quicksand') {\n      vx *= 0.72; // Quicksand is very thick\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n    const resourceParams = liquidParams?.resources || {};\n    const parseNumber = (v) => (v === null || v === undefined || v === '') ? null : Number(v);\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = resourceParams.oxygen || liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = resourceParams.lavaResist || liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n    const iceParams = resourceParams.iceResist;\n    const strengthParams = resourceParams.strength;\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    const oxygenApplies = !!(resourceParams.oxygen || liquidType === 'water' || liquidType === 'quicksand' || liquidType === 'radioactive_water' || liquidType === 'waterfall' || liquidType === 'radioactive_waterfall');\n    const oxygenEnabled = oxyParams?.enabled !== false;\n    const oxyDrain = parseNumber(oxyParams?.drainPerSecond);\n    const oxyRegen = parseNumber(oxyParams?.regenPerSecond);\n    if (oxygenEnabled && headUnderWater && oxygenApplies && Number.isFinite(oxyDrain)) {\n      oxy -= (Math.max(0, oxyDrain) * dt) / 1000;\n    } else if (oxygenEnabled) {\n      oxy += (Math.max(0, Number.isFinite(oxyRegen) ? oxyRegen : 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resist depletion while in lava; regenerates outside\n    const lavaApplies = !!(resourceParams.lavaResist || liquidType === 'lava' || liquidType === 'lava_waterfall');\n    const lavaEnabled = lavaParams?.enabled !== false;\n    const lavaDrain = parseNumber(lavaParams?.drainPerSecond);\n    const lavaRegen = parseNumber(lavaParams?.regenPerSecond);\n    if (lavaEnabled && lavaApplies && liquidType && liquidType.includes('lava') && Number.isFinite(lavaDrain)) {\n      lavaRes -= (Math.max(0, lavaDrain) * dt) / 1000;\n    } else if (lavaEnabled) {\n      lavaRes += (Math.max(0, Number.isFinite(lavaRegen) ? lavaRegen : 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Ice resist & strength can be optionally affected by liquids\n    const applyResource = (key, maxKey, params) => {\n      if (!params || params.enabled === false) return;\n      const drain = parseNumber(params.drainPerSecond);\n      const regen = parseNumber(params.regenPerSecond);\n      if (!Number.isFinite(drain) && !Number.isFinite(regen)) return;\n      const maxVal = Math.max(1, Number(gameState.current[maxKey] || 100));\n      let cur = Number(gameState.current[key]);\n      if (!Number.isFinite(cur)) cur = maxVal;\n      if (inWater || liquidType) {\n        if (Number.isFinite(drain)) cur -= (Math.max(0, drain) * dt) / 1000;\n      } else if (Number.isFinite(regen)) {\n        cur += (Math.max(0, regen) * dt) / 1000;\n      }\n      cur = Math.max(0, Math.min(maxVal, cur));\n      gameState.current[key] = cur;\n      gameState.current[maxKey] = maxVal;\n    };\n\n    applyResource('iceResist', 'maxIceResist', iceParams);\n    applyResource('strength', 'maxStrength', strengthParams);\n\n    // Radioactivity: fills up in radioactive liquid; slowly returns to 20% outside\n    const weatherNow = getMapWeather(mapData);\n    const radioFogInt = Number(weatherNow.radioactiveFog || 0);\n    const fogActive = weatherAffectsPlayer('radioactiveFog') && radioFogInt > 0;\n    const maxRadio = Math.max(1, Number(gameState.current.maxRadioactivity || 100));\n    let radio = Number(gameState.current.radioactivity);\n    if (!Number.isFinite(radio)) radio = maxRadio * 0.2;\n\n    const radioParams = resourceParams.radioactivity;\n    const radioEnabled = radioParams?.enabled !== false;\n    const radioBaseline = Number.isFinite(parseNumber(radioParams?.baselinePercent)) ? Math.max(0, Math.min(1, parseNumber(radioParams?.baselinePercent))) : 0.2;\n    const radioGain = Number.isFinite(parseNumber(radioParams?.gainPerSecond)) ? Math.max(0, parseNumber(radioParams?.gainPerSecond)) : (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall' ? 15 : 0);\n    const radioDecay = Number.isFinite(parseNumber(radioParams?.decayPerSecond)) ? Math.max(0, parseNumber(radioParams?.decayPerSecond)) : 5;\n    const radioRecover = Number.isFinite(parseNumber(radioParams?.recoverPerSecond)) ? Math.max(0, parseNumber(radioParams?.recoverPerSecond)) : 2;\n    const radioApplies = !!(radioParams || liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall');\n\n    if (radioEnabled && radioApplies && (liquidType === 'radioactive_water' || liquidType === 'radioactive_waterfall')) {\n      radio += (radioGain * dt) / 1000; \n    } else if (radioEnabled && !fogActive) {\n      const baseline = maxRadio * radioBaseline;\n      if (radio > baseline) {\n        radio -= (radioDecay * dt) / 1000;\n      } else if (radio < baseline) {\n        radio += (radioRecover * dt) / 1000;\n      }\n    }\n\n    // Radioactivity resource changes from fog (deplete while fog is active)\n    if (weatherAffectsPlayer('radioactiveFog')) {\n      const rates = getRadioactivityRates();\n      if (radioFogInt > 0 && rates.increase > 0) {\n        const dec = (radioFogInt / 100) * rates.increase * (dt / 1000);\n        radio -= dec;\n      } else if (radioFogInt <= 0 && rates.decay > 0 && !fogActive) {\n        const inc = rates.decay * (dt / 1000);\n        radio += inc;\n      }\n    }\n\n    radio = Math.max(0, Math.min(maxRadio, radio));\n    gameState.current.radioactivity = radio;\n    gameState.current.maxRadioactivity = maxRadio;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && oxygenApplies) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if ((liquidType === 'lava' || liquidType === 'lava_waterfall') && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n\n    // Weather damage (Lava Rain, Radioactive Fog)\n    const weather = weatherNow || getMapWeather(mapData);\n    const lavaRainInt = Number(weather.lavaRain || 0);\n\n    let lavaDps = weatherAffectsPlayer('lavaRain') ? getWeatherDps('lavaRain', lavaRainInt) : 0;\n    const radioDps = weatherAffectsPlayer('radioactiveFog') ? getWeatherDps('radioactiveFog', radioFogInt) : 0;\n    if (lavaDps > 0 && (inWater || (liquidType && liquidType.includes('water')))) {\n      lavaDps = 0;\n    }\n    if (lavaDps > 0 && weatherBlockedByCover('lavaRain')) {\n      try {\n        const tileData = backgroundLayer;\n        const secretData = secretLayer;\n        const covered = isCoveredFromAbove({\n          x: x + width / 2,\n          y,\n          mapWidth,\n          mapHeight,\n          TILE_SIZE,\n          tileData,\n          registryItems: ctx.registryItems,\n          secretData,\n          objectData,\n          objectMetadata,\n          maps: mapData.maps,\n          activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n        });\n        if (covered) lavaDps = 0;\n      } catch {}\n    }\n    const effectiveRadioDps = (radioDps > 0 && Number(radio) <= 0) ? radioDps : 0;\n    const totalWeatherDps = lavaDps + effectiveRadioDps;\n\n    if (totalWeatherDps > 0) {\n      weatherDamageAccRef.current += dt;\n      if (weatherDamageAccRef.current >= 1000) {\n        weatherDamageAccRef.current -= 1000;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - totalWeatherDps);\n        const HIT_FLASH_MS = 500;\n        gameState.current.hitTimerMs = Math.max(Number(gameState.current.hitTimerMs) || 0, HIT_FLASH_MS);\n        if (actions.onStateUpdate) {\n          actions.onStateUpdate('playerDamage', {\n            damage: totalWeatherDps,\n            x: x + width / 2,\n            y\n          });\n        }\n      }\n    } else {\n      weatherDamageAccRef.current = 0;\n    }\n\n    const ambientStore = ambientAudioRef?.current;\n    if (ambientStore) {\n      const nowMs = Number(timestamp) || 0;\n      const isSoundEnabled = !!soundEnabledRef?.current;\n      const isInsideRoom = !!(activeRoomIdsRef?.current && activeRoomIdsRef.current.length > 0);\n      const clamp01 = (value) => Math.max(0, Math.min(1, Number(value) || 0));\n      const updateLoopingAudio = (key, url, volume) => {\n        let vol = isSoundEnabled ? clamp01(volume) : 0;\n        if (isInsideRoom) vol *= 0.5;\n\n        if (!url || vol <= 0) {\n          const entry = ambientStore[key];\n          if (entry?.audio) {\n            try { entry.audio.pause(); } catch {}\n            try { entry.audio.currentTime = 0; } catch {}\n          }\n          return;\n        }\n\n        let entry = ambientStore[key];\n        if (!entry || entry.url !== url || !entry.audio) {\n          if (entry?.audio) {\n            try { entry.audio.pause(); } catch {}\n          }\n          const audio = new Audio(url);\n          audio.loop = true;\n          entry = { audio, url, lastPlayAttempt: 0 };\n          ambientStore[key] = entry;\n        }\n\n        entry.audio.volume = vol;\n        if (entry.audio.paused && (!entry.lastPlayAttempt || nowMs - entry.lastPlayAttempt > 1000)) {\n          entry.lastPlayAttempt = nowMs;\n          const p = entry.audio.play?.();\n          if (p && typeof p.catch === 'function') p.catch(() => {});\n        }\n      };\n\n      const rainDef = getDefById('weather_rain_on');\n      const rainSound = rainDef?.sounds?.loop;\n      const rainUrl = typeof rainSound === 'string' ? rainSound : rainSound?.src;\n      const rainBaseVol = Number.isFinite(Number(rainSound?.volume)) ? Number(rainSound.volume) : 0.45;\n      const rainIntensity = Math.max(0, Math.min(100, Number(weatherNow?.rain || 0)));\n      updateLoopingAudio('rain', rainUrl, (rainIntensity / 100) * rainBaseVol);\n\n      const waterfallDef = getDefById('waterfall_block');\n      const waterfallSound = waterfallDef?.sounds?.ambient;\n      const waterfallUrl = typeof waterfallSound === 'string' ? waterfallSound : waterfallSound?.src;\n      if (waterfallUrl) {\n        const maxDistTiles = Number.isFinite(Number(waterfallSound?.maxDistance))\n          ? Math.max(1, Number(waterfallSound.maxDistance))\n          : 8;\n        const maxDistPx = maxDistTiles * TILE_SIZE;\n        const px = x + width / 2;\n        const py = y + height / 2;\n        const minGX = Math.max(0, Math.floor((px - maxDistPx) / TILE_SIZE));\n        const maxGX = Math.min(mapWidth - 1, Math.floor((px + maxDistPx) / TILE_SIZE));\n        const minGY = Math.max(0, Math.floor((py - maxDistPx) / TILE_SIZE));\n        const maxGY = Math.min(mapHeight - 1, Math.floor((py + maxDistPx) / TILE_SIZE));\n        const waterfallId = waterfallDef?.id || 'waterfall_block';\n        let bestSq = Infinity;\n        for (let gy = minGY; gy <= maxGY; gy++) {\n          for (let gx = minGX; gx <= maxGX; gx++) {\n            const idx = gy * mapWidth + gx;\n            if (backgroundLayer[idx] !== waterfallId) continue;\n            const cx = (gx + 0.5) * TILE_SIZE;\n            const cy = (gy + 0.5) * TILE_SIZE;\n            const dx = cx - px;\n            const dy = cy - py;\n            const distSq = dx * dx + dy * dy;\n            if (distSq < bestSq) bestSq = distSq;\n          }\n        }\n        let waterfallVolume = 0;\n        if (Number.isFinite(bestSq)) {\n          const dist = Math.sqrt(bestSq);\n          if (dist <= maxDistPx) {\n            const baseVol = Number.isFinite(Number(waterfallSound?.volume)) ? Number(waterfallSound.volume) : 0.6;\n            waterfallVolume = baseVol * Math.max(0, 1 - dist / maxDistPx);\n          }\n        }\n        updateLoopingAudio('waterfall', waterfallUrl, waterfallVolume);\n      } else {\n        updateLoopingAudio('waterfall', null, 0);\n      }\n    }\n\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  const healthEnabled = resourceParams?.health?.enabled !== false;\n  const healthDpsOverride = (healthEnabled && resourceParams?.health && resourceParams.health.damagePerSecond !== null && resourceParams.health.damagePerSecond !== undefined)\n    ? Number(resourceParams.health.damagePerSecond)\n    : null;\n  const effectiveDps = Number.isFinite(healthDpsOverride) ? Math.max(0, healthDpsOverride) : Number(liquidParams?.dps);\n  if (liquidType && liquidParams && Number(effectiveDps) > 0) {\n    try {\n      if (liquidType && liquidType.includes('lava')) {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, { dps: effectiveDps });\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection and triggers\n  // Sync moved state to Ref so triggers can see it and modify it (Teleport, Knockback, etc.)\n  gameState.current.x = x;\n  gameState.current.y = y;\n  gameState.current.vx = vx;\n  gameState.current.vy = vy;\n  gameState.current.isGrounded = isGrounded;\n  gameState.current.animation = animation;\n\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, mapHeight, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // Sync back from Ref in case triggers changed something\n  x = gameState.current.x;\n  y = gameState.current.y;\n  vx = gameState.current.vx;\n  vy = gameState.current.vy;\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0 && mapType !== 'sea_rescue') {\n    const originX = x + (direction >= 0 ? width + 4 : -4);\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1, 'player');\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 5.5) Update entities (tanks etc.)\n  try {\n    updateEntities({\n      entitiesRef,\n      projectilesRef: refs.projectilesRef,\n      gameState,\n      mapData,\n      objectData,\n      mapWidth,\n      mapHeight,\n      TILE_SIZE,\n      checkCollision,\n      isLiquidAt,\n      getLiquidSample,\n      spawnProjectile,\n      playSfx,\n      constants,\n      registryItems: ctx.registryItems,\n      onStateUpdate: actions.onStateUpdate,\n      activeRoomIds: activeRoomIdsRef?.current || mapData.meta?.activeRoomIds\n    }, Math.min(dt, 100)); // Ierobeojam deltaMs uz 100ms, lai izvairtos no milzgiem lcieniem\n    \n    // Sinhronizjam loklos maingos pc enttiju (platformu) ietekmes\n    x = gameState.current.x;\n    y = gameState.current.y;\n    vx = gameState.current.vx;\n    vy = gameState.current.vy;\n    isGrounded = gameState.current.isGrounded;\n    animation = gameState.current.animation;\n\n    if (checkSecrets && entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.subtype === 'pushable' || ent.def?.isPushable) {\n          try { checkSecrets(ent.x, ent.y, ent.width, ent.height, mapWidth, mapHeight); } catch {}\n        }\n      }\n    }\n    \n    // Kontaktbojjumi no enttijm\n    const player = gameState.current;\n    if (entitiesRef.current && entitiesRef.current.length > 0) {\n      for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.subtype === 'pushable' || ent.def?.isPushable || ent.subtype === 'platform' || ent.def?.subtype === 'platform') continue;\n        \n        // AABB prbaude\n        const hit = (\n          player.x < ent.x + ent.width &&\n          player.x + player.width > ent.x &&\n          player.y < ent.y + ent.height &&\n          player.y + player.height > ent.y\n        );\n        \n        if (hit && Number(player.hitTimerMs) <= 0) {\n          // Pievienojam nelielu atgrdienu (knockback)\n          const knockbackDir = player.x + player.width / 2 < ent.x + ent.width / 2 ? -1 : 1;\n          gameState.current.vx = knockbackDir * 5;\n          gameState.current.vy = -3;\n          \n          // Iestatm bezsmertbas periodu un vizulo flash\n          gameState.current.hitTimerMs = 500;\n          \n          // Samazinm spltja veselbu\n          gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - 10);\n          \n          if (actions.onStateUpdate) {\n            actions.onStateUpdate('playerDamage', { damage: 10, x: player.x + player.width / 2, y: player.y });\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"Entity update failed:\", e);\n  }\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Win and Death check\n  if (gameState.current.isWinning) {\n    gameState.current.winCounter = (gameState.current.winCounter || 0) + (gameState.current.winCountSpeed || 10) * (deltaMs / 100);\n    if (gameState.current.winCounter >= 100) {\n      gameState.current.winCounter = 100;\n      // Trigger level win event if needed\n      if (actions.onStateUpdate) actions.onStateUpdate('levelWin');\n    }\n  }\n\n  if ((Number(gameState.current.health) || 0) <= 0 || y > mapHeight * TILE_SIZE + 300) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  if (!prevInWaterFrame && inWater) {\n    gameState.current.lastWaterEnter = {\n      x: x + width / 2,\n      y: y + height / 2,\n      time: Number(timestamp) || 0\n    };\n  }\n\n  if (actions.playSfx) {\n    const playerDef = getDefById('player');\n    if (playerDef?.sounds?.water_out && prevInWaterFrame && !inWater) {\n      try { actions.playSfx(playerDef.sounds.water_out, 0.35); } catch {}\n    } else if (playerDef?.sounds?.water_in && !prevInWaterFrame && inWater) {\n      try { actions.playSfx(playerDef.sounds.water_in, 0.35); } catch {}\n    }\n  }\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    timeMs: Number(timestamp) || 0,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null,\n    liquidOverlay: liquidParams?.overlay || null,\n    onIce: isSlippery\n  };\n\n  // Floating text deltas for player resources\n  if (actions.onStateUpdate) {\n    const floatState = gameState.current.floatingText || { prev: {}, acc: {} };\n    const resources = [\n      { key: 'health', color: '#ff3b3b' },\n      { key: 'oxygen', color: '#2ecdf1' },\n      { key: 'lavaResist', color: '#ffcc00' },\n      { key: 'iceResist', color: '#a5f3fc' },\n      { key: 'strength', color: '#8b5a2b' },\n      { key: 'radioactivity', color: '#32cd32' }\n    ];\n    const baseX = x + width / 2;\n    const baseY = y - 6;\n\n    resources.forEach((res, idx) => {\n      const cur = Number(gameState.current[res.key]) || 0;\n      if (!Number.isFinite(floatState.prev[res.key])) {\n        floatState.prev[res.key] = cur;\n        floatState.acc[res.key] = 0;\n        return;\n      }\n      const diff = cur - floatState.prev[res.key];\n      if (diff !== 0) {\n        floatState.acc[res.key] = (floatState.acc[res.key] || 0) + diff;\n        if (Math.abs(floatState.acc[res.key]) >= 1) {\n          const amt = Math.round(floatState.acc[res.key]);\n          floatState.acc[res.key] -= amt;\n          const sign = amt > 0 ? '+' : '';\n          actions.onStateUpdate('floatingText', {\n            x: baseX + (idx - 2.5) * 6,\n            y: baseY,\n            text: `${sign}${amt}`,\n            color: res.color,\n            amount: amt\n          });\n        }\n      }\n      floatState.prev[res.key] = cur;\n    });\n\n    gameState.current.floatingText = floatState;\n  }\n\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [], entities: entitiesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\nexport const MAX_ICE_RESIST = 100;\nexport const MAX_RADIOACTIVITY = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles, handleWeatherEffectHit } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal, getSurfaceProperties } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST,\n    MAX_ICE_RESIST,\n    MAX_RADIOACTIVITY\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret, objectMetadata\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret, objectMetadata, activeRoomIds, mapWidth, mapHeight) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        fishCount: 0,\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        iceResist: MAX_ICE_RESIST,\n        maxIceResist: MAX_ICE_RESIST,\n        radioactivity: MAX_RADIOACTIVITY * 0.2, // 20% default\n        maxRadioactivity: MAX_RADIOACTIVITY,\n        strength: 30,\n        maxStrength: 100,\n        lastPushTime: 0,\n        isWinning: false,\n        winCounter: 0,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const ambientAudioRef = useRef({});                    // Looping ambient audio (rain/waterfall)\n    const thunderSoundStateRef = useRef({ bag: [], last: null });\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n    const weatherDamageAccRef = useRef(0);                // Weather damage DPS accumulator\n    const entitiesRef = useRef([]);                        // Active moving entities (tanks, etc.)\n\n    // Refs for props to avoid stale closures in the game loop\n    const onStateUpdateRef = useRef(onStateUpdate);\n    const onRevealSecretRef = useRef(onRevealSecret);\n    const onGameOverRef = useRef(onGameOver);\n    const objectMetadataRef = useRef(objectMetadata);\n    const revealedSecretsRef = useRef(revealedSecrets);\n    const activeRoomIdsRef = useRef(activeRoomIds);\n    const mapWidthRef = useRef(mapWidth);\n    const mapHeightRef = useRef(mapHeight);\n    const tileDataRef = useRef(tileData);\n    const objectDataRef = useRef(objectData);\n    const secretDataRef = useRef(secretData);\n\n    useEffect(() => { onStateUpdateRef.current = onStateUpdate; }, [onStateUpdate]);\n    useEffect(() => { onRevealSecretRef.current = onRevealSecret; }, [onRevealSecret]);\n    useEffect(() => { onGameOverRef.current = onGameOver; }, [onGameOver]);\n    useEffect(() => { objectMetadataRef.current = objectMetadata; }, [objectMetadata]);\n    useEffect(() => { revealedSecretsRef.current = revealedSecrets; }, [revealedSecrets]);\n    useEffect(() => { activeRoomIdsRef.current = activeRoomIds; }, [activeRoomIds]);\n    useEffect(() => { mapWidthRef.current = mapWidth; }, [mapWidth]);\n    useEffect(() => { mapHeightRef.current = mapHeight; }, [mapHeight]);\n    useEffect(() => { tileDataRef.current = tileData; }, [tileData]);\n    useEffect(() => { objectDataRef.current = objectData; }, [objectData]);\n    useEffect(() => { secretDataRef.current = secretData; }, [secretData]);\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        const isInsideRoom = activeRoomIdsRef.current && activeRoomIdsRef.current.length > 0;\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef, isInsideRoom }, url, volume);\n    };\n\n    useEffect(() => {\n        const onThunderStrike = () => {\n            try {\n                const def = findItemById('weather_thunder_on');\n                const strike = def?.sounds?.strike;\n                let url = null;\n                let volume = 0.7;\n                if (typeof strike === 'string') {\n                    url = strike;\n                } else if (strike && typeof strike === 'object') {\n                    const v = Number(strike.volume);\n                    if (Number.isFinite(v)) volume = v;\n                    if (Array.isArray(strike.variants) && strike.variants.length > 0) {\n                        const state = thunderSoundStateRef.current || { bag: [], last: null };\n                        if (!Array.isArray(state.bag) || state.bag.length === 0) {\n                            state.bag = strike.variants.slice();\n                            for (let i = state.bag.length - 1; i > 0; i--) {\n                                const j = Math.floor(Math.random() * (i + 1));\n                                const tmp = state.bag[i];\n                                state.bag[i] = state.bag[j];\n                                state.bag[j] = tmp;\n                            }\n                            if (state.last && state.bag.length > 1 && state.bag[0] === state.last) {\n                                const swapIdx = 1 + Math.floor(Math.random() * (state.bag.length - 1));\n                                const tmp = state.bag[0];\n                                state.bag[0] = state.bag[swapIdx];\n                                state.bag[swapIdx] = tmp;\n                            }\n                        }\n                        url = state.bag.shift();\n                        state.last = url;\n                        thunderSoundStateRef.current = state;\n                    } else if (typeof strike.src === 'string') {\n                        url = strike.src;\n                    }\n                }\n                if (url) playShotSfx(url, volume);\n            } catch {}\n        };\n        window.addEventListener('weather-thunder-strike', onThunderStrike);\n        return () => window.removeEventListener('weather-thunder-strike', onThunderStrike);\n    }, []);\n\n    useEffect(() => {\n        return () => {\n            const ambient = ambientAudioRef.current;\n            if (!ambient) return;\n            Object.values(ambient).forEach((entry) => {\n                if (!entry || !entry.audio) return;\n                try { entry.audio.pause(); } catch {}\n                try { entry.audio.currentTime = 0; } catch {}\n            });\n        };\n    }, []);\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Weather effects impact handling (meteors, etc.)\n    const handleWeatherEffectHitWrapper = (type, data) => {\n        handleWeatherEffectHit(type, data, {\n            gameState,\n            entitiesRef,\n            TILE_SIZE,\n            onBreakEffect: (detail) => {\n                window.dispatchEvent(new CustomEvent('game-break-effect', { detail }));\n            }\n        });\n    };\n\n    // Listen for weather effect hits from the UI/Renderer\n    useEffect(() => {\n        const onHit = (e) => {\n            if (e && e.detail) {\n                handleWeatherEffectHitWrapper(e.detail.type, e.detail.data);\n            }\n        };\n        window.addEventListener('weather-effect-hit', onHit);\n        return () => window.removeEventListener('weather-effect-hit', onHit);\n    }, []);\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecretRef.current) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecretsRef.current || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecretRef.current(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    const lastMapIdRef = useRef(null);\n\n    // Initialize player at starting position\n    useEffect(() => {\n        if (!mapData) {\n            isInitialized.current = false;\n            lastMapIdRef.current = null;\n            return;\n        }\n\n        // Unique identifier for the map session\n        // We include projectName and timestamps to distinguish between different projects \n        // that might use the same activeMapId (like \"main\")\n        const meta = mapData.meta || {};\n        const projectName = meta.projectName || '';\n        const mapId = meta.activeMapId || mapData.name || 'default';\n        const timestamp = meta.date_map_last_updated || meta.date_map_created_at || '';\n        \n        // Use a unique ID that changes on map load or restart\n        const currentMapId = `${projectName}|${mapId}|${timestamp}`;\n        const isNewMapLoad = currentMapId !== lastMapIdRef.current;\n\n        if (isNewMapLoad) {\n            localRevealedRef.current = new Set();\n        }\n\n        // Ja sple jau ir inicializta UN t ir t pati karte, nemainm spltja pozciju\n        // Tas novr \"reset\" uz skumu, kad spltjs pace itemu vai mains laikapstki\n        if (isInitialized.current && !isNewMapLoad) return;\n\n        lastMapIdRef.current = currentMapId;\n\n        // Reset state for new initialization\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        entitiesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapWidth || mapData.meta?.width || mapData.width || 20;\n            const mapH = mapHeight || mapData.meta?.height || mapData.height || 15;\n            \n            // Search for entities in objectData\n            const initialEntities = [];\n            if (objectData && Array.isArray(objectData)) {\n                objectData.forEach((id, idx) => {\n                    if (id && !id.includes('player')) {\n                        const def = findItemById(id) || registryItems.find(r => r.id === id);\n                        const isEntity = def && (\n                            def.type === 'entity' || \n                            def.subtype === 'tank' || \n                            def.subtype === 'platform' ||\n                            def.isPushable ||\n                            (def.name && def.name.toLowerCase().includes('entities.'))\n                        );\n\n                        if (isEntity) {\n                            initialEntities.push({\n                                id: `entity_${idx}_${Date.now()}_${idx}`,\n                                defId: id,\n                                def: def,\n                                x: (idx % mapW) * TILE_SIZE,\n                                y: Math.floor(idx / mapW) * TILE_SIZE,\n                                width: (Number(def.width) || 1) * TILE_SIZE,\n                                height: (Number(def.height) || 1) * TILE_SIZE,\n                                vx: 0,\n                                vy: 0,\n                                health: def.maxHealth || 100,\n                                direction: def.subtype === 'platform' ? 1 : (def.isPushable ? 1 : -1),\n                                animation: (def.subtype === 'platform' || def.isPushable) ? 'idle' : 'move',\n                                animFrame: 0,\n                                animTimer: 0,\n                                isGrounded: false,\n                                shootCooldown: 0,\n                                currentSpriteIndex: 0,\n                                subtype: def.subtype || (def.isPushable ? 'pushable' : null),\n                                rotation: def.isRound ? 0 : undefined\n                            });\n                        }\n                    }\n                });\n            }\n            entitiesRef.current = initialEntities;\n\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // 1. Priority: spawnTriggerId hint (from inter-map teleport)\n                const spawnTriggerId = mapData.meta?.spawnTriggerId;\n                let startIndex = -1;\n\n                if (spawnTriggerId !== undefined && spawnTriggerId !== null) {\n                    startIndex = objLayer.data.findIndex((id, idx) => {\n                        if (!id || (!id.includes('target') && id !== 'portal_target')) return false;\n                        const meta = objectMetadataRef.current?.[idx] || mapData.meta?.objectMetadata?.[idx];\n                        return meta && meta.triggerId === spawnTriggerId;\n                    });\n                }\n\n                // 2. Fallback: Search for player (anything containing 'player')\n                if (startIndex === -1) {\n                    startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n                }\n\n                if (startIndex !== -1 || mapData.meta?.activeMapType === 'sea_rescue') {\n                    let startX = startIndex !== -1 ? (startIndex % mapW) * TILE_SIZE : 0;\n                    let startY = startIndex !== -1 ? Math.floor(startIndex / mapW) * TILE_SIZE : 0;\n\n                    // Get data from registry\n                    const playerId = startIndex !== -1 ? objLayer.data[startIndex] : \"player\";\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    \n                    if (mapData.meta?.activeMapType === 'sea_rescue') {\n                        // For sea rescue, we might want a different starting position or dummy player\n                        // Let's use the playerPosition from meta if available\n                        if (mapData.meta?.playerPosition) {\n                            startX = mapData.meta.playerPosition.x * TILE_SIZE;\n                            startY = mapData.meta.playerPosition.y * TILE_SIZE;\n                        }\n                    }\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    const prevAmmo = Math.max(0, Number(gameState.current?.ammo) || 0);\n                    const prevFishCount = Math.max(0, Number(gameState.current?.fishCount) || 0);\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: prevAmmo,\n                        fishCount: prevFishCount,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: Number(registryPlayer?.strength) || 30,\n                        maxStrength: Number(registryPlayer?.maxStrength) || 100,\n                        lastPushTime: 0,\n                        isWinning: false,\n                        winCounter: 0\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    const pW = gameState.current.width || TILE_SIZE;\n                    const pH = gameState.current.height || TILE_SIZE;\n                    while (checkCollision(gameState.current.x, gameState.current.y, undefined, undefined, pW, pH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST,\n                        radioactivity: MAX_RADIOACTIVITY * 0.2,\n                        maxRadioactivity: MAX_RADIOACTIVITY,\n                        strength: 30,\n                        maxStrength: 100,\n                        lastPushTime: 0\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST,\n                    radioactivity: MAX_RADIOACTIVITY * 0.2,\n                    maxRadioactivity: MAX_RADIOACTIVITY,\n                    strength: 30,\n                    maxStrength: 100,\n                    lastPushTime: 0\n                };\n                setPlayer({ ...gameState.current, projectiles: [], entities: entitiesRef.current });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]); // objectData removed - item collection shouldn't trigger re-initialization\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mw, mh, w, h, ignoreEntityId) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE,\n            tileDataRef.current || tileData,\n            registryItems,\n            w !== undefined ? w : gameState.current.width,\n            h !== undefined ? h : gameState.current.height,\n            secretDataRef.current || secretData,\n            objectDataRef.current || objectData,\n            objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreEntityId || null,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mw, mh, TILE_SIZE_OVERRIDE, tileDataOverride, registryItemsOverride, secretDataOverride, objectDataOverride, objectMetadataOverride, ignoreId) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mw !== undefined ? mw : (mapWidthRef.current || 20),\n            mh !== undefined ? mh : (mapHeightRef.current || 15),\n            TILE_SIZE_OVERRIDE || TILE_SIZE,\n            tileDataOverride || tileDataRef.current || tileData,\n            registryItemsOverride || registryItems,\n            secretDataOverride || secretDataRef.current || secretData,\n            objectDataOverride || objectDataRef.current || objectData,\n            objectMetadataOverride || objectMetadataRef.current || mapData?.meta?.objectMetadata,\n            entitiesRef.current,\n            ignoreId,\n            mapData?.maps,\n            activeRoomIdsRef.current || mapData?.meta?.activeRoomIds\n        );\n    };\n\n    // New: liquid type check at a world pixel\n    const getLiquidTypeAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        const liq = getLiquidAtPixel(wx, wy, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileData, registryItems);\n        return liq ? liq.type : null;\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthRef.current || 20,\n            mapHeight: mapHeightRef.current || 15,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction, ownerId = 'player') => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction, ownerId);\n    };\n\n    const engineRefs = useRef({ \n        gameState, \n        isInitialized, \n        lastTimeRef, \n        projectilesRef, \n        entitiesRef, \n        shootCooldownRef, \n        liquidDamageAccumulatorRef, \n        oxygenDepleteAccRef, \n        lavaDepleteAccRef, \n        weatherDamageAccRef, \n        activeRoomIdsRef,\n        soundEnabledRef,\n        ambientAudioRef,\n        projectileIdRef,\n        objectMetadata: objectMetadataRef,\n        cameraRef: { x: 0, y: 0 },\n        seaRescueRef: null,\n        fx: {\n            triggerSplash: null,\n            triggerBubbles: null\n        },\n        helpers: { findItemById, isSolidAtPixel }\n    });\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData: objectDataRef.current,\n            input,\n            refs: engineRefs.current,\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            registryItems,\n            helpers: {\n                checkCollision,\n                isSolidAtPixel,\n                findItemById,\n                getSurfaceProperties: (x, y, w, h) => getSurfaceProperties(x, y, w, h, mapWidthRef.current || 20, mapHeightRef.current || 15, TILE_SIZE, tileDataRef.current, registryItems, secretDataRef.current, objectMetadataRef.current || mapData?.meta?.objectMetadata, mapData?.maps, activeRoomIdsRef.current || mapData?.meta?.activeRoomIds),\n                isLiquidAt: (wx, wy) => getLiquidTypeAtPixel(wx, wy),\n                getLiquidSample: ({ x, y, width, height }) =>\n                    sampleLiquid({ x, y, width, height })\n            },\n            actions: {\n                collectItem: (x, y, mw, objectLayer) =>\n                collectItem({\n                    registryItems,\n                    TILE_SIZE,\n                    MAX_HEALTH,\n                    playShotSfx,\n                    onStateUpdate: onStateUpdateRef.current,\n                    gameState,\n                    maps: mapData?.maps,\n                    activeRoomIds: activeRoomIdsRef.current || mapData?.meta?.activeRoomIds,\n                    objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata,\n                    secretMapData: secretDataRef.current || secretData,\n                    activeMapId: mapData?.meta?.activeMapId || mapData?.meta?.activeMap || 'main'\n                }, x, y, mapWidthRef.current || 20, objectDataRef.current),\n                checkInteractables: (x, y, mw, mh, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate: onStateUpdateRef.current, gameState, mapData, input, activeRoomIds: activeRoomIdsRef.current, objectMetadata: objectMetadataRef.current, secretMapData: secretDataRef.current || secretData }, x, y, mapWidthRef.current || 20, mapHeightRef.current || 15, objectDataRef.current),\n                checkHazardDamage: (x, y, mw, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidthRef.current || 20, objectDataRef.current, deltaMs),\n                checkSecrets: (x, y, width, height, mw, mh) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                spawnProjectile: (originX, originY, direction, ownerId) =>\n                    spawnProjectile(originX, originY, direction, ownerId),\n                playSfx: (url, volume) => playShotSfx(url, volume),\n                updateProjectiles: (deltaMs, mw, mh) =>\n                    updateProjectiles({ \n                        projectilesRef, \n                        entitiesRef,\n                        playerState: gameState.current,\n                        TILE_SIZE, \n                        isSolidAtPixel, \n                        findItemById, \n                        objectData: objectDataRef.current, \n                        objectMetadata: objectMetadataRef.current || mapData?.meta?.objectMetadata, \n                        tileData: tileDataRef.current || tileData,\n                        secretData: secretDataRef.current || secretData,\n                        registryItems,\n                        onStateUpdate: onStateUpdateRef.current,\n                        playSfx: playShotSfx,\n                        getLiquidSample: (args) => sampleLiquid(args),\n                        refs: engineRefs.current,\n                        mapData\n                    }, deltaMs, mapWidthRef.current || 20, mapHeightRef.current || 15),\n                onStateUpdate: onStateUpdateRef.current,\n                setPlayer: (next) => setPlayer(next),\n                onGameOver: onGameOverRef.current\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        if (!mapData) return;\n        requestRef.current = requestAnimationFrame(update);\n        return () => {\n            if (requestRef.current) cancelAnimationFrame(requestRef.current);\n        };\n    }, [mapData]); // Restart loop ONLY if map changes, not objects\n\n    return { player, input, engineRefs: engineRefs.current };\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false,\n        mousePos: { x: 0, y: 0 },\n        e: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n            keys.current.e = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'KeyE':\n                    keys.current.e = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'KeyE':\n                    keys.current.e = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const handleMouseMove = (e) => {\n            keys.current.mousePos.x = e.clientX;\n            keys.current.mousePos.y = e.clientY;\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n        window.addEventListener('mousemove', handleMouseMove, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n            window.removeEventListener('mousemove', handleMouseMove, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","import { getMeteorBreakEffectConfig } from './meteorBreakEffects';\nimport { getBiologicalBreakEffectConfig } from './biologicalBreakEffects';\n\n/**\n * Handles weather effect impacts like meteor strikes, lightning, etc.\n * This logic is decoupled from useGameEngine to allow for easier expansion.\n */\nexport const handleWeatherEffectHit = (type, data, context) => {\n    if (!type || !data || !context) return;\n    const { gameState, entitiesRef, onBreakEffect } = context;\n\n    if (type === 'meteor') {\n        const { x, y, size, isLarge, surfaceType } = data;\n        const damage = isLarge ? 40 : 20;\n        const radius = size * 1.5;\n\n        // 1. Check player impact\n        if (gameState && gameState.current) {\n            const p = gameState.current;\n            const dx = (p.x + p.width / 2) - x;\n            const dy = (p.y + p.height / 2) - y;\n            const dist = Math.sqrt(dx * dx + dy * dy);\n\n            if (dist < radius + p.width / 2) {\n                gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - damage);\n                gameState.current.hitTimerMs = 500;\n                // Add knockback\n                if (dist > 0) {\n                    gameState.current.vx += (dx / dist) * 10;\n                    gameState.current.vy -= 5;\n                } else {\n                    gameState.current.vy -= 10; // direct hit\n                }\n            }\n        }\n\n        // 2. Check entities impact\n        if (entitiesRef && entitiesRef.current) {\n            entitiesRef.current.forEach(ent => {\n                const isFish = ent.def?.subtype === 'fish' || ent.def?.ai?.type === 'fish' || ent.def?.fish;\n                const edx = (ent.x + ent.width / 2) - x;\n                const edy = (ent.y + ent.height / 2) - y;\n                const edist = Math.sqrt(edx * edx + edy * edy);\n\n                const prevHealth = Number(ent.health) || 0;\n                const inDamageRadius = edist < radius + ent.width / 2;\n                if (inDamageRadius) {\n                    ent.health = Math.max(0, prevHealth - damage);\n                    // Platforms don't take knockback, but others might\n                    if (ent.subtype !== 'platform') {\n                        if (edist > 0) {\n                            ent.vx += (edx / edist) * 8;\n                            ent.vy -= 3;\n                        } else {\n                            ent.vy -= 6;\n                        }\n                    }\n                }\n\n                if (isFish) {\n                    const cfg = ent.def?.fish || {};\n                    const shockRadius = (Number(cfg.meteorShockRadius) || 0) * (context?.TILE_SIZE || 32);\n                    if (shockRadius > 0 && edist <= shockRadius) {\n                        ent.fishState = ent.fishState || {};\n                        ent.fishState.shockUntil = (Number(gameState?.current?.timeMs) || 0) + (Number(cfg.meteorShockDurationMs) || 1800);\n                    }\n                    const wasDead = prevHealth <= 0;\n                    if (wasDead && ent.health <= 0 && inDamageRadius) {\n                        const now = Number(gameState?.current?.timeMs) || 0;\n                        ent.fishState = ent.fishState || {};\n                        const lastFx = Number(ent.fishState.lastBioFxAt) || 0;\n                        const alreadyQueued = !!ent.fishState.removeOnNext;\n                        if (!alreadyQueued && now - lastFx > 200) {\n                            const bioConfig = getBiologicalBreakEffectConfig();\n                            if (bioConfig && typeof onBreakEffect === 'function') {\n                                onBreakEffect({ x: ent.x + ent.width / 2, y: ent.y + ent.height / 2, config: bioConfig });\n                            }\n                            ent.fishState.lastBioFxAt = now;\n                            ent.fishState.removeOnNext = true;\n                        }\n                    }\n                }\n            });\n        }\n\n        const breakConfig = getMeteorBreakEffectConfig({ size, surfaceType });\n        if (breakConfig && typeof onBreakEffect === 'function') {\n            onBreakEffect({ x, y, config: breakConfig });\n        }\n    }\n\n    // Future weather types can be added here\n    // e.g., if (type === 'lightning') { ... }\n};\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction, ownerId = 'player') {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    ownerId, // Tagad ms zinm, kur izva\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag,\n    dmg: pDef?.damage || 10\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx, getLiquidSample, refs, mapData }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, entitiesRef, playerState, TILE_SIZE, isSolidAtPixel, findItemById, objectData, objectMetadata, tileData, secretData, registryItems, onStateUpdate, playSfx, getLiquidSample, refs, mapData } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n  const nowMs = Number(playerState?.timeMs) || 0;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n\n    const shipOffset = (playerState && (mapData?.meta?.activeMapType === 'sea_rescue' || \n                         (mapData?.maps && mapData.maps[mapData.meta?.activeMapId || 'main']?.type === 'sea_rescue'))) \n                       ? (playerState.x || 0) : 0;\n\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n      \n      if (shipOffset !== 0) {\n        if (isSolidAtPixel(pt.x - shipOffset, pt.y, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems, secretData, objectData, objectMetadata)) return true;\n      }\n    }\n    return false;\n  };\n\n  const getDestructibleIndex = (gx, gy) => {\n    if (!objectData) return null;\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return null;\n    const index = gy * mapWidth + gx;\n    const objId = objectData[index];\n    if (!objId) return null;\n    const def = findItemById(objId);\n    if (!def || !def.isDestructible) return null;\n    const currentMeta = objectMetadata?.[index] || {};\n    const maxHealth = def.maxHealth || 100;\n    const health = currentMeta.health !== undefined ? currentMeta.health : maxHealth;\n    const threshold = def.passableHealthThreshold || 0;\n    if (health <= threshold) return null;\n    return index;\n  };\n\n  const checkObjectHit = (cx, cy, hw, hh, isSeaRescueBox = false) => {\n    if (!objectData) return null;\n    const pts = [\n        { x: cx - hw, y: cy - hh },\n        { x: cx + hw, y: cy - hh },\n        { x: cx - hw, y: cy + hh },\n        { x: cx + hw, y: cy + hh },\n        { x: cx, y: cy }\n    ];\n\n    const shipOffset = (playerState && (mapData.meta?.activeMapType === 'sea_rescue' || \n                         (mapData.maps && mapData.maps[mapData.meta?.activeMapId || 'main']?.type === 'sea_rescue'))) \n                       ? (playerState.x || 0) : 0;\n\n    for (const pt of pts) {\n        // 1. Check static objects (Boxes in water)\n        const gx = Math.floor(pt.x / TILE_SIZE);\n        const gy = Math.floor(pt.y / TILE_SIZE);\n        if (gx >= 0 && gy >= 0 && gx < mapWidth && gy < mapHeight) {\n            const index = gy * mapWidth + gx;\n            const objId = objectData[index];\n            if (objId && objId.startsWith('minispill_sea_rescue_box')) {\n                const def = findItemById(objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata?.[index] || {};\n                    const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                    if (health > (def.passableHealthThreshold || 0)) return index;\n                }\n            }\n        }\n\n        // Destructible objects (wooden box, crack block, etc.)\n        if (!isSeaRescueBox) {\n            const destructibleIdx = getDestructibleIndex(gx, gy);\n            if (destructibleIdx !== null) return destructibleIdx;\n        }\n\n        // 2. Check moving objects (Ship & Triggers)\n        const sgx = Math.floor((pt.x - shipOffset) / TILE_SIZE);\n        const sgy = Math.floor(pt.y / TILE_SIZE);\n        if (sgx >= 0 && sgy >= 0 && sgx < mapWidth && sgy < mapHeight) {\n            const sindex = sgy * mapWidth + sgx;\n            const sobjId = objectData[sindex];\n            if (sobjId === 'minispill_sea_rescue_trigger' || sobjId === 'minispill_sea_rescue_ship') {\n                if (isSeaRescueBox && sobjId === 'minispill_sea_rescue_trigger') {\n                    return sindex;\n                }\n                const def = findItemById(sobjId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata?.[sindex] || {};\n                    const health = currentMeta.health !== undefined ? currentMeta.health : def.maxHealth;\n                    if (health > (def.passableHealthThreshold || 0)) return sindex;\n                }\n            }\n        }\n    }\n    return null;\n  };\n\n  const checkEntityHit = (cx, cy, hw, hh, p) => {\n    if (!entitiesRef?.current) return null;\n    for (const ent of entitiesRef.current) {\n        if (ent.health <= 0 || ent.isExploding) continue;\n        if (ent.id === p.ownerId) continue; // Ignorjam izvju\n\n        const ex = ent.x;\n        const ey = ent.y;\n        const ew = ent.width;\n        const eh = ent.height;\n        if (cx + hw > ex && cx - hw < ex + ew &&\n            cy + hh > ey && cy - hh < ey + eh) {\n            return ent;\n        }\n    }\n    return null;\n  };\n\n  const checkPlayerHit = (cx, cy, hw, hh, p) => {\n    if (!playerState || p.ownerId === 'player') return false; // Ignorjam, ja izva spltjs\n    \n    const ex = playerState.x;\n    const ey = playerState.y;\n    const ew = playerState.width || TILE_SIZE;\n    const eh = playerState.height || TILE_SIZE;\n    if (cx + hw > ex && cx - hw < ex + ew &&\n        cy + hh > ey && cy - hh < ey + eh) {\n        return true;\n    }\n    return false;\n  };\n\n  const getWaterSurfaceY = (x) => {\n    if (!tileData || mapWidth <= 0 || mapHeight <= 0) return null;\n    const gx = Math.floor(x / TILE_SIZE);\n    if (gx < 0 || gx >= mapWidth) return null;\n    for (let gy = 0; gy < mapHeight; gy++) {\n      const idx = gy * mapWidth + gx;\n      const id = tileData[idx];\n      if (!id) continue;\n      const def = findItemById(id);\n      if (!def || !def.flags || !def.flags.liquid) continue;\n      if (def.flags.water || def.flags.waterfall) {\n        return gy * TILE_SIZE;\n      }\n    }\n    return null;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    let removed = false;\n\n    if (p.isSeaRescueBox) {\n      const settings = findItemById('sea_rescue_settings')?.physics || {};\n      const maxHeight = settings.maxFlightHeight || -10000;\n      // Boundaries check for sea rescue boxes - allow much more space\n      if (cx < -p.w - 1000 || cx > worldW + p.w + 1000 || cy < maxHeight || cy > worldH + 2000) {\n        removed = true;\n        projectilesRef.current.splice(i, 1);\n        continue;\n      }\n      if (p.floating) {\n        // Floating/Sinking logic\n        p.floatTime = (p.floatTime || 0) + deltaMs;\n        const boxDef = findItemById(p.defId);\n        const floatMax = boxDef?.floatingDurationMs || 4000;\n        \n        const driftSettings = findItemById('sea_rescue_settings')?.drift || {};\n        const driftSpeed = driftSettings.speed || 0.002;\n        const driftAmp = driftSettings.amplitude || 5;\n\n        if (p.floatTime < floatMax) { // Float for configurable time\n            if (p.baseY === undefined) p.baseY = p.y;\n            const targetY = p.baseY + Math.sin(p.floatTime * driftSpeed) * driftAmp;\n            p.vy = (targetY - p.y) / dtProj;\n            p.vx *= 0.92; // Slow down horizontal movement\n            p.rotation = Math.sin(p.floatTime * driftSpeed * 0.5) * 0.1; // Balanced tilt\n        } else {\n            p.vy = 60; // Start sinking\n            p.vx *= 0.98;\n            p.rotation = (p.rotation || 0) + 0.02;\n        }\n        p.x += p.vx * dtProj;\n        p.y += p.vy * dtProj;\n        \n        p.life -= deltaMs;\n\n        // Remove if off-map or expired\n        if (p.y > worldH + 2000 || p.life <= 0) removed = true;\n        if (removed) {\n            projectilesRef.current.splice(i, 1);\n        }\n        continue; // Skip standard movement\n      }\n\n      if (p.useSimplePhysics) {\n        // Simple physics matching trajectory preview (no friction, constant G)\n        const settings = findItemById('sea_rescue_settings')?.physics || {};\n        const G = p.gravity || settings.gravity || 1600;\n        p.vy += G * dtProj; // Use dtProj here for gravity step\n      } else {\n        p.vy += (p.gravity || 0.5) * 60 * dtProj;\n        p.vx *= (p.friction || 0.98);\n        p.vy *= (p.friction || 0.98);\n      }\n    }\n\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    const isFishEntity = (ent) => {\n      if (!ent) return false;\n      const subtype = ent.subtype || ent.def?.subtype;\n      const aiType = ent.def?.ai?.type;\n      return subtype === 'fish' || aiType === 'fish' || !!ent.def?.fish;\n    };\n\n    for (let s = 0; s < steps; s++) {\n      // Check if entering water (for Sea Rescue Boxes)\n      if (p.isSeaRescueBox && getLiquidSample && !p.floating && p.vy > 0) {\n          const sample = getLiquidSample({ x: cx, y: cy, width: p.w, height: p.h });\n          if (sample?.inLiquid && sample?.type?.includes('water')) {\n              p.floating = true;\n              p.floatTime = 0;\n\n              // Snap to surface for 50/50 visual effect\n              const surfaceY = getWaterSurfaceY(cx);\n              if (surfaceY !== null) {\n                  p.y = surfaceY;\n                  p.baseY = surfaceY;\n                  cy = surfaceY;\n              }\n\n              const inSound = findItemById(p.defId)?.sounds?.water_in || \"/assets/sound/sfx/water/out_splash-4-46870.ogg\";\n              if (playSfx) playSfx(inSound, 0.6);\n              if (refs?.fx?.triggerSplash) refs.fx.triggerSplash(cx, cy);\n              // Stop stepping, but DON'T set removed=true\n              break;\n          }\n      }\n      // Sea Rescue hit detection\n      if (p.isSeaRescueBox) {\n          const objIdx = checkObjectHit(cx, cy, hw, hh, true);\n          if (objIdx !== null) {\n              const hitObjId = objectData[objIdx];\n              if (hitObjId === 'minispill_sea_rescue_trigger' && p.vy > 0) {\n                  const boxDef = findItemById(p.defId);\n                  const points = boxDef?.points || 10;\n                  \n                  if (typeof onStateUpdate === 'function') {\n                      onStateUpdate('SEA_RESCUE_SCORE', { points, triggerIndex: objIdx, boxId: p.defId });\n                  }\n                  \n                  if (typeof playSfx === 'function') {\n                      const collectSfx = \"/assets/sound/sfx/zzox-fx_nite-hit-item.ogg\";\n                      playSfx(collectSfx, 0.7);\n                  }\n                  \n                  removed = true;\n                  break;\n              }\n          }\n      }\n\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n\n      const hitEntX = checkEntityHit(nextX, cy, hw, hh, p);\n      if (hitEntX) {\n        const isFish = isFishEntity(hitEntX);\n        \n        if (p.isSeaRescueBox) {\n            if (isFish) {\n                hitEntX.fishState = hitEntX.fishState || {};\n                const hitCooldown = 500;\n                const canPlaySound = !hitEntX.fishState.lastHitAt || (nowMs - hitEntX.fishState.lastHitAt > hitCooldown);\n                const settings = findItemById('sea_rescue_settings')?.physics || {};\n                const fishJumpImpulse = settings.fishJumpImpulse || -600;\n\n                if (p.vy > 0 && p.y < hitEntX.y) {\n                    hitEntX.health = 0;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntX.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\", 0.5);\n                        hitEntX.fishState.lastHitAt = nowMs;\n                    }\n                } else if (p.vy < 0) {\n                    hitEntX.attachedToProjectileId = p.id;\n                    hitEntX.fishState.isAttached = true;\n                    hitEntX.fishState.isJumping = false; // Stop jumping if attached\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntX.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntX.fishState.lastHitAt = nowMs;\n                    }\n                } else {\n                    hitEntX.fishState.isJumping = true;\n                    hitEntX.fishState.jumpVx = -p.vx * 0.5;\n                    hitEntX.fishState.jumpVy = -Math.abs(p.vy) * 0.5 + fishJumpImpulse;\n                    hitEntX.fishState.jumpGravity = 900;\n                    hitEntX.fishState.panicUntil = nowMs + 5000;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntX.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntX.fishState.lastHitAt = nowMs;\n                    }\n                }\n            }\n            // Sea Rescue boxes should NOT disappear when hitting entities\n            cx = nextX;\n            continue; \n        }\n\n        hitEntX.health -= p.dmg || 10;\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntX.x + hitEntX.width / 2,\n            y: hitEntX.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxX = !p.isSeaRescueBox ? checkObjectHit(nextX, cy, hw, hh) : null;\n      if (hitIdxX !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxX, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      \n      const hitPlayerY = checkPlayerHit(cx, nextY, hw, hh, p);\n      if (hitPlayerY) {\n        if (playerState) {\n          playerState.health = Math.max(0, (Number(playerState.health) || 0) - (p.dmg || 10));\n        }\n        if (onStateUpdate && playerState) {\n          onStateUpdate('playerDamage', {\n            damage: p.dmg || 10,\n            x: playerState.x + (playerState.width || TILE_SIZE) / 2,\n            y: playerState.y\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitEntY = checkEntityHit(cx, nextY, hw, hh, p);\n      if (hitEntY) {\n        const isFish = isFishEntity(hitEntY);\n        \n        if (p.isSeaRescueBox) {\n            if (isFish) {\n                hitEntY.fishState = hitEntY.fishState || {};\n                const hitCooldown = 500;\n                const canPlaySound = !hitEntY.fishState.lastHitAt || (nowMs - hitEntY.fishState.lastHitAt > hitCooldown);\n                const settings = findItemById('sea_rescue_settings')?.physics || {};\n                const fishJumpImpulse = settings.fishJumpImpulse || -600;\n\n                if (p.vy > 0 && p.y < hitEntY.y) {\n                    hitEntY.health = 0;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntY.def?.sounds?.hit || \"/assets/sound/sfx/dammage/hit-flesh-03-266308.ogg\", 0.5);\n                        hitEntY.fishState.lastHitAt = nowMs;\n                    }\n                } else if (p.vy < 0) {\n                    hitEntY.attachedToProjectileId = p.id;\n                    hitEntY.fishState.isAttached = true;\n                    hitEntY.fishState.isJumping = false; // Stop jumping if attached\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntY.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntY.fishState.lastHitAt = nowMs;\n                    }\n                } else {\n                    hitEntY.fishState.isJumping = true;\n                    hitEntY.fishState.jumpVx = -p.vx * 0.5;\n                    hitEntY.fishState.jumpVy = -Math.abs(p.vy) * 0.5 + fishJumpImpulse;\n                    hitEntY.fishState.jumpGravity = 900;\n                    hitEntY.fishState.panicUntil = nowMs + 5000;\n                    if (playSfx && canPlaySound) {\n                        playSfx(hitEntY.def?.sounds?.water_out || \"/assets/sound/sfx/water/in_fish-splashing-release-1-96870.ogg\", 0.5);\n                        hitEntY.fishState.lastHitAt = nowMs;\n                    }\n                }\n            }\n            // Sea Rescue boxes should NOT disappear when hitting entities\n            cy = nextY;\n            continue; \n        }\n\n        hitEntY.health -= p.dmg || 10;\n        if (onStateUpdate) {\n          onStateUpdate('entityDamage', {\n            x: hitEntY.x + hitEntY.width / 2,\n            y: hitEntY.y,\n            amount: p.dmg || 10\n          });\n        }\n        removed = true;\n        break;\n      }\n\n      const hitIdxY = !p.isSeaRescueBox ? checkObjectHit(cx, nextY, hw, hh) : null;\n      if (hitIdxY !== null) {\n        if (onStateUpdate) onStateUpdate('objectDamage', { index: hitIdxY, damage: p.dmg || 10 });\n        removed = true;\n        break;\n      }\n\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    if (p.isSeaRescueBox) {\n        p.life -= deltaMs;\n        if (removed || p.life <= 0) {\n            projectilesRef.current.splice(i, 1);\n        }\n        continue;\n    }\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className, spriteSheet, frameIndex }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    // Ja ir spraitts, rdm tikai pirmo kadru (vai citu, ja nordts)\n    if (spriteSheet && spriteSheet.enabled) {\n        const columns = spriteSheet.columns || 1;\n        const total = spriteSheet.totalSprites || 1;\n        const rows = Math.ceil(total / columns);\n        \n        // Editor parasti rdm pirmo kadru (index 0) vai nordto kadru\n        const fallbackFrame = spriteSheet && Number.isFinite(Number(spriteSheet.frameIndex)) ? Number(spriteSheet.frameIndex) : 0;\n        const currentFrame = frameIndex !== undefined ? frameIndex : fallbackFrame;\n        const col = currentFrame % columns;\n        const row = Math.floor(currentFrame / columns);\n\n        return (\n            <div className={className} style={{\n                ...style,\n                overflow: 'hidden',\n                display: 'inline-block',\n                width: style?.width || '32px',\n                height: style?.height || '32px',\n                position: 'relative'\n            }}>\n                <img\n                    src={imgSrc}\n                    alt={alt || ''}\n                    style={{\n                        position: 'absolute',\n                        width: `${columns * 100}%`,\n                        height: `${rows * 100}%`,\n                        left: `-${col * 100}%`,\n                        top: `-${row * 100}%`,\n                        maxWidth: 'none',\n                        maxHeight: 'none',\n                        display: 'block'\n                    }}\n                    draggable={false}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false}\n        />\n    );\n};\n\nexport default AnimatedItem;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport fireballA from '../../../assets/images/items/fireball_basic_A.png';\nimport fireballB from '../../../assets/images/items/fireball_basic_B.png';\nimport fireballC from '../../../assets/images/items/fireball_basic_C.png';\nimport fireballD from '../../../assets/images/items/fireball_basic_D.png';\nimport fishSprite from '../../../assets/images/entities/animals/fish_01.png';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: auto;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nconst FishDisplay = styled(AmmoDisplay)`\n    color: rgba(140, 230, 255, 0.95);\n`;\n\nconst SeaRescueDisplay = styled(AmmoDisplay)`\n    color: #00ff00;\n`;\n\nconst AmmoIcon = styled.span`\n    width: 22px;\n    height: 22px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    image-rendering: pixelated;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    //gap: 8px;\n`;\n\nconst BarsContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    //gap: 1px;\n    width: 250px;\n    padding-top: 5px;\n    padding-bottom: 5px;\n   // border: solid 1px red;\n`;\n\nconst BarRow = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n`;\n\nconst BarWrapper = styled.div`\n    flex: 1;\n    height: 6px;\n    background-color: rgba(0, 0, 0, 0.5);\n    border: 1px solid rgba(255, 255, 255, 0.4);\n    position: relative;\n    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\n`;\n\nconst BarFill = styled.div.attrs(props => ({\n    style: {\n        width: `${props.$percent}%`,\n        backgroundColor: props.$color,\n    },\n}))`\n    height: 100%;\n    transition: width 0.3s ease;\n`;\n\nconst BarLabel = styled.div`\n    width: 60px;\n    font-size: 8px;\n    color: white;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px black;\n    pointer-events: none;\n    white-space: nowrap;\n    text-transform: uppercase;\n    text-align: right;\n`;\n\nconst GameHeader = ({ \n    health, \n    maxHealth = 100, \n    ammo = 0, \n    fishCount = 0,\n    seaRescuePoints = 0,\n    mapType = 'overworld',\n    oxygen = 100, \n    maxOxygen = 100, \n    lavaResist = 100, \n    maxLavaResist = 100,\n    iceResist = 100,\n    maxIceResist = 100,\n    strength = 30,\n    maxStrength = 100,\n    radioactivity = 20,\n    maxRadioactivity = 100,\n    inWater = false,\n    liquidType = null,\n    onIce = false\n}) => {\n    const hpPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));\n    const oxyPercent = Math.max(0, Math.min(100, (oxygen / maxOxygen) * 100));\n    const lavaPercent = Math.max(0, Math.min(100, (lavaResist / maxLavaResist) * 100));\n    const icePercent = Math.max(0, Math.min(100, (iceResist / maxIceResist) * 100));\n    const strengthPercent = Math.max(0, Math.min(100, (strength / maxStrength) * 100));\n    const radioPercent = Math.max(0, Math.min(100, (radioactivity / maxRadioactivity) * 100));\n    const fireballFrames = [fireballA, fireballB, fireballC, fireballD, fireballC, fireballB];\n\n    return (\n        <HeaderContainer>\n            <div style={{ display: 'flex', gap: '14px', alignItems: 'center' }}>\n                <AmmoDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            textures={fireballFrames}\n                            speed={300}\n                            alt=\"Fireball ammo\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {ammo || 0}\n                </AmmoDisplay>\n                <FishDisplay>\n                    <AmmoIcon>\n                        <AnimatedItem\n                            texture={fishSprite}\n                            spriteSheet={{ enabled: true, columns: 2, totalSprites: 3, frameIndex: 0 }}\n                            alt=\"Fish\"\n                            style={{ width: '22px', height: '22px', imageRendering: 'pixelated' }}\n                        />\n                    </AmmoIcon>\n                    {fishCount || 0}\n                </FishDisplay>\n                {mapType === 'sea_rescue' && (\n                    <SeaRescueDisplay style={{ marginLeft: '15px' }}>\n                        Points: {seaRescuePoints}\n                    </SeaRescueDisplay>\n                )}\n            </div>\n\n            <RightSection>\n                <BarsContainer>\n                    {/* HP Bar */}\n                    <BarRow>\n                        <BarLabel>HP</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={hpPercent} $color=\"#ff3232\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Oxygen Bar */}\n                    <BarRow>\n                        <BarLabel>OZ</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={oxyPercent} $color=\"#2ecdf1\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Lava Bar */}\n                    <BarRow>\n                        <BarLabel>LAVA</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={lavaPercent} $color=\"#ffcc00\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Ice Bar */}\n                    <BarRow>\n                        <BarLabel>ICE</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={icePercent} $color=\"#a5f3fc\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Strength Bar */}\n                    <BarRow>\n                        <BarLabel>STRNGTH</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={strengthPercent} $color=\"#8b5a2b\" />\n                        </BarWrapper>\n                    </BarRow>\n\n                    {/* Radioactivity Bar */}\n                    <BarRow>\n                        <BarLabel>RADIO</BarLabel>\n                        <BarWrapper>\n                            <BarFill $percent={radioPercent} $color=\"#32cd32\" />\n                        </BarWrapper>\n                    </BarRow>\n                </BarsContainer>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    maxHealth: PropTypes.number,\n    ammo: PropTypes.number,\n    fishCount: PropTypes.number,\n    oxygen: PropTypes.number,\n    maxOxygen: PropTypes.number,\n    lavaResist: PropTypes.number,\n    maxLavaResist: PropTypes.number,\n    iceResist: PropTypes.number,\n    maxIceResist: PropTypes.number,\n    strength: PropTypes.number,\n    maxStrength: PropTypes.number,\n    radioactivity: PropTypes.number,\n    maxRadioactivity: PropTypes.number,\n    inWater: PropTypes.bool,\n    liquidType: PropTypes.string,\n    onIce: PropTypes.bool\n};\n\nexport default GameHeader;\n","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\n// Built-in: debug overlay toggle\nregister({\n  name: 'debug',\n  description: \"Toggle debug overlay: debug [on|off|toggle]\",\n  handler({ args }) {\n    const mode = (args && args[0]) ? String(args[0]).toLowerCase() : 'toggle';\n    const current = !!(window.__GAME_RUNTIME_SETTINGS__ && window.__GAME_RUNTIME_SETTINGS__.debugOverlayEnabled);\n    const next = (mode === 'on') ? true : (mode === 'off' ? false : !current);\n    try {\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        debugOverlayEnabled: next\n      };\n      try { localStorage.setItem('game_debug_overlay', next ? '1' : '0'); } catch {}\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: { debugOverlayEnabled: next } }));\n    } catch {}\n    return `Debug overlay ${next ? 'enabled' : 'disabled'}.`;\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Lava Rain (0..100)\n  const [lavaRain, setLavaRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_lavarain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherLavaRain === 'number') return Math.max(0, Math.min(100, g.weatherLavaRain));\n    } catch {}\n    return 0;\n  });\n  // New: Radioactive Fog (0..100)\n  const [radioactiveFog, setRadioactiveFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_radioactivefog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRadioactiveFog === 'number') return Math.max(0, Math.min(100, g.weatherRadioactiveFog));\n    } catch {}\n    return 0;\n  });\n  // New: Meteor Rain (0..100)\n  const [meteorRain, setMeteorRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_meteorrain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherMeteorRain === 'number') return Math.max(0, Math.min(100, g.weatherMeteorRain));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [debugOverlayEnabled, setDebugOverlayEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_debug_overlay');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.debugOverlayEnabled === 'boolean') return g.debugOverlayEnabled;\n    } catch {}\n    return false;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [roomBlurEnabled, setRoomBlurEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_graphics_room_blur');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.roomBlurEnabled === 'boolean') return g.roomBlurEnabled;\n    } catch {}\n    return true;\n  });\n  const [showCoordinates, setShowCoordinates] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_show_coords');\n      return ls === '1';\n    } catch {}\n    return false;\n  });\n\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Listen for runtime settings updates from game engine or other sources\n  useEffect(() => {\n    const onSettingsUpdate = (e) => {\n      const patch = (e && e.detail) || {};\n      if (patch.weatherRain !== undefined) setRain(patch.weatherRain);\n      if (patch.weatherSnow !== undefined) setSnow(patch.weatherSnow);\n      if (patch.weatherClouds !== undefined) setClouds(patch.weatherClouds);\n      if (patch.weatherFog !== undefined) setFog(patch.weatherFog);\n      if (patch.weatherThunder !== undefined) setThunder(patch.weatherThunder);\n      if (patch.weatherLavaRain !== undefined) setLavaRain(patch.weatherLavaRain);\n      if (patch.weatherRadioactiveFog !== undefined) setRadioactiveFog(patch.weatherRadioactiveFog);\n      if (patch.weatherMeteorRain !== undefined) setMeteorRain(patch.weatherMeteorRain);\n      if (patch.backgroundParallaxFactor !== undefined) setParallax(patch.backgroundParallaxFactor);\n      if (patch.roomBlurEnabled !== undefined) setRoomBlurEnabled(!!patch.roomBlurEnabled);\n      if (patch.healthBarEnabled !== undefined) setHealthBarEnabled(!!patch.healthBarEnabled);\n      if (patch.oxygenBarEnabled !== undefined) setOxygenBarEnabled(!!patch.oxygenBarEnabled);\n      if (patch.lavaBarEnabled !== undefined) setLavaBarEnabled(!!patch.lavaBarEnabled);\n      if (patch.waterSplashesEnabled !== undefined) setWaterSplashesEnabled(!!patch.waterSplashesEnabled);\n      if (patch.lavaEmbersEnabled !== undefined) setLavaEmbersEnabled(!!patch.lavaEmbersEnabled);\n      if (patch.debugOverlayEnabled !== undefined) setDebugOverlayEnabled(!!patch.debugOverlayEnabled);\n    };\n    window.addEventListener('game-settings-update', onSettingsUpdate);\n    return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.roomBlurEnabled === 'boolean') {\n          setRoomBlurEnabled(g.roomBlurEnabled);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.weatherLavaRain === 'number') setLavaRain(Math.max(0, Math.min(100, g.weatherLavaRain)));\n        if (typeof g.weatherRadioactiveFog === 'number') setRadioactiveFog(Math.max(0, Math.min(100, g.weatherRadioactiveFog)));\n        if (typeof g.weatherMeteorRain === 'number') setMeteorRain(Math.max(0, Math.min(100, g.weatherMeteorRain)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n        if (typeof g.debugOverlayEnabled === 'boolean') setDebugOverlayEnabled(!!g.debugOverlayEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  useEffect(() => {\n    try { localStorage.setItem('game_ui_show_coords', showCoordinates ? '1' : '0'); } catch {}\n  }, [showCoordinates]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Blur in Room</label>\n          <input\n            type=\"checkbox\"\n            checked={!!roomBlurEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setRoomBlurEnabled(v);\n              try { localStorage.setItem('game_graphics_room_blur', v ? '1' : '0'); } catch {}\n              emitUpdate({ roomBlurEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Coordinates</label>\n          <input\n            type=\"checkbox\"\n            checked={!!showCoordinates}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setShowCoordinates(v);\n              emitUpdate({ showCoordinates: v });\n            }}\n          />\n        </div>\n        {showCoordinates && (\n          <div style={{ marginTop: 8, padding: '4px 8px', background: 'rgba(0,0,0,0.3)', borderRadius: 4, fontSize: 11, fontFamily: 'monospace', color: '#4ec9b0' }}>\n            Pos: X={Math.round(window.__PLAYER_POS__?.x || 0)}, Y={Math.round(window.__PLAYER_POS__?.y || 0)}\n          </div>\n        )}\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lavas lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(lavaRain) ? lavaRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setLavaRain(v);\n            try { localStorage.setItem('game_weather_lavarain', String(v)); } catch {}\n            emitUpdate({ weatherLavaRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(lavaRain) ? lavaRain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Radioakt. migla</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(radioactiveFog) ? radioactiveFog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRadioactiveFog(v);\n            try { localStorage.setItem('game_weather_radioactivefog', String(v)); } catch {}\n            emitUpdate({ weatherRadioactiveFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(radioactiveFog) ? radioactiveFog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Meteortu lietus</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(meteorRain) ? meteorRain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setMeteorRain(v);\n            try { localStorage.setItem('game_weather_meteorrain', String(v)); } catch {}\n            emitUpdate({ weatherMeteorRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(meteorRain) ? meteorRain : 0}</span>\n      </div>\n    </section>\n  );\n\n  const renderDebug = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Debug</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 160 }}>Show Debug Overlay</label>\n        <input\n          type=\"checkbox\"\n          checked={!!debugOverlayEnabled}\n          onChange={(e) => {\n            const v = !!e.target.checked;\n            setDebugOverlayEnabled(v);\n            try { localStorage.setItem('game_debug_overlay', v ? '1' : '0'); } catch {}\n            emitUpdate({ debugOverlayEnabled: v });\n          }}\n        />\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather','Debug'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n        {activeTab === 'Debug' && renderDebug()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import breakEffectsConfig from '../../assets/json/system/object_break_effects.json';\n\nconst normalizeColor = (c) => {\n  if (typeof c === 'number') return c;\n  if (typeof c === 'string') {\n    const raw = c.trim().replace('#', '');\n    const n = parseInt(raw, 16);\n    return Number.isFinite(n) ? n : 0xffffff;\n  }\n  return 0xffffff;\n};\n\nconst getConfig = () => {\n  if (!breakEffectsConfig || breakEffectsConfig.enabled === false) return null;\n  return breakEffectsConfig;\n};\n\nexport const getBreakEffectParams = (def) => {\n  if (!def) return null;\n  const cfg = getConfig();\n  if (!cfg) return null;\n  const id = def.id;\n  const type = def.type;\n  const subtype = def.subtype;\n  const name = def.name;\n  const ids = Array.isArray(cfg.objectIds) ? cfg.objectIds : [];\n  const types = Array.isArray(cfg.objectTypes) ? cfg.objectTypes : [];\n  const matchesValue = (value, list) => {\n    if (!value) return false;\n    return list.some(item => item === value || value.includes(item));\n  };\n  const matched = matchesValue(id, ids) || matchesValue(name, ids) || matchesValue(type, types) || matchesValue(subtype, types);\n  if (!matched) return null;\n  const base = cfg.default || {};\n  const colors = Array.isArray(base.colors) ? base.colors.map(normalizeColor) : [0xffffff];\n  return {\n    count: Number(base.count) || 12,\n    speed: Number(base.speed) || 2,\n    lifeMs: Number(base.lifeMs) || 600,\n    size: Number(base.size) || 2,\n    colors\n  };\n};\n\nexport const shouldTriggerBreakEffect = (def, newHealth) => {\n  if (!def) return false;\n  const params = getBreakEffectParams(def);\n  if (!params) return false;\n  const threshold = Number(def.passableHealthThreshold ?? 0);\n  const hp = Number(newHealth);\n  if (!Number.isFinite(hp)) return false;\n  return hp <= threshold;\n};\n\nexport default {\n  getBreakEffectParams,\n  shouldTriggerBreakEffect\n};\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\n// - isInsideRoom: boolean  apply muffled effect\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6, isInsideRoom = false }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n  const audioCtxRef = useRef(null);\n  const sourceNodeRef = useRef(null);\n  const filterNodeRef = useRef(null);\n  const gainNodeRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n      if (audioCtxRef.current) {\n        audioCtxRef.current.close().catch(() => {});\n        audioCtxRef.current = null;\n        sourceNodeRef.current = null;\n        filterNodeRef.current = null;\n        gainNodeRef.current = null;\n      }\n    } catch {}\n  };\n\n  const setupWebAudio = (audio) => {\n    try {\n      const AudioContext = window.AudioContext || window.webkitAudioContext;\n      if (!AudioContext) return;\n\n      const ctx = new AudioContext();\n      const source = ctx.createMediaElementSource(audio);\n      const filter = ctx.createBiquadFilter();\n      const gain = ctx.createGain();\n\n      filter.type = 'lowpass';\n      filter.frequency.value = isInsideRoom ? 800 : 22000;\n      gain.gain.value = isInsideRoom ? 0.5 : 1.0;\n\n      source.connect(filter);\n      filter.connect(gain);\n      gain.connect(ctx.destination);\n\n      audioCtxRef.current = ctx;\n      sourceNodeRef.current = source;\n      filterNodeRef.current = filter;\n      gainNodeRef.current = gain;\n    } catch (e) {\n      console.warn('Web Audio setup failed:', e);\n    }\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Web Audio setup for filters\n    setupWebAudio(audio);\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume/room changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    \n    // Direct audio volume (without Web Audio or as fallback)\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    \n    // Web Audio updates\n    if (audioCtxRef.current) {\n      if (filterNodeRef.current) {\n        filterNodeRef.current.frequency.setTargetAtTime(isInsideRoom ? 800 : 22000, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (gainNodeRef.current) {\n        gainNodeRef.current.gain.setTargetAtTime(isInsideRoom ? 0.4 : 1.0, audioCtxRef.current.currentTime, 0.1);\n      }\n      if (audioCtxRef.current.state === 'suspended' && enabled) {\n        audioCtxRef.current.resume().catch(() => {});\n      }\n    }\n\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume, isInsideRoom]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst Overlay = styled.div`\n    position: absolute;\n    top: 70px;\n    left: 10%;\n    transform: none;\n    width: 80%;\n    text-align: left;\n    pointer-events: none;\n    z-index: 1500;\n    \n    h2 {\n        font-size: 22px;\n        color: white;\n        text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);\n        margin: 0;\n        padding: 12px 14px;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-weight: 800;\n        letter-spacing: 0.5px;\n        white-space: pre-line;\n        line-height: 1;\n        background: rgba(0, 0, 0, 0.45);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 6px;\n        opacity: ${props => props.$isVisible ? 1 : 0};\n        transition: opacity 2s ease-in-out;\n    }\n`;\n\nexport const MessageOverlay = ({ text, isVisible }) => {\n    if (!text) return null;\n    return (\n        <Overlay $isVisible={isVisible}>\n            <h2>{text}</h2>\n        </Overlay>\n    );\n};\n\nMessageOverlay.propTypes = {\n    text: PropTypes.string,\n    isVisible: PropTypes.bool\n};\n\nMessageOverlay.defaultProps = {\n    text: '',\n    isVisible: false\n};\n\nexport default MessageOverlay;\n","import map1 from '../assets/maps/template.json';\nimport map2 from '../assets/maps/exampel_liquids.json';\nimport map3 from '../assets/maps/exampel_sectors_01.json';\nimport map4 from '../assets/maps/exampel_sectors_02.json';\nimport map5 from '../assets/maps/exampel_m2room.json';\nimport map6 from '../assets/maps/exampel_weather_01.json';\nimport map7 from '../assets/maps/Ports.json';\nimport map8 from '../assets/maps/fish.json';\nimport map9 from '../assets/maps/minigame_sea.json';\nimport map10 from '../assets/maps/example_city.json';\n\n\nexport const BUILT_IN_MAPS = [\n    map1,\n    map2,\n    map3,\n    map4,\n    map5,\n    map6,\n    map7,\n    map8,\n    map9,\n    map10\n];\n","import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport { findSpawnPosition } from '../../../engine/gameplay/interactables';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../engine/gameplay/breakEffects';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, removeTileAtIndex, moveTileInMap, moveObjectInMap, updateObjectAtIndex, updateObjectMetadata, setObjectTextureIndex, revealSecretZone, resetGame, setGameOver, addSeaRescuePoints, captureSeaRescueBox, toggleRoom, clearRooms } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\nimport { BUILT_IN_MAPS } from '../../../constants/builtInMaps';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nconst WinCounterOverlay = styled.div`\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 120px;\n    font-weight: bold;\n    color: #fff;\n    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,255,255,0.5);\n    z-index: 2000;\n    pointer-events: none;\n    font-family: 'Courier New', Courier, monospace;\n`;\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    overflow: hidden;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: 100%;\n    height: 100%;\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nexport default function Game() {\n    const { t } = useTranslation('game');\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n\n    // Redux state\n    const gameState = useSelector(state => state.game) || {};\n    const uiState = useSelector(state => state.ui) || {};\n    const {\n        activeMapData = null,\n        tileMapData = [],\n        objectMapData = [],\n        secretMapData = [],\n        objectMetadata = {},\n        revealedSecrets = [],\n        objectTextureIndices = {},\n        mapWidth = 20,\n        mapHeight = 15,\n        isGameOver = false,\n        activeRoomIds = [],\n        seaRescuePoints = 0,\n        projectMaps = {}\n    } = gameState;\n    const {\n        isMapModalOpen = true,\n        cameraScrollX = 0,\n        shouldCenterMap = false\n    } = uiState;\n\n    const effectiveMapType = useMemo(() => {\n        if (!activeMapData) return 'overworld';\n        const activeId = activeMapData.meta?.activeMapId || activeMapData.meta?.activeMap || 'main';\n        \n        // Check for Project V2.0 structure\n        if (activeMapData.meta?.version === \"2.0\" && activeMapData.maps) {\n            const activeMap = activeMapData.maps[activeId] || Object.values(activeMapData.maps)[0];\n            return activeMap?.type || 'overworld';\n        }\n        \n        // Fallback to root type or overworld\n        return activeMapData.type || 'overworld';\n    }, [activeMapData]);\n\n    const [soundEnabled, setSoundEnabled] = useState(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            if (v === null) return false;\n            return v !== '0';\n        } catch {\n            return false;\n        }\n    });\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    const getBaseWeather = (mapData) => {\n        if (!mapData) return {};\n        if (mapData.weather && typeof mapData.weather === 'object') return mapData.weather;\n        if (mapData.meta?.weather && typeof mapData.meta.weather === 'object') return mapData.meta.weather;\n        const activeId = mapData.meta?.activeMapId || mapData.meta?.activeMap || 'main';\n        if (activeId && mapData.maps?.[activeId]?.weather) return mapData.maps[activeId].weather;\n        return {};\n    };\n\n    useEffect(() => {\n        if (!activeMapData) return;\n        const base = getBaseWeather(activeMapData);\n        const toNumber = (value) => {\n            const n = Number(value);\n            return Number.isFinite(n) ? n : 0;\n        };\n        setRuntimeSettings(prev => ({\n            ...prev,\n            weatherRain: toNumber(base.rain),\n            weatherSnow: toNumber(base.snow),\n            weatherClouds: toNumber(base.clouds),\n            weatherFog: toNumber(base.fog),\n            weatherThunder: toNumber(base.thunder),\n            weatherLavaRain: toNumber(base.lavaRain),\n            weatherRadioactiveFog: toNumber(base.radioactiveFog),\n            weatherMeteorRain: toNumber(base.meteorRain)\n        }));\n    }, [activeMapData]);\n\n    // In-game messages\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n\n    useEffect(() => {\n        const onToggle = (e) => {\n            const enabled = !!(e?.detail?.enabled);\n            setSoundEnabled(enabled);\n            try { localStorage.setItem('game_sound_enabled', enabled ? '1' : '0'); } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        return () => window.removeEventListener('game-sound-toggle', onToggle);\n    }, []);\n\n    useEffect(() => {\n        if (messageTimerRef.current) {\n            clearTimeout(messageTimerRef.current);\n            messageTimerRef.current = null;\n        }\n        setGameMessage({ text: '', isVisible: false });\n    }, [activeMapData]);\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        dispatch(setGameOver(true));\n    };\n\n    const handleReplay = () => {\n        if (activeMapData) {\n            console.log(\"Replaying map...\");\n            const mapToLoad = {\n                ...activeMapData,\n                meta: {\n                    ...activeMapData.meta,\n                    date_map_last_updated: new Date().toISOString()\n                }\n            };\n            loadMapData(mapToLoad);\n            dispatch(setGameOver(false));\n        }\n    };\n\n    const playerStateRef = useRef(null);\n    const activeMapIdRef = useRef(null);\n    const isGameOverRef = useRef(false);\n\n    useEffect(() => {\n        const id = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n        activeMapIdRef.current = id;\n    }, [activeMapData]);\n\n    useEffect(() => {\n        isGameOverRef.current = !!isGameOver;\n    }, [isGameOver]);\n\n    const handleStateUpdate = useCallback((action, payload) => {\n        if (action === 'collectItem') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            dispatch(removeObjectAtIndex({ index, mapId }));\n        } else if (action === 'interactable') {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            \n            const targetObjectData = (!mapId || mapId === 'main') ? objectMapData : (activeMapData?.maps?.[mapId]?.objectMapData || []);\n            const currentId = targetObjectData[index];\n            \n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used', mapId }));\n            }\n        } else if (action === 'setObjectFrame') {\n            const { index, frame, mapId } = payload;\n            dispatch(updateObjectMetadata({ index, metadata: { currentFrame: frame }, mapId }));\n        } else if (action === 'switchMap') {\n            const { targetMapId, triggerId } = payload;\n            const projectMapsResolved = Object.keys(projectMaps || {}).length\n                ? projectMaps\n                : (activeMapData?.maps || activeMapData?.projectMaps || {});\n            const targetMap = projectMapsResolved[targetMapId];\n            \n            if (targetMap && targetMap.type === 'room') {\n                if (!activeRoomIds.includes(targetMapId)) {\n                    dispatch(toggleRoom(targetMapId));\n                }\n                return;\n            } else if (targetMapId === 'main' && activeRoomIds.length > 0) {\n                dispatch(clearRooms());\n                \n                // Open the door at the exit target position to prevent getting stuck\n                const spawn = findSpawnPosition(activeMapData, triggerId, 32);\n                if (spawn) {\n                    const spawnIdx = (Math.floor(spawn.y / 32) * mapWidth) + Math.floor(spawn.x / 32);\n                    const spawnObjId = objectMapData[spawnIdx];\n                    const spawnDef = registryItems.find(r => r.id === spawnObjId);\n                    if (spawnDef && spawnDef.subtype === 'door') {\n                        dispatch(updateObjectMetadata({ \n                            index: spawnIdx, \n                            metadata: { currentFrame: spawnDef.interaction?.frames?.opening || 1 } \n                        }));\n                    }\n                }\n                return;\n            }\n            \n            if (targetMap) {\n                console.log(`Switching to map: ${targetMapId}, looking for trigger: ${triggerId}`);\n                \n                // Ms varam vienkri nodot visu projektu un pielikt spawnTriggerId\n                const projectToLoad = {\n                    ...activeMapData,\n                    maps: projectMapsResolved,\n                    meta: {\n                        ...activeMapData.meta,\n                        activeMapId: targetMapId,\n                        spawnTriggerId: triggerId\n                    }\n                };\n                \n                loadMapData(projectToLoad);\n            }\n        } else if (action === 'objectDamage') {\n            const { index, damage } = payload;\n            const objId = objectMapData[index];\n            if (objId) {\n                const def = registryItems.find(r => r.id === objId);\n                if (def && def.isDestructible) {\n                    const currentMeta = objectMetadata[index] || {};\n                    const maxH = def.maxHealth || 100;\n                    const newHealth = Math.max(0, (currentMeta.health !== undefined ? currentMeta.health : maxH) - damage);\n                    const metaPatch = { health: newHealth };\n                    if (shouldTriggerBreakEffect(def, newHealth) && !currentMeta.breakFxPlayed) {\n                        metaPatch.breakFxPlayed = true;\n                        const cfg = getBreakEffectParams(def);\n                        if (cfg) {\n                            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                            window.dispatchEvent(new CustomEvent('game-break-effect', {\n                                detail: { x, y, config: cfg }\n                            }));\n                        }\n                    }\n                    dispatch(updateObjectMetadata({ index, metadata: metaPatch }));\n\n                    if (shouldRemoveCrackBlock(def, newHealth)) {\n                        dispatch(removeTileAtIndex(index));\n                    }\n\n                    const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                    const y = Math.floor(index / mapWidth) * TILE_SIZE;\n                    window.dispatchEvent(new CustomEvent('game-floating-text', {\n                        detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n                    }));\n                }\n            }\n        } else if (action === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (action === 'SEA_RESCUE_SCORE' && payload) {\n            const { points, triggerIndex, boxId } = payload;\n            dispatch(addSeaRescuePoints(points));\n            dispatch(captureSeaRescueBox({ triggerIndex, boxId, mapWidth }));\n            \n            // Show floating text at the trigger location (might need adjustment if captured index changed, but for now we show at hit location)\n            const x = (triggerIndex % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(triggerIndex / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `+${points}`, color: '#00ff00', amount: points }\n            }));\n        } else if (action === 'shiftTile' && payload) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapIdRef.current;\n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => objectMapData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => dispatch(moveTileInMap({ fromIndex: from, toIndex: to })),\n                moveObject: (from, to) => dispatch(moveObjectInMap({ fromIndex: from, toIndex: to })),\n                removeObject: idx => dispatch(removeObjectAtIndex(idx)),\n                shouldCancel: () => isGameOverRef.current || activeMapIdRef.current !== mapIdAtStart\n            });\n        } else if (action === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            const ps = playerStateRef.current;\n            const px = Number.isFinite(x) ? x : (ps?.x || 0) + (ps?.width || TILE_SIZE) / 2;\n            const py = Number.isFinite(y) ? y : (ps?.y || 0);\n            if (Number.isFinite(px) && Number.isFinite(py) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x: px, y: py, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        } else if (action === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (action === 'levelWin') {\n            console.log(\"Level Win! Returning to map selection.\");\n            setTimeout(() => {\n                alert(\"Level Complete!\");\n                dispatch(setMapModalOpen(true));\n            }, 500);\n        } else if (action === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1); // e.g., weatherRain\n            setRuntimeSettings(prev => ({ ...prev, [settingKey]: value }));\n            \n            // Dispatch event so UI components like GameSettings can update their state\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (action === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            // o darbbu ms izmantosim, lai nodotu informciju dzinjam caur ref vai eventu\n            // Bet labk ir tiei izsaukt dzinja funkciju, ja tda ir.\n            // T k useGameEngine ir hook, ms nevaram viegli izsaukt t iekjo funkciju.\n            // Tomr ms varam izmantot window eventu vai ref.\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (action === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        }\n    }, [activeMapData, activeRoomIds, dispatch, mapHeight, mapWidth, objectMapData, objectMetadata, projectMaps, registryItems]);\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const { player: playerState, input: engineInput, engineRefs } = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        activeRoomIds,\n        mapWidth,\n        mapHeight\n    );\n    useEffect(() => {\n        playerStateRef.current = playerState;\n    }, [playerState]);\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => {\n            dispatch(setMapModalOpen(true));\n            dispatch(setGameOver(false)); // Reset game over when opening new game modal\n        };\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherLavaRain: (runtimeSettings.weatherLavaRain ?? 0),\n                weatherRadioactiveFog: (runtimeSettings.weatherRadioactiveFog ?? 0),\n                weatherMeteorRain: (runtimeSettings.weatherMeteorRain ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                roomBlurEnabled: (runtimeSettings.roomBlurEnabled ?? true),\n                debugOverlayEnabled: (runtimeSettings.debugOverlayEnabled ?? false),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const cloneMapData = (data) => {\n        if (!data) return data;\n        try {\n            if (typeof structuredClone === 'function') {\n                return structuredClone(data);\n            }\n        } catch {}\n        try {\n            return JSON.parse(JSON.stringify(data));\n        } catch {\n            return data;\n        }\n    };\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            const sourceMapData = cloneMapData(mapData);\n            let effectiveMapData = sourceMapData;\n            \n            // Atbalsts Version 2.0 (Multi-map project)\n            if (sourceMapData.meta?.version === \"2.0\" && sourceMapData.maps) {\n                const activeId = sourceMapData.meta.activeMapId || Object.keys(sourceMapData.maps)[0];\n                const activeMap = sourceMapData.maps[activeId];\n                \n                if (activeMap) {\n                    const activeLayers = activeMap.layers || [];\n                    const bgLayer = activeLayers.find(l => l.name === 'background' || l.type === 'tile');\n                    const objLayer = activeLayers.find(l => l.name === 'entities' || l.type === 'object');\n                    const secretLayer = activeLayers.find(l => l.name === 'secrets' || l.type === 'secret');\n                    const mapTileData = activeMap.tileMapData || bgLayer?.data;\n                    const mapObjectData = activeMap.objectMapData || objLayer?.data;\n                    const mapSecretData = activeMap.secretMapData || secretLayer?.data;\n\n                    // Konvertjam uz formtu, ko saprot dzinjs un setActiveMap\n                    effectiveMapData = {\n                        ...sourceMapData, // Saglabjam visu projektu\n                        meta: {\n                            ...sourceMapData.meta,\n                            width: activeMap.width,\n                            height: activeMap.height,\n                            name: activeMap.name,\n                            backgroundImage: activeMap.backgroundImage,\n                            backgroundColor: activeMap.backgroundColor,\n                            backgroundMusic: activeMap.backgroundMusic,\n                            backgroundParallaxFactor: activeMap.backgroundParallaxFactor,\n                            weather: activeMap.weather,\n                            objectMetadata: activeMap.objectMetadata || {},\n                            playerPosition: activeMap.playerPosition\n                        },\n                        layers: [\n                            { name: 'background', data: mapTileData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'entities', data: mapObjectData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) },\n                            { name: 'secrets', data: mapSecretData || Array((activeMap.width || 0) * (activeMap.height || 0)).fill(null) }\n                        ]\n                    };\n                }\n            }\n\n            const nowIso = new Date().toISOString();\n            if (!effectiveMapData.meta) effectiveMapData.meta = {};\n            effectiveMapData.meta.date_map_last_updated = nowIso;\n\n            const w = effectiveMapData.meta?.width || effectiveMapData.width || 20;\n            const h = effectiveMapData.meta?.height || effectiveMapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (effectiveMapData.layers) {\n                const bgLayer = effectiveMapData.layers.find(l => l.name === 'background' || l.type === 'tile');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = effectiveMapData.layers.find(l => l.name === 'entities' || l.type === 'object');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = effectiveMapData.layers.find(l => l.name === 'secrets' || l.type === 'secret');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = effectiveMapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData: effectiveMapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n            dispatch(setGameOver(false)); // Ensure game over is reset on map load\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: effectiveMapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    const debugOverlayEnabled = !!(runtimeSettings.debugOverlayEnabled);\n    const debugMapId = activeMapData?.meta?.activeMapId || activeMapData?.meta?.activeMap || 'main';\n\n    return (\n        <GameContainer onClick={() => {\n            window.dispatchEvent(new CustomEvent('game-sound-user-gesture'));\n        }}>\n        \n            {/* Game Header */}\n            {/* UI Overlays */}\n            {playerState?.isWinning && (\n                <WinCounterOverlay>\n                    {Math.floor(playerState.winCounter || 0)}\n                </WinCounterOverlay>\n            )}\n\n            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n\n            <GameHeader \n                health={playerState.health} \n                maxHealth={playerState.maxHealth}\n                ammo={playerState.ammo || 0} \n                fishCount={playerState.fishCount || 0}\n                seaRescuePoints={seaRescuePoints}\n                mapType={effectiveMapType}\n                oxygen={playerState.oxygen}\n                maxOxygen={playerState.maxOxygen}\n                lavaResist={playerState.lavaResist}\n                maxLavaResist={playerState.maxLavaResist}\n                iceResist={playerState.iceResist}\n                maxIceResist={playerState.maxIceResist}\n                strength={playerState.strength}\n                maxStrength={playerState.maxStrength}\n                radioactivity={playerState.radioactivity}\n                maxRadioactivity={playerState.maxRadioactivity}\n                inWater={playerState.inWater}\n                liquidType={playerState.liquidType}\n                onIce={playerState.onIce}\n            />\n\n            {debugOverlayEnabled && (\n                <div style={{\n                    position: 'absolute',\n                    top: 70,\n                    left: 70,\n                    background: 'rgba(0,0,0,0.6)',\n                    color: '#eaeaea',\n                    padding: '8px 10px',\n                    fontSize: 11,\n                    lineHeight: 1.4,\n                    borderRadius: 4,\n                    zIndex: 2100,\n                    pointerEvents: 'none',\n                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace'\n                }}>\n                    <div>Map: {debugMapId}</div>\n                    <div>Pos: {Math.round(playerState.x || 0)}, {Math.round(playerState.y || 0)}</div>\n                    <div>Room: {Array.isArray(activeRoomIds) && activeRoomIds.length ? activeRoomIds.join(', ') : 'none'}</div>\n                    <div>Weather: rain {runtimeSettings.weatherRain ?? 0} | snow {runtimeSettings.weatherSnow ?? 0} | fog {runtimeSettings.weatherFog ?? 0}</div>\n                    <div>Weather: lava {runtimeSettings.weatherLavaRain ?? 0} | radio {runtimeSettings.weatherRadioactiveFog ?? 0}</div>\n                    <div>HP {Math.round(playerState.health || 0)} / {Math.round(playerState.maxHealth || 0)}</div>\n                    <div>O2 {Math.round(playerState.oxygen || 0)} | Lava {Math.round(playerState.lavaResist || 0)} | Rad {Math.round(playerState.radioactivity || 0)}</div>\n                </div>\n            )}\n\n\n            {isGameOver && (\n                <GameOverOverlay>\n                    <GameOverTitle>Game Over</GameOverTitle>\n                    <ReplayButton onClick={handleReplay}>\n                        REPLAY \n                    </ReplayButton>\n                </GameOverOverlay>\n            )}\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>{t('GAME_MAP_SELECT_TITLE')}</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => {\n                                const isV2 = map.meta?.version === \"2.0\";\n                                const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                                const author = map.meta?.author || \"Unknown\";\n                                \n                                let sizeInfo = \"\";\n                                let subMapInfo = \"\";\n\n                                if (isV2 && map.maps) {\n                                    const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                                    if (mainMap) {\n                                        sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                                    }\n                                    \n                                    const mapValues = Object.values(map.maps);\n                                    const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                                    const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                                    \n                                    subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                                } else {\n                                    sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                                }\n\n                                return (\n                                    <MapCard key={index} onClick={() => loadMapData(map)}>\n                                        <div>\n                                            <MapTitle>{projectName}</MapTitle>\n                                            <MapAuthor>{t('GAME_MAP_BY', { author })}</MapAuthor>\n                                        </div>\n                                        {map.meta?.description && (\n                                            <MapDescription title={map.meta.description}>\n                                                {map.meta.description}\n                                            </MapDescription>\n                                        )}\n                                        <MapInfo>\n                                            <div>{t('GAME_MAP_SIZE', { size: `${sizeInfo}${subMapInfo}` })}</div>\n                                        </MapInfo>\n                                    </MapCard>\n                                );\n                            })}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 {t('GAME_MAP_LOAD_CUSTOM')}\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            objectMetadata={objectMetadata}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherLavaRain={runtimeSettings.weatherLavaRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherMeteorRain={runtimeSettings.weatherMeteorRain ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherRadioactiveFog={runtimeSettings.weatherRadioactiveFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                            roomBlurEnabled={runtimeSettings.roomBlurEnabled ?? true}\n                            debugOverlayEnabled={runtimeSettings.debugOverlayEnabled ?? false}\n                            isEditor={false}\n                            mapType={effectiveMapType}\n                            engineInput={engineInput}\n                            engineRefs={engineRefs}\n                            activeRoomIds={activeRoomIds}\n                            maps={projectMaps}\n                            mapData={activeMapData}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer \n                metaPath={activeMapData?.meta?.backgroundMusic} \n                enabled={soundEnabled} \n                volume={0.6} \n                isInsideRoom={activeRoomIds.length > 0}\n            />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","import saveFile from '../../../../utilities/saveFile';\nimport errorHandler from '../../../../services/errorHandler';\n\nexport const saveMap = async ({\n    maps,\n    activeMapId,\n    mapName,\n    creatorName,\n    mapDescription,\n    createdAt,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    const projectData = {\n        meta: {\n            version: \"2.0\",\n            projectName: mapName,\n            author: creatorName,\n            description: mapDescription,\n            date_created: createdDate,\n            date_last_updated: currentDate,\n            activeMapId: activeMapId\n        },\n        maps: {}\n    };\n\n    // Serialize all maps\n    Object.values(maps).forEach(map => {\n        const filledBlocks = map.tileMapData.filter(t => t !== null).length;\n        const objectsCount = map.objectMapData.filter(o => o !== null).length;\n        \n        projectData.maps[map.id] = {\n            id: map.id,\n            name: map.name,\n            description: map.description || '',\n            type: map.type,\n            width: map.mapWidth,\n            height: map.mapHeight,\n            backgroundImage: map.selectedBackgroundImage || null,\n            backgroundColor: map.selectedBackgroundColor || null,\n            backgroundParallaxFactor: map.backgroundParallaxFactor || 0.3,\n            backgroundMusic: map.selectedBackgroundMusic || null,\n            weather: map.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n            objectMetadata: map.objectMetadata || {},\n            playerPosition: map.playerPosition || null,\n            worldX: map.worldX || 0,\n            worldY: map.worldY || 0,\n            statistics: {\n                total_tiles: map.mapWidth * map.mapHeight,\n                filled_tiles: filledBlocks,\n                total_objects: objectsCount\n            },\n            layers: [\n                { type: \"tile\", name: \"background\", data: map.tileMapData },\n                { type: \"object\", name: \"entities\", data: map.objectMapData },\n                { type: \"secret\", name: \"secrets\", data: map.secretMapData || Array(map.mapWidth * map.mapHeight).fill(null) }\n            ]\n        };\n    });\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(projectData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Project saved successfully', {\n                component: 'Editor',\n                projectName: mapName,\n                fileName,\n                mapsCount: Object.keys(maps).length\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save project. Check console for details.');\n    }\n};\n\nexport const applyMapData = (loaded, {\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setPlayerPosition,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData,\n    setObjectMetadata,\n    setWeatherRain,\n    setWeatherSnow,\n    setWeatherClouds,\n    setWeatherFog,\n    setWeatherThunder,\n    setWeatherLavaRain,\n    setWeatherRadioactiveFog,\n    setWeatherMeteorRain,\n    // Multi-map setters\n    setMaps,\n    setActiveMapId\n}) => {\n    try {\n        // Check for multi-map format (version 2.0)\n        if (loaded.meta && loaded.meta.version === \"2.0\" && loaded.maps) {\n            const projectMaps = {};\n            \n            Object.keys(loaded.maps).forEach(mapId => {\n                const m = loaded.maps[mapId];\n                const bgLayer = m.layers.find(l => l.type === 'tile');\n                const objLayer = m.layers.find(l => l.type === 'object');\n                const secretLayer = m.layers.find(l => l.type === 'secret');\n                \n                projectMaps[mapId] = {\n                    id: mapId,\n                    name: m.name,\n                    description: m.description || '',\n                    type: m.type || 'overworld',\n                    mapWidth: m.width,\n                    mapHeight: m.height,\n                    tileMapData: bgLayer ? bgLayer.data : Array(m.width * m.height).fill(null),\n                    objectMapData: objLayer ? objLayer.data : Array(m.width * m.height).fill(null),\n                    secretMapData: secretLayer ? secretLayer.data : Array(m.width * m.height).fill(null),\n                    objectMetadata: m.objectMetadata || {},\n                    selectedBackgroundImage: m.backgroundImage,\n                    selectedBackgroundColor: m.backgroundColor,\n                    backgroundParallaxFactor: m.backgroundParallaxFactor || 0.3,\n                    selectedBackgroundMusic: m.backgroundMusic,\n                    weather: m.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                    playerPosition: m.playerPosition || null,\n                    worldX: m.worldX || 0,\n                    worldY: m.worldY || 0\n                };\n            });\n            \n            setMaps(projectMaps);\n            setMapName(loaded.meta.projectName || \"Loaded Project\");\n            setCreatorName(loaded.meta.author || \"Anonymous\");\n            setMapDescription(loaded.meta.description || \"\");\n            setCreatedAt(loaded.meta.date_created || new Date().toISOString());\n            \n            const activeId = loaded.meta.activeMapId || Object.keys(projectMaps)[0];\n            setActiveMapId(activeId);\n            \n            const activeMap = projectMaps[activeId];\n            if (activeMap) {\n                setMapWidth(activeMap.mapWidth);\n                setMapHeight(activeMap.mapHeight);\n                setTileMapData(activeMap.tileMapData);\n                setObjectMapData(activeMap.objectMapData);\n                setSecretMapData(activeMap.secretMapData);\n                setObjectMetadata(activeMap.objectMetadata);\n                setSelectedBackgroundImage(activeMap.selectedBackgroundImage);\n                setSelectedBackgroundColor(activeMap.selectedBackgroundColor);\n                setBackgroundParallaxFactor(activeMap.backgroundParallaxFactor);\n                setSelectedBackgroundMusic(activeMap.selectedBackgroundMusic);\n                \n                setWeatherRain(activeMap.weather.rain);\n                setWeatherSnow(activeMap.weather.snow);\n                setWeatherClouds(activeMap.weather.clouds);\n                setWeatherFog(activeMap.weather.fog);\n                setWeatherThunder(activeMap.weather.thunder);\n                setWeatherLavaRain(activeMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(activeMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(activeMap.weather.meteorRain || 0);\n\n                if (activeMap.playerPosition) setPlayerPosition(activeMap.playerPosition);\n            }\n            \n            errorHandler.info('Project loaded successfully', {\n                component: 'Editor',\n                projectName: loaded.meta.projectName\n            });\n        } else if (loaded.meta) {\n            // Legacy 1.0 format\n            setMapWidth(loaded.meta.width);\n            setMapHeight(loaded.meta.height);\n\n            if (loaded.meta.name) setMapName(loaded.meta.name);\n            if (loaded.meta.author) setCreatorName(loaded.meta.author);\n            if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n            const bgLayer = loaded.layers.find(l => l.name === 'background');\n            const objLayer = loaded.layers.find(l => l.name === 'entities');\n            const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n            \n            const singleMap = {\n                id: 'main',\n                name: loaded.meta.name || \"Main Map\",\n                type: 'overworld',\n                mapWidth: loaded.meta.width,\n                mapHeight: loaded.meta.height,\n                tileMapData: bgLayer ? bgLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMapData: objLayer ? objLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                secretMapData: secretLayer ? secretLayer.data : Array(loaded.meta.width * loaded.meta.height).fill(null),\n                objectMetadata: loaded.meta.objectMetadata || {},\n                selectedBackgroundImage: loaded.meta.backgroundImage,\n                selectedBackgroundColor: loaded.meta.backgroundColor,\n                backgroundParallaxFactor: loaded.meta.backgroundParallaxFactor || 0.3,\n                selectedBackgroundMusic: loaded.meta.backgroundMusic,\n                weather: loaded.meta.weather || { rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0 },\n                playerPosition: null\n            };\n\n            setMaps({ 'main': singleMap });\n            setActiveMapId('main');\n\n            if (bgLayer) setTileMapData(bgLayer.data);\n            if (objLayer) setObjectMapData(objLayer.data);\n            if (secretLayer) setSecretMapData(secretLayer.data);\n            \n            // Set other states\n            if (loaded.meta.backgroundImage) setSelectedBackgroundImage(loaded.meta.backgroundImage);\n            if (loaded.meta.backgroundColor) setSelectedBackgroundColor(loaded.meta.backgroundColor);\n            if (loaded.meta.backgroundParallaxFactor !== undefined) setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n            if (loaded.meta.backgroundMusic) setSelectedBackgroundMusic(loaded.meta.backgroundMusic);\n            if (loaded.meta.objectMetadata) setObjectMetadata(loaded.meta.objectMetadata);\n            if (loaded.meta.weather) {\n                setWeatherRain(loaded.meta.weather.rain || 0);\n                setWeatherSnow(loaded.meta.weather.snow || 0);\n                setWeatherClouds(loaded.meta.weather.clouds || 0);\n                setWeatherFog(loaded.meta.weather.fog || 0);\n                setWeatherThunder(loaded.meta.weather.thunder || 0);\n                setWeatherLavaRain(loaded.meta.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(loaded.meta.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(loaded.meta.weather.meteorRain || 0);\n            }\n            if (loaded.meta.playerPosition) setPlayerPosition(loaded.meta.playerPosition);\n\n            errorHandler.info('Map loaded successfully (Converted to Project)', {\n                component: 'Editor',\n                mapName: loaded.meta.name\n            });\n        } else {\n            // Oldest format\n            if (loaded.width) setMapWidth(loaded.width);\n            if (loaded.height) setMapHeight(loaded.height);\n            if (loaded.tiles) setTileMapData(loaded.tiles);\n            setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n            errorHandler.warn('Loaded map in legacy format', {\n                component: 'Editor'\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'applyMapData'\n        });\n        alert('Error applying map data. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    ...setters\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                applyMapData(loaded, setters);\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const loadBuiltInMap = ({\n    mapData,\n    ...setters\n}) => {\n    try {\n        applyMapData(mapData, setters);\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'loadBuiltInMap'\n        });\n        alert('Error loading built-in map.');\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets, objectMetadata: oldMeta } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        if (!oldArr) return newArr;\n        const offsetY = newHeight - oldH;\n        for (let y = 0; y < newHeight; y++) {\n            const oldY = y - offsetY;\n            if (oldY < 0 || oldY >= oldH) continue;\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[oldY * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    const resizeMetadata = (oldM) => {\n        const newM = {};\n        if (!oldM) return newM;\n        const offsetY = newHeight - oldH;\n        for (let y = 0; y < newHeight; y++) {\n            const oldY = y - offsetY;\n            if (oldY < 0 || oldY >= oldH) continue;\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                const oldIdx = oldY * oldW + x;\n                const newIdx = y * newWidth + x;\n                if (oldM[oldIdx]) {\n                    newM[newIdx] = oldM[oldIdx];\n                }\n            }\n        }\n        return newM;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets));\n    setObjectMetadata(resizeMetadata(oldMeta));\n};\n","import React from 'react';\n\nexport const ObjectLinks = React.memo(({ mapWidth, mapHeight, objectMapData, objectMetadata }) => {\n    const links = [];\n    const portals = [];\n    const targets = [];\n\n    // Collect all portals and targets with Trigger IDs\n    objectMapData.forEach((id, index) => {\n        if (!id) return;\n        const metadata = objectMetadata?.[index];\n        if (!metadata || metadata.triggerId === undefined || metadata.triggerId === null) return;\n\n        const x = (index % mapWidth) * 32 + 16;\n        const y = Math.floor(index / mapWidth) * 32 + 16;\n\n        if (id.includes('portal') && !id.includes('target')) {\n            portals.push({ x, y, id: metadata.triggerId });\n        } else if (id.includes('target') || id === 'portal_target') {\n            targets.push({ x, y, id: metadata.triggerId });\n        }\n    });\n\n    // Draw lines between matching IDs\n    portals.forEach(p => {\n        targets.forEach(t => {\n            if (p.id === t.id) {\n                links.push(\n                    <line\n                        key={`link-${p.x}-${p.y}-${t.x}-${t.y}`}\n                        x1={p.x} y1={p.y}\n                        x2={t.x} y2={t.y}\n                        stroke=\"#fff\"\n                        strokeWidth=\"2\"\n                        strokeDasharray=\"5,5\"\n                    />\n                );\n            }\n        });\n    });\n\n    return (\n        <svg style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: mapWidth * 32,\n            height: mapHeight * 32, // Note: mapHeight must be available\n            zIndex: 10,\n            pointerEvents: 'none',\n            opacity: 0.6\n        }}>\n            {links}\n        </svg>\n    );\n});\n","import React from 'react';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const EditorTile = React.memo(({\n    index,\n    x, y,\n    activeTool,\n    tileObj,\n    objObj,\n    secretObj,\n    objectMetadata,\n    isHighlighted,\n    parentRegionIndex,\n    borderStyle,\n    bgStyle,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleResizeStart,\n    handleMoveStart,\n    filter,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages\n}) => {\n    const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n    const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n    const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n    const isQuicksandTile = !!(tileObj && tileObj.flags && tileObj.flags.quicksand);\n    const isWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.waterfall);\n    const isLavaWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.lava_waterfall);\n    const isRadioactiveWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_water);\n    const isRadioactiveWaterfallTile = !!(tileObj && tileObj.flags && tileObj.flags.radioactive_waterfall);\n\n    const actualIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n    const triggerId = objectMetadata?.[actualIndex]?.triggerId;\n    const intensity = objectMetadata?.[actualIndex]?.intensity;\n    const messageText = objectMetadata?.[actualIndex]?.message;\n    const i18nChapter = objectMetadata?.[actualIndex]?.i18nChapter;\n    const i18nId = objectMetadata?.[actualIndex]?.i18nId;\n    const i18nText = objObj?.type === 'message_trigger' ? getTutorialText(i18nChapter, i18nId) : '';\n    const resolvedMessageText = messageText || i18nText;\n    \n    // Dimensijas emam no tie indeksa, lai izvairtos no citu objektu (piem. Room Area) \n    // ietekmes uz 1x1 objektiem, kas atrodas to robes.\n    const width = Number(objectMetadata?.[index]?.width ?? objObj?.width ?? secretObj?.width ?? 1);\n    const height = Number(objectMetadata?.[index]?.height ?? objObj?.height ?? secretObj?.height ?? 1);\n\n    const handleMouseDown = (e) => {\n        // If we're clicking a tile that's part of a region, we should interact with the anchor\n        const targetIndex = parentRegionIndex !== null ? parentRegionIndex : index;\n        \n        if (activeTool === 'move') {\n            const hasMovable = objectMetadata[targetIndex] || objObj || secretObj;\n            if (hasMovable) {\n                e.stopPropagation();\n                handleMoveStart(targetIndex);\n                return;\n            }\n        }\n        handleGridMouseDown(index, e);\n    };\n\n    const isResizable = React.useMemo(() => {\n        if (!objObj && !secretObj) return false;\n        \n        // Room areas (windows) on room maps are NOT resizable\n        if (secretObj && secretObj.subtype === 'room' && mapType === 'room') return false;\n\n        // Specifically requested to disable for these types, except Room Areas which MUST be resizable\n        if (secretObj && secretObj.type === 'secret' && secretObj.subtype !== 'room') return false;\n        if (objObj && (objObj.type === 'crack_block' || objObj.type === 'wolf_secret')) return false;\n        return true;\n    }, [objObj, secretObj, mapType]);\n\n    const hasObjectOrSecret = objObj || secretObj || (parentRegionIndex !== null);\n\n    return (\n        <div\n            onMouseDown={handleMouseDown}\n            onMouseEnter={() => handleGridMouseEnter(index)}\n            style={{\n                width: '32px',\n                height: '32px',\n                border: borderStyle,\n                backgroundColor: bgStyle,\n                position: 'relative',\n                boxSizing: 'border-box',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                overflow: 'visible',\n                cursor: (activeTool === 'move' && hasObjectOrSecret) ? 'grab' : 'default'\n            }}>\n            \n            {isHighlighted && parentRegionIndex === null && isResizable && (\n                <>\n                    {/* Resize Handles */}\n                    {/* Right */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'right'); }}\n                        style={{ position: 'absolute', right: `${-(width-1)*32 - 6}px`, top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Left */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'left'); }}\n                        style={{ position: 'absolute', left: '-6px', top: '50%', transform: 'translateY(-50%)', width: '10px', height: '20px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ew-resize' }} \n                    />\n                    {/* Bottom */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'bottom'); }}\n                        style={{ position: 'absolute', bottom: `${-(height-1)*32 - 6}px`, left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                    {/* Top */}\n                    <div \n                        onMouseDown={(e) => { e.stopPropagation(); handleResizeStart(index, 'top'); }}\n                        style={{ position: 'absolute', top: '-6px', left: '50%', transform: 'translateX(-50%)', width: '20px', height: '10px', backgroundColor: 'gold', border: '1px solid #000', borderRadius: '2px', zIndex: 100, cursor: 'ns-resize' }} \n                    />\n                </>\n            )}\n\n            {/* Tile Layer */}\n            {tileObj && (\n                <div style={{ filter: filter ? filter('tile') : 'none', transition: 'filter 0.3s ease' }}>\n                    {isLiquidTile ? (\n                        <div style={{\n                            width: '32px', height: '32px',\n                            background: isLavaWaterfallTile ? 'rgba(255, 204, 0, 0.7)' : (isLavaTile ? 'rgba(255, 204, 0, 0.7)' : (isWaterTile || isWaterfallTile ? 'rgba(58, 127, 184, 0.7)' : (isQuicksandTile ? 'rgba(218, 165, 32, 0.7)' : (isRadioactiveWaterTile || isRadioactiveWaterfallTile ? 'rgba(50, 205, 50, 0.7)' : 'rgba(0, 255, 255, 0.3)')))),\n                            display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: '8px'\n                        }}>\n                            {isLavaWaterfallTile ? 'L.FALL' : (isLavaTile ? 'LAVA' : (isRadioactiveWaterfallTile ? 'RADFALL' : (isRadioactiveWaterTile ? 'RAD' : (isWaterTile ? 'WATER' : (isWaterfallTile ? 'FALL' : (isQuicksandTile ? 'QUICK' : 'LIQ'))))))}\n                        </div>\n                    ) : (\n                        <AnimatedItem\n                            textures={tileObj.textures}\n                            texture={tileObj.texture}\n                            speed={tileObj.animationSpeed}\n                            spriteSheet={tileObj.spriteSheet}\n                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\n                        />\n                    )}\n                </div>\n            )}\n\n            {/* Secret Layer */}\n            {secretObj && (secretObj.subtype !== 'room' || isRoomAreaVisible || showRoomMapContent || activeTool === 'area' || mapType === 'room') && (\n                <div style={{\n                    position: 'absolute', \n                    top: '0', left: '0',\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: secretObj.filterColorInEditor || secretObj.filterColor || 'rgba(128, 0, 128, 0.4)',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    color: '#fff', fontSize: '10px', fontWeight: 'bold', zIndex: 2,\n                    filter: filter ? filter('secret') : 'none', transition: 'filter 0.3s ease',\n                    border: '1px dashed rgba(255,255,255,0.5)',\n                    boxSizing: 'border-box',\n                    pointerEvents: 'none'\n                }}>\n                    {mapType !== 'room' && (secretObj.editorIcon || 'SECRET')}\n                </div>\n            )}\n\n            {/* Object Layer */}\n            {objObj && (() => {\n                const renderOffsetX = Number(objObj?.render?.offsetX) || 0;\n                const renderOffsetY = Number(objObj?.render?.offsetY) || 0;\n                const overlapX = Number(objObj?.render?.overlapX) || 0;\n                const overlapY = Number(objObj?.render?.overlapY) || 0;\n                const isLargeDecoration = objObj.type === 'decoration' && (width > 1 || height > 1);\n                const isTree = objObj.editor?.group === 'trees';\n                const renderAboveOverride = objectMetadata?.[actualIndex]?.renderAbovePlayer;\n                const resolvedRenderAbove = renderAboveOverride !== undefined ? renderAboveOverride : objObj.renderAbovePlayer;\n                const treeLayerLabel = resolvedRenderAbove ? 'TREE: ABOVE PLAYER' : 'TREE: BEHIND PLAYER';\n                const anchorOffsetX = isLargeDecoration ? -Math.floor(width / 2) * 32 : 0;\n                const anchorOffsetY = isLargeDecoration ? -(height - 1) * 32 : 0;\n                const baseTop = objObj.type === 'decoration' ? 0 : 2;\n                const baseLeft = objObj.type === 'decoration' ? 0 : 2;\n                const baseWidth = objObj.type === 'decoration' ? (width * 32) : (width * 32 - 4);\n                const baseHeight = objObj.type === 'decoration' ? (height * 32) : (height * 32 - 4);\n                return (\n                <div style={{\n                    position: 'absolute', \n                    top: `${baseTop + renderOffsetY + anchorOffsetY - overlapY / 2}px`,\n                    left: `${baseLeft + renderOffsetX + anchorOffsetX - overlapX / 2}px`,\n                    width: `${baseWidth + overlapX}px`,\n                    height: `${baseHeight + overlapY}px`,\n                    zIndex: 3,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    filter: filter ? filter('object') : 'none', transition: 'filter 0.3s ease',\n                    pointerEvents: 'none' // Let clicks pass through to the tile for resizing handles\n                }}>\n                    {objObj.editorIcon ? (\n                        <span style={{\n                            fontSize: objObj.editorIcon === 'i18n' ? '12px' : '20px',\n                            width: '100%',\n                            height: '100%',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            backgroundColor: 'rgba(255,255,255,0.1)',\n                            border: '1px dashed rgba(255,255,255,0.3)',\n                            color: '#222',\n                            fontWeight: 700\n                        }}>{objObj.editorIcon}</span>\n                    ) : (\n                        <AnimatedItem\n                            textures={objObj.textures}\n                            texture={objObj.texture}\n                            speed={objObj.animationSpeed}\n                            spriteSheet={objObj.spriteSheet}\n                            frameIndex={objectMetadata?.[actualIndex]?.currentFrame !== undefined ? objectMetadata[actualIndex].currentFrame : (objObj.subtype === 'door' && mapType === 'room' ? (objObj.interaction?.frames?.inside || 2) : undefined)}\n                            style={{ \n                                width: '100%', \n                                height: '100%', \n                                objectFit: objObj.type === 'decoration' ? 'cover' : 'contain', \n                                backgroundColor: objObj.type === 'decoration' ? 'transparent' : 'rgba(255,255,255,0.1)', \n                                border: objObj.type === 'decoration' ? 'none' : '1px dashed rgba(255,255,255,0.3)' \n                            }}\n                        />\n                    )}\n\n                    {isTree && (\n                        <div style={{\n                            position: 'absolute',\n                            top: '-28px',\n                            left: '50%',\n                            transform: 'translateX(-50%)',\n                            backgroundColor: 'rgba(0,0,0,0.7)',\n                            color: '#fff',\n                            padding: '1px 6px',\n                            borderRadius: '3px',\n                            fontSize: '10px',\n                            whiteSpace: 'nowrap',\n                            zIndex: 12,\n                            border: '1px solid #fff'\n                        }}>\n                            {treeLayerLabel}\n                        </div>\n                    )}\n\n                    {objObj.type === 'message_trigger' && (\n                        <div style={{\n                            position: 'absolute',\n                            inset: '2px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            background: '#fff9c4',\n                            border: '1px solid #fbc02d',\n                            color: '#333',\n                            fontWeight: 700,\n                            fontSize: (objObj.editorIcon === 'i18n' || objObj.i18nMessage) ? '12px' : '18px'\n                        }}>\n                            {objObj.editorIcon || (objObj.i18nMessage ? 'i18n' : '')}\n                        </div>\n                    )}\n\n                    {/* Trigger ID */}\n                    {triggerId !== undefined && triggerId !== null && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', left: '0',\n                            backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 10, border: '1px solid #fff'\n                        }}>\n                            ID: {triggerId}\n                        </div>\n                    )}\n\n                    {/* Intensity */}\n                    {intensity !== undefined && intensity !== null && objObj && (objObj.type === 'weather_trigger' || objObj.hasIntensity) && (\n                        <div style={{\n                            position: 'absolute', top: '-15px', right: '0',\n                            backgroundColor: 'rgba(0,100,200,0.8)', color: '#fff', padding: '1px 4px',\n                            borderRadius: '3px', fontSize: '10px', whiteSpace: 'nowrap', zIndex: 11, border: '1px solid #fff'\n                        }}>\n                            {intensity}%\n                        </div>\n                    )}\n\n                    {/* Message Bubble */}\n                    {showMessages && objObj && objObj.type === 'message_trigger' && resolvedMessageText && (\n                        <div style={{\n                            position: 'absolute',\n                            left: '50%',\n                            bottom: '100%',\n                            transform: 'translateX(-50%)',\n                            marginBottom: '8px',\n                            maxWidth: '140px',\n                            backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                            color: '#222',\n                            border: '1px solid rgba(0,0,0,0.6)',\n                            borderRadius: '8px',\n                            padding: '4px 6px',\n                            fontSize: '10px',\n                            lineHeight: 1.2,\n                            textAlign: 'center',\n                            zIndex: 12,\n                            pointerEvents: 'none'\n                        }}>\n                            {resolvedMessageText}\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-6px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '6px solid transparent',\n                                borderRight: '6px solid transparent',\n                                borderTop: '6px solid rgba(255, 255, 255, 0.95)'\n                            }} />\n                            <div style={{\n                                position: 'absolute',\n                                left: '50%',\n                                bottom: '-7px',\n                                transform: 'translateX(-50%)',\n                                width: 0,\n                                height: 0,\n                                borderLeft: '7px solid transparent',\n                                borderRight: '7px solid transparent',\n                                borderTop: '7px solid rgba(0,0,0,0.6)',\n                                zIndex: -1\n                            }} />\n                        </div>\n                    )}\n                </div>\n                );\n            })()}\n\n            {/* Room Area Visibility Overlay */}\n            {(isRoomAreaVisible || showRoomMapContent || activeTool === 'area') && secretObj && secretObj.subtype === 'room' && mapType !== 'room' && (\n                <div style={{\n                    position: 'absolute',\n                    top: 0, left: 0,\n                    width: `${width * 32}px`,\n                    height: `${height * 32}px`,\n                    backgroundColor: 'rgba(255, 255, 0, 0.2)',\n                    border: '2px solid gold',\n                    boxSizing: 'border-box',\n                    zIndex: 4,\n                    pointerEvents: 'none',\n                    display: 'flex',\n                    flexDirection: 'column',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#000',\n                    fontSize: '10px',\n                    fontWeight: 'bold',\n                    textShadow: '0 0 2px #fff'\n                }}>\n                    <span style={{ fontSize: '14px' }}></span>\n                    <span style={{ whiteSpace: 'nowrap' }}>{objectMetadata?.[actualIndex]?.roomName || 'Unnamed'}</span>\n                    <span style={{ fontSize: '9px' }}>{width}x{height}m</span>\n                </div>\n            )}\n        </div>\n    );\n});\n","import React, { useCallback, useRef, useState } from 'react';\nimport { ObjectLinks } from './viewport/ObjectLinks';\nimport { EditorTile } from './viewport/EditorTile';\nimport PixiStage from '../game/PixiStage';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    registryItems,\n    hoverIndex,\n    highlightedIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    handleResizeStart,\n    handleMoveStart,\n    setIsDragging,\n    selectedTile,\n    weatherRain,\n    weatherSnow,\n    weatherClouds,\n    weatherFog,\n    weatherThunder,\n    weatherLavaRain,\n    weatherRadioactiveFog,\n    weatherMeteorRain,\n    mapType,\n    isRoomAreaVisible,\n    showRoomMapContent,\n    showMessages,\n    maps\n}) => {\n    const isEraserActive = activeTool === 'brush' && selectedTile === null;\n    const isBrushActive = activeTool === 'brush';\n    const isBucketActive = activeTool === 'bucket';\n    const tileSize = 32;\n    const gridRef = useRef(null);\n    const [cursorIndex, setCursorIndex] = useState(null);\n\n    const regions = React.useMemo(() => {\n        const res = [];\n        if (!objectMetadata) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            if (meta.width > 1 || meta.height > 1) {\n                const idx = parseInt(idxStr);\n                res.push({ \n                    idx, \n                    x: idx % mapWidth, \n                    y: Math.floor(idx / mapWidth), \n                    w: meta.width || 1, \n                    h: meta.height || 1 \n                });\n            }\n        }\n        return res;\n    }, [objectMetadata, mapWidth]);\n\n    const roomAreas = React.useMemo(() => {\n        const res = [];\n        if (!secretMapData || !objectMetadata || !showRoomMapContent) return res;\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                res.push({\n                    id: meta.linkedMapId,\n                    x: idx % mapWidth,\n                    y: Math.floor(idx / mapWidth),\n                    width: meta.width || 1,\n                    height: meta.height || 1,\n                    mapData: maps[meta.linkedMapId]\n                });\n            }\n        }\n        return res;\n    }, [secretMapData, objectMetadata, showRoomMapContent, maps, mapWidth]);\n\n    const getLayerColor = (layer, alpha = 0.5) => {\n        if (layer === 'tile') return `rgba(24, 144, 255, ${alpha})`;\n        if (layer === 'object') return `rgba(245, 34, 45, ${alpha})`;\n        if (layer === 'secret') return `rgba(114, 46, 209, ${alpha})`;\n        return `rgba(255, 255, 255, ${alpha})`;\n    };\n\n    const getGridStyles = () => {\n        let color = 'rgba(255, 255, 255, 0.15)';\n        let visible = showGrid;\n\n        if (isEraserActive) {\n            color = getLayerColor(activeLayer, 0.4);\n            visible = true;\n        } else if (isBrushActive || isBucketActive) {\n            color = getLayerColor(activeLayer, 0.25);\n            visible = true; // Auto-show grid when using drawing tools\n        }\n\n        return {\n            backgroundImage: visible ? `\n                linear-gradient(to right, ${color} 1px, transparent 1px),\n                linear-gradient(to bottom, ${color} 1px, transparent 1px)\n            ` : 'none',\n            backgroundSize: '32px 32px'\n        };\n    };\n\n    const getLayerFilter = useCallback((layer) => {\n        if (!isEraserActive) return 'none';\n        return activeLayer === layer ? 'none' : 'grayscale(100%) opacity(0.2) blur(2px)';\n    }, [isEraserActive, activeLayer]);\n\n    const getPlacementAnchor = useCallback((tile, layer) => {\n        if (!tile) return { x: 0, y: 0 };\n        if (layer !== 'object' && layer !== 'props') return { x: 0, y: 0 };\n        const width = Number(tile.width ?? 1);\n        const height = Number(tile.height ?? 1);\n        if (tile.type === 'decoration' && (width > 1 || height > 1)) {\n            return { x: Math.floor(width / 2), y: height - 1 };\n        }\n        return { x: 0, y: 0 };\n    }, []);\n\n    const handleGridMouseMove = useCallback((event) => {\n        const rect = gridRef.current ? gridRef.current.getBoundingClientRect() : event.currentTarget.getBoundingClientRect();\n        const localX = event.clientX - rect.left;\n        const localY = event.clientY - rect.top;\n        if (localX < 0 || localY < 0 || localX >= mapWidth * tileSize || localY >= mapHeight * tileSize) {\n            handleGridMouseLeave();\n            setCursorIndex(null);\n            return;\n        }\n        const gridX = Math.floor(localX / tileSize);\n        const gridY = Math.floor(localY / tileSize);\n        if (gridX < 0 || gridY < 0 || gridX >= mapWidth || gridY >= mapHeight) return;\n        const nextIndex = gridY * mapWidth + gridX;\n        setCursorIndex(prev => (prev === nextIndex ? prev : nextIndex));\n        handleGridMouseEnter(nextIndex);\n    }, [handleGridMouseEnter, handleGridMouseLeave, mapWidth, mapHeight, tileSize]);\n\n    const getOverlayColor = () => {\n        if (!isEraserActive) return 'transparent';\n        if (activeLayer === 'tile') return 'rgba(24, 144, 255, 0.25)'; // Blueish for blocks\n        if (activeLayer === 'object') return 'rgba(245, 34, 45, 0.25)'; // Reddish for objects\n        if (activeLayer === 'secret') return 'rgba(114, 46, 209, 0.25)'; // Purplish for secrets\n        return 'transparent';\n    };\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => handleGridMouseUp(hoverIndex)}\n            onMouseMove={handleGridMouseMove}\n            onContextMenu={(e) => e.preventDefault()}>\n            <div\n                style={{\n                    position: 'relative',\n                    width: mapWidth * tileSize,\n                    height: mapHeight * tileSize,\n                    overflow: 'hidden'\n                }}\n                onMouseLeave={() => {\n                    handleGridMouseLeave();\n                    setCursorIndex(null);\n                }}\n            >\n                \n                <ObjectLinks \n                    mapWidth={mapWidth} \n                    mapHeight={mapHeight} \n                    objectMapData={objectMapData} \n                    objectMetadata={objectMetadata} \n                />\n\n                {/* Room Map Content Overlay */}\n                {showRoomMapContent && roomAreas.map(room => (\n                    <div\n                        key={room.id}\n                        style={{\n                            position: 'absolute',\n                            left: room.x * 32,\n                            top: room.y * 32,\n                            width: room.width * 32,\n                            height: room.height * 32,\n                            zIndex: 6,\n                            pointerEvents: 'none',\n                            overflow: 'hidden',\n                            boxShadow: '0 0 15px rgba(0,0,0,0.5)',\n                            border: '2px solid #f39c12'\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={room.mapData.mapWidth}\n                            mapHeight={room.mapData.mapHeight}\n                            tileSize={32}\n                            tileMapData={room.mapData.tileMapData || []}\n                            objectMapData={room.mapData.objectMapData || []}\n                            secretMapData={room.mapData.secretMapData || []}\n                            objectMetadata={room.mapData.objectMetadata || {}}\n                            registryItems={registryItems}\n                            backgroundColor={room.mapData.selectedBackgroundColor}\n                            backgroundImage={room.mapData.selectedBackgroundImage}\n                            backgroundParallaxFactor={room.mapData.backgroundParallaxFactor}\n                            isEditor={true}\n                            mapType={room.mapData.type || 'room'}\n                        />\n                    </div>\n                ))}\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        backgroundImage: (selectedBackgroundUrl && showBackgroundImage && !isEraserActive) ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: (isEraserActive || !showBackgroundImage || !selectedBackgroundUrl) ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x', backgroundSize: 'auto 100%',\n                        zIndex: 0, pointerEvents: 'none'\n                    }}\n                />\n\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        backgroundColor: getOverlayColor(),\n                        zIndex: 5, pointerEvents: 'none',\n                        transition: 'background-color 0.3s ease'\n                    }}\n                />\n\n                {/* Top Grid Overlay */}\n                <div\n                    style={{\n                        position: 'absolute', top: 0, left: 0,\n                        width: mapWidth * tileSize, height: mapHeight * tileSize,\n                        zIndex: 10, pointerEvents: 'none',\n                        ...getGridStyles()\n                    }}\n                />\n\n                {isBrushActive && selectedTile && (activeLayer === 'object' || activeLayer === 'props') && (cursorIndex !== null || hoverIndex !== null) && (\n                    (() => {\n                        const previewIndex = cursorIndex !== null ? cursorIndex : hoverIndex;\n                        const anchor = getPlacementAnchor(selectedTile, activeLayer);\n                        const gridX = previewIndex % mapWidth;\n                        const gridY = Math.floor(previewIndex / mapWidth);\n                        const previewX = (gridX - anchor.x) * tileSize;\n                        const previewY = (gridY - anchor.y) * tileSize;\n                        const previewW = Number(selectedTile.width ?? 1) * tileSize;\n                        const previewH = Number(selectedTile.height ?? 1) * tileSize;\n                        const renderOffsetX = Number(selectedTile?.render?.offsetX) || 0;\n                        const renderOffsetY = Number(selectedTile?.render?.offsetY) || 0;\n                        const overlapX = Number(selectedTile?.render?.overlapX) || 0;\n                        const overlapY = Number(selectedTile?.render?.overlapY) || 0;\n\n                        return (\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    top: 0,\n                                    left: 0,\n                                    width: mapWidth * tileSize,\n                                    height: mapHeight * tileSize,\n                                    overflow: 'hidden',\n                                    pointerEvents: 'none',\n                                    zIndex: 9\n                                }}\n                            >\n                                <div\n                                    style={{\n                                        position: 'absolute',\n                                        left: previewX + renderOffsetX - overlapX / 2,\n                                        top: previewY + renderOffsetY - overlapY / 2,\n                                        width: previewW + overlapX,\n                                        height: previewH + overlapY,\n                                        opacity: 0.6,\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center'\n                                    }}\n                                >\n                                    <AnimatedItem\n                                        textures={selectedTile.textures}\n                                        texture={selectedTile.texture}\n                                        speed={selectedTile.animationSpeed}\n                                        spriteSheet={selectedTile.spriteSheet}\n                                        style={{\n                                            width: '100%',\n                                            height: '100%',\n                                            objectFit: selectedTile.type === 'decoration' ? 'cover' : 'contain'\n                                        }}\n                                        alt={selectedTile.name}\n                                    />\n                                </div>\n                            </div>\n                        );\n                    })()\n                )}\n\n                {/* Weather Effects Overlay */}\n                {(weatherRain > 0 || weatherSnow > 0 || weatherClouds > 0 || weatherFog > 0 || weatherThunder > 0 || weatherLavaRain > 0 || weatherRadioactiveFog > 0 || weatherMeteorRain > 0) && (\n                    <div\n                        style={{\n                            position: 'absolute', top: 0, left: 0,\n                            width: mapWidth * 32, height: mapHeight * 32,\n                            zIndex: 15, pointerEvents: 'none',\n                        }}\n                    >\n                        <PixiStage \n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={[]}\n                            objectMapData={[]}\n                            registryItems={registryItems}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            renderLayers={['weather']}\n                            pointerEvents=\"none\"\n                        />\n                    </div>\n                )}\n\n                <div className=\"grid\"\n                    ref={gridRef}\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px', border: '1px solid #444', backgroundColor: 'transparent',\n                        position: 'relative', cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}\n                    onMouseMove={handleGridMouseMove}\n                    onContextMenu={(e) => e.preventDefault()}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        let dTileId = tileMapData[index];\n                        let dObjId = objectMapData[index];\n                        let dSecId = secretMapData?.[index];\n\n                        if (selection && previewPosition) {\n                            const { w, h } = selection;\n                            const px = previewPosition.x;\n                            const py = previewPosition.y;\n                            if (x >= px && x < px + w && y >= py && y < py + h) {\n                                const idx = (y - py) * w + (x - px);\n                                dTileId = selection.tileData[idx];\n                                dObjId = selection.objectData[idx];\n                                dSecId = selection.secretData?.[idx];\n                            }\n                        }\n\n                        const tileObj = dTileId ? registryItems.find(r => r.id === dTileId) : null;\n                        const objObj = dObjId ? registryItems.find(r => r.id === dObjId) : null;\n                        const secretObj = dSecId ? registryItems.find(r => r.id === dSecId) : null;\n\n                        let borderStyle = 'none';\n                        let bgStyle = 'transparent';\n\n                        const layerColor = getLayerColor(activeLayer, 1);\n\n                        if (activeTool === 'brush' && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) {\n                                borderStyle = `1px dashed ${layerColor}`;\n                                if (isEraserActive) bgStyle = 'rgba(255, 0, 0, 0.1)';\n                            }\n                        } else if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                            else if (hoverIndex === index) borderStyle = '2px solid orange';\n                        } else if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid blue';\n                        } else if (activeTool === 'area') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const minX = Math.min(dragStart.x, hx);\n                                const minY = Math.min(dragStart.y, hy);\n                                const maxX = Math.max(dragStart.x, hx);\n                                const maxY = Math.max(dragStart.y, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { \n                                    borderStyle = '1px dashed gold'; \n                                    bgStyle = 'rgba(255, 255, 0, 0.2)'; \n                                }\n                            } else if (!isDragging && hoverIndex === index) borderStyle = '2px solid gold';\n                        }\n\n                        if (highlightedIndex === index) { borderStyle = '3px solid gold'; bgStyle = 'rgba(255, 215, 0, 0.4)'; }\n                        \n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                borderStyle = '2px solid cyan'; bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red'; bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n\n                        const parentRegion = regions.find(r => x >= r.x && x < r.x + r.w && y >= r.y && y < r.y + r.h);\n\n                        return (\n                            <EditorTile \n                                key={index}\n                                index={index}\n                                x={x} y={y}\n                                activeTool={activeTool}\n                                tileObj={tileObj}\n                                objObj={objObj}\n                                secretObj={secretObj}\n                                objectMetadata={objectMetadata}\n                                isHighlighted={highlightedIndex === index || (parentRegion && highlightedIndex === parentRegion.idx)}\n                                parentRegionIndex={parentRegion ? parentRegion.idx : null}\n                                borderStyle={borderStyle}\n                                bgStyle={bgStyle}\n                                handleGridMouseDown={handleGridMouseDown}\n                                handleGridMouseEnter={handleGridMouseEnter}\n                                handleResizeStart={handleResizeStart}\n                                handleMoveStart={handleMoveStart}\n                                filter={getLayerFilter}\n                                mapType={mapType}\n                                isRoomAreaVisible={isRoomAreaVisible}\n                                showRoomMapContent={showRoomMapContent}\n                                showMessages={showMessages}\n                            />\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const EditorToolsContainer = styled.div`\n    display: contents;\n`;\n\nexport const HeaderBar = styled.div`\n    padding: 0 15px;\n    background-color: #222;\n    border-bottom: none;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 60px;\n    box-sizing: border-box;\n    color: #fff;\n    z-index: 1105;\n    position: relative;\n\n    &::after {\n        content: \"\";\n        position: absolute;\n        left: 60px;\n        right: 0;\n        bottom: 0;\n        height: 1px;\n        background-color: #000;\n        pointer-events: none;\n    }\n`;\n\nexport const ToolsSection = styled.div`\n    display: flex;\n    gap: 15px;\n    align-items: center;\n`;\n\nexport const ToolsGroup = styled.div`\n    display: flex;\n    gap: 10px;\n    align-items: center;\n`;\n\nexport const ToolsInnerGroup = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsRow = styled.div`\n    display: flex;\n    gap: 10px;\n`;\n\nexport const ToolsEditorButton = styled.button`\n    min-width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : (props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : (props.$variant === 'danger' ? '#dc3545' : (props.$variant === 'secondary' ? '#f0f0f0' : '#333'))))};\n    color: ${props => props.$variant === 'secondary' ? '#333' : '#fff'};\n    border: 1px solid ${props => props.$active ? '#1E88E5' : (props.$variant === 'play' ? '#388E3C' : (props.$variant === 'pause' ? '#F57C00' : (props.$variant === 'danger' ? '#c82333' : (props.$variant === 'secondary' ? '#ccc' : '#fff'))))};\n    border-radius: 4px;\n    font-size: ${props => props.$small ? '14px' : '20px'};\n    font-weight: ${props => props.$variant === 'play' || props.$variant === 'pause' ? 'bold' : 'normal'};\n    line-height: 1;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: ${props => props.$square ? '0' : '0 15px'};\n    width: ${props => props.$square ? '40px' : 'auto'};\n    outline: none;\n    user-select: none;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : (props.$variant === 'play' ? '#45a049' : (props.$variant === 'pause' ? '#fb8c00' : (props.$variant === 'danger' ? '#bd2130' : (props.$variant === 'secondary' ? '#e0e0e0' : '#444'))))};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n\n    span {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n`;\n\nexport const StrikeThrough = styled.div`\n    position: absolute;\n    width: 100%;\n    height: 2px;\n    background-color: #f5222d;\n    transform: rotate(-45deg);\n    top: 50%;\n    left: 0;\n    z-index: 2;\n    pointer-events: none;\n`;\n\nexport const LayerIndicator = styled.div`\n    padding: 0 12px;\n    height: 40px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    font-size: 11px;\n    font-weight: 800;\n    text-transform: uppercase;\n    margin-right: 15px;\n    margin-left: 15px;\n    white-space: nowrap;\n    border: 1px solid;\n    box-sizing: border-box;\n    background-color: ${props => props.$bgColor || '#e6f7ff'};\n    border-color: ${props => props.$borderColor || '#91d5ff'};\n    color: ${props => props.$textColor || '#1890ff'};\n`;\n\nexport const BgColorContainer = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n`;\n\nexport const BgColorInputWrapper = styled.div`\n    position: relative;\n    display: flex;\n    align-items: center;\n`;\n\nexport const BgColorInput = styled.input`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    opacity: ${props => props.disabled ? 0.4 : 1};\n    cursor: ${props => props.disabled ? 'not-allowed' : 'pointer'};\n`;\n\nexport const BgTransparentButton = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &::after {\n        content: \"\";\n        width: 100%;\n        height: 100%;\n        background-image: \n            linear-gradient(45deg, #ccc 25%, transparent 25%), \n            linear-gradient(-45deg, #ccc 25%, transparent 25%), \n            linear-gradient(45deg, transparent 75%, #ccc 75%), \n            linear-gradient(-45deg, transparent 75%, #ccc 75%);\n        background-size: 8px 8px;\n        background-position: 0 0, 0 4px, 4px 4px, 4px 0;\n        background-color: #fff;\n        opacity: 0.8;\n        border-radius: 2px;\n    }\n`;\n\nexport const PlayButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid #fff;\n    padding: 4px;\n    cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const PlayButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$variant === 'play' ? '#4CAF50' : (props.$variant === 'pause' ? '#FF9800' : '#333')};\n    color: #fff;\n    font-size: 18px;\n    box-sizing: border-box;\n`;\n\nexport const InfoContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    align-items: flex-start;\n    color: #bbb;\n    margin-left: auto;\n`;\n\nexport const InfoItem = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 6px;\n`;\n\nexport const InfoLabel = styled.span`\n    font-size: 11px;\n    text-transform: uppercase;\n    opacity: 0.8;\n`;\n\nexport const InfoValue = styled.span`\n    color: #fff;\n    font-size: 12px;\n`;\n\nexport const EraserButtonContainer = styled.div`\n    width: 40px;\n    height: 40px;\n    border: 1px solid ${props => props.$active ? '#e3de0a' : '#fff'};\n    padding: 4px;\n    //cursor: pointer;\n    background-color: #333;\n    border-radius: 4px;\n    box-sizing: border-box;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    opacity: ${props => props.$disabled ? 0.4 : 1};\n    cursor: ${props => props.$disabled ? 'not-allowed' : 'pointer'};\n    position: relative;\n\n    &:hover {\n        transform: scale(1.05);\n        background-color: #444;\n    }\n\n    &:active {\n        transform: scale(0.95);\n    }\n`;\n\nexport const EraserButtonInner = styled.div`\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: ${props => props.$active ? (props.$textColor || '#1890ff') : (props.$bgColor || '#f0f0f0')};\n    color: ${props => props.$active ? '#fff' : (props.$textColor || '#000')};\n    font-size: 11px;\n    font-weight: bold;\n    border: ${props => props.$active ? '1px solid #fff' : 'none'};\n    box-sizing: border-box;\n`;\n\nexport const SelectionActions = styled.div`\n    display: flex;\n    gap: 5px;\n    margin-left: 5px;\n    border-left: 1px solid #ccc;\n    padding-left: 5px;\n`;\n\nexport const ConfirmButton = styled(ToolsEditorButton)`\n    background-color: #e6f7ff;\n    color: #1890ff;\n    \n    &:hover {\n        background-color: #bae7ff;\n    }\n`;\n\nexport const CancelButton = styled(ToolsEditorButton)`\n    background-color: #fff1f0;\n    color: #f5222d;\n\n    &:hover {\n        background-color: #ffccc7;\n    }\n`;\n\nexport const GridIcon = styled.span`\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n`;\n","import styled from 'styled-components';\n\n/*\n* Container*/\nexport const SidebarContainer = styled.div`\n    width: 60px;\n    height: 100%;\n    background-color: #222;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding-top: 10px;\n    z-index: 1100;\n    border-right: 1px solid #000;\n    flex-shrink: 0;\n    overflow-y: auto;\n\n    &::-webkit-scrollbar {\n        width: 0px;\n        background: transparent;\n    }\n    \n    -ms-overflow-style: none;\n    scrollbar-width: none;\n`;\n\nexport const ElementEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const PanelContainer = styled.div`\n    position: absolute;\n    left: 60px;\n    top: 60px;\n    width: 320px;\n    height: calc(100% - 60px);\n    background-color: #fff;\n    border-right: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    z-index: 1090;\n    box-shadow: 4px 0 10px rgba(0,0,0,0.2);\n    \n    /* Animation settings */\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;\n    transform: ${props => props.$isOpen ? 'translateX(0)' : 'translateX(-110%)'};\n    opacity: ${props => props.$isOpen ? '1' : '0'};\n    pointer-events: ${props => props.$isOpen ? 'all' : 'none'};\n`;\n\nexport const PanelHeader = styled.div`\n    padding: 8px 15px;\n    background-color: #f0f0f0;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: bold;\n    font-size: 12px;\n    height: 32px;\n    box-sizing: border-box;\n    color: #333;\n\n    span {\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n`;\n\nexport const PanelBody = styled.div`\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n`;\n\nexport const CloseButton = styled.button`\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 16px;\n    padding: 0 5px;\n    color: #666;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    outline: none;\n\n    &:hover {\n        color: #333;\n    }\n`;\n\nexport const OperationButton = styled.button`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: ${props => props.$danger ? '#d32f2f' : '#000'};\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n    outline: none;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n\n// Also exporting as a label for file input usage in OperationsPanel\nexport const OperationLabel = styled.label`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    border: 1px solid #333;\n    padding: 0 10px;\n    height: 40px;\n    width: 100%;\n    background-color: #f0f0f0;\n    font-size: 13px;\n    color: #000;\n    border-radius: 3px;\n    user-select: none;\n    box-sizing: border-box;\n    transition: all 0.2s ease;\n    gap: 8px;\n\n    &:hover {\n        background-color: #e0e0e0;\n        border-color: #000;\n    }\n\n    &:active {\n        transform: scale(0.98);\n    }\n`;\n","import React from 'react';\nimport { ToolsEditorButton } from '../styles/EditorToolsButton';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    tempMapDescription,\n    setTempMapDescription,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', borderRadius: '8px',\n                boxShadow: '0 8px 24px rgba(0,0,0,0.2)', width: '320px',\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\n            }}>\n                <div style={{\n                    padding: '12px 15px',\n                    borderBottom: '2px solid #eee',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center'\n                }}>\n                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 'bold', color: '#333' }}>Create New Map</h3>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </div>\n\n                <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Map Name:</label>\n                        <input\n                            type=\"text\"\n                            value={tempMapName}\n                            onChange={(e) => setTempMapName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Creator Nickname:</label>\n                        <input\n                            type=\"text\"\n                            value={tempCreatorName}\n                            onChange={(e) => setTempCreatorName(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box' }}\n                        />\n                    </div>\n\n                    <div>\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 'bold', marginBottom: '6px', color: '#666' }}>Description:</label>\n                        <textarea\n                            value={tempMapDescription}\n                            onChange={(e) => setTempMapDescription(e.target.value)}\n                            style={{ width: '100%', padding: '8px', borderRadius: '4px', border: '1px solid #ccc', boxSizing: 'border-box', minHeight: '60px', resize: 'vertical' }}\n                        />\n                    </div>\n\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                        <ToolsEditorButton onClick={onClose} $variant=\"secondary\" $small>\n                            Cancel\n                        </ToolsEditorButton>\n                        <ToolsEditorButton onClick={() => confirmNewMap(tempMapName, tempCreatorName, tempMapDescription)} $variant=\"play\" $small>\n                            Create\n                        </ToolsEditorButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { BUILT_IN_MAPS } from '../../../../constants/builtInMaps';\nimport { CloseButton } from '../styles/EditorElementsButtonStyle';\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 900px;\n    max-width: 95%;\n    max-height: 85%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalHeader = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    font-size: 24px;\n    color: #333;\n`;\n\nconst MapList = styled.div`\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 15px;\n    padding: 5px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 15px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    transition: all 0.2s ease;\n\n    &:hover {\n        background-color: #f0f7ff;\n        border-color: #2196f3;\n        transform: translateY(-3px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n    color: #333;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapDescription = styled.div`\n    font-size: 11px;\n    color: #777;\n    font-style: italic;\n    line-height: 1.4;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    min-height: 45px;\n`;\n\nconst MapInfo = styled.div`\n    margin-top: auto;\n    padding-top: 8px;\n    border-top: 1px solid #eee;\n    font-size: 11px;\n    color: #555;\n    display: flex;\n    justify-content: space-between;\n`;\n\nexport const BuiltInMapsModal = ({ isOpen, onClose, onSelect }) => {\n    if (!isOpen) return null;\n\n    return (\n        <ModalOverlay onClick={onClose}>\n            <ModalContent onClick={e => e.stopPropagation()}>\n                <ModalHeader>\n                    <ModalTitle>Select a Built-in Map to Edit</ModalTitle>\n                    <CloseButton onClick={onClose}></CloseButton>\n                </ModalHeader>\n                \n                <MapList>\n                    {BUILT_IN_MAPS.map((map, index) => {\n                        const isV2 = map.meta?.version === \"2.0\";\n                        const projectName = map.meta?.projectName || map.meta?.name || \"Unnamed Map\";\n                        const author = map.meta?.author || \"Unknown\";\n                        const description = map.meta?.description || \"\";\n                        \n                        let sizeInfo = \"\";\n                        let subMapInfo = \"\";\n\n                        if (isV2 && map.maps) {\n                            const mainMap = map.maps[map.meta?.activeMapId || 'main'] || Object.values(map.maps)[0];\n                            if (mainMap) {\n                                sizeInfo = `${mainMap.width}x${mainMap.height}`;\n                            }\n                            \n                            const mapValues = Object.values(map.maps);\n                            const overworldCount = mapValues.filter(m => m.type === 'overworld').length;\n                            const underworldCount = mapValues.filter(m => m.type === 'underworld').length;\n                            \n                            subMapInfo = ` (O:${overworldCount}, U:${underworldCount})`;\n                        } else {\n                            sizeInfo = `${map.meta?.width || map.width || 0}x${map.meta?.height || map.height || 0}`;\n                        }\n\n                        return (\n                            <MapCard key={index} onClick={() => {\n                                onSelect(map);\n                                onClose();\n                            }}>\n                                <div>\n                                    <MapTitle>{projectName}</MapTitle>\n                                    <MapAuthor>By: {author}</MapAuthor>\n                                </div>\n                                {description && (\n                                    <MapDescription title={description}>\n                                        {description}\n                                    </MapDescription>\n                                )}\n                                <MapInfo>\n                                    <div>Size: {sizeInfo}{subMapInfo}</div>\n                                </MapInfo>\n                            </MapCard>\n                        );\n                    })}\n                </MapList>\n            </ModalContent>\n        </ModalOverlay>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nlet topZIndex = 1002;\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [position] = useState(defaultPosition);\n    const [zIndex, setZIndex] = useState(() => {\n        topZIndex += 1;\n        return topZIndex;\n    });\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    const lastHeightRef = useRef(0);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            if (height !== lastHeightRef.current) {\n                lastHeightRef.current = height;\n                onHeightChange(height);\n            }\n        }\n    });\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            topZIndex += 1;\n            setZIndex(topZIndex);\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#fff',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n                zIndex: zIndex,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh',\n                overflow: 'hidden'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '12px 15px',\n                    backgroundColor: '#fff',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '18px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '2px solid #eee',\n                    color: '#333'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0,\n                            color: '#333'\n                        }}\n                        title={isMinimized ? t('EDITOR_SCENE_WINDOW_MAXIMIZE') : t('EDITOR_SCENE_WINDOW_MINIMIZE')}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f0f0f0',\n                            border: '1px solid #ccc',\n                            borderRadius: '4px',\n                            width: '24px',\n                            height: '24px',\n                            cursor: 'pointer',\n                            color: '#333',\n                            fontSize: '14px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title={t('EDITOR_SCENE_WINDOW_CLOSE')}\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '15px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const EditorMapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const MIN_SIZE = 5;\n    const MAX_WIDTH = 300;\n    const MAX_HEIGHT = 100;\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n    const [inputSize, setInputSize] = useState({ width: String(mapWidth), height: String(mapHeight) });\n\n    useEffect(() => {\n        setInputSize({ width: String(mapWidth), height: String(mapHeight) });\n    }, [mapWidth, mapHeight]);\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(MIN_SIZE, Math.min(MAX_WIDTH, startSize.width + blocksX));\n            const newHeight = Math.max(MIN_SIZE, Math.min(MAX_HEIGHT, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    const parseSize = (value) => {\n        const parsed = Number(value);\n        if (!Number.isFinite(parsed)) return null;\n        return Math.round(parsed);\n    };\n\n    const applyInputResize = () => {\n        const widthValue = parseSize(inputSize.width);\n        const heightValue = parseSize(inputSize.height);\n\n        if (widthValue === null || heightValue === null) {\n            setInputSize({ width: String(mapWidth), height: String(mapHeight) });\n            return;\n        }\n\n        const newWidth = Math.max(MIN_SIZE, Math.min(MAX_WIDTH, widthValue));\n        const newHeight = Math.max(MIN_SIZE, Math.min(MAX_HEIGHT, heightValue));\n\n        setInputSize({ width: String(newWidth), height: String(newHeight) });\n        if (newWidth !== mapWidth || newHeight !== mapHeight) {\n            onResize(newWidth, newHeight);\n        }\n    };\n\n    const handleInputKeyDown = (e) => {\n        if (e.key === 'Enter') {\n            e.preventDefault();\n            applyInputResize();\n        }\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                {t('EDITOR_SCENE_RESIZER_LABEL')}{' '}\n                <span style={{ color: '#4CAF50' }}>{mapWidth} x {mapHeight}</span>{' '}\n                {t('EDITOR_SCENE_RESIZER_BLOCKS')}\n            </div>\n\n            <div style={{ display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: '8px' }}>\n                <label style={{ display: 'flex', flexDirection: 'column', gap: '4px', fontSize: '11px', color: '#555' }}>\n                    {t('EDITOR_SCENE_RESIZER_WIDTH')}\n                    <input\n                        type=\"number\"\n                        min={MIN_SIZE}\n                        max={MAX_WIDTH}\n                        step=\"1\"\n                        value={inputSize.width}\n                        onChange={(e) => setInputSize(prev => ({ ...prev, width: e.target.value }))}\n                        onKeyDown={handleInputKeyDown}\n                        style={{ width: '72px', padding: '4px 6px', borderRadius: '4px', border: '1px solid #ccc' }}\n                    />\n                </label>\n                <span style={{ fontSize: '14px', color: '#666', paddingBottom: '6px' }}></span>\n                <label style={{ display: 'flex', flexDirection: 'column', gap: '4px', fontSize: '11px', color: '#555' }}>\n                    {t('EDITOR_SCENE_RESIZER_HEIGHT')}\n                    <input\n                        type=\"number\"\n                        min={MIN_SIZE}\n                        max={MAX_HEIGHT}\n                        step=\"1\"\n                        value={inputSize.height}\n                        onChange={(e) => setInputSize(prev => ({ ...prev, height: e.target.value }))}\n                        onKeyDown={handleInputKeyDown}\n                        style={{ width: '72px', padding: '4px 6px', borderRadius: '4px', border: '1px solid #ccc' }}\n                    />\n                </label>\n                <button\n                    type=\"button\"\n                    onClick={applyInputResize}\n                    style={{\n                        padding: '6px 10px',\n                        borderRadius: '4px',\n                        border: '1px solid #4CAF50',\n                        backgroundColor: '#4CAF50',\n                        color: '#fff',\n                        cursor: 'pointer',\n                        fontSize: '11px',\n                        fontWeight: 'bold'\n                    }}\n                >\n                    {t('EDITOR_SCENE_RESIZER_APPLY')}\n                </button>\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: 2,\n                        right: 2,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 {t('EDITOR_SCENE_RESIZER_HINT_LINE1')}<br/>\n                {t('EDITOR_SCENE_RESIZER_HINT_LINE2')}\n            </div>\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundColor\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = backgroundColor || '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.lava_waterfall) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.radioactive_waterfall) {\n                                ctx.fillStyle = '#32cd32';\n                            } else if (tile.flags.waterfall) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.water) {\n                                ctx.fillStyle = '#3a7fb8';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#ffcc00';\n                            } else if (tile.flags.quicksand) {\n                                ctx.fillStyle = '#a6915b';\n                            } else if (tile.flags.radioactive_water) {\n                                ctx.fillStyle = '#32cd32';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n        // Draw connections between portals and targets\n        if (objectMetadata) {\n            const portals = [];\n            const targets = [];\n\n            for (let i = 0; i < mapWidth * mapHeight; i++) {\n                const id = objectMapData[i];\n                if (!id) continue;\n                const metadata = objectMetadata[i];\n                if (!metadata || metadata.triggerId === null || metadata.triggerId === undefined) continue;\n\n                const pos = {\n                    x: (i % mapWidth) * tileWidth + tileWidth / 2,\n                    y: Math.floor(i / mapWidth) * tileHeight + tileHeight / 2\n                };\n\n                if (id.includes('portal') && !id.includes('target')) {\n                    portals.push({ triggerId: metadata.triggerId, pos });\n                } else if (id.includes('target') || id === 'portal_target') {\n                    targets.push({ triggerId: metadata.triggerId, pos });\n                }\n            }\n\n            portals.forEach(portal => {\n                const target = targets.find(t => t.triggerId === portal.triggerId);\n                if (target) {\n                    ctx.beginPath();\n                    ctx.setLineDash([5, 3]);\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.moveTo(portal.pos.x, portal.pos.y);\n                    ctx.lineTo(target.pos.x, target.pos.y);\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n                }\n            });\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, objectMetadata, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useRef, useEffect, useMemo, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WorldView = ({\n    maps,\n    activeMapId,\n    switchMap,\n    registryItems,\n    currentMapData,\n    createMap,\n    deleteMap,\n    updateMapData,\n    onAddRoomArea,\n    showRoomMapContent\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const canvasRef = useRef(null);\n    const containerRef = useRef(null);\n    const mapLayoutsRef = useRef({});\n    const dragRef = useRef(null); // { id, startX, startY, mapStartX, mapStartY }\n\n    // Prepare all maps data, using live data for the active map\n    const allMaps = useMemo(() => {\n        const result = { ...maps };\n        if (currentMapData && currentMapData.id && result[currentMapData.id]) {\n            result[currentMapData.id] = {\n                ...result[currentMapData.id],\n                mapWidth: currentMapData.mapWidth,\n                mapHeight: currentMapData.mapHeight,\n                tileMapData: currentMapData.tileMapData,\n                objectMapData: currentMapData.objectMapData,\n                objectMetadata: currentMapData.objectMetadata,\n                selectedBackgroundColor: currentMapData.selectedBackgroundColor\n            };\n        }\n        return Object.values(result);\n    }, [maps, currentMapData]);\n\n    // Draw function\n    const draw = useCallback(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        \n        // Settings\n        const baseTileSize = 4; // Each tile in world view\n        \n        // Sync mapLayoutsRef with allMaps, but preserve positions for maps being dragged\n        const layouts = mapLayoutsRef.current;\n        \n        // Remove layouts for deleted maps\n        const currentIds = new Set(allMaps.map(m => m.id));\n        Object.keys(layouts).forEach(id => {\n            if (!currentIds.has(id)) {\n                delete layouts[id];\n            }\n        });\n\n        allMaps.forEach(map => {\n            const isDragging = dragRef.current && dragRef.current.id === map.id;\n            const w = map.mapWidth * baseTileSize;\n            const h = map.mapHeight * baseTileSize;\n\n            if (!layouts[map.id]) {\n                layouts[map.id] = { x: map.worldX || 0, y: map.worldY || 0, w, h, map };\n            } else {\n                layouts[map.id].w = w;\n                layouts[map.id].h = h;\n                layouts[map.id].map = map;\n                // Update position from props ONLY if not currently dragging this map\n                if (!isDragging) {\n                    layouts[map.id].x = map.worldX || 0;\n                    layouts[map.id].y = map.worldY || 0;\n                }\n            }\n        });\n\n        // Clear\n        ctx.fillStyle = '#222';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Grid (optional but helpful)\n        ctx.strokeStyle = '#333';\n        ctx.lineWidth = 1;\n        for (let x = 0; x < canvas.width; x += 50) {\n            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();\n        }\n        for (let y = 0; y < canvas.height; y += 50) {\n            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();\n        }\n\n        // 1. Draw Maps\n        Object.values(layouts).forEach(layout => {\n            const { x, y, w, h, map } = layout;\n            const tileW = w / map.mapWidth;\n            const tileH = h / map.mapHeight;\n\n            // Background\n            ctx.fillStyle = map.selectedBackgroundColor || '#87CEEB';\n            ctx.fillRect(x, y, w, h);\n\n            // Active indicator\n            if (map.id === activeMapId) {\n                ctx.strokeStyle = '#e3de0a';\n                ctx.lineWidth = 3;\n                ctx.strokeRect(x - 4, y - 4, w + 8, h + 8);\n            } else {\n                ctx.strokeStyle = '#555';\n                ctx.lineWidth = 1;\n                ctx.strokeRect(x, y, w, h);\n            }\n\n            // Name\n            ctx.fillStyle = '#fff';\n            ctx.font = 'bold 12px Arial';\n            ctx.fillText(map.name, x, y - 10);\n            ctx.font = '10px Arial';\n            ctx.fillStyle = '#aaa';\n            ctx.fillText(map.type, x, y + h + 12);\n\n            // Delete button (X)\n            if (map.id !== 'main') {\n                ctx.fillStyle = '#ff4d4f';\n                ctx.fillRect(x + w - 15, y - 25, 15, 15);\n                ctx.fillStyle = '#fff';\n                ctx.font = 'bold 12px Arial';\n                ctx.fillText('', x + w - 11, y - 13);\n            }\n\n            // Draw Tiles & Objects (simplified)\n            for (let i = 0; i < map.mapWidth * map.mapHeight; i++) {\n                const tx = (i % map.mapWidth) * tileW + x;\n                const ty = Math.floor(i / map.mapWidth) * tileH + y;\n\n                const tileId = map.tileMapData[i];\n                const objId = map.objectMapData[i];\n                const secretId = map.secretMapData ? map.secretMapData[i] : null;\n                const meta = map.objectMetadata ? map.objectMetadata[i] : null;\n\n                // If it's a room area and we want to show content\n                if (showRoomMapContent && secretId === 'room_area' && meta?.linkedMapId && layouts[meta.linkedMapId]) {\n                    const roomMap = layouts[meta.linkedMapId].map;\n                    const rW = meta.width || 1;\n                    const rH = meta.height || 1;\n                    const rAreaW = rW * tileW;\n                    const rAreaH = rH * tileH;\n                    const rTileW = rAreaW / roomMap.mapWidth;\n                    const rTileH = rAreaH / roomMap.mapHeight;\n\n                    // Room Background\n                    ctx.fillStyle = roomMap.selectedBackgroundColor || '#1a1a1a';\n                    ctx.fillRect(tx, ty, rAreaW, rAreaH);\n                    \n                    // Room Tiles (very simplified)\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n                    for (let ri = 0; ri < roomMap.mapWidth * roomMap.mapHeight; ri++) {\n                        if (roomMap.tileMapData[ri]) {\n                            ctx.fillRect(\n                                tx + (ri % roomMap.mapWidth) * rTileW,\n                                ty + Math.floor(ri / roomMap.mapWidth) * rTileH,\n                                Math.ceil(rTileW), Math.ceil(rTileH)\n                            );\n                        }\n                    }\n                    \n                    // Room Border\n                    ctx.strokeStyle = '#f39c12';\n                    ctx.lineWidth = 0.5;\n                    ctx.strokeRect(tx, ty, rAreaW, rAreaH);\n                } else {\n                    if (tileId) {\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (objId) {\n                        if (objId.includes('portal') && !objId.includes('target')) {\n                            ctx.fillStyle = '#007bff';\n                        } else if (objId.includes('target') || objId === 'portal_target') {\n                            ctx.fillStyle = '#ffc107';\n                        } else {\n                            ctx.fillStyle = '#dc3545';\n                        }\n                        ctx.fillRect(tx, ty, Math.ceil(tileW), Math.ceil(tileH));\n                    }\n                    if (secretId === 'room_area') {\n                        ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';\n                        ctx.fillRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                        ctx.strokeStyle = 'gold';\n                        ctx.lineWidth = 1;\n                        ctx.strokeRect(tx, ty, Math.ceil(tileW * (meta?.width || 1)), Math.ceil(tileH * (meta?.height || 1)));\n                    }\n                }\n            }\n        });\n\n        // 2. Draw Connections\n        ctx.setLineDash([5, 5]);\n        ctx.lineWidth = 2;\n\n        Object.values(layouts).forEach(sourceLayout => {\n            const { map: sourceMap, x: sx, y: sy, w: sw, h: sh } = sourceLayout;\n            const tileW = sw / sourceMap.mapWidth;\n            const tileH = sh / sourceMap.mapHeight;\n\n            const metadata = sourceMap.objectMetadata || {};\n            \n            for (let i = 0; i < sourceMap.mapWidth * sourceMap.mapHeight; i++) {\n                const objId = sourceMap.objectMapData[i];\n                if (!objId) continue;\n                \n                const meta = metadata[i];\n                if (!meta) continue;\n\n                // Identify if this is a connection source\n                const isPortalSource = objId.includes('portal') && !objId.includes('target');\n                const objDef = registryItems.find(r => r.id === objId);\n                const isDoorSource = objDef && objDef.subtype === 'door';\n\n                if (!isPortalSource && !isDoorSource) continue;\n\n                // For portals we match by triggerId, for doors by spawnTriggerId\n                const linkId = isPortalSource ? meta.triggerId : meta.spawnTriggerId;\n                if (linkId === null || linkId === undefined) continue;\n\n                const targetMapId = meta.targetMapId || sourceMap.id;\n                const targetLayout = layouts[targetMapId];\n\n                if (targetLayout) {\n                    const { map: targetMap, x: tx, y: ty, w: tw, h: th } = targetLayout;\n                    const tTileW = tw / targetMap.mapWidth;\n                    const tTileH = th / targetMap.mapHeight;\n\n                    // Find target object in target map\n                    for (let j = 0; j < targetMap.mapWidth * targetMap.mapHeight; j++) {\n                        const tObjId = targetMap.objectMapData[j];\n                        if (!tObjId) continue;\n\n                        const tObjDef = registryItems.find(r => r.id === tObjId);\n                        const isTarget = tObjId.includes('target') || tObjId === 'portal_target';\n                        const isDoorTarget = tObjDef && tObjDef.subtype === 'door';\n\n                        if (!isTarget && !isDoorTarget) continue;\n\n                        const tMeta = targetMap.objectMetadata?.[j];\n                        if (tMeta && tMeta.triggerId === linkId) {\n                            // Link found!\n                            const startX = sx + (i % sourceMap.mapWidth) * tileW + tileW / 2;\n                            const startY = sy + Math.floor(i / sourceMap.mapWidth) * tileH + tileH / 2;\n                            const endX = tx + (j % targetMap.mapWidth) * tTileW + tTileW / 2;\n                            const endY = ty + Math.floor(j / targetMap.mapWidth) * tTileH + tTileH / 2;\n\n                            // Draw line\n                            ctx.beginPath();\n                            ctx.strokeStyle = (sourceMap.id === targetMap.id) ? '#fff' : '#00ff00';\n                            ctx.moveTo(startX, startY);\n                            \n                            if (sourceMap.id !== targetMap.id) {\n                                // Calculate mid points for a nicer curve\n                                const cp1X = startX + (endX - startX) * 0.25;\n                                const cp1Y = Math.min(startY, endY) - 100;\n                                const cp2X = startX + (endX - startX) * 0.75;\n                                const cp2Y = Math.min(startY, endY) - 100;\n                                ctx.bezierCurveTo(cp1X, cp1Y, cp2X, cp2Y, endX, endY);\n                            } else {\n                                ctx.lineTo(endX, endY);\n                            }\n                            ctx.stroke();\n\n                            // Arrow head\n                            const angle = Math.atan2(endY - startY, endX - startX);\n                            ctx.save();\n                            ctx.setLineDash([]);\n                            ctx.translate(endX, endY);\n                            ctx.rotate(angle);\n                            ctx.beginPath();\n                            ctx.moveTo(0, 0);\n                            ctx.lineTo(-10, -5);\n                            ctx.lineTo(-10, 5);\n                            ctx.closePath();\n                            ctx.fillStyle = ctx.strokeStyle;\n                            ctx.fill();\n                            ctx.restore();\n                            \n                            break;\n                        }\n                    }\n                }\n            }\n        });\n    }, [allMaps, activeMapId, showRoomMapContent]);\n\n    useEffect(() => {\n        draw();\n    }, [allMaps, activeMapId, draw, showRoomMapContent]);\n\n    const handleMouseDown = (e) => {\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const layouts = Object.values(mapLayoutsRef.current || {});\n        \n        // Check for delete button first\n        for (const layout of layouts) {\n            if (layout.map.id !== 'main') {\n                const btnX = layout.x + layout.w - 15;\n                const btnY = layout.y - 25;\n                if (x >= btnX && x <= btnX + 15 && y >= btnY && y <= btnY + 15) {\n                    if (window.confirm(t('EDITOR_SCENE_WORLD_DELETE_CONFIRM', { name: layout.map.name }))) {\n                        deleteMap(layout.map.id);\n                    }\n                    return;\n                }\n            }\n        }\n\n        // Check for map drag/select\n        for (const layout of layouts) {\n            if (x >= layout.x && x <= layout.x + layout.w &&\n                y >= layout.y && y <= layout.y + layout.h) {\n                \n                if (e.detail === 2) { // Double click to switch\n                    switchMap(layout.map.id);\n                } else {\n                    dragRef.current = {\n                        id: layout.map.id,\n                        startX: x,\n                        startY: y,\n                        mapStartX: layout.x,\n                        mapStartY: layout.y\n                    };\n                }\n                return;\n            }\n        }\n    };\n\n    const handleMouseMove = (e) => {\n        if (!dragRef.current) return;\n\n        const rect = canvasRef.current.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const dx = x - dragRef.current.startX;\n        const dy = y - dragRef.current.startY;\n\n        const newX = Math.max(0, dragRef.current.mapStartX + dx);\n        const newY = Math.max(0, dragRef.current.mapStartY + dy);\n\n        // Update local layout for immediate visual feedback\n        if (mapLayoutsRef.current[dragRef.current.id]) {\n            mapLayoutsRef.current[dragRef.current.id].x = newX;\n            mapLayoutsRef.current[dragRef.current.id].y = newY;\n            draw();\n        }\n    };\n\n    const handleMouseUp = (e) => {\n        if (!dragRef.current) return;\n\n        const layout = mapLayoutsRef.current[dragRef.current.id];\n        if (layout) {\n            updateMapData(dragRef.current.id, {\n                worldX: layout.x,\n                worldY: layout.y\n            });\n        }\n        \n        dragRef.current = null;\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '10px' }}>\n            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n                <button\n                    onClick={() => switchMap('main')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#1e88e5', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_MAIN')}\n                </button>\n                <button \n                    onClick={() => createMap('overworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_OVERWORLD')}\n                </button>\n                <button \n                    onClick={() => createMap('sea_rescue')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#00bcd4', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_SEA_RESCUE')}\n                </button>\n                <button \n                    onClick={() => createMap('underworld')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#5D4037', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    {t('EDITOR_SCENE_WORLD_ADD_UNDERWORLD')}\n                </button>\n                <button \n                    onClick={onAddRoomArea}\n                    title={t('EDITOR_SCENE_WORLD_ADD_ROOM_TITLE')}\n                    style={{ padding: '8px 15px', cursor: 'pointer', backgroundColor: '#f39c12', color: 'white', border: 'none', borderRadius: '4px', fontSize: '12px', fontWeight: 'bold' }}\n                >\n                    + m<sup>2</sup>\n                </button>\n                <div style={{ marginLeft: 'auto', color: '#ccc', fontSize: '11px' }}>\n                    {t('EDITOR_SCENE_WORLD_HELP')}\n                </div>\n            </div>\n\n            <div ref={containerRef} style={{ width: '100%', height: '500px', backgroundColor: '#333', overflow: 'auto', borderRadius: '4px', position: 'relative', border: '1px solid #555' }}>\n                <canvas\n                    ref={canvasRef}\n                    width={2000}\n                    height={2000}\n                    style={{ display: 'block', cursor: dragRef.current ? 'grabbing' : 'grab' }}\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseLeave={handleMouseUp}\n                />\n                <div style={{ position: 'absolute', bottom: '10px', right: '10px', backgroundColor: 'rgba(0,0,0,0.7)', color: '#fff', padding: '5px 10px', borderRadius: '4px', fontSize: '11px', pointerEvents: 'none' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#fff', border: '1px dashed #fff' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTRA')}</div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 10, height: 10, backgroundColor: '#00ff00', border: '1px dashed #00ff00' }}></div> {t('EDITOR_SCENE_WORLD_LEGEND_INTER')}</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const BackgroundPanel = ({ \n    backgroundOptions, \n    selectedBackgroundImage, \n    setSelectedBackgroundImage, \n    selectedBackgroundColor, \n    backgroundParallaxFactor, \n    setBackgroundParallaxFactor \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '12px' }}>{t('EDITOR_SCENE_BACKGROUND_IMAGE')}</span>\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>\n                    <div onClick={() => setSelectedBackgroundImage(null)}\n                        style={{\n                            border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #2196F3',\n                            borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                            boxShadow: !selectedBackgroundImage ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                        }}\n                        title={t('EDITOR_SCENE_BACKGROUND_SOLID')}>\n                        <div style={{ width: '100%', height: '60px', background: selectedBackgroundColor, display: 'block', borderRadius: '4px' }} />\n                        <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: !selectedBackgroundImage ? 'bold' : 'normal' }}>{t('EDITOR_SCENE_BACKGROUND_SOLID')}</div>\n                    </div>\n                    {backgroundOptions.map((bg) => (\n                        <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                            style={{\n                                border: selectedBackgroundImage === bg.metaPath ? '2px solid #2196F3' : '1px solid #ccc',\n                                borderRadius: '6px', padding: '4px', cursor: 'pointer', background: '#fff',\n                                boxShadow: selectedBackgroundImage === bg.metaPath ? '0 0 8px rgba(33, 150, 243, 0.3)' : 'none'\n                            }}\n                            title={bg.name}>\n                            <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '60px', objectFit: 'cover', display: 'block', borderRadius: '4px' }} />\n                            <div style={{ fontSize: '11px', textAlign: 'center', paddingTop: '5px', fontWeight: selectedBackgroundImage === bg.metaPath ? 'bold' : 'normal' }}>{bg.name}</div>\n                        </div>\n                    ))}\n                </div>\n            </section>\n\n            <section style={{ backgroundColor: '#f9f9f9', padding: '15px', borderRadius: '8px', border: '1px solid #ddd' }}>\n                <div style={{ marginBottom: '0px' }}>\n                    <label style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>{t('EDITOR_SCENE_BACKGROUND_PARALLAX')}</label>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                            onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))}\n                            style={{ flex: 1 }} />\n                        <span style={{ fontSize: '13px', fontWeight: 'bold', minWidth: '35px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                    </div>\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nexport const MusicPanel = ({ \n    musicOptions, \n    selectedBackgroundMusic, \n    setSelectedBackgroundMusic \n}) => {\n    const { t } = useTranslation('editor_scene');\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            <section>\n                <span style={{ fontSize: '13px', fontWeight: 'bold', display: 'block', marginBottom: '10px' }}>{t('EDITOR_SCENE_MUSIC_TITLE')}</span>\n                <select\n                    value={selectedBackgroundMusic || ''}\n                    onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                    style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ccc', fontSize: '13px', marginBottom: '10px' }}>\n                    <option value=\"\">{t('EDITOR_SCENE_MUSIC_NONE')}</option>\n                    {musicOptions.map(m => (\n                        <option key={m.name} value={m.metaPath}>{m.name}</option>\n                    ))}\n                </select>\n                <div style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\n                    {t('EDITOR_SCENE_MUSIC_STATUS', {\n                        status: selectedBackgroundMusic ? t('EDITOR_SCENE_MUSIC_STATUS_SELECTED') : t('EDITOR_SCENE_MUSIC_STATUS_SILENCE')\n                    })}\n                </div>\n            </section>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\n\nexport const WeatherPanel = ({\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const weatherItems = [\n        { label: t('EDITOR_SCENE_WEATHER_RAIN'), value: weatherRain, setter: setWeatherRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_LAVA_RAIN'), value: weatherLavaRain, setter: setWeatherLavaRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_SNOW'), value: weatherSnow, setter: setWeatherSnow, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_METEOR_RAIN'), value: weatherMeteorRain, setter: setWeatherMeteorRain, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_CLOUDS'), value: weatherClouds, setter: setWeatherClouds, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_FOG'), value: weatherFog, setter: setWeatherFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_RADIO_FOG'), value: weatherRadioactiveFog, setter: setWeatherRadioactiveFog, icon: '' },\n        { label: t('EDITOR_SCENE_WEATHER_THUNDER'), value: weatherThunder, setter: setWeatherThunder, icon: '' },\n    ];\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px', padding: '5px' }}>\n            {weatherItems.map((item) => (\n                <div key={item.label} style={{ \n                    backgroundColor: '#f9f9f9', \n                    padding: '12px', \n                    borderRadius: '8px', \n                    border: '1px solid #ddd' \n                }}>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\n                        <span style={{ fontSize: '13px', fontWeight: 'bold' }}>\n                            {item.icon} {item.label}\n                        </span>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', color: '#2196F3' }}>\n                            {item.value}%\n                        </span>\n                    </div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                        <input \n                            type=\"range\" \n                            min=\"0\" \n                            max=\"100\" \n                            step=\"1\" \n                            value={item.value}\n                            onChange={(e) => item.setter(parseInt(e.target.value))}\n                            style={{ flex: 1, cursor: 'pointer' }} \n                        />\n                    </div>\n                </div>\n            ))}\n            <div style={{ fontSize: '11px', color: '#888', fontStyle: 'italic', textAlign: 'center', marginTop: '5px' }}>\n                {t('EDITOR_SCENE_WEATHER_HINT')}\n            </div>\n        </div>\n    );\n};\n","import styled from 'styled-components';\n\nexport const SceneEditorButton = styled.button`\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    background-color: ${props => props.$active ? '#e3de0a' : '#333'};\n    color: #fff;\n    border: 1px solid ${props => props.$active ? '#1E88E5' : '#fff'};\n    border-radius: 4px;\n    margin-bottom: 10px;\n    font-size: 20px;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    transform: ${props => props.$active ? 'scale(1.05)' : 'none'};\n    padding: 0;\n    outline: none;\n\n    &:hover {\n        background-color: ${props => props.$active ? '#fdfa9b' : '#444'};\n        transform: scale(1.05);\n    }\n\n    &:active {\n        transform: scale(0.95);\n        border: solid 1px #fff;\n    }\n`;\n\nexport const RightSidebarContainer = styled.div`\n    position: absolute;\n    top: 10px;\n    right: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    z-index: 1100;\n`;\n","import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { DraggableWindow } from './editorScene/DraggableWindow';\nimport { EditorMapResizer } from './editorScene/EditorMapResizer';\nimport { Minimap } from './editorScene/Minimap';\nimport { WorldView } from './editorScene/WorldView';\nimport { BackgroundPanel } from './editorScene/BackgroundPanel';\nimport { MusicPanel } from './editorScene/MusicPanel';\nimport { WeatherPanel } from './editorScene/WeatherPanel';\nimport { SceneEditorButton, RightSidebarContainer } from './styles/EditorSceneButtonStyle';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\n\nexport const EditorScene = ({\n    handleMapResize,\n    isResizeWindowOpen,\n    setIsResizeWindowOpen,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    objectMetadata,\n    registryItems,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    weatherRain,\n    setWeatherRain,\n    weatherSnow,\n    setWeatherSnow,\n    weatherClouds,\n    setWeatherClouds,\n    weatherFog,\n    setWeatherFog,\n    weatherThunder,\n    setWeatherThunder,\n    weatherLavaRain,\n    setWeatherLavaRain,\n    weatherRadioactiveFog,\n    setWeatherRadioactiveFog,\n    weatherMeteorRain,\n    setWeatherMeteorRain,\n    // New props for multi-map\n    maps,\n    activeMapId,\n    switchMap,\n    createMap,\n    deleteMap,\n    updateMapData,\n    isWorldViewOpen,\n    setIsWorldViewOpen,\n    onAddRoomArea,\n    showRoomMapContent,\n    activeRoomIds\n}) => {\n    const { t } = useTranslation('editor_scene');\n    const [isMinimapOpen, setIsMinimapOpen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isBackgroundOpen, setIsBackgroundOpen] = useState(false);\n    const [isMusicOpen, setIsMusicOpen] = useState(false);\n\n    return (\n        <div style={{ display: 'contents' }}>\n            <BackgroundMusicPlayer \n                metaPath={selectedBackgroundMusic} \n                enabled={true} \n                volume={0.4} \n                isInsideRoom={activeRoomIds?.length > 0}\n            />\n            {/* Right side buttons */}\n            <RightSidebarContainer>\n                <SceneEditorButton onClick={() => setIsMinimapOpen(!isMinimapOpen)} $active={isMinimapOpen} title={t('EDITOR_SCENE_BUTTON_MAPS_MINIMAP')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsWorldViewOpen(!isWorldViewOpen)} $active={isWorldViewOpen} title={t('EDITOR_SCENE_BUTTON_WORLD_VIEW')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsBackgroundOpen(!isBackgroundOpen)} $active={isBackgroundOpen} title={t('EDITOR_SCENE_BUTTON_BACKGROUND')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsMusicOpen(!isMusicOpen)} $active={isMusicOpen} title={t('EDITOR_SCENE_BUTTON_MUSIC')}>\n                    <span style={{ color: '#fff' }}></span>\n                </SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsSettingsOpen(!isSettingsOpen)} $active={isSettingsOpen} title={t('EDITOR_SCENE_BUTTON_SETTINGS')}></SceneEditorButton>\n                <SceneEditorButton onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} $active={isResizeWindowOpen} title={t('EDITOR_SCENE_BUTTON_RESIZE')}></SceneEditorButton>\n            </RightSidebarContainer>\n\n            {/* Floating Windows */}\n            {isMinimapOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MINIMAP')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsMinimapOpen(false)}\n                >\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', padding: '5px' }}>\n                        <Minimap\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            backgroundColor={selectedBackgroundColor}\n                        />\n                        <div style={{ fontSize: '12px', color: '#ccc', textAlign: 'center' }}>\n                            {maps[activeMapId]?.name || t('EDITOR_SCENE_MINIMAP_CURRENT_MAP')}\n                        </div>\n                    </div>\n                </DraggableWindow>\n            )}\n\n            {isWorldViewOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_WORLD_VIEW')}\n                    defaultPosition={{ x: 100, y: 100 }}\n                    defaultWidth={800}\n                    isOpenDefault={true}\n                    onClose={() => setIsWorldViewOpen(false)}\n                >\n                    <WorldView \n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        registryItems={registryItems}\n                        createMap={createMap}\n                        deleteMap={deleteMap}\n                        updateMapData={updateMapData}\n                        onAddRoomArea={onAddRoomArea}\n                        showRoomMapContent={showRoomMapContent}\n                        // Current map live data\n                        currentMapData={{\n                            id: activeMapId,\n                            mapWidth,\n                            mapHeight,\n                            tileMapData,\n                            objectMapData,\n                            objectMetadata,\n                            selectedBackgroundColor\n                        }}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isBackgroundOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_BACKGROUND')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 80 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsBackgroundOpen(false)}\n                >\n                    <BackgroundPanel \n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isMusicOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_MUSIC')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 300 }}\n                    defaultWidth={320}\n                    isOpenDefault={true}\n                    onClose={() => setIsMusicOpen(false)}\n                >\n                    <MusicPanel \n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isSettingsOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_SETTINGS')}\n                    defaultPosition={{ x: window.innerWidth - 340, y: 400 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsSettingsOpen(false)}\n                >\n                    <WeatherPanel \n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                    />\n                </DraggableWindow>\n            )}\n\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title={t('EDITOR_SCENE_WINDOW_RESIZE')}\n                    defaultPosition={{ x: 400, y: 100 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                    onClose={() => setIsResizeWindowOpen(false)}\n                >\n                    <EditorMapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={handleMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { OperationButton, OperationLabel } from '../styles/EditorElementsButtonStyle';\n\nexport const OperationsPanel = ({ \n    openNewMapModal, \n    saveMap, \n    loadMap, \n    openBuiltInModal,\n    clearMap, \n    mapName, \n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    mapType,\n    updateMapData,\n    activeMapId\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const inputStyle = {\n        width: '100%',\n        border: '1px solid transparent',\n        background: 'transparent',\n        padding: '4px 6px',\n        fontSize: '13px',\n        fontWeight: 'bold',\n        outline: 'none',\n        borderRadius: '4px',\n        boxSizing: 'border-box',\n        transition: 'all 0.2s ease',\n        cursor: 'pointer'\n    };\n\n    const handleFocus = (e) => {\n        e.target.style.borderColor = '#2196F3';\n        e.target.style.backgroundColor = '#fff';\n        e.target.style.cursor = 'text';\n    };\n\n    const handleBlur = (e) => {\n        e.target.style.borderColor = 'transparent';\n        e.target.style.backgroundColor = 'transparent';\n        e.target.style.cursor = 'pointer';\n    };\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\n            <div style={{ \n                padding: '15px', \n                backgroundColor: '#f9f9f9', \n                borderRadius: '8px', \n                border: '1px solid #ddd', \n                display: 'flex', \n                flexDirection: 'column', \n                gap: '10px' \n            }}>\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>\n                    <OperationButton onClick={openNewMapModal} title={t('EDITOR_ELEMENTS_OP_NEW_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_NEW')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={saveMap} title={t('EDITOR_ELEMENTS_OP_SAVE_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_SAVE')}</span>\n                    </OperationButton>\n                    <OperationLabel title={t('EDITOR_ELEMENTS_OP_LOAD_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_LOAD')}</span>\n                        <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} />\n                    </OperationLabel>\n                    <OperationButton onClick={openBuiltInModal} title={t('EDITOR_ELEMENTS_OP_BUILT_IN_MAPS_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_BUILT_IN')}</span>\n                    </OperationButton>\n                    <OperationButton onClick={clearMap} $danger title={t('EDITOR_ELEMENTS_OP_CLEAR_MAP_TITLE')}>\n                        <span style={{ fontSize: '18px' }}></span>\n                        <span>{t('EDITOR_ELEMENTS_OP_CLEAR')}</span>\n                    </OperationButton>\n                </div>\n            </div>\n\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '4px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_MAP_TYPE_LABEL')}</label>\n                    <div style={{ display: 'flex', gap: '15px', padding: '4px 6px' }}>\n                        <label style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px', cursor: 'pointer', fontWeight: mapType !== 'sea_rescue' ? 'bold' : 'normal' }}>\n                            <input \n                                type=\"radio\" \n                                name=\"mapType\" \n                                checked={mapType !== 'sea_rescue'} \n                                onChange={() => updateMapData(activeMapId, { type: 'overworld' })}\n                                style={{ cursor: 'pointer' }}\n                            />\n                            {t('EDITOR_ELEMENTS_OP_MAP_TYPE_DEFAULT')}\n                        </label>\n                        <label style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px', cursor: 'pointer', fontWeight: mapType === 'sea_rescue' ? 'bold' : 'normal' }}>\n                            <input \n                                type=\"radio\" \n                                name=\"mapType\" \n                                checked={mapType === 'sea_rescue'} \n                                onChange={() => updateMapData(activeMapId, { type: 'sea_rescue' })}\n                                style={{ cursor: 'pointer' }}\n                            />\n                            {t('EDITOR_ELEMENTS_OP_MAP_TYPE_SEA_RESCUE')}\n                        </label>\n                    </div>\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_MAP_NAME_LABEL')}</label>\n                    <input \n                        value={mapName} \n                        onChange={(e) => setMapName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_MAP_NAME_TITLE')}\n                    />\n                </div>\n                \n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_AUTHOR_LABEL')}</label>\n                    <input \n                        value={creatorName} \n                        onChange={(e) => setCreatorName(e.target.value)}\n                        style={inputStyle}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_AUTHOR_TITLE')}\n                    />\n                </div>\n\n                <div>\n                    <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '6px', marginBottom: '2px', display: 'block' }}>{t('EDITOR_ELEMENTS_OP_DESCRIPTION_LABEL')}</label>\n                    <textarea \n                        value={mapDescription} \n                        onChange={(e) => setMapDescription(e.target.value)}\n                        style={{ ...inputStyle, fontWeight: 'normal', minHeight: '60px', resize: 'vertical' }}\n                        onFocus={handleFocus}\n                        onBlur={handleBlur}\n                        title={t('EDITOR_ELEMENTS_OP_EDIT_DESCRIPTION_TITLE')}\n                    />\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const CollapsiblePanel = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '4px 6px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none', lineHeight: 1.1, minHeight: '20px' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { CollapsiblePanel } from './CollapsiblePanel';\nimport AnimatedItem from '../../../../utilities/AnimatedItem';\nimport i18n from '../../../../i18n/i18n';\nimport { getTutorialChapters, getTutorialItems } from '../../../../i18n/tutorialMessages';\n\nexport const PalettePanel = ({ \n    isPlayMode, \n    category,\n    blocks, \n    liquids, \n    entities, \n    decorations, \n    items, \n    interactables, \n    hazards, \n    secrets, \n    miniGames,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    objectMetadata,\n    setObjectMetadata,\n    objectMapData,\n    highlightedIndex,\n    setHighlightedIndex,\n    registryItems,\n    handlePaletteSelect, \n    selectedTile \n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [selectedChapter, setSelectedChapter] = useState('');\n    const [selectedMiniGame, setSelectedMiniGame] = useState('');\n\n    const currentLang = i18n?.language || 'en';\n    const tutorialChapters = useMemo(() => getTutorialChapters(currentLang), [currentLang]);\n    const tutorialItems = useMemo(\n        () => (selectedChapter ? getTutorialItems(selectedChapter, currentLang) : []),\n        [selectedChapter, currentLang]\n    );\n\n    const miniGameGroups = useMemo(() => {\n        if (!miniGames || miniGames.length === 0) return [];\n        const groupOrder = new Map();\n        miniGames.forEach(item => {\n            const key = item.editor?.group || 'other';\n            const order = item.editor?.groupOrder ?? item.editor?.order ?? 0;\n            if (!groupOrder.has(key) || order < groupOrder.get(key)) {\n                groupOrder.set(key, order);\n            }\n        });\n        return Array.from(groupOrder.entries())\n            .sort((a, b) => a[1] - b[1])\n            .map(([key]) => key);\n    }, [miniGames]);\n\n    const miniGameItems = useMemo(() => {\n        if (!miniGames || !selectedMiniGame) return [];\n        return miniGames\n            .filter(item => (item.editor?.group || 'other') === selectedMiniGame)\n            .sort((a, b) => {\n                const ao = a.editor?.order ?? 0;\n                const bo = b.editor?.order ?? 0;\n                if (ao !== bo) return ao - bo;\n                return (a.displayName || a.name || '').localeCompare(b.displayName || b.name || '');\n            });\n    }, [miniGames, selectedMiniGame]);\n\n    const getMiniGameLabel = (key) => {\n        if (key === 'sea_rescue') return t('EDITOR_ELEMENTS_MINI_GAMES_GROUP_SEA_RESCUE');\n        if (key === 'other') return t('EDITOR_ELEMENTS_GROUP_OTHER');\n        return key;\n    };\n\n    const getMiniGameLayer = (item) => {\n        if (item.editor?.layer) return item.editor.layer;\n        if (item.type === 'secret') return 'secret';\n        if (item.id === 'minispill_sea_rescue_trigger') return 'object';\n        return 'object';\n    };\n\n    useEffect(() => {\n        if (!selectedChapter && tutorialChapters.length > 0) {\n            setSelectedChapter(tutorialChapters[0]);\n        } else if (selectedChapter && !tutorialChapters.includes(selectedChapter)) {\n            setSelectedChapter(tutorialChapters[0] || '');\n        }\n    }, [tutorialChapters, selectedChapter]);\n\n    useEffect(() => {\n        if (!selectedMiniGame && miniGameGroups.length > 0) {\n            setSelectedMiniGame(miniGameGroups[0]);\n        } else if (selectedMiniGame && !miniGameGroups.includes(selectedMiniGame)) {\n            setSelectedMiniGame(miniGameGroups[0] || '');\n        }\n    }, [miniGameGroups, selectedMiniGame]);\n\n    const getLiquidLabel = ({\n        isLavaWaterfall,\n        isLava,\n        isRadioactiveWaterfall,\n        isRadioactive,\n        isWater,\n        isWaterfall,\n        isQuicksand\n    }) => {\n        if (isLavaWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LFALL');\n        if (isLava) return t('EDITOR_ELEMENTS_LIQUID_LABEL_LAVA');\n        if (isRadioactiveWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RADFALL');\n        if (isRadioactive) return t('EDITOR_ELEMENTS_LIQUID_LABEL_RAD');\n        if (isWater) return t('EDITOR_ELEMENTS_LIQUID_LABEL_WATER');\n        if (isWaterfall) return t('EDITOR_ELEMENTS_LIQUID_LABEL_FALL');\n        if (isQuicksand) return t('EDITOR_ELEMENTS_LIQUID_LABEL_QUICK');\n        return t('EDITOR_ELEMENTS_LIQUID_LABEL_LIQ');\n    };\n\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const editorIcon = item.editorIcon;\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isQuicksand = !!(item.flags && item.flags.quicksand);\n        const isWaterfall = !!(item.flags && item.flags.waterfall);\n        const isLavaWaterfall = !!(item.flags && item.flags.lava_waterfall);\n        const isRadioactive = !!(item.flags && item.flags.radioactive);\n        const isRadioactiveWaterfall = !!(item.flags && item.flags.radioactive_waterfall);\n        const isSecret = item.type === 'secret';\n        const isWeatherTrigger = item.type === 'weather_trigger';\n        const isMessageTrigger = item.type === 'message_trigger';\n        \n        const swatchStyle = isLavaWaterfall\n            ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#ffcc00,#ffff00)' }\n            : (isWater || isWaterfall ? { background: 'linear-gradient(180deg,#3a7fb8,#5ba3d9)' }\n            : (isQuicksand ? { background: 'linear-gradient(180deg,#a6915b,#7d6d42)' }\n            : (isRadioactive || isRadioactiveWaterfall ? { background: 'linear-gradient(180deg,#1a5c1a,#32cd32)' }\n            : { background: '#eee' }))));\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.displayName || item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColorInEditor || item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.editorIcon || (item.subtype === 'above' ? t('EDITOR_ELEMENTS_SECRET_ABOVE') : t('EDITOR_ELEMENTS_SECRET_BELOW'))}\n                    </div>\n                ) : (isWeatherTrigger || isMessageTrigger) ? (\n                    hasImage ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            spriteSheet={item.spriteSheet}\n                            style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                            alt={item.name}\n                        />\n                    ) : (\n                        (() => {\n                            const iconText = item.editorIcon || (item.i18nMessage ? 'i18n' : '');\n                            return (\n                        <div style={{\n                            width: '100%', height: '100%', borderRadius: 2,\n                            display: 'flex', alignItems: 'center', justifyContent: 'center',\n                            background: isMessageTrigger ? '#fff9c4' : '#f0f4f8', \n                            border: isMessageTrigger ? '1px solid #fbc02d' : '1px solid #d1d9e6',\n                            color: '#333', fontSize: (iconText === 'i18n' ? '12px' : '18px'), fontWeight: 700\n                        }}>\n                            {iconText}\n                        </div>\n                            );\n                        })()\n                    )\n                ) : editorIcon ? (\n                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>\n                        {editorIcon}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        spriteSheet={item.spriteSheet}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid\n                            ? getLiquidLabel({\n                                isLavaWaterfall,\n                                isLava,\n                                isRadioactiveWaterfall,\n                                isRadioactive,\n                                isWater,\n                                isWaterfall,\n                                isQuicksand\n                            })\n                            : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    if (isPlayMode) {\n        return (\n            <div style={{ padding: '20px', fontSize: '14px', color: '#666', textAlign: 'center', backgroundColor: '#f9f9f9', borderRadius: '8px' }}>\n                {t('EDITOR_ELEMENTS_PALETTE_DISABLED')}\n            </div>\n        );\n    }\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            {category === 'blocks' && (() => {\n                const getBlockGroup = (b) => {\n                    if (b.editor?.group) return b.editor.group;\n                    const name = (b.id || b.name || '').toLowerCase();\n                    if (name.includes('brick')) return 'bricks';\n                    if (name.includes('diorite') || name.includes('stone')) return 'stone';\n                    if (name.includes('metal')) return 'metal';\n                    if (name.includes('wood')) return 'wood';\n                    return 'ground';\n                };\n\n                const groupOrder = [\n                    { key: 'ground', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_GROUND'), color: 'blue', open: true },\n                    { key: 'bricks', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_BRICKS'), color: 'blue', open: true },\n                    { key: 'stone', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_STONE'), color: 'blue', open: true },\n                    { key: 'metal', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_METAL'), color: 'blue', open: true },\n                    { key: 'wood', title: t('EDITOR_ELEMENTS_BLOCK_GROUP_WOOD'), color: 'blue', open: true }\n                ];\n\n                const withGroups = blocks.map(b => ({\n                    item: b,\n                    group: getBlockGroup(b)\n                }));\n\n                const sortBlocks = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(b => b.group === group.key).sort(sortBlocks);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(b => renderPaletteItem(b.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(b => !groupOrder.some(g => g.key === b.group)).sort(sortBlocks);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(b => renderPaletteItem(b.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'liquids' && (() => {\n                const getLiquidGroup = (li) => {\n                    if (li.editor?.group) return li.editor.group;\n                    if (li.flags?.quicksand) return 'quicksand';\n                    if (li.flags?.lava || li.flags?.lava_waterfall) return 'lava';\n                    if (li.flags?.radioactive || li.flags?.radioactive_waterfall) return 'radiation';\n                    if (li.flags?.water || li.flags?.waterfall) return 'water';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'quicksand', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_QUICKSAND'), color: 'goldenrod', open: true },\n                    { key: 'water', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_WATER'), color: 'blue', open: true },\n                    { key: 'lava', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_LAVA'), color: 'orange', open: true },\n                    { key: 'radiation', title: t('EDITOR_ELEMENTS_LIQUID_GROUP_RADIATION'), color: 'green', open: true }\n                ];\n\n                const withGroups = liquids.map(li => ({\n                    item: li,\n                    group: getLiquidGroup(li)\n                }));\n\n                const sortLiquids = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(li => li.group === group.key).sort(sortLiquids);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(li => renderPaletteItem(li.item, group.color, 'tile'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(li => !groupOrder.some(g => g.key === li.group)).sort(sortLiquids);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_LIQUIDS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_LIQUIDS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(li => renderPaletteItem(li.item, 'gray', 'tile'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'decorations' && (() => {\n                const getDecorationGroup = (d) => {\n                    if (d.editor?.group) return d.editor.group;\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'trees', title: t('EDITOR_ELEMENTS_DECORATIONS_GROUP_TREES'), color: 'green', open: true }\n                ];\n\n                const withGroups = decorations.map(d => ({\n                    item: d,\n                    group: getDecorationGroup(d)\n                }));\n\n                const sortDecorations = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(d => d.group === group.key).sort(sortDecorations);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(d => renderPaletteItem(d.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(d => !groupOrder.some(g => g.key === d.group)).sort(sortDecorations);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(d => renderPaletteItem(d.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'entities' && (() => {\n                const getEntityGroup = (e) => {\n                    if (e.editor?.group) return e.editor.group;\n                    const name = (e.id || e.name || '').toLowerCase();\n                    if (name.includes('player')) return 'player';\n                    if (name.includes('fish') || name.includes('animal')) return 'animals';\n                    return 'enemies';\n                };\n\n                const groupOrder = [\n                    { key: 'player', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_PLAYER'), color: 'red', open: true },\n                    { key: 'animals', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ANIMALS'), color: 'red', open: true },\n                    { key: 'enemies', title: t('EDITOR_ELEMENTS_ENTITIES_GROUP_ENEMIES'), color: 'red', open: true }\n                ];\n\n                const withGroups = entities.map(e => ({\n                    item: e,\n                    group: getEntityGroup(e)\n                }));\n\n                const sortEntities = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(e => e.group === group.key).sort(sortEntities);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(e => renderPaletteItem(e.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(e => !groupOrder.some(g => g.key === e.group)).sort(sortEntities);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ENTITIES_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ENTITIES_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(e => renderPaletteItem(e.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'items' && (() => {\n                const getItemGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.effect?.health) return 'health';\n                    if (i.effect?.fireball) return 'ammunition';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'health', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_HEALTH'), color: 'green', open: true },\n                    { key: 'ammunition', title: t('EDITOR_ELEMENTS_ITEMS_GROUP_AMMUNITION'), color: 'green', open: true }\n                ];\n\n                const withGroups = items.map(i => ({\n                    item: i,\n                    group: getItemGroup(i)\n                }));\n\n                const sortItems = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const groupItems = withGroups.filter(i => i.group === group.key).sort(sortItems);\n                    if (groupItems.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {groupItems.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortItems);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        <div\n                            title={t('EDITOR_ELEMENTS_ITEMS_INFO_TITLE')}\n                            style={{ fontSize: '11px', color: '#666', cursor: 'help' }}\n                        >\n                             {t('EDITOR_ELEMENTS_ITEMS_INFO_LABEL')}\n                        </div>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'interactables' && (() => {\n                const getInteractableGroup = (i) => {\n                    if (i.editor?.group) return i.editor.group;\n                    if (i.subtype === 'door') return 'entrances';\n                    if (i.subtype === 'ladder') return 'ledders';\n                    if (i.subtype === 'platform' || i.subtype === 'arrow') return 'platforms';\n                    if ((i.id || '').includes('portal') || (i.name || '').includes('portal')) return 'ports';\n                    if (i.subtype === 'end') return 'ends';\n                    const name = (i.id || i.name || '').toLowerCase();\n                    if (name.includes('berry')) return 'harvestables';\n                    if (name.includes('stone') || name.includes('wooden_box')) return 'physics';\n                    if (name.includes('ice')) return 'blocks';\n                    return 'other';\n                };\n\n                const groupOrder = [\n                    { key: 'harvestables', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_HARVESTABLES'), color: 'purple', open: true },\n                    { key: 'physics', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PHYSIC'), color: 'purple', open: true },\n                    { key: 'entrances', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENTRANCES'), color: 'purple', open: true },\n                    { key: 'platforms', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PLATFORMS'), color: 'purple', open: true },\n                    { key: 'ledders', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_LEDDERS'), color: 'purple', open: true },\n                    { key: 'ports', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_PORTS'), color: 'purple', open: true },\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_BLOCKS'), color: 'purple', open: true },\n                    { key: 'ends', title: t('EDITOR_ELEMENTS_INTERACTABLES_GROUP_ENDS'), color: 'purple', open: true }\n                ];\n\n                const withGroups = interactables.map(i => ({\n                    item: i,\n                    group: getInteractableGroup(i)\n                }));\n\n                const sortInteractables = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(i => i.group === group.key).sort(sortInteractables);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(i => renderPaletteItem(i.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(i => !groupOrder.some(g => g.key === i.group)).sort(sortInteractables);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_GROUP_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(i => renderPaletteItem(i.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'hazards' && (() => {\n                const getHazardGroup = (h) => {\n                    if (h.editor?.group) return h.editor.group;\n                    if (h.collision) return 'blocks';\n                    return 'obstacles';\n                };\n\n                const groupOrder = [\n                    { key: 'blocks', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_BLOCKS'), color: 'orange', open: true },\n                    { key: 'obstacles', title: t('EDITOR_ELEMENTS_HAZARDS_GROUP_OBSTACLES'), color: 'brown', open: true }\n                ];\n\n                const withGroups = hazards.map(h => ({\n                    item: h,\n                    group: getHazardGroup(h)\n                }));\n\n                const sortHazards = (a, b) => {\n                    const ao = a.item.editor?.order ?? 0;\n                    const bo = b.item.editor?.order ?? 0;\n                    if (ao !== bo) return ao - bo;\n                    return (a.item.displayName || a.item.name || '').localeCompare(b.item.displayName || b.item.name || '');\n                };\n\n                const groupPanels = groupOrder.map(group => {\n                    const items = withGroups.filter(h => h.group === group.key).sort(sortHazards);\n                    if (items.length === 0) return null;\n                    return (\n                        <CollapsiblePanel key={group.key} title={group.title} isOpenDefault={group.open}>\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                {items.map(h => renderPaletteItem(h.item, group.color, 'object'))}\n                            </div>\n                        </CollapsiblePanel>\n                    );\n                }).filter(Boolean);\n\n                const otherItems = withGroups.filter(h => !groupOrder.some(g => g.key === h.group)).sort(sortHazards);\n\n                return (\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                        {groupPanels}\n                        {otherItems.length > 0 && (\n                            <CollapsiblePanel title={t('EDITOR_ELEMENTS_HAZARDS_OTHER')} isOpenDefault={false}>\n                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                                    {otherItems.map(h => renderPaletteItem(h.item, 'gray', 'object'))}\n                                </div>\n                            </CollapsiblePanel>\n                        )}\n                    </div>\n                );\n            })()}\n\n            {category === 'secrets' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_OPEN_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'open').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n                    \n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_SECRET_AREA')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype !== 'open' && s.subtype !== 'room' && s.subtype !== 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_CRACKABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {crackableWalls && crackableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_PUSHABLE_WALL')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {pushableWalls && pushableWalls.map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_SECRETS_ANIMAL_TRIGGERS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {secrets && secrets.filter(s => s.subtype === 'animal_trigger').map(s => renderPaletteItem(s, 'purple', 'object'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'weather' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'rain').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_SNOW')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'snow').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_CLOUDS')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'clouds').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'fog').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_THUNDER')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'thunder').map(w => renderPaletteItem(w, 'blue', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_LAVA_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'lavaRain').map(w => renderPaletteItem(w, 'red', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_RADIO_FOG')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'radioactiveFog').map(w => renderPaletteItem(w, 'green', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_WEATHER_METEOR_RAIN')} isOpenDefault={false}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                            {weather && weather.filter(w => w.weatherType === 'meteorRain').map(w => renderPaletteItem(w, 'orange', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n                </div>\n            )}\n\n            {category === 'messages' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <CollapsiblePanel title={t('EDITOR_ELEMENTS_MESSAGES_TITLE')} isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {messages && messages.map(m => renderPaletteItem(m, 'gold', 'props'))}\n                        </div>\n                    </CollapsiblePanel>\n                    {selectedTile && (selectedTile.i18nMessage || selectedTile.type === 'message_trigger') && (\n                        <CollapsiblePanel title={t('EDITOR_ELEMENTS_I18N_TITLE')} isOpenDefault={true}>\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>\n                                    {tutorialChapters.map(ch => (\n                                        <button\n                                            key={ch}\n                                            onClick={() => setSelectedChapter(ch)}\n                                            style={{\n                                                padding: '4px 8px',\n                                                fontSize: '11px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ccc',\n                                                background: ch === selectedChapter ? '#f4c542' : '#f0f0f0',\n                                                cursor: 'pointer'\n                                            }}\n                                        >\n                                            {ch}\n                                        </button>\n                                    ))}\n                                </div>\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '6px', maxHeight: '200px', overflowY: 'auto' }}>\n                                    {tutorialItems.map(item => (\n                                        <button\n                                            key={`${selectedChapter}_${item.id}`}\n                                            onClick={() => {\n                                                let targetIndex = highlightedIndex;\n                                                if ((targetIndex === null || targetIndex === undefined) && selectedTile?.id && objectMapData) {\n                                                    const idx = objectMapData.findIndex(id => id === selectedTile.id);\n                                                    if (idx >= 0) {\n                                                        targetIndex = idx;\n                                                        if (setHighlightedIndex) setHighlightedIndex(idx);\n                                                    }\n                                                }\n                                                if (targetIndex === null || targetIndex === undefined) return;\n                                                const objId = objectMapData?.[targetIndex];\n                                                const objDef = registryItems?.find(r => r.id === objId);\n                                                if (!objDef || objDef.type !== 'message_trigger') return;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [targetIndex]: {\n                                                        ...prev[targetIndex],\n                                                        i18nChapter: selectedChapter,\n                                                        i18nId: item.id,\n                                                        message: ''\n                                                    }\n                                                }));\n                                            }}\n                                            style={{\n                                                display: 'flex',\n                                                alignItems: 'center',\n                                                justifyContent: 'space-between',\n                                                gap: '8px',\n                                                padding: '6px 8px',\n                                                borderRadius: '4px',\n                                                border: '1px solid #ddd',\n                                                background: '#fff',\n                                                cursor: 'pointer',\n                                                textAlign: 'left'\n                                            }}\n                                        >\n                                            <span style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_I18N_ID', { id: item.id })}</span>\n                                            <span style={{ fontSize: '11px', color: '#222', flex: 1 }}>{item.text}</span>\n                                        </button>\n                                    ))}\n                                </div>\n                                {(highlightedIndex === null || highlightedIndex === undefined) && (\n                                    <div style={{ fontSize: '11px', color: '#888' }}>\n                                        {t('EDITOR_ELEMENTS_I18N_SELECT_HINT')}\n                                    </div>\n                                )}\n                            </div>\n                        </CollapsiblePanel>\n                    )}\n                </div>\n            )}\n\n            {category === 'minigames' && (\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n                    <div style={{ \n                        padding: '12px', \n                        backgroundColor: '#f9f9f9', \n                        borderRadius: '8px', \n                        border: '1px solid #ddd', \n                        display: 'flex', \n                        flexDirection: 'column', \n                        gap: '6px' \n                    }}>\n                        <label style={{ fontSize: '10px', color: '#888', fontWeight: 'bold', marginLeft: '2px', display: 'block', textTransform: 'uppercase' }}>\n                            {t('EDITOR_ELEMENTS_MINI_GAMES_SELECT_LABEL')}\n                        </label>\n                        <select\n                            value={selectedMiniGame}\n                            onChange={(e) => setSelectedMiniGame(e.target.value)}\n                            style={{\n                                width: '100%',\n                                padding: '6px 8px',\n                                border: '1px solid #ccc',\n                                borderRadius: '4px',\n                                fontSize: '13px',\n                                backgroundColor: '#fff',\n                                outline: 'none',\n                                cursor: 'pointer',\n                                fontWeight: 'bold'\n                            }}\n                        >\n                            {miniGameGroups.map(group => (\n                                <option key={group} value={group}>\n                                    {getMiniGameLabel(group)}\n                                </option>\n                            ))}\n                        </select>\n                    </div>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', padding: '0 4px' }}>\n                        {miniGameItems.length > 0 ? (\n                            miniGameItems.map(item => renderPaletteItem(item, 'teal', getMiniGameLayer(item)))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                {t('EDITOR_ELEMENTS_MINI_GAMES_EMPTY')}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n\n            {category === 'obstacles' && (\n                <CollapsiblePanel title={t('EDITOR_ELEMENTS_OBSTACLES_TITLE')} isOpenDefault={true}>\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\n                        {obstacles && obstacles.length > 0 ? (\n                            obstacles.map(o => renderPaletteItem(o, 'brown', 'object'))\n                        ) : (\n                            <div style={{ padding: '10px', fontSize: '12px', color: '#999', fontStyle: 'italic' }}>\n                                {t('EDITOR_ELEMENTS_OBSTACLES_EMPTY')}\n                            </div>\n                        )}\n                    </div>\n                </CollapsiblePanel>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\n\nexport const StatisticsPanel = ({ \n    totalTiles, \n    mapWidth, \n    mapHeight, \n    filledBlocks, \n    objectsCount, \n    emptyBlocks,\n    objectMapData,\n    registryItems,\n    maps\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const registryMap = registryItems && registryItems.__byId;\n    const getDef = (id) => {\n        if (!id) return null;\n        if (registryMap && typeof registryMap.get === 'function') return registryMap.get(id) || null;\n        return Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    };\n\n    let itemsCount = 0;\n    let entitiesCount = 0;\n\n    if (Array.isArray(objectMapData)) {\n        objectMapData.forEach((id) => {\n            if (!id) return;\n            const def = getDef(id);\n            if (!def) return;\n            const name = (def.name || '').toLowerCase();\n            if (name.startsWith('item.')) itemsCount += 1;\n            if (def.type === 'entity' || def.subtype === 'tank' || def.subtype === 'platform' || name.includes('entities.')) {\n                entitiesCount += 1;\n            }\n        });\n    }\n\n    const mapList = maps ? Object.values(maps) : [];\n    const mapsTotal = mapList.length;\n    const mapsOverworld = mapList.filter(m => m.type === 'overworld').length;\n    const mapsUnderworld = mapList.filter(m => m.type === 'underworld').length;\n    const mapsRooms = mapList.filter(m => m.type === 'room').length;\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\n            <div style={{ padding: '15px', backgroundColor: '#e6f7ff', borderRadius: '8px', border: '1px solid #91d5ff' }}>\n                <div style={{ fontSize: '14px', marginBottom: '8px' }}>\n                    <Trans i18nKey=\"EDITOR_ELEMENTS_STATS_TOTAL_AREA\" t={t} values={{ count: totalTiles }} components={[<strong key=\"count\" />]} />\n                </div>\n                <div style={{ fontSize: '13px', color: '#0050b3' }}>{t('EDITOR_ELEMENTS_STATS_DIMENSIONS', { width: mapWidth, height: mapHeight })}</div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#f6ffed', borderRadius: '8px', border: '1px solid #b7eb8f', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#389e0d' }}>{filledBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_FILLED_BLOCKS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#fff7e6', borderRadius: '8px', border: '1px solid #ffd591', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#d46b08' }}>{objectsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_OBJECTS')}</div>\n                </div>\n            </div>\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\n                <div style={{ padding: '12px', backgroundColor: '#eef7ff', borderRadius: '8px', border: '1px solid #b3d8ff', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#1565c0' }}>{itemsCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ITEMS')}</div>\n                </div>\n                <div style={{ padding: '12px', backgroundColor: '#f3e8ff', borderRadius: '8px', border: '1px solid #d1c4e9', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#5e35b1' }}>{entitiesCount}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_ENTITIES')}</div>\n                </div>\n            </div>\n            <div style={{ padding: '12px', backgroundColor: '#f9f9f9', borderRadius: '8px', border: '1px solid #ddd', textAlign: 'center' }}>\n                    <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#666' }}>{emptyBlocks}</div>\n                    <div style={{ fontSize: '11px', color: '#555' }}>{t('EDITOR_ELEMENTS_STATS_EMPTY_SPACE')}</div>\n            </div>\n            {mapsTotal > 0 && (\n                <div style={{ padding: '12px', backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #ddd' }}>\n                    <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#444', marginBottom: '6px' }}>\n                        {t('EDITOR_ELEMENTS_STATS_MAPS_TOTAL', { count: mapsTotal })}\n                    </div>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: '#666' }}>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_OVERWORLD', { count: mapsOverworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_UNDERWORLD', { count: mapsUnderworld })}</span>\n                        <span>{t('EDITOR_ELEMENTS_STATS_MAPS_ROOMS', { count: mapsRooms })}</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\nimport { getTutorialText } from '../../../../i18n/tutorialMessages';\n\nexport const ObjectPropsPanel = ({ \n    objectMapData, \n    secretMapData,\n    registryItems, \n    mapWidth, \n    objectMetadata, \n    highlightedIndex, \n    setHighlightedIndex, \n    setObjectMetadata,\n    maps,\n    activeMapId,\n    createMap\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const mapType = maps[activeMapId]?.type || 'overworld';\n    const mapList = Object.values(maps || {});\n    const listRef = React.useRef(null);\n\n    // Auto-scroll to highlighted item\n    React.useEffect(() => {\n        if (highlightedIndex !== null && listRef.current) {\n            const highlightedElement = listRef.current.querySelector(`[data-index=\"${highlightedIndex}\"]`);\n            if (highlightedElement) {\n                highlightedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n        }\n    }, [highlightedIndex]);\n\n    return (\n        <div style={{ padding: '0' }}>\n            <p style={{ fontSize: '12px', color: '#666', lineHeight: '1.4' }}>\n                {t('EDITOR_ELEMENTS_PROPS_INTRO_LINE1')}\n                <br />\n                <strong>1.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE2\"\n                    t={t}\n                    components={[<strong key=\"portal\" />, <strong key=\"target\" />, <strong key=\"weather\" />, <strong key=\"message\" />]}\n                />\n                <br />\n                <strong>2.</strong>{' '}\n                <Trans\n                    i18nKey=\"EDITOR_ELEMENTS_PROPS_INTRO_LINE3\"\n                    t={t}\n                    components={[<strong key=\"trigger\" />, <strong key=\"intensity\" />, <strong key=\"messageText\" />]}\n                />\n            </p>\n            <div ref={listRef} style={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}>\n                {Array.from({ length: objectMapData.length }).map((_, index) => {\n                    const objId = objectMapData[index];\n                    const secretId = secretMapData ? secretMapData[index] : null;\n                    \n                    if (!objId && !secretId) return null;\n\n                    const objDef = objId ? registryItems.find(r => r.id === objId) : null;\n                    const secretDef = secretId ? registryItems.find(r => r.id === secretId) : null;\n                    \n                    const isWeather = objDef && objDef.type === 'weather_trigger';\n                    const isMessage = objDef && objDef.type === 'message_trigger';\n                    const isPortalOrTarget = objId && (objId.includes('portal') || objId.includes('target') || objId === 'portal_target');\n                    const isDoor = objDef && objDef.subtype === 'door';\n                    const isRoomArea = secretDef && secretDef.subtype === 'room' && mapType !== 'room';\n                    const isTree = objDef && objDef.type === 'decoration' && objDef.editor?.group === 'trees';\n\n                    if (!isPortalOrTarget && !isWeather && !isMessage && !isRoomArea && !isDoor && !isTree) return null;\n\n                    const def = objDef || secretDef;\n                    const id = objId || secretId;\n\n                    const x = index % mapWidth;\n                    const y = Math.floor(index / mapWidth);\n                    const metadata = objectMetadata[index] || {};\n                    const i18nPreview = metadata.i18nChapter && metadata.i18nId\n                        ? getTutorialText(metadata.i18nChapter, metadata.i18nId)\n                        : '';\n                    const isHighlighted = highlightedIndex === index;\n\n                    return (\n                        <div key={index} \n                            data-index={index}\n                            onMouseEnter={() => setHighlightedIndex(index)}\n                            onMouseLeave={() => setHighlightedIndex(null)}\n                            style={{\n                                padding: '10px',\n                                border: isHighlighted ? '1px solid gold' : '1px solid #eee',\n                                display: 'flex',\n                                flexDirection: 'column',\n                                gap: '5px',\n                                backgroundColor: isHighlighted ? '#fffde7' : '#f9f9f9',\n                                marginBottom: '5px',\n                                borderRadius: '4px',\n                                transition: 'all 0.2s ease'\n                            }}\n                        >\n                            <div style={{ fontWeight: 'bold', fontSize: '13px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                                <span style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    {isRoomArea ? '' : (isTree ? '' : ((isWeather || isMessage) ? def.editorIcon : (id.includes('portal') && !id.includes('target') ? '' : '')))} {def.displayName || def.name}\n                                </span>\n                                <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                    <span style={{ color: '#666', fontSize: '11px' }}>({x}, {y})</span>\n                                    <button \n                                        onClick={() => {\n                                            const el = document.querySelector(`.viewport`);\n                                            if (el) {\n                                                const scrollX = x * 32 - el.clientWidth / 2 + 16;\n                                                const scrollY = y * 32 - el.clientHeight / 2 + 16;\n                                                el.scrollTo({ left: scrollX, top: scrollY, behavior: 'smooth' });\n                                            }\n                                        }}\n                                        style={{ \n                                            padding: '2px 6px', fontSize: '10px', cursor: 'pointer',\n                                            backgroundColor: '#eee', border: '1px solid #ccc', borderRadius: '3px'\n                                        }}\n                                        title={t('EDITOR_ELEMENTS_PROPS_LOCATE_TITLE')}\n                                    >\n                                        {t('EDITOR_ELEMENTS_PROPS_LOCATE_LABEL')}\n                                    </button>\n                                </div>\n                            </div>\n\n                            {isRoomArea && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_ROOM_NAME')}</label>\n                                        <input\n                                            type=\"text\"\n                                            value={metadata.roomName || ''}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_ROOM_NAME_PLACEHOLDER')}\n                                            onChange={(e) => {\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], roomName: e.target.value }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                            }}\n                                        />\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE')}</label>\n                                        <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.width || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], width: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                            <span>x</span>\n                                            <input\n                                                type=\"number\"\n                                                value={metadata.height || 1}\n                                                min=\"1\"\n                                                onChange={(e) => {\n                                                    const val = parseInt(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], height: isNaN(val) ? 1 : val }\n                                                    }));\n                                                }}\n                                                style={{ width: '50px', padding: '2px 5px' }}\n                                            />\n                                        </div>\n                                    </div>\n                                    {metadata.linkedMapId ? (\n                                        <div style={{ fontSize: '11px', color: 'green' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_LINKED_MAP', { id: metadata.linkedMapId })}\n                                        </div>\n                                    ) : (\n                                        <button\n                                            onClick={() => {\n                                                if (createMap) {\n                                                    const mapId = createMap('room', metadata.roomName || 'Room Area', metadata.width || 1, metadata.height || 1);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], linkedMapId: mapId }\n                                                    }));\n                                                }\n                                            }}\n                                            style={{\n                                                padding: '6px',\n                                                backgroundColor: '#4CAF50',\n                                                color: 'white',\n                                                border: 'none',\n                                                borderRadius: '4px',\n                                                cursor: 'pointer',\n                                                fontWeight: 'bold'\n                                            }}\n                                        >\n                                            {t('EDITOR_ELEMENTS_PROPS_CONFIRM')}\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n\n                            {(!isWeather && !isMessage && !isRoomArea && !isTree) && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID')}</label>\n                                    <input\n                                        type=\"number\"\n                                        value={metadata.triggerId || ''}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], triggerId: isNaN(val) ? null : val }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                        placeholder={t('EDITOR_ELEMENTS_PROPS_TRIGGER_ID_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {isTree && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_TREE_LAYER_LABEL')}</label>\n                                    <select\n                                        value={(metadata.renderAbovePlayer !== undefined ? metadata.renderAbovePlayer : def.renderAbovePlayer) ? 'above' : 'behind'}\n                                        onChange={(e) => {\n                                            const nextAbove = e.target.value === 'above';\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], renderAbovePlayer: nextAbove }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    >\n                                        <option value=\"behind\">{t('EDITOR_ELEMENTS_TREE_LAYER_BEHIND')}</option>\n                                        <option value=\"above\">{t('EDITOR_ELEMENTS_TREE_LAYER_ABOVE')}</option>\n                                    </select>\n                                </div>\n                            )}\n\n                            {isWeather && def.hasIntensity && (\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_INTENSITY')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        max=\"100\"\n                                        value={metadata.intensity !== undefined ? metadata.intensity : 50}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], intensity: isNaN(val) ? 0 : Math.min(100, Math.max(0, val)) }\n                                            }));\n                                        }}\n                                        style={{\n                                            flex: 1,\n                                            padding: '4px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                        }}\n                                    />\n                                </div>\n                            )}\n\n                            {isMessage && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\n                                    {(metadata.i18nChapter || metadata.i18nId) && (\n                                        <div style={{ fontSize: '11px', color: '#666' }}>\n                                            {t('EDITOR_ELEMENTS_PROPS_I18N_LABEL', {\n                                                chapter: metadata.i18nChapter || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY'),\n                                                id: metadata.i18nId || t('EDITOR_ELEMENTS_PROPS_I18N_EMPTY')\n                                            })}\n                                            {i18nPreview && (\n                                                <div style={{ marginTop: '4px', color: '#333' }}>\n                                                    {i18nPreview}\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n                                    <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_MESSAGE_TEXT')}</label>\n                                    <textarea\n                                        value={metadata.message || ''}\n                                        onChange={(e) => {\n                                            const val = e.target.value;\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], message: val }\n                                            }));\n                                        }}\n                                        rows={3}\n                                        style={{\n                                            width: '100%',\n                                            padding: '6px 8px',\n                                            border: '1px solid #ccc',\n                                            borderRadius: '4px',\n                                            fontSize: '13px',\n                                            backgroundColor: isHighlighted ? '#fff' : '#f0f0f0',\n                                            resize: 'vertical',\n                                            fontFamily: 'inherit'\n                                        }}\n                                        placeholder={i18nPreview || t('EDITOR_ELEMENTS_PROPS_MESSAGE_PLACEHOLDER')}\n                                    />\n                                </div>\n                            )}\n\n                            {( (id.includes('portal') && !id.includes('target')) || isDoor ) && (\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px', marginTop: '5px' }}>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_TARGET_MAP')}</label>\n                                        <select\n                                            value={metadata.targetMapId || ''}\n                                            onChange={(e) => {\n                                                const val = e.target.value;\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], targetMapId: val === '' ? null : val }\n                                                }));\n                                            }}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        >\n                                            <option value=\"\">{t('EDITOR_ELEMENTS_PROPS_CURRENT_MAP_OPTION')}</option>\n                                            {mapList.map(m => (\n                                                <option key={m.id} value={m.id}>{m.name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                        <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_SPAWN_ID')}</label>\n                                        <input\n                                            type=\"number\"\n                                            value={metadata.spawnTriggerId !== undefined ? metadata.spawnTriggerId : ''}\n                                            onChange={(e) => {\n                                                const val = parseInt(e.target.value);\n                                                setObjectMetadata(prev => ({\n                                                    ...prev,\n                                                    [index]: { ...prev[index], spawnTriggerId: isNaN(val) ? null : val }\n                                                }));\n                                            }}\n                                            placeholder={t('EDITOR_ELEMENTS_PROPS_SPAWN_ID_PLACEHOLDER')}\n                                            style={{\n                                                flex: 1,\n                                                padding: '4px 8px',\n                                                border: '1px solid #ccc',\n                                                borderRadius: '4px',\n                                                fontSize: '13px',\n                                                backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                            }}\n                                        />\n                                    </div>\n                                    {isDoor && (\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                                            <label style={{ fontSize: '12px', fontWeight: 'bold' }}>{t('EDITOR_ELEMENTS_PROPS_DELAY')}</label>\n                                            <input\n                                                type=\"number\"\n                                                step=\"0.1\"\n                                                value={metadata.delaySeconds !== undefined ? metadata.delaySeconds : (objDef.interaction?.delaySeconds || 0.5)}\n                                                onChange={(e) => {\n                                                    const val = parseFloat(e.target.value);\n                                                    setObjectMetadata(prev => ({\n                                                        ...prev,\n                                                        [index]: { ...prev[index], delaySeconds: isNaN(val) ? 0.5 : val }\n                                                    }));\n                                                }}\n                                                style={{\n                                                    flex: 1,\n                                                    padding: '4px 8px',\n                                                    border: '1px solid #ccc',\n                                                    borderRadius: '4px',\n                                                    fontSize: '13px',\n                                                    backgroundColor: isHighlighted ? '#fff' : '#f0f0f0'\n                                                }}\n                                            />\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                            {/* Size Configuration */}\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px', paddingTop: '5px', borderTop: '1px solid #eee' }}>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_W')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.width || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], width: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\n                                    <label style={{ fontSize: '11px', color: '#666' }}>{t('EDITOR_ELEMENTS_PROPS_SIZE_H')}</label>\n                                    <input\n                                        type=\"number\"\n                                        min=\"1\"\n                                        max=\"50\"\n                                        value={metadata.height || 1}\n                                        onChange={(e) => {\n                                            const val = parseInt(e.target.value);\n                                            setObjectMetadata(prev => ({\n                                                ...prev,\n                                                [index]: { ...prev[index], height: isNaN(val) ? 1 : Math.max(1, val) }\n                                            }));\n                                        }}\n                                        style={{ width: '40px', padding: '2px 4px', fontSize: '12px', border: '1px solid #ccc', borderRadius: '3px' }}\n                                    />\n                                </div>\n                                <span style={{ fontSize: '10px', color: '#999' }}>{t('EDITOR_ELEMENTS_PROPS_RESIZE_HINT')}</span>\n                            </div>\n                        </div>\n                    );\n                })}\n                {objectMapData.filter(id => {\n                    if (!id) return false;\n                    const def = registryItems.find(r => r.id === id);\n                    const isWeather = def && def.type === 'weather_trigger';\n                    const isMessage = def && def.type === 'message_trigger';\n                    const isPortalOrTarget = id.includes('portal') || id.includes('target') || id === 'portal_target';\n                    const isTree = def && def.type === 'decoration' && def.editor?.group === 'trees';\n                    return isPortalOrTarget || isWeather || isMessage || isTree;\n                }).length === 0 && (\n                    <p style={{ textAlign: 'center', color: '#999', marginTop: '20px', fontSize: '14px' }}>\n                        {t('EDITOR_ELEMENTS_PROPS_NO_CONFIGURABLE')}\n                    </p>\n                )}\n            </div>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    SidebarContainer,\n    ElementEditorButton,\n    PanelContainer,\n    PanelHeader,\n    PanelBody,\n    CloseButton\n} from './styles/EditorElementsButtonStyle';\n\n// Panels\nimport { OperationsPanel } from './editorElements/OperationsPanel';\nimport { PalettePanel } from './editorElements/PalettePanel';\nimport { StatisticsPanel } from './editorElements/StatisticsPanel';\nimport { ObjectPropsPanel } from './editorElements/ObjectPropsPanel';\n\nexport const EditorElements = ({\n    mapName,\n    creatorName,\n    mapDescription,\n    setMapName,\n    setCreatorName,\n    setMapDescription,\n    openNewMapModal,\n    openBuiltInModal,\n    saveMap,\n    loadMap,\n    clearMap,\n    isPlayMode,\n    handlePaletteSelect,\n    selectedTile,\n    blocks,\n    liquids,\n    entities,\n    items,\n    decorations,\n    interactables,\n    hazards,\n    secrets,\n    miniGames,\n    weather,\n    messages,\n    crackableWalls,\n    pushableWalls,\n    obstacles,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    objectMapData,\n    secretMapData,\n    objectMetadata,\n    setObjectMetadata,\n    registryItems,\n    highlightedIndex,\n    setHighlightedIndex,\n    activePanel,\n    setActivePanel,\n    togglePanel,\n    maps,\n    activeMapId,\n    createMap,\n    mapType,\n    updateMapData\n}) => {\n    const { t } = useTranslation('editor_elements');\n    const [lastPanel, setLastPanel] = React.useState(null);\n    const [pinnedPanel, setPinnedPanel] = React.useState(null);\n    const hoverTimerRef = React.useRef(null);\n\n    React.useEffect(() => {\n        if (activePanel) {\n            setLastPanel(activePanel);\n        }\n    }, [activePanel]);\n\n    const displayPanel = activePanel || lastPanel;\n\n    const clearHoverTimer = () => {\n        if (hoverTimerRef.current) {\n            clearTimeout(hoverTimerRef.current);\n            hoverTimerRef.current = null;\n        }\n    };\n\n    const handleIconClick = (panel) => {\n        clearHoverTimer();\n        if (pinnedPanel === panel) {\n            setPinnedPanel(null);\n            setActivePanel(null);\n            return;\n        }\n        setPinnedPanel(panel);\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseEnter = (panel) => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(panel);\n    };\n\n    const handleIconMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        hoverTimerRef.current = setTimeout(() => {\n            setActivePanel(null);\n        }, 120);\n    };\n\n    const handlePanelMouseEnter = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n    };\n\n    const handlePanelMouseLeave = () => {\n        if (pinnedPanel) return;\n        clearHoverTimer();\n        setActivePanel(null);\n    };\n\n    const panelTitles = {\n        map: t('EDITOR_ELEMENTS_PANEL_OPERATIONS'),\n        blocks: t('EDITOR_ELEMENTS_PANEL_BLOCKS'),\n        liquids: t('EDITOR_ELEMENTS_PANEL_LIQUIDS'),\n        decorations: t('EDITOR_ELEMENTS_PANEL_DECORATIONS'),\n        entities: t('EDITOR_ELEMENTS_PANEL_ENTITIES'),\n        items: t('EDITOR_ELEMENTS_PANEL_ITEMS'),\n        interactables: t('EDITOR_ELEMENTS_PANEL_INTERACTABLES'),\n        hazards: t('EDITOR_ELEMENTS_PANEL_HAZARDS'),\n        secrets: t('EDITOR_ELEMENTS_PANEL_SECTORS'),\n        weather: t('EDITOR_ELEMENTS_PANEL_WEATHER'),\n        minigames: t('EDITOR_ELEMENTS_PANEL_MINI_GAMES'),\n        messages: t('EDITOR_ELEMENTS_PANEL_MESSAGES'),\n        obstacles: t('EDITOR_ELEMENTS_PANEL_OBSTACLES'),\n        stats: t('EDITOR_ELEMENTS_PANEL_STATISTICS'),\n        props: t('EDITOR_ELEMENTS_PANEL_PROPERTIES')\n    };\n\n    return (\n        <div style={{ display: 'flex', height: '100%', position: 'relative', zIndex: 1001 }}>\n            {/* Sidebar Left Icons */}\n            <SidebarContainer>\n                <ElementEditorButton onClick={() => handleIconClick('map')} onMouseEnter={() => handleIconMouseEnter('map')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'map'} title={t('EDITOR_ELEMENTS_ICON_MAP_CONTROLS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('blocks')} onMouseEnter={() => handleIconMouseEnter('blocks')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'blocks'} title={t('EDITOR_ELEMENTS_ICON_BLOCKS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('liquids')} onMouseEnter={() => handleIconMouseEnter('liquids')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'liquids'} title={t('EDITOR_ELEMENTS_ICON_LIQUIDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('decorations')} onMouseEnter={() => handleIconMouseEnter('decorations')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'decorations'} title={t('EDITOR_ELEMENTS_ICON_DECORATIONS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('obstacles')} onMouseEnter={() => handleIconMouseEnter('obstacles')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'obstacles'} title={t('EDITOR_ELEMENTS_ICON_OBSTACLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('items')} onMouseEnter={() => handleIconMouseEnter('items')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'items'} title={t('EDITOR_ELEMENTS_ICON_ITEMS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('entities')} onMouseEnter={() => handleIconMouseEnter('entities')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'entities'} title={t('EDITOR_ELEMENTS_ICON_ENTITIES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('interactables')} onMouseEnter={() => handleIconMouseEnter('interactables')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'interactables'} title={t('EDITOR_ELEMENTS_ICON_INTERACTABLES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('hazards')} onMouseEnter={() => handleIconMouseEnter('hazards')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'hazards'} title={t('EDITOR_ELEMENTS_ICON_HAZARDS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('secrets')} onMouseEnter={() => handleIconMouseEnter('secrets')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'secrets'} title={t('EDITOR_ELEMENTS_ICON_SECTORS')}>2</ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('weather')} onMouseEnter={() => handleIconMouseEnter('weather')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'weather'} title={t('EDITOR_ELEMENTS_ICON_WEATHER')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('minigames')} onMouseEnter={() => handleIconMouseEnter('minigames')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'minigames'} title={t('EDITOR_ELEMENTS_ICON_MINI_GAMES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('messages')} onMouseEnter={() => handleIconMouseEnter('messages')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'messages'} title={t('EDITOR_ELEMENTS_ICON_MESSAGES')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('stats')} onMouseEnter={() => handleIconMouseEnter('stats')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'stats'} title={t('EDITOR_ELEMENTS_ICON_STATISTICS')}></ElementEditorButton>\n                <ElementEditorButton onClick={() => handleIconClick('props')} onMouseEnter={() => handleIconMouseEnter('props')} onMouseLeave={handleIconMouseLeave} $active={activePanel === 'props'} title={t('EDITOR_ELEMENTS_ICON_PROPERTIES')}></ElementEditorButton>\n            </SidebarContainer>\n\n            {/* Sidebar Fixed Panel Content */}\n            <PanelContainer $isOpen={!!activePanel} onMouseEnter={handlePanelMouseEnter} onMouseLeave={handlePanelMouseLeave}>\n                {displayPanel && (\n                    <>\n                        {/* Panel Header */}\n                        <PanelHeader>\n                            <span>{panelTitles[displayPanel]}</span>\n                            <CloseButton onClick={() => { setPinnedPanel(null); setActivePanel(null); }}></CloseButton>\n                        </PanelHeader>\n\n                        {/* Panel Body */}\n                        <PanelBody>\n                            {displayPanel === 'map' && (\n                                <OperationsPanel \n                                    openNewMapModal={openNewMapModal}\n                                    openBuiltInModal={openBuiltInModal}\n                                    saveMap={saveMap}\n                                    loadMap={loadMap}\n                                    clearMap={clearMap}\n                                    mapName={mapName}\n                                    creatorName={creatorName}\n                                    mapDescription={mapDescription}\n                                    setMapName={setMapName}\n                                    setCreatorName={setCreatorName}\n                                    setMapDescription={setMapDescription}\n                                    mapType={mapType}\n                                    updateMapData={updateMapData}\n                                    activeMapId={activeMapId}\n                                />\n                            )}\n\n                            {(displayPanel === 'blocks' || \n                              displayPanel === 'liquids' || \n                              displayPanel === 'decorations' || \n                              displayPanel === 'entities' || \n                              displayPanel === 'items' || \n                              displayPanel === 'interactables' || \n                              displayPanel === 'hazards' || \n                              displayPanel === 'secrets' ||\n                              displayPanel === 'weather' ||\n                              displayPanel === 'minigames' ||\n                              displayPanel === 'messages' ||\n                              displayPanel === 'obstacles') && (\n                                <PalettePanel \n                                    isPlayMode={isPlayMode}\n                                    category={displayPanel}\n                                    blocks={blocks}\n                                    liquids={liquids}\n                                    entities={entities}\n                                    decorations={decorations}\n                                    items={items}\n                                    interactables={interactables}\n                                    hazards={hazards}\n                                    secrets={secrets}\n                                    miniGames={miniGames}\n                                    weather={weather}\n                                    messages={messages}\n                                    crackableWalls={crackableWalls}\n                                    pushableWalls={pushableWalls}\n                                    obstacles={obstacles}\n                                    handlePaletteSelect={handlePaletteSelect}\n                                    selectedTile={selectedTile}\n                                    objectMetadata={objectMetadata}\n                                    setObjectMetadata={setObjectMetadata}\n                                    objectMapData={objectMapData}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    registryItems={registryItems}\n                                />\n                            )}\n\n\n                            {displayPanel === 'stats' && (\n                                <StatisticsPanel \n                                    totalTiles={totalTiles}\n                                    mapWidth={mapWidth}\n                                    mapHeight={mapHeight}\n                                    filledBlocks={filledBlocks}\n                                    objectsCount={objectsCount}\n                                    emptyBlocks={emptyBlocks}\n                                    objectMapData={objectMapData}\n                                    registryItems={registryItems}\n                                    maps={maps}\n                                />\n                            )}\n\n                            {displayPanel === 'props' && (\n                                <ObjectPropsPanel \n                                    objectMapData={objectMapData}\n                                    secretMapData={secretMapData}\n                                    registryItems={registryItems}\n                                    mapWidth={mapWidth}\n                                    objectMetadata={objectMetadata}\n                                    highlightedIndex={highlightedIndex}\n                                    setHighlightedIndex={setHighlightedIndex}\n                                    setObjectMetadata={setObjectMetadata}\n                                    maps={maps}\n                                    activeMapId={activeMapId}\n                                    createMap={createMap}\n                                />\n                            )}\n                        </PanelBody>\n                    </>\n                )}\n            </PanelContainer>\n        </div>\n    );\n};\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n    EditorToolsContainer,\n    HeaderBar,\n    ToolsSection,\n    ToolsGroup,\n    ToolsInnerGroup,\n    ToolsRow,\n    ToolsEditorButton,\n    StrikeThrough,\n    LayerIndicator,\n    BgColorContainer,\n    BgColorInputWrapper,\n    BgColorInput,\n    BgTransparentButton,\n    PlayButtonContainer,\n    PlayButtonInner,\n    InfoContainer,\n    InfoItem,\n    InfoLabel,\n    InfoValue,\n    EraserButtonContainer,\n    EraserButtonInner,\n    SelectionActions,\n    ConfirmButton,\n    CancelButton,\n    GridIcon\n} from './styles/EditorToolsButton';\n\nexport const EditorTools = (props) => {\n    const { t } = useTranslation('editor_tools');\n    const {\n        mapName, \n        creatorName, \n        activePanel, \n        togglePanel,\n        showGrid, \n        setShowGrid,\n        isPlayMode,\n        handlePlay,\n        handlePause,\n        handleReset,\n        activeTool,\n        setActiveTool,\n        brushSize,\n        setBrushSize,\n        activeLayer,\n        selection,\n        moveSelection,\n        selectionMode,\n        setSelectionMode,\n        commitSelection,\n        cancelSelection,\n        selectedTile,\n        handlePaletteSelect,\n        selectedBackgroundColor,\n        setSelectedBackgroundColor,\n        showBackgroundImage,\n        setShowBackgroundImage,\n        showMessages,\n        setShowMessages,\n        isRoomAreaVisible,\n        setIsRoomAreaVisible,\n        showRoomMapContent,\n        setShowRoomMapContent\n    } = props;\n    const getEraserData = (layer) => {\n        const isLayerBrushActive = activeLayer === layer\n            && activeTool === 'brush'\n            && selectedTile !== null;\n        const isLayerBucketActive = activeLayer === layer\n            && activeTool === 'bucket'\n            && selectedTile !== null;\n        const isActive = (selectedTile === null && activeLayer === layer) || isLayerBrushActive || isLayerBucketActive;\n        const colors = {\n            tile: { bg: '#e6f7ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', text: '#722ed1' },\n            props: { bg: '#fffbe6', text: '#faad14' }\n        };\n        const active = colors[layer] || colors.tile;\n        return {\n            isActive,\n            bgColor: active.bg,\n            textColor: active.text\n        };\n    };\n\n    const getLayerIndicatorData = () => {\n        const colors = {\n            tile: { bg: '#e6f7ff', border: '#91d5ff', text: '#1890ff' },\n            object: { bg: '#fff1f0', border: '#ffa39e', text: '#f5222d' },\n            secret: { bg: '#f9f0ff', border: '#d3adf7', text: '#722ed1' },\n            props: { bg: '#fffbe6', border: '#ffe58f', text: '#faad14' }\n        };\n        const active = colors[activeLayer] || colors.tile;\n        return {\n            $bgColor: active.bg,\n            $borderColor: active.border,\n            $textColor: active.text\n        };\n    };\n\n    return (\n        <EditorToolsContainer>\n            {/* Main Header Bar */}\n            <HeaderBar>\n                <ToolsSection>\n                    <ToolsGroup>\n\n                        {/* Brush - Bucket - Move - Area */}\n                        <ToolsRow>\n                            {[\n                                { id: 'brush', icon: '', title: t('EDITOR_TOOLS_BRUSH_TITLE') },\n                                { id: 'bucket', icon: '', title: t('EDITOR_TOOLS_BUCKET_TITLE') },\n                                { id: 'move', icon: '', title: t('EDITOR_TOOLS_MOVE_TITLE') },\n                            ].map(tool => (\n                                <ToolsEditorButton\n                                    key={tool.id}\n                                    onClick={() => !isPlayMode && setActiveTool(tool.id)}\n                                    $active={activeTool === tool.id && !isPlayMode}\n                                    $square\n                                    $disabled={isPlayMode}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : tool.title}\n                                >\n                                    {tool.icon}\n                                    {isPlayMode && <StrikeThrough />}\n                                </ToolsEditorButton>\n                            ))}\n                        </ToolsRow>\n\n                        {/* Cut - Copy - Paste */}\n                        <ToolsInnerGroup>\n                            {['cut', 'copy'].map(mode => {\n                                const isDisabled = isPlayMode || activeTool !== 'move';\n                                return (\n                                    <ToolsEditorButton\n                                        key={mode}\n                                        onClick={() => !isDisabled && setSelectionMode(mode)}\n                                        $active={selectionMode === mode && !isDisabled}\n                                        $square\n                                        $disabled={isDisabled}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? (mode === 'cut' ? t('EDITOR_TOOLS_CUT_ONLY_MOVE') : t('EDITOR_TOOLS_COPY_ONLY_MOVE')) : (mode === 'cut' ? t('EDITOR_TOOLS_CUT_SELECTION') : t('EDITOR_TOOLS_COPY_SELECTION')))}\n                                    >\n                                        {mode === 'cut' ? '' : ''}\n                                        {isDisabled && <StrikeThrough />}\n                                    </ToolsEditorButton>\n                                );\n                            })}\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && activeTool === 'move' && commitSelection()}\n                                $square\n                                $disabled={isPlayMode || activeTool !== 'move'}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (activeTool !== 'move' ? t('EDITOR_TOOLS_PASTE_ONLY_MOVE') : t('EDITOR_TOOLS_PASTE_SELECTION'))}\n                            >\n                                \n                                {(isPlayMode || activeTool !== 'move') && <StrikeThrough />}\n                            </ToolsEditorButton>\n                            {selection && !isPlayMode && (\n                                <SelectionActions>\n                                    <ConfirmButton onClick={commitSelection} $square title={t('EDITOR_TOOLS_CONFIRM_SELECTION')}></ConfirmButton>\n                                    <CancelButton onClick={cancelSelection} $square title={t('EDITOR_TOOLS_CANCEL_SELECTION')}></CancelButton>\n                                </SelectionActions>\n                            )}\n                        </ToolsInnerGroup>\n\n                        {/* Size */}\n                        <ToolsInnerGroup>\n                            {['I', 'II', 'III', 'IV', 'V'].map((roman, idx) => {\n                                const size = idx + 1;\n                                const isDisabled = isPlayMode || activeTool !== 'brush';\n                                return (\n                                    <ToolsEditorButton \n                                        key={size} \n                                    onClick={() => !isDisabled && setBrushSize(size)} \n                                    $active={brushSize === size && !isDisabled} \n                                    $square \n                                    $disabled={isDisabled}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (isDisabled ? t('EDITOR_TOOLS_BRUSH_SIZE_ONLY') : t('EDITOR_TOOLS_BRUSH_SIZE', { size }))}\n                                >\n                                    {roman}\n                                    {isDisabled && <StrikeThrough />}\n                                </ToolsEditorButton>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        {/* Background Immage */}\n                        <ToolsRow>\n                            <ToolsEditorButton\n                                onClick={() => !isPlayMode && setShowBackgroundImage(!showBackgroundImage)}\n                                $active={showBackgroundImage && !isPlayMode}\n                                $square\n                                $disabled={isPlayMode}\n                                title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : (showBackgroundImage ? t('EDITOR_TOOLS_BACKGROUND_IMAGE_HIDE') : t('EDITOR_TOOLS_BACKGROUND_IMAGE_SHOW'))}\n                            >\n                                \n                                {isPlayMode && <StrikeThrough />}\n                            </ToolsEditorButton>\n\n                            {/* Grid */}\n                            <ToolsEditorButton\n                                onClick={() => setShowGrid(!showGrid)}\n                                $active={showGrid}\n                                $square\n                                title={showGrid ? t('EDITOR_TOOLS_GRID_HIDE') : t('EDITOR_TOOLS_GRID_SHOW')}\n                            >\n                                <GridIcon>\n                                    {showGrid ? '' : ''}\n                                </GridIcon>\n                            </ToolsEditorButton>\n\n                            {/* Messages Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowMessages(!showMessages)}\n                                $active={showMessages}\n                                $square\n                                title={showMessages ? t('EDITOR_TOOLS_MESSAGES_HIDE') : t('EDITOR_TOOLS_MESSAGES_SHOW')}\n                            >\n                                \n                            </ToolsEditorButton>\n\n                            {/* Room Area Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setIsRoomAreaVisible(!isRoomAreaVisible)}\n                                $active={isRoomAreaVisible}\n                                $square\n                                title={isRoomAreaVisible ? t('EDITOR_TOOLS_ROOM_AREA_HIDE') : t('EDITOR_TOOLS_ROOM_AREA_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Room Map Content Visibility */}\n                            <ToolsEditorButton\n                                onClick={() => setShowRoomMapContent(!showRoomMapContent)}\n                                $active={showRoomMapContent}\n                                $square\n                                title={showRoomMapContent ? t('EDITOR_TOOLS_ROOM_CONTENT_HIDE') : t('EDITOR_TOOLS_ROOM_CONTENT_SHOW')}\n                            >\n                                <span style={{ fontSize: '14px' }}></span>\n                            </ToolsEditorButton>\n\n                            {/* Background Color Picker */}\n                            <BgColorContainer>\n                                <BgColorInputWrapper>\n                                    <BgColorInput\n                                        type=\"color\"\n                                        value={selectedBackgroundColor && selectedBackgroundColor !== 'transparent' ? selectedBackgroundColor : '#000000'}\n                                        onChange={(e) => !isPlayMode && setSelectedBackgroundColor(e.target.value)}\n                                        title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_COLOR')}\n                                        disabled={isPlayMode}\n                                    />\n                                    {isPlayMode && <StrikeThrough />}\n                                </BgColorInputWrapper>\n                                <BgTransparentButton \n                                    $active={selectedBackgroundColor === 'transparent'}\n                                    onClick={() => !isPlayMode && setSelectedBackgroundColor('transparent')}\n                                    title={isPlayMode ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_BG_TRANSPARENT')}\n                                />\n                            </BgColorContainer>\n                        </ToolsRow>\n\n\n\n                        {/* Active Layer Indicator */}\n                        <ToolsInnerGroup>\n                            <LayerIndicator {...getLayerIndicatorData()}>\n                                {t('EDITOR_TOOLS_LAYER_LABEL', {\n                                    layer: activeLayer === 'tile'\n                                        ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                        : (activeLayer === 'object'\n                                            ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                            : (activeLayer === 'secret'\n                                                ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                })}\n                            </LayerIndicator>\n                        </ToolsInnerGroup>\n\n                        {/* Layers: Block - Object - Sector - Props */}\n                        <ToolsInnerGroup>\n                            {['tile', 'object', 'secret', 'props'].map(layer => {\n                                const { isActive, bgColor, textColor } = getEraserData(layer);\n                                const isDisabled = isPlayMode;\n                                return (\n                                    <EraserButtonContainer\n                                        key={layer}\n                                        onClick={() => !isDisabled && handlePaletteSelect(null, layer)}\n                                        $active={isActive && !isDisabled}\n                                        $disabled={isDisabled}\n                                        title={isDisabled ? t('EDITOR_TOOLS_DISABLED_PLAY_MODE') : t('EDITOR_TOOLS_ERASE_LABEL', {\n                                            layer: layer === 'tile'\n                                                ? t('EDITOR_TOOLS_LAYER_BLOCKS')\n                                                : (layer === 'object'\n                                                    ? t('EDITOR_TOOLS_LAYER_OBJECTS')\n                                                    : (layer === 'secret'\n                                                        ? t('EDITOR_TOOLS_LAYER_SECTORS')\n                                                        : t('EDITOR_TOOLS_LAYER_PROPERTIES')))\n                                        })}\n                                    >\n                                        <EraserButtonInner $bgColor={bgColor} $textColor={textColor} $active={isActive && !isDisabled}>\n                                            {layer === 'tile' ? 'B' : (layer === 'object' ? 'O' : (layer === 'secret' ? 'S' : 'P'))}\n                                        </EraserButtonInner>\n                                        {isDisabled && <StrikeThrough />}\n                                    </EraserButtonContainer>\n                                );\n                            })}\n                        </ToolsInnerGroup>\n\n                        <ToolsInnerGroup>\n                            <ToolsRow>\n                                <PlayButtonContainer onClick={isPlayMode ? handlePause : handlePlay} title={isPlayMode ? t('EDITOR_TOOLS_PAUSE_TITLE') : t('EDITOR_TOOLS_PLAY_TITLE')}>\n                                    <PlayButtonInner $variant={isPlayMode ? 'pause' : 'play'}>\n                                        <span>{isPlayMode ? '' : ''}</span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n\n                                <PlayButtonContainer onClick={handleReset} title={t('EDITOR_TOOLS_RESET_TITLE')}>\n                                    <PlayButtonInner>\n                                        <span></span>\n                                    </PlayButtonInner>\n                                </PlayButtonContainer>\n                            </ToolsRow>\n                        </ToolsInnerGroup>\n                    </ToolsGroup>\n                </ToolsSection>\n\n\n                <ToolsSection>\n                    <InfoContainer>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_MAP')}</InfoLabel>\n                            <InfoValue>{mapName}</InfoValue>\n                        </InfoItem>\n                        <InfoItem>\n                            <InfoLabel>{t('EDITOR_TOOLS_INFO_BY')}</InfoLabel>\n                            <InfoValue>{creatorName}</InfoValue>\n                        </InfoItem>\n                    </InfoContainer>\n                </ToolsSection>\n            </HeaderBar>\n        </EditorToolsContainer>\n    );\n};\n","import { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { TILE_SIZE } from '../../../../constants/gameConstants';\nimport { useGameEngine } from '../../../../utilities/useGameEngine';\nimport { applyWolfSecretShift, shouldRemoveCrackBlock } from '../../../../engine/gameplay/secrets';\nimport { shouldTriggerBreakEffect, getBreakEffectParams } from '../../../../engine/gameplay/breakEffects';\n\nconst EMPTY_ARRAY = [];\n\nexport const useEditorPlayMode = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n    selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n    registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    maps, activeMapId, switchMap, spawnTriggerId,\n    setTileMapData, updateMapData\n) => {\n    const [isPlayMode, setIsPlayMode] = useState(false);\n    const [isGameOver, setIsGameOver] = useState(false);\n    const [restartCounter, setRestartCounter] = useState(0);\n    const [editorSnapshot, setEditorSnapshot] = useState(null);\n    const [revealedSecrets, setRevealedSecrets] = useState([]);\n    const [activeRoomIds, setActiveRoomIds] = useState(new Set());\n    const [playModeObjectData, setPlayModeObjectData] = useState([]);\n    const [playModeSecretData, setPlayModeSecretData] = useState([]);\n    const [playModeWeather, setPlayModeWeather] = useState({\n        rain: 0, snow: 0, clouds: 0, fog: 0, thunder: 0,\n        lavaRain: 0, radioactiveFog: 0, meteorRain: 0\n    });\n    const [playModeMapsVersion, setPlayModeMapsVersion] = useState(0);\n    const [gameMessage, setGameMessage] = useState({ text: '', isVisible: false });\n    const messageTimerRef = useRef(null);\n    const lastSyncedMapIdRef = useRef(null);\n    const isPlayModeRef = useRef(isPlayMode);\n    const playModeMapsRef = useRef({});\n\n    useEffect(() => {\n        isPlayModeRef.current = isPlayMode;\n    }, [isPlayMode]);\n\n    // Stability for engine initialization - only changes when map changes or play mode is toggled\n    const engineInitId = useMemo(() => {\n        return isPlayMode ? `${activeMapId}_${restartCounter}_${Date.now()}` : null;\n    }, [isPlayMode, activeMapId, restartCounter]);\n\n    // Derived data to ensure useGameEngine gets fresh data even before useEffect syncs state.\n    // This prevents the engine from using old map data during initialization.\n    const currentPlayObjectData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) {\n            const playData = [...objectMapData];\n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n            return playData;\n        }\n        return playModeObjectData;\n    }, [isPlayMode, activeMapId, playModeObjectData, objectMapData, spawnTriggerId, mapWidth, mapHeight]);\n\n    const currentPlaySecretData = useMemo(() => {\n        if (!isPlayMode) return EMPTY_ARRAY;\n        if (lastSyncedMapIdRef.current !== activeMapId) return [...secretMapData];\n        return playModeSecretData;\n    }, [isPlayMode, activeMapId, playModeSecretData, secretMapData]);\n\n    const playModeMaps = useMemo(() => {\n        if (!isPlayMode) return maps;\n        const overrides = playModeMapsRef.current || {};\n        const merged = { ...maps };\n        Object.keys(overrides).forEach(id => {\n            if (!merged[id]) return;\n            merged[id] = {\n                ...merged[id],\n                objectMapData: overrides[id].objectMapData || merged[id].objectMapData,\n                secretMapData: overrides[id].secretMapData || merged[id].secretMapData,\n                objectMetadata: overrides[id].objectMetadata || merged[id].objectMetadata\n            };\n        });\n        return merged;\n    }, [isPlayMode, maps, playModeMapsVersion]);\n\n    const mapDataForGame = useMemo(() => ({\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: TILE_SIZE,\n            activeMapId: activeMapId,\n            spawnTriggerId: spawnTriggerId,\n            backgroundImage: selectedBackgroundImage,\n            backgroundColor: selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            objectMetadata: objectMetadata,\n            activeRoomIds: Array.from(activeRoomIds),\n            date_map_last_updated: engineInitId, \n            weather: {\n                rain: isPlayMode ? playModeWeather.rain : weatherRain,\n                lavaRain: isPlayMode ? playModeWeather.lavaRain : weatherLavaRain,\n                snow: isPlayMode ? playModeWeather.snow : weatherSnow,\n                meteorRain: isPlayMode ? playModeWeather.meteorRain : weatherMeteorRain,\n                clouds: isPlayMode ? playModeWeather.clouds : weatherClouds,\n                fog: isPlayMode ? playModeWeather.fog : weatherFog,\n                radioactiveFog: isPlayMode ? playModeWeather.radioactiveFog : weatherRadioactiveFog,\n                thunder: isPlayMode ? playModeWeather.thunder : weatherThunder\n            }\n        },\n        maps: playModeMaps, // Project maps for inter-map teleports\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: currentPlayObjectData },\n            { type: \"secret\", name: \"secrets\", data: currentPlaySecretData }\n        ]\n    }), [\n        mapWidth, mapHeight, activeMapId, spawnTriggerId, selectedBackgroundImage, selectedBackgroundColor, \n        backgroundParallaxFactor, tileMapData, currentPlayObjectData, objectMetadata, activeRoomIds,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playModeWeather,\n        isPlayMode, playModeMaps, engineInitId\n    ]);\n\n    // Synchronize play mode state when map changes (e.g., during inter-map teleport)\n    useEffect(() => {\n        if (isPlayMode && lastSyncedMapIdRef.current !== activeMapId) {\n            const saved = playModeMapsRef.current?.[activeMapId];\n            if (saved) {\n                setPlayModeObjectData([...saved.objectMapData]);\n                setPlayModeSecretData([...(saved.secretMapData || [])]);\n                if (saved.objectMetadata) {\n                    setObjectMetadata({ ...saved.objectMetadata });\n                }\n                setRevealedSecrets([]);\n                if (messageTimerRef.current) {\n                    clearTimeout(messageTimerRef.current);\n                    messageTimerRef.current = null;\n                }\n                setGameMessage({ text: '', isVisible: false });\n                lastSyncedMapIdRef.current = activeMapId;\n                return;\n            }\n            const playData = [...objectMapData];\n            \n            let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1 && (spawnTriggerId === null || spawnTriggerId === undefined)) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                playData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(playData);\n            setPlayModeSecretData([...secretMapData]);\n            setRevealedSecrets([]);\n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n                messageTimerRef.current = null;\n            }\n            setGameMessage({ text: '', isVisible: false });\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    }, [activeMapId, isPlayMode, objectMapData, secretMapData, mapWidth, mapHeight, spawnTriggerId]);\n\n    const handleGameOver = useCallback(() => {\n        setIsGameOver(true);\n    }, []);\n\n    const handleReplay = useCallback(() => {\n        setIsGameOver(false);\n        setRestartCounter(prev => prev + 1);\n        setRevealedSecrets([]);\n        if (editorSnapshot) {\n            setPlayModeObjectData([...editorSnapshot.objectMapData]);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n        }\n    }, [editorSnapshot, setObjectMetadata]);\n\n    const handleStateUpdate = useCallback((newState, payload) => {\n        if (newState && typeof newState === 'object' && newState.x !== undefined && newState.y !== undefined) {\n            setPlayerPosition({ x: newState.x, y: newState.y });\n        } else if (newState === 'collectItem' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const newData = [...prev];\n                    newData[index] = null;\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newData = [...(playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [])];\n                newData[index] = null;\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMapData: newData\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'interactable' && payload !== undefined) {\n            const { index, mapId } = typeof payload === 'object' ? payload : { index: payload, mapId: null };\n            if (!mapId || mapId === activeMapId) {\n                setPlayModeObjectData(prev => {\n                    const currentId = prev[index];\n                    if (!currentId) return prev;\n                    const newData = [...prev];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return newData;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const mapObj = playModeMapsRef.current?.[mapId]?.objectMapData || maps[mapId].objectMapData || [];\n                const currentId = mapObj[index];\n                if (currentId) {\n                    const newData = [...mapObj];\n                    newData[index] = currentId + '_used';\n                    playModeMapsRef.current[mapId] = {\n                        ...(playModeMapsRef.current[mapId] || {}),\n                        objectMapData: newData\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                }\n            }\n        } else if (newState === 'setObjectFrame' && payload !== undefined) {\n            const { index, frame, mapId } = payload;\n            if (!mapId || mapId === activeMapId) {\n                setObjectMetadata(prev => {\n                    const next = {\n                        ...prev,\n                        [index]: { ...prev[index], currentFrame: frame }\n                    };\n                    playModeMapsRef.current[activeMapId] = {\n                        ...(playModeMapsRef.current[activeMapId] || {}),\n                        objectMetadata: next\n                    };\n                    setPlayModeMapsVersion(v => v + 1);\n                    return next;\n                });\n            } else if (updateMapData && maps[mapId]) {\n                const newMeta = { ...((playModeMapsRef.current?.[mapId]?.objectMetadata) || maps[mapId].objectMetadata || {}) };\n                newMeta[index] = { ...(newMeta[index] || {}), currentFrame: frame };\n                playModeMapsRef.current[mapId] = {\n                    ...(playModeMapsRef.current[mapId] || {}),\n                    objectMetadata: newMeta\n                };\n                setPlayModeMapsVersion(v => v + 1);\n            }\n        } else if (newState === 'switchMap' && payload !== undefined) {\n            const { targetMapId, triggerId } = payload;\n            \n            // Check if target is a room\n            const targetMap = maps[targetMapId];\n            if (targetMap && targetMap.type === 'room') {\n                setActiveRoomIds(prev => {\n                    const next = new Set(prev);\n                    if (next.has(targetMapId)) next.delete(targetMapId);\n                    else next.add(targetMapId);\n                    return next;\n                });\n            } else if (targetMapId === 'main' && activeRoomIds.size > 0) {\n                setActiveRoomIds(new Set());\n            } else if (switchMap && targetMapId) {\n                playModeMapsRef.current[activeMapId] = {\n                    objectMapData: [...playModeObjectData],\n                    secretMapData: [...playModeSecretData],\n                    objectMetadata: { ...objectMetadata }\n                };\n                setPlayModeMapsVersion(v => v + 1);\n                // We keep play mode active when switching maps via teleport\n                switchMap(targetMapId, triggerId);\n            }\n        } else if (newState === 'objectDamage' && payload !== undefined) {\n            const { index, damage } = payload;\n            const objId = playModeObjectData[index];\n            const def = registryItems.find(r => r.id === objId);\n            if (!def) return;\n\n            setObjectMetadata(prev => {\n                const current = prev[index] || {};\n                const maxH = def.maxHealth || 100;\n                const newHealth = Math.max(0, (current.health !== undefined ? current.health : maxH) - damage);\n                \n                if (shouldRemoveCrackBlock(def, newHealth)) {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[index] = null;\n                            return newTiles;\n                        });\n                    }\n                }\n\n                if (shouldTriggerBreakEffect(def, newHealth) && !current.breakFxPlayed) {\n                    const cfg = getBreakEffectParams(def);\n                    if (cfg) {\n                        const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        const y = Math.floor(index / mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n                        window.dispatchEvent(new CustomEvent('game-break-effect', {\n                            detail: { x, y, config: cfg }\n                        }));\n                    }\n                }\n\n                return {\n                    ...prev,\n                    [index]: { ...current, health: newHealth, breakFxPlayed: current.breakFxPlayed || shouldTriggerBreakEffect(def, newHealth) }\n                };\n            });\n            const nextMeta = {\n                ...(objectMetadata || {}),\n                [index]: {\n                    ...(objectMetadata?.[index] || {}),\n                    health: Math.max(0, ((objectMetadata?.[index]?.health ?? (def.maxHealth || 100)) - damage))\n                }\n            };\n            playModeMapsRef.current[activeMapId] = {\n                ...(playModeMapsRef.current[activeMapId] || {}),\n                objectMetadata: nextMeta\n            };\n            setPlayModeMapsVersion(v => v + 1);\n\n            const x = (index % mapWidth) * TILE_SIZE + TILE_SIZE / 2;\n            const y = Math.floor(index / mapWidth) * TILE_SIZE;\n            window.dispatchEvent(new CustomEvent('game-floating-text', {\n                detail: { x, y, text: `-${damage}`, color: '#ff3b3b', amount: damage }\n            }));\n        } else if (newState === 'entityDamage' && payload) {\n            const { x, y, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(amount)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(amount)}`, color: '#ff3b3b', amount }\n                }));\n            }\n        } else if (newState === 'shiftTile' && payload !== undefined) {\n            const { index, dx, dy } = payload;\n            const mapIdAtStart = activeMapId;\n            \n            applyWolfSecretShift({\n                index,\n                dx,\n                dy,\n                mapWidth,\n                mapHeight,\n                getObjectId: idx => playModeObjectData[idx],\n                getObjectDef: objId => registryItems.find(r => r.id === objId),\n                moveTile: (from, to) => {\n                    if (setTileMapData) {\n                        setTileMapData(prevTiles => {\n                            const newTiles = [...prevTiles];\n                            newTiles[to] = newTiles[from];\n                            newTiles[from] = null;\n                            return newTiles;\n                        });\n                    }\n                },\n                moveObject: (from, to) => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[to] = newObjs[from];\n                        newObjs[from] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                moveMetadata: (from, to) => {\n                    setObjectMetadata(prevMeta => {\n                        const newMeta = { ...prevMeta };\n                        if (newMeta[from]) {\n                            newMeta[to] = newMeta[from];\n                            delete newMeta[from];\n                        }\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMetadata: newMeta\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newMeta;\n                    });\n                },\n                removeObject: idx => {\n                    setPlayModeObjectData(prevObjs => {\n                        const newObjs = [...prevObjs];\n                        newObjs[idx] = null;\n                        playModeMapsRef.current[activeMapId] = {\n                            ...(playModeMapsRef.current[activeMapId] || {}),\n                            objectMapData: newObjs\n                        };\n                        setPlayModeMapsVersion(v => v + 1);\n                        return newObjs;\n                    });\n                },\n                shouldCancel: () => !isPlayModeRef.current || activeMapId !== mapIdAtStart\n            });\n        } else if (newState === 'updateWeather' && payload) {\n            const { type, value } = payload;\n            setPlayModeWeather(prev => ({\n                ...prev,\n                [type]: value\n            }));\n            \n            // Dispatch event for any UI components that might be listening\n            const settingKey = 'weather' + type.charAt(0).toUpperCase() + type.slice(1);\n            window.dispatchEvent(new CustomEvent('game-settings-update', { \n                detail: { [settingKey]: value } \n            }));\n        } else if (newState === 'showMessage' && payload) {\n            const { text, duration } = payload;\n            \n            if (messageTimerRef.current) {\n                clearTimeout(messageTimerRef.current);\n            }\n            \n            setGameMessage({ text, isVisible: true });\n            \n            messageTimerRef.current = setTimeout(() => {\n                setGameMessage(prev => ({ ...prev, isVisible: false }));\n                messageTimerRef.current = null;\n            }, duration || 8000);\n        } else if (newState === 'weatherEffectHit' && payload) {\n            const { type, data } = payload;\n            window.dispatchEvent(new CustomEvent('weather-effect-hit', { detail: { type, data } }));\n        } else if (newState === 'floatingText' && payload) {\n            const { x, y, text, color, amount } = payload;\n            if (Number.isFinite(x) && Number.isFinite(y) && text) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text, color, amount }\n                }));\n            }\n        } else if (newState === 'playerDamage' && payload !== undefined) {\n            const { damage, x, y } = payload || {};\n            if (Number.isFinite(x) && Number.isFinite(y) && Number.isFinite(damage)) {\n                window.dispatchEvent(new CustomEvent('game-floating-text', {\n                    detail: { x, y, text: `-${Math.round(damage)}`, color: '#ff3b3b', amount: damage }\n                }));\n            }\n        }\n    }, [activeMapId, maps, updateMapData, activeRoomIds, playModeObjectData, registryItems, setPlayerPosition, setObjectMetadata, switchMap, playModeSecretData, objectMetadata, mapWidth, mapHeight]);\n\n    const handleRevealSecret = useCallback((secretIndices) => {\n        const next = Array.isArray(secretIndices) ? secretIndices : [secretIndices];\n        if (next.length === 0) return;\n        setRevealedSecrets(prev => [...prev, ...next]);\n    }, []);\n\n    const gameEngineState = useGameEngine(\n        isPlayMode ? mapDataForGame : null,\n        isPlayMode ? tileMapData : EMPTY_ARRAY,\n        isPlayMode ? currentPlayObjectData : EMPTY_ARRAY,\n        isPlayMode ? currentPlaySecretData : EMPTY_ARRAY,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret,\n        objectMetadata,\n        Array.from(activeRoomIds),\n        mapWidth,\n        mapHeight\n    );\n\n    const handlePlay = () => {\n        setEditorSnapshot({\n            tileMapData: [...tileMapData],\n            objectMapData: [...objectMapData],\n            secretMapData: [...secretMapData],\n            objectMetadata: { ...objectMetadata },\n            playerPosition: { ...playerPosition }\n        });\n\n        const playData = [...objectMapData];\n        let spawnIndex = playData.findIndex(id => id && id.includes('player'));\n        if (spawnIndex === -1) {\n            const spawnX = Math.min(3, mapWidth - 1);\n            const spawnY = Math.min(3, mapHeight - 1);\n            spawnIndex = spawnY * mapWidth + spawnX;\n            playData[spawnIndex] = 'player';\n        }\n\n        setPlayModeObjectData(playData);\n        setPlayModeSecretData([...secretMapData]);\n        playModeMapsRef.current = {\n            [activeMapId]: {\n                objectMapData: playData,\n                secretMapData: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            }\n        };\n        setPlayModeMapsVersion(v => v + 1);\n        setPlayModeWeather({\n            rain: weatherRain,\n            snow: weatherSnow,\n            clouds: weatherClouds,\n            fog: weatherFog,\n            thunder: weatherThunder,\n            lavaRain: weatherLavaRain,\n            radioactiveFog: weatherRadioactiveFog,\n            meteorRain: weatherMeteorRain\n        });\n        setRevealedSecrets([]);\n        lastSyncedMapIdRef.current = activeMapId;\n        setIsPlayMode(true);\n        setIsGameOver(false); // Reset game over when starting play mode\n    };\n\n    const handlePause = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false); // Reset game over when exiting play mode\n        playModeMapsRef.current = {};\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    const handleReset = () => {\n        if (editorSnapshot) {\n            if (setTileMapData) {\n                setTileMapData([...editorSnapshot.tileMapData]);\n            }\n\n            const resetData = [...editorSnapshot.objectMapData];\n            let spawnIndex = resetData.findIndex(id => id && id.includes('player'));\n            if (spawnIndex === -1) {\n                const spawnX = Math.min(3, mapWidth - 1);\n                const spawnY = Math.min(3, mapHeight - 1);\n                spawnIndex = spawnY * mapWidth + spawnX;\n                resetData[spawnIndex] = 'player';\n            }\n\n            setPlayModeObjectData(resetData);\n            setPlayModeSecretData([...editorSnapshot.secretMapData]);\n            setObjectMetadata({ ...editorSnapshot.objectMetadata });\n            setRevealedSecrets([]);\n            playModeMapsRef.current = {\n                [activeMapId]: {\n                    objectMapData: resetData,\n                    secretMapData: [...editorSnapshot.secretMapData],\n                    objectMetadata: { ...editorSnapshot.objectMetadata }\n                }\n            };\n            setPlayModeMapsVersion(v => v + 1);\n            lastSyncedMapIdRef.current = activeMapId;\n        }\n    };\n\n    const handleForceStop = () => {\n        setIsPlayMode(false);\n        setIsGameOver(false);\n        setEditorSnapshot(null);\n        setPlayModeObjectData([]);\n        setPlayModeSecretData([]);\n        setRevealedSecrets([]);\n        playModeMapsRef.current = {};\n        lastSyncedMapIdRef.current = null;\n        setPlayModeMapsVersion(v => v + 1);\n    };\n\n    return {\n        isPlayMode,\n        setIsPlayMode,\n        isGameOver,\n        handlePlay,\n        handlePause,\n        handleReset,\n        handleForceStop,\n        handleReplay,\n        handleStateUpdate,\n        playModeObjectData: currentPlayObjectData,\n        playModeSecretData: currentPlaySecretData,\n        playModeWeather,\n        playModeMaps,\n        gameMessage,\n        revealedSecrets,\n        activeRoomIds: Array.from(activeRoomIds),\n        gameEngineState\n    };\n};\n","import { useCallback } from 'react';\nimport { saveMap, loadMap, loadBuiltInMap, clearMap } from '../editorTools/mapOperations';\n\nexport const useEditorOperations = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    mapName, creatorName, mapDescription, createdAt,\n    selectedBackgroundImage, selectedBackgroundColor,\n    backgroundParallaxFactor, selectedBackgroundMusic, playerPosition,\n    registryItems, setCreatedAt,\n    setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n    setSelectedBackgroundImage, setSelectedBackgroundColor,\n    setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n    weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n    weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n    setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n    setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n    // Multi-map props\n    maps, setMaps, activeMapId, setActiveMapId\n) => {\n    const handleSaveMap = useCallback(() => {\n        // Construct the updated maps object with current active map data\n        // to ensure latest changes are saved even if debounce hasn't run\n        const currentMapData = {\n            ...maps[activeMapId],\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weather: {\n                rain: weatherRain,\n                snow: weatherSnow,\n                clouds: weatherClouds,\n                fog: weatherFog,\n                thunder: weatherThunder,\n                lavaRain: weatherLavaRain,\n                radioactiveFog: weatherRadioactiveFog,\n                meteorRain: weatherMeteorRain\n            },\n            playerPosition\n        };\n\n        const updatedMaps = {\n            ...maps,\n            [activeMapId]: currentMapData\n        };\n\n        saveMap({\n            maps: updatedMaps, \n            activeMapId,\n            mapName, creatorName, mapDescription, createdAt,\n            registryItems, setCreatedAt\n        });\n    }, [\n        maps, activeMapId, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain\n    ]);\n\n    const handleLoadMap = useCallback((event) => {\n        loadMap({\n            event, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleLoadBuiltInMap = useCallback((mapData) => {\n        loadBuiltInMap({\n            mapData, setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n            setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n            setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n            setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n            setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n            setMaps, setActiveMapId\n        });\n    }, [\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        setMaps, setActiveMapId\n    ]);\n\n    const handleClearMap = useCallback(() => {\n        clearMap({ \n            mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata \n        });\n    }, [mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    const openNewMapModal = () => {\n        setTempMapName(mapName);\n        setTempCreatorName(creatorName);\n        setTempMapDescription(mapDescription);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = (tempMapName, tempCreatorName, tempMapDescription) => {\n        setMapName(tempMapName || \"New Map\");\n        setCreatorName(tempCreatorName || \"Anonymous\");\n        setMapDescription(tempMapDescription || \"\");\n        setCreatedAt(new Date().toISOString());\n        \n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n        setObjectMetadata({});\n        \n        setIsNewMapModalOpen(false);\n    };\n\n    return {\n        handleSaveMap,\n        handleLoadMap,\n        handleLoadBuiltInMap,\n        handleClearMap,\n        openNewMapModal,\n        confirmNewMap\n    };\n};\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = new Set();\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.add(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    if (startId === targetId) return currentData;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    return newData;\n};\n\nexport const paintTile = ({\n    index, brushSize, activeLayer, selectedTile,\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n    setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n    isRoomAreaVisible, activeTool\n}) => {\n    const isPropsLayer = activeLayer === 'props';\n    const targetLayer = isPropsLayer ? 'object' : activeLayer;\n\n    const targetData = targetLayer === 'tile' ? tileMapData : (targetLayer === 'object' ? objectMapData : secretMapData);\n    const setTargetData = targetLayer === 'tile' ? setTileMapData : (targetLayer === 'object' ? setObjectMapData : setSecretMapData);\n    \n    const newData = [...targetData];\n    let newMetadata = objectMetadata ? { ...objectMetadata } : null;\n    let metadataChanged = false;\n\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                \n                // Protection for Room Areas\n                if (targetLayer === 'secret' && secretMapData[targetIndex] === 'room_area') {\n                    const isRoomAreaTool = activeTool === 'area' || selectedTile?.id === 'room_area';\n                    const isEraser = selectedTile === null;\n                    if (!isRoomAreaVisible && !isRoomAreaTool && !isEraser) {\n                        continue; // Skip overwriting room_area if not visible and not using room tool\n                    }\n                }\n\n                if (isPropsLayer && selectedTile === null) {\n                    // In props layer eraser mode, remove object + metadata.\n                    newData[targetIndex] = null;\n                    if (newMetadata && newMetadata[targetIndex]) {\n                        delete newMetadata[targetIndex];\n                        metadataChanged = true;\n                    }\n                } else {\n                    newData[targetIndex] = selectedTile ? selectedTile.id : null;\n                    // If we are painting/erasing in object layer, we should also handle metadata\n                    if (targetLayer === 'object' && selectedTile === null) {\n                        if (newMetadata && newMetadata[targetIndex]) {\n                            delete newMetadata[targetIndex];\n                            metadataChanged = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    setTargetData(newData);\n    if (metadataChanged && setObjectMetadata) {\n        setObjectMetadata(newMetadata);\n    }\n};\n","import { useState, useRef, useEffect, useCallback } from 'react';\nimport { getFloodFillIndices, floodFill, paintTile as paintTileUtil } from '../editorTools/paintingTools';\n\nexport const useEditorPainting = (\n    mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n    setTileMapData, setObjectMapData, setSecretMapData,\n    activeTool, brushSize, activeLayer, selectedTile, selection, \n    setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n    setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n    objectMetadata, setObjectMetadata,\n    maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n) => {\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [resizeState, setResizeState] = useState(null); // { index, edge, startX, startY, startW, startH }\n    const [moveState, setMoveState] = useState(null); // { index, startX, startY, objId, secretId, meta }\n    const bucketTimerRef = useRef(null);\n    const rightEraseRef = useRef(false);\n\n    const getLinkedRoomAt = useCallback((index) => {\n        if (!showRoomMapContent || !secretMapData || !objectMetadata) return null;\n        \n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n\n        // Scan for room areas\n        for (const [idxStr, meta] of Object.entries(objectMetadata)) {\n            const idx = parseInt(idxStr);\n            if (secretMapData[idx] === 'room_area' && meta.linkedMapId && maps[meta.linkedMapId]) {\n                const rx = idx % mapWidth;\n                const ry = Math.floor(idx / mapWidth);\n                const rw = meta.width || 1;\n                const rh = meta.height || 1;\n\n                if (x >= rx && x < rx + rw && y >= ry && y < ry + rh) {\n                    return {\n                        mapId: meta.linkedMapId,\n                        roomX: rx,\n                        roomY: ry,\n                        roomWidth: rw,\n                        roomHeight: rh,\n                        localX: x - rx,\n                        localY: y - ry,\n                        map: maps[meta.linkedMapId]\n                    };\n                }\n            }\n        }\n        return null;\n    }, [showRoomMapContent, secretMapData, objectMetadata, maps, mapWidth]);\n\n    const paintTile = useCallback((index, overrideSelectedTile) => {\n        const effectiveTile = overrideSelectedTile !== undefined ? overrideSelectedTile : selectedTile;\n        const linkedRoom = getLinkedRoomAt(index);\n        \n        if (linkedRoom && showRoomMapContent) {\n            const { mapId, localX, localY, map } = linkedRoom;\n            const rWidth = map.mapWidth;\n            const rHeight = map.mapHeight;\n            const roomIndex = localY * rWidth + localX;\n\n            const setRoomData = (layer, newData) => {\n                updateMapData(mapId, { [layer]: newData });\n            };\n\n            const setRoomMetadata = (newMeta) => {\n                updateMapData(mapId, { objectMetadata: newMeta });\n            };\n\n            paintTileUtil({\n            index: roomIndex,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile: effectiveTile,\n                mapWidth: rWidth,\n                mapHeight: rHeight,\n                tileMapData: map.tileMapData || [],\n                objectMapData: map.objectMapData || [],\n                secretMapData: map.secretMapData || [],\n                objectMetadata: map.objectMetadata || {},\n                setTileMapData: (data) => setRoomData('tileMapData', data),\n                setObjectMapData: (data) => setRoomData('objectMapData', data),\n                setSecretMapData: (data) => setRoomData('secretMapData', data),\n                setObjectMetadata: setRoomMetadata,\n                isRoomAreaVisible\n            });\n            return;\n        }\n\n        paintTileUtil({\n            index,\n            activeTool,\n            brushSize,\n            activeLayer,\n            selectedTile: effectiveTile,\n            mapWidth,\n            mapHeight,\n            tileMapData,\n            objectMapData,\n            secretMapData,\n            objectMetadata,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData,\n            setObjectMetadata,\n            isRoomAreaVisible\n        });\n    }, [getLinkedRoomAt, showRoomMapContent, updateMapData, activeTool, brushSize, activeLayer, selectedTile, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, isRoomAreaVisible]);\n\n    const handleResizeStart = useCallback((index, edge) => {\n        const meta = objectMetadata[index] || {};\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setResizeState({\n            index,\n            edge,\n            startX: x,\n            startY: y,\n            startW: meta.width || 1,\n            startH: meta.height || 1\n        });\n        setIsDragging(true);\n    }, [objectMetadata, mapWidth, setIsDragging]);\n\n    const handleMoveStart = useCallback((index) => {\n        const x = index % mapWidth;\n        const y = Math.floor(index / mapWidth);\n        setMoveState({\n            index,\n            startX: x,\n            startY: y,\n            objId: objectMapData[index],\n            secretId: secretMapData[index],\n            meta: objectMetadata[index] ? { ...objectMetadata[index] } : null\n        });\n        setIsDragging(true);\n        setHighlightedIndex(index);\n    }, [objectMapData, secretMapData, objectMetadata, mapWidth, setIsDragging, setHighlightedIndex]);\n\n    const handleGridMouseDown = useCallback((index, e) => {\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n        const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n        const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n        \n        const mTileMapData = useLinked ? linkedRoom.map.tileMapData : tileMapData;\n        const mObjectMapData = useLinked ? linkedRoom.map.objectMapData : objectMapData;\n        const mSecretMapData = useLinked ? linkedRoom.map.secretMapData : secretMapData;\n        const mObjectMetadata = useLinked ? linkedRoom.map.objectMetadata : objectMetadata;\n\n        const mSetTileMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { tileMapData: data }) : setTileMapData;\n        const mSetObjectMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMapData: data }) : setObjectMapData;\n        const mSetSecretMapData = useLinked ? (data) => updateMapData(linkedRoom.mapId, { secretMapData: data }) : setSecretMapData;\n        const mSetObjectMetadata = useLinked ? (data) => updateMapData(linkedRoom.mapId, { objectMetadata: data }) : setObjectMetadata;\n\n        // Quick select for configurable objects\n        const existingObjId = mObjectMapData[mIndex];\n        const existingSecretId = mSecretMapData[mIndex];\n        const isEraser = selectedTile === null && activeTool === 'brush';\n        const isRoomMap = maps[activeMapId]?.type === 'room';\n\n        if (!isEraser && (existingObjId || existingSecretId) && setActivePanel && setHighlightedIndex) {\n            const objDef = existingObjId ? registryItems?.find(r => r.id === existingObjId) : null;\n            const secretDef = existingSecretId ? registryItems?.find(r => r.id === existingSecretId) : null;\n\n            const isWeather = objDef && objDef.type === 'weather_trigger';\n            const isMessage = objDef && objDef.type === 'message_trigger';\n            const isPortalOrTarget = existingObjId && (existingObjId.includes('portal') || existingObjId.includes('target') || existingObjId === 'portal_target');\n            const isDoor = objDef && objDef.subtype === 'door';\n            const isRoomArea = secretDef && secretDef.subtype === 'room' && !isRoomMap;\n\n            if (isWeather || isMessage || isPortalOrTarget || isDoor || isRoomArea) {\n                setActivePanel('props');\n                setHighlightedIndex(useLinked ? index : mIndex);\n            }\n        }\n\n        if (activeTool === 'brush') {\n            const isRightErase = e.button === 2;\n            rightEraseRef.current = isRightErase;\n            if (isRightErase) {\n                e.preventDefault();\n                setIsDragging(true);\n                paintTile(index, null);\n                return;\n            }\n            setIsDragging(true);\n            paintTile(index);\n        } else if (activeTool === 'area') {\n            setIsDragging(true);\n            setDragStart({ x: index % mapWidth, y: Math.floor(index / mapWidth) });\n        } else if (activeTool === 'bucket') {\n            const isPropsLayer = activeLayer === 'props';\n            const targetLayer = isPropsLayer ? 'object' : activeLayer;\n            const targetData = targetLayer === 'tile' ? mTileMapData : (targetLayer === 'object' ? mObjectMapData : mSecretMapData);\n            const targetValue = targetData[mIndex];\n            const newValue = selectedTile ? selectedTile.id : null;\n            if (targetValue === newValue) return;\n\n            const newData = floodFill(mIndex, newValue, targetData, mWidth, mHeight);\n            \n            if (targetLayer === 'tile') mSetTileMapData(newData);\n            else if (targetLayer === 'object') {\n                mSetObjectMapData(newData);\n                // Clean up metadata for all affected indices if erasing\n                if (newValue === null && mObjectMetadata && mSetObjectMetadata) {\n                    const affectedIndices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                    let metaChanged = false;\n                    const newMeta = { ...mObjectMetadata };\n                    affectedIndices.forEach(idx => {\n                        if (newMeta[idx]) {\n                            delete newMeta[idx];\n                            metaChanged = true;\n                        }\n                    });\n                    if (metaChanged) mSetObjectMetadata(newMeta);\n                }\n            }\n            else mSetSecretMapData(newData);\n        } else if (activeTool === 'move') {\n            if (selection) return;\n\n            // If we clicked on an object/secret, start moving it\n            if (existingObjId || existingSecretId) {\n                handleMoveStart(mIndex); // Note: move/resize on linked rooms might still be buggy\n            } else {\n                const x = index % mapWidth;\n                const y = Math.floor(index / mapWidth);\n                setDragStart({ x, y });\n                setIsDragging(true);\n            }\n        }\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata, setActivePanel, setHighlightedIndex, registryItems, activeTool, setIsDragging, paintTile, activeLayer, selectedTile, selection, handleMoveStart, setDragStart, getLinkedRoomAt, showRoomMapContent, updateMapData]);\n\n    const handleGridMouseMove = useCallback((index) => {\n        setHoverIndex(index);\n        const curX = index % mapWidth;\n        const curY = Math.floor(index / mapWidth);\n\n        const linkedRoom = getLinkedRoomAt(index);\n        const useLinked = linkedRoom && showRoomMapContent;\n\n        if (resizeState) {\n            // Resize logic - keep on active map for now as it's complex\n            const dx = curX - resizeState.startX;\n            const dy = curY - resizeState.startY;\n            let newW = resizeState.startW;\n            let newH = resizeState.startH;\n            let newIndex = resizeState.index;\n\n            if (resizeState.edge === 'right') newW = Math.max(1, resizeState.startW + dx);\n            if (resizeState.edge === 'bottom') newH = Math.max(1, resizeState.startH + dy);\n            \n            if (resizeState.edge === 'left') {\n                const shift = Math.min(resizeState.startW - 1, dx);\n                newW = resizeState.startW - shift;\n                newIndex = resizeState.startY * mapWidth + (resizeState.startX + shift);\n            }\n            if (resizeState.edge === 'top') {\n                const shift = Math.min(resizeState.startH - 1, dy);\n                newH = resizeState.startH - shift;\n                newIndex = (resizeState.startY + shift) * mapWidth + resizeState.startX;\n            }\n\n            if (newW !== (objectMetadata[resizeState.index]?.width || 1) || \n                newH !== (objectMetadata[resizeState.index]?.height || 1) ||\n                newIndex !== resizeState.index) {\n                \n                const meta = { ...objectMetadata[resizeState.index] };\n                meta.width = newW;\n                meta.height = newH;\n                \n                setObjectMetadata(prev => {\n                    const next = { ...prev };\n                    delete next[resizeState.index];\n                    next[newIndex] = meta;\n                    return next;\n                });\n\n                if (newIndex !== resizeState.index) {\n                    const objId = objectMapData[resizeState.index];\n                    const secretId = secretMapData[resizeState.index];\n                    setObjectMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = objId;\n                        return next;\n                    });\n                    setSecretMapData(prev => {\n                        const next = [...prev];\n                        next[resizeState.index] = null;\n                        next[newIndex] = secretId;\n                        return next;\n                    });\n                    setResizeState(prev => ({ ...prev, index: newIndex, startX: newIndex % mapWidth, startY: Math.floor(newIndex / mapWidth), startW: newW, startH: newH }));\n                    setHighlightedIndex(newIndex);\n                }\n            }\n        } else if (moveState) {\n            if (index === moveState.index) return;\n            \n            // Perform move\n            setObjectMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.objId;\n                return next;\n            });\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[moveState.index] = null;\n                next[index] = moveState.secretId;\n                return next;\n            });\n            setObjectMetadata(prev => {\n                const next = { ...prev };\n                delete next[moveState.index];\n                if (moveState.meta) next[index] = moveState.meta;\n                return next;\n            });\n            setMoveState(prev => ({ ...prev, index, startX: curX, startY: curY }));\n            setHighlightedIndex(index);\n\n        } else if (activeTool === 'brush' && isDragging) {\n            const shouldErase = rightEraseRef.current;\n            paintTile(index, shouldErase ? null : undefined);\n        } else if (activeTool === 'bucket') {\n            if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = setTimeout(() => {\n                const targetLayer = activeLayer === 'props' ? 'object' : activeLayer;\n                \n                const mWidth = useLinked ? linkedRoom.map.mapWidth : mapWidth;\n                const mHeight = useLinked ? linkedRoom.map.mapHeight : mapHeight;\n                const mIndex = useLinked ? (linkedRoom.localY * mWidth + linkedRoom.localX) : index;\n                const mData = useLinked ? linkedRoom.map : { tileMapData, objectMapData, secretMapData };\n                \n                const targetData = targetLayer === 'tile' ? mData.tileMapData : (targetLayer === 'object' ? mData.objectMapData : mData.secretMapData);\n                const indices = getFloodFillIndices(mIndex, targetData, mWidth, mHeight);\n                \n                if (useLinked) {\n                    // We need to convert linked room indices back to main map indices for preview?\n                    // Or just skip preview for linked rooms for now to keep it simple.\n                    setBucketPreviewIndices(new Set()); \n                } else {\n                    setBucketPreviewIndices(indices);\n                }\n            }, 10);\n        }\n    }, [setHoverIndex, activeTool, isDragging, paintTile, activeLayer, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight, setBucketPreviewIndices, resizeState, moveState, objectMetadata, setObjectMetadata, setObjectMapData, setSecretMapData, setHighlightedIndex, getLinkedRoomAt, showRoomMapContent]);\n\n    const handleGridMouseUp = useCallback((index) => {\n        if (activeTool === 'area' && isDragging && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n            const baseIndex = y1 * mapWidth + x1;\n\n            setSecretMapData(prev => {\n                const next = [...prev];\n                next[baseIndex] = 'room_area';\n                return next;\n            });\n            setObjectMetadata(prev => ({\n                ...prev,\n                [baseIndex]: { ...prev[baseIndex], width: w, height: h, roomName: 'New Room' }\n            }));\n            setHighlightedIndex(baseIndex);\n            if (setActivePanel) setActivePanel('props');\n            setIsDragging(false);\n            setDragStart(null);\n            return;\n        }\n\n        if (activeTool === 'move' && isDragging && !resizeState && !moveState && dragStart && index !== null) {\n            const hx = index % mapWidth;\n            const hy = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, hx);\n            const y1 = Math.min(dragStart.y, hy);\n            const x2 = Math.max(dragStart.x, hx);\n            const y2 = Math.max(dragStart.y, hy);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const tileData = [];\n            const objectData = [];\n            const secretData = [];\n            const selectionMetadata = {};\n\n            for (let y = y1; y <= y2; y++) {\n                for (let x = x1; x <= x2; x++) {\n                    const idx = y * mapWidth + x;\n                    tileData.push(tileMapData[idx]);\n                    objectData.push(objectMapData[idx]);\n                    secretData.push(secretMapData[idx]);\n                    if (objectMetadata[idx]) {\n                        selectionMetadata[`${x - x1},${y - y1}`] = { ...objectMetadata[idx] };\n                    }\n                }\n            }\n\n            setSelection({\n                x: x1, y: y1, w, h,\n                originalX: x1, originalY: y1,\n                tileData, objectData, secretData,\n                metadata: selectionMetadata\n            });\n            setPreviewPosition({ x: x1, y: y1 });\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData],\n                objectMetadata: { ...objectMetadata }\n            });\n            setDragStart(null);\n        }\n\n        rightEraseRef.current = false;\n        setIsDragging(false);\n        setResizeState(null);\n        setMoveState(null);\n    }, [activeTool, isDragging, resizeState, moveState, dragStart, mapWidth, tileMapData, objectMapData, secretMapData, setSelection, setPreviewPosition, setOriginalMapData, setDragStart, setIsDragging]);\n\n    return {\n        hoverIndex,\n        setHoverIndex,\n        bucketPreviewIndices,\n        setBucketPreviewIndices,\n        handleGridMouseDown,\n        handleGridMouseMove,\n        handleGridMouseUp,\n        handleResizeStart,\n        handleMoveStart,\n        paintTile\n    };\n};\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { resizeMapData } from './editorTools/mapOperations';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './editorTools/NewMapModal';\nimport { BuiltInMapsModal } from './editorTools/BuiltInMapsModal';\nimport { EditorScene } from './EditorScene';\nimport { EditorElements } from './EditorElements';\nimport { EditorTools } from './EditorTools';\nimport PixiStage from '../game/PixiStage';\nimport styled from 'styled-components';\nimport MessageOverlay from '../shared/MessageOverlay';\n\n// Custom Hooks\nimport { useEditorRegistry } from './hooks/useEditorRegistry';\nimport { useEditorSelection } from './hooks/useEditorSelection';\nimport { useEditorPlayMode } from './hooks/useEditorPlayMode';\nimport { useEditorOperations } from './hooks/useEditorOperations';\nimport { useEditorPainting } from './hooks/useEditorPainting';\nimport { useEditorMaps } from './hooks/useEditorMaps';\n\nconst EMPTY_ARRAY = [];\nconst EMPTY_OBJECT = {};\n\nconst GameOverOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    z-index: 2500;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    backdrop-filter: blur(4px);\n    animation: fadeIn 0.5s ease-out;\n\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n`;\n\nconst GameOverTitle = styled.h1`\n    font-size: 72px;\n    margin: 0 0 30px 0;\n    text-transform: uppercase;\n    letter-spacing: 5px;\n    color: #ff4444;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5), 0 5px 15px rgba(0,0,0,0.8);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 900;\n`;\n\nconst ReplayButton = styled.button`\n    padding: 18px 50px;\n    font-size: 28px;\n    background: linear-gradient(180deg, #4CAF50, #2E7D32);\n    color: white;\n    border: 2px solid #fff;\n    border-radius: 50px;\n    cursor: pointer;\n    font-weight: bold;\n    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    outline: none;\n\n    &:hover {\n        background: linear-gradient(180deg, #66BB6A, #388E3C);\n        transform: scale(1.05) translateY(-2px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    }\n\n    &:active {\n        transform: scale(0.98) translateY(0);\n    }\n`;\n\nexport const Editor = () => {\n    const registryItems = useMemo(() => getRegistry() || [], []);\n    const playerVisuals = useMemo(() => registryItems.find(item => item.id === 'player') || EMPTY_OBJECT, [registryItems]);\n\n    // Basic Map State\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [objectMetadata, setObjectMetadata] = useState({});\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n    const [showBackgroundImage, setShowBackgroundImage] = useState(true);\n    const [showMessages, setShowMessages] = useState(() => {\n        try {\n            const v = localStorage.getItem('editor_show_messages');\n            if (v === null) return true;\n            return v !== '0';\n        } catch {\n            return true;\n        }\n    });\n\n    // Tools & Modes State\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [isRoomAreaVisible, setIsRoomAreaVisible] = useState(false);\n    const [showRoomMapContent, setShowRoomMapContent] = useState(false);\n    const [isWorldViewOpen, setIsWorldViewOpen] = useState(false);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata });\n\n    // Metadata State\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [mapDescription, setMapDescription] = useState(\"\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [highlightedIndex, setHighlightedIndex] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [isBuiltInMapsModalOpen, setIsBuiltInMapsModalOpen] = useState(false);\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n    const [tempMapDescription, setTempMapDescription] = useState(\"\");\n    const [activePanel, setActivePanel] = useState(null);\n\n    // Asset Options\n    const backgroundOptions = useMemo(() => loadBackgroundOptions(), []);\n    const musicOptions = useMemo(() => loadMusicOptions(), []);\n\n    // Background State\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#99C1F1');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    // Weather State\n    const [weatherRain, setWeatherRain] = useState(0);\n    const [weatherSnow, setWeatherSnow] = useState(0);\n    const [weatherClouds, setWeatherClouds] = useState(0);\n    const [weatherFog, setWeatherFog] = useState(0);\n    const [weatherThunder, setWeatherThunder] = useState(0);\n    const [weatherLavaRain, setWeatherLavaRain] = useState(0);\n    const [weatherRadioactiveFog, setWeatherRadioactiveFog] = useState(0);\n    const [weatherMeteorRain, setWeatherMeteorRain] = useState(0);\n\n    const [playerPosition, setPlayerPosition] = useState({ x: 100, y: 100 });\n\n    useEffect(() => {\n        try { localStorage.setItem('editor_show_messages', showMessages ? '1' : '0'); } catch {}\n    }, [showMessages]);\n\n    // Multi-map state\n    const { \n        maps, setMaps, activeMapId, setActiveMapId, createMap: createNewMap, updateMapData, deleteMap \n    } = useEditorMaps();\n\n    const lastActiveMapIdRef = useRef(activeMapId);\n\n    const switchMap = useCallback((newMapId, spawnTriggerId = null) => {\n        if (newMapId === activeMapId) return;\n\n        // 1. Save current map data to store\n        updateMapData(activeMapId, {\n            mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n            selectedBackgroundImage, selectedBackgroundColor,\n            backgroundParallaxFactor, selectedBackgroundMusic,\n            weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n            weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n            playerPosition\n        });\n\n        // 2. Load new map data\n        const nextMap = maps[newMapId];\n        if (nextMap) {\n            setMapWidth(nextMap.mapWidth);\n            setMapHeight(nextMap.mapHeight);\n            setTileMapData(nextMap.tileMapData);\n            setObjectMapData(nextMap.objectMapData);\n            setSecretMapData(nextMap.secretMapData);\n            setObjectMetadata(nextMap.objectMetadata || {});\n            setCreatedAt(nextMap.createdAt || new Date().toISOString());\n            setSelectedBackgroundImage(nextMap.selectedBackgroundImage);\n            setSelectedBackgroundColor(nextMap.selectedBackgroundColor);\n            setBackgroundParallaxFactor(nextMap.backgroundParallaxFactor || 0.3);\n            setSelectedBackgroundMusic(nextMap.selectedBackgroundMusic);\n            \n            if (nextMap.weather) {\n                setWeatherRain(nextMap.weather.rain || 0);\n                setWeatherSnow(nextMap.weather.snow || 0);\n                setWeatherClouds(nextMap.weather.clouds || 0);\n                setWeatherFog(nextMap.weather.fog || 0);\n                setWeatherThunder(nextMap.weather.thunder || 0);\n                setWeatherLavaRain(nextMap.weather.lavaRain || 0);\n                setWeatherRadioactiveFog(nextMap.weather.radioactiveFog || 0);\n                setWeatherMeteorRain(nextMap.weather.meteorRain || 0);\n            }\n            \n            if (nextMap.playerPosition) {\n                setPlayerPosition(nextMap.playerPosition);\n            }\n            \n            // If we have a spawnTriggerId, we might want to store it temporarily\n            // so useEditorPlayMode can include it in mapDataForGame.meta\n            // But actually, we can just update the map data in the store with this triggerId.\n            if (spawnTriggerId !== null) {\n                updateMapData(newMapId, { ...nextMap, spawnTriggerId });\n            }\n\n            setActiveMapId(newMapId);\n        }\n    }, [\n        activeMapId, maps, updateMapData, setActiveMapId,\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const handleCreateMap = useCallback((type, name, width, height) => {\n        const finalName = name || prompt(`Enter ${type} map name:`, `New ${type.charAt(0).toUpperCase() + type.slice(1)}`);\n        if (finalName) {\n            const finalWidth = width || mapWidth;\n            const finalHeight = height || mapHeight;\n            const newId = createNewMap(type, finalName, finalWidth, finalHeight);\n            return newId;\n        }\n    }, [createNewMap, mapWidth, mapHeight]);\n\n    // Update store when current map data changes (for minimap preview)\n    useEffect(() => {\n        // Skip update if activeMapId just changed to prevent overwriting new map data with old map state\n        if (lastActiveMapIdRef.current !== activeMapId) {\n            lastActiveMapIdRef.current = activeMapId;\n            return;\n        }\n\n        const timeout = setTimeout(() => {\n            updateMapData(activeMapId, {\n                mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n                selectedBackgroundImage, selectedBackgroundColor,\n                selectedBackgroundMusic, backgroundParallaxFactor,\n                weather: {\n                    rain: weatherRain,\n                    snow: weatherSnow,\n                    clouds: weatherClouds,\n                    fog: weatherFog,\n                    thunder: weatherThunder,\n                    lavaRain: weatherLavaRain,\n                    radioactiveFog: weatherRadioactiveFog,\n                    meteorRain: weatherMeteorRain\n                },\n                playerPosition\n            });\n        }, 1000); // Debounce store updates\n        return () => clearTimeout(timeout);\n    }, [\n        activeMapId, updateMapData, mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, selectedBackgroundMusic, backgroundParallaxFactor,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        playerPosition\n    ]);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    // Use Custom Hooks\n    const { \n        blocks, liquids, entities, decorations, items, interactables, hazards, secrets, miniGames, weather, messages, crackableWalls, pushableWalls, obstacles \n    } = useEditorRegistry(registryItems);\n\n    const { \n        selection, setSelection, selectionMode, setSelectionMode, previewPosition, setPreviewPosition,\n        originalMapData, setOriginalMapData, moveSelection, commitSelection, cancelSelection \n    } = useEditorSelection(mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata);\n\n    const {\n        isPlayMode, handlePlay, handlePause, handleReset, handleReplay, handleStateUpdate, handleForceStop,\n        playModeObjectData, playModeSecretData, playModeWeather, playModeMaps, gameMessage, revealedSecrets, \n        activeRoomIds, gameEngineState, isGameOver\n    } = useEditorPlayMode(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, \n        selectedBackgroundImage, selectedBackgroundColor, backgroundParallaxFactor, \n        registryItems, playerPosition, setPlayerPosition, setObjectMetadata,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        maps, activeMapId, switchMap, maps[activeMapId]?.spawnTriggerId,\n        setTileMapData, updateMapData\n    );\n\n    const {\n        handleSaveMap, handleLoadMap, handleLoadBuiltInMap, handleClearMap, openNewMapModal, confirmNewMap\n    } = useEditorOperations(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata,\n        mapName, creatorName, mapDescription, createdAt, selectedBackgroundImage, selectedBackgroundColor,\n        backgroundParallaxFactor, selectedBackgroundMusic, playerPosition, registryItems, setCreatedAt,\n        setMapWidth, setMapHeight, setMapName, setCreatorName, setMapDescription,\n        setSelectedBackgroundImage, setSelectedBackgroundColor,\n        setBackgroundParallaxFactor, setSelectedBackgroundMusic, setPlayerPosition,\n        setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata,\n        setIsNewMapModalOpen, setTempMapName, setTempCreatorName, setTempMapDescription,\n        weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder,\n        weatherLavaRain, weatherRadioactiveFog, weatherMeteorRain,\n        setWeatherRain, setWeatherSnow, setWeatherClouds, setWeatherFog, setWeatherThunder,\n        setWeatherLavaRain, setWeatherRadioactiveFog, setWeatherMeteorRain,\n        maps, setMaps, activeMapId, setActiveMapId\n    );\n\n    const handleLoadMapWrapped = useCallback((event) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadMap(event);\n    }, [isPlayMode, handleForceStop, handleLoadMap]);\n\n    const handleLoadBuiltInMapWrapped = useCallback((mapData) => {\n        if (isPlayMode) {\n            handleForceStop();\n        }\n        handleLoadBuiltInMap(mapData);\n    }, [isPlayMode, handleForceStop, handleLoadBuiltInMap]);\n\n    const {\n        hoverIndex, setHoverIndex, bucketPreviewIndices, setBucketPreviewIndices,\n        handleGridMouseDown, handleGridMouseMove, handleGridMouseUp,\n        handleResizeStart, handleMoveStart, paintTile\n    } = useEditorPainting(\n        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, \n        setTileMapData, setObjectMapData, setSecretMapData,\n        activeTool, brushSize, activeLayer, selectedTile, selection, \n        setSelection, setPreviewPosition, setOriginalMapData, dragStart, setDragStart, isDragging, setIsDragging,\n        setActivePanel, setHighlightedIndex, highlightedIndex, registryItems,\n        objectMetadata, setObjectMetadata,\n        maps, activeMapId, showRoomMapContent, isRoomAreaVisible, updateMapData\n    );\n\n    // Side Effects\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    useEffect(() => {\n        if (!secretMapData || !objectMapData || secretMapData.length === 0) return;\n        const toMove = [];\n        for (let i = 0; i < secretMapData.length; i++) {\n            const secretId = secretMapData[i];\n            if (secretId && typeof secretId === 'string' && secretId.startsWith('minispill_sea_rescue_box') && !objectMapData[i]) {\n                toMove.push({ index: i, id: secretId === 'minispill_sea_rescue_box' ? 'minispill_sea_rescue_box0' : secretId });\n            }\n        }\n        if (toMove.length === 0) return;\n        setObjectMapData(prev => {\n            const next = [...prev];\n            toMove.forEach(item => {\n                next[item.index] = item.id;\n            });\n            return next;\n        });\n        setSecretMapData(prev => {\n            const next = [...prev];\n            toMove.forEach(item => {\n                next[item.index] = null;\n            });\n            return next;\n        });\n    }, [secretMapData, objectMapData, setObjectMapData, setSecretMapData]);\n\n    const togglePanel = (panel) => {\n        setActivePanel(prev => prev === panel ? null : panel);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n        resizeMapData({\n            newWidth, newHeight, stateRef, setMapWidth, setMapHeight,\n            setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata\n        });\n    };\n\n    const handlePaletteSelect = useCallback((item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    }, []);\n\n    // Grid Event Handlers\n    \n    const handleGridMouseLeave = useCallback(() => {\n        setHoverIndex(null);\n        setBucketPreviewIndices(new Set());\n    }, [setHoverIndex, setBucketPreviewIndices]);\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    const onAddRoomArea = useCallback(() => {\n        setIsWorldViewOpen(false);\n        setActiveTool('area');\n        setActiveLayer('secret');\n    }, []);\n\n    const handleDeleteMap = useCallback((id) => {\n        if (id === activeMapId) {\n            switchMap('main');\n        }\n        deleteMap(id);\n    }, [activeMapId, switchMap, deleteMap]);\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\n            <NewMapModal \n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                tempMapDescription={tempMapDescription}\n                setTempMapDescription={setTempMapDescription}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <BuiltInMapsModal \n                isOpen={isBuiltInMapsModalOpen}\n                onClose={() => setIsBuiltInMapsModalOpen(false)}\n                onSelect={handleLoadBuiltInMapWrapped}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', flex: 1, flexDirection: 'row',\n                filter: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: (isNewMapModalOpen || isBuiltInMapsModalOpen) ? 'none' : 'auto',\n                overflow: 'hidden'\n            }}>\n                <EditorElements \n                    mapName={mapName}\n                    creatorName={creatorName}\n                    mapDescription={mapDescription}\n                    setMapName={setMapName}\n                    setCreatorName={setCreatorName}\n                    setMapDescription={setMapDescription}\n                    openNewMapModal={openNewMapModal}\n                    openBuiltInModal={() => setIsBuiltInMapsModalOpen(true)}\n                    saveMap={handleSaveMap}\n                    loadMap={handleLoadMapWrapped}\n                    clearMap={handleClearMap}\n                    isPlayMode={isPlayMode}\n                    handlePaletteSelect={handlePaletteSelect}\n                    selectedTile={selectedTile}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    decorations={decorations}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    miniGames={miniGames}\n                    weather={weather}\n                    messages={messages}\n                    crackableWalls={crackableWalls}\n                    pushableWalls={pushableWalls}\n                    obstacles={obstacles}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    objectMapData={objectMapData}\n                    secretMapData={secretMapData}\n                    objectMetadata={objectMetadata}\n                    setObjectMetadata={setObjectMetadata}\n                    registryItems={registryItems}\n                    highlightedIndex={highlightedIndex}\n                    setHighlightedIndex={setHighlightedIndex}\n                    activePanel={activePanel}\n                    setActivePanel={setActivePanel}\n                    togglePanel={togglePanel}\n                    maps={maps}\n                    activeMapId={activeMapId}\n                    createMap={handleCreateMap}\n                    mapType={maps[activeMapId]?.type || 'overworld'}\n                    updateMapData={updateMapData}\n                />\n\n                <div style={{ display: 'flex', flex: 1, flexDirection: 'column', overflow: 'hidden' }}>\n                    <EditorTools\n                        mapName={mapName}\n                        creatorName={creatorName}\n                        activePanel={activePanel}\n                        togglePanel={togglePanel}\n                        showGrid={showGrid}\n                        setShowGrid={setShowGrid}\n                        isPlayMode={isPlayMode}\n                        handlePlay={handlePlay}\n                        handlePause={handlePause}\n                        handleReset={handleReset}\n                        activeTool={activeTool}\n                        setActiveTool={setActiveTool}\n                        brushSize={brushSize}\n                        setBrushSize={setBrushSize}\n                        activeLayer={activeLayer}\n                        selection={selection}\n                        moveSelection={moveSelection}\n                        selectionMode={selectionMode}\n                        setSelectionMode={setSelectionMode}\n                        commitSelection={commitSelection}\n                        cancelSelection={cancelSelection}\n                        selectedTile={selectedTile}\n                        handlePaletteSelect={handlePaletteSelect}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        showBackgroundImage={showBackgroundImage}\n                        setShowBackgroundImage={setShowBackgroundImage}\n                        showMessages={showMessages}\n                        setShowMessages={setShowMessages}\n                        isRoomAreaVisible={isRoomAreaVisible}\n                        setIsRoomAreaVisible={setIsRoomAreaVisible}\n                        showRoomMapContent={showRoomMapContent}\n                        setShowRoomMapContent={setShowRoomMapContent}\n                    />\n                    \n                    <div style={{ display: 'flex', flex: 1, flexDirection: 'row', overflow: 'hidden', position: 'relative' }}>\n\n                    <EditorScene \n                        handleMapResize={handleMapResize}\n                        isResizeWindowOpen={isResizeWindowOpen}\n                        setIsResizeWindowOpen={setIsResizeWindowOpen}\n                        isWorldViewOpen={isWorldViewOpen}\n                        setIsWorldViewOpen={setIsWorldViewOpen}\n                        onAddRoomArea={onAddRoomArea}\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        tileMapData={tileMapData}\n                        objectMapData={objectMapData}\n                        objectMetadata={objectMetadata}\n                        registryItems={registryItems}\n                        backgroundOptions={backgroundOptions}\n                        selectedBackgroundImage={selectedBackgroundImage}\n                        setSelectedBackgroundImage={setSelectedBackgroundImage}\n                        selectedBackgroundColor={selectedBackgroundColor}\n                        setSelectedBackgroundColor={setSelectedBackgroundColor}\n                        backgroundParallaxFactor={backgroundParallaxFactor}\n                        setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                        musicOptions={musicOptions}\n                        selectedBackgroundMusic={selectedBackgroundMusic}\n                        setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                        weatherRain={weatherRain}\n                        setWeatherRain={setWeatherRain}\n                        weatherSnow={weatherSnow}\n                        setWeatherSnow={setWeatherSnow}\n                        weatherClouds={weatherClouds}\n                        setWeatherClouds={setWeatherClouds}\n                        weatherFog={weatherFog}\n                        setWeatherFog={setWeatherFog}\n                        weatherThunder={weatherThunder}\n                        setWeatherThunder={setWeatherThunder}\n                        weatherLavaRain={weatherLavaRain}\n                        setWeatherLavaRain={setWeatherLavaRain}\n                        weatherRadioactiveFog={weatherRadioactiveFog}\n                        setWeatherRadioactiveFog={setWeatherRadioactiveFog}\n                        weatherMeteorRain={weatherMeteorRain}\n                        setWeatherMeteorRain={setWeatherMeteorRain}\n                        // Multi-map props\n                        maps={maps}\n                        activeMapId={activeMapId}\n                        switchMap={switchMap}\n                        createMap={handleCreateMap}\n                        deleteMap={handleDeleteMap}\n                        updateMapData={updateMapData}\n                        showRoomMapContent={showRoomMapContent}\n                        activeRoomIds={activeRoomIds}\n                    />\n\n                    {!isPlayMode ? (\n                        <Viewport\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            selectedBackgroundUrl={selectedBackgroundUrl}\n                            selectedBackgroundColor={selectedBackgroundColor}\n                            selectedBackgroundImage={selectedBackgroundImage}\n                            showBackgroundImage={showBackgroundImage}\n                            showGrid={showGrid}\n                            activeLayer={activeLayer}\n                            activeTool={activeTool}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            objectMetadata={objectMetadata}\n                            registryItems={registryItems}\n                            hoverIndex={hoverIndex}\n                            highlightedIndex={highlightedIndex}\n                            brushSize={brushSize}\n                            bucketPreviewIndices={bucketPreviewIndices}\n                            selection={selection}\n                            previewPosition={previewPosition}\n                            dragStart={dragStart}\n                            isDragging={isDragging}\n                            selectedTile={selectedTile}\n                            handleGridMouseDown={handleGridMouseDown}\n                            handleGridMouseEnter={handleGridMouseMove}\n                            handleGridMouseUp={handleGridMouseUp}\n                            handleGridMouseLeave={handleGridMouseLeave}\n                            handleResizeStart={handleResizeStart}\n                            handleMoveStart={handleMoveStart}\n                            setIsDragging={setIsDragging}\n                            weatherRain={weatherRain}\n                            weatherSnow={weatherSnow}\n                            weatherClouds={weatherClouds}\n                            weatherFog={weatherFog}\n                            weatherThunder={weatherThunder}\n                            weatherLavaRain={weatherLavaRain}\n                            weatherRadioactiveFog={weatherRadioactiveFog}\n                            weatherMeteorRain={weatherMeteorRain}\n                            mapType={maps[activeMapId]?.type || 'overworld'}\n                            isRoomAreaVisible={isRoomAreaVisible}\n                            showRoomMapContent={showRoomMapContent}\n                            showMessages={showMessages}\n                            maps={maps}\n                        />\n                    ) : (\n                        <div style={{ flex: 1, position: 'relative', backgroundColor: '#000' }}>\n                            <PixiStage\n                                mapWidth={mapWidth}\n                                mapHeight={mapHeight}\n                                tileSize={TILE_SIZE}\n                                tileMapData={tileMapData}\n                                objectMapData={playModeObjectData}\n                                secretMapData={playModeSecretData}\n                                revealedSecrets={revealedSecrets || []}\n                                registryItems={registryItems}\n                                playerState={gameEngineState}\n                                playerVisuals={playerVisuals}\n                                projectiles={gameEngineState?.projectiles || []}\n                                objectMetadata={objectMetadata}\n                                backgroundImage={showBackgroundImage ? selectedBackgroundImage : null}\n                                backgroundColor={selectedBackgroundColor}\n                                backgroundParallaxFactor={backgroundParallaxFactor}\n                                weatherRain={playModeWeather.rain}\n                                weatherLavaRain={playModeWeather.lavaRain}\n                                weatherSnow={playModeWeather.snow}\n                                weatherMeteorRain={playModeWeather.meteorRain}\n                                weatherClouds={playModeWeather.clouds}\n                                weatherFog={playModeWeather.fog}\n                                weatherRadioactiveFog={playModeWeather.radioactiveFog}\n                                weatherThunder={playModeWeather.thunder}\n                                onWeatherEffectHit={(type, data) => handleStateUpdate('weatherEffectHit', { type, data })}\n                                isEditor={false}\n                                isEditorPlayMode={true}\n                                showGrid={showGrid}\n                            mapType={(playModeMaps?.[activeMapId]?.type || maps[activeMapId]?.type) || 'overworld'}\n                            activeRoomIds={activeRoomIds}\n                            maps={playModeMaps || maps}\n                        />\n                            {isGameOver && (\n                                <GameOverOverlay>\n                                    <GameOverTitle>Game Over</GameOverTitle>\n                                    <ReplayButton onClick={handleReplay}>\n                                        REPLAY \n                                    </ReplayButton>\n                                </GameOverOverlay>\n                            )}\n                            <MessageOverlay text={gameMessage.text} isVisible={gameMessage.isVisible} />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    </div>\n);\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg|webp)$/i);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.(ogg|mp3|wav|m4a)$/i);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import { useState, useCallback } from 'react';\n\nexport const useEditorMaps = () => {\n    const [maps, setMaps] = useState({\n        'main': {\n            id: 'main',\n            name: 'Main',\n            description: '',\n            type: 'overworld',\n            mapWidth: 20,\n            mapHeight: 15,\n            tileMapData: Array(20 * 15).fill(null),\n            objectMapData: Array(20 * 15).fill(null),\n            secretMapData: Array(20 * 15).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: '#99C1F1',\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: { x: 100, y: 100 },\n            worldX: 50,\n            worldY: 50\n        }\n    });\n    const [activeMapId, setActiveMapId] = useState('main');\n\n    const createMap = useCallback((type, name, width = 20, height = 15) => {\n        const id = `map_${Date.now()}`;\n        \n        // Find a good spot for new map\n        const existingMaps = Object.values(maps);\n        const maxY = Math.max(...existingMaps.map(m => m.worldY || 0), 0);\n        \n        const newMap = {\n            id,\n            name: name || (type === 'overworld' ? 'New Overworld' : (type === 'sea_rescue' ? 'Sea Rescue' : 'New Underworld')),\n            description: '',\n            type,\n            mapWidth: width,\n            mapHeight: height,\n            tileMapData: Array(width * height).fill(null),\n            objectMapData: Array(width * height).fill(null),\n            secretMapData: Array(width * height).fill(null),\n            objectMetadata: {},\n            selectedBackgroundImage: null,\n            selectedBackgroundColor: type === 'overworld' ? '#99C1F1' : (type === 'sea_rescue' ? '#99C1F1' : '#1a1a1a'),\n            backgroundParallaxFactor: 0.3,\n            selectedBackgroundMusic: null,\n            weather: {\n                rain: 0,\n                snow: 0,\n                clouds: 0,\n                fog: 0,\n                thunder: 0,\n                lavaRain: 0,\n                radioactiveFog: 0,\n                meteorRain: 0\n            },\n            playerPosition: null, // Only one map should have player eventually\n            worldX: 50,\n            worldY: maxY + 150\n        };\n\n        setMaps(prev => ({\n            ...prev,\n            [id]: newMap\n        }));\n        return id;\n    }, []);\n\n    const updateMapData = useCallback((id, data) => {\n        setMaps(prev => ({\n            ...prev,\n            [id]: {\n                ...prev[id],\n                ...data\n            }\n        }));\n    }, []);\n\n    const deleteMap = useCallback((id) => {\n        if (id === 'main') return; // Cannot delete main map\n        setMaps(prev => {\n            const newMaps = { ...prev };\n            delete newMaps[id];\n            return newMaps;\n        });\n        if (activeMapId === id) {\n            setActiveMapId('main');\n        }\n    }, [activeMapId]);\n\n    return {\n        maps,\n        setMaps,\n        activeMapId,\n        setActiveMapId,\n        createMap,\n        updateMapData,\n        deleteMap\n    };\n};\n","import { useMemo } from 'react';\n\nexport const useEditorRegistry = (registryItems) => {\n    const blocks = useMemo(() => \n        registryItems.filter(item => {\n            if (!item.name || !item.name.startsWith('block.')) return false;\n            if (item.flags && item.flags.liquid) return false;\n            if (item.editor && item.editor.panel && item.editor.panel !== 'blocks') return false;\n            return true;\n        }), \n    [registryItems]);\n\n    const liquids = useMemo(() => \n        registryItems.filter(item => item.flags && item.flags.liquid), \n    [registryItems]);\n\n    const entities = useMemo(() => {\n        const baseEntities = registryItems.filter(item => {\n            if (!item.name || !item.name.toLowerCase().includes('entities.')) return false;\n            if (item.isHiddenInEditor) return false;\n            return !item.type || item.type === 'default' || item.type === 'entity' || item.subtype === 'tank';\n        });\n\n        const itemsToMove = registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            item.id !== 'hertz_item' && \n            item.id !== 'fireball_ammo'\n        );\n\n        return [...baseEntities, ...itemsToMove];\n    }, [registryItems]);\n\n    const decorations = useMemo(() => \n        registryItems.filter(item => {\n            if (item.type === 'decoration') return true;\n            if (item.name && item.name.toLowerCase().includes('decoration.')) return true;\n            if (item.id && item.id.includes('stone_pack')) return true;\n            return false;\n        }), \n    [registryItems]);\n\n    const items = useMemo(() => \n        registryItems.filter(item => \n            item.name && \n            item.name.startsWith('item.') && \n            (item.id === 'hertz_item' || item.id === 'fireball_ammo')\n        ), \n    [registryItems]);\n\n    const interactables = useMemo(() => \n        registryItems.filter(item => {\n            if (item.editor && item.editor.panel) return item.editor.panel === 'interactables';\n            return item.type === 'interactable' || (item.name && item.name.startsWith('interactable.'));\n        }), \n    [registryItems]);\n\n    const hazards = useMemo(() => \n        registryItems.filter(item => item.type === 'hazard' || (item.name && item.name.startsWith('hazard.'))), \n    [registryItems]);\n\n    const secrets = useMemo(() => \n        registryItems.filter(item => item.type === 'secret' && item.editor?.panel !== 'minigames'), \n    [registryItems]);\n\n    const miniGames = useMemo(() =>\n        registryItems.filter(item => item.editor?.panel === 'minigames'),\n    [registryItems]);\n\n    const weather = useMemo(() => \n        registryItems.filter(item => item.type === 'weather_trigger'), \n    [registryItems]);\n\n    const messages = useMemo(() => \n        registryItems.filter(item => item.type === 'message_trigger'), \n    [registryItems]);\n\n    const crackableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'crack_block'),\n    [registryItems]);\n\n    const pushableWalls = useMemo(() => \n        registryItems.filter(item => item.type === 'wolf_secret'),\n    [registryItems]);\n\n    const obstacles = useMemo(() => \n        registryItems.filter(item => item.type === 'obstacle' || (item.name && item.name.startsWith('obstacle.'))), \n    [registryItems]);\n\n    return {\n        blocks,\n        liquids,\n        entities,\n        decorations,\n        items,\n        interactables,\n        hazards,\n        secrets,\n        miniGames,\n        weather,\n        messages,\n        crackableWalls,\n        pushableWalls,\n        obstacles\n    };\n};\n","import { useState, useEffect, useCallback } from 'react';\n\nexport const useEditorSelection = (mapWidth, mapHeight, tileMapData, objectMapData, secretMapData, objectMetadata, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata) => {\n    const [selection, setSelection] = useState(null);\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n\n    const moveSelection = useCallback((dx, dy) => {\n        if (!selection || !previewPosition) return;\n        setPreviewPosition({ \n            x: previewPosition.x + dx, \n            y: previewPosition.y + dy \n        });\n    }, [selection, previewPosition]);\n\n    const cancelSelection = useCallback(() => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, []);\n\n    const commitSelection = useCallback(() => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n        const newObjectMetadata = { ...originalMapData.objectMetadata };\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                        delete newObjectMetadata[idx];\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                    \n                    if (selection.metadata && selection.metadata[`${px},${py}`]) {\n                        newObjectMetadata[destIdx] = { ...selection.metadata[`${px},${py}`] };\n                    }\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setObjectMetadata(newObjectMetadata);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    }, [selection, previewPosition, originalMapData, selectionMode, mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData, setObjectMetadata]);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode, commitSelection, cancelSelection]);\n\n    return {\n        selection,\n        setSelection,\n        selectionMode,\n        setSelectionMode,\n        previewPosition,\n        setPreviewPosition,\n        originalMapData,\n        setOriginalMapData,\n        moveSelection,\n        commitSelection,\n        cancelSelection\n    };\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/Editor\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./background/calm-shoreline-waves-baltic-sea-427923.ogg\": 4662,\n\t\"./sfx/dammage/hit-flesh-03-266308.ogg\": 7808,\n\t\"./sfx/mini_spill/ship-engine-32705.ogg\": 8795,\n\t\"./sfx/mini_spill/ship-horn-352063.ogg\": 4682,\n\t\"./sfx/stones/rolling-24b-100544.ogg\": 1835,\n\t\"./sfx/target/seagulls-3-34057.ogg\": 8583,\n\t\"./sfx/water/259626__stevious42__public-waterfall.ogg\": 6787,\n\t\"./sfx/water/in_fish-splashing-release-1-96870.ogg\": 3700,\n\t\"./sfx/water/out_splash-4-46870.ogg\": 5923,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973,\n\t\"./weather/370285__ztitchez__rain-gutter-sink-roof.ogg\": 8693,\n\t\"./weather/torden-og-lynild-1.ogg\": 5274,\n\t\"./weather/torden-og-lynild-2.ogg\": 9369,\n\t\"./weather/torden-og-lynild-3.ogg\": 1788,\n\t\"./weather/torden-og-lynild-4.ogg\": 7835\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/brick_block_0001.json\": 544,\n\t\"./blocks/desert_block_0001.json\": 6918,\n\t\"./blocks/desert_block_0002.json\": 8359,\n\t\"./blocks/desert_block_0003.json\": 324,\n\t\"./blocks/desert_block_0004.json\": 2149,\n\t\"./blocks/desert_block_0005.json\": 5418,\n\t\"./blocks/desert_block_0006.json\": 5531,\n\t\"./blocks/desert_block_0007.json\": 4136,\n\t\"./blocks/desert_block_0008.json\": 329,\n\t\"./blocks/desert_block_0009.json\": 9518,\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/dirt_block_0002.json\": 5655,\n\t\"./blocks/dirt_block_0003.json\": 4932,\n\t\"./blocks/dirt_block_0004.json\": 5653,\n\t\"./blocks/dirt_block_0005.json\": 8970,\n\t\"./blocks/dirt_block_0006.json\": 2251,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/hazard/death_block_0001.json\": 698,\n\t\"./blocks/liquids/lava_block.json\": 9649,\n\t\"./blocks/liquids/lava_waterfall_block.json\": 9104,\n\t\"./blocks/liquids/quicksand_block.json\": 1924,\n\t\"./blocks/liquids/radioactive_water_block.json\": 1408,\n\t\"./blocks/liquids/radioactive_waterfall_block.json\": 8317,\n\t\"./blocks/liquids/water_block.json\": 8606,\n\t\"./blocks/liquids/waterfall_block.json\": 119,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./decorations/stone_pack_01_001.json\": 5247,\n\t\"./decorations/stone_pack_01_002.json\": 5134,\n\t\"./decorations/stone_pack_01_003.json\": 9593,\n\t\"./decorations/stone_pack_01_004.json\": 9840,\n\t\"./decorations/stone_pack_01_005.json\": 2867,\n\t\"./decorations/stone_pack_01_006.json\": 7618,\n\t\"./decorations/stone_pack_01_007.json\": 9069,\n\t\"./decorations/stone_pack_01_008.json\": 9588,\n\t\"./decorations/stone_pack_01_009.json\": 3975,\n\t\"./decorations/trees/01_umbrella_acacia.json\": 5669,\n\t\"./entities/animals/fish_01.json\": 2174,\n\t\"./entities/animals/fish_catfish.json\": 6865,\n\t\"./entities/animals/fish_clownfish.json\": 2204,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./entities/tank_0000.json\": 9381,\n\t\"./entities/tank_0001.json\": 8938,\n\t\"./entities/tank_0002.json\": 9179,\n\t\"./interactables/arrows/arrow_down.json\": 3741,\n\t\"./interactables/arrows/arrow_left.json\": 4636,\n\t\"./interactables/arrows/arrow_right.json\": 9821,\n\t\"./interactables/arrows/arrow_up.json\": 7852,\n\t\"./interactables/blocks/ice_block_0001.json\": 5742,\n\t\"./interactables/doors/door_0001.json\": 6332,\n\t\"./interactables/ends/end_0001.json\": 9318,\n\t\"./interactables/harvestables/berry_bush_01.json\": 7562,\n\t\"./interactables/harvestables/berry_bush_01_used.json\": 3614,\n\t\"./interactables/ledders/ledder_0001.json\": 8668,\n\t\"./interactables/ledders/ledder_0002.json\": 3097,\n\t\"./interactables/physics/stone_0001.json\": 9095,\n\t\"./interactables/physics/wooden_box_0001.json\": 1116,\n\t\"./interactables/platforms/platform_0001.json\": 2008,\n\t\"./interactables/portals/portal_001.json\": 2190,\n\t\"./interactables/portals/portal_target.json\": 5206,\n\t\"./items/ammunition/fireball_ammo.json\": 7289,\n\t\"./items/health/hertz_item.json\": 3321,\n\t\"./messages/message_i18n_0001.json\": 5217,\n\t\"./messages/sign_0001.json\": 7046,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box0.json\": 8440,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box1.json\": 4139,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box2.json\": 6426,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_box3.json\": 9653,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_seagull.json\": 7734,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_ship.json\": 1729,\n\t\"./mini_spill/sea_rescue/minispill_sea_rescue_trigger.json\": 3709,\n\t\"./mini_spill/sea_rescue/sea_rescue_settings.json\": 9378,\n\t\"./obstacles/hazards/bushes_001.json\": 6447,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/crack_block.json\": 6854,\n\t\"./secrets/fish_trigger.json\": 2475,\n\t\"./secrets/message_trigger.json\": 3746,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/room_area.json\": 4547,\n\t\"./secrets/secret_area_a.json\": 1866,\n\t\"./secrets/secret_area_b.json\": 3227,\n\t\"./secrets/secret_area_c.json\": 3880,\n\t\"./secrets/wolf_secret_down.json\": 7716,\n\t\"./secrets/wolf_secret_left.json\": 7157,\n\t\"./secrets/wolf_secret_right.json\": 9950,\n\t\"./secrets/wolf_secret_up.json\": 8577,\n\t\"./system/biological_break_effects.json\": 2346,\n\t\"./system/floating_text.json\": 7794,\n\t\"./system/meteor_break_effects.json\": 6643,\n\t\"./system/object_break_effects.json\": 3764,\n\t\"./system/weather_damage.json\": 6234,\n\t\"./weather/weather_clouds_off.json\": 8264,\n\t\"./weather/weather_clouds_on.json\": 9138,\n\t\"./weather/weather_clouds_value.json\": 6592,\n\t\"./weather/weather_fog_off.json\": 4870,\n\t\"./weather/weather_fog_on.json\": 9560,\n\t\"./weather/weather_fog_value.json\": 1374,\n\t\"./weather/weather_lava_rain_off.json\": 4159,\n\t\"./weather/weather_lava_rain_on.json\": 7795,\n\t\"./weather/weather_meteor_rain_off.json\": 8421,\n\t\"./weather/weather_meteor_rain_on.json\": 2097,\n\t\"./weather/weather_radioactive_fog_off.json\": 8304,\n\t\"./weather/weather_radioactive_fog_on.json\": 6298,\n\t\"./weather/weather_rain_off.json\": 8312,\n\t\"./weather/weather_rain_on.json\": 914,\n\t\"./weather/weather_rain_value.json\": 7664,\n\t\"./weather/weather_snow_off.json\": 8445,\n\t\"./weather/weather_snow_on.json\": 969,\n\t\"./weather/weather_snow_value.json\": 5409,\n\t\"./weather/weather_thunder_off.json\": 628,\n\t\"./weather/weather_thunder_on.json\": 1006,\n\t\"./weather/weather_thunder_value.json\": 6756\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./calm-shoreline-waves-baltic-sea-427923.ogg\": 4662\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8815;"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","activeMapData","tileMapData","objectMapData","secretMapData","objectMetadata","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","projectMaps","isLoading","error","isPaused","isGameOver","activeRoomIds","seaRescuePoints","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","migrateBoxes","data","Array","isArray","i","length","maps","values","forEach","m","mapObjectData","layers","find","l","type","meta","updateObjectMap","updateObjectMetadata","index","metadata","mapId","activeId","activeMapId","activeMap","targetId","removeObjectAtIndex","undefined","room","layerData","removeTileAtIndex","moveTileInMap","fromIndex","toIndex","len","moveObjectInMap","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","idx","includes","push","toggleRoom","roomId","filter","clearRooms","setLoading","setError","setPaused","setGameOver","addSeaRescuePoints","captureSeaRescueBox","triggerIndex","boxId","col","targetIndex","y","capturedBoxId","finalIndex","resetGame","actions","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","ui","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","lv_navigation_home","no_navigation","no_navigation_home","en_navigation","en_navigation_home","ru_navigation","ru_navigation_home","ja_navigation","ja_navigation_home","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","tutorial","lv_tutorial_messages","lv_game_map_selector","editor_elements","lv_editor_elements","editor_scene","lv_editor_scene","editor_tools","lv_editor_tools","no","no_tutorial_messages","no_game_map_selector","no_editor_elements","no_editor_scene","no_editor_tools","en","en_tutorial_messages","en_game_map_selector","en_editor_elements","en_editor_scene","en_editor_tools","ru","ru_tutorial_messages","ru_game_map_selector","ru_editor_elements","ru_editor_scene","ru_editor_tools","ja","ja_tutorial_messages","ja_game_map_selector","ja_editor_elements","ja_editor_scene","ja_editor_tools","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","SettingsButton","props","$soundOff","DropdownContainer","div","DropdownMenu","MenuItem","ToggleSwitch","$active","SectionHeaderNavigationLanguages","dropdownRef","useRef","isMenuOpen","setIsMenuOpen","useState","soundEnabled","setSoundEnabled","v","localStorage","getItem","currentLang","language","handleLanguageChange","newLang","changeLanguage","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","ref","title","toggleSound","next","setItem","CustomEvent","detail","enabled","height","backgroundColor","margin","padding","color","StyledLogo","p","SectionHeaderNavigationLogo","tag","trim","toLowerCase","StyledSectionHeaderNavigation","StyledSectionContent","_registry","_registryMap","initRegistry","console","time","jsonContext","require","imageContext","soundContext","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","resolveSoundsMap","sounds","k","entries","key","item","resolvedTexture","texture","resolvedTextures","textures","path","sfx","sfxResolved","defaultAnimation","animItem","r","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","Map","set","__byId","log","timeEnd","getRegistry","findItemById","get","items","flexDirection","justifyContent","alignItems","width","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","apiUrl","env","REACT_APP_API_URL","logo","URL_LOGO_01","URL_LOGO_02","URL_LOGO_03","URL_LOGO_04","URL_LOGO_05","HomeContainer","Home","LOGO_01","config","LOGO_02","LOGO_03","LOGO_04","LOGO_05","src","alt","TextureCache","constructor","this","_map","url","has","tex","Texture","from","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","maxParticles","resize","area","Math","max","floor","setIntensity","min","Number","spawnOne","g","Graphics","rect","fill","alpha","viewport","getViewport","x","random","speed","vx","vy","rotation","addChild","bounces","alive","update","dtMs","targetIntensity","abs","lerpFactor","exp","norm","scaled","pow","deficit","maxPerFrame","smooth","ceil","toSpawn","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","strength","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","vY","vH","j","splice","WeatherSnow","flakes","seeded","maxFlakes","options","circle","minY","maxY","drift","settled","life","phase","restMs","viewportH","viewportY","seedCount","f","sin","sYwater","sYlava","gAcc","WeatherClouds","bandHeight","patches","windDirection","filters","BlurFilter","quality","rebuild","isInitial","w","h","vX","vW","range","rx","ry","circles","baseR","PI","dist","cx","cos","cy","targetAlpha","currentAlpha","dying","targetCount","W","bandTop","bandBottom","activePatches","_spawnTimer","toKill","osc","leftBound","rightBound","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","nv","_applyAlphas","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","soundCounter","soundStride","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","moveTo","lineTo","stroke","alignment","cap","join","branchCount","ang","bx","by","_maybeEmitSound","stride","onThunderStrike","worldX","maxH","isSolid","WeatherLavaRain","waterY","WeatherRadioactiveFog","WeatherMeteorRain","size","isLarge","atan2","waterTouched","playerState","getPlayerState","hitEntity","px","py","pr","dx","dy","entities","ent","ex","ey","er","edx","edy","onMeteorHit","surfaceType","liquidType","getLiquidTypeAt","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","count","spd","d","BubbleFX","bubbles","maxBubbles","rise","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","cur","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","bgContainer","_regions","_waterTex","_lavaTex","_quicksandTex","_waterfallTex","_lavaWaterfallTex","_radioactiveWaterTex","_radioactiveWaterfallTex","_time","_noiseTex","_lavaDetailTex","_waterDetailTex","_quicksandDetailTex","_playerState","setPlayerState","_checkPlayerInRegion","region","pw","ph","pt","tileIndicesSet","getSurfaceY","X","topEdges","bgNode","_gradTextures","mw","mh","ts","changed","waterDrift","lavaDrift","quicksandDrift","waterfallDrift","lavaWaterfallDrift","radioactiveWaterDrift","radioactiveWaterfallDrift","sprite","alphaDiff","splashG","bottomEdges","F","splashHeight","splashColor","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","ampNow","amp","capG","centerX","sigma","gauss","maxDisp","build","typeAt","liquid","lava_waterfall","radioactive_waterfall","waterfall","radioactive_water","quicksand","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","Set","bleed","_createLavaTexture","_createQuicksandTexture","_createWaterfallTexture","_createLavaWaterfallTexture","_createRadioactiveWaterfallTexture","_createRadioactiveWaterTexture","_createWaterTexture","source","addressMode","tiling","detailTex1","detailTex2","_createLavaDetailTexture","_createQuicksandDetailTexture","_createWaterDetailTexture","bgMask","bottomColor","_createGradientTexture","bgSprite","Sprite","_computeTopEdgeSpans","_computeBottomEdgeSpans","topColor","createLinearGradient","addColorStop","fillStyle","fillRect","globalAlpha","beginPath","arc","sw","sh","tilesByRow","above","rowList","cols","sort","start","prev","below","addWave","HealthBar","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","visible","c","pct","_redrawFill","roundRect","innerW","freeze","parallax","tiles","tilesAnim","liquidBackground","objBehind","secretsBelow","player","liquids","liquidFx","projectiles","objFront","secretsAbove","weather","fog","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","isWaterfallDef","isLavaWaterfallDef","isRadioactiveWaterDef","isRadioactiveWaterfallDef","ParallaxBackground","textureCache","cache","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","minWidth","minHeight","hex","parseInt","slice","solid","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","spriteSheet","frameIndex","totalSprites","columns","rows","frameWidth","frameHeight","row","Rectangle","frame","editorIcon","Text","dropShadow","dropShadowColor","dropShadowBlur","dropShadowDistance","anchor","createPlayerContainer","playerVisuals","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","hit","renderMapContent","refs","secretOverlays","targetBg","targetObjBehind","targetObjFront","isEditor","isEditorPlayMode","mapType","secretLayerRef","activeRoomIndices","roomWindowIndices","idxStr","linkedMapId","roomMap","rw","rh","rMapW","worldIdx","localIdx","roomTiles","roomObjs","add","bgColorStr","bgColorHex","substring","roomBg","objId","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","filterColor","filterColorInGame","renderAbove","renderAbovePlayer","renderOnSecretLayer","backingSprite","backing","isPushable","maxHealth","health","visualElement","healthPercent","currentFrame","interaction","inside","renderOffsetX","render","renderOffsetY","overlapX","overlapY","tileW","tileH","objWidth","objHeight","isLargeDecoration","anchorOffsetX","anchorOffsetY","isRoomContent","isSeaRescueShipPart","baseX","baseY","isSeaRescueBox","boxWidth","boxHeight","isWeatherTrigger","isMessageTrigger","isWolfSecret","shouldShowAnyway","isHiddenInGame","boxDef","boxSprite","bBaseTexture","bSource","bCols","bTotal","bFrameIndex","bFrameWidth","bFrameHeight","bCol","bRow","bRect","isDestructible","hb","renderSecretOverlays","overlays","drawOverlay","split","match","parseFloat","createBreakEffectLayer","layer","sortableChildren","createBreakEffectManager","lifeMs","gravity","shape","angleRange","chunks","angle","sp","maxLife","chunkCount","chunkSpeed","chunkLife","chunkSize","chunkGravity","chunkShape","chunkAngle","chunkColors","delta","getLiquidAtPixel","wx","wy","mapWidthTiles","mapHeightTiles","TILE_SIZE","tileData","getDefById","overlayColorRaw","overlayColor","tintBelowSurface","overlayAlphaRaw","overlayAlpha","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","oxygen","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","headY","chestY","feet","chest","head","candidate","inLiquid","headUnder","atSurface","defaultOverlay","rawOverlayColor","rawOverlayAlpha","tickLiquidDamage","deltaMs","accRef","gameState","HIT_FLASH_MS","hitTimerMs","setPreferences","skipCacheIdWarning","preferCreateImageBitmap","EMPTY_ARRAY","EMPTY_OBJECT","LIQUID_SURFACE_MAP","PixiStage","backgroundImage","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherLavaRain","weatherRadioactiveFog","weatherMeteorRain","healthBarEnabled","weatherFog","weatherThunder","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","showGrid","renderLayers","pointerEvents","onWeatherEffectHit","roomBlurEnabled","debugOverlayEnabled","engineInput","engineRefs","isPixiReady","setIsPixiReady","mountRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","cameraPosRef","bgRef","bgAnimRef","bgImageRef","bgColorRef","objBehindRef","objFrontRef","roomBgRef","roomObjBehindRef","roomObjFrontRef","playerRef","playerLayerRef","playerSpriteRefs","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidBgLayerRef","trajectoryLayerRef","liquidSystemRef","engineInputRef","engineRefsRef","mapTypeRef","mapDataRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","lavaRain","radioactiveFog","meteorRain","weatherPropsRef","tileMapDataRef","registryItemsRef","projectilesLayerRef","projectileSpritesRef","entitiesLayerRef","entitySpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","driftSettingsRef","amplitude","overlayLayerRef","underwaterRef","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","bubbleFxRef","fishBubbleStateRef","entityWaterStateRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","inWater","gridRef","showGridRef","roomBlurEnabledRef","blurFilterRef","darkenFilterRef","ColorMatrixFilter","roomBrightnessFilterRef","vignetteRef","floatingLayerRef","debugLayerRef","debugEnabledRef","floatingManagerRef","breakFxLayerRef","breakFxManagerRef","fetch","json","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","createSolidChecker","collision","top","bottom","left","right","rebuildParallax","useCallback","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","screen","destroyed","async","app","Application","resizeTo","backgroundAlpha","antialias","autoDensity","stage","eventMode","hitArea","renderer","bg","bgAnim","roomObjBehind","roomObjFront","secretBelowLayer","secretAboveLayer","playerLayer","entitiesLayer","weatherLayer","liquidBgLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","vignetteLayer","overlayLayer","floatingLayer","breakFxLayer","LAYERS","cfg","floatConfig","defaultCfg","critCfg","crit","ttlMs","amount","amountValue","critThreshold","threshold","isCrit","baseColor","String","finalColor","finalFontSize","finalTtl","riseSpeed","jitterY","finalText","prefix","suffix","label","fontFamily","strokeThickness","jitterXValue","jitterYValue","position","ttl","total","createFloatingTextManager","gridGraphics","trajectoryGraphics","debugGraphics","allLayersMap","objects","layerName","urlSet","addUrl","urls","playerComponents","innerHTML","appendChild","hbOverlay","oxyColors","oxyBar","lavaColors","lvBar","preventDefault","fx","triggerSplash","triggerBubbles","ticker","updatePlayerSprite","inLava","effectiveWidth","isHit","dir","direction","mag","scale","isSeaRescue","shipWorldX","shipWorldY","camX","shipWorldWidth","camY","shipWorldHeight","lastCam","rawX","rawY","smoothing","nextRawX","nextRawY","cameraRef","mouseData","events","pointer","global","worldMouse","toLocal","mouseWorldPos","pivot","__PLAYER_POS__","lastTime","driftY","graphics","sr","seaRescueRef","draggedBox","startX","startY","currentStartY","mousePos","input","cameraY","worldMouseX","worldMouseY","helpers","settings","physics","G","POWER","power","MAX_DRAG","maxDrag","STEPS","trajectorySteps","DT","sqrt","ratio","beginFill","mapWidthPx","mapHeightPx","drawCircle","endFill","drawSeaRescueTrajectory","updateSeaRescueVisuals","shipOffset","child","lastBubbleTime","intervalMs","deltaMS","systems","swNow","shNow","sNow","overlayL","headUnderWater","overlayCfg","liquidOverlay","showOverlay","maxTargetAlpha","pulseBase","fadeSpeed","lastLiquidType","fadeOutSpeed","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","hbO","show","nextBarY","maxOxy","maxOxygen","curOxy","maxLv","maxLavaResist","curLv","lavaResist","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","anim","mainVisual","floating","splitContainer","topPart","bottomPart","topMask","bottomMask","pWidth","pHeight","maskW","maskH","isNaN","mx","my","syncEntities","entitySpritesMap","entitiesList","_lastFrameIndex","isTextureReady","currentSpriteIndex","texWidth","texHeight","effectiveColumns","targetWidth","targetHeight","flipY","absScaleX","absScaleY","ents","regs","liq","isFish","ai","fish","isAlive","isDormant","interval","bubbleIntervalMs","jitter","bubbleJitter","appToDestroy","cleanupProjectiles","cleanupEntities","handler","isInsideRoom","targetBlur","roomBrightness","reset","desaturate","brightness","grad","createRadialGradient","_vignetteSprite","tileCount","tileId","isLiquid","isRadio","radioactive","hasCollision","active","rebuildLayers","safeDestroy","removeChildren","roomAreaIndex","ox","oy","roomSecrets","roomOptions","selectedBackgroundColor","pLayer","tileDataString","JSON","stringify","prevTileDataString","_lastTileData","prepare","upload","runRebuild","tmd","entry","toSurfaceType","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","getFogIntensity","getLavaRainIntensity","getRadioactiveFogIntensity","getMeteorRainIntensity","propTypes","PropTypes","isRequired","resolveInteractableContext","objectLayerData","mainObjectMetadata","activeRoomIdsProp","centerY","hasMainMetadata","activeTargetMap","activeObjectData","activeMetadata","activeMapWidth","activeMapHeight","currentMapId","mainMetadata","findSpawnPosition","triggerId","mapW","objLayer","objData","spawnIdx","triggerRequested","findIndex","handleDoorInteraction","objDef","currentMeta","actualIndex","onStateUpdate","playShotSfx","lastETime","sound","sfxVolume","opening","delayS","delaySeconds","targetMapId","setTimeout","targetMap","isRoom","isExitingRoom","newX","newY","exitTriggerId","spawnTriggerId","roomAreaMeta","roomAreaEntry","raIdx","spawn","spawnFound","fallback","findExitDoorSpawn","targetRoomId","roomMeta","resolveMapObjects","matchIds","candidateIdx","matchedIdx","some","doorIdx","handleTeleportInteraction","vol","destId","destMeta","tx","ty","applyInteractableEffects","MAX_HEALTH","effect","interactableKey","usedInteractables","healthBonus","fireball","ammoBonus","ammo","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","revealedSet","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","MESSAGES","enMessages","lvMessages","noMessages","ruMessages","jaMessages","getLang","lang","raw","getTutorialChapters","getTutorialItems","chapter","chapterData","getTutorialText","handleWeatherTrigger","weatherType","weatherAction","value","lastWeatherTrigger","handleMessageTrigger","requiresActionKey","requiresKey","i18nChapter","i18nId","message","lastMessageTrigger","duration","triggerWolfSecret","playerCenterX","playerCenterY","objCenterX","objCenterY","playerGridX","playerGridY","objGridX","objGridY","moveX","moveY","eps","applyWolfSecretShift","getObjectId","getObjectDef","moveTile","moveObject","moveMetadata","removeObject","stepDelayMs","setTimeoutFn","shouldCancel","currentIdx","remainingDx","remainingDy","originId","moveStep","currentId","stepX","stepY","targetObjId","extraX","extraY","shouldRemoveCrackBlock","newHealth","passableHealthThreshold","checkInteractables","localX","localY","gridX","gridY","upIndex","upObjId","upDef","downIndex","downObjId","downDef","frontX","frontIndex","frontObjId","frontDef","foundIndex","fromMap","fromMeta","isWinning","winCounter","winCountSpeed","normalizeColor","scaleFromRange","readNumber","getMeteorBreakEffectConfig","meteorBreakEffectsConfig","defaults","sizeScale","minSize","maxSize","denom","particleSize","ground","colorsRaw","getBiologicalBreakEffectConfig","biologicalBreakEffectsConfig","beepFallback","muffled","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","lastNode","createBiquadFilter","frequency","setValueAtTime","connect","exponentialRampToValueAtTime","destination","stop","moveHorizontal","MOVE_SPEED","checkCollision","friction","acceleration","timeScale","targetVx","sign","proposedX","step","safeX","moveDist","nextX","applyVerticalPhysics","isGrounded","animation","GRAVITY","TERMINAL_VELOCITY","JUMP_FORCE","isLiquidAt","prevInWater","liqBuoyancy","liqDragY","liqTerminal","swimImpulseMult","activeLiquidType","feetLiq","chestLiq","space","swimImpulse","proposedY","isSolidAtPixel","secretData","objectData","ignoreEntityId","insideAnyRoom","localWx","localWy","roomTileW","roomTileH","roomObjects","closed","isExploding","isEntity","tileDef","getSurfaceProperties","feetY","slipperiness","getWeatherConfig","weatherDamageConfig","getMapWeather","metaWeather","runtime","rt","__GAME_RUNTIME_SETTINGS__","merged","getWeatherDps","clampIntensity","maxDps","minDps","weatherAffectsPlayer","affects","weatherAffectsEnemy","enemyId","enemyName","enemies","mode","excluded","exclude","isExcluded","weatherBlockedByCover","blockedByCover","isCoveredFromAbove","isInsideActiveRoom","getTileLayerData","getSecretLayerData","liquidTypeToHabitat","isFishEntity","getFishTriggerAt","objectId","triggerType","getWaterSurfaceY","updateEntities","entitiesRef","getLiquidSample","spawnProjectile","playSfx","constants","playerX","playerY","weatherNow","lavaRainInt","radioFogInt","entity","animFrame","animTimer","totalFrames","animations","explode","frameDuration","shouldRemove","liquidSample","projectilesRef","activeRadiusPx","activeRadius","attachedToProjectileId","fishState","isAttached","anims","currentAnim","isJumping","jumpVx","jumpVy","jumpGravity","dxView","dyView","idleAnim","idle","liquidDamageAcc","dmg","lavaDps","radioDps","totalWeatherDps","weatherDamageAcc","habitat","timeMs","habitatKey","isAllowed","requireLiquid","inWaterNow","fs","initialized","nextTurnAt","turnMinMs","turnMaxMs","nextVerticalAt","verticalDir","water_out","water_in","fishCount","removeOnNext","solidAtSample","canFloat","surfaceY","surfaceOffset","deathSurfaceOffset","floatSpeed","deathFloatSpeed","deadAnim","dead","meteorShockFrame","panicRadiusPx","panicRadius","panicSpeed","baseSpeed","swimSpeed","verticalDrift","isWaterfall","waterfallDriftMultiplier","waterfallSpeedMultiplier","triggerDef","mergedJumpCfg","fishTrigger","jump","nowMs","nextJumpAt","chance","jumpDir","speedX","speedY","jumpBounce","bounce","cooldownMs","dtSec","nextY","landingSample","shockUntil","shockFrame","lastWaterEnter","playerWaveRadius","waveImpulse","playerWaveImpulse","waveUntil","panicUntil","panicDurationMs","shipDef","fishReactionRadius","shipX","shipW","shipBottomY","enginePanicRadius","isPanicking","downSpeed","waterfallDownSpeed","waterfallAlpha","impulse","sampleNext","nextType","other","ocx","ocy","nudge","tryX","tryY","animKey","panic","swim","frameDur","prevInLiquid","water_splash","lava_splash","ew","eh","sinkingSpeed","fallDistance","vp","kill_enemy","isRound","checkEmpty","leftX","rightX","roll","lastAt","lastRollSfxAt","mapH","arrowId","foundArrowDef","arrowsLayer","aDef","stepScale","feetNow","feetPrev","overlapsX","onTop","crossedTop","falling","reactionDist","reactionDistance","shootDist","shootDistance","canJump","shootCooldown","isShooting","patrol","hitSomething","stayOnPlatform","groundX","groundY","frameSpeed","checkEntityCollision","explodeAnim","updateFrame","isInitialized","lastTimeRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","weatherDamageAccRef","activeRoomIdsRef","soundEnabledRef","ambientAudioRef","collectItem","checkHazardDamage","checkSecrets","updateProjectiles","setPlayer","onGameOver","continue","iceResist","maxIceResist","physicsDt","projectileIdRef","objMetaRef","isMouseDown","mouseLeft","triggeredSeagulls","soundState","isMoving","engineSoundTimer","shipY","shipH","shipBaseMapId","shipBaseX","shipBaseY","shipIdx","ArrowLeft","ArrowRight","ss","hornSound","horn","audio","stopTime","pause","once","engineSound","engine","shipGridXStart","shipGridXEnd","shipGridYStart","shipGridYEnd","seagullDef","rIdx","rId","proj","ownerId","useSimplePhysics","updateSeaRescue","shipAccel","shipFriction","maxShipSpeed","backgroundLayer","secretLayer","isSlippery","currentIceRes","maxIce","effectiveFriction","targetFriction","checkCollisionExtended","isPushing","pushTarget","currentStrength","isAlreadyAtMax","lastPushTime","pushDist","overlapDist","isNextToLeft","isNextToRight","pushForce","lastPushSoundTime","ladderInfo","findLadderAtPlayer","ctxResolved","resolveObjectAt","baseIdx","samplePoints","ladder","hasLadderAbove","aboveDef","remaining","steps","prevInWaterFrame","ladderSpeed","climbDir","standY","snappedToTop","stepMs","liquidParams","sample","resourceParams","parseNumber","maxLava","oxy","lavaRes","oxyParams","lavaParams","iceParams","strengthParams","oxygenApplies","oxygenEnabled","oxyDrain","oxyRegen","lavaApplies","lavaEnabled","lavaDrain","lavaRegen","applyResource","maxKey","drain","regen","maxVal","fogActive","maxRadio","maxRadioactivity","radio","radioactivity","radioParams","radioEnabled","radioBaseline","baselinePercent","radioGain","gainPerSecond","radioDecay","decayPerSecond","radioRecover","recoverPerSecond","baseline","rates","getRadioactivityRates","inc","radioactivityPerSecond","dec","radioactivityRegenPerSecond","increase","tickDepleteDps","dpsValue","damage","ambientStore","isSoundEnabled","clamp01","updateLoopingAudio","volume","Audio","loop","lastPlayAttempt","paused","rainDef","rainSound","rainUrl","rainBaseVol","waterfallDef","waterfallSound","ambient","waterfallUrl","maxDistPx","maxDistance","waterfallId","bestSq","distSq","waterfallVolume","healthDpsOverride","effectiveDps","currentAmmo","knockbackDir","maxX","playerDef","onIce","floatState","floatingText","acc","res","diff","amt","MAX_OXYGEN","MAX_LAVA_RESIST","MAX_RADIOACTIVITY","errorHandler","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","logData","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","useGameEngine","onRevealSecret","useInput","clearKeys","handleKeyDown","tagName","typing","isContentEditable","repeat","handleMouseDown","handleMouseUp","handleKeyUp","handleMouseMove","clientX","clientY","onToggleTerminal","passive","maxStrength","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","audioCtxUnlockedRef","thunderSoundStateRef","bag","last","onStateUpdateRef","onRevealSecretRef","onGameOverRef","objectMetadataRef","revealedSecretsRef","mapWidthRef","mapHeightRef","tileDataRef","objectDataRef","secretDataRef","onToggle","onUserGesture","strike","variants","tmp","swapIdx","checkHazardDamageWrapper","candidates","pushCandidate","touch","damageDirections","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","overlapTop","overlapBottom","overlapLeft","overlapRight","sideScore","chosen","prevIndex","damageOnce","baseDamage","immediate","TICK_MS","component","function","playerPosition","damageType","localRevealedRef","handleWeatherEffectHitWrapper","handleWeatherEffectHit","onBreakEffect","edist","prevHealth","inDamageRadius","shockRadius","meteorShockRadius","meteorShockDurationMs","lastFx","lastBioFxAt","bioConfig","breakConfig","onHit","lastMapIdRef","projectName","date_map_last_updated","date_map_created_at","isNewMapLoad","initialEntities","activeMapType","playerId","registryPlayer","prevAmmo","prevFishCount","pW","pH","maxXAtStart","checkCollisionExternal","TILE_SIZE_OVERRIDE","tileDataOverride","registryItemsOverride","secretDataOverride","objectDataOverride","objectMetadataOverride","ignoreId","isSolidAtPixelExternal","sampleLiquid","aabb","originX","originY","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","cwt","collisionWithTiles","hbs","hitboxScale","ric","spawnProjectileExternal","getLiquidTypeAtPixel","objectLayer","collectedItems","rWidth","rgX","rIndex","itemKey","rObjectData","rItemId","rItemDef","pickup","pickedUp","mapKey","itemId","itemDef","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","getDestructibleIndex","checkObjectHit","destructibleIdx","sgx","sgy","sindex","sobjId","checkEntityHit","checkPlayerHit","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","stepTime","removed","maxHeight","maxFlightHeight","floatTime","floatMax","floatingDurationMs","driftSettings","driftSpeed","driftAmp","aiType","inSound","objIdx","hitEntX","hitCooldown","canPlaySound","lastHitAt","fishJumpImpulse","hitIdxX","hypot","hitEntY","hitIdxY","requestAnimationFrame","cancelAnimationFrame","AnimatedItem","setIndex","setInterval","clearInterval","imgSrc","fallbackFrame","maxWidth","draggable","HeaderContainer","AmmoDisplay","FishDisplay","SeaRescueDisplay","AmmoIcon","span","RightSection","BarsContainer","BarRow","BarWrapper","BarFill","attrs","$percent","$color","BarLabel","GameHeader","hpPercent","oxyPercent","lavaPercent","icePercent","strengthPercent","radioPercent","fireballFrames","fireballA","fireballB","fireballC","fireballD","imageRendering","fishSprite","marginLeft","commands","register","cmd","listCommands","description","executeCommand","panelStyleBase","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","focus","onKey","scrollTop","scrollHeight","transform","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setLavaRain","setRadioactiveFog","setMeteorRain","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setDebugOverlayEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","setRoomBlurEnabled","showCoordinates","setShowCoordinates","minimized","setMinimized","pos","setPos","parse","setSize","draggingRef","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onSettingsUpdate","patch","onOpen","onMove","onUp","onResize","emitUpdate","panelStyle","userSelect","contentStyle","buttonStyle","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","defaultValue","_Fragment","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","getBreakEffectParams","breakEffectsConfig","ids","objectIds","types","objectTypes","matchesValue","shouldTriggerBreakEffect","hp","BackgroundMusicPlayer","audioRef","currentSrcRef","sourceNodeRef","filterNodeRef","gainNodeRef","musicContext","cleanup","close","resolveUrl","createMediaElementSource","setupWebAudio","setTargetAtTime","onGesture","val","Overlay","$isVisible","MessageOverlay","isVisible","defaultProps","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapDescription","MapInfo","WinCounterOverlay","GameOverOverlay","GameOverTitle","h1","ReplayButton","ModalDivider","FileUploadLabel","HiddenFileInput","Viewport","$blurred","GameCanvas","PlaceholderMessage","Game","dispatch","useDispatch","viewportRef","useSelector","uiState","effectiveMapType","version","runtimeSettings","setRuntimeSettings","getBaseWeather","toNumber","gameMessage","setGameMessage","messageTimerRef","clearTimeout","activeMapIdRef","isGameOverRef","handleStateUpdate","projectMapsResolved","spawnObjId","spawnDef","projectToLoad","loadMapData","metaPatch","breakFxPlayed","mapIdAtStart","ps","alert","settingKey","charAt","handleGameOver","indices","handleOpenModalEvent","weatherFogLegacy","sourceMapData","structuredClone","cloneMapData","effectiveMapData","activeLayers","bgLayer","mapTileData","mapSecretData","backgroundMusic","nowIso","mapName","dimensions","debugMapId","handleReplay","mapToLoad","isV2","author","sizeInfo","subMapInfo","mainMap","mapValues","accept","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","contents","suggestedName","mimeType","showSaveFilePicker","writable","createWritable","blob","Blob","write","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","applyMapData","setMapWidth","setMapHeight","setMapName","setCreatorName","setMapDescription","setCreatedAt","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","setSelectedBackgroundMusic","setPlayerPosition","setTileMapData","setObjectMapData","setSecretMapData","setObjectMetadata","setWeatherRain","setWeatherSnow","setWeatherClouds","setWeatherFog","setWeatherThunder","setWeatherLavaRain","setWeatherRadioactiveFog","setWeatherMeteorRain","setMaps","setActiveMapId","selectedBackgroundImage","selectedBackgroundMusic","worldY","date_created","ObjectLinks","React","links","portals","targets","x1","y1","x2","y2","strokeWidth","strokeDasharray","opacity","EditorTile","activeTool","tileObj","objObj","secretObj","isHighlighted","parentRegionIndex","borderStyle","bgStyle","handleGridMouseDown","handleGridMouseEnter","handleResizeStart","handleMoveStart","isRoomAreaVisible","showRoomMapContent","showMessages","isLiquidTile","isWaterTile","isLavaTile","isQuicksandTile","isWaterfallTile","isLavaWaterfallTile","isRadioactiveWaterTile","isRadioactiveWaterfallTile","messageText","i18nText","resolvedMessageText","isResizable","hasObjectOrSecret","onMouseEnter","boxSizing","objectFit","filterColorInEditor","isTree","editor","group","renderAboveOverride","treeLayerLabel","baseTop","baseLeft","baseWidth","baseHeight","inset","i18nMessage","hasIntensity","borderLeft","borderRight","textShadow","roomName","selectedBackgroundUrl","showBackgroundImage","activeLayer","hoverIndex","highlightedIndex","brushSize","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseUp","handleGridMouseLeave","setIsDragging","selectedTile","isEraserActive","isBrushActive","isBucketActive","cursorIndex","setCursorIndex","regions","roomAreas","getLayerColor","getLayerFilter","getPlacementAnchor","tile","handleGridMouseMove","getBoundingClientRect","currentTarget","nextIndex","onMouseUp","onMouseMove","onContextMenu","onMouseLeave","backgroundRepeat","backgroundSize","getGridStyles","previewIndex","previewX","previewY","previewW","previewH","gridTemplateColumns","gridTemplateRows","_","dTileId","dObjId","dSecId","layerColor","hx","hy","minX","selX","selY","originalX","originalY","parentRegion","EditorToolsContainer","HeaderBar","ToolsSection","ToolsGroup","ToolsInnerGroup","ToolsRow","ToolsEditorButton","$variant","$small","$square","$disabled","StrikeThrough","LayerIndicator","$bgColor","$borderColor","$textColor","BgColorContainer","BgColorInputWrapper","BgColorInput","disabled","BgTransparentButton","PlayButtonContainer","PlayButtonInner","InfoContainer","InfoItem","InfoLabel","InfoValue","EraserButtonContainer","EraserButtonInner","SelectionActions","ConfirmButton","CancelButton","GridIcon","SidebarContainer","ElementEditorButton","PanelContainer","$isOpen","PanelHeader","PanelBody","CloseButton","OperationButton","$danger","OperationLabel","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","tempMapDescription","setTempMapDescription","confirmNewMap","ModalHeader","BuiltInMapsModal","onSelect","topZIndex","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","setZIndex","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","lastHeightRef","offsetHeight","EditorMapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","inputSize","setInputSize","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","parseSize","parsed","applyInputResize","widthValue","heightValue","handleInputKeyDown","paddingBottom","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","obj","strokeStyle","lineWidth","portal","setLineDash","WorldView","switchMap","currentMapData","createMap","deleteMap","updateMapData","onAddRoomArea","mapLayoutsRef","dragRef","allMaps","draw","layouts","currentIds","layout","strokeRect","font","fillText","rAreaW","rAreaH","rTileW","rTileH","ri","sourceLayout","sourceMap","sx","isPortalSource","isDoorSource","linkId","targetLayout","tw","th","tTileW","tTileH","tObjId","tObjDef","isTarget","isDoorTarget","tMeta","endX","cp1X","cp1Y","cp2X","cp2Y","bezierCurveTo","save","translate","rotate","closePath","restore","btnX","btnY","confirm","mapStartX","mapStartY","BackgroundPanel","backgroundOptions","paddingTop","MusicPanel","musicOptions","fontStyle","status","WeatherPanel","weatherItems","setter","icon","SceneEditorButton","RightSidebarContainer","EditorScene","handleMapResize","isResizeWindowOpen","setIsResizeWindowOpen","isWorldViewOpen","setIsWorldViewOpen","isMinimapOpen","setIsMinimapOpen","setIsSettingsOpen","isBackgroundOpen","setIsBackgroundOpen","isMusicOpen","setIsMusicOpen","OperationsPanel","openNewMapModal","saveMap","loadMap","openBuiltInModal","clearMap","creatorName","mapDescription","inputStyle","handleFocus","handleBlur","onFocus","onBlur","CollapsiblePanel","setIsOpen","PalettePanel","isPlayMode","category","blocks","decorations","interactables","hazards","secrets","miniGames","messages","crackableWalls","pushableWalls","obstacles","setHighlightedIndex","handlePaletteSelect","selectedChapter","setSelectedChapter","selectedMiniGame","setSelectedMiniGame","tutorialChapters","tutorialItems","miniGameGroups","groupOrder","order","miniGameItems","ao","bo","displayName","localeCompare","getLiquidLabel","isLavaWaterfall","isRadioactiveWaterfall","isRadioactive","isWater","isQuicksand","renderPaletteItem","hasImage","isSecret","swatchStyle","iconText","getBlockGroup","withGroups","sortBlocks","groupPanels","flexWrap","otherItems","getLiquidGroup","li","sortLiquids","getDecorationGroup","sortDecorations","getEntityGroup","sortEntities","groupItems","getItemGroup","sortItems","getInteractableGroup","sortInteractables","getHazardGroup","sortHazards","ch","textTransform","getMiniGameLayer","StatisticsPanel","totalTiles","filledBlocks","objectsCount","emptyBlocks","registryMap","itemsCount","entitiesCount","mapList","mapsTotal","mapsOverworld","mapsUnderworld","mapsRooms","Trans","i18nKey","components","ObjectPropsPanel","listRef","highlightedElement","querySelector","scrollIntoView","behavior","block","isWeather","isMessage","isPortalOrTarget","isDoor","isRoomArea","i18nPreview","el","scrollX","clientWidth","scrollY","clientHeight","scrollTo","nextAbove","EditorElements","activePanel","setActivePanel","togglePanel","lastPanel","setLastPanel","pinnedPanel","setPinnedPanel","hoverTimerRef","displayPanel","clearHoverTimer","handleIconClick","panel","handleIconMouseEnter","handleIconMouseLeave","panelTitles","minigames","stats","handlePanelMouseEnter","handlePanelMouseLeave","EditorTools","setShowGrid","handlePlay","handlePause","handleReset","setActiveTool","setBrushSize","moveSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","setShowBackgroundImage","setShowMessages","setIsRoomAreaVisible","setShowRoomMapContent","tool","isDisabled","roman","getLayerIndicatorData","object","secret","textColor","getEraserData","useEditorOperations","createdAt","setIsNewMapModalOpen","handleSaveMap","currentDate","projectData","date_last_updated","statistics","total_tiles","filled_tiles","total_objects","saveFile","mapsCount","handleLoadMap","setters","handleLoadBuiltInMap","loadBuiltInMap","handleClearMap","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","isPropsLayer","targetLayer","setTargetData","newData","newMetadata","metadataChanged","targetX","useEditorPainting","setSelection","setPreviewPosition","setOriginalMapData","setDragStart","setHoverIndex","setBucketPreviewIndices","resizeState","setResizeState","moveState","setMoveState","bucketTimerRef","rightEraseRef","getLinkedRoomAt","roomX","roomY","roomWidth","roomHeight","overrideSelectedTile","effectiveTile","linkedRoom","rHeight","setRoomData","setRoomMetadata","newMeta","paintTileUtil","edge","useLinked","mWidth","mHeight","mIndex","mTileMapData","mObjectMapData","mSecretMapData","mObjectMetadata","mSetTileMapData","mSetObjectMapData","mSetSecretMapData","mSetObjectMetadata","existingObjId","existingSecretId","isEraser","isRoomMap","isRightErase","targetData","targetValue","newValue","floodFill","affectedIndices","metaChanged","curX","curY","newW","newH","newIndex","shouldErase","mData","baseIndex","selectionMetadata","tileMap","objectMap","secretMap","Editor","setSelectedTile","setActiveLayer","stateRef","isNewMapModalOpen","isBuiltInMapsModalOpen","setIsBuiltInMapsModalOpen","loadBackgroundOptions","loadMusicOptions","createNewMap","useEditorMaps","existingMaps","newMap","newMaps","lastActiveMapIdRef","newMapId","nextMap","handleCreateMap","finalName","prompt","timeout","selectedBgOption","useEditorRegistry","originalMapData","useEditorSelection","newTileMap","newObjectMap","newSecretMap","newObjectMetadata","destX","destY","destIdx","srcDataIdx","handleForceStop","playModeObjectData","playModeSecretData","playModeWeather","playModeMaps","gameEngineState","useEditorPlayMode","setIsPlayMode","setIsGameOver","restartCounter","setRestartCounter","editorSnapshot","setEditorSnapshot","setRevealedSecrets","setActiveRoomIds","setPlayModeObjectData","setPlayModeSecretData","setPlayModeWeather","playModeMapsVersion","setPlayModeMapsVersion","lastSyncedMapIdRef","isPlayModeRef","playModeMapsRef","engineInitId","currentPlayObjectData","playData","spawnIndex","spawnX","currentPlaySecretData","overrides","mapDataForGame","saved","newState","mapObj","prevTiles","newTiles","nextMeta","prevObjs","newObjs","prevMeta","handleRevealSecret","secretIndices","resetData","handleLoadMapWrapped","handleLoadBuiltInMapWrapped","toMove","handleDeleteMap","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","oldMeta","resizeArray","oldArr","newArr","oldY","oldM","newM","oldIdx","newIdx","resizeMetadata","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App"],"ignoreList":[],"sourceRoot":""}