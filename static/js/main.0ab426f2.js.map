{"version":3,"file":"static/js/main.0ab426f2.js","mappings":"uvBAAA,IAAIA,EAAM,CACT,kDAAmD,IACnD,uEAAwE,MAIzE,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,EAC5B,CACA,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,CACP,CACA,OAAOP,EAAIE,EACZ,CACAD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,EACpB,EACAC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,I,u5BCvBpB,IAAIH,EAAM,CACT,6BAA8B,KAC9B,+BAAgC,KAChC,gCAAiC,KACjC,+BAAgC,KAChC,+BAAgC,KAChC,2BAA4B,KAC5B,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,6CAA8C,KAC9C,6CAA8C,KAC9C,4CAA6C,KAC7C,4CAA6C,KAC7C,2BAA4B,KAC5B,sCAAuC,KACvC,sCAAuC,KACvC,sCAAuC,KACvC,sCAAuC,KACvC,+BAAgC,KAChC,+BAAgC,KAChC,+BAAgC,KAChC,+BAAgC,KAChC,2BAA4B,KAC5B,2BAA4B,KAC5B,qCAAsC,KACtC,qCAAsC,KACtC,qCAAsC,KACtC,qCAAsC,MAIvC,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,EAC5B,CACA,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,CACP,CACA,OAAOP,EAAIE,EACZ,CACAD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,EACpB,EACAC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,I,sweCxDpB,IAAIH,EAAM,CACT,6DAA8D,IAC9D,kFAAmF,KACnF,kCAAmC,KACnC,mCAAoC,MAIrC,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,EAC5B,CACA,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,CACP,CACA,OAAOP,EAAIE,EACZ,CACAD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,EACpB,EACAC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,I,iTCzBpB,IAAIH,EAAM,CACT,8BAA+B,KAC/B,gCAAiC,KACjC,iCAAkC,KAClC,2BAA4B,KAC5B,gCAAiC,KACjC,gCAAiC,KACjC,4BAA6B,KAC7B,gCAAiC,KACjC,qCAAsC,KACtC,wCAAyC,KACzC,uCAAwC,KACxC,4BAA6B,KAC7B,qCAAsC,KACtC,0CAA2C,KAC3C,6BAA8B,KAC9B,0BAA2B,KAC3B,mCAAoC,KACpC,2BAA4B,KAC5B,8BAA+B,KAC/B,6BAA8B,KAC9B,8BAA+B,KAIhC,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,EAC5B,CACA,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,CACP,CACA,OAAOP,EAAIE,EACZ,CACAD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,EACpB,EACAC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,I,42DCnCpB,MAAMY,EAAe,CACnBC,cAAe,KACfC,YAAa,GACbC,cAAe,GACfC,cAAe,GACfC,gBAAiB,GACjBC,qBAAsB,CAAC,EACvBC,SAAU,GACVC,UAAW,GACXC,WAAW,EACXC,MAAO,KACPC,UAAU,EACVC,YAAY,GAGRC,GAAYC,EAAAA,EAAAA,IAAY,CAC5BC,KAAM,OACNf,eACAgB,SAAU,CACRC,aAAcA,CAACC,EAAOC,KACpB,MAAM,QAAEC,EAAO,YAAElB,EAAW,cAAEC,EAAa,cAAEC,EAAa,SAAEG,EAAQ,UAAEC,GAAcW,EAAOE,QAC3FH,EAAMjB,cAAgBmB,EACtBF,EAAMhB,YAAcA,EACpBgB,EAAMf,cAAgBA,EACtBe,EAAMd,cAAgBA,GAAiB,GACvCc,EAAMb,gBAAkB,GACxBa,EAAMZ,qBAAuB,CAAC,EAC9BY,EAAMX,SAAWA,EACjBW,EAAMV,UAAYA,EAClBU,EAAMN,YAAa,GAErBU,gBAAiBA,CAACJ,EAAOC,KACvBD,EAAMf,cAAgBgB,EAAOE,SAE/BE,oBAAqBA,CAACL,EAAOC,KAC3B,MAAMK,EAAQL,EAAOE,aACcI,IAA/BP,EAAMf,cAAcqB,KACtBN,EAAMf,cAAcqB,GAAS,OAGjCE,oBAAqBA,CAACR,EAAOC,KAC3B,MAAM,MAAEK,EAAK,MAAEG,GAAUR,EAAOE,aACGI,IAA/BP,EAAMf,cAAcqB,KACtBN,EAAMf,cAAcqB,GAASG,IAGjCC,sBAAuBA,CAACV,EAAOC,KAC7B,MAAM,MAAEK,EAAK,aAAEK,GAAiBV,EAAOE,QACvCH,EAAMZ,qBAAqBkB,GAASK,GAEtCC,iBAAkBA,CAACZ,EAAOC,KACRA,EAAOE,QAEfU,QAAQC,IACTd,EAAMb,gBAAgB4B,SAASD,IAClCd,EAAMb,gBAAgB6B,KAAKF,MAIjCG,WAAYA,CAACjB,EAAOC,KAClBD,EAAMT,UAAYU,EAAOE,SAE3Be,SAAUA,CAAClB,EAAOC,KAChBD,EAAMR,MAAQS,EAAOE,SAEvBgB,UAAWA,CAACnB,EAAOC,KACjBD,EAAMP,SAAWQ,EAAOE,SAE1BiB,YAAaA,CAACpB,EAAOC,KACnBD,EAAMN,WAAaO,EAAOE,SAE5BkB,UAAYrB,IACH,IAAKlB,EAAcC,cAAeiB,EAAMjB,oBAKxC,aACXgB,EAAY,gBACZK,EAAe,oBACfC,EAAmB,oBACnBG,EAAmB,sBACnBE,EAAqB,iBACrBE,EAAgB,WAChBK,EAAU,SACVC,EAAQ,UACRC,EAAS,YACTC,EAAW,UACXC,GACE1B,EAAU2B,QAEd,EAAe3B,EAAiB,QC5FnB4B,EAAY,GAOZC,EAAa,IACbC,EAAa,IACbC,EAAkB,ICPzB5C,EAAe,CACnB6C,EAAG,EACHC,EAAG,EACHC,MAAO,GACPC,OAAQ,GACRC,GAAI,EACJC,GAAI,EACJC,YAAY,EACZC,UAAW,EACXC,UAAW,OACXC,OAAQ,GACRC,UAAWb,EACXc,KAAM,EACNC,OAAQd,EACRe,UAAWf,EACXgB,WAAYf,EACZgB,cAAehB,EACfiB,YAAa,GACbC,SAAS,EACTC,gBAAgB,EAChBC,WAAW,EACXC,WAAY,KACZC,WAAY,GAGRC,GAAcrD,EAAAA,EAAAA,IAAY,CAC9BC,KAAM,SACNf,aAAY,EACZgB,SAAU,CACRoD,YAAaA,CAAClD,EAAOC,KACZ,IAAKD,KAAUC,EAAOE,UAE/BgD,YAAaA,CAACnD,EAAOC,KACnB,MAAM,EAAE0B,EAAC,EAAEC,GAAM3B,EAAOE,QACxBH,EAAM2B,EAAIA,EACV3B,EAAM4B,EAAIA,GAEZwB,YAAaA,CAACpD,EAAOC,KACnB,MAAM,GAAE8B,EAAE,GAAEC,GAAO/B,EAAOE,QAC1BH,EAAM+B,GAAKA,EACX/B,EAAMgC,GAAKA,GAEbqB,UAAWA,CAACrD,EAAOC,KACjBD,EAAMoC,OAASkB,KAAKC,IAAI,EAAGD,KAAKE,IAAIxD,EAAMqC,UAAWpC,EAAOE,WAE9DsD,UAAWA,CAACzD,EAAOC,KACjBD,EAAMoC,OAASkB,KAAKC,IAAI,EAAGD,KAAKE,IAAIxD,EAAMqC,UAAWrC,EAAMoC,OAASnC,EAAOE,WAE7EuD,WAAYA,CAAC1D,EAAOC,KAClBD,EAAMoC,OAASkB,KAAKC,IAAI,EAAGvD,EAAMoC,OAASnC,EAAOE,SACjDH,EAAMgD,WAAaM,KAAKC,IAAIvD,EAAMgD,WAAY,MAEhDW,QAASA,CAAC3D,EAAOC,KACfD,EAAMsC,KAAOgB,KAAKC,IAAI,EAAGtD,EAAOE,UAElCyD,QAASA,CAAC5D,EAAOC,KACfD,EAAMsC,KAAOgB,KAAKC,IAAI,EAAGvD,EAAMsC,KAAOrC,EAAOE,UAE/C0D,UAAWA,CAAC7D,EAAOC,KACjBD,EAAMuC,OAASe,KAAKC,IAAI,EAAGD,KAAKE,IAAIxD,EAAMwC,UAAWvC,EAAOE,WAE9D2D,cAAeA,CAAC9D,EAAOC,KACrBD,EAAMyC,WAAaa,KAAKC,IAAI,EAAGD,KAAKE,IAAIxD,EAAM0C,cAAezC,EAAOE,WAEtE4D,eAAgBA,CAAC/D,EAAOC,KACtBD,EAAM2C,YAAc1C,EAAOE,SAE7B6D,cAAeA,CAAChE,EAAOC,KACrBD,EAAM2C,YAAY3B,KAAKf,EAAOE,UAEhC8D,iBAAkBA,CAACjE,EAAOC,KACxBD,EAAM2C,YAAc3C,EAAM2C,YAAYuB,OAAOC,GAAKA,EAAEjG,KAAO+B,EAAOE,UAEpEiE,aAAcA,CAACpE,EAAOC,KACpBD,EAAMkC,UAAYjC,EAAOE,SAE3BkE,aAAcA,CAACrE,EAAOC,KACpBD,EAAMmC,UAAYlC,EAAOE,SAE3BmE,YAAaA,CAACtE,EAAOC,KACnBD,EAAMiC,WAAahC,EAAOE,SAE5BoE,WAAYA,CAACvE,EAAOC,KAClBD,EAAM4C,QAAU3C,EAAOE,SAEzBqE,cAAeA,CAACxE,EAAOC,KACrBD,EAAM+C,WAAa9C,EAAOE,SAE5BsE,YAAaA,IAAM3F,MAIV,YACXoE,EAAW,YACXC,EAAW,YACXC,EAAW,UACXC,EAAS,UACTI,EAAS,WACTC,EAAU,QACVC,EAAO,QACPC,EAAO,UACPC,EAAS,cACTC,EAAa,eACbC,EAAc,cACdC,EAAa,iBACbC,EAAgB,aAChBG,EAAY,aACZC,EAAY,YACZC,EAAW,WACXC,EAAU,cACVC,EAAa,YACbC,GACExB,EAAY3B,QAEhB,EAAe2B,EAAmB,QCnH5BnE,EAAe,CACnB4F,MAAO,CACLC,SAAS,EACTC,aAAc,EACdC,UAAW,GACXC,YAAa,IAEfC,SAAU,CACRC,yBAA0B,GAC1BC,YAAa,EACbC,YAAa,EACbC,cAAe,EACfC,WAAY,EACZC,eAAgB,GAElBC,GAAI,CACFC,kBAAkB,EAClBC,kBAAkB,EAClBC,gBAAgB,EAChBC,sBAAsB,EACtBC,mBAAmB,GAErBC,SAAU,CACRC,MAAO,IACPC,QAAS,IACTC,QAAS,IACTC,SAAU,IACVC,QAAS,QACTC,SAAU,cAkBRC,GAAgBvG,EAAAA,EAAAA,IAAY,CAChCC,KAAM,WACNf,aAfmBsH,MACnB,IACE,MAAMC,EAAQC,aAAaC,QAAQ,iBACnC,GAAIF,EAAO,CACT,MAAMG,EAASC,KAAKC,MAAML,GAC1B,MAAO,IAAKvH,KAAiB0H,EAC/B,CACF,CAAE,MAAOhH,GACPmH,QAAQnH,MAAM,2BAA4BA,EAC5C,CACA,OAAOV,GAKOsH,GACdtG,SAAU,CACR8G,eAAgBA,CAAC5G,EAAOC,KACtB,MAAM4G,EAAW,IAAK7G,KAAUC,EAAOE,SAEvC,IACEmG,aAAaQ,QAAQ,gBAAiBL,KAAKM,UAAUF,GACvD,CAAE,MAAOrH,GACPmH,QAAQnH,MAAM,2BAA4BA,EAC5C,CACA,OAAOqH,GAETG,gBAAiBA,CAAChH,EAAOC,KACvBD,EAAM0E,MAAMC,QAAU1E,EAAOE,QAC7B,IACEmG,aAAaQ,QAAQ,qBAAsB7G,EAAOE,QAAU,IAAM,IACpE,CAAE,MAAOX,GACPmH,QAAQnH,MAAM,gCAAiCA,EACjD,GAEFyH,eAAgBA,CAACjH,EAAOC,KACtB,MAAM,KAAEiH,EAAI,OAAEC,GAAWlH,EAAOE,QACnB,WAAT+G,EAAmBlH,EAAM0E,MAAME,aAAeuC,EAChC,QAATD,EAAgBlH,EAAM0E,MAAMG,UAAYsC,EAC/B,UAATD,IAAkBlH,EAAM0E,MAAMI,YAAcqC,IAEvDC,mBAAoBA,CAACpH,EAAOC,KAC1B,MAAM,IAAEoH,EAAG,MAAEC,GAAUrH,EAAOE,aACFI,IAAxBP,EAAM+E,SAASsC,KACjBrH,EAAM+E,SAASsC,GAAOC,IAG1BC,aAAcA,CAACvH,EAAOC,KACpB,MAAM,IAAEoH,EAAG,MAAEC,GAAUrH,EAAOE,aACRI,IAAlBP,EAAMsF,GAAG+B,KACXrH,EAAMsF,GAAG+B,GAAOC,IAGpBE,kBAAmBA,CAACxH,EAAOC,KACzB,MAAM,IAAEoH,EAAG,MAAEC,GAAUrH,EAAOE,aACFI,IAAxBP,EAAM4F,SAASyB,KACjBrH,EAAM4F,SAASyB,GAAOC,IAG1BG,cAAeA,KACb,IACEnB,aAAaoB,WAAW,gBAC1B,CAAE,MAAOlI,GACPmH,QAAQnH,MAAM,4BAA6BA,EAC7C,CACA,OAAOV,OAKA,eACX8H,EAAc,gBACdI,EAAe,eACfC,EAAc,mBACdG,GAAkB,aAClBG,GAAY,kBACZC,GAAiB,cACjBC,IACEtB,EAAc7E,QAElB,GAAe6E,EAAqB,QCjH9BrH,GAAe,CACnB6I,gBAAgB,EAChBC,gBAAgB,EAChBC,gBAAgB,EAChBC,iBAAiB,EACjBC,cAAe,GACfC,cAAe,EACfC,iBAAiB,GAGbC,IAAUtI,EAAAA,EAAAA,IAAY,CAC1BC,KAAM,KACNf,aAAY,GACZgB,SAAU,CACRqI,gBAAiBA,CAACnI,EAAOC,KACvBD,EAAM2H,eAAiB1H,EAAOE,SAEhCiI,gBAAiBA,CAACpI,EAAOC,KACvBD,EAAM4H,eAAiB3H,EAAOE,SAEhCkI,gBAAiBA,CAACrI,EAAOC,KACvBD,EAAM6H,eAAiB5H,EAAOE,QAE9B,IACEmI,OAAOC,uBAAyBtI,EAAOE,OACzC,CAAE,MAAO,GAEXqI,iBAAkBA,CAACxI,EAAOC,KACxBD,EAAM8H,gBAAkB7H,EAAOE,SAEjCsI,gBAAiBA,CAACzI,EAAOC,KACvBD,EAAM+H,cAAc/G,KAAK,CACvB9C,GAAIwK,KAAKC,MACTC,WAAW,IAAIF,MAAOG,iBACnB5I,EAAOE,WAGd2I,mBAAoBA,CAAC9I,EAAOC,KAC1BD,EAAM+H,cAAgB/H,EAAM+H,cAAc7D,OAAO6E,GAAKA,EAAE7K,KAAO+B,EAAOE,UAExE6I,mBAAqBhJ,IACnBA,EAAM+H,cAAgB,IAExBkB,iBAAkBA,CAACjJ,EAAOC,KACxBD,EAAMgI,cAAgB/H,EAAOE,SAE/B+I,mBAAoBA,CAAClJ,EAAOC,KAC1BD,EAAMiI,gBAAkBhI,EAAOE,SAEjCgJ,QAASA,IAAMrK,OAIN,gBACXqJ,GAAe,gBACfC,GAAe,gBACfC,GAAe,iBACfG,GAAgB,gBAChBC,GAAe,mBACfK,GAAkB,mBAClBE,GAAkB,iBAClBC,GAAgB,mBAChBC,GAAkB,QAClBC,IACEjB,GAAQ5G,QAEZ,GAAe4G,GAAe,QCzC9B,IArBckB,EAAAA,EAAAA,IAAe,CAC3BC,QAAS,CACPC,KAAMC,EACNC,OAAQC,EACRC,SAAUC,GACVrE,GAAIsE,IAENC,WAAaC,GACXA,EAAqB,CACnBC,kBAAmB,CAEjBC,eAAgB,CAAC,oBAAqB,sBAEtCC,mBAAoB,CAAC,sBAAuB,qBAE5CC,aAAc,CAAC,qBAAsB,yBAG3CC,UAAUC,IC6DZ,GArFc,CACZC,OAAQ,CACNC,QAAS,UACTC,UAAW,UACXC,OAAQ,UACRC,QAAS,UACTC,QAAS,UACTC,KAAM,UACNC,KAAM,OACNC,SAAU,OACVC,WAAY,OACZC,UAAW,OACXC,WAAY,OACZC,QAAS,UACTC,QAAS,qBACTC,KAAM,OACNC,UAAW,OACXC,SAAU,OACVC,OAAQ,OACRC,YAAa,QAGfC,QAAS,CACPC,GAAI,MACJC,GAAI,MACJC,GAAI,OACJC,GAAI,OACJC,GAAI,OACJC,IAAK,QAGPC,aAAc,CACZL,GAAI,MACJC,GAAI,MACJC,GAAI,MACJC,GAAI,OACJG,MAAO,OAGTC,QAAS,CACPP,GAAI,4BACJC,GAAI,4BACJC,GAAI,+BAGNM,SAAU,CACRT,GAAI,OACJC,GAAI,OACJC,GAAI,OACJQ,KAAM,OACNP,GAAI,OACJC,GAAI,OACJC,IAAK,QAGPM,WAAY,CACVC,MAAO,IACPC,OAAQ,IACRC,OAAQ,IACRC,SAAU,IACVC,KAAM,KAGRC,YAAa,CACXC,KAAM,aACNL,OAAQ,YACRM,KAAM,aAGRC,OAAQ,CACNV,KAAM,EACNW,SAAU,IACVC,MAAO,IACPC,QAAS,KACTC,aAAc,MAGhBC,YAAa,CACXC,OAAQ,QACRC,OAAQ,QACRC,QAAS,SACTC,KAAM,WCXV,IArEqBC,EAAAA,EAAAA,IAAiB,4vB,gCCGhCC,GAAgB,I,+MAIhBC,GAAgB,I,gLAIhBC,GAAgB,I,kLAIhBC,GAAgB,I,+YAIhBC,GAAgB,I,gSAItBC,GAAAA,GAAAA,IACSC,GAAAA,IACJC,KAAK,CACFC,IAAK,KACLC,YAAa,KACbC,cAAe,CAAC,KAAM,KAAM,KAAM,KAAM,MACxCC,GAAI,CAAC,cACLC,UAAW,aACXC,cAAe,CAAEC,aAAa,GAC9BC,UAAW,CACPC,GAAI,CACAC,WAAYjB,IAEhBkB,GAAI,CACAD,WAAYhB,IAEhBkB,GAAI,CACAF,WAAYf,IAEhBkB,GAAI,CACAH,WAAYd,IAEhBkB,GAAI,CACAJ,WAAYb,O,eChDrB,MAAMkB,IAAgBC,EAAAA,EAAAA,IAAOC,EAAAA,IAAQC,WAAA,CAAAC,YAAA,gBAAfH,CAAe,mfAgCrC,SAASI,KACZ,MAAM,EAAEC,IAAMC,EAAAA,GAAAA,IAAe,cACvBC,EAAeF,EAAE,mBACjBG,EAAeH,EAAE,uBACjBI,EAAiBJ,EAAE,qBACnBK,EAAmBL,EAAE,uBACrBM,EAAqBN,EAAE,yBAQ7B,OACIO,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQC,IAAK,KAAMC,SAAA,EACtCC,EAAAA,GAAAA,KAAClB,GAAa,CAACmB,GAAG,IAAIC,UAAWA,EAAGC,cAAeA,EAAW,SAAW,GAAGJ,SACtET,KAINU,EAAAA,GAAAA,KAAClB,GAAa,CAACmB,GAAG,QAAQG,QAZPC,KAEvB/H,OAAOgI,cAAc,IAAIC,MAAM,yBAU4BL,UAAWA,EAAGC,cAAeA,EAAW,SAAW,GAAGJ,SACvGR,KAGNS,EAAAA,GAAAA,KAAClB,GAAa,CAACmB,GAAG,UAAUC,UAAWA,EAAGC,cAAeA,EAAW,SAAW,GAAGJ,SAC5EP,KAGNQ,EAAAA,GAAAA,KAAClB,GAAa,CAACmB,GAAG,YAAYC,UAAWA,EAAGC,cAAeA,EAAW,SAAW,GAAGJ,SAC9EN,KAGNO,EAAAA,GAAAA,KAAClB,GAAa,CAACmB,GAAG,cAAcC,UAAWA,EAAGC,cAAeA,EAAW,SAAW,GAAGJ,SAChFL,MAIlB,CCvEA,MAAMc,GAAYzB,EAAAA,GAAO0B,OAAMxB,WAAA,CAAAC,YAAA,gBAAbH,CAAa,8dAgChB,SAAS2B,KACpB,MAAM,KAAE7C,IAASwB,EAAAA,GAAAA,MACXsB,EAAc9C,EAAK+C,UAAY,KAE/BC,EAAwBC,IAC1BjD,EAAKkD,eAAeD,IAGxB,OACInB,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQC,IAAK,KAAMC,SAAA,EACtCC,EAAAA,GAAAA,KAACQ,GAAS,CACNN,UAA2B,OAAhBS,EAAuB,SAAW,GAC7CP,QAASA,IAAMS,EAAqB,MAAMd,SAC7C,QAIDC,EAAAA,GAAAA,KAACQ,GAAS,CACNN,UAA2B,OAAhBS,EAAuB,SAAW,GAC7CP,QAASA,IAAMS,EAAqB,MAAMd,SAC7C,QAIDC,EAAAA,GAAAA,KAACQ,GAAS,CACNN,UAA2B,OAAhBS,EAAuB,SAAW,GAC7CP,QAASA,IAAMS,EAAqB,MAAMd,SAC7C,QAIDC,EAAAA,GAAAA,KAACQ,GAAS,CACNN,UAA2B,OAAhBS,EAAuB,SAAW,GAC7CP,QAASA,IAAMS,EAAqB,MAAMd,SAC7C,QAIDC,EAAAA,GAAAA,KAACQ,GAAS,CACNN,UAA2B,OAAhBS,EAAuB,SAAW,GAC7CP,QAASA,IAAMS,EAAqB,MAAMd,SAC7C,SAKb,CC/EA,MAAMiB,GAAajC,EAAAA,GAAO5K,EAAC8K,WAAA,CAAAC,YAAA,eAARH,CAAQ,+BAIpB,SAASkC,KAEZ,OACIjB,EAAAA,GAAAA,KAACgB,GAAU,CAAAjB,SAAC,mBAIpB,CCRA,MAAMmB,GAAgCnC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,eAAVH,CAAU,yaA+DhD,SArBA,WAEI,OACIiB,EAAAA,GAAAA,KAACkB,GAA6B,CAAAnB,UAC1BJ,EAAAA,GAAAA,MAAA,OAAKO,UAAU,cAAaH,SAAA,EACxBC,EAAAA,GAAAA,KAAA,OAAKE,UAAU,kBAAiBH,UAC5BC,EAAAA,GAAAA,KAACiB,GAA2B,OAGhCjB,EAAAA,GAAAA,KAAA,OAAKE,UAAU,sBAAqBH,UAChCC,EAAAA,GAAAA,KAACb,GAA+B,OAGpCa,EAAAA,GAAAA,KAAA,OAAKE,UAAU,uBAAsBH,UACjCC,EAAAA,GAAAA,KAACU,GAAgC,UAKrD,EChEMU,GAA4BrC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,+PAmC5C,SAXA,WAEI,OACIiB,EAAAA,GAAAA,KAACoB,GAAyB,CAAArB,UACtBC,EAAAA,GAAAA,KAAA,OAAKE,UAAU,cAAaH,UACxBC,EAAAA,GAAAA,KAAA,KAAAD,SAAG,+BAInB,ECjCMsB,GAAuBtC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,eAAVH,CAAU,2FAiBvC,SATA,UAAwB,SAAEgB,EAAQ,MAAEH,IAEhC,OACII,EAAAA,GAAAA,KAACqB,GAAoB,CAACzB,MAAOA,EAAMG,SAC7BA,GAGd,ECXA,IAAIuB,GAAY,KAOKC,MAEjB,GAAID,GAAW,OAAOA,GAEtB3K,QAAQ6K,KAAK,sBAEb,IAEI,MAAMC,EAAcC,EAAAA,MAGdC,EAAeD,EAAAA,MAGrB,IAAIE,EAAe,KACnB,IACIA,EAAeF,EAAAA,KACnB,CAAE,MAAOpT,GAELsT,EAAe,IACnB,CAGKA,GACDjL,QAAQkL,KAAK,4EAIjB,MAAMC,EAAeC,IACjB,IAAKA,EAAS,OAAO,KACrB,IAGI,MAAMC,EAAYD,EAAQE,QAAQ,kBAAmB,MAAMA,QAAQ,qBAAsB,MACnFC,EAAeF,EAAUG,WAAW,MAAQH,EAAY,KAAKA,IAE7DI,EAAcT,EAAaO,GACjC,OAAOE,EAAYC,SAAWD,CAClC,CAAE,MAAO9T,GAEL,OADAqI,QAAQkL,KAAK,oBAAoBE,KAC1BA,CACX,GAGJ,IAAIO,GAAyB,EAC7B,MAAMC,EAAgBR,IAClB,IAAKA,EAAS,OAAO,KAErB,MAMMS,EANarO,KACf,IAAIsO,EAAMtO,EAGV,OAFAsO,EAAMA,EAAIR,QAAQ,kBAAmB,MAAMA,QAAQ,qBAAsB,MACzEQ,EAAMA,EAAIR,QAAQ,iBAAkB,MAAMA,QAAQ,oBAAqB,MAChEQ,EAAIN,WAAW,MAAQM,EAAM,KAAKA,KAEjCC,CAAUX,GAEtB,GAAIH,EACA,IACI,MAAMe,EAAMf,EAAaY,GACzB,OAAOG,EAAIN,SAAWM,CAC1B,CAAE,MAAO,CAOb,OAJKL,IACD3L,QAAQkL,KAAK,oBAAoBE,2GACjCO,GAAyB,GAEtBP,GAGXT,GAAYG,EAAYhT,OAAOV,IAAKsJ,IAChC,MAAMuL,EAAOnB,EAAYpK,GACnBwL,EAAOD,EAAKP,SAAWO,EAG7B,IAAIE,EAAkBhB,EAAYe,EAAKE,SAGnCC,EAAmB,GAKvB,OAJIH,EAAKI,UAAYC,MAAMC,QAAQN,EAAKI,YACpCD,EAAmBH,EAAKI,SAASlV,IAAIqV,GAAQtB,EAAYsB,KAGtD,IACAP,EACHE,QAASD,EACTG,SAAUD,EAEVK,IAAKd,EAAaM,EAAKQ,KAAOR,EAAKS,aAAe,SAQ1DhC,GAAUzQ,QAAQgS,IACd,GAAIA,EAAKU,iBAAkB,CAIvB,MAAMC,EAAWlC,GAAUmC,KAAKC,GAAKA,EAAExV,KAAO2U,EAAKU,kBAAoBG,EAAExV,KAAO2U,EAAKU,iBAAmB,QAaxG,GAXIC,IAEKX,EAAKE,UAASF,EAAKE,QAAUS,EAAST,SACtCF,EAAKI,UAAqC,IAAzBJ,EAAKI,SAASU,SAAcd,EAAKI,SAAWO,EAASP,UACtEJ,EAAKe,iBAAgBf,EAAKe,eAAiBJ,EAASI,gBAGzDJ,EAASK,kBAAmB,GAI5BhB,EAAKiB,cAAe,CACnB,MAAMC,EAAWzC,GAAUmC,KAAKC,GAAKA,EAAExV,KAAO2U,EAAKiB,eAC/CC,IAAUA,EAASF,kBAAmB,EAC/C,CACA,GAAIhB,EAAKmB,gBAAiB,CACrB,MAAMC,EAAa3C,GAAUmC,KAAKC,GAAKA,EAAExV,KAAO2U,EAAKmB,iBAAmBN,EAAExV,KAAO2U,EAAKmB,gBAAkB,QACpGC,IAAYA,EAAWJ,kBAAmB,EACnD,CACJ,IAGJlN,QAAQuN,IAAI,4CAAuC5C,GAAUqC,gBAEjE,CAAE,MAAOnU,GACLmH,QAAQnH,MAAM,uCAAmCA,GACjD8R,GAAY,EAChB,CAEA3K,QAAQwN,QAAQ,uBAKpB5C,GAGO,MAAM6C,GAAcA,IAChB9C,GAIE+C,GAAgBnW,GAClBoT,GAAYA,GAAUmC,KAAKZ,GAAQA,EAAK3U,KAAOA,GAAM,KCtHhE,SA/BA,WAQE,OANAoW,EAAAA,EAAAA,WAAU,KAER,MAAMC,EAAQH,KACdzN,QAAQuN,IAAI,0CAA2CK,IACtD,KAGG5E,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CACRC,QAAS,OACT2E,cAAe,SACfC,eAAgB,aAChBC,WAAY,SACZ7S,MAAO,QACPC,OAAQ,QACR6S,SAAU,UACZ5E,SAAA,EACEC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE/N,MAAO,OAAQ+S,WAAY,GAAI7E,UACzCC,EAAAA,GAAAA,KAAC6E,GAAa,OAElB7E,EAAAA,GAAAA,KAAC8E,GAAc,CAAClF,MAAO,CAAEmF,SAAU,EAAGlT,MAAO,OAAQ8S,SAAU,QAAS5E,UACpEC,EAAAA,GAAAA,KAACgF,EAAAA,GAAM,OAEXhF,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE/N,MAAO,OAAQ+S,WAAY,GAAI7E,UACzCC,EAAAA,GAAAA,KAACiF,GAAa,QAI1B,ECrCW,SAASC,KAEpB,OACIlF,EAAAA,GAAAA,KAAAmF,GAAAA,SAAA,CAAApF,UACIC,EAAAA,GAAAA,KAAA,KAAAD,SAAG,UAGf,C,oCCDO,MAAMqF,GACXC,WAAAA,GACEC,KAAKC,KAAO,IAAIC,GAClB,CAEAC,GAAAA,CAAIC,GACF,IAAKA,EAAK,OAAO,KACjB,MAAMC,EAAIL,KAAKC,KACf,GAAII,EAAEC,IAAIF,GAAM,OAAOC,EAAEF,IAAIC,GAC7B,MAAMG,EAAMC,GAAAA,IAAQC,KAAKL,GAEzB,OADAC,EAAEK,IAAIN,EAAKG,GACJA,CACT,CAEAD,GAAAA,CAAIF,GACF,OAAOJ,KAAKC,KAAKK,IAAIF,EACvB,CAEAO,OAAAA,CAAQP,GAGFA,GAAOJ,KAAKC,KAAKK,IAAIF,IAAMJ,KAAKC,KAAKW,OAAOR,EAClD,CAEAS,KAAAA,GACEb,KAAKC,KAAKY,OACZ,EC/Ba,MAAMC,GACnBf,WAAAA,CAAYgB,EAAWC,EAAKC,GAC1BjB,KAAKe,UAAYA,EACjBf,KAAKgB,IAAMA,EACXhB,KAAKiB,aAAeA,GAAgB,KAAO,GAC3CjB,KAAKzT,MAAQyU,EAAIjX,SAAWiX,EAAIE,SAChClB,KAAKxT,OAASwU,EAAIhX,UAAYgX,EAAIE,SAClClB,KAAKmB,UAAY,GACjBnB,KAAKoB,UAAY,EACjB,MAAMC,EAAOrB,KAAKzT,MAAQyT,KAAKxT,OAE/BwT,KAAKsB,aAAetT,KAAKC,IAAI,IAAKD,KAAKuT,MAAMF,EAAO,MACtD,CAEAG,YAAAA,CAAaC,GACXzB,KAAKoB,UAAYpT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,GAC1D,CAEAE,QAAAA,GACE,MAAMC,EAAI,IAAIC,GAAAA,IACdD,EAAEf,QAEFe,EAAEE,UAAU,GACZF,EAAEG,UAAU,QAAU,KAEtBH,EAAEI,SAAS,EAAG,EAAG,IAAK,GACtBJ,EAAEK,UACF,MAAM5V,EAAI2B,KAAKkU,SAAWlC,KAAKzT,MACzBD,GAAK,GAAqB,GAAhB0B,KAAKkU,SACfC,EAAQ,IAAsB,IAAhBnU,KAAKkU,SACnBzV,EAAsB,GAAhBuB,KAAKkU,SAAgB,GAC3BxV,EAAKyV,EACXP,EAAEvV,EAAIA,EACNuV,EAAEtV,EAAIA,EACNsV,EAAEQ,SAAW,IACbpC,KAAKe,UAAUsB,SAAST,GACxB5B,KAAKmB,UAAUzV,KAAK,CAAEkW,IAAGvV,IAAGC,IAAGG,KAAIC,KAAI4V,QAAS,EAAGC,OAAO,GAC5D,CAEAC,MAAAA,CAAOC,GAELzC,KAAKwB,aAAaxB,KAAKiB,gBAGvB,MAAMyB,EAAO1U,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,MAChDuB,EAAS3U,KAAK4U,IAAIF,EAAM,MAC9B,IAAIG,EAAS7U,KAAKuT,MAAMvB,KAAKsB,aAAeqB,GACxCA,EAAS,GAAKE,EAAS,IAAGA,EAAS,GAEvC,MAAMC,EAAUD,EAAS7C,KAAKmB,UAAU9C,OACxC,GAAIyE,EAAU,EAAG,CAEf,MAAMC,EAAc,GACdC,EAAShV,KAAKC,IAAI,EAAGD,KAAKiV,KAAc,IAATJ,IAC/BK,EAAUlV,KAAKE,IAAI4U,EAASE,EAAQD,GAC1C,IAAK,IAAII,EAAI,EAAGA,EAAID,EAASC,IAAKnD,KAAK2B,UACzC,CAEA,GAAI3B,KAAKmB,UAAU9C,OAASwE,EAAQ,CAClC,MAAMO,EAAUpD,KAAKmB,UAAU9C,OAASwE,EAClCQ,EAASrV,KAAKE,IAAIkV,EAASpV,KAAKC,IAAI,EAAGD,KAAKiV,KAA6B,IAAxBjD,KAAKmB,UAAU9C,UACtE,IAAK,IAAI8E,EAAI,EAAGA,EAAIE,EAAQF,IAAK,CAC/B,MAAMtU,EAAImR,KAAKmB,UAAUmC,MACzB,IAAKzU,EAAG,MACR,IAAMA,EAAE+S,EAAE2B,QAAU1U,EAAE+S,EAAE2B,OAAOC,YAAY3U,EAAE+S,EAAI,CAAE,MAAO,CAC1D,IAAM/S,EAAE+S,EAAE6B,SAAW,CAAE,MAAO,CAChC,CACF,CAEA,MACMC,EAAKjB,EAAO,IACZkB,EAAW,GAEjB,IAAK,IAAIR,EAAI,EAAGA,EAAInD,KAAKmB,UAAU9C,OAAQ8E,IAAK,CAC9C,MAAMtU,EAAImR,KAAKmB,UAAUgC,GACzB,IAAKtU,EAAE0T,MAAO,CAAEoB,EAASjY,KAAKyX,GAAI,QAAU,CAE5CtU,EAAEnC,IARS,KAQIgX,EACf,IAAIE,EAAK/U,EAAExC,EAAIwC,EAAEpC,GAAKiX,EAClBG,EAAKhV,EAAEvC,EAAIuC,EAAEnC,GAAKgX,EAGtB,IACE,GAA0C,oBAA/B1D,KAAKgB,IAAI8C,kBAAkC,CAEpD,MAAMC,EAAU/D,KAAKgB,IAAI8C,kBAAkB,QAASF,GACpD,GAAIlC,OAAOsC,SAASD,IAAYF,GAAME,EAAS,CAE7C,MAAM5B,EAAQnU,KAAKC,IAAI,EAAGD,KAAKE,IAAI,KAAMW,EAAEnC,KACrCuX,EAAWjW,KAAKE,IAAI,EAAG,GAAMiU,EAAQ,KACL,oBAA3BnC,KAAKgB,IAAIkD,eAA8BlE,KAAKgB,IAAIkD,cAAc,CAAE7X,EAAGuX,EAAIK,aAClFpV,EAAE0T,OAAQ,EAAOoB,EAASjY,KAAKyX,GAC/B,QACF,CACA,MAAMgB,EAASnE,KAAKgB,IAAI8C,kBAAkB,OAAQF,GAClD,GAAIlC,OAAOsC,SAASG,IAAWN,GAAMM,EAAQ,CAE3C,MAAMhC,EAAQnU,KAAKC,IAAI,EAAGD,KAAKE,IAAI,KAAMW,EAAEnC,KACrCuX,EAAWjW,KAAKE,IAAI,EAAG,IAAOiU,EAAQ,MACP,oBAA1BnC,KAAKgB,IAAIoD,cAA6BpE,KAAKgB,IAAIoD,aAAa,CAAE/X,EAAGuX,EAAItX,EAAG6X,EAAQF,aAC3FpV,EAAE0T,OAAQ,EAAOoB,EAASjY,KAAKyX,GAC/B,QACF,CACF,CACF,CAAE,MAAO,CAGT,GAAInD,KAAKgB,IAAIqD,UAAUT,EAAIC,GAAK,CAE9B,IAAIS,EAAQ,EACZ,KAAOtE,KAAKgB,IAAIqD,UAAUT,EAAIC,IAAOS,EAAQ,GAAKT,GAAM,EAAGS,IAEzC,IAAdzV,EAAEyT,SAAiBtU,KAAKuW,IAAI1V,EAAEnC,IAAM,KACtCmC,EAAEnC,GAAa,IAAPmC,EAAEnC,GACVmC,EAAEpC,IAAM,GACRoC,EAAEyT,YAGFzT,EAAE0T,OAAQ,EACVoB,EAASjY,KAAKyX,GAElB,CAEAtU,EAAExC,EAAIuX,EACN/U,EAAEvC,EAAIuX,EACNhV,EAAE+S,EAAEvV,EAAIwC,EAAExC,EACVwC,EAAE+S,EAAEtV,EAAIuC,EAAEvC,GAGNuC,EAAEvC,EAAI0T,KAAKxT,OAAS,IAAMqC,EAAExC,GAAK,IAAMwC,EAAExC,EAAI2T,KAAKzT,MAAQ,MAC5DsC,EAAE0T,OAAQ,EACVoB,EAASjY,KAAKyX,GAElB,CAGA,IAAK,IAAIqB,EAAIb,EAAStF,OAAS,EAAGmG,GAAK,EAAGA,IAAK,CAC7C,MAAMhZ,EAAMmY,EAASa,GACf3V,EAAImR,KAAKmB,UAAU3V,GAEzB,GADIqD,GAAKA,EAAE+S,GAAK/S,EAAE+S,EAAE2B,QAAQ1U,EAAE+S,EAAE2B,OAAOC,YAAY3U,EAAE+S,GACjD/S,GAAKA,EAAE+S,GAAK/S,EAAE+S,EAAE6B,QAAS,IAAM5U,EAAE+S,EAAE6B,SAAW,CAAE,MAAO,CAC3DzD,KAAKmB,UAAUsD,OAAOjZ,EAAK,EAC7B,CACF,CAEAiY,OAAAA,GACEzD,KAAKmB,UAAU5V,QAAQsD,IACrB,IAAMA,EAAE+S,EAAE2B,QAAU1U,EAAE+S,EAAE2B,OAAOC,YAAY3U,EAAE+S,EAAI,CAAE,MAAO,CAC1D,IAAM/S,EAAE+S,EAAE6B,SAAW,CAAE,MAAO,IAEhCzD,KAAKmB,UAAY,EACnB,ECvJa,MAAMuD,GACnB3E,WAAAA,CAAYgB,EAAWC,EAAKC,GAC1BjB,KAAKe,UAAYA,EACjBf,KAAKgB,IAAMA,EACXhB,KAAKiB,aAAeA,GAAgB,KAAO,GAC3CjB,KAAKzT,MAAQyU,EAAIjX,SAAWiX,EAAIE,SAChClB,KAAKxT,OAASwU,EAAIhX,UAAYgX,EAAIE,SAClClB,KAAK2E,OAAS,GACd3E,KAAKoB,UAAY,EACjB,MAAMC,EAAOrB,KAAKzT,MAAQyT,KAAKxT,OAE/BwT,KAAK4E,UAAY5W,KAAKC,IAAI,IAAKD,KAAKuT,MAAMF,EAAO,MACnD,CAEAG,YAAAA,CAAaC,GACXzB,KAAKoB,UAAYpT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,GAC1D,CAEAE,QAAAA,GACE,MAAMC,EAAI,IAAIC,GAAAA,IACdD,EAAEf,QAEF,MAAMzC,EAAI,IAAsB,EAAhBpQ,KAAKkU,SACrBN,EAAEG,UAAU,SAAU,KACtBH,EAAEiD,WAAW,EAAG,EAAGzG,GACnBwD,EAAEK,UACF,MAAM5V,EAAI2B,KAAKkU,SAAWlC,KAAKzT,MACzBD,GAAK,GAAqB,GAAhB0B,KAAKkU,SACfC,EAAQ,GAAqB,GAAhBnU,KAAKkU,SAClB4C,EAAyB,GAAhB9W,KAAKkU,SAAgB,GACpCN,EAAEvV,EAAIA,EACNuV,EAAEtV,EAAIA,EACN0T,KAAKe,UAAUsB,SAAST,GACxB5B,KAAK2E,OAAOjZ,KAAK,CAAEkW,IAAGvV,IAAGC,IAAGG,GAAIqY,EAAOpY,GAAIyV,EAAOI,OAAO,EAAMwC,SAAS,EAAOC,KAAM,EAAKC,MAAO,OAAQC,OAAQ,GACnH,CAEA1C,MAAAA,CAAOC,GAELzC,KAAKwB,aAAaxB,KAAKiB,gBAGvB,MAAMyB,EAAO1U,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,MAChDuB,EAAS3U,KAAK4U,IAAIF,EAAM,MAC9B,IAAIG,EAAS7U,KAAKuT,MAAMvB,KAAK4E,UAAYjC,GACrCA,EAAS,GAAKE,EAAS,KAAIA,EAAS,IAExC,MAAMC,EAAUD,EAAS7C,KAAK2E,OAAOtG,OACrC,GAAIyE,EAAU,EAAG,CACf,MAAMC,EAAc,GACdC,EAAShV,KAAKC,IAAI,EAAGD,KAAKiV,KAAc,KAATJ,IAC/BK,EAAUlV,KAAKE,IAAI4U,EAASE,EAAQD,GAC1C,IAAK,IAAII,EAAI,EAAGA,EAAID,EAASC,IAAKnD,KAAK2B,UACzC,CAEA,GAAI3B,KAAK2E,OAAOtG,OAASwE,EAAQ,CAC/B,MAAMO,EAAUpD,KAAK2E,OAAOtG,OAASwE,EAC/BQ,EAASrV,KAAKE,IAAIkV,EAASpV,KAAKC,IAAI,EAAGD,KAAKiV,KAA0B,KAArBjD,KAAK2E,OAAOtG,UACnE,IAAK,IAAI8E,EAAI,EAAGA,EAAIE,EAAQF,IAAK,CAC/B,MAAMgC,EAAInF,KAAK2E,OAAOrB,MACtB,IAAK6B,EAAG,MACR,IAAMA,EAAEvD,EAAE2B,QAAU4B,EAAEvD,EAAE2B,OAAOC,YAAY2B,EAAEvD,EAAI,CAAE,MAAO,CAC1D,IAAMuD,EAAEvD,EAAE6B,SAAW,CAAE,MAAO,CAChC,CACF,CAEA,MACMC,EAAKjB,EAAO,IACZkB,EAAW,GAEjB,IAAK,IAAIR,EAAI,EAAGA,EAAInD,KAAK2E,OAAOtG,OAAQ8E,IAAK,CAC3C,MAAMgC,EAAInF,KAAK2E,OAAOxB,GACtB,GAAKgC,EAAE5C,MAAP,CAEA,GAAgB,SAAZ4C,EAAEF,MAAkB,CACtBE,EAAEzY,GAAKsB,KAAKE,IAAI,IAAKiX,EAAEzY,GATd,IAS0BgX,GAEnCyB,EAAE1Y,IAAmC,EAA7BuB,KAAKoX,IAAgB,KAAXD,EAAE7Y,EAAI6W,IAAiBO,EACzC,IAAIE,EAAKuB,EAAE9Y,EAAI8Y,EAAE1Y,GAAKiX,EAClBG,EAAKsB,EAAE7Y,EAAI6Y,EAAEzY,GAAKgX,EAGtB,IACE,GAA0C,oBAA/B1D,KAAKgB,IAAI8C,kBAAkC,CACpD,MAAMuB,EAAUrF,KAAKgB,IAAI8C,kBAAkB,QAASF,GACpD,GAAIlC,OAAOsC,SAASqB,IAAYxB,GAAMwB,EAAS,CAE7CxB,EAAKwB,EAAU,GACfF,EAAE9Y,EAAIuX,EAAIuB,EAAE7Y,EAAIuX,EAAIsB,EAAE1Y,GAAK,EAAG0Y,EAAEzY,GAAK,EACrCyY,EAAEF,MAAQ,OACVE,EAAED,OAAS,IAAsB,IAAhBlX,KAAKkU,SAGtBiD,EAAEvD,EAAEvV,EAAI8Y,EAAE9Y,EAAG8Y,EAAEvD,EAAEtV,EAAI6Y,EAAE7Y,EACvB,QACF,CACA,MAAMgZ,EAAStF,KAAKgB,IAAI8C,kBAAkB,OAAQF,GAClD,GAAIlC,OAAOsC,SAASsB,IAAWzB,GAAMyB,EAAQ,CAEN,oBAA1BtF,KAAKgB,IAAIoD,cAA6BpE,KAAKgB,IAAIoD,aAAa,CAAE/X,EAAGuX,EAAItX,EAAGgZ,EAAQrB,SAAU,KACrGkB,EAAE5C,OAAQ,EAAOoB,EAASjY,KAAKyX,GAAI,QACrC,CACF,CACF,CAAE,MAAO,CAGT,GAAInD,KAAKgB,IAAIqD,UAAUT,EAAIC,GAAK,CAE9B,IAAIS,EAAQ,EACZ,KAAOtE,KAAKgB,IAAIqD,UAAUT,EAAIC,IAAOS,EAAQ,IAAMT,GAAM,EAAGS,IAC5Da,EAAEJ,SAAU,EACZI,EAAE1Y,GAAK,EACP0Y,EAAEzY,GAAK,EACPyY,EAAEF,MAAQ,OACVE,EAAED,OAAS,IAAsB,IAAhBlX,KAAKkU,QACxB,CAEAiD,EAAE9Y,EAAIuX,EACNuB,EAAE7Y,EAAIuX,CACR,KAAuB,SAAZsB,EAAEF,OAEXE,EAAED,QAAUzC,EACR0C,EAAED,QAAU,IACdC,EAAEF,MAAQ,UAEVE,EAAE1Y,GAAsB,GAAhBuB,KAAKkU,SAAgB,GAC7BiD,EAAEzY,GAAK,GAAqB,GAAhBsB,KAAKkU,WAEE,YAAZiD,EAAEF,QAEXE,EAAEzY,GAAKsB,KAAKE,IAAI,GAAIiX,EAAEzY,GAAK6Y,GAAa7B,GACxCyB,EAAE9Y,GAAK8Y,EAAE1Y,GAAKiX,EACdyB,EAAE7Y,GAAK6Y,EAAEzY,GAAKgX,EACdyB,EAAEH,MAAQ,IAAOtB,EACbyB,EAAEH,MAAQ,IAAKG,EAAE5C,OAAQ,EAAOoB,EAASjY,KAAKyX,KAGpDgC,EAAEvD,EAAEvV,EAAI8Y,EAAE9Y,EACV8Y,EAAEvD,EAAEtV,EAAI6Y,EAAE7Y,GACM,SAAZ6Y,EAAEF,OAAgC,YAAZE,EAAEF,OAAuBE,EAAEJ,WAASI,EAAEvD,EAAE4D,MAAQxX,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGiX,EAAEH,SAEhGG,EAAE7Y,EAAI0T,KAAKxT,OAAS,IAAM2Y,EAAE9Y,GAAK,IAAM8Y,EAAE9Y,EAAI2T,KAAKzT,MAAQ,MAC5D4Y,EAAE5C,OAAQ,EACVoB,EAASjY,KAAKyX,GAvE4B,MAA5BQ,EAASjY,KAAKyX,EAyEhC,CAEA,IAAK,IAAIqB,EAAIb,EAAStF,OAAS,EAAGmG,GAAK,EAAGA,IAAK,CAC7C,MAAMhZ,EAAMmY,EAASa,GACfW,EAAInF,KAAK2E,OAAOnZ,GAEtB,GADI2Z,GAAKA,EAAEvD,GAAKuD,EAAEvD,EAAE2B,QAAQ4B,EAAEvD,EAAE2B,OAAOC,YAAY2B,EAAEvD,GACjDuD,GAAKA,EAAEvD,GAAKuD,EAAEvD,EAAE6B,QAAS,IAAM0B,EAAEvD,EAAE6B,SAAW,CAAE,MAAO,CAC3DzD,KAAK2E,OAAOF,OAAOjZ,EAAK,EAC1B,CACF,CAEAiY,OAAAA,GACEzD,KAAK2E,OAAOpZ,QAAQ4Z,IAClB,IAAMA,EAAEvD,EAAE2B,QAAU4B,EAAEvD,EAAE2B,OAAOC,YAAY2B,EAAEvD,EAAI,CAAE,MAAO,CAC1D,IAAMuD,EAAEvD,EAAE6B,SAAW,CAAE,MAAO,IAEhCzD,KAAK2E,OAAS,EAChB,ECjKa,MAAMc,GACnB1F,WAAAA,CAAYgB,EAAWC,EAAKC,GAC1BjB,KAAKe,UAAYA,EACjBf,KAAKgB,IAAMA,EACXhB,KAAKiB,aAAeA,GAAgB,KAAO,GAC3CjB,KAAKzT,MAAQyU,EAAIjX,SAAWiX,EAAIE,SAChClB,KAAKxT,OAASwU,EAAIhX,UAAYgX,EAAIE,SAClClB,KAAK0F,WAAa1X,KAAKC,IAAI,EAAGD,KAAKuT,MAAoB,GAAdvB,KAAKxT,SAC9CwT,KAAK2F,QAAU,GACf3F,KAAKoB,UAAY,EAGjB,IACEpB,KAAKe,UAAU6E,QAAU,CAAC,IAAIC,GAAAA,IAAW,CAAE5B,SAAU,EAAK6B,QAAS,IACrE,CAAE,MAAO,CAET9F,KAAK+F,SACP,CAEAvE,YAAAA,CAAaC,GACX,MAAMuE,EAAKhY,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,IAC9CuE,IAAOhG,KAAKoB,YAChBpB,KAAKoB,UAAY4E,EACjBhG,KAAK+F,UACP,CAEAA,OAAAA,GAEE,IAAK,MAAMlX,KAAKmR,KAAK2F,QAAS,CAC5B,IAAM9W,EAAE+S,EAAE2B,QAAU1U,EAAE+S,EAAE2B,OAAOC,YAAY3U,EAAE+S,EAAI,CAAE,MAAO,CAC1D,IAAM/S,EAAE+S,EAAE6B,SAAW,CAAE,MAAO,CAChC,CACAzD,KAAK2F,QAAU,GAEf,MAAMM,EAAQjY,KAAK0I,MAAOsJ,KAAKoB,UAAY,IAAO,IAClD,IAAK,IAAI+B,EAAI,EAAGA,EAAI8C,EAAO9C,IAAK,CAC9B,MAAMvB,EAAI,IAAIC,GAAAA,IACRqE,EAAI,IAAsB,IAAhBlY,KAAKkU,SACfiE,EAAI,GAAqB,IAAhBnY,KAAKkU,SACd7V,EAAI2B,KAAKkU,UAAYlC,KAAKzT,MAAQ,KAAO,IACzCD,EAAU0B,KAAKkU,UAAYlC,KAAK0F,WAAa,IAAxC,GACLF,EAAQ,IAAQxF,KAAKoB,UAAY,KAAQ,IAAuB,IAAhBpT,KAAKkU,UACrDC,EAAQ,EAAoB,GAAhBnU,KAAKkU,SACjBxV,EAA6B,GAAvBsB,KAAKkU,SAAW,IAG5BN,EAAEG,UAAU,SAAU,GACtB,MAAMqE,EAAS,GAAJF,EACLG,EAAS,GAAJF,EACLG,EAAU,EAAItY,KAAKuT,MAAsB,EAAhBvT,KAAKkU,UAC9BqE,EAA2B,IAAnBvY,KAAKE,IAAIkY,EAAIC,GAC3B,IAAK,IAAIG,EAAI,EAAGA,EAAIF,EAASE,IAAK,CAChC,MAAM1M,EAAK0M,EAAIF,EAAWtY,KAAKyY,GAAK,EAAoB,GAAhBzY,KAAKkU,SACvCwE,EAAO,GAAsB,IAAhB1Y,KAAKkU,SAClByE,EAAK3Y,KAAK4Y,IAAI9M,GAAKsM,EAAKM,EACxBG,EAAK7Y,KAAKoX,IAAItL,GAAKuM,EAAKK,EACxBtI,EAAImI,GAAS,GAAsB,GAAhBvY,KAAKkU,UAC9BN,EAAEiD,WAAW8B,EAAIE,EAAIzI,EACvB,CAEAwD,EAAEiD,WAAW,EAAG,EAAG0B,GAAS,GAAsB,GAAhBvY,KAAKkU,WACvCN,EAAEK,UACFL,EAAE4D,MAAQA,EACV5D,EAAEvV,EAAIA,EACNuV,EAAEtV,EAAIA,EACN0T,KAAKe,UAAUsB,SAAST,GACxB5B,KAAK2F,QAAQja,KAAK,CAAEkW,IAAGsE,IAAGC,IAAG1Z,GAAI0V,GAASnU,KAAKkU,SAAW,IAAO,EAAI,GAAIxV,KAAI8Y,QAAOP,MAAOjX,KAAKkU,SAAWlU,KAAKyY,GAAK,GACvH,CACF,CAEAjE,MAAAA,CAAOC,GAEL,MAAMqE,EAAM9Y,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK8R,KAAKiB,iBACvC6F,IAAQ9G,KAAKoB,WAAWpB,KAAKwB,aAAasF,GAE9C,MAAMpD,EAAKjB,EAAO,IACZsE,EAAI/G,KAAKzT,MAETya,EAAahH,KAAK0F,WAAa,GACrC,IAAK,MAAM7W,KAAKmR,KAAK2F,QAAS,CAE5B9W,EAAE+S,EAAEvV,GAAKwC,EAAEpC,GAAKiX,EAChB7U,EAAE+S,EAAEtV,GAAKuC,EAAEnC,GAAKgX,EAGhB7U,EAAEoW,OAAc,IAALvB,EACX,MAAMuD,EAAgC,IAAzBjZ,KAAKoX,IAAIvW,EAAEoW,OAAS,GACjCpW,EAAE+S,EAAE4D,MAAQxX,KAAKC,IAAI,IAAMD,KAAKE,IAAI,IAAMW,EAAE2W,OAAS,IAAO,GAAMyB,KAG9DpY,EAAE+S,EAAEvV,GAAK,MAAKwC,EAAE+S,EAAEvV,EAAI0a,EAAI,KAC1BlY,EAAE+S,EAAEvV,EAAI0a,EAAI,MAAKlY,EAAE+S,EAAEvV,GAAK,KAE1BwC,EAAE+S,EAAEtV,GAhBM,MAgBOuC,EAAE+S,EAAEtV,EAAI0a,GACzBnY,EAAE+S,EAAEtV,EAAI0a,IAAYnY,EAAE+S,EAAEtV,GAjBd,IAkBhB,CACF,CAEAmX,OAAAA,GACE,IAAMzD,KAAKe,UAAU6E,QAAU,EAAI,CAAE,MAAO,CAC5C,IAAK,MAAM/W,KAAKmR,KAAK2F,QAAS,CAC5B,IAAM9W,EAAE+S,EAAE2B,QAAU1U,EAAE+S,EAAE2B,OAAOC,YAAY3U,EAAE+S,EAAI,CAAE,MAAO,CAC1D,IAAM/S,EAAE+S,EAAE6B,SAAW,CAAE,MAAO,CAChC,CACAzD,KAAK2F,QAAU,EACjB,ECxGa,MAAMuB,GACnBnH,WAAAA,CAAYgB,EAAWC,EAAKC,GAC1BjB,KAAKe,UAAYA,EACjBf,KAAKgB,IAAMA,EACXhB,KAAKiB,aAAeA,GAAgB,KAAO,GAC3CjB,KAAKzT,MAAQyU,EAAIjX,SAAWiX,EAAIE,SAChClB,KAAKxT,OAASwU,EAAIhX,UAAYgX,EAAIE,SAClClB,KAAKoB,UAAY,EACjBpB,KAAK9D,KAAO,EAGZ8D,KAAK4B,EAAI,IAAIC,GAAAA,IACb7B,KAAKe,UAAUsB,SAASrC,KAAK4B,GAG7B5B,KAAKmH,SAAWD,GAAWE,oBAAoB,IAAK,KACpDpH,KAAKqH,OAAS,IAAIC,GAAAA,IAAatH,KAAKmH,SAAUnH,KAAKzT,MAAOyT,KAAKxT,QAC/DwT,KAAKuH,OAAS,IAAID,GAAAA,IAAatH,KAAKmH,SAAUnH,KAAKzT,MAAOyT,KAAKxT,QAE/DwT,KAAKqH,OAAOG,UAAU9G,IAAI,EAAK,GAC/BV,KAAKuH,OAAOC,UAAU9G,IAAI,GAAK,IAE/BV,KAAKqH,OAAO7B,MAAQ,EACpBxF,KAAKuH,OAAO/B,MAAQ,EACpBxF,KAAKe,UAAUsB,SAASrC,KAAKqH,QAC7BrH,KAAKe,UAAUsB,SAASrC,KAAKuH,QAG7BvH,KAAKyH,gBACLzH,KAAK0H,OACP,CAEAC,mBAAAA,CAAoBlG,GAClB,MAAM3H,EAAI9L,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,IAAM,IACvD,OAAOzT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAU,IAAJ4L,GACpC,CAEA0H,YAAAA,CAAaC,GACX,MAAMuE,EAAKhY,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,IAC9CuE,IAAOhG,KAAKoB,YAChBpB,KAAKoB,UAAY4E,EACjBhG,KAAKyH,gBACLzH,KAAK4H,aAAa,GAClB5H,KAAK0H,QACP,CAEAG,MAAAA,CAAOtb,EAAOC,GACZ,MAAM0Z,EAAIlY,KAAKC,IAAI,EAAGD,KAAKuT,MAAMhV,IAC3B4Z,EAAInY,KAAKC,IAAI,EAAGD,KAAKuT,MAAM/U,IAC7B0Z,IAAMlG,KAAKzT,OAAS4Z,IAAMnG,KAAKxT,SACnCwT,KAAKzT,MAAQ2Z,EACblG,KAAKxT,OAAS2Z,EAEVnG,KAAKqH,SAAUrH,KAAKqH,OAAO9a,MAAQ2Z,EAAGlG,KAAKqH,OAAO7a,OAAS2Z,GAC3DnG,KAAKuH,SAAUvH,KAAKuH,OAAOhb,MAAQ2Z,EAAGlG,KAAKuH,OAAO/a,OAAS2Z,GAC/DnG,KAAK0H,QACP,CAEAA,KAAAA,GACE,MAAMxB,EAAIlG,KAAKzT,MACT4Z,EAAInG,KAAKxT,OACToV,EAAI5B,KAAK4B,EACfA,EAAEf,QACF,MAAMiH,EAAY9H,KAAK2H,oBAAoB3H,KAAKoB,WAC5C0G,GAAa,EACflG,EAAE4D,MAAQ,GAIZ5D,EAAEG,UAAU,SAAU,GACtBH,EAAEI,SAAS,EAAG,EAAGkE,EAAGC,GACpBvE,EAAEK,UACFL,EAAE4D,MAAQsC,EACZ,CAEAtF,MAAAA,CAAOC,GAEL,MAAMqE,EAAM9Y,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK8R,KAAKiB,iBACvC6F,IAAQ9G,KAAKoB,WAAWpB,KAAKwB,aAAasF,GAG9C,MAAMpD,EAAK1V,KAAKC,IAAI,EAAGyT,OAAOe,IAAS,OACvCzC,KAAK9D,MAAQwH,EAEb,MAAMqE,EAAQ,EAAI,IAAO/Z,KAAKoX,IAAgB,MAAZpF,KAAK9D,MACvC8D,KAAK4H,aAAaG,GAGd/H,KAAKqH,SACPrH,KAAKqH,OAAOW,aAAa3b,GAAK2T,KAAKiI,OAAO5b,EAAIqX,EAC9C1D,KAAKqH,OAAOW,aAAa1b,GAAK0T,KAAKiI,OAAO3b,EAAIoX,GAE5C1D,KAAKuH,SACPvH,KAAKuH,OAAOS,aAAa3b,GAAK2T,KAAKkI,OAAO7b,EAAIqX,EAC9C1D,KAAKuH,OAAOS,aAAa1b,GAAK0T,KAAKkI,OAAO5b,EAAIoX,EAElD,CAEAD,OAAAA,GACE,GAAIzD,KAAK4B,EAAG,CACV,IAAM5B,KAAK4B,EAAE2B,QAAUvD,KAAK4B,EAAE2B,OAAOC,YAAYxD,KAAK4B,EAAI,CAAE,MAAO,CACnE,IAAM5B,KAAK4B,EAAE6B,SAAW,CAAE,MAAO,CACnC,CACAzD,KAAK4B,EAAI,KACT,IACM5B,KAAKqH,SAAUrH,KAAKqH,OAAO9D,QAAUvD,KAAKqH,OAAO9D,OAAOC,YAAYxD,KAAKqH,QAASrH,KAAKqH,OAAO5D,SAAQ,GAC5G,CAAE,MAAO,CACT,IACMzD,KAAKuH,SAAUvH,KAAKuH,OAAOhE,QAAUvD,KAAKuH,OAAOhE,OAAOC,YAAYxD,KAAKuH,QAASvH,KAAKuH,OAAO9D,SAAQ,GAC5G,CAAE,MAAO,CACTzD,KAAKqH,OAAS,KACdrH,KAAKuH,OAAS,KACd,IAAMvH,KAAKmH,UAAU1D,SAAQ,EAAO,CAAE,MAAO,CAC7CzD,KAAKmH,SAAW,IAClB,CAEAS,YAAAA,CAAaO,EAAc,GACzB,MAAMtR,EAAOmJ,KAAK2H,oBAAoB3H,KAAKoB,WAGrCgH,EAAavR,GAAQ,IAAO,IADxB7I,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,OAE/CpB,KAAK4B,IAAG5B,KAAK4B,EAAE4D,MAAQ3O,EAAOsR,GAC9BnI,KAAKqH,SAAQrH,KAAKqH,OAAO7B,MAAqB,GAAb4C,GACjCpI,KAAKuH,SAAQvH,KAAKuH,OAAO/B,MAAQ4C,EACvC,CAEAX,aAAAA,GAEE,MAAM3N,EAAI9L,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,MAC7CiH,EAAOA,CAACC,EAAGC,EAAGC,IAAMF,GAAKC,EAAID,GAAKE,EAExCxI,KAAKiI,OAAS,CAAE5b,EAAGgc,EAAK,KAAO,KAAOvO,GAAIxN,EAAG+b,EAAK,EAAK,KAAOvO,IAC9DkG,KAAKkI,OAAS,CAAE7b,EAAGgc,GAAM,MAAQ,KAAOvO,GAAIxN,EAAG+b,EAAK,KAAO,IAAMvO,GACnE,CAGA,0BAAOsN,CAAoBlB,EAAI,IAAKC,EAAI,KACtC,MAAMsC,EAASC,SAASC,cAAc,UACtCF,EAAOlc,MAAQ2Z,EAAGuC,EAAOjc,OAAS2Z,EAClC,MAAMyC,EAAMH,EAAOI,WAAW,MACxBC,EAAMF,EAAIG,gBAAgB7C,EAAGC,GAEnC,IAAK,IAAIhD,EAAI,EAAGA,EAAI2F,EAAIxL,KAAKe,OAAQ8E,GAAK,EAAG,CAC3C,MAAM1B,EAAI,IAAMzT,KAAKuT,MAAsB,GAAhBvT,KAAKkU,UAChC4G,EAAIxL,KAAK6F,GAAK1B,EACdqH,EAAIxL,KAAK6F,EAAI,GAAK1B,EAClBqH,EAAIxL,KAAK6F,EAAI,GAAK1B,EAClBqH,EAAIxL,KAAK6F,EAAI,GAAK,GACpB,CAEA,OADAyF,EAAII,aAAaF,EAAK,EAAG,GAClBtI,GAAAA,IAAQC,KAAKgI,EACtB,EClJa,MAAMQ,GACnBlJ,WAAAA,CAAYgB,EAAWC,EAAKC,GAC1BjB,KAAKe,UAAYA,EACjBf,KAAKgB,IAAMA,GAAO,CAAC,EACnBhB,KAAKiB,aAAeA,GAAgB,KAAO,GAC3CjB,KAAKzT,OAASyU,GAAKjX,UAAY,IAAMiX,GAAKE,UAAY,IACtDlB,KAAKxT,QAAUwU,GAAKhX,WAAa,IAAMgX,GAAKE,UAAY,IAExDlB,KAAKoB,UAAY,EACjBpB,KAAK9D,KAAO,EACZ8D,KAAKkJ,aAAeC,IACpBnJ,KAAKoJ,WAAa,EAClBpJ,KAAKqJ,WAAa,EAClBrJ,KAAKsJ,WAAY,EACjBtJ,KAAKuJ,SAAW,EAChBvJ,KAAKwJ,aAAe,EAGpBxJ,KAAKyJ,OAAS,IAAI5H,GAAAA,IAClB7B,KAAK0J,MAAQ,IAAI7H,GAAAA,IAEjB,IACE7B,KAAK0J,MAAM9D,QAAU,CAAC,IAAIC,GAAAA,IAAW,EAAG,GAC1C,CAAE,MAAO,CACT7F,KAAKe,UAAUsB,SAASrC,KAAKyJ,QAC7BzJ,KAAKe,UAAUsB,SAASrC,KAAK0J,OAG7B1J,KAAK2J,qBAAoB,EAC3B,CAEAnI,YAAAA,CAAaC,GACX,MAAMuE,EAAKhY,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,IAC9CuE,IAAOhG,KAAKoB,YAChBpB,KAAKoB,UAAY4E,EACbA,GAAM,GAERhG,KAAKoJ,WAAa,EAClBpJ,KAAKsJ,WAAY,EACjBtJ,KAAK4J,eACL5J,KAAK6J,aACL7J,KAAKkJ,aAAeC,KACVzH,OAAOsC,SAAShE,KAAKkJ,eAAiBlJ,KAAKkJ,eAAiBC,KACtEnJ,KAAK2J,qBAAoB,GAE7B,CAEA9B,MAAAA,CAAO3B,EAAGC,GACR,MAAMY,EAAI/Y,KAAKC,IAAI,EAAGD,KAAKuT,MAAM2E,IAC3B4D,EAAI9b,KAAKC,IAAI,EAAGD,KAAKuT,MAAM4E,IAC7BY,IAAM/G,KAAKzT,OAASud,IAAM9J,KAAKxT,SACnCwT,KAAKzT,MAAQwa,EACb/G,KAAKxT,OAASsd,EAEV9J,KAAKoJ,WAAa,GAAGpJ,KAAK4J,eAChC,CAEApH,MAAAA,CAAOC,GAEL,MAAMsH,EAAS/b,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK8R,KAAKiB,iBAC1C8I,IAAW/J,KAAKoB,WAAWpB,KAAKwB,aAAauI,GAEjD,MAAMrG,EAAK1V,KAAKC,IAAI,EAAGyT,OAAOe,IAAS,OACvC,KAAIzC,KAAKoB,WAAa,GAAtB,CAYA,GATApB,KAAKkJ,cAAgBxF,EACjB1D,KAAKkJ,cAAgB,IAEvBlJ,KAAKgK,gBACLhK,KAAKiK,cACLjK,KAAK2J,qBAAoB,IAIvB3J,KAAKoJ,WAAa,EAAG,CAEvB,MAAMc,EAAalK,KAAKqJ,YAAc,KACtCrJ,KAAKoJ,WAAapb,KAAKC,IAAI,EAAG+R,KAAKoJ,WAAac,EAAaxG,GAC7D1D,KAAK4J,cACP,CAGA,GAAI5J,KAAKsJ,UAAW,CAClBtJ,KAAKuJ,UAAY7F,EACjB,MAAM5J,EAAIkG,KAAKuJ,SAAWvb,KAAKC,IAAI,EAAG+R,KAAKwJ,cAErCW,EAASnc,KAAKC,IAAI,EAAG,EAAI6L,GAC/BkG,KAAK0J,MAAMlE,MAAQ,IAAO,IAAO2E,EAC7BnK,KAAKuJ,UAAYvJ,KAAKwJ,cACxBxJ,KAAK6J,YAET,CA7B+B,CA8BjC,CAEApG,OAAAA,GACE,IAAMzD,KAAKyJ,OAAOlG,QAAUvD,KAAKyJ,OAAOlG,OAAOC,YAAYxD,KAAKyJ,OAAS,CAAE,MAAO,CAClF,IAAMzJ,KAAKyJ,OAAOhG,SAAQ,EAAO,CAAE,MAAO,CAC1C,IAAMzD,KAAK0J,MAAMnG,QAAUvD,KAAK0J,MAAMnG,OAAOC,YAAYxD,KAAK0J,MAAQ,CAAE,MAAO,CAC/E,IAAM1J,KAAK0J,MAAMjG,SAAQ,EAAO,CAAE,MAAO,CACzCzD,KAAKyJ,OAAS,KACdzJ,KAAK0J,MAAQ,KACb1J,KAAKe,UAAY,IACnB,CAGA4I,mBAAAA,CAAoBS,GAElB,GAAIpK,KAAKoB,WAAa,EAAmC,YAA9BpB,KAAKkJ,aAAeC,KAC/C,MAAMrP,EAAI9L,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,MAC7CiJ,EAAWrK,KAAKsK,MAAM,IAAM,KAAM,EAAIxQ,GACtCyQ,EAAWvK,KAAKsK,MAAM,KAAM,IAAM,EAAIxQ,GACtC0Q,EAAQxK,KAAKyK,MAAMJ,EAAUE,GACnCvK,KAAKkJ,aAAekB,EAAUpK,KAAKyK,MAAM,IAAK,MAAQD,CACxD,CAEAR,aAAAA,GAEE,MAAMlQ,EAAI9L,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,MAC7CvK,EAAOmJ,KAAKsK,MAAM,IAAM,GAAKxQ,GACnCkG,KAAKoJ,WAAapb,KAAKE,IAAI,EAAG2I,EAAOmJ,KAAKyK,MAAM,GAAK,IAErDzK,KAAKqJ,WAAarJ,KAAKsK,MAAM,KAAO,KAAOxQ,GAC3CkG,KAAK4J,cACP,CAEAA,YAAAA,GACE,MAAMhI,EAAI5B,KAAKyJ,OACf7H,EAAEf,QACEb,KAAKoJ,YAAc,IACvBxH,EAAEG,UAAU,SAAU/B,KAAKoJ,YAC3BxH,EAAEI,SAAS,EAAG,EAAGhC,KAAKzT,MAAOyT,KAAKxT,QAClCoV,EAAEK,UACJ,CAEAgI,WAAAA,GAEE,MAAMlD,EAAI/G,KAAKzT,MAAOud,EAAI9J,KAAKxT,OACzBH,EAAI2B,KAAKuT,MAAMvB,KAAKyK,MAAM,EAAG1D,EAAI,IACjC2D,GAAQ1c,KAAKuT,MAAMvB,KAAKyK,MAAM,GAAI,KAClCE,EAAU3K,KAAK4K,aAAave,EAAGyd,GAC/Be,EAAOnJ,OAAOsC,SAAS2G,GAAW3c,KAAKC,IAAI,EAAG0c,EAAU3K,KAAKyK,MAAM,EAAG,KAAOzc,KAAKuT,MAAU,GAAJuI,GAGxFgB,EAAW9c,KAAKC,IAAI,EAAGD,KAAKuT,OAAOsJ,EAAOH,GAAQ1K,KAAKyK,MAAM,GAAI,MACjEM,EAAU/K,KAAKsK,MAAM,EAAG,GAAItc,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,OACrE4J,EAAS,GACf,IAAIrE,EAAKta,EACLwa,EAAK6D,EACTM,EAAOtf,KAAK,CAAEW,EAAGsa,EAAIra,EAAGua,IACxB,IAAK,IAAI1D,EAAI,EAAGA,GAAK2H,EAAU3H,IAAK,CAClC,MAAMU,EAAK6G,EAAO1c,KAAKuT,OAAQsJ,EAAOH,GAAQvH,EAAK2H,GAEnDnE,EADWta,EAAI2T,KAAKyK,OAAOM,EAASA,GAC3BlE,EAAKhD,EACdmH,EAAOtf,KAAK,CAAEW,EAAGsa,EAAIra,EAAGua,GAC1B,CAGA,MAAMjF,EAAI5B,KAAK0J,MACf9H,EAAEf,QACF,MAAMoK,EAAYjL,KAAKsK,MAAM,EAAG,EAAGtc,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,OACtE8J,EAAQ,SACdtJ,EAAEE,UAAU,CAAEvV,MAAO0e,EAAWC,QAAO1F,MAAO,EAAG2F,UAAW,GAAKC,IAAK,QAASC,KAAM,UACrFzJ,EAAE0J,OAAON,EAAO,GAAG3e,EAAG2e,EAAO,GAAG1e,GAChC,IAAK,IAAI6W,EAAI,EAAGA,EAAI6H,EAAO3M,OAAQ8E,IAAKvB,EAAE2J,OAAOP,EAAO7H,GAAG9W,EAAG2e,EAAO7H,GAAG7W,GAGxE,MAAMkf,EAAcxd,KAAKuT,MAAMvB,KAAKsK,MAAM,EAAG,EAAGtc,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKoB,UAAY,QACzF,IAAK,IAAImH,EAAI,EAAGA,EAAIiD,EAAajD,IAAK,CACpC,MACM1Z,EAAImc,EADEhd,KAAKuT,MAAMvB,KAAKyK,MAAM,EAAGO,EAAO3M,OAAS,KAE/CoN,EAAMzL,KAAKyK,MAAM,GAAI,IACrBiB,EAAM1L,KAAKyK,MAAiB,IAAVzc,KAAKyY,GAAoB,GAAVzY,KAAKyY,IACtCkF,EAAK9c,EAAExC,EAAI2B,KAAK4Y,IAAI8E,GAAOD,EAC3BG,EAAK/c,EAAEvC,EAAI0B,KAAKoX,IAAIsG,GAAOD,EACjC7J,EAAEE,UAAU,CAAEvV,MAAOyB,KAAKC,IAAI,EAAe,IAAZgd,GAAmBC,QAAO1F,MAAO,GAAK2F,UAAW,KAClFvJ,EAAE0J,OAAOzc,EAAExC,EAAGwC,EAAEvC,GAChBsV,EAAE2J,OAAOI,EAAIC,EACf,CAEA5L,KAAKsJ,WAAY,EACjBtJ,KAAKuJ,SAAW,EAChBvJ,KAAKwJ,aAAexJ,KAAKyK,MAAM,IAAK,KACpCzK,KAAK0J,MAAMlE,MAAQ,CACrB,CAEAqE,UAAAA,GACE,GAAK7J,KAAK0J,MAAV,CACA1J,KAAKsJ,WAAY,EACjBtJ,KAAKuJ,SAAW,EAChBvJ,KAAKwJ,aAAe,EACpB,IAAMxJ,KAAK0J,MAAM7I,OAAS,CAAE,MAAO,CAJZ,CAKzB,CAEA+J,YAAAA,CAAaiB,EAAQC,GAEnB,MAAMC,EAAU/L,KAAKgB,KAAKqD,UAC1B,GAAuB,oBAAZ0H,EAAwB,OAAO,KAC1C,IAAK,IAAIzf,EAAI,EAAGA,EAAIwf,EAAMxf,GAAK,EAC7B,GAAIyf,EAAQF,EAAQvf,GAClB,OAAOA,EAGX,OAAO,IACT,CAEAme,KAAAA,CAAMnC,EAAGC,GAEP,YADUtd,IAANsd,IAAmBA,EAAID,EAAGA,EAAI,GAC3BA,EAAIta,KAAKkU,UAAYqG,EAAID,EAClC,CAEAgC,KAAAA,CAAMhC,EAAGC,EAAGzO,GAAK,OAAOwO,GAAKC,EAAID,GAAKxO,CAAG,ECnN5B,MAAMkS,GACnBjM,WAAAA,CAAYgB,GACVf,KAAKe,UAAYA,EACjBf,KAAKiM,KAAO,IAAIC,GAAAA,IAChBlM,KAAKe,UAAUsB,SAASrC,KAAKiM,MAC7BjM,KAAKmM,SAAW,GAChBnM,KAAKoM,MAAQ,GACbpM,KAAKqM,YAAc,GACnBrM,KAAKsM,SAAW,CAClB,CAEA7I,OAAAA,GACE,IAAMzD,KAAKiM,KAAK1I,QAAUvD,KAAKiM,KAAK1I,OAAOC,YAAYxD,KAAKiM,KAAO,CAAE,MAAO,CAC5E,IAAMjM,KAAKiM,KAAKxI,QAAQ,CAAEhJ,UAAU,GAAS,CAAE,MAAO,CACtDuF,KAAKiM,KAAO,KACZjM,KAAKmM,SAAW,GAChBnM,KAAKoM,MAAQ,EACf,CAEAvE,MAAAA,GAAU,CAEV0E,OAAAA,EAAQ,EAAElgB,EAAI,EAAC,EAAEC,EAAI,EAAC,SAAE2X,EAAW,EAAC,OAAEuI,GAAS,GAAU,CAAC,GACxD,MAAMC,EAAIze,KAAKC,IAAI,GAAKD,KAAKE,IAAI,EAAGwT,OAAOuC,IAAa,IAExD,GAAIjE,KAAKoM,MAAM/N,OAAS2B,KAAKsM,SAAU,CACrC,MAAM1K,EAAI,IAAIC,GAAAA,IACdD,EAAEvV,EAAI,EAAGuV,EAAEtV,EAAI,EAAGsV,EAAE4D,MAAQ,GAC5BxF,KAAKiM,KAAK5J,SAAST,GACnB5B,KAAKoM,MAAM1gB,KAAK,CAAEkW,IAAGvV,IAAGC,IAAG8R,EAAG,EAAI,EAAIqO,EAAGC,GAAI,IAAO,IAAOD,EAAGzH,KAAM,EAAG/W,IAAK,IAAM,IAAMwe,GAC1F,CAEA,MAAMxG,EAAQjY,KAAKuT,MAAM,EAAI,GAAKkL,GAClC,IAAK,IAAItJ,EAAI,EAAGA,EAAI8C,GAASjG,KAAKmM,SAAS9N,OAAS2B,KAAKqM,YAAalJ,IAAK,CACzE,MAAMuI,EAAMc,EAAqB,KAAVxe,KAAKyY,GAAYzY,KAAKkU,SAAWlU,KAAKyY,GAAK,GAAkB,GAAVzY,KAAKyY,IAAYzY,KAAKkU,SAAW,IAAOlU,KAAKyY,GAAK,GACtHkG,GAAO,IAAuB,IAAhB3e,KAAKkU,WAAoBsK,EAAS,IAAM,IAAM,GAAM,GAAMC,GACxE7K,EAAI,IAAIC,GAAAA,IACdD,EAAEvV,EAAI,EAAGuV,EAAEtV,EAAI,EAAGsV,EAAE4D,MAAQ,EAC5BxF,KAAKiM,KAAK5J,SAAST,GACnB5B,KAAKmM,SAASzgB,KAAK,CAAEkW,IAAGvV,IAAGC,IAAGG,GAAIuB,KAAK4Y,IAAI8E,GAAOiB,EAAKjgB,GAAIsB,KAAKoX,IAAIsG,GAAOiB,EAAK3H,KAAM,EAAG/W,IAAK,IAAsB,IAAhBD,KAAKkU,UAC3G,CACF,CAEAM,MAAAA,CAAOC,GACL,MAAMiB,EAAK1V,KAAKC,IAAI,EAAGyT,OAAOe,IAAS,OAEvC,IAAK,IAAIU,EAAInD,KAAKmM,SAAS9N,OAAS,EAAG8E,GAAK,EAAGA,IAAK,CAClD,MAAMyJ,EAAI5M,KAAKmM,SAAShJ,GACxByJ,EAAE5H,MAAQtB,EACVkJ,EAAElgB,IAAM,MAASgX,EACjBkJ,EAAEvgB,GAAKugB,EAAEngB,GAAKiX,EACdkJ,EAAEtgB,GAAKsgB,EAAElgB,GAAKgX,EACd,MAAM5J,EAAI9L,KAAKE,IAAI,EAAG0e,EAAE5H,KAAO4H,EAAE3e,KAC3BuX,EAAQ,EAAI1L,EACZ+S,EAAO,EAAI,KAAO,EAAI/S,GACtB8H,EAAIgL,EAAEhL,EAIZ,GAJeA,EAAEf,QACjBe,EAAEG,UAAU,SAAU/T,KAAKC,IAAI,EAAGuX,IAClC5D,EAAEiD,WAAW+H,EAAEvgB,EAAGugB,EAAEtgB,EAAGugB,GACvBjL,EAAEK,UACE2K,EAAE5H,MAAQ4H,EAAE3e,IAAK,CACnB,IAAM2T,EAAE2B,QAAU3B,EAAE2B,OAAOC,YAAY5B,EAAI,CAAE,MAAO,CACpD,IAAMA,EAAE6B,SAAW,CAAE,MAAO,CAC5BzD,KAAKmM,SAAS1H,OAAOtB,EAAG,EAC1B,CACF,CAEA,IAAK,IAAIA,EAAInD,KAAKoM,MAAM/N,OAAS,EAAG8E,GAAK,EAAGA,IAAK,CAC/C,MAAM/E,EAAI4B,KAAKoM,MAAMjJ,GACrB/E,EAAE4G,MAAQtB,EACVtF,EAAEA,GAAKA,EAAEsO,GAAKhJ,EACd,MACM8B,EAAQ,IAAO,EADXxX,KAAKE,IAAI,EAAGkQ,EAAE4G,KAAO5G,EAAEnQ,MAE3B2T,EAAIxD,EAAEwD,EAGZ,GAHeA,EAAEf,QACjBe,EAAEE,UAAU,CAAEvV,MAAO,IAAK2e,MAAO,SAAU1F,MAAOxX,KAAKC,IAAI,EAAGuX,KAC9D5D,EAAEiD,WAAWzG,EAAE/R,EAAG+R,EAAE9R,EAAG8R,EAAEA,GACrBA,EAAE4G,MAAQ5G,EAAEnQ,IAAK,CACnB,IAAM2T,EAAE2B,QAAU3B,EAAE2B,OAAOC,YAAY5B,EAAI,CAAE,MAAO,CACpD,IAAMA,EAAE6B,SAAW,CAAE,MAAO,CAC5BzD,KAAKoM,MAAM3H,OAAOtB,EAAG,EACvB,CACF,CACF,EC/Ea,MAAM2J,GACnB/M,WAAAA,CAAYgB,EAAWC,EAAKC,GAC1BjB,KAAKe,UAAYA,EACjBf,KAAKgB,IAAMA,GAAO,CAAC,EACnBhB,KAAKiB,aAAeA,GAAgB,KAAO,GAC3CjB,KAAKiM,KAAO,IAAIC,GAAAA,IAChBlM,KAAKe,UAAUsB,SAASrC,KAAKiM,MAC7BjM,KAAKoB,UAAY,EACjBpB,KAAK9D,KAAO,EACZ8D,KAAK+M,SAAW,EAChB/M,KAAKgN,OAAS,GACdhN,KAAKiN,UAAY,GACjBjN,KAAKkN,SAAW,EAClB,CAEAzJ,OAAAA,GACE,IAAMzD,KAAKiM,KAAK1I,QAAUvD,KAAKiM,KAAK1I,OAAOC,YAAYxD,KAAKiM,KAAO,CAAE,MAAO,CAC5E,IAAMjM,KAAKiM,KAAKxI,QAAQ,CAAEhJ,UAAU,GAAS,CAAE,MAAO,CACtDuF,KAAKgN,OAAS,GACdhN,KAAKkN,SAAW,EAClB,CAEA1L,YAAAA,CAAaC,GACX,MAAMuE,EAAKhY,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAOD,IAAM,IAClDzB,KAAKoB,UAAY4E,CACnB,CAEA6B,MAAAA,GAAU,CAEVsF,eAAAA,EAAgB,SAAEpjB,EAAQ,UAAEC,EAAS,SAAEkX,EAAQ,YAAExX,EAAW,cAAE0jB,IAC5D,MAAMC,EAAUzkB,GAAOgV,MAAMC,QAAQuP,GAAiBA,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOA,GAAM,KACvF0kB,EAAUC,MAAWA,GAAOA,EAAIC,OAASD,EAAIC,MAAMC,MACnD1G,EAAIhd,EAAU+f,EAAI9f,EAAW0jB,EAAKxM,EAClCyM,EAAQ,GACd,IAAK,IAAIC,EAAK,EAAGA,EAAK9D,EAAG8D,IAAM,CAC7B,IAAIC,GAAY,EAChB,IAAK,IAAIC,EAAK,EAAGA,EAAK/G,EAAG+G,IAAM,CAC7B,MACMllB,EAAKc,EADCkkB,EAAK7G,EAAI+G,GAErB,IAAKllB,EAAI,EAAoB,IAAdilB,IAAmBA,GAAY,GAAK,QAAU,CAC7D,MAAMN,EAAMF,EAAOzkB,GAEbmlB,EAAYH,EAAK,GAAKN,EAAOD,EAAO3jB,GADxBkkB,EAAK,GAAK7G,EAAI+G,KAIhC,GAFiBR,EAAOC,KACOQ,GAEX,IAAdF,IAAiBA,EAAWC,QAEhC,IAAkB,IAAdD,EAAiB,CACnB,MAAM3H,GAAK4H,EAAKD,GAAYH,EACxBxH,EAAI,GAAGyH,EAAMjiB,KAAK,CAAEW,EAAGwhB,EAAWH,EAAIphB,EAAGshB,EAAKF,EAAIxH,MACtD2H,GAAY,CACd,CAEJ,CACA,IAAkB,IAAdA,EAAiB,CACnB,MAAM3H,GAAKa,EAAI8G,GAAYH,EACvBxH,EAAI,GAAGyH,EAAMjiB,KAAK,CAAEW,EAAGwhB,EAAWH,EAAIphB,EAAGshB,EAAKF,EAAIxH,KACxD,CACF,CACAlG,KAAKkN,SAAWS,CAClB,CAEAK,SAAAA,GACE,IAAKhO,KAAKkN,SAAS7O,OAAQ,OAC3B,GAAI2B,KAAKgN,OAAO3O,QAAU2B,KAAKiN,UAAW,OAC1C,MAAMR,EAAIzM,KAAKkN,SAASlf,KAAKuT,MAAMvT,KAAKkU,SAAWlC,KAAKkN,SAAS7O,SAC3DhS,EAAIogB,EAAEpgB,EAAI2B,KAAKkU,SAAWuK,EAAEvG,EAC5B5Z,EAAImgB,EAAEngB,EAAI,EACVsV,EAAI,IAAIC,GAAAA,IACd7B,KAAKiM,KAAK5J,SAAST,GACnB,MAAMnV,EAA6B,KAAvBuB,KAAKkU,SAAW,IACtBxV,GAAM,IAAuB,IAAhBsB,KAAKkU,SACFjU,EAAM,KAAuB,KAAhBD,KAAKkU,SACxClC,KAAKgN,OAAOthB,KAAK,CAAEkW,IAAGvV,IAAGC,IAAGG,KAAIC,KAAIsY,KADvB,EAC6B/W,MAAKggB,MAAO,IACxD,CAEAzL,MAAAA,CAAOC,GACL,MAAMiB,EAAK1V,KAAKC,IAAI,EAAGyT,OAAOe,IAAS,OAEjCqE,EAAM9Y,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK8R,KAAKiB,iBAE3C,GADAjB,KAAKwB,aAAasF,GACd9G,KAAKoB,WAAa,EAAG,OAGzB,MAAM8M,EAAW,MAAmBlO,KAAKoB,UAAY,IAA3B,MACpB+M,EAAOngB,KAAKC,IAAI,GAAKD,KAAKE,IAAI,EAAG8R,KAAKkN,SAAS7O,OAAS,IAE9D,IADA2B,KAAK+M,UAAYrJ,EAAKwK,EAAWC,EAC1BnO,KAAK+M,UAAY,GACtB/M,KAAKgO,YACLhO,KAAK+M,UAAY,EAInB,IAAK,IAAI5J,EAAInD,KAAKgN,OAAO3O,OAAS,EAAG8E,GAAK,EAAGA,IAAK,CAChD,MAAMna,EAAIgX,KAAKgN,OAAO7J,GACtBna,EAAEgc,MAAQtB,EAEV1a,EAAE0D,IAAM,KAAUgX,EAClB1a,EAAEqD,GAAKrD,EAAEyD,GAAKiX,EACd1a,EAAEsD,GAAKtD,EAAE0D,GAAKgX,EAEV1a,EAAEilB,MAAM5P,OAAS,IACdrV,EAAEilB,MAAMG,QADUplB,EAAEilB,MAAMviB,KAAK,CAAEW,EAAGrD,EAAEqD,EAAGC,EAAGtD,EAAEsD,IAGrD,MAAMwN,EAAI9L,KAAKE,IAAI,EAAGlF,EAAEgc,KAAOhc,EAAEiF,KAC3BogB,EAAa,EAAIvU,EACjBwU,EAAY,EAAI,KAAO,EAAIxU,GAC3B8H,EAAI5Y,EAAE4Y,EAAGA,EAAEf,QAEjBe,EAAEE,UAAU,CAAEvV,MAAO,EAAG2e,MAAO,QAAU1F,MAAO,IAAO6I,IACvD,IAAK,IAAI7H,EAAI,EAAGA,EAAIxd,EAAEilB,MAAM5P,OAAQmI,IAAK,CACvC,MAAM+H,EAAKvlB,EAAEilB,MAAMzH,EAAI,GAAUgI,EAAKxlB,EAAEilB,MAAMzH,GAC9C5E,EAAE0J,OAAOiD,EAAGliB,EAAGkiB,EAAGjiB,GAClBsV,EAAE2J,OAAOiD,EAAGniB,EAAGmiB,EAAGliB,EACpB,CAMA,GAJAsV,EAAEG,UAAU,SAAU,GAAMsM,GAC5BzM,EAAEiD,WAAW7b,EAAEqD,EAAGrD,EAAEsD,EAAGgiB,GACvB1M,EAAEK,UAEEjZ,EAAEgc,MAAQhc,EAAEiF,IAAK,CACnB,IAAM2T,EAAE2B,QAAU3B,EAAE2B,OAAOC,YAAY5B,EAAI,CAAE,MAAO,CACpD,IAAMA,EAAE6B,SAAW,CAAE,MAAO,CAC5BzD,KAAKgN,OAAOvI,OAAOtB,EAAG,EACxB,CACF,CACF,ECjIa,MAAMsL,GACnB1O,WAAAA,CAAYgB,GACVf,KAAKe,UAAYA,EACjBf,KAAKiM,KAAO,IAAIC,GAAAA,IAChBlM,KAAKe,UAAUsB,SAASrC,KAAKiM,MAC7BjM,KAAK0O,MAAQ,GACb1O,KAAK2O,SAAW,EAClB,CAEAlL,OAAAA,GACE,IAAMzD,KAAKiM,KAAK1I,QAAUvD,KAAKiM,KAAK1I,OAAOC,YAAYxD,KAAKiM,KAAO,CAAE,MAAO,CAC5E,IAAMjM,KAAKiM,KAAKxI,QAAQ,CAAEhJ,UAAU,GAAS,CAAE,MAAO,CACtDuF,KAAKiM,KAAO,KACZjM,KAAK0O,MAAQ,EACf,CAEA7G,MAAAA,GAAU,CAEV0E,OAAAA,EAAQ,EAAElgB,EAAI,EAAC,EAAEC,EAAI,EAAC,SAAE2X,EAAW,IAAQ,CAAC,GAC1C,MAAMwI,EAAIze,KAAKC,IAAI,GAAKD,KAAKE,IAAI,IAAKwT,OAAOuC,IAAa,KACpDgC,EAAQjY,KAAKC,IAAI,EAAGD,KAAKuT,MAAM,EAAI,EAAIkL,IAC7C,IAAK,IAAItJ,EAAI,EAAGA,EAAI8C,GAASjG,KAAK0O,MAAMrQ,OAAS2B,KAAK2O,SAAUxL,IAAK,CACnE,MAAMvB,EAAI,IAAIC,GAAAA,IACd7B,KAAKiM,KAAK5J,SAAST,GACnB,MAAMnV,GAAMuB,KAAKkU,SAAW,KAAQ,IAAO,IAAOuK,GAC5C/f,IAAO,IAAuB,IAAhBsB,KAAKkU,WAAoB,GAAM,GAAMuK,GACnDrO,EAAI,IAAMpQ,KAAKkU,UAAY,IAAMuK,GACjCxe,EAAM,IAAsB,IAAhBD,KAAKkU,SACvBlC,KAAK0O,MAAMhjB,KAAK,CAAEkW,IAAGvV,IAAGC,EAAGA,EAAI,EAAGG,KAAIC,KAAIsY,KAAM,EAAG/W,MAAKmQ,KAC1D,CACF,CAEAoE,MAAAA,CAAOC,GACL,MAAMiB,EAAK1V,KAAKC,IAAI,EAAGyT,OAAOe,IAAS,OACvC,IAAK,IAAIU,EAAInD,KAAK0O,MAAMrQ,OAAS,EAAG8E,GAAK,EAAGA,IAAK,CAC/C,MAAMtU,EAAImR,KAAK0O,MAAMvL,GACrBtU,EAAEmW,MAAQtB,EACV7U,EAAExC,GAAKwC,EAAEpC,GAAKiX,EACd7U,EAAEvC,GAAKuC,EAAEnC,GAAKgX,EAEd,MAAM5J,EAAI9L,KAAKE,IAAI,EAAGW,EAAEmW,KAAOnW,EAAEZ,KAC3BuX,EAAQ,KAAQ,EAAI1L,GACpB8U,EAAS/f,EAAEuP,GAAK,EAAI,GAAMtE,GAC1B8H,EAAI/S,EAAE+S,EAKZ,GALeA,EAAEf,QAEjBe,EAAEG,UAAU,SAAU/T,KAAKC,IAAI,EAAGuX,IAClC5D,EAAEiD,WAAWhW,EAAExC,EAAGwC,EAAEvC,EAAGsiB,GACvBhN,EAAEK,UACEpT,EAAEmW,MAAQnW,EAAEZ,IAAK,CACnB,IAAM2T,EAAE2B,QAAU3B,EAAE2B,OAAOC,YAAY5B,EAAI,CAAE,MAAO,CACpD,IAAMA,EAAE6B,SAAW,CAAE,MAAO,CAC5BzD,KAAK0O,MAAMjK,OAAOtB,EAAG,EACvB,CACF,CACF,ECjDa,MAAM0L,GACnB9O,WAAAA,CAAYgB,EAAW+N,EAAO,CAAC,GAC7B9O,KAAKe,UAAYA,EACjBf,KAAKjW,SAAW+kB,EAAK/kB,UAAY,EACjCiW,KAAKhW,UAAY8kB,EAAK9kB,WAAa,EACnCgW,KAAKkB,SAAW4N,EAAK5N,UAAY,GACjClB,KAAK+O,SAAW,GAChB/O,KAAKgP,UAAY,KACjBhP,KAAKiP,SAAW,KAChBjP,KAAKkP,MAAQ,EACblP,KAAKmP,UAAY,KACjBnP,KAAKoP,aAAe,IACtB,CAEAC,cAAAA,CAAeC,GACbtP,KAAKoP,aAAeE,CACtB,CAEAC,oBAAAA,CAAqBC,GACnB,IAAKxP,KAAKoP,eAAiBI,IAAWA,EAAOvD,KAAM,OAAO,EAC1D,MAAMpd,EAAImR,KAAKoP,aACTK,EAAK5gB,EAAExC,GAAK,EACZqjB,EAAK7gB,EAAEvC,GAAK,EACZqjB,EAAK9gB,EAAEtC,OAAS,GAChBqjB,EAAK/gB,EAAErC,QAAU,GAEjB+b,EAAIiH,EAAOvD,KAAK4D,YACtB,OAAQJ,EAAKE,EAAKpH,EAAElc,GAAKojB,EAAKlH,EAAElc,EAAIkc,EAAEhc,OAASmjB,EAAKE,EAAKrH,EAAEjc,GAAKojB,EAAKnH,EAAEjc,EAAIic,EAAE/b,MAC/E,CAGAsjB,WAAAA,CAAYle,EAAMvF,GAChB,IAAKuR,MAAMC,QAAQmC,KAAK+O,WAAsC,IAAzB/O,KAAK+O,SAAS1Q,OAAc,OAAO,KACxE,MAAM0R,EAAI/hB,KAAKC,IAAI,EAAGD,KAAKuT,MAAMG,OAAOrV,IAAM,IAC9C,IAAK,MAAM+R,KAAK4B,KAAK+O,SACnB,GAAI3Q,EAAExM,OAASA,GACVgM,MAAMC,QAAQO,EAAE4R,UACrB,IAAK,IAAI7M,EAAI,EAAGA,EAAI/E,EAAE4R,SAAS3R,OAAQ8E,IAAK,CAC1C,MAAMna,EAAIoV,EAAE4R,SAAS7M,GACrB,GAAI4M,GAAK/mB,EAAEqD,GAAK0jB,GAAK/mB,EAAEqD,EAAIrD,EAAEkd,EAC3B,OAAOld,EAAEsD,CAEb,CAEF,OAAO,IACT,CAEAmX,OAAAA,GACE,IACE,IAAK,MAAMrF,KAAK4B,KAAK+O,SAAU,CAC7B,IAAU3Q,EAAE6N,MAAQ7N,EAAE6N,KAAK1I,QAAQnF,EAAE6N,KAAK1I,OAAOC,YAAYpF,EAAE6N,KAAO,CAAE,MAAO,CAC/E,IAAM7N,EAAE6N,MAAMxI,QAAQ,CAAEhJ,UAAU,GAAS,CAAE,MAAO,CACtD,CACF,CAAE,MAAO,CACTuF,KAAK+O,SAAW,GAChB,IAAM/O,KAAKgP,WAAWvL,SAAQ,EAAO,CAAE,MAAO,CAC9C,IAAMzD,KAAKiP,UAAUxL,SAAQ,EAAO,CAAE,MAAO,CAC7C,IAAMzD,KAAKmP,WAAW1L,SAAQ,EAAO,CAAE,MAAO,CAC9CzD,KAAKgP,UAAY,KACjBhP,KAAKiP,SAAW,KAChBjP,KAAKmP,UAAY,IACnB,CAEAtO,KAAAA,GACE,IAAK,MAAMzC,KAAK4B,KAAK+O,SAAU,CAC7B,IAAM3Q,EAAE6N,MAAM1I,QAAUnF,EAAE6N,KAAK1I,OAAOC,YAAYpF,EAAE6N,KAAO,CAAE,MAAO,CACpE,IAAM7N,EAAE6N,MAAMxI,QAAQ,CAAEhJ,UAAU,GAAS,CAAE,MAAO,CACtD,CACAuF,KAAK+O,SAAW,EAClB,CAEAlH,MAAAA,CAAO9d,EAAUC,EAAWkX,GAC1B,MAAM+O,EAAKjiB,KAAKC,IAAI,EAAc,EAAXlE,GACjBmmB,EAAKliB,KAAKC,IAAI,EAAe,EAAZjE,GACjBmmB,EAAKniB,KAAKC,IAAI,EAAc,EAAXiT,GACjBkP,EAAUH,IAAOjQ,KAAKjW,UAAYmmB,IAAOlQ,KAAKhW,WAAammB,IAAOnQ,KAAKkB,SAE7E,GADAlB,KAAKjW,SAAWkmB,EAAIjQ,KAAKhW,UAAYkmB,EAAIlQ,KAAKkB,SAAWiP,EACrDC,EAAS,CAEX,IAAMpQ,KAAKgP,WAAWvL,SAAQ,EAAO,CAAE,MAAO,CAC9C,IAAMzD,KAAKiP,UAAUxL,SAAQ,EAAO,CAAE,MAAO,CAC7CzD,KAAKgP,UAAY,KAAMhP,KAAKiP,SAAW,IACzC,CACF,CAEAzM,MAAAA,CAAOC,GACL,MAAMiB,EAAK1V,KAAKC,IAAI,EAAGyT,OAAOe,IAAS,OACvCzC,KAAKkP,OAASxL,EAEd,MAAM2M,EAAa,CAAEhkB,EAAG,IAAOC,EAAG,MAC5BgkB,EAAY,CAAEjkB,GAAI,KAAOC,EAAG,MAClC,IAAK,MAAM8R,KAAK4B,KAAK+O,SAAU,CAC7B,MAAMwB,EAASnS,EAAEmS,OACjB,IAAKA,EAAQ,SACb,MAAMzL,EAAmB,SAAX1G,EAAExM,KAAkB0e,EAAYD,EAK9C,GAJAE,EAAOvI,aAAa3b,GAAKyY,EAAMzY,EAAIqX,EACnC6M,EAAOvI,aAAa1b,GAAKwY,EAAMxY,EAAIoX,EAGpB,UAAXtF,EAAExM,KAAkB,CAEtB,MAAM4e,EAAiBxQ,KAAKuP,qBAAqBnR,GAE/CmS,EAAO/K,MADLgL,EACa,GAEA,GAEnB,KAAO,CAEL,MAAMA,EAAiBxQ,KAAKuP,qBAAqBnR,GAE/CmS,EAAO/K,MADLgL,EACa,GAEA,GAEnB,CAcA,GAXIpS,EAAEqS,SACJrS,EAAEqS,OAAOzI,aAAa3b,GAAe,IAAVyY,EAAMzY,EAAUqX,EAC3CtF,EAAEqS,OAAOzI,aAAa1b,GAAe,IAAVwY,EAAMxY,EAAUoX,GAEzCtF,EAAEsS,SACJtS,EAAEsS,OAAO1I,aAAa3b,GAAgB,KAAVyY,EAAMzY,EAAUqX,EAC5CtF,EAAEsS,OAAO1I,aAAa1b,GAAe,GAAVwY,EAAMxY,EAAUoX,GAIxC9F,MAAMC,QAAQO,EAAEuS,SAAQvS,EAAEuS,MAAQ,IACnCvS,EAAEuS,MAAMtS,OACV,IAAK,IAAI8E,EAAI/E,EAAEuS,MAAMtS,OAAS,EAAG8E,GAAK,EAAGA,IAAK,CAC5C,MAAM+C,EAAI9H,EAAEuS,MAAMxN,GAClB+C,EAAEpM,GAAK4J,EAEP,MAAMsB,EAAkB,UAAX5G,EAAExM,KAAmBsU,EAAE0K,YAAc1K,EAAE2K,WACpD,GAAI3K,EAAEpM,GAAKkL,EAAM,CAAE5G,EAAEuS,MAAMlM,OAAOtB,EAAG,GAAI,QAAU,CAEnD+C,EAAE0I,OAAS1I,EAAE4K,YAAc5K,EAAE/D,OAAS+D,EAAEpM,EAAI,KAE5C,MAAMiX,EAAQ/iB,KAAKgjB,KAAK9K,EAAEpM,GAAgB,UAAXsE,EAAExM,KAAmB,KAAO,MAC3DsU,EAAE+K,OAAS/K,EAAEgL,IAAMH,CACrB,CAIF,GAAe,UAAX3S,EAAExM,MAAoBwM,EAAE+S,MAAQvT,MAAMC,QAAQO,EAAE4R,WAAa5R,EAAE4R,SAAS3R,OAAQ,CAClF,MAAMuD,EAAIxD,EAAE+S,KACND,EAAMljB,KAAKC,IAAI,EAAGD,KAAKuT,MAAsB,IAAhBvB,KAAKkB,WAClC+J,EAAYjd,KAAKC,IAAI,EAAGD,KAAKuT,MAAsB,IAAhBvB,KAAKkB,WAC9CU,EAAEf,QACFe,EAAEG,UAAU,SAAU,KACtB,IAAK,IAAIoB,EAAI,EAAGA,EAAI/E,EAAE4R,SAAS3R,OAAQ8E,IAAK,CAC1C,MAAMna,EAAIoV,EAAE4R,SAAS7M,GAErB,IAAIiO,EAAKpjB,KAAKoX,IAAkB,KAAbpF,KAAKkP,MAAuB,IAANlmB,EAAEqD,IAAmB,GAAN6kB,GAExD,GAAI9S,EAAEuS,OAASvS,EAAEuS,MAAMtS,OAAQ,CAE7B,MAAMgT,EAAUroB,EAAEqD,EAAU,GAANrD,EAAEkd,EACxB,IAAK,IAAIM,EAAI,EAAGA,EAAIpI,EAAEuS,MAAMtS,OAAQmI,IAAK,CACvC,MAAMN,EAAI9H,EAAEuS,MAAMnK,GACZ8K,EAAKD,EAAUnL,EAAES,GAEvB,GADa3Y,KAAKuW,IAAI+M,GACXpL,EAAE0I,OAAe,GAAN5lB,EAAEkd,EAAS,SACjC,MAAMqL,EAAQvjB,KAAKC,IAAI,EAAc,GAAXiY,EAAE0I,QACtB4C,EAAQxjB,KAAKgjB,KAAMM,EAAKA,GAAO,EAAIC,EAAQA,IACjDH,GAAMlL,EAAE+K,OAASO,CACnB,CAEA,MAAMC,EAAUzjB,KAAKC,IAAI,EAAmB,IAAhB+R,KAAKkB,UAC7BkQ,EAAKK,IAASL,EAAKK,GACnBL,GAAMK,IAASL,GAAMK,EAC3B,CACA7P,EAAEI,SAAShZ,EAAEqD,EAAGrD,EAAEsD,EAAI2e,EAAYmG,EAAIpoB,EAAEkd,EAAG+E,EAC7C,CACArJ,EAAEK,SACJ,CACF,CACF,CAEAyP,KAAAA,EAAM,SAAE3nB,EAAQ,UAAEC,EAAS,SAAEkX,EAAQ,YAAExX,EAAW,cAAE0jB,IAClD,IAAKxP,MAAMC,QAAQnU,KAAiBkU,MAAMC,QAAQuP,GAAgB,OAClEpN,KAAK6H,OAAO9d,EAAUC,EAAWkX,GACjClB,KAAKa,QAEL,MAAMkG,EAAI/G,KAAKjW,SACT+f,EAAI9J,KAAKhW,UACT0jB,EAAK1N,KAAKkB,SACV+E,EAAQc,EAAI+C,EAGZ6H,EAAUxO,IACd,MAAMva,EAAKc,EAAYyZ,GACvB,IAAKva,EAAI,OAAO,KAChB,MAAM2kB,EAJQ3kB,IAAOwkB,EAAcjP,KAAMC,GAAMA,EAAExV,KAAOA,GAI5CykB,CAAOzkB,GACnB,OAAK2kB,GAAQA,EAAIC,OAAUD,EAAIC,MAAMoE,OACjCrE,EAAIC,MAAMqE,MAAc,QACxBtE,EAAIC,MAAMC,KAAa,OACpB,SAH6C,MAMhDqE,EAAU,IAAIC,WAAW9L,GACzB+L,EAAO,CAAC,GAAI,EAAGjL,GAAIA,GAEzB,IAAK,IAAI5D,EAAI,EAAGA,EAAI8C,EAAO9C,IAAK,CAC9B,GAAI2O,EAAQ3O,GAAI,SAChB,MAAMrJ,EAAI6X,EAAOxO,GACjB,IAAKrJ,EAAG,CAAEgY,EAAQ3O,GAAK,EAAG,QAAU,CAGpC,MAAM8O,EAAc,GACdC,EAAQ,CAAC/O,GAEf,IADA2O,EAAQ3O,GAAK,EACN+O,EAAM7T,QAAQ,CACnB,MAAM7S,EAAM0mB,EAAM5O,MAClB2O,EAAYvmB,KAAKF,GACjB,IAAK,IAAIohB,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMnZ,EAAIjI,EAAMwmB,EAAKpF,GACrB,GAAInZ,EAAI,GAAKA,GAAKwS,EAAO,SACzB,GAAI6L,EAAQre,GAAI,SAEhB,GAAImZ,EAAI,EAAG,CAGT,GAFY5e,KAAKuT,MAAM/V,EAAMub,KAChB/Y,KAAKuT,MAAM9N,EAAIsT,GACV,QACpB,CACW4K,EAAOle,KACPqG,GAAKgY,EAAQre,GAAK,EAAGye,EAAMxmB,KAAK+H,IACpCqe,EAAQre,GAAKqe,EAAQre,IAAM,CACpC,CACF,CAE2B,IAAvBwe,EAAY5T,QAChB2B,KAAKmS,WAAWrY,EAAGmY,EAAalL,EAAG+C,EAAG4D,EACxC,CACF,CAEAyE,UAAAA,CAAWvgB,EAAMwgB,EAAaroB,EAAUC,EAAWkX,GACjD,MAAM+K,EAAO,IAAIC,GAAAA,IACXmG,EAAO,IAAIxQ,GAAAA,IACXyQ,EAASvoB,EAAWmX,EACpBqR,EAASvoB,EAAYkX,EAK3BmR,EAAKxR,QACLwR,EAAKtQ,UAAU,SAAU,GACzB,MAAMyQ,EAAQ,GACd,IAAK,IAAIhM,EAAI,EAAGA,EAAI4L,EAAY/T,OAAQmI,IAAK,CAC3C,MAAMhb,EAAM4mB,EAAY5L,GAClBsH,EAAMtiB,EAAMzB,EACZ6jB,EAAK5f,KAAKuT,MAAM/V,EAAMzB,GAC5BsoB,EAAKrQ,SACH8L,EAAK5M,EAAWsR,EAChB5E,EAAK1M,EAAWsR,EAChBtR,EAAWsR,EACXtR,EAAWsR,EAEf,CACAH,EAAKpQ,UAEL,MAAM1B,EAAe,SAAT3O,EAAmBoO,KAAKiP,WAAajP,KAAKiP,SAAWjP,KAAKyS,mBAAmBvR,IACzDlB,KAAKgP,YAAchP,KAAKgP,UAAYhP,KAAK0S,oBAAoBxR,IACvFyR,EAAS,IAAIrL,GAAAA,IAAa/G,EAAK+R,EAAQC,GAC7CI,EAAOnL,UAAU9G,IAAI,EAAG,GACxBiS,EAAOnN,MAAiB,SAAT5T,EAAkB,IAAO,IAExC+gB,EAAOtmB,EAAI,EAAGsmB,EAAOrmB,EAAI,EAGzB2f,EAAK5J,SAASsQ,GAEd,MAAMxL,EAAWnH,KAAKmP,YAAcnP,KAAKmP,UAAYnP,KAAKoH,oBAAoB,IAAK,MAC7EqJ,EAAS,IAAInJ,GAAAA,IAAaH,EAAUmL,EAAQC,GAC5C7B,EAAS,IAAIpJ,GAAAA,IAAaH,EAAUmL,EAAQC,GAErC,UAAT3gB,GACF6e,EAAOjJ,UAAU9G,IAAI,GAAK,KAC1BgQ,EAAOlJ,UAAU9G,IAAI,GAAK,IAC1B+P,EAAOjL,MAAQ,IAAMkL,EAAOlL,MAAQ,MAEpCiL,EAAOjJ,UAAU9G,IAAI,IAAK,IAC1BgQ,EAAOlJ,UAAU9G,IAAI,GAAK,IAC1B+P,EAAOjL,MAAQ,IAAMkL,EAAOlL,MAAQ,KAEtCyG,EAAK5J,SAASoO,GACdxE,EAAK5J,SAASqO,GAEdzE,EAAK5J,SAASgQ,GACdpG,EAAKoG,KAAOA,EAGZ,IAAIlB,EAAO,KACPnB,EAAW,KACF,UAATpe,IACFuf,EAAO,IAAItP,GAAAA,IACXoK,EAAK5J,SAAS8O,GACdnB,EAAWhQ,KAAK4S,qBAAqBR,EAAaroB,EAAUmX,IAG9DlB,KAAKe,UAAUsB,SAAS4J,GACxBjM,KAAK+O,SAASrjB,KAAK,CAAEkG,OAAMqa,OAAMoG,OAAM9B,OAAQoC,EAAQlC,SAAQC,SAAQS,OAAMnB,WAAUW,MAAO,IAChG,CAEA+B,mBAAAA,CAAoBxR,GAClB,MAAMuH,EAASC,SAASC,cAAc,UAChCkE,EAAkB,EAAX3L,EACbuH,EAAOlc,MAAQsgB,EAAMpE,EAAOjc,OAASqgB,EACrC,MAAMjE,EAAMH,EAAOI,WAAW,MAGxBjH,EAAIgH,EAAIiK,qBAAqB,EAAG,EAAG,EAAGhG,GAC5CjL,EAAEkR,aAAa,EAAG,WAClBlR,EAAEkR,aAAa,GAAK,WACpBlR,EAAEkR,aAAa,EAAG,WAClBlK,EAAImK,UAAYnR,EAChBgH,EAAIoK,SAAS,EAAG,EAAGnG,EAAMA,GAGzB,MAAMoG,EAAQA,CAAC5mB,EAAGC,EAAG4mB,KACPllB,KAAKoX,IAAI/Y,EAAI6mB,GAASllB,KAAK4Y,IAAIta,EAAI4mB,EAAQ,KAC3CllB,KAAKoX,IAAI/Y,EAAI6mB,EAAQ,IAAM,KAAOllB,KAAK4Y,IAAIta,EAAI4mB,EAAQ,IAAM,KAC3D,GAAK,EAIfC,EAAYvK,EAAIwK,aAAa,EAAG,EAAGvG,EAAMA,GACzCvP,EAAO6V,EAAU7V,KACvB,IAAK,IAAIhR,EAAI,EAAGA,EAAIugB,EAAMvgB,IACxB,IAAK,IAAID,EAAI,EAAGA,EAAIwgB,EAAMxgB,IAAK,CAC7B,MAAMb,EAAuB,GAAhBc,EAAIugB,EAAOxgB,GAGlBgnB,EAAa,IAAW,GAFpBJ,EAAM5mB,EAAGC,EAAG,KAGtBgR,EAAK9R,GAAOwC,KAAKE,IAAI,IAAKoP,EAAK9R,GAAO6nB,GACtC/V,EAAK9R,EAAM,GAAKwC,KAAKE,IAAI,IAAKoP,EAAK9R,EAAM,GAAK6nB,GAC9C/V,EAAK9R,EAAM,GAAKwC,KAAKE,IAAI,IAAKoP,EAAK9R,EAAM,GAAK6nB,EAChD,CAEFzK,EAAII,aAAamK,EAAW,EAAG,GAG/BvK,EAAI0K,YAAc,IAClB,MAAMC,EAAU3K,EAAIiK,qBAAqB,EAAG,EAAG,EAAU,GAAPhG,GAMlD,OALA0G,EAAQT,aAAa,EAAG,WACxBS,EAAQT,aAAa,EAAG,0BACxBlK,EAAImK,UAAYQ,EAChB3K,EAAIoK,SAAS,EAAG,EAAGnG,EAAa,GAAPA,GAElBrM,GAAAA,IAAQC,KAAKgI,EACtB,CAEAgK,kBAAAA,CAAmBvR,GACjB,MAAMuH,EAASC,SAASC,cAAc,UAChCkE,EAAkB,EAAX3L,EACbuH,EAAOlc,MAAQsgB,EAAMpE,EAAOjc,OAASqgB,EACrC,MAAMjE,EAAMH,EAAOI,WAAW,MAGxBjH,EAAIgH,EAAIiK,qBAAqB,EAAG,EAAG,EAAGhG,GAC5CjL,EAAEkR,aAAa,EAAG,WAClBlR,EAAEkR,aAAa,GAAK,WACpBlR,EAAEkR,aAAa,EAAG,WAClBlK,EAAImK,UAAYnR,EAChBgH,EAAIoK,SAAS,EAAG,EAAGnG,EAAMA,GAGzB,MAAMoG,EAAQA,CAAC5mB,EAAGC,EAAG4mB,KACPllB,KAAKoX,IAAI/Y,EAAI6mB,EAAQ,IAAOllB,KAAK4Y,IAAIta,EAAI4mB,EAAQ,KACjDllB,KAAKoX,IAAI/Y,EAAI6mB,EAAQ,IAAM,KAAOllB,KAAK4Y,IAAIta,EAAI4mB,EAAQ,IAAM,KAC3D,GAAK,EAIfC,EAAYvK,EAAIwK,aAAa,EAAG,EAAGvG,EAAMA,GACzCvP,EAAO6V,EAAU7V,KACvB,IAAK,IAAIhR,EAAI,EAAGA,EAAIugB,EAAMvgB,IACxB,IAAK,IAAID,EAAI,EAAGA,EAAIwgB,EAAMxgB,IAAK,CAC7B,MAAMb,EAAuB,GAAhBc,EAAIugB,EAAOxgB,GAClBmnB,EAAKP,EAAM5mB,EAAGC,EAAG,KACjBmnB,EAAKR,EAAU,IAAJ5mB,EAAa,GAAJC,EAAS,KAE7B+mB,EAAa,GAAW,IAALG,EAAiB,GAALC,EAMrC,GALAnW,EAAK9R,GAAOwC,KAAKE,IAAI,IAAKoP,EAAK9R,GAAO6nB,GACtC/V,EAAK9R,EAAM,GAAKwC,KAAKE,IAAI,IAAKoP,EAAK9R,EAAM,GAAK6nB,GAC9C/V,EAAK9R,EAAM,GAAKwC,KAAKE,IAAI,IAAKoP,EAAK9R,EAAM,GAAK6nB,GAG1CG,EAAK,IAAOC,EAAK,GAAK,CACxB,MAAMC,EAAyB,IAAjBF,EAAKC,EAAK,KACxBnW,EAAK9R,GAAOwC,KAAKE,IAAI,IAAKoP,EAAK9R,GAAOkoB,GACtCpW,EAAK9R,EAAM,GAAKwC,KAAKE,IAAI,IAAKoP,EAAK9R,EAAM,GAAY,GAAPkoB,GAC9CpW,EAAK9R,EAAM,GAAKwC,KAAKE,IAAI,IAAKoP,EAAK9R,EAAM,GAAY,GAAPkoB,EAChD,CACF,CAEF9K,EAAII,aAAamK,EAAW,EAAG,GAG/BvK,EAAI0K,YAAc,GAClB,MAAMK,EAAc/K,EAAIiK,qBAAqB,EAAG,EAAG,EAAU,IAAPhG,GAMtD,OALA8G,EAAYb,aAAa,EAAG,WAC5Ba,EAAYb,aAAa,EAAG,0BAC5BlK,EAAImK,UAAYY,EAChB/K,EAAIoK,SAAS,EAAG,EAAGnG,EAAa,IAAPA,GAElBrM,GAAAA,IAAQC,KAAKgI,EACtB,CAEArB,mBAAAA,CAAoBlB,EAAI,IAAKC,EAAI,KAC/B,MAAMsC,EAASC,SAASC,cAAc,UACtCF,EAAOlc,MAAQ2Z,EAAGuC,EAAOjc,OAAS2Z,EAClC,MAAMyC,EAAMH,EAAOI,WAAW,MACxBC,EAAMF,EAAIG,gBAAgB7C,EAAGC,GACnC,IAAK,IAAIhD,EAAI,EAAGA,EAAI2F,EAAIxL,KAAKe,OAAQ8E,GAAK,EAAG,CAE3C,MAAM1B,EAAI,IAAMzT,KAAKuT,MAAsB,GAAhBvT,KAAKkU,UAChC4G,EAAIxL,KAAK6F,GAAK1B,EAAGqH,EAAIxL,KAAK6F,EAAI,GAAK1B,EAAGqH,EAAIxL,KAAK6F,EAAI,GAAK1B,EAAGqH,EAAIxL,KAAK6F,EAAI,GAAK,GAC/E,CAEA,OADAyF,EAAII,aAAaF,EAAK,EAAG,GAClBtI,GAAAA,IAAQC,KAAKgI,EACtB,CAGAmK,oBAAAA,CAAqBR,EAAaroB,EAAUmX,GAE1C,MAAMR,EAAM,IAAIkT,IAAIxB,GACdzE,EAAQ,GAERkG,EAAa,IAAI3T,IACvB,IAAK,MAAM1U,KAAO4mB,EAAa,CAC7B,MAAMxE,EAAK5f,KAAKuT,MAAM/V,EAAMzB,GACtB+jB,EAAKtiB,EAAMzB,EACX+pB,EAAQtoB,EAAMzB,EACpB,IAAK2W,EAAIJ,IAAIwT,GAAQ,CAEnB,MAAMC,EAAUF,EAAW1T,IAAIyN,IAAO,GACtCmG,EAAQroB,KAAKoiB,GACb+F,EAAWnT,IAAIkN,EAAImG,EACrB,CACF,CAEA,IAAK,MAAOnG,EAAIoG,KAASH,EAAWI,UAAW,CAC7CD,EAAKE,KAAK,CAAC5L,EAAGC,IAAMD,EAAIC,GACxB,IAAI4L,EAAQ,KAAUC,EAAO,KAC7B,IAAK,MAAMtG,KAAMkG,EACD,OAAVG,EACArG,IAAOsG,EAAO,GAElBzG,EAAMjiB,KAAK,CAAEW,EAAG8nB,EAAQjT,EAAU5U,EAAGshB,EAAK1M,EAAUgF,GAAIkO,EAAOD,EAAQ,GAAKjT,IAC5EiT,EAAQrG,EAAIsG,EAAOtG,GAHIsG,EAAOtG,GADRqG,EAAQrG,EAAIsG,EAAOtG,GAM7B,OAAVqG,GACFxG,EAAMjiB,KAAK,CAAEW,EAAG8nB,EAAQjT,EAAU5U,EAAGshB,EAAK1M,EAAUgF,GAAIkO,EAAOD,EAAQ,GAAKjT,GAEhF,CACA,OAAOyM,CACT,CAMA0G,OAAAA,CAAQziB,EAAMvF,EAAG4X,EAAW,GAC1B,MAAMnK,EAAc,SAATlI,EAAmB,OAAS,QACjCme,EAAI/hB,KAAKC,IAAI,EAAGD,KAAKE,IAAI8R,KAAKjW,SAAWiW,KAAKkB,SAAUQ,OAAOrV,IAAM,IAE3E,IAAK,MAAM+R,KAAK4B,KAAK+O,SAAU,CAC7B,GAAI3Q,EAAExM,OAASkI,EAAG,SAClB,MAAM6T,EAAQvP,EAAE4R,SAChB,GAAKpS,MAAMC,QAAQ8P,IAA2B,IAAjBA,EAAMtP,OACnC,IAAK,IAAI8E,EAAI,EAAGA,EAAIwK,EAAMtP,OAAQ8E,IAAK,CACrC,MAAMna,EAAI2kB,EAAMxK,GAChB,GAAI4M,GAAK/mB,EAAEqD,GAAK0jB,GAAK/mB,EAAEqD,EAAIrD,EAAEkd,EAAG,CACzBtI,MAAMC,QAAQO,EAAEuS,SAAQvS,EAAEuS,MAAQ,IAEnCvS,EAAEuS,MAAMtS,OAAS,IAAID,EAAEuS,MAAMvC,QACjC,MAAM+B,EAAKnQ,KAAKkB,SACVuL,EAAIze,KAAKC,IAAI,IAAMD,KAAKE,IAAI,EAAGwT,OAAOuC,IAAa,IAEnDiN,GADiB,UAANpX,EAAsB,IAALqW,EAAiB,GAALA,IACvB,GAAM,GAAMniB,KAAKE,IAAI,EAAKue,IAC3CtK,EAAe,UAANrI,EAAkB,GAAK,GAAK2S,EAAM,GAAK,GAAKA,EACrDqE,EAAc9iB,KAAKC,IAAI,EAAQ,GAALkiB,GAE1BS,EAAc,KAAO,IAAMnE,EAC3BoE,EAAa,IAAM,IAAMpE,EAE/B,OADArO,EAAEuS,MAAMjlB,KAAK,CAAEib,GAAIoJ,EAAGjW,EAAG,EAAGoX,MAAKD,OAAQC,EAAK/O,QAAOyM,OAAQkC,EAAaA,cAAaF,cAAaC,gBAC7F,CACT,CACF,CACF,CACA,OAAO,CACT,ECjfK,MAAMyD,WAAkBpI,GAAAA,IAC7BnM,WAAAA,CAAYwU,EAAU,CAAC,GACrBC,QACA,MAAM,MACJjoB,EAAQ,GAAE,OACVC,EAAS,EAAC,QACVioB,EAAU,EAAC,QACXC,GAAU,EAAE,WACZC,EAAa,CAAEpY,KAAM,IAAMrH,OAAQ,KAAM,OACzCH,EAAS,CAAE6f,GAAI,QAAUrY,KAAM,SAAUrH,OAAQ,UAAU,WAE3D2f,EAAa,QAAQ,YACrBC,EAAc,EAAQ,YACtBC,EAAc,IACZR,EAEJvU,KAAKgV,GAAKhnB,KAAKC,IAAI,EAAGD,KAAKuT,MAAMhV,IACjCyT,KAAKiV,GAAKjnB,KAAKC,IAAI,EAAGD,KAAKuT,MAAM/U,IACjCwT,KAAKkV,MAAQ,EACblV,KAAKmV,OAAS,SACdnV,KAAKoV,YAAcT,EACnB3U,KAAKqV,QAAUtgB,EACfiL,KAAKsV,YAAcT,EACnB7U,KAAKuV,aAAeT,EACpB9U,KAAKwV,aAAeT,EAEpB/U,KAAK3T,EAAIooB,GAAW,EACpBzU,KAAK1T,EAAIooB,GAAW,EAEpB1U,KAAKyV,OAAS,IAAI5T,GAAAA,IAClB7B,KAAK0V,MAAQ,IAAI7T,GAAAA,IACjB7B,KAAKqC,SAASrC,KAAKyV,QACnBzV,KAAKqC,SAASrC,KAAK0V,OAEnB1V,KAAK2V,YACP,CAEA9N,MAAAA,CAAOtb,EAAOC,GACZ,MAAM0Z,EAAIlY,KAAKC,IAAI,EAAGD,KAAKuT,MAAMhV,GAASyT,KAAKgV,KACzC7O,EAAInY,KAAKC,IAAI,EAAGD,KAAKuT,MAAM/U,GAAUwT,KAAKiV,KAC5C/O,IAAMlG,KAAKgV,IAAM7O,IAAMnG,KAAKiV,KAChCjV,KAAKgV,GAAK9O,EAAGlG,KAAKiV,GAAK9O,EACvBnG,KAAK2V,aACP,CAEAnT,MAAAA,CAAOoT,EAAS3nB,GACd,MAAMoS,EAAIrS,KAAKC,IAAI,EAAGyT,OAAOzT,IAAQ,GACrC,GAAIoS,GAAK,IAAMqB,OAAOsC,SAAS4R,GAE7B,YADA5V,KAAK6V,SAAU,GAGjB,MAAMC,EAAI9nB,KAAKC,IAAI,EAAGD,KAAKE,IAAImS,EAAGqB,OAAOkU,KACnCG,EAAM1V,EAAI,EAAIyV,EAAIzV,EAAI,EAC5BL,KAAK6V,SAAU,EAEf,MAAM3K,EAAQ6K,EAAM/V,KAAKoV,YAAYlgB,OACjC8K,KAAKqV,QAAQngB,OACZ6gB,EAAM/V,KAAKoV,YAAY7Y,KAAOyD,KAAKqV,QAAQ9Y,KAAOyD,KAAKqV,QAAQT,IAGhE5mB,KAAKuW,IAAIwR,EAAM/V,KAAKkV,MAAQ,MAAShK,IAAUlL,KAAKmV,UACtDnV,KAAKkV,KAAOa,EACZ/V,KAAKmV,OAASjK,EACdlL,KAAKgW,cAET,CAEAL,UAAAA,GAEE,MAAMzP,EAAIlG,KAAKgV,GAAI7O,EAAInG,KAAKiV,GAC5BjV,KAAKyV,OAAO5U,QACZb,KAAKyV,OAAO1T,UAAU/B,KAAKsV,YAAa,KACxCtV,KAAKyV,OAAOQ,gBAAgB,EAAG,EAAG/P,EAAGC,EAAGnY,KAAKE,IAAI,EAAO,GAAJiY,IACpDnG,KAAKyV,OAAOxT,UAEZjC,KAAKgW,aACP,CAEAA,WAAAA,GACE,MAAM9P,EAAIlG,KAAKgV,GAAI7O,EAAInG,KAAKiV,GACtBiB,EAASloB,KAAKC,IAAI,EAAGD,KAAKuT,MAAM2E,EAAIlY,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG8R,KAAKkV,SACjEtG,EAAS5gB,KAAKE,IAAI,EAAGF,KAAKuT,MAAM4E,EAAI,IAC1CnG,KAAK0V,MAAM7U,QACPqV,GAAU,IACdlW,KAAK0V,MAAM3T,UAAU/B,KAAKmV,OAAQ,GAElCnV,KAAK0V,MAAMO,gBAAgB,EAAG,EAAGC,EAAQ/P,EAAGyI,GAC5C5O,KAAK0V,MAAMzT,UACb,EAGF,YCjFA,GAjBsB7Y,OAAO+sB,OAAO,CAClCC,SAAU,GACVC,UAAW,GACXC,aAAc,GACdpiB,OAAQ,GACR7G,YAAa,GACbkpB,SAAU,GACVC,aAAc,GACdC,QAAS,GACTC,IAAK,GACLC,QAAS,GACTC,SAAU,GACVC,MAAO,IACPC,UAAW,IACXlhB,QAAS,MCbLmhB,GAAkB,IAAI7W,IAEf8W,GAAc5W,IACzB,IAAKA,EAEH,OADA/O,QAAQkL,KAAK,gCACN,KAET,GAAIwa,GAAgBzW,IAAIF,GACtB,OAAO2W,GAAgB5W,IAAIC,GAE7B,IACE,MAAMG,EAAMC,GAAAA,IAAQC,KAAKL,GACzB,OAAKG,GAILwW,GAAgBrW,IAAIN,EAAKG,GAClBA,IAJLlP,QAAQkL,KAAK,kDAAmD6D,GACzD,KAIX,CAAE,MAAOpX,GAEP,OADAqI,QAAQnH,MAAM,uCAAwCkW,EAAKpX,GACpD,IACT,GAmDWiuB,GAAaC,IACxB,MAAM7W,EAAIqB,OAAOwV,GAGjB,OADY,KADOxV,OAAOsC,SAAS3D,IAAMA,EAAI,EAAIA,EAAI,KAExC,IAIF8W,GAAaA,CAAC/J,EAAexkB,IAAOwkB,EAAcjP,KAAMC,GAAMA,EAAExV,KAAOA,GCIvEwuB,GAAc7J,MAAWA,GAAOA,EAAIC,OAASD,EAAIC,MAAMqE,OACvDwF,GAAa9J,MAAWA,GAAOA,EAAIC,OAASD,EAAIC,MAAMC,MCrF5D,MAAM6J,GACXvX,WAAAA,CAAYgB,EAAWwW,GACrBvX,KAAKe,UAAYA,EACjBf,KAAKwX,MAAQD,EACbvX,KAAKyX,SAAW,KAChBzX,KAAK0X,UAAY,KACjB1X,KAAK2X,QAAU,EACf3X,KAAK4X,QAAU,EACf5X,KAAK6X,aAAe,EACpB7X,KAAK8X,YAAc,IACrB,CAEApG,KAAAA,EAAM,WAAEqG,EAAU,YAAEC,EAAW,IAAE5X,EAAG,MAAE8K,EAAK,OAAE+M,EAAS,KACpD,IAAKjY,KAAKe,UAAW,OACrBf,KAAKa,QAELb,KAAK2X,QAAUI,EACf/X,KAAK4X,QAAUI,EACfhY,KAAK8X,YAAc1X,EAGnB,MAAM8X,EAAwB,kBAAVhN,GAAsBA,EAAMrO,WAAW,KACvDsb,SAASjN,EAAMkN,MAAM,GAAI,IACxB1W,OAAOwJ,IAAU,QAEhBmN,EAAQ,IAAIC,GAAAA,IAAO9X,GAAAA,IAAQ+X,OACjCF,EAAMG,KAAON,EACbG,EAAM9rB,MAAQwrB,EACdM,EAAM7rB,OAASwrB,EACfK,EAAM7S,MAAQ,EACd,IACE6S,EAAMzS,QAAU,CAAC,IAAIC,GAAAA,IAAW,CAAE5B,SAAU,GAAK6B,QAAS,IAC5D,CAAE,MAAO,CAKT,GAJA9F,KAAKe,UAAUsB,SAASgW,GACxBrY,KAAKyX,SAAWY,EAGZjY,EAAK,CACP,MAAMqY,EAAclY,IAClB,IAAKP,KAAKe,WAAaf,KAAK8X,cAAgB1X,EAAK,OAGjD,GAAIJ,KAAK0X,UAAW,CAClB,IAAM1X,KAAKe,UAAUyC,YAAYxD,KAAK0X,UAAY,CAAE,MAAO,CAC3D,IAAM1X,KAAK0X,UAAUjU,SAAW,CAAE,MAAO,CACzCzD,KAAK0X,UAAY,IACnB,CAEA,IAAKnX,EAEH,YADAlP,QAAQkL,KAAK,0DAKXgE,EAAImY,cAAanY,EAAImY,YAAYC,SAAWC,GAAAA,IAAWC,QACvDtY,EAAIuY,SAAQvY,EAAIuY,OAAOC,YAAc,UAEzC,MAAMxI,EAAS,IAAIjJ,GAAAA,IAAa,CAAE7J,QAAS8C,EAAKhU,MAAOwrB,EAAYvrB,OAAQwrB,IACrEgB,EAAQzY,EAAI/T,SAAW+T,EAAIuY,OAASvY,EAAIuY,OAAOtsB,OAAS,IAAM,EAC9DysB,EAASjB,EAAcgB,EAC7BzI,EAAO/I,UAAU9G,IAAI,EAAGuY,GACxB1I,EAAO/K,MAAQ,EACf,IACE+K,EAAO3K,QAAU,CAAC,IAAIC,GAAAA,IAAW,CAAE5B,SAAU,IAAK6B,QAAS,IAC7D,CAAE,MAAO,CAET9F,KAAKe,UAAUsB,SAASkO,GACxBvQ,KAAK0X,UAAYnH,EACjBvQ,KAAKkZ,UAAUlZ,KAAK6X,cAAgB,EAAGI,IAIzC,IAAI1X,EAAM,KACV,IACEA,EAAM4Y,GAAAA,GAAOhZ,IAAIC,EACnB,CAAE,MAAOpX,GACPuX,EAAMP,KAAKwX,OAAOrX,IAAIC,IAAQI,GAAAA,IAAQC,KAAKL,EAC7C,CAEgBG,IACdA,EAAI6Y,OACH7Y,EAAImY,aAAenY,EAAImY,YAAYU,OACnC7Y,EAAIuY,QAAUvY,EAAIuY,OAAOvsB,MAAQ,IAIlC8E,QAAQuN,IAAI,8CACZ6Z,EAAWlY,KAEXlP,QAAQuN,IAAI,sEACZua,GAAAA,GAAOE,KAAKjZ,GAAKkZ,KAAMC,IACrBloB,QAAQuN,IAAI,uDACZ6Z,EAAWc,KACVC,MAAMC,IACPpoB,QAAQnH,MAAM,wDAAyDkW,EAAKqZ,KAGlF,CACF,CAEAP,SAAAA,CAAUQ,EAASzB,EAAS,IAC1BjY,KAAK6X,aAAe6B,EAChB1Z,KAAK0X,WAAa,iBAAkB1X,KAAK0X,YAC3C1X,KAAK0X,UAAU1P,aAAa3b,GAAKqtB,EAAUzB,EAC3CjY,KAAK0X,UAAU1P,aAAa1b,EAAI,EAEpC,CAEAub,MAAAA,CAAOkQ,EAAYC,GAOjB,GANAhY,KAAK2X,QAAUI,EACf/X,KAAK4X,QAAUI,EACXhY,KAAKyX,WACPzX,KAAKyX,SAASlrB,MAAQwrB,EACtB/X,KAAKyX,SAASjrB,OAASwrB,GAErBhY,KAAK0X,UAAW,CAClB1X,KAAK0X,UAAUnrB,MAAQwrB,EACvB/X,KAAK0X,UAAUlrB,OAASwrB,EACxB,MAAMzX,EAAMP,KAAK0X,UAAUja,QACrBub,EAAQzY,GAAK/T,SAAW+T,GAAKuY,OAASvY,EAAIuY,OAAOtsB,OAAS,IAAM,EACtE,GAAIwT,KAAK0X,UAAUlQ,WAAawR,EAAO,EAAG,CACxC,MAAMC,EAASjB,EAAcgB,EAC7BhZ,KAAK0X,UAAUlQ,UAAU9G,IAAI,EAAGuY,EAClC,CACF,CACF,CAEApY,KAAAA,GACE,GAAIb,KAAKyX,SAAU,CACjB,IAAMzX,KAAKe,UAAUyC,YAAYxD,KAAKyX,SAAW,CAAE,MAAO,CAC1D,IAAMzX,KAAKyX,SAAShU,SAAW,CAAE,MAAO,CACxCzD,KAAKyX,SAAW,IAClB,CACA,GAAIzX,KAAK0X,UAAW,CAClB,IAAM1X,KAAKe,UAAUyC,YAAYxD,KAAK0X,UAAY,CAAE,MAAO,CAC3D,IAAM1X,KAAK0X,UAAUjU,SAAW,CAAE,MAAO,CACzCzD,KAAK0X,UAAY,IACnB,CACF,CAEAjU,OAAAA,GACEzD,KAAKa,QACLb,KAAKe,UAAY,KACjBf,KAAKwX,MAAQ,IACf,EChJK,MCEMmC,GAAsBpM,IACjC,IAAKA,EAAK,OAAO,KAEjB,IAAIqM,EAAM,KACV,GAAIhc,MAAMC,QAAQ0P,EAAI5P,WAAa4P,EAAI5P,SAASU,OAAS,EAAG,CAC1D,MAAMwb,EAAStM,EAAI5P,SAASlV,IAAK+f,GAAMwO,GAAWxO,IAAI5Z,OAAOkrB,SACzDD,EAAOxb,OAAS,IAClBub,EAAM,IAAIG,GAAAA,IAAeF,GACzBD,EAAItb,eAAiB2Y,GAAU1J,EAAIjP,gBACnCsb,EAAII,OAER,CACA,IAAKJ,EAAK,CACR,MAAMrZ,EAAMyW,GAAWzJ,EAAI9P,UAAY+C,GAAAA,IAAQ+X,MAC/CqB,EAAM,IAAItB,GAAAA,IAAO/X,EACnB,CAEA,OADAqZ,EAAIK,OAAOvZ,IAAI,EAAG,GACXkZ,GChBIM,GAAgBA,CAACC,EAAM5F,KAClC,MAAM,SACJxqB,EAAQ,UACRC,EAAS,SACTkX,EAAQ,YACRxX,EAAW,cACXC,EAAa,cACbC,EAAa,gBACbC,EAAe,cACfujB,GACEmH,GAEE,MAAE6F,EAAK,aAAEC,EAAY,YAAEC,EAAW,eAAEC,GAAmBJ,EAE7D,IAAKC,IAAUC,IAAiBC,EAAa,OAG7CF,EAAMI,iBACNH,EAAaG,iBACbF,EAAYE,iBACZD,GAAgBE,OAAOD,iBACvBD,GAAgBzG,OAAO0G,iBAGvB,MAAMnN,EAAUzkB,GAAOuuB,GAAW/J,EAAexkB,GAGjD,IAAI8xB,EAAmB,EACnBC,EAAmB,EAEvB,IAAK,IAAIxX,EAAI,EAAGA,EAAIpZ,EAAWC,EAAWmZ,IAAK,CAC7C,MAAMva,EAAKc,EAAYyZ,GACvB,IAAKva,EAAI,SACT,MAAM2kB,EAAMF,EAAOzkB,GACnB,IAAK2kB,EAAK,SAGV,MAAMqN,EAAWhxB,IAAgBuZ,GAC3B0X,EAAYD,EAAWvN,EAAOuN,GAAY,KAC1CE,EAAgBD,GAAWE,QAC3BC,EAAiC,SAAlBF,GAA8C,UAAlBA,EAC3CG,EAAmC,WAAlBH,GAAgD,UAAlBA,EAC/CI,EAAmBrxB,GAAmBA,EAAgB4B,SAAS0X,GAGrE,IAaIoN,EAbA4K,GAAsB,EACtBH,GAIOC,GAAkBC,GAF3BC,GAAsB,EACtBT,KAMAC,IAIF,IAAId,EAAS,KACb,GAAIzC,GAAW7J,IAAQ8J,GAAU9J,GAE/B,SAKA,GAHI3P,MAAMC,QAAQ0P,EAAI5P,WAAa4P,EAAI5P,SAASU,OAAS,IACvDwb,EAAStM,EAAI5P,SAASlV,IAAK+f,GAAMwO,GAAWxO,IAAI5Z,OAAOkrB,UAErDD,GAAUA,EAAOxb,OAAS,EAC5BkS,EAAS,IAAIwJ,GAAAA,IAAeF,GAC5BtJ,EAAOjS,eAAiB2Y,GAAU1J,EAAIjP,gBACtCiS,EAAOyJ,WACF,CACL,MAAMzZ,EAAMyW,GAAWzJ,EAAI9P,UAAY,KACvC,IAAK8C,EAAK,SACVgQ,EAAS,IAAI+H,GAAAA,IAAO/X,EACtB,CAGF,MAAMlU,EAAK8W,EAAIpZ,EAAYmX,EACrB5U,EAAI0B,KAAKuT,MAAM4B,EAAIpZ,GAAYmX,EACrCqP,EAAOlkB,EAAIA,EACXkkB,EAAOjkB,EAAIA,EACXikB,EAAOhkB,MAAQ2U,EACfqP,EAAO/jB,OAAS0U,EAGZia,GACF5K,EAAO/K,MAAQ,GAEX+U,GAAgBE,MAClBF,EAAeE,MAAMpY,SAASkO,GAE9B6J,EAAM/X,SAASkO,IAIjB6J,EAAM/X,SAASkO,EAEnB,CAEAlf,QAAQuN,IAAI,qCAAsC,CAChDwc,iBAAkBV,EAClBW,iBAAkBV,EAClBW,qBAAsBzxB,GAAiBwU,QAAU,IAInD,IAAK,IAAI8E,EAAI,EAAGA,EAAIpZ,EAAWC,EAAWmZ,IAAK,CAC7C,MAAMva,EAAKe,EAAcwZ,GACzB,IAAKva,GAAMA,EAAG6C,SAAS,UAAW,SAClC,MAAM8hB,EAAMF,EAAOzkB,GACnB,IAAK2kB,EAAK,SAEV,MAAMgD,EAASoJ,GAAmBpM,GAClC,IAAKgD,EAAQ,SAEb,MAAMlkB,EAAK8W,EAAIpZ,EAAYmX,EACrB5U,EAAI0B,KAAKuT,MAAM4B,EAAIpZ,GAAYmX,EACrCqP,EAAOlkB,EAAIA,EACXkkB,EAAOjkB,EAAIA,EACXikB,EAAOhkB,MAAQ2U,EACfqP,EAAO/jB,OAAS0U,IAEMqM,EAAIgO,kBAExBjB,EAAYjY,SAASkO,GAErB8J,EAAahY,SAASkO,EAE1B,GCvHF4I,GAAAA,GAAOqC,iBAAiB,CAAEC,oBAAoB,IAE9C,MAAMC,GAAYA,EAChB3xB,WACAC,YACAkX,WAAW,GACXxX,cAAc,GACdC,gBAAgB,GAChBC,gBAAgB,GAChBC,kBAAkB,GAClBC,uBAAuB,CAAC,EACxBsjB,gBAAgB,GAChBkC,cACAqM,gBACAC,kBACAC,kBACAnsB,2BAA2B,GAC3BgD,gBAAgB,EAChB/C,cAAc,EACdC,cAAc,EACdC,gBAAgB,EAChBxC,cAAc,GACd4C,oBAAmB,EACnBH,aAAa,EACbC,iBAAiB,EACjBG,oBAAmB,EACnBC,kBAAiB,EACjBC,wBAAuB,EACvBC,qBAAoB,MAEpB,MAAMyrB,GAAWC,EAAAA,EAAAA,QAAO,MAClBC,GAASD,EAAAA,EAAAA,QAAO,MAChBE,GAAcF,EAAAA,EAAAA,QAAO,MACrBG,GAAqBH,EAAAA,EAAAA,QAAO,MAC5BI,GAAkBJ,EAAAA,EAAAA,QAAO,GACzBK,GAAoBL,EAAAA,EAAAA,QAAOra,OAAOhS,IAA6B,IAC/D0qB,GAAQ2B,EAAAA,EAAAA,QAAO,MACfM,GAAYN,EAAAA,EAAAA,QAAO,MACnBO,GAAaP,EAAAA,EAAAA,QAAOH,GACpBW,GAAaR,EAAAA,EAAAA,QAAOF,GACpBxB,GAAe0B,EAAAA,EAAAA,QAAO,MACtBzB,GAAcyB,EAAAA,EAAAA,QAAO,MACrBxB,GAAiBwB,EAAAA,EAAAA,QAAO,MACxBS,GAAYT,EAAAA,EAAAA,QAAO,MACnBU,GAAmBV,EAAAA,EAAAA,QAAO,CAAExO,IAAK,KAAMmP,IAAK,OAC5CC,GAAqBZ,EAAAA,EAAAA,QAAO,MAC5Ba,GAAiBb,EAAAA,EAAAA,QAAO,MACxBc,GAAkBd,EAAAA,EAAAA,QAAO,MACzBe,GAAiBf,EAAAA,EAAAA,QAAO,MACxBgB,GAAkBhB,EAAAA,EAAAA,QAAO,MACzBiB,GAAcjB,EAAAA,EAAAA,QAAO,MACrBkB,GAAoBlB,EAAAA,EAAAA,QAAO,CAAEmB,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,QAAS,OAC5EC,GAAsBvB,EAAAA,EAAAA,QAAO,MAC7BwB,GAAuBxB,EAAAA,EAAAA,QAAO,IAAI7b,KAClCsd,GAAqBzB,EAAAA,EAAAA,QAAO,IAC5B0B,GAAsB1B,EAAAA,EAAAA,QAAO,MAC7B2B,IAAe3B,EAAAA,EAAAA,SAA4B,IAArB9rB,GACtB0tB,IAAgB5B,EAAAA,EAAAA,SAA4B,IAArB7rB,GACvB0tB,IAAiB7B,EAAAA,EAAAA,SAA0B,IAAnB5rB,GACxB0tB,IAAkB9B,EAAAA,EAAAA,QAAO,MACzB+B,IAAgB/B,EAAAA,EAAAA,QAAO,CAAEna,EAAG,KAAM1F,KAAM,IAGxC6hB,KAFiBhC,EAAAA,EAAAA,QAAO,OACRA,EAAAA,EAAAA,QAAO,OACRA,EAAAA,EAAAA,QAAO,OACtBiC,IAAejC,EAAAA,EAAAA,QAAO,MACtBkC,IAAalC,EAAAA,EAAAA,QAAO,MACpBmC,IAAanC,EAAAA,EAAAA,QAAO,MACpBoC,IAAgBpC,EAAAA,EAAAA,QAAO,MACvBqC,IAAerC,EAAAA,EAAAA,QAAO,MACtBsC,IAAqBtC,EAAAA,EAAAA,SAAgC,IAAzB3rB,GAC5BkuB,IAAmBvC,EAAAA,EAAAA,SAA6B,IAAtB1rB,GAC1BkuB,IAAgBxC,EAAAA,EAAAA,QAAO,CAAEzuB,SAAS,EAAOkxB,WAAW,EAAO9xB,GAAI,KAGrEsS,EAAAA,EAAAA,WAAU,KAAQ4d,EAAehH,QAAUtG,GAAgB,CAACA,KAC5DtQ,EAAAA,EAAAA,WAAU,KAAQwe,EAAmB5H,QAAUhY,MAAMC,QAAQxQ,GAAeA,EAAc,IAAO,CAACA,KAClG2R,EAAAA,EAAAA,WAAU,KAAQ0e,GAAa9H,SAA+B,IAArB3lB,GAA+B,CAACA,KACzE+O,EAAAA,EAAAA,WAAU,KAAQ2e,GAAc/H,SAA+B,IAArB1lB,GAA+B,CAACA,KAC1E8O,EAAAA,EAAAA,WAAU,KAAQ4e,GAAehI,SAA6B,IAAnBzlB,GAA6B,CAACA,KACzE6O,EAAAA,EAAAA,WAAU,KAAQqf,GAAmBzI,SAAmC,IAAzBxlB,GAAmC,CAACA,KACnF4O,EAAAA,EAAAA,WAAU,KAAQsf,GAAiB1I,SAAgC,IAAtBvlB,GAAgC,CAACA,KAC9E2O,EAAAA,EAAAA,WAAU,KAAQmd,EAAgBvG,QAAUlU,OAAOhP,IAAkB,GAAM,CAACA,KAC5EsM,EAAAA,EAAAA,WAAU,KAAQod,EAAkBxG,QAAUlU,OAAOhS,IAA6B,IAAQ,CAACA,KAC3FsP,EAAAA,EAAAA,WAAU,KAAQsd,EAAW1G,QAAUgG,GAAoB,CAACA,KAC5D5c,EAAAA,EAAAA,WAAU,KAAQud,EAAW3G,QAAUiG,GAAoB,CAACA,IAG5D,MAAM4C,IAAuBC,EAAAA,EAAAA,SAAQ,INrECC,MACtC,IAAIC,EACJ,IAGEA,EAAYxiB,EAAAA,KACd,CAAE,MAAOpT,GACP41B,EAAY,IACd,CAEA,OAAQC,IACN,IAAKD,EAEH,OADAvtB,QAAQkL,KAAK,+CACN,KAET,IAAKsiB,EAAU,CACb,MAAM11B,EAAOy1B,EAAUz1B,OACvB,GAAIA,GAAQA,EAAKkV,OAAQ,CACvB,MAAMhB,EAAMuhB,EAAUz1B,EAAK,IAC3B,OAAOkU,EAAIN,SAAWM,CACxB,CACA,OAAO,IACT,CACA,MACMH,EAAM,KADC2hB,EAASC,MAAM,KAAKxb,QAEjC,IACE,MAAMjG,EAAMuhB,EAAU1hB,GACtB,OAAOG,EAAIN,SAAWM,CACxB,CAAE,MAAOrU,GAEP,MAAMG,EAAOy1B,EAAUz1B,OACvB,GAAIA,GAAQA,EAAKkV,OAAQ,CACvB,MAAMhB,EAAMuhB,EAAUz1B,EAAK,IAC3B,OAAOkU,EAAIN,SAAWM,CACxB,CACA,OAAO,IACT,IMiCyCshB,GAA4B,IACjEta,IAAYqa,EAAAA,EAAAA,SAAQ,INlBMK,EAACh1B,EAAUC,EAAWkX,EAAUxX,EAAa0jB,IACtE,CAAC4R,EAAIC,KAGV,GAAIA,EAAK,EAAG,OAAO,EAEnB,GAAID,EAAK,EAAG,OAAO,EACnB,MAAMlR,EAAK9f,KAAKuT,MAAMyd,EAAK9d,GACrB0M,EAAK5f,KAAKuT,MAAM0d,EAAK/d,GAC3B,GAAI4M,EAAK,GAAKF,EAAK,GAAKE,GAAM/jB,GAAY6jB,GAAM5jB,EAAW,OAAO,EAClE,MACMpB,EAAKc,EADCkkB,EAAK7jB,EAAW+jB,GAE5B,IAAKllB,EAAI,OAAO,EAChB,MAAM2kB,EAAM4J,GAAW/J,EAAexkB,GACtC,IAAK2kB,EAAK,OAAO,EACjB,MAAMuI,EAAIvI,EAAI2R,UACd,QAAKpJ,KACK,IAANA,GACa,kBAANA,MACCA,EAAEqJ,KAAOrJ,EAAEsJ,QAAUtJ,EAAEuJ,MAAQvJ,EAAEwJ,SMDfP,CAAmBh1B,EAAUC,EAAWkX,EAAUxX,EAAa0jB,GAAgB,CAACrjB,EAAUC,EAAWkX,EAAUxX,EAAa0jB,IAGtJmS,IAAkBC,EAAAA,EAAAA,aAAY,KAClC,MAAMC,EAAQxD,EAAYrG,QAC1B,IAAK6J,EAAO,OACPhC,EAAoB7H,UAAS6H,EAAoB7H,QAAU,IAAI9V,IAC/Doc,EAAmBtG,UACtBsG,EAAmBtG,QH7GY8J,EAACC,EAAeC,KACnD,IAAIC,EAAiB,KACjBC,EAAiB,KA6CrB,MAAO,CACLpO,MA5Ca6C,IACb,MAAM,WAAEwD,EAAU,YAAEC,EAAW,IAAE5X,EAAG,MAAE8K,EAAK,OAAE+M,EAAM,qBAAEwG,GAAyBlK,EAEzEsL,IACHA,EAAiB,IAAIvI,GAAmBqI,EAAeC,IAIzD,IAAIG,EAAc,KACd3f,IACF2f,EAActB,EAAuBA,EAAqBre,GAAOA,GAInEyf,EAAenO,MAAM,CACnBqG,aACAC,cACA5X,IAAK2f,EACL7U,MAAOA,GAAS,UAChB+M,OAAQA,GAAU,KAGpB6H,EAAiBD,EAAenI,WAAamI,EAAepI,UAuB5DyB,UApBgBA,CAACQ,EAASzB,KACtB4H,GACFA,EAAe3G,UAAUQ,EAASzB,IAmBpCxU,QAfcA,KACd,GAAIoc,EAAgB,CAClB,IACEA,EAAepc,SACjB,CAAE,MAAOza,GACP,CAEF62B,EAAiB,KACjBC,EAAiB,IACnB,GAOA,UAAIvP,GACF,OAAOsP,GAAgBnI,WAAamI,GAAgBpI,QACtD,EACA,UAAIuI,GACF,OAAOH,CACT,IGqD+BH,CAAsBD,EAAOhC,EAAoB7H,UAGhF,MAAMqK,EAAQ3D,EAAW1G,QACnBsK,EAAU3D,EAAW3G,QACrBqC,EAASmE,EAAkBxG,SAAW,GAE5CsG,EAAmBtG,QAAQlE,MAAM,CAC/BqG,WAAYhuB,EAAWmX,EACvB8W,YAAahuB,EAAYkX,EACzBd,IAAK6f,EACL/U,MAAOgV,EACPjI,SACAwG,2BAED,CAAC10B,EAAUC,EAAWkX,EAAUud,KAwcnC,OArcAzf,EAAAA,EAAAA,WAAU,KACR,IAAImhB,GAAY,EAmUhB,MAjUaC,WACX,MAAMC,EAAM,IAAIC,GAAAA,IAQhB,SAPMD,EAAI5nB,KAAK,CACblM,MAAOxC,EAAWmX,EAClB1U,OAAQxC,EAAYkX,EACpBqf,gBAAiB,EACjBC,WAAW,EACXC,aAAa,IAEXN,EAAgC,YAAnBE,EAAI5c,SAAQ,GAE7BuY,EAAOpG,QAAUyK,EACjBA,EAAIK,MAAMC,kBAAmB,EAG7B,MAAMC,EAAK,IAAI1U,GAAAA,IACT2U,EAAS,IAAI3U,GAAAA,IACbmK,EAAY,IAAInK,GAAAA,IAChBqK,EAAW,IAAIrK,GAAAA,IACf4U,EAAmB,IAAI5U,GAAAA,IACvB6U,EAAmB,IAAI7U,GAAAA,IACvB8U,EAAc,IAAI9U,GAAAA,IAClB+U,EAAe,IAAI/U,GAAAA,IACnBgV,EAAc,IAAIhV,GAAAA,IAClBiV,EAAgB,IAAIjV,GAAAA,IACpBkV,EAAW,IAAIlV,GAAAA,IACfmV,EAAY,IAAInV,GAAAA,IAChBoV,EAAe,IAAIpV,GAAAA,IAGnByT,EAAgB,IAAIzT,GAAAA,IAC1ByT,EAAcpoB,OAASgqB,GAAOnL,SAC9BwK,EAAGrpB,OAASgqB,GAAO1K,MACnBgK,EAAOtpB,OAASgqB,GAAOzK,UACvBT,EAAU9e,OAASgqB,GAAOlL,UAC1BE,EAAShf,OAASgqB,GAAOhL,SACzBuK,EAAiBvpB,OAASgqB,GAAOjL,aACjCyK,EAAiBxpB,OAASgqB,GAAO/K,aACjCwK,EAAYzpB,OAASgqB,GAAOrtB,OAC5B+sB,EAAa1pB,OAASgqB,GAAO9K,QAC7B2K,EAAS7pB,OAASgqB,GAAO7K,IACzBwK,EAAY3pB,OAASgqB,GAAO5K,QAC5BwK,EAAc5pB,OAASgqB,GAAO3K,SAC9ByK,EAAU9pB,OAASgqB,GAAOl0B,YAC1Bi0B,EAAa/pB,OAASgqB,GAAO3rB,QAE7BwkB,EAAMxE,QAAUgL,EAChBvE,EAAUzG,QAAUiL,EACpBxG,EAAazE,QAAUS,EACvBiE,EAAY1E,QAAUW,EACtBgE,EAAe3E,QAAU,CAAE6E,MAAOqG,EAAkBhN,MAAOiN,GAC3DlE,EAAgBjH,QAAUqL,EAC1BnE,EAAelH,QAAUsL,EACzBlE,EAAYpH,QAAUwL,EACtB9D,EAAoB1H,QAAUyL,EAC9BxD,GAAgBjI,QAAU0L,EAC1BrF,EAAYrG,QAAU+J,EAGtBU,EAAIK,MAAMre,SAASsd,EAAetJ,EAAWyK,EAAkBE,EAAaK,EAAW9K,EAAUwK,EAAkBE,EAAcG,EAAUF,EAAaC,EAAeP,EAAIC,EAAQS,GAGnL,IACE,MAAME,EAAS,IAAI5N,IACb6N,EAAUjZ,IAAyB,kBAANA,GAAkBA,EAAEnK,QAAQmjB,EAAOE,IAAIlZ,IAC1E4E,EAAc7hB,QAASgiB,IACrBkU,EAAOlU,GAAK9P,SACRG,MAAMC,QAAQ0P,GAAK5P,WAAW4P,EAAI5P,SAASpS,QAAQk2B,KAErD9F,IACF8F,EAAO9F,EAAcle,SACjBG,MAAMC,QAAQ8d,EAAche,WAAWge,EAAche,SAASpS,QAAQk2B,IAE5E,MAAMxB,EAAQxB,GAAqBnC,EAAW1G,SAC1CqK,GAAOwB,EAAOxB,GAClB,MAAM0B,EAAO/jB,MAAM6C,KAAK+gB,GACpBG,EAAKtjB,SACPhN,QAAQuN,IAAI,yBAA0B+iB,EAAKtjB,OAAQ,qBAC7C8a,GAAAA,GAAOE,KAAKsI,GAClBtwB,QAAQuN,IAAI,+CAEhB,CAAE,MAAO5V,IACPqI,QAAQkL,KAAK,yDAA0DvT,GACzE,CAGA,MAAM44B,EFjMyBC,EAAClG,EAAevO,EAAekC,EAAapO,KAC/E,MAAM4gB,EAAkB,IAAI5V,GAAAA,IAGtB6V,EAAapG,GAAiB,KAG9BqG,EAAYpkB,MAAMC,QAAQuP,GAC3BA,EAAcjP,KAAKC,GAAc,sBAATA,EAAExV,KAA+BwkB,EAAcjP,KAAKC,GAAc,kBAATA,EAAExV,IACpF,KAEEq5B,EAAYtI,GAAmBoI,IAAe,IAAIzJ,GAAAA,IAAO9X,GAAAA,IAAQ+X,OACjE2J,EAAYvI,GAAmBqI,IAAc,KAEnDF,EAAgBzf,SAAS4f,GACrBC,GAAWJ,EAAgBzf,SAAS6f,GAGxC,IAAIC,EAAY,KAChB,IACEA,EAAY,IAAI7N,GAAU,CACxB/nB,MAAQ+iB,GAAa/iB,OAAU2U,EAC/B1U,OAAQ,EACRioB,QAAS,EACTC,SAAU,IAEZoN,EAAgBzf,SAAS8f,EAC3B,CAAE,MAAOn5B,IACPqI,QAAQkL,KAAK,+BAAgCvT,GAC/C,CAMA,OAHAi5B,EAAUpM,SAAU,EAChBqM,IAAWA,EAAUrM,SAAU,GAE5B,CACL9U,UAAW+gB,EACXM,QAAS,CAAE7U,IAAK0U,EAAWvF,IAAKwF,GAChCC,cE2J2BN,CAAsBlG,EAAevO,EAAekC,EAAapO,GAC1F8f,EAAY3e,SAASuf,EAAiB7gB,WACtCyb,EAAU5G,QAAUgM,EAAiB7gB,UACrC0b,EAAiB7G,QAAUgM,EAAiBQ,QAC5CzF,EAAmB/G,QAAUgM,EAAiBO,UAG1CrG,EAASlG,UACXkG,EAASlG,QAAQyM,UAAY,GAC7BvG,EAASlG,QAAQ0M,YAAYjC,EAAI5X,SAInC,MAAM7G,EAAI,IAAIC,GAAAA,IACdyf,EAAajf,SAAST,GACtBkc,GAAclI,QAAQhU,EAAIA,EAC1B,MAAMmF,EAAIhd,EAAWmX,EACf4I,EAAI9f,EAAYkX,EACtBU,EAAEf,QACFe,EAAEG,UAAU,QAAU,GACtBH,EAAEI,SAAS,EAAG,EAAG+E,EAAG+C,GACpBlI,EAAEK,UACFL,EAAE4D,MAAQ,EACV5D,EAAEiU,SAAU,EAGZ,MAAM0M,GAAY,IAAIjO,GAAU,CAAE/nB,MAAQ+iB,GAAa/iB,OAAU2U,EAAU1U,OAAQ,EAAGioB,QAAS,EAAGC,QAAS,IAC3G6N,GAAU1M,SAAU,EACpByL,EAAajf,SAASkgB,IACtBxE,GAAanI,QAAU2M,GAEvB,MACMC,GAAS,IAAIlO,GAAU,CAAE/nB,MAAQ+iB,GAAa/iB,OAAU2U,EAAU1U,OAAQ,EAAGioB,QAAS,EAAGC,QAAS,EAAG3f,OADzF,CAAE6f,GAAI,QAAUrY,KAAM,QAAUrH,OAAQ,WAE1DstB,GAAO3M,SAAU,EACjByL,EAAajf,SAASmgB,IACtBxE,GAAapI,QAAU4M,GAEvB,MACMC,GAAQ,IAAInO,GAAU,CAAE/nB,MAAQ+iB,GAAa/iB,OAAU2U,EAAU1U,OAAQ,EAAGioB,QAAS,EAAGC,QAAS,EAAG3f,OADvF,CAAE6f,GAAI,SAAUrY,KAAM,SAAUrH,OAAQ,YAE3DutB,GAAM5M,SAAU,EAChByL,EAAajf,SAASogB,IACtBxE,GAAWrI,QAAU6M,GAGjBpC,EAAI5X,SACN4X,EAAI5X,OAAOia,iBAAiB,mBAAqB15B,IAC/CA,EAAE25B,iBACFtxB,QAAQkL,KAAK,wBAEf8jB,EAAI5X,OAAOia,iBAAiB,uBAAwB,KAClDrxB,QAAQgE,KAAK,0BACb6kB,GACE,CAAEE,MAAOA,EAAMxE,QAASyE,aAAcA,EAAazE,QAAS0E,YAAaA,EAAY1E,QAAS2E,eAAgBA,EAAe3E,SAC7H,CAAE7rB,WAAUC,YAAWkX,WAAUxX,cAAaC,gBAAeC,gBAAeC,kBAAiBujB,kBAE/FmS,KACA,IACMxC,EAAgBnH,SAASmH,EAAgBnH,QAAQnS,UACrDsZ,EAAgBnH,QAAU,IAAI/G,GAAmBiO,EAAelH,QAAS,CAAE7rB,WAAUC,YAAWkX,aAChG6b,EAAgBnH,QAAQlE,MAAM,CAAE3nB,WAAUC,YAAWkX,WAAUxX,cAAa0jB,iBAC9E,CAAE,MAAOpkB,IAAKqI,QAAQkL,KAAK,qCAAsCvT,GAAI,CACrE,IAAMm1B,GAAcvI,SAASzI,gBAAgB,CAAEpjB,WAAUC,YAAWkX,WAAUxX,cAAa0jB,iBAAkB,CAAE,MAAO,KAK1H8M,GACE,CAAEE,MAAOA,EAAMxE,QAASyE,aAAcA,EAAazE,QAAS0E,YAAaA,EAAY1E,QAAS2E,eAAgBA,EAAe3E,SAC7H,CAAE7rB,WAAUC,YAAWkX,WAAUxX,cAAaC,gBAAeC,gBAAeC,kBAAiBujB,kBAI/F,IACM2P,EAAgBnH,SAASmH,EAAgBnH,QAAQnS,UACrDsZ,EAAgBnH,QAAU,IAAI/G,GAAmBiO,EAAelH,QAAS,CAAE7rB,WAAUC,YAAWkX,aAChG6b,EAAgBnH,QAAQlE,MAAM,CAAE3nB,WAAUC,YAAWkX,WAAUxX,cAAa0jB,iBAC9E,CAAE,MAAOpkB,IAAKqI,QAAQkL,KAAK,kCAAmCvT,GAAI,CAGlE,IAAMk1B,GAAWtI,QAAU,IAAI5J,GAAcmV,EAAgB,CAAE,MAAO,CACtE,IAAM/C,GAAaxI,QAAU,IAAInH,GAAY0S,EAAgB,CAAE,MAAO,CACtE,IACEhD,GAAcvI,QAAU,IAAI9I,GAAWgQ,EAAelH,QAAS,CAAE7rB,WAAUC,YAAWkX,YAAY,IAAOod,GAAiB1I,QAAU,IAAM,GAC1IuI,GAAcvI,QAAQzI,gBAAgB,CAAEpjB,WAAUC,YAAWkX,WAAUxX,cAAa0jB,iBACtF,CAAE,MAAO,CAETmS,KAGAc,EAAIuC,OAAOlB,IAAI,KACb,MAAMjV,EAAImQ,EAAehH,QACrBnJ,GAAK+P,EAAU5G,SFjPOiN,EAAC1I,EAAM7K,EAAapO,EAAUjR,KAC9D,MAAM,UAAE8Q,EAAS,QAAEqhB,EAAO,UAAED,GAAchI,EAC1C,IAAK7K,IAAgBvO,EAAW,OAEhC,MAAM,IAAEwM,EAAG,IAAEmP,GAAQ0F,GAAW,CAAC,EAajC,GAVI7U,IACE+B,EAAY/iB,QAAOghB,EAAIhhB,MAAQ+iB,EAAY/iB,OAC3C+iB,EAAY9iB,SAAQ+gB,EAAI/gB,OAAS8iB,EAAY9iB,SAE/CkwB,IACEpN,EAAY/iB,QAAOmwB,EAAInwB,MAAQ+iB,EAAY/iB,OAC3C+iB,EAAY9iB,SAAQkwB,EAAIlwB,OAAS8iB,EAAY9iB,SAI/C21B,EAAW,CACb,MAAM9yB,GAA+B,IAArBY,EACV3C,IAAYgiB,EAAYhiB,QACxBw1B,EAAoC,SAA3BxT,EAAY7hB,WAC3B,GAAK4B,EAEE,CAEL8yB,EAAUtM,UAAYvoB,GAAWw1B,GACjC,MAAMC,EAAiBzT,EAAY/iB,OAAUghB,GAAKhhB,OAAU2U,EAC5DihB,EAAUta,OAAOkb,EAAgB,GACjCZ,EAAU71B,GAAK0B,KAAKC,IAAI,EAAGD,KAAKuT,MAAwD,KAAjD+N,EAAY9iB,QAAU+gB,GAAK/gB,QAAU0U,KAC5EihB,EAAU3f,OAAO8M,EAAYxiB,OAAS4U,OAAO4N,EAAYviB,YAAc,IACzE,MAREo1B,EAAUtM,SAAU,CASxB,CAGA,MAAMmN,EAAQthB,OAAO4N,EAAY5hB,YAAc,KAAOgvB,EAClDnP,IAAKA,EAAIsI,SAAWmN,GACpBtG,IAAKA,EAAI7G,QAAUmN,GAGvB,MAAMC,EAAM3T,EAAY1iB,WAAa,EAC/Bs2B,EAAMl1B,KAAKuW,IAAIxD,EAAUmS,MAAM7mB,GAAK,GAC1C0U,EAAUmS,MAAM7mB,EAAI42B,GAAO,EAAIC,GAAOA,EAGtC,MAAMH,EAAiBzT,EAAY/iB,OAAUghB,GAAKhhB,OAAU2U,EAC5DH,EAAU1U,EAAI42B,GAAO,EAAK3T,EAAYjjB,GAAK,GAAOijB,EAAYjjB,GAAK,GAAK02B,EACxEhiB,EAAUzU,EAAIgjB,EAAYhjB,GAAK,GEoMvBu2B,CACE,CAAE9hB,UAAWyb,EAAU5G,QAASwM,QAAS3F,EAAiB7G,QAASuM,UAAWxF,EAAmB/G,SACjGnJ,EACAvL,EACAwc,GAAa9H,SAKjB,MAAMzQ,EAAIiX,EAAkBxG,QACtBuN,EAAOhH,EAAgBvG,SAAW,EACpCsG,EAAmBtG,SACrBsG,EAAmBtG,QAAQsD,UAAUiK,EAAMhe,GAI7C,MAAMzB,EAAK2c,EAAIuC,QAAQQ,SAAW,MAC5BC,EAAUpG,EAAkBrH,QAC9ByN,EAAQnG,MAAMmG,EAAQnG,KAAK1a,OAAOkB,GAClC2f,EAAQlG,MAAMkG,EAAQlG,KAAK3a,OAAOkB,GAClC2f,EAAQjG,QAAQiG,EAAQjG,OAAO5a,OAAOkB,GACtC2f,EAAQ3M,KAAK2M,EAAQ3M,IAAIlU,OAAOkB,GAChC2f,EAAQhG,SAASgG,EAAQhG,QAAQ7a,OAAOkB,GAG5C,IACMqZ,EAAgBnH,SAAWnJ,GAC7BsQ,EAAgBnH,QAAQvG,eAAe5C,GAEzCsQ,EAAgBnH,SAASpT,OAAOkB,EAClC,CAAE,MAAO,CAGT,IAAMya,GAAcvI,SAASpT,OAAOkB,EAAK,CAAE,MAAO,CAClD,IAAMwa,GAAWtI,SAASpT,OAAOkB,EAAK,CAAE,MAAO,CAC/C,IAAM0a,GAAaxI,SAASpT,OAAOkB,EAAK,CAAE,MAAO,CAGjD,IACE,MAAM8E,EAAIsV,GAAclI,QAClB0N,EAAO1G,EAAehH,SAAW,CAAC,EACxC,GAAIpN,GAAKA,EAAE5G,EAAG,CAEZ,MADqB0hB,IAAQA,EAAK/1B,gBAAsC,UAApB+1B,EAAK71B,YAC1C,CACb+a,EAAEtM,MAAQwH,EACV,MAAMqE,EAAQ,IAAO,IAAO/Z,KAAKoX,IAAa,MAAToD,EAAEtM,MACvCsM,EAAE5G,EAAEiU,SAAU,EACdrN,EAAE5G,EAAE4D,MAAQuC,CACd,MAAWS,EAAE5G,EAAEiU,UACbrN,EAAE5G,EAAE4D,OAAS,IACTgD,EAAE5G,EAAE4D,MAAQ,MAAQgD,EAAE5G,EAAE4D,MAAQ,EAAGgD,EAAE5G,EAAEiU,SAAU,GAEzD,CAGA,IACE,MAAMzB,EAAOmK,GAAc3I,SAAW,CAAEtoB,SAAS,EAAOkxB,WAAW,EAAO9xB,GAAI,GACxE62B,IAAeD,EAAKh2B,QACpBk2B,EAAYF,EAAK71B,WACjB4jB,GAAWiS,EAAKj3B,GAAK,GAAgC,IAA1Bi3B,EAAK/2B,OAAS2U,GAE/C,GAAImd,GAAmBzI,SAAyB,UAAd4N,GAAyBD,IAAenP,EAAK9mB,QAAS,CACtF,MAAMm2B,EAAK1G,EAAgBnH,SAAS9F,cAAc,QAASuB,GACrD3kB,EAAKgV,OAAO4hB,EAAK52B,KAAO,EACxBuX,EAAWjW,KAAKE,IAAI,EAAGF,KAAKC,IAAI,GAAoB,IAAfD,KAAKuW,IAAI7X,KACpDwxB,GAAWtI,SAASrJ,QAAQ,CAAElgB,EAAGglB,EAAS/kB,EAAIoV,OAAOsC,SAASyf,GAAMA,EAAMH,EAAKh3B,GAAK,EAAK2X,WAAUuI,QAAQ,IAC3G,IAAMuQ,EAAgBnH,SAASvB,UAAU,QAAShD,EAASrjB,KAAKE,IAAI,IAAK,GAAqB,IAAfF,KAAKuW,IAAI7X,IAAc,CAAE,MAAO,CACjH,CACA,GAAI2xB,GAAmBzI,SAAWxB,EAAK9mB,UAAYi2B,EAAY,CAC7D,MAAME,EAAK1G,EAAgBnH,SAAS9F,cAAc,QAASuB,GACrD3kB,EAAKgV,OAAO4hB,EAAK52B,KAAO,EACxBuX,EAAWjW,KAAKE,IAAI,EAAGF,KAAKC,IAAI,GAAoB,IAAfD,KAAKuW,IAAI7X,KACpDwxB,GAAWtI,SAASrJ,QAAQ,CAAElgB,EAAGglB,EAAS/kB,EAAIoV,OAAOsC,SAASyf,GAAMA,EAAMH,EAAKh3B,GAAK,EAAK2X,WAAUuI,QAAQ,IAC3G,IAAMuQ,EAAgBnH,SAASvB,UAAU,QAAShD,EAASrjB,KAAKE,IAAI,EAAK,GAAqB,IAAfF,KAAKuW,IAAI7X,IAAc,CAAE,MAAO,CACjH,CACA6xB,GAAc3I,QAAU,CAAEtoB,QAASi2B,EAAY/E,YAAa8E,EAAK/1B,eAAgBb,GAAIgV,OAAO4hB,EAAK52B,KAAO,EAC1G,CAAE,MAAO,CACX,CAAE,MAAO,CAGT,IACE,MAAMg3B,EAAK9G,EAAehH,SAAW,CAAC,EAChC+N,EAAQD,EAAGn3B,OAAS2U,EACpB0iB,EAAQF,EAAGl3B,QAAU0U,EACrB2iB,EAAc71B,KAAKC,IAAI,EAAGD,KAAKuT,MAAa,IAAPqiB,IACrCE,EAASJ,EAAGr3B,GAAK,EACjB03B,GAASL,EAAGp3B,GAAK,GAAKu3B,EAEtBG,EAAMjG,GAAanI,QACzB,GAAIoO,EAAK,CACP,MACMC,GADmC,IAAzBvG,GAAa9H,YACF8N,EAAGp2B,SAA6B,SAAlBo2B,EAAGj2B,YAC5Cu2B,EAAInO,UAAYoO,EACZA,IACFD,EAAI33B,EAAIy3B,EACRE,EAAI13B,EAAIy3B,EACRC,EAAInc,OAAO8b,EAAM,GACjBK,EAAIxhB,OAAOkhB,EAAG52B,OAAS4U,OAAOgiB,EAAG32B,YAAc,KAEnD,CAEA,IAAIm3B,EAAWH,EACXC,GAAOA,EAAInO,UAASqO,GAAY,GAEpC,MAAM1B,EAASxE,GAAapI,QAC5B,GAAI4M,EAAQ,CACV,MAAMnzB,GAAoC,IAA1BsuB,GAAc/H,QACxBuO,EAASn2B,KAAKC,IAAI,EAAGyT,OAAOgiB,EAAGx2B,YAAc,KAC7Ck3B,EAASp2B,KAAKC,IAAI,EAAGyT,OAAOgiB,EAAGz2B,SAC/Bg3B,EAAO50B,IAA+B,UAAlBq0B,EAAGj2B,YAA0Bi2B,EAAGp2B,SAAa82B,EAASD,GAChF3B,EAAO3M,UAAYoO,EACfA,IACFzB,EAAOn2B,EAAIy3B,EACXtB,EAAOl2B,EAAI43B,EACX1B,EAAO3a,OAAO8b,EAAM,GACpBnB,EAAOhgB,OAAQd,OAAOsC,SAASogB,GAAUA,EAASD,EAASA,GAC3DD,GAAY,EAEhB,CAEA,MAAMzB,EAAQxE,GAAWrI,QACzB,GAAI6M,EAAO,CACT,MAAMpzB,GAAqC,IAA3BuuB,GAAehI,QACzByO,EAAQr2B,KAAKC,IAAI,EAAGyT,OAAOgiB,EAAGt2B,gBAAkB,KAChDk3B,EAAQt2B,KAAKC,IAAI,EAAGyT,OAAOgiB,EAAGv2B,aAC9B82B,EAAO50B,IAA8B,SAAlBq0B,EAAGj2B,YAA0B62B,EAAQD,GAC9D5B,EAAM5M,UAAYoO,EACdA,IACFxB,EAAMp2B,EAAIy3B,EACVrB,EAAMn2B,EAAI43B,EACVzB,EAAM5a,OAAO8b,EAAM,GACnBlB,EAAMjgB,OAAQd,OAAOsC,SAASsgB,GAASA,EAAQD,EAAQA,GAE3D,CACF,CAAE,MAAO,CCzbcE,EAACC,EAAkBC,EAAsBC,EAAiBtX,EAAelM,KACtG,IAAKsjB,EAAkB,OAEvB,MAAM/7B,EAAMg8B,EACNE,EAAOD,GAAmB,GAC1BE,EAAO,IAAIhR,IAGjB,IAAK,IAAIzQ,EAAI,EAAGA,EAAIwhB,EAAKtmB,OAAQ8E,IAAK,CACpC,MAAMtU,EAAI81B,EAAKxhB,GACTpR,EAAMlD,EAAEjG,GACdg8B,EAAKlD,IAAI3vB,GAET,IAAI6nB,EAAMnxB,EAAI0X,IAAIpO,GAClB,IAAK6nB,EAAK,CAER,MAAMrM,EAAM4J,GAAW/J,EAAeve,EAAEg2B,OACxC,GAAItX,GAAO3P,MAAMC,QAAQ0P,EAAI5P,WAAa4P,EAAI5P,SAASU,OAAS,EAAG,CACjE,MAAMwb,EAAStM,EAAI5P,SAASlV,IAAK+f,GAAMwO,GAAWxO,IAAI5Z,OAAOkrB,SACzDD,EAAOxb,OAAS,IAClBub,EAAM,IAAIG,GAAAA,IAAeF,GACzBD,EAAItb,eAAiB2Y,GAAU1J,EAAIjP,gBACnCsb,EAAII,OAER,CACA,IAAKJ,EAAK,CACR,MAAMrZ,EAAMyW,GAAWG,GAAW/J,EAAeve,EAAEg2B,QAAQpnB,UAAY+C,GAAAA,IAAQ+X,MAC/EqB,EAAM,IAAItB,GAAAA,IAAO/X,EACnB,CACAqZ,EAAIK,OAAOvZ,IAAI,GAAK,IACpBkZ,EAAIrtB,MAAQyB,KAAKC,IAAI,EAAGY,EAAEqX,GAAgB,IAAXhF,GAC/B0Y,EAAIptB,OAASwB,KAAKC,IAAI,EAAGY,EAAEsX,GAAgB,IAAXjF,GAChCsjB,EAAiBniB,SAASuX,GAC1BnxB,EAAIiY,IAAI3O,EAAK6nB,EACf,CAGAA,EAAIvtB,EAAIwC,EAAExC,GAAKwC,EAAEo0B,IAAW,GAC5BrJ,EAAIttB,EAAIuC,EAAEvC,EACV,MAAM42B,EAAMl1B,KAAKuW,IAAIqV,EAAI1G,MAAM7mB,GAAK,GACpCutB,EAAI1G,MAAM7mB,EAAIwC,EAAEo0B,KAAO,EAAIC,GAAOA,CACpC,CAGA,IAAK,MAAOnxB,EAAK6nB,KAAQnxB,EAAIwrB,UAC3B,IAAK2Q,EAAKtkB,IAAIvO,GAAM,CAClB,IACE6nB,EAAIrW,QAAUqW,EAAIrW,OAAOC,YAAYoW,EACvC,CAAE,MAAO5wB,IACP,CAEF,IACE4wB,EAAInW,SAAWmW,EAAInW,SACrB,CAAE,MAAOza,IACP,CAEFP,EAAImY,OAAO7O,EACb,GDmYIwyB,CAAgBjH,EAAoB1H,QAAS2H,EAAqB3H,QAAS4H,EAAmB5H,QAASxI,EAAelM,MAI1HzI,GAEO,KACL0nB,GAAY,EACRnE,EAAOpG,UACToG,EAAOpG,QAAQnS,SAAQ,GACvBuY,EAAOpG,QAAU,MAEnB,IAAMmH,EAAgBnH,SAASnS,SAAW,CAAE,MAAO,CACnD,IAAMya,GAAWtI,SAASnS,SAAW,CAAE,MAAO,CAC9C,IAAM0a,GAAcvI,SAASnS,SAAW,CAAE,MAAO,CACjD,IAAM2a,GAAaxI,SAASnS,SAAW,CAAE,MAAO,CAChD,IAAMyY,EAAmBtG,SAASnS,SAAW,CAAE,MAAO,CACtDyY,EAAmBtG,QAAU,KAC7B,IAAM6H,EAAoB7H,SAAS/U,SAAW,CAAE,MAAO,CACvD,IACEoc,EAAkBrH,QAAQsH,MAAMzZ,UAChCwZ,EAAkBrH,QAAQuH,MAAM1Z,UAChCwZ,EAAkBrH,QAAQc,KAAKjT,SACjC,CAAE,MAAO,CCrZoBghB,KACjC,IACE,IAAK,MAAM7K,KAAO6K,EAAqBK,SAAU,CAC/C,IACElL,EAAIrW,QAAUqW,EAAIrW,OAAOC,YAAYoW,EACvC,CAAE,MAAO5wB,GACP,CAEF,IACE4wB,EAAInW,SAAWmW,EAAInW,SACrB,CAAE,MAAOza,GACP,CAEJ,CACAy7B,EAAqB5jB,OACvB,CAAE,MAAO7X,GACP,GDsYE+7B,CAAmBxH,EAAqB3H,SN5b5CmB,GAAgBxrB,QAASuO,GAAMA,EAAE2J,SAAW3J,EAAE2J,SAAQ,IACtDsT,GAAgBlW,UM8bb,CAAC9W,EAAUC,EAAWkX,EAAUya,KAGnC3c,EAAAA,EAAAA,WAAU,KAER,GADYgd,EAAOpG,SAEfwE,EAAMxE,SAAWyE,EAAazE,SAAW0E,EAAY1E,QAAS,CAChEsE,GACE,CAAEE,MAAOA,EAAMxE,QAASyE,aAAcA,EAAazE,QAAS0E,YAAaA,EAAY1E,QAAS2E,eAAgBA,EAAe3E,SAC7H,CAAE7rB,WAAUC,YAAWkX,WAAUxX,cAAaC,gBAAeC,gBAAeC,kBAAiBujB,kBAI/F,IACM2P,EAAgBnH,SAASmH,EAAgBnH,QAAQnS,UACjDqZ,EAAelH,UACjBmH,EAAgBnH,QAAU,IAAI/G,GAAmBiO,EAAelH,QAAS,CAAE7rB,WAAUC,YAAWkX,aAChG6b,EAAgBnH,QAAQlE,MAAM,CAAE3nB,WAAUC,YAAWkX,WAAUxX,cAAa0jB,kBAEhF,CAAE,MAAOpkB,GAAKqI,QAAQkL,KAAK,qCAAsCvT,EAAI,CACrE,IAAMm1B,GAAcvI,SAASzI,gBAAgB,CAAEpjB,WAAUC,YAAWkX,WAAUxX,cAAa0jB,iBAAkB,CAAE,MAAO,CACxH,GACC,CAAC1jB,EAAaC,EAAeG,EAAsBsjB,EAAerjB,EAAUC,EAAWkX,EAAUtX,EAAeC,KAGnHmV,EAAAA,EAAAA,WAAU,KACR,MAAMqhB,EAAMrE,EAAOpG,QACbqL,EAAepE,EAAgBjH,QAC/BwL,EAAWpE,EAAYpH,QAC7B,IAAKyK,IAAQY,IAAiBG,EAAU,OAExC,MAAMpgB,EAAM,CACVqD,aACAta,WACAC,YACAkX,WACA4C,kBAAmBA,CAAClS,EAAMvF,KACxB,IAAM,OAAO0wB,EAAgBnH,SAAS9F,cAAcle,EAAMvF,EAAI,CAAE,MAAQ,OAAO,IAAM,GAEvF6X,cAAeA,EAAG7X,IAAG4X,WAAW,OAC9B,IACE,MAAMwf,EAAK1G,EAAgBnH,SAAS9F,cAAc,QAASzjB,GACvDqV,OAAOsC,SAASyf,IAAKvF,GAAWtI,SAASrJ,QAAQ,CAAElgB,IAAGC,EAAGm3B,EAAIxf,SAAUjW,KAAKC,IAAI,GAAKD,KAAKE,IAAI,EAAG+V,IAAYuI,QAAQ,IACzH,IAAMuQ,EAAgBnH,SAASvB,UAAU,QAAShoB,EAAG2B,KAAKC,IAAI,GAAKD,KAAKE,IAAI,IAAK+V,IAAa,CAAE,MAAO,CACzG,CAAE,MAAO,GAEXG,aAAcA,EAAG/X,IAAGC,IAAG2X,WAAW,OAChC,IACE,MAAMwf,EAAK1G,EAAgBnH,SAAS9F,cAAc,OAAQzjB,GACpD24B,EAAKtjB,OAAOsC,SAAS1X,GAAKA,EAAKoV,OAAOsC,SAASyf,GAAMA,EAAK,KACtD,MAANuB,GAAY5G,GAAaxI,SAASrJ,QAAQ,CAAElgB,IAAGC,EAAG04B,EAAI/gB,YAC5D,CAAE,MAAO,IAIPghB,EAAmBA,IAAMj3B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAO/R,IAAgB,IAC1Eu1B,EAAmBA,IAAMl3B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAO9R,IAAgB,IAC1Eu1B,EAAqBA,IAAMn3B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAO7R,IAAkB,IAC9Eu1B,EAAsBA,IAAMp3B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKwT,OAAO3R,IAAmB,IAGtF,IAAMktB,EAAkBrH,QAAQsH,MAAMzZ,SAAW,CAAE,MAAO,CAC1D,IAAMwZ,EAAkBrH,QAAQuH,MAAM1Z,SAAW,CAAE,MAAO,CAC1D,IAAMwZ,EAAkBrH,QAAQwH,QAAQ3Z,SAAW,CAAE,MAAO,CAC5D,IAAMwZ,EAAkBrH,QAAQc,KAAKjT,SAAW,CAAE,MAAO,CACzD,IAAMwZ,EAAkBrH,QAAQyH,SAAS5Z,SAAW,CAAE,MAAO,CAC7DwZ,EAAkBrH,QAAQsH,KAAO,KACjCD,EAAkBrH,QAAQuH,KAAO,KACjCF,EAAkBrH,QAAQwH,OAAS,KACnCH,EAAkBrH,QAAQc,IAAM,KAChCuG,EAAkBrH,QAAQyH,QAAU,KAGhC4H,IAAqB,IACvBhI,EAAkBrH,QAAQsH,KAAO,IAAIpc,GAAYmgB,EAAcjgB,EAAKikB,GACpEhI,EAAkBrH,QAAQsH,KAAK1b,aAAayjB,MAI1CC,IAAqB,IACvBjI,EAAkBrH,QAAQuH,KAAO,IAAIzY,GAAYuc,EAAcjgB,EAAKkkB,GACpEjI,EAAkBrH,QAAQuH,KAAK3b,aAAa0jB,MAI1CC,IAAuB,IACzBlI,EAAkBrH,QAAQwH,OAAS,IAAI3X,GAAc2b,EAAUpgB,EAAKmkB,GACpElI,EAAkBrH,QAAQwH,OAAO5b,aAAa2jB,MAI5CzjB,OAAO5R,GAAc,IACvBmtB,EAAkBrH,QAAQc,IAAM,IAAIxP,GAAWka,EAAUpgB,EAAK,IAAMU,OAAO5R,IAAe,GAC1FmtB,EAAkBrH,QAAQc,IAAIlV,aAAaE,OAAO5R,IAAe,IAI/Ds1B,IAAwB,IAC1BnI,EAAkBrH,QAAQyH,QAAU,IAAIpU,GAAemY,EAAUpgB,EAAKokB,GACtEnI,EAAkBrH,QAAQyH,QAAQ7b,aAAa4jB,OAEhD,CAACz1B,EAAaC,EAAaC,EAAeC,EAAYC,EAAgBhG,EAAUC,EAAWkX,KAG9FlC,EAAAA,EAAAA,WAAU,KACRugB,MACC,CAAC3D,EAAiBC,EAAiB0D,MAE/B7kB,EAAAA,GAAAA,KAAA,OAAK2qB,IAAKvJ,EAAUxhB,MAAO,CAAE/N,MAAO,OAAQC,OAAQ,WAG7DkvB,GAAU4J,UAAY,CACpBv7B,SAAUw7B,KAAAA,OAAiBC,WAC3Bx7B,UAAWu7B,KAAAA,OAAiBC,WAC5BtkB,SAAUqkB,KAAAA,OACV77B,YAAa67B,KAAAA,MACb57B,cAAe47B,KAAAA,MACf37B,cAAe27B,KAAAA,MACf17B,gBAAiB07B,KAAAA,MACjBz7B,qBAAsBy7B,KAAAA,OACtBnY,cAAemY,KAAAA,MACfjW,YAAaiW,KAAAA,OACb5J,cAAe4J,KAAAA,OACf3J,gBAAiB2J,KAAAA,OACjB1J,gBAAiB0J,KAAAA,OACjB71B,yBAA0B61B,KAAAA,OAC1B7yB,cAAe6yB,KAAAA,OACf51B,YAAa41B,KAAAA,OACb31B,YAAa21B,KAAAA,OACb11B,cAAe01B,KAAAA,OACfl4B,YAAak4B,KAAAA,MACbt1B,iBAAkBs1B,KAAAA,KAClBz1B,WAAYy1B,KAAAA,OACZx1B,eAAgBw1B,KAAAA,OAChBr1B,iBAAkBq1B,KAAAA,KAClBp1B,eAAgBo1B,KAAAA,KAChBn1B,qBAAsBm1B,KAAAA,KACtBl1B,kBAAmBk1B,KAAAA,MAGrB,YEzlBO,SAASE,GAAoBC,EAAY97B,EAAeG,EAAUC,EAAWojB,GAClF,MAAMuY,EAAgB/7B,EAAc87B,GACpC,IAAKC,EAAe,MAAO,GAE3B,MAAMC,EAAWxY,EAAcjP,KAAKC,GAAKA,EAAExV,KAAO+8B,GAClD,IAAKC,GAA8B,WAAlBA,EAASh0B,KAAmB,MAAO,GAEpD,MAAMkgB,EAAU,IAAI8B,IACdiS,EAAS,GACT3T,EAAQ,CAACwT,GAEf,KAAOxT,EAAM7T,OAAS,GAAG,CACvB,MAAM7S,EAAM0mB,EAAM9D,QAClB,GAAI0D,EAAQxR,IAAI9U,GAAM,SACtB,GAAIA,EAAM,GAAKA,GAAO5B,EAAcyU,OAAQ,SAE5CyT,EAAQ4P,IAAIl2B,GAEZ,MAAMovB,EAAWhxB,EAAc4B,GAC/B,IAAKovB,GAAYA,IAAa+K,EAAe,SAE7CE,EAAOn6B,KAAKF,GAGZ,MAAMa,EAAIb,EAAMzB,EACVuC,EAAI0B,KAAKuT,MAAM/V,EAAMzB,GAGvBuC,EAAI,GAAG4lB,EAAMxmB,MAAMY,EAAI,GAAKvC,EAAWsC,GAEvCC,EAAItC,EAAY,GAAGkoB,EAAMxmB,MAAMY,EAAI,GAAKvC,EAAWsC,GAEnDA,EAAI,GAAG6lB,EAAMxmB,KAAKY,EAAIvC,GAAYsC,EAAI,IAEtCA,EAAItC,EAAW,GAAGmoB,EAAMxmB,KAAKY,EAAIvC,GAAYsC,EAAI,GACvD,CAEA,OAAOw5B,CACT,CAOO,SAASC,IAAqB,SACnCC,EAAQ,SACRC,EAAQ,MACRz5B,EAAK,OACLC,EAAM,cACN5C,EAAa,gBACbC,EAAe,SACfE,EAAQ,UACRC,EAAS,cACTojB,EAAa,UACbnhB,IAEA,IAAKrC,GAA0C,IAAzBA,EAAcyU,OAAc,OAAO,KAGzD,MAAM4nB,EAAaF,EACbG,EAAcH,EAAWx5B,EACzB45B,EAAYH,EACZI,EAAeJ,EAAWx5B,EAG1B65B,EAAQr4B,KAAKuT,MAAM0kB,EAAah6B,GAChCq6B,EAAQt4B,KAAKuT,OAAO2kB,EAAc,GAAKj6B,GACvCs6B,EAAQv4B,KAAKuT,MAAM4kB,EAAYl6B,GAC/Bu6B,EAAQx4B,KAAKuT,OAAO6kB,EAAe,GAAKn6B,GAG9C,IAAK,IAAI2hB,EAAK2Y,EAAO3Y,GAAM4Y,EAAO5Y,IAChC,IAAK,IAAIE,EAAKuY,EAAOvY,GAAMwY,EAAOxY,IAAM,CACtC,GAAIA,EAAK,GAAKA,GAAM/jB,GAAY6jB,EAAK,GAAKA,GAAM5jB,EAAW,SAE3D,MAAMwB,EAAMoiB,EAAK7jB,EAAW+jB,EACtB8M,EAAWhxB,EAAc4B,GAC/B,IAAKovB,EAAU,SAGf,GAAI/wB,GAAmBA,EAAgB4B,SAASD,GAAM,SAEtD,MAAM+hB,EAAMH,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOgyB,GAC7C,IAAKrN,GAAoB,WAAbA,EAAI3b,KAAmB,SAInC,KADqC,WAAhB2b,EAAIwN,SAAwC,UAAhBxN,EAAIwN,WAC/BxN,EAAIkZ,cAAe,SAIzC,MAAMC,EAAmBjB,GAAoBj6B,EAAK5B,EAAeG,EAAUC,EAAWojB,GAGhFuZ,EAAaD,EAAiB93B,OAAOuU,IAAMtZ,IAAoBA,EAAgB4B,SAAS0X,IAa9F,OAXA9R,QAAQuN,IAAI,4BAA6B,CACvCgoB,aAAcp7B,EACdq7B,gBAAiBjM,EACjBkM,eAAgBvZ,EAAIwN,QACpBgM,eAAgBL,EAAiBroB,OACjC2oB,YAAaL,EAAWtoB,OACxB4oB,aAAcN,EAAWvO,MAAM,EAAG,GAClC8O,mBAAoBP,EAAWvO,MAAM,EAAG,GAAG3vB,IAAI0a,GAAKvZ,EAAcuZ,MAI7DwjB,EAAWtoB,OAAS,EAAIsoB,EAAa,IAC9C,CAGF,OAAO,IACT,CClGO,SAASQ,GAAave,EAAKwe,GAChC,IACE,MAAMC,EAAKr0B,OAAOs0B,cAAgBt0B,OAAOu0B,mBACzC,IAAKF,EAAI,OACT,IAAKze,GAAK4e,YAAa,OAClB5e,EAAI4e,YAAY5R,UAAShN,EAAI4e,YAAY5R,QAAU,IAAIyR,GAC5D,MAAMI,EAAW7e,EAAI4e,YAAY5R,QACjC,IAAK6R,EAAU,OACQ,cAAnBA,EAAS/8B,OAAuB+8B,EAASC,WAC7C,MAAMr0B,EAAMo0B,EAASE,YACf1gB,EAAMwgB,EAASG,mBACfC,EAAOJ,EAASK,aAEtB7gB,EAAIrV,KAAO,SACXqV,EAAI8gB,UAAUC,eAAe,IAAK30B,GAClCw0B,EAAKA,KAAKG,eAAe,KAAQ30B,GACjCw0B,EAAKA,KAAKI,6BAA6Bj6B,KAAKC,IAAI,IAAqB,IAAdm5B,GAAO,KAAa/zB,EAAM,KACjFw0B,EAAKA,KAAKI,6BAA6B,KAAQ50B,EAAM,KACrD4T,EAAIihB,QAAQL,GACZA,EAAKK,QAAQT,EAASU,aACtBlhB,EAAIkN,MAAM9gB,GACV4T,EAAImhB,KAAK/0B,EAAM,IACjB,CAAE,MAAO,CACX,CCrCO,SAASg1B,GAAiBrJ,EAAIC,EAAIqJ,EAAeC,EAAgBt8B,EAAWu8B,EAAUpb,GAC3F,GAAI6R,EAAK,EAAG,OAAO,KACnB,MAAMnR,EAAK9f,KAAKuT,MAAMyd,EAAK/yB,GACrB2hB,EAAK5f,KAAKuT,MAAM0d,EAAKhzB,GAC3B,GAAI6hB,EAAK,GAAKF,EAAK,GAAKE,GAAMwa,GAAiB1a,GAAM2a,EAAgB,OAAO,KAC5E,MACM3/B,EAAK4/B,EADC5a,EAAK0a,EAAgBxa,GAEjC,IAAKllB,EAAI,OAAO,KAChB,MAAM2kB,EAAM3P,MAAMC,QAAQuP,GAAiBA,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOA,GAAM,KAClF,IAAK2kB,IAAQA,EAAIC,QAAUD,EAAIC,MAAMoE,OAAQ,OAAO,KAqBpD,MAAO,CAAErE,MAAK3b,KApBD2b,EAAIC,MAAMqE,MAAQ,QAAWtE,EAAIC,MAAMC,KAAO,OAAS,SAoBhDgb,OAnBL,CACbC,SAAUhnB,OAAO6L,GAAKqE,QAAQ8W,UAC9BC,MAAOjnB,OAAO6L,GAAKqE,QAAQgX,MAAMv8B,GACjCw8B,MAAOnnB,OAAO6L,GAAKqE,QAAQgX,MAAMt8B,GACjCqJ,UAAW4X,GAAKqE,QAAQjc,QACxBmzB,WAAqC,IAA1Bvb,GAAKC,OAAOsb,YAAiD,IAA3Bvb,GAAKqE,QAAQkX,UAC1DC,IAAKrnB,OAAO6L,GAAKqE,QAAQoX,iBAEzB/7B,OAAQ,CACNg8B,eAAgBvnB,OAAO6L,GAAKqE,QAAQ3kB,QAAQg8B,gBAC5CC,eAAgBxnB,OAAO6L,GAAKqE,QAAQ3kB,QAAQi8B,gBAC5CC,4BAA6BznB,OAAO6L,GAAKqE,QAAQ3kB,QAAQk8B,8BAE3DC,WAAY,CACVH,eAAgBvnB,OAAO6L,GAAKqE,QAAQwX,YAAYH,gBAChDC,eAAgBxnB,OAAO6L,GAAKqE,QAAQwX,YAAYF,gBAChDC,4BAA6BznB,OAAO6L,GAAKqE,QAAQwX,YAAYD,+BAInE,CAaO,SAASE,IAAoB,EAAEh9B,EAAC,EAAEC,EAAC,MAAEC,EAAK,OAAEC,EAAM,UAAEP,EAAS,SAAElC,EAAQ,UAAEC,EAAS,SAAEw+B,EAAQ,cAAEpb,IACnG,MAAMzG,EAAKta,EAAY,GAARE,EACT+8B,EAAQh9B,EAAI0B,KAAKE,IAAI,EAAY,KAAT1B,GACxB+8B,EAASj9B,EAAa,IAATE,EAGbg9B,EAAOnB,GAAiB1hB,EAFhBra,EAAIE,EAAS,EAEczC,EAAUC,EAAWiC,EAAWu8B,EAAUpb,GAC7Eqc,EAAQpB,GAAiB1hB,EAAI4iB,EAAQx/B,EAAUC,EAAWiC,EAAWu8B,EAAUpb,GAC/Esc,EAAOrB,GAAiB1hB,EAAI2iB,EAAOv/B,EAAUC,EAAWiC,EAAWu8B,EAAUpb,GAE7Euc,EAAYH,GAAQC,GAASC,EACnC,IAAKC,EACH,MAAO,CAAEC,UAAU,EAAOpL,WAAW,EAAOhxB,WAAW,EAAOoE,KAAM,KAAM62B,OAAQ,MAEpF,MAoBMmB,KAAcJ,IAAQC,GACtBjL,IAAckL,EAEpB,MAAO,CAAEE,WAAUpL,YAAWhxB,UADZo8B,IAAapL,EACU5sB,KAvB5B+3B,EAAU/3B,KAuBwB62B,OArBrC,CACRC,SAAUhnB,OAAOsC,SAAS2lB,EAAUlB,OAAOC,UAAYiB,EAAUlB,OAAOC,SAAW,GACnFC,MAAOjnB,OAAOsC,SAAS2lB,EAAUlB,OAAOE,OAASgB,EAAUlB,OAAOE,MAAQ,IAC1EE,MAAOnnB,OAAOsC,SAAS2lB,EAAUlB,OAAOI,OAASc,EAAUlB,OAAOI,MAAQ,IAC1ElzB,UAAWg0B,EAAUlB,OAAO9yB,QAC5BmzB,YAAaa,EAAUlB,OAAOK,UAC9BC,IAAKrnB,OAAOsC,SAAS2lB,EAAUlB,OAAOM,KAAO/6B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOM,KAAO,EACjF97B,OAAQ,CACNg8B,eAAgBvnB,OAAOsC,SAAS2lB,EAAUlB,QAAQx7B,QAAQg8B,gBAAkBj7B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOx7B,OAAOg8B,gBAAkB,GAClIC,eAAgBxnB,OAAOsC,SAAS2lB,EAAUlB,QAAQx7B,QAAQi8B,gBAAkBl7B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOx7B,OAAOi8B,gBAAkB,GAClIC,4BAA6BznB,OAAOsC,SAAS2lB,EAAUlB,QAAQx7B,QAAQk8B,6BAA+Bn7B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOx7B,OAAOk8B,6BAA+B,IAE3KC,WAAY,CACVH,eAAgBvnB,OAAOsC,SAAS2lB,EAAUlB,QAAQW,YAAYH,gBAAkBj7B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOW,WAAWH,gBAAkB,GAC1IC,eAAgBxnB,OAAOsC,SAAS2lB,EAAUlB,QAAQW,YAAYF,gBAAkBl7B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOW,WAAWF,gBAAkB,GAC1IC,4BAA6BznB,OAAOsC,SAAS2lB,EAAUlB,QAAQW,YAAYD,6BAA+Bn7B,KAAKC,IAAI,EAAG07B,EAAUlB,OAAOW,WAAWD,6BAA+B,KAOvL,CAQO,SAASU,GAAiBC,EAAKC,EAAStB,GAC7C,MAAMM,EAAM/6B,KAAKC,IAAI,EAAGyT,OAAO+mB,GAAQM,MAAQ,GAC/C,GAAIA,GAAO,EAA6B,YAAxBe,EAAIE,OAAOpU,QAAU,GACrCkU,EAAIE,OAAOpU,SAAW5nB,KAAKC,IAAI,EAAGyT,OAAOqoB,IAAY,GAErD,KAAOD,EAAIE,OAAOpU,SADL,KACsB,CACjCkU,EAAIE,OAAOpU,SAFA,IAGX,MAAM9O,EAAMpF,OAAOooB,EAAIG,UAAUrU,QAAQ9oB,SAAW,EACpDg9B,EAAIG,UAAUrU,QAAQ9oB,OAASkB,KAAKC,IAAI,EAAG6Y,EAAMiiB,GACjD,MAAMmB,EAAe,IACf9V,EAAO1S,OAAOooB,EAAIG,UAAUrU,QAAQloB,aAAe,EACzDo8B,EAAIG,UAAUrU,QAAQloB,WAAaM,KAAKC,IAAImmB,EAAM8V,EACpD,CACF,CClGO,SAASC,GAAYvhB,EAAKtV,GAC/B,MAAM,QACJ1I,EAAO,WACPw/B,EAAU,MACVC,EAAK,KACLlQ,EAAI,UACJmQ,EAAS,QACTC,EAAO,QACPv+B,GACE4c,GAEE,UAAEqhB,EAAS,cAAEO,EAAa,YAAEC,EAAW,eAAEC,EAAc,iBAAEC,EAAgB,2BAAEC,EAA0B,oBAAEC,EAAmB,kBAAEC,GAAsB3Q,GAClJ,UAAEluB,EAAS,QAAE8+B,EAAO,kBAAEC,EAAiB,WAAEC,EAAU,WAAEC,GAAeZ,GACpE,eAAEa,EAAc,UAAEC,EAAS,gBAAEC,GAAoBd,GACjD,YAAEe,EAAW,mBAAEC,EAAkB,kBAAEC,EAAiB,aAAEC,EAAY,gBAAEC,EAAe,kBAAEC,EAAiB,UAAEC,EAAS,WAAEC,GAAe7/B,EAGxI,IAAKw+B,EAAc5U,UAAYhrB,EAC7B,MAAO,CAAEkhC,UAAU,GAIhBrB,EAAY7U,UACf6U,EAAY7U,QAAUtiB,GAExB,MAAMy2B,EAAUz2B,EAAYm3B,EAAY7U,QACxC6U,EAAY7U,QAAUtiB,EAGtB,IACE,GAAIN,OAAOC,uBACT,MAAO,CAAE64B,UAAU,EAEvB,CAAE,MAAO,CAET,MAAM/hC,EAAWa,EAAQmhC,MAAMx/B,OAAS3B,EAAQ2B,OAAS,GACnDvC,EAAYY,EAAQmhC,MAAMv/B,QAAU5B,EAAQ4B,QAAU,GACtDrD,EAAOkhC,EAAMzU,QAEnB,IAAI,EACFvpB,EAAC,EACDC,EAAC,GACDG,EAAE,GACFC,EAAE,MACFH,EAAK,OACLC,EAAM,WACNG,EAAU,UACVC,EAAS,UACTC,EAAS,KACTG,GACEi9B,EAAUrU,QAGd,MAAM1F,EChED,UAAwB,KAC7B/mB,EAAI,MACJuB,EAAK,WACLugC,EAAU,UACVh/B,EAAS,SACTlC,EAAQ,UACRC,EAAS,eACTmhC,IAEA,IAAI,EAAE9+B,EAAC,MAAEE,EAAK,UAAEK,GAAclC,EAC1B+B,EAAK,EAELtD,GAAMmf,IACR7b,GAAMw+B,EACNr+B,GAAa,GAEXzD,GAAMyjB,IACRngB,EAAKw+B,EACLr+B,EAAY,GAGd,MAAMo/B,EAAY3/B,EAAII,EActB,OAbI0+B,EAAea,EAAWthC,EAAM4B,GAAK,EAAGvC,EAAUC,IAChDyC,EAAK,EAEPJ,EAAI2B,KAAKuT,OAAOyqB,EAAYz/B,GAASN,GAAaA,EAAYM,EACrDE,EAAK,IAEdJ,EAAI2B,KAAKiV,KAAK+oB,EAAY//B,GAAaA,GAEzCQ,EAAK,GAELJ,EAAI2/B,EAGC,CAAE3/B,IAAGI,KAAIG,YAClB,CD4Baq/B,CAAe,CACxB9iC,OACAuB,MAAO,CAAE2B,IAAGC,IAAGC,QAAOK,aACtBq+B,aACAh/B,YACAlC,WACAC,YACAmhC,mBAEF9+B,EAAI6jB,EAAG7jB,EAAGI,EAAKyjB,EAAGzjB,GAAIG,EAAYsjB,EAAGtjB,UAGrC,MAAMs/B,EEzED,UAA8B,KACnC/iC,EAAI,EACJkD,EAAC,EACDC,EAAC,GACDI,EAAE,WACFC,EAAU,UACVE,EAAS,QACTk+B,EAAO,kBACPC,EAAiB,WACjBE,EAAU,UACVj/B,EAAS,MACTM,EAAK,OACLC,EAAM,SACNzC,EAAQ,UACRC,EAAS,eACTmhC,EAAc,GACd1+B,EAAE,UACF2+B,EAAS,YACTe,IAGA,MAEMC,EAAep+B,KAAKC,IAAI,EAAGD,KAAKuT,MAA0B,GAApBypB,IAG5C,IAAI19B,GAAU,EACVC,GAAiB,EACjBC,GAAY,EAChB,GAAyB,oBAAd49B,EAA0B,CACnC,MAAMzkB,EAAKta,EAA2B,IAAtBE,GAASN,GACnBq9B,EAAQh9B,EAAI0B,KAAKE,IAAI,EAA2B,MAAvB1B,GAAUP,IAEnCs9B,EAASj9B,EAA4B,KAAvBE,GAAUP,GAC9BqB,KAAa89B,EAAUzkB,EAFTra,GAAKE,GAAUP,GAAa,KAELm/B,EAAUzkB,EAAI4iB,IACnDh8B,IAAmB69B,EAAUzkB,EAAI2iB,GACjC97B,EAAYF,IAAYC,CAC1B,CAGA,GAAIpE,GAAMkjC,OAASljC,GAAM+c,EACvB,GAAI5Y,EAAS,CAEX,MAAMg/B,EAAct+B,KAAKC,IAAI,EAAGD,KAAKuT,MAAmB,IAAb2pB,IAC3Cx+B,EAAKsB,KAAKE,IAAIxB,EAAI,GAClBA,GAAoB,GAAd4/B,EACNz/B,EAAY,MACd,MAAWF,IACTD,GAAMw+B,EACNv+B,GAAa,EACbE,EAAY,QA2ChB,OAtCIS,GAEG6+B,IACHz/B,GAAM,IAERA,GAAgB,GAAVq+B,GACNr+B,GAvCiB,KAwCR0/B,IAAc1/B,EAAK0/B,KAE5B1/B,GAAMq+B,GACGC,IAAmBt+B,EAAKs+B,GAI/BG,EAAe9+B,EAAGC,EAAII,EAAI3C,EAAUC,IAClC0C,EAAK,GAEPC,GAAa,EACbL,EAAI0B,KAAKuT,OAAOjV,EAAII,EAAKF,GAAUP,GAAaA,EAAYO,EAE1DK,EADEmB,KAAKuW,IAAI9X,GAAM,GAAK,EACV,MAEA,QAELC,EAAK,IAEdJ,EAAI0B,KAAKiV,MAAM3W,EAAII,GAAMT,GAAaA,GAExCS,EAAK,IAGLC,GAAa,EACbL,GAAKI,EACDA,EAAK,IACPG,EAAY,SAIT,CAAEP,IAAGI,KAAIC,aAAYE,YAAWS,UAASC,iBAAgBC,YAClE,CFrBa++B,CAAqB,CAC9BpjC,OACAkD,IACAC,IACAI,KACAC,aACAE,YACAk+B,UACAC,oBACAE,aACAj/B,YACAM,QACAC,SACAzC,WACAC,YACAmhC,iBACA1+B,KACA2+B,UAAWA,CAACpM,EAAIC,KACd,IAAM,MAA4B,oBAAdmM,KAA6BA,EAAUpM,EAAIC,EAAa,CAAE,MAAQ,OAAO,CAAO,GAEtGkN,cAAelC,EAAUrU,QAAQtoB,UAEnChB,EAAI4/B,EAAG5/B,EAAGI,EAAKw/B,EAAGx/B,GAAIC,EAAau/B,EAAGv/B,WAAYE,EAAYq/B,EAAGr/B,UACjE,MAAMS,IAAY4+B,EAAG5+B,QACfC,IAAmB2+B,EAAG3+B,eACtBC,IAAc0+B,EAAG1+B,UAGvB,IAAIC,EAAa,KACb++B,EAAe,KACnB,GAA+B,oBAApBnB,EACT,IACE,MAAMoB,EAASpB,EAAgB,CAAEh/B,IAAGC,IAAGC,QAAOC,SAAQP,YAAWlC,WAAUC,cACvEyiC,GAAUA,EAAO7C,WACnBn8B,EAAag/B,EAAO76B,MAAQ,KAC5B46B,EAAeC,EAAOhE,QAAU,MAG7BgE,GAAWA,EAAO7C,UACjBgB,IAA4BA,EAA2BhV,QAAU,EAEzE,CAAE,MAAO,EAIPtoB,GAAWG,KAEXhB,GADiB,SAAfgB,EACI,IAEA,KAQV,IACE,MAAMiW,EAAK1V,KAAKC,IAAI,EAAG87B,GAAW,GAE5B5F,EAASn2B,KAAKC,IAAI,EAAGyT,OAAOuoB,EAAUrU,QAAQ1oB,WAAa,MAC3Dw/B,EAAU1+B,KAAKC,IAAI,EAAGyT,OAAOuoB,EAAUrU,QAAQxoB,eAAiB,MACtE,IAAIu/B,EAAMjrB,OAAOuoB,EAAUrU,QAAQ3oB,QAC/B2/B,EAAUlrB,OAAOuoB,EAAUrU,QAAQzoB,YAClCuU,OAAOsC,SAAS2oB,KAAMA,EAAMxI,GAC5BziB,OAAOsC,SAAS4oB,KAAUA,EAAUF,GAEzC,MAAMG,EAAYL,GAAcv/B,QAAU,CAAEg8B,eAAgB,GAAIC,eAAgB,GAAIC,4BAA6B,IAC3G2D,EAAaN,GAAcpD,YAAc,CAAEH,eAAgB,GAAIC,eAAgB,GAAIC,4BAA6B,IAGlH57B,IAAkC,UAAfE,GAA0BH,GAC/Cq/B,GAAQ3+B,KAAKC,IAAI,EAAGyT,OAAOmrB,EAAU5D,iBAAmB,GAAKvlB,EAAM,IAEnEipB,GAAQ3+B,KAAKC,IAAI,EAAGyT,OAAOmrB,EAAU3D,iBAAmB,GAAKxlB,EAAM,IAGrEipB,EAAM3+B,KAAKC,IAAI,EAAGD,KAAKE,IAAIi2B,EAAQwI,IACnC1C,EAAUrU,QAAQ3oB,OAAS0/B,EAC3B1C,EAAUrU,QAAQ1oB,UAAYi3B,EAGX,SAAf12B,EACFm/B,GAAY5+B,KAAKC,IAAI,EAAGyT,OAAOorB,EAAW7D,iBAAmB,GAAKvlB,EAAM,IAExEkpB,GAAY5+B,KAAKC,IAAI,EAAGyT,OAAOorB,EAAW5D,iBAAmB,GAAKxlB,EAAM,IAE1EkpB,EAAU5+B,KAAKC,IAAI,EAAGD,KAAKE,IAAIw+B,EAASE,IACxC3C,EAAUrU,QAAQzoB,WAAay/B,EAC/B3C,EAAUrU,QAAQxoB,cAAgBs/B,EAmB7Bn/B,IAAkC,UAAfE,GAA0BH,IAAaq/B,GAAO,EAhB/CI,EAAC/C,EAAQgD,KAC9B,MAAMvrB,EAAIzT,KAAKC,IAAI,EAAGyT,OAAOsrB,IAAa,GAC1C,GAAIvrB,GAAK,EAAyB,YAApBuoB,EAAOpU,QAAU,GAC/BoU,EAAOpU,SAAWlS,EAElB,KAAOsmB,EAAOpU,SADJ,KACkB,CAC1BoU,EAAOpU,SAFC,IAGRqU,EAAUrU,QAAQ9oB,OAASkB,KAAKC,IAAI,GAAIyT,OAAOuoB,EAAUrU,QAAQ9oB,SAAW,GAAK2U,GAEjF,MAAMyoB,EAAe,IACf9V,EAAO1S,OAAOuoB,EAAUrU,QAAQloB,aAAe,EACrDu8B,EAAUrU,QAAQloB,WAAaM,KAAKC,IAAImmB,EAAM8V,EAChD,GAKA6C,CAAelC,EAAqBgC,EAAU1D,6BACrC0B,IACTA,EAAoBjV,QAAU,GAK1BkV,IAAmBA,EAAkBlV,QAAU,EAIvD,CAAE,MAAO,CAGT,GAAInoB,GAAc++B,GAAgB9qB,OAAO8qB,EAAazD,KAAO,EAC3D,IACE,GAAmB,SAAft7B,EAAuB,CACVO,KAAKC,IAAI,EAAGyT,OAAOuoB,EAAUrU,QAAQzoB,cACtC,EACZ08B,GAAiB,CAAEG,OAAQY,EAA4BX,aAAaF,EAASyC,GAEzE5B,IAA4BA,EAA2BhV,QAAU,EAEzE,MAEEiU,GAAiB,CAAEG,OAAQY,EAA4BX,aAAaF,EAASyC,EAEjF,CAAE,MAAO,MAEL5B,IAA4BA,EAA2BhV,QAAU,GAIvE0V,EAAYj/B,EAAGC,EAAGvC,EAAUqgC,GAG5B,IAAMmB,EAAmBl/B,EAAGC,EAAGvC,EAAUqgC,EAAa,CAAE,MAAO,CAG/D,IAAMoB,EAAkBn/B,EAAGC,EAAGvC,EAAUqgC,EAAYL,EAAU,CAAE,MAAO,CAGvE,IAAU0B,GAAcA,EAAap/B,EAAGC,EAAGC,EAAOC,EAAQzC,EAAUC,EAAY,CAAE,MAAO,CAIrF2gC,EAAiB/U,QAAU,IAAG+U,EAAiB/U,QAAU5nB,KAAKC,IAAI,EAAG08B,EAAiB/U,QAAUmU,IAEpG,MAAMkD,GAAcj/B,KAAKC,IAAI,EAAGyT,OAAOuoB,EAAUrU,QAAQ5oB,OAAS,GAClE,GAAI7D,GAAM+jC,WAAavC,EAAiB/U,SAAW,GAAKqX,GAAc,EAAG,CAGvEvB,EAFgBr/B,EAAIE,EAAQ,EACZD,EAAIE,EAAS,EACKI,GAAa,EAAI,GAAK,GACxD+9B,EAAiB/U,QAAU,IAC3BqU,EAAUrU,QAAQ5oB,KAAOgB,KAAKC,IAAI,EAAGg/B,GAAc,EACrD,CAEA,IAAMtB,EAAkB5B,EAAShgC,EAAUC,EAAY,CAAE,MAAO,CAGhE,MAAMmjC,GAAOpjC,EAAWkC,EAAYM,EAIpC,GAHAF,EAAI2B,KAAKC,IAAI,EAAGD,KAAKE,IAAIi/B,GAAM9gC,KAG1BqV,OAAOuoB,EAAUrU,QAAQ9oB,SAAW,IAAM,EAC7C,IAAM++B,GAAcA,GAAc,CAAE,MAAO,CAI7C,IACMnqB,OAAOuoB,EAAUrU,QAAQloB,YAAc,IACzCu8B,EAAUrU,QAAQloB,WAAaM,KAAKC,IAAI,EAAGyT,OAAOuoB,EAAUrU,QAAQloB,YAAcq8B,GAEtF,CAAE,MAAO,CAqBT,OAlBAE,EAAUrU,QAAU,IACfqU,EAAUrU,QACbvpB,IACAC,IACAG,KACAC,KACAH,QACAC,SACAG,aACAC,YACAC,YACAS,UACAC,iBACAC,YACAC,WAAYA,GAAc,MAE5Bm+B,EAAU,IAAK3B,EAAUrU,QAASvoB,YAAaq9B,EAAe9U,SAAW,KAElE,CAAEkW,UAAU,EACrB,CGvRO,SAASsB,GAAepO,EAAIC,EAAIqJ,EAAeC,EAAgBt8B,EAAWu8B,EAAUpb,EAAeigB,GAExG,GAAIpO,EAAK,EAAG,OAAO,EACnB,MAAMnR,EAAK9f,KAAKuT,MAAMyd,EAAK/yB,GACrB2hB,EAAK5f,KAAKuT,MAAM0d,EAAKhzB,GAE3B,GAAI6hB,EAAK,GAAKF,EAAK,GAAKE,GAAMwa,GAAiB1a,GAAM2a,EAAgB,OAAO,EAC5E,MAAMv9B,EAAQ4iB,EAAK0a,EAAgBxa,EAGnC,GAAIuf,GAAcA,EAAWriC,GAC3B,OAAO,EAGT,MAAMsiC,EAAS9E,EAASx9B,GACxB,IAAKsiC,EAAQ,OAAO,EACpB,MAAMC,EAAUngB,EAAcjP,KAAKC,GAAKA,EAAExV,KAAO0kC,GACjD,SAAKC,IAAYA,EAAQrO,cACC,IAAtBqO,EAAQrO,WACqB,kBAAtBqO,EAAQrO,cAEfqO,EAAQrO,UAAUC,KAClBoO,EAAQrO,UAAUE,QAClBmO,EAAQrO,UAAUG,MAClBkO,EAAQrO,UAAUI,OAIxB,CASO,SAAS6L,GAAeqC,EAAMC,EAAMnF,EAAeC,EAAgBt8B,EAAWu8B,EAAUpb,EAAe7gB,EAAOC,EAAQ6gC,GAC3H,MAAMriB,EAAS,CACb,CAAE3e,EAAGmhC,EAAMlhC,EAAGmhC,GACd,CAAEphC,EAAGmhC,EAAOjhC,EAAQ,IAAMD,EAAGmhC,GAC7B,CAAEphC,EAAGmhC,EAAMlhC,EAAGmhC,EAAOjhC,EAAS,KAC9B,CAAEH,EAAGmhC,EAAOjhC,EAAQ,IAAMD,EAAGmhC,EAAOjhC,EAAS,MAG/C,IAAK,IAAIqC,KAAKmc,EAAQ,CACpB,MAAM0iB,EAAQ1/B,KAAKuT,MAAM1S,EAAExC,EAAIJ,GACzB0hC,EAAQ3/B,KAAKuT,MAAM1S,EAAEvC,EAAIL,GACzBjB,EAAQ2iC,EAAQrF,EAAgBoF,EAGtC,GAAIA,EAAQ,GAAKA,GAASpF,GAAiBqF,EAAQ,EAAG,OAAO,EAE7D,GAAIA,GAASpF,EAAgB,SAG7B,GAAI8E,GAAcA,EAAWriC,GAC3B,SAGF,MAAMsiC,EAAS9E,EAASx9B,GACxB,GAAIsiC,EAAQ,CACV,MAAMC,EAAUngB,EAAcjP,KAAKC,GAAKA,EAAExV,KAAO0kC,GACjD,GAAIC,GAAWA,EAAQrO,UAAW,OAAO,CAC3C,CACF,CACA,OAAO,CACT,CCyFA,MAEA,GAFqB,IAjKrB,MACEnf,WAAAA,GACEC,KAAK4tB,eAAiB,GACtB5tB,KAAK6tB,SAAmD,OAC1D,CAKAC,WAAAA,CAAYC,GACV/tB,KAAK6tB,SAAWE,CAClB,CAMAC,WAAAA,CAAYC,GACVjuB,KAAK4tB,eAAeliC,KAAKuiC,EAC3B,CAMAC,cAAAA,CAAeD,GACbjuB,KAAK4tB,eAAiB5tB,KAAK4tB,eAAeh/B,OAAOu/B,GAAMA,IAAOF,EAChE,CAOAG,eAAAA,CAAgBlkC,EAAOmkC,EAAU,CAAC,GAChCruB,KAAK4tB,eAAeriC,QAAQ0iC,IAC1B,IACEA,EAAS/jC,EAAOmkC,EAClB,CAAE,MAAO5U,GACPpoB,QAAQnH,MAAM,2BAA4BuvB,EAC5C,GAEJ,CAQA6U,MAAAA,CAAOpkC,EAAOmkC,EAAU,CAAC,EAAGN,EAAQ,SAClC,MAAMQ,EAAWrkC,aAAiBjB,MAAQiB,EAAQ,IAAIjB,MAAMulC,OAAOtkC,IAC7DoJ,GAAY,IAAIF,MAAOG,cAEvBk7B,EAAU,CACdn7B,YACAy6B,QACAW,QAASH,EAASG,QAClBC,MAAOJ,EAASI,MAChBN,WAIF,GAAIruB,KAAK4uB,UAAUb,GAAQ,EACP18B,QAAQ08B,IAAU18B,QAAQnH,OAClC,IAAIoJ,OAAey6B,EAAMc,iBAAkBN,EAASG,QAASL,GAEnEE,EAASI,OAAmB,UAAVZ,GACpB18B,QAAQnH,MAAMqkC,EAASI,MAE3B,CAYA,MATc,UAAVZ,GAA+B,SAAVA,GACvB/tB,KAAKouB,gBAAgBG,EAAUF,GAK/BruB,KAAK8uB,qBAAqBL,GAGrBF,CACT,CAOAK,SAAAA,CAAUb,GACR,MAAMgB,EAAS,CAAEC,MAAO,EAAG35B,KAAM,EAAGkH,KAAM,EAAGrS,MAAO,GAC9C+kC,EAAeF,EAAO/uB,KAAK6tB,WAAa,EAE9C,OADqBkB,EAAOhB,IAAU,IACfkB,CACzB,CAMAH,oBAAAA,CAAqBL,GAEnB,CAMFO,KAAAA,CAAMN,EAASL,EAAU,CAAC,GACxB,OAAOruB,KAAKsuB,OAAOI,EAASL,EAAS,QACvC,CAEAh5B,IAAAA,CAAKq5B,EAASL,EAAU,CAAC,GACvB,OAAOruB,KAAKsuB,OAAOI,EAASL,EAAS,OACvC,CAEA9xB,IAAAA,CAAKmyB,EAASL,EAAU,CAAC,GACvB,OAAOruB,KAAKsuB,OAAOI,EAASL,EAAS,OACvC,CAEAnkC,KAAAA,CAAMwkC,EAASL,EAAU,CAAC,GACxB,OAAOruB,KAAKsuB,OAAOI,EAASL,EAAS,QACvC,CAQAa,SAAAA,CAAUC,EAAId,EAAU,CAAC,GACvB,OAAOjO,SAAUgP,KACf,IACE,aAAaD,KAAMC,EACrB,CAAE,MAAOllC,GAEP,MADA8V,KAAKsuB,OAAOpkC,EAAO,IAAKmkC,EAASe,QAAQ,SACnCllC,CACR,EAEJ,CAQAmlC,QAAAA,CAASF,EAAId,EAAU,CAAC,GACtB,MAAO,IAAIe,KACT,IACE,OAAOD,KAAMC,EACf,CAAE,MAAOllC,GAEP,MADA8V,KAAKsuB,OAAOpkC,EAAO,IAAKmkC,EAASe,QAAQ,SACnCllC,CACR,EAEJ,GC5IIolC,GAAYA,CAAC7tB,EAAG8L,GAAM,IACP,mBAAN9L,EAAwBA,EAClB,kBAANA,EAAkD,SAA3BA,EAAE8tB,OAAOC,cACpCjiB,EAIEkiB,GAAgBA,CAAC7kC,EAAS49B,EAAU4B,EAAYiD,EAAYxjC,EAAiBujB,EAAeye,EAAY6D,EAAeC,KAChI,MAAMtF,EC5BcuF,MACpB,MAAMzmC,GAAO4yB,EAAAA,EAAAA,QAAO,CAChB7V,GAAG,EACHoC,GAAG,EACHmE,GAAG,EACHG,GAAG,EACHyf,OAAO,EACPa,WAAW,IAiIf,OA9HAluB,EAAAA,EAAAA,WAAU,KACN,MAAMzM,EAAiBA,KACnB,IAAM,QAASS,OAAOC,sBAAwB,CAAE,MAAQ,OAAO,CAAO,GAGpE48B,EAAYA,KACd1mC,EAAKysB,QAAQ1P,GAAI,EACjB/c,EAAKysB,QAAQtN,GAAI,EACjBnf,EAAKysB,QAAQnJ,GAAI,EACjBtjB,EAAKysB,QAAQhJ,GAAI,EACjBzjB,EAAKysB,QAAQyW,OAAQ,EACrBljC,EAAKysB,QAAQsX,WAAY,GAGvB4C,EAAiB9mC,IAEnB,MAAM+mC,EAAO/mC,EAAE6Z,QAAU7Z,EAAE6Z,OAAOmtB,QAAWhnC,EAAE6Z,OAAOmtB,QAAQnB,cAAgB,GACxEoB,EAAiB,UAARF,GAA2B,aAARA,GAAuB/mC,EAAE6Z,QAAU7Z,EAAE6Z,OAAOqtB,kBAG9E,IAAKD,GAAqB,SAAXjnC,EAAEE,OAAoBF,EAAEmnC,OAAQ,CAC3C,IAAMn9B,OAAOgI,cAAc,IAAIo1B,YAAY,wBAA0B,CAAE,MAAO,CAI9E,OAHAP,SAEgC,oBAArB7mC,EAAE25B,gBAA+B35B,EAAE25B,iBAElD,CAGA,IAAKsN,IAAW19B,IACZ,OAAQvJ,EAAEE,MACN,IAAK,OACL,IAAK,UACL,IAAK,OACL,IAAK,YACL,IAAK,OACL,IAAK,YACL,IAAK,OACL,IAAK,aACL,IAAK,QAC+B,oBAArBF,EAAE25B,gBAA+B35B,EAAE25B,iBAQ1D,IAAIpwB,IAEJ,OAAQvJ,EAAEE,MACN,IAAK,OACL,IAAK,UACDC,EAAKysB,QAAQ1P,GAAI,EAAM,MAC3B,IAAK,OACL,IAAK,YACD/c,EAAKysB,QAAQtN,GAAI,EAAM,MAC3B,IAAK,OACL,IAAK,YACDnf,EAAKysB,QAAQnJ,GAAI,EAAM,MAC3B,IAAK,OACL,IAAK,aACDtjB,EAAKysB,QAAQhJ,GAAI,EAAM,MAC3B,IAAK,QAASzjB,EAAKysB,QAAQyW,OAAQ,IAKrCgE,EAAmBrnC,IAEJ,IAAbA,EAAEmS,SACF5I,MACJpJ,EAAKysB,QAAQsX,WAAY,KAGvBoD,EAAiBtnC,IACF,IAAbA,EAAEmS,SACF5I,MACJpJ,EAAKysB,QAAQsX,WAAY,KAGvBqD,EAAevnC,IAEjB,GAAe,WAAXA,EAAEE,OAEFqJ,IAKJ,OAAQvJ,EAAEE,MACN,IAAK,OACL,IAAK,UACDC,EAAKysB,QAAQ1P,GAAI,EAAO,MAC5B,IAAK,OACL,IAAK,YACD/c,EAAKysB,QAAQtN,GAAI,EAAO,MAC5B,IAAK,OACL,IAAK,YACDnf,EAAKysB,QAAQnJ,GAAI,EAAO,MAC5B,IAAK,OACL,IAAK,aACDtjB,EAAKysB,QAAQhJ,GAAI,EAAO,MAC5B,IAAK,QAASzjB,EAAKysB,QAAQyW,OAAQ,IAKrCmE,EAAmBA,IAAMX,IAS/B,OANA78B,OAAO0vB,iBAAiB,UAAWoN,EAAe,CAAEW,SAAS,IAC7Dz9B,OAAO0vB,iBAAiB,QAAS6N,EAAa,CAAEE,SAAS,IACzDz9B,OAAO0vB,iBAAiB,uBAAwB8N,GAChDx9B,OAAO0vB,iBAAiB,YAAa2N,EAAiB,CAAEI,SAAS,IACjEz9B,OAAO0vB,iBAAiB,UAAW4N,EAAe,CAAEG,SAAS,IAEtD,KACHz9B,OAAO09B,oBAAoB,UAAWZ,EAAe,CAAEW,SAAS,IAChEz9B,OAAO09B,oBAAoB,QAASH,EAAa,CAAEE,SAAS,IAC5Dz9B,OAAO09B,oBAAoB,uBAAwBF,GACnDx9B,OAAO09B,oBAAoB,YAAaL,EAAiB,CAAEI,SAAS,IACpEz9B,OAAO09B,oBAAoB,UAAWJ,EAAe,CAAEG,SAAS,MAErE,IAEItnC,GD5GOymC,IAGP17B,EAAQ03B,IAAa+E,EAAAA,EAAAA,UAAS,CACjCtkC,EAAG,EACHC,EAAG,EACHC,MAAO,GACPC,OAAQ,GACRC,GAAI,EACJC,GAAI,EACJC,YAAY,EACZC,UAAW,EACXC,UAAW,OACXC,OAAQ,GACRC,UAAWb,EACXc,KAAM,EAENC,OAAQd,EACRe,UAAWf,EACXgB,WAAYf,EACZgB,cAAehB,EACfiB,YAAa,KAIX48B,GAAYlO,EAAAA,EAAAA,QAAO,IAAK7nB,IACxB08B,GAAa7U,EAAAA,EAAAA,UACbyO,GAAgBzO,EAAAA,EAAAA,SAAO,GACvB0O,GAAc1O,EAAAA,EAAAA,QAAO,GACrB8U,GAA6B9U,EAAAA,EAAAA,QAAO,GACpC+U,GAAqB/U,EAAAA,EAAAA,QAAO,MAC5BgV,GAAsBhV,EAAAA,EAAAA,QAAO,IAAInI,KACjC8W,GAAiB3O,EAAAA,EAAAA,QAAO,IACxB4O,GAAmB5O,EAAAA,EAAAA,QAAO,GAC1BiV,GAAkBjV,EAAAA,EAAAA,QAAO,GACzBkV,GAAkBlV,EAAAA,EAAAA,SAAO,GACzByL,GAAczL,EAAAA,EAAAA,QAAO,MACrBmV,GAAsBnV,EAAAA,EAAAA,SAAO,GAC7B6O,GAA6B7O,EAAAA,EAAAA,QAAO,GACpC8O,GAAsB9O,EAAAA,EAAAA,QAAO,GAC7B+O,GAAoB/O,EAAAA,EAAAA,QAAO,IAGjC/c,EAAAA,EAAAA,WAAU,KACN,IACI,MAAMyC,EAAIzQ,aAAaC,QAAQ,sBAC/BggC,EAAgBrb,QAAiB,OAANnU,GAA2B,MAANA,CACpD,CAAE,MAAQwvB,EAAgBrb,SAAU,CAAO,CAC3C,MAAMub,EAAYnoC,IACd,IACI,MAAMqG,IAAarG,GAAGooC,QAAQ/hC,QAC9B4hC,EAAgBrb,QAAUvmB,CAC9B,CAAE,MAAO,GAEb2D,OAAO0vB,iBAAiB,oBAAqByO,GAE7C,MAAME,EAAgBA,KAClB,IACI,IAAK7J,EAAY5R,QAAS,CACtB,MAAMyR,EAAKr0B,OAAOs0B,cAAgBt0B,OAAOu0B,mBACrCF,IAAIG,EAAY5R,QAAU,IAAIyR,EACtC,CACIG,EAAY5R,SAAyC,cAA9B4R,EAAY5R,QAAQlrB,OAC3C88B,EAAY5R,QAAQ8R,WAEpBF,EAAY5R,SAAyC,YAA9B4R,EAAY5R,QAAQlrB,QAC3CwmC,EAAoBtb,SAAU,EAEtC,CAAE,MAAO,GAGb,OADA5iB,OAAO0vB,iBAAiB,0BAA2B2O,GAC5C,KACHr+B,OAAO09B,oBAAoB,oBAAqBS,GAChDn+B,OAAO09B,oBAAoB,0BAA2BW,KAE3D,IAGH,MAAMC,EAAcA,CAAClxB,EAAKvO,IPzGvB,SAAiB+W,EAAKxI,EAAKvO,GAChC,MAAM,gBAAEo/B,EAAe,YAAEzJ,GAAgB5e,GAAO,CAAC,EACjD,IACE,IAAKqoB,GAAiBrb,QAAS,OAC/B,MAAMwR,EAAMp5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG2D,GAAU,IAE9C,GAAIuO,GAAsB,kBAARA,GAAoBA,EAAI/B,OAAS,EACjD,IACE,MAAMkzB,EAAQ,IAAIC,MAAMpxB,GACxBmxB,EAAM1/B,OAASu1B,EACfmK,EAAM7O,mBAAmB,QAAS,KAChC,IAAM6O,EAAME,OAAS,CAAE,MAAO,CAC9BtK,GAAave,EAAKwe,IACjB,CAAEsK,MAAM,IACX,MAAM7iC,EAAI0iC,EAAMvX,SAEhB,YADInrB,GAAwB,oBAAZA,EAAE2qB,OAAsB3qB,EAAE2qB,MAAM,IAAM2N,GAAave,EAAKwe,IAE1E,CAAE,MACA,CAIJD,GAAave,EAAKwe,EACpB,CAAE,MAAO,CACX,COkFeuK,CAAQ,CAAEV,kBAAiBzJ,cAAa0J,uBAAuB9wB,EAAKvO,GAIzE+/B,EAA2BA,CAAC7L,EAAUC,EAAUj8B,EAAU8nC,EAAiB9H,KAC7E,IACI,OEjHL,UAA2B,SAChChE,EAAQ,SACRC,EAAQ,SACRj8B,EAAQ,gBACR8nC,EAAe,QACf9H,EAAO,cACP3c,EAAa,UACbnhB,EAAS,WACTg/B,EAAU,WACVC,EAAU,2BACV2F,EAA0B,mBAC1BC,EAAkB,oBAClBC,EAAmB,UACnB9G,IAEA,IAAK4H,EAGH,OAFAhB,EAA2Bjb,QAAU,OACrCkb,EAAmBlb,QAAU,MAI/B,MAIMqQ,EAAaF,EACbG,EAAcH,EALNkE,EAAUrU,QAAQrpB,MAM1B45B,EAAYH,EACZI,EAAeJ,EANNiE,EAAUrU,QAAQppB,OAS3B65B,EAAQr4B,KAAKuT,MAAM0kB,EAAah6B,GAChCq6B,EAAQt4B,KAAKuT,OAAO2kB,EAAc,GAAKj6B,GACvCs6B,EAAQv4B,KAAKuT,MAAM4kB,EAAYl6B,GAC/Bu6B,EAAQx4B,KAAKuT,OAAO6kB,EAAe,GAAKn6B,GAGxC6lC,EAAa,GAEbC,EAAgBA,CAACvmC,EAAK+hB,EAAKykB,KAC/B,MAAMhgB,EAAOzE,EAAI0kB,kBAAoB,CAAE9S,KAAK,EAAMC,QAAQ,EAAMC,MAAM,EAAMC,OAAO,IACvE0S,EAAM7S,KAAOnN,EAAKmN,KAAS6S,EAAM5S,QAAUpN,EAAKoN,QAAY4S,EAAM3S,MAAQrN,EAAKqN,MAAU2S,EAAM1S,OAAStN,EAAKsN,QAEzHwS,EAAWpmC,KAAK,CAAEV,MAAOQ,EAAK+hB,MAAKykB,WAGrC,IAAK,IAAIpkB,EAAK2Y,EAAO3Y,GAAM4Y,EAAO5Y,IAChC,IAAK,IAAIE,EAAKuY,EAAOvY,GAAMwY,EAAOxY,IAAM,CACtC,MAAMtiB,EAAMoiB,EAAK7jB,EAAW+jB,EAC5B,GAAItiB,EAAM,GAAKA,GAAOqmC,EAAgBxzB,OAAQ,SAC9C,MAAM6zB,EAAQL,EAAgBrmC,GAC9B,IAAK0mC,EAAO,SACZ,MAAM3kB,EAAMH,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOspC,GAC7C,IAAK3kB,GAAoB,WAAbA,EAAI3b,KAAmB,SAEnC,MAAMugC,EAAWrkB,EAAK7hB,EAChBmmC,EAAYD,EAAWlmC,EACvBomC,EAAUzkB,EAAK3hB,EACfqmC,EAAaD,EAAUpmC,EAI7B,KAF6Bi6B,EAAciM,GAAYlM,EAAamM,MACzChM,EAAeiM,GAAWlM,EAAYmM,GACf,SAGlD,IAAIjyB,EAAIqB,OAAO6L,EAAIglB,aACd7wB,OAAOsC,SAAS3D,KAAIA,EAAI,GAC7BA,EAAIrS,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGmS,IAE5B,IAAImyB,EAAcpM,GAAgBiM,GAAWjM,GAAgBiM,EAAUhyB,EACnEoyB,EAAiBtM,GAAamM,GAAcnM,GAAamM,EAAajyB,EACtEqyB,EAAexM,GAAekM,EAAY/xB,GAAK6lB,GAAekM,EAC9DO,EAAgB1M,GAAckM,EAAW9xB,GAAK4lB,GAAckM,EAGhE,IAAKK,IAAgBC,IAAmBC,IAAiBC,EAAe,CACtE,MAAMC,EAAU5kC,KAAKuW,IAAI6hB,EAAeiM,GAClCQ,EAAa7kC,KAAKuW,IAAI+tB,EAAanM,GACnC2M,EAAW9kC,KAAKuW,IAAI2hB,EAAciM,GAClCY,EAAY/kC,KAAKuW,IAAI6tB,EAAYnM,GACjC/3B,EAAMF,KAAKE,IAAI0kC,EAASC,EAAYC,EAAUC,GACpDP,EAAetkC,IAAQ0kC,EACvBH,GAAmBD,GAAetkC,IAAQ2kC,EAC1CH,GAAiBF,IAAgBC,GAAkBvkC,IAAQ4kC,EAC3DH,GAAkBH,IAAgBC,IAAmBC,CACvD,CAEAX,EAAcvmC,EAAK+hB,EAAK,CAAE4R,IAAKqT,EAAapT,OAAQqT,EAAgBpT,KAAMqT,EAAcpT,MAAOqT,GACjG,CAGF,GAA0B,IAAtBb,EAAWzzB,OAGb,OAFAwyB,EAA2Bjb,QAAU,OACrCkb,EAAmBlb,QAAU,MAK/B,MAAMod,EAAal5B,IAAOA,EAAEqlB,IAAM,EAAI,IAAMrlB,EAAEslB,OAAS,EAAI,IAAMtlB,EAAEulB,KAAO,EAAI,IAAMvlB,EAAEwlB,MAAQ,EAAI,GAClGwS,EAAW5d,KAAK,CAAC5L,EAAGC,IAAMyqB,EAAUzqB,EAAEypB,OAASgB,EAAU1qB,EAAE0pB,QAC3D,MAAMiB,EAASnB,EAAW,GACpB9mC,EAAQioC,EAAOjoC,MACfkoC,EAASD,EAAO1lB,IAChBykB,EAAQiB,EAAOjB,MAGfmB,EAAYrC,EAAmBlb,QACrCkb,EAAmBlb,QAAU5qB,EAE7B,MAAMooC,IAAeF,EAAOE,WACtBC,EAAaH,EAAOI,QAAU,EAC9BvK,EAAMmK,EAAOlK,iBAAmBqK,EAEtC,GAAID,GACF,IAAKrC,EAAoBnb,QAAQtV,IAAItV,GAAQ,CAC3C+lC,EAAoBnb,QAAQ8L,IAAI12B,GAChCi/B,EAAUrU,QAAQ9oB,OAASkB,KAAKC,IAAI,EAAGg8B,EAAUrU,QAAQ9oB,OAASumC,GAElE,MAAMnJ,EAAe,IACf9V,EAAO1S,OAAOuoB,EAAUrU,QAAQloB,aAAe,EASrD,OARAu8B,EAAUrU,QAAQloB,WAAaM,KAAKC,IAAImmB,EAAM8V,QAC1C8H,EAAM7S,IACR8K,EAAUrU,QAAQlpB,GAAmB,IAAbw+B,EACf8G,EAAM3S,KACf4K,EAAUrU,QAAQnpB,GAAmB,KAAbw+B,EACf+G,EAAM1S,QACf2K,EAAUrU,QAAQnpB,GAAkB,IAAbw+B,GAG3B,MACK,CAGL,GADmBkI,IAAcnoC,EACjB,CAEd6lC,EAA2Bjb,QAAU,EACrC,MAAM2d,EAAY7xB,OAAOsC,SAASqvB,IAAeA,EAAa,EAAIA,EAAatK,EAC/E,GAAIwK,EAAY,EAAG,CACjBtJ,EAAUrU,QAAQ9oB,OAASkB,KAAKC,IAAI,EAAGg8B,EAAUrU,QAAQ9oB,OAASymC,GAElE,MAAMrJ,EAAe,IACf9V,EAAO1S,OAAOuoB,EAAUrU,QAAQloB,aAAe,EACrDu8B,EAAUrU,QAAQloB,WAAaM,KAAKC,IAAImmB,EAAM8V,EAChD,CAEA,MACF,CAEA2G,EAA2Bjb,SAAWmU,EACtC,MAAMyJ,EAAU,IAChB,KAAO3C,EAA2Bjb,SAAW4d,GAAS,CACpD3C,EAA2Bjb,SAAW4d,EACtCvJ,EAAUrU,QAAQ9oB,OAASkB,KAAKC,IAAI,EAAGg8B,EAAUrU,QAAQ9oB,OAASi8B,GAElE,MAAMmB,EAAe,IACf9V,EAAO1S,OAAOuoB,EAAUrU,QAAQloB,aAAe,EACrDu8B,EAAUrU,QAAQloB,WAAaM,KAAKC,IAAImmB,EAAM8V,EAChD,CACF,CACF,CF9CmBsB,CAAkB,CACrBzF,WACAC,WACAj8B,WACA8nC,kBACA9H,UACA3c,gBACAnhB,UAAS,EACTg/B,W7ClHU,E6CmHVC,W7ClHU,G6CmHV2F,6BACAC,qBACAC,sBACA9G,aAER,CAAE,MAAO//B,GAOL,OANAupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,gBACXC,SAAU,2BACVC,eAAgB,CAAEvnC,EAAG05B,EAAUz5B,EAAG05B,GAClCj8B,aAEG,CAAEupC,OAAQ,EAAGO,WAAY,KACpC,GAIEC,GAAmB/X,EAAAA,EAAAA,QAAO,IAAInI,MA0CpC5U,EAAAA,EAAAA,WAAU,KAWN,GATAwrB,EAAc5U,SAAU,EACxB6U,EAAY7U,QAAU,EACtBib,EAA2Bjb,QAAU,EACrCkb,EAAmBlb,QAAU,KAC7Bmb,EAAoBnb,QAAU,IAAIhC,IAClC8W,EAAe9U,QAAU,GACzB+U,EAAiB/U,QAAU,EAC3Bob,EAAgBpb,QAAU,EAEtBhrB,GAAWA,EAAQmpC,OAAQ,CAC3B,MAAMC,EAAOppC,EAAQmhC,MAAMx/B,OAAS3B,EAAQ2B,OAAS,GAC/C0nC,EAAOrpC,EAAQmhC,MAAMv/B,QAAU5B,EAAQ4B,QAAU,GACjD0nC,EAAWtpC,EAAQmpC,OAAO51B,KAAKg2B,GAAgB,aAAXA,EAAE5pC,MAC5C,GAAI2pC,EAAU,CAEV,MAAMxO,EAAawO,EAAS52B,KAAK82B,UAAUxrC,GAAMA,GAAMA,EAAG6C,SAAS,WAEnE,IAAoB,IAAhBi6B,EAAmB,CACnB,IAAI2O,EAAU3O,EAAasO,EAAQ/nC,EAC/BqoC,EAAStmC,KAAKuT,MAAMmkB,EAAasO,GAAQ/nC,EAG7C,MAAMsoC,EAAWL,EAAS52B,KAAKooB,GACzB8O,EAAiBz1B,GAAaw1B,IAAax1B,GAAa,UACxDhS,EAAYiB,KAAKC,IAAI,EAAGyT,OAAO8yB,GAAgBznC,YAAcb,GAGnE+9B,EAAUrU,QAAU,CAChBvpB,EAAGgoC,EACH/nC,EAAGgoC,EACH/nC,OAAQioC,GAAgBjoC,OAAS,GAAKN,EAAY,GAClDO,QAASgoC,GAAgBhoC,QAAU,GAAKP,EACxCQ,GAAI,EACJC,GAAI,EACJC,YAAY,EACZC,UAAW,EACXC,UAAW,OACXC,OAAQkB,KAAKE,IAAI,GAAInB,GACrBA,YACAC,KAAM,EAENC,OAAQd,EACRe,UAAWf,EACXgB,WAAYf,EACZgB,cAAehB,GAInB,IAAIkY,EAAQ,EACZ,KAAO6mB,EAAelB,EAAUrU,QAAQvpB,EAAG49B,EAAUrU,QAAQtpB,EAAG0nC,EAAMC,IAAS3vB,EAAQ2vB,GACnFhK,EAAUrU,QAAQtpB,EAAI0B,KAAKC,IAAI,EAAGg8B,EAAUrU,QAAQtpB,EAAIL,GACxDqY,IAGJ,MAAMmwB,EAAcT,EAAO/nC,EAAYg+B,EAAUrU,QAAQrpB,MACzD09B,EAAUrU,QAAQvpB,EAAI2B,KAAKC,IAAI,EAAGD,KAAKE,IAAI+7B,EAAUrU,QAAQvpB,EAAGooC,IAEhE7I,EAAU,IAAK3B,EAAUrU,QAASvoB,YAAa,KAC/Cm9B,EAAc5U,SAAU,CAC5B,MAEIqU,EAAUrU,QAAU,IACbqU,EAAUrU,QACbvpB,EAAG,EACHC,EAAG,EACHG,GAAI,EACJC,GAAI,EACJO,OAAQd,EACRe,UAAWf,EACXgB,WAAYf,EACZgB,cAAehB,GAEnBw/B,EAAU,IAAK3B,EAAUrU,QAASvoB,YAAa,KAC/Cm9B,EAAc5U,SAAU,CAEhC,MAEIqU,EAAUrU,QAAU,IACbqU,EAAUrU,QACbvpB,EAAG,EACHC,EAAG,EACHG,GAAI,EACJC,GAAI,EACJO,OAAQd,EACRe,UAAWf,EACXgB,WAAYf,EACZgB,cAAehB,GAEnBw/B,EAAU,IAAK3B,EAAUrU,QAASvoB,YAAa,KAC/Cm9B,EAAc5U,SAAU,CAEhC,GACD,CAAChrB,IAGJ,MAAMugC,EAAiBA,CAACqC,EAAMC,EAAM1jC,EAAU2qC,IACnCC,GACHnH,EACAC,EACA1jC,EACA2qC,EACAzoC,EACAu8B,EACApb,EACA6c,EAAUrU,QAAQrpB,MAClB09B,EAAUrU,QAAQppB,OAClB6gC,GAKFD,EAAiBA,CAACpO,EAAIC,EAAIqJ,EAAeC,IACpCqM,GACH5V,EACAC,EACAqJ,EACAC,EACAt8B,EACAu8B,EACApb,EACAigB,GA6BF3B,EAAkBA,CAACmJ,EAASC,EAASloC,IG7UxC,SAAyBgc,EAAKisB,EAASC,EAASloC,GACrD,MAAM,aAAEmS,EAAY,UAAE9S,EAAS,UAAEqjC,EAAS,eAAE5E,EAAc,gBAAEsG,EAAe,YAAEM,GAAgB1oB,EAEvFmsB,EAAOh2B,EAAa,kBACpBnW,EAAKooC,EAAgBpb,UACrB1P,EAAIlY,KAAKC,IAAI,GAAK8mC,GAAMxoC,OAAS,KAAQN,GACzCka,EAAInY,KAAKC,IAAI,GAAK8mC,GAAMvoC,QAAU,KAAQP,GAE1CQ,GAAMG,GAAa,EAAI,GAAK,IADXmoC,GAAM5yB,MAAqB,GAAb4yB,EAAK5yB,MAAa,KAGjD6C,EAAOhX,KAAKC,IAAI,IAAK8mC,GAAMC,UAAY,KACvCC,EAAiD,qBAA1BF,GAAMG,kBAC7BH,EAAKG,gBACP5F,EAAUyF,GAAMI,0BAA0B,GAExCC,EAAO,CACXxsC,KACAyD,EAAGwoC,EACHvoC,EAAGwoC,EACHroC,KACAC,GAXS,EAYTwZ,IACAC,IACAnB,OACA6f,MAAOkQ,GAAMnsC,IAAM,iBACnBq6B,IAAKr2B,GAAa,EAAI,GAAK,EAC3ByoC,OAAQN,IAAQA,EAAKO,oBACrBC,IAAKvnC,KAAKC,IAAI,GAAKD,KAAKE,IAAI,EAAM6mC,GAAMS,aAAe,IACvDC,IAAKR,GAEPvK,EAAe9U,QAAQlqB,KAAK0pC,GAE5B,IACE,MAAMhO,EAAMp5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAG6mC,GAAMxlC,WAAa,IACvD+hC,EAAYyD,GAAMh3B,IAAKqpB,EACzB,CAAE,MAAO,CACX,CH0SesO,CAAwB,CAC3B32B,aAAY,GACZ9S,UAAS,EACTqjC,aACA5E,iBACAsG,kBACAM,eACDuD,EAASC,EAASloC,GAInB4V,EAAUlP,IACZ,MAAMsV,EAAM,CACRhe,UACAw/B,aACAC,QACAlQ,KAAM,CAAE8P,YAAWO,gBAAeC,cAAaC,iBAAgBC,mBAAkBC,6BAA4BC,sBAAqBC,qBAClIR,UAAW,CAAEr+B,UAAS,EAAE8+B,Q7C1Vb,G6C0VsBC,kB7CzVZ,G6CyV+BC,W7CxVtC,E6CwVkDC,W7CvVlD,I6CwVdX,QAAS,CACLY,iBACAC,UAAWA,CAACpM,EAAIC,IA7CL0W,EAAC3W,EAAIC,EAAIqJ,EAAeC,KAE3C,MAAMqN,EAAMvN,GAAiBrJ,EAAIC,EAAIqJ,EAAeC,EAAgBt8B,EAAWu8B,EAAUpb,GACzF,SAAUwoB,GAAoB,UAAbA,EAAIhkC,OA0CU+jC,CAAe3W,EAAIC,EAAKr0B,GAASmhC,MAAMx/B,OAAS3B,GAAS2B,OAAS,GAAM3B,GAASmhC,MAAMv/B,QAAU5B,GAAS4B,QAAU,IAC3I6+B,gBAAiBA,EAAGh/B,IAAGC,IAAGC,QAAOC,SAAQP,UAAWyhB,EAAI3jB,WAAUC,gBAC9D6rC,OAxCMC,EAwCO,CAAEzpC,IAAGC,IAAGC,QAAOC,UAxChB87B,EAwC2B19B,GAASmhC,MAAMx/B,OAAS3B,GAAS2B,OAAS,GAxCtDg8B,EAwC4D39B,GAASmhC,MAAMv/B,QAAU5B,GAAS4B,QAAU,GAvCxI68B,GAAoB,CACvBh9B,EAAGypC,EAAKzpC,EACRC,EAAGwpC,EAAKxpC,EACRC,MAAOupC,EAAKvpC,MACZC,OAAQspC,EAAKtpC,OACbP,UAAS,EACTlC,SAAUu+B,EACVt+B,UAAWu+B,EACXC,WACApb,kBAVayoB,IAACC,EAAMxN,EAAeC,IA0CnCv8B,QAAS,CACLs/B,YAAaA,CAACj/B,EAAGC,EAAGvC,EAAUgsC,IIpWvC,SAAqBntB,EAAKmd,EAAUC,EAAUj8B,EAAU8nC,GAC7D,MAAM,cAAEzkB,EAAa,UAAEnhB,EAAS,WAAEC,EAAU,YAAEolC,EAAW,cAAE5B,EAAa,UAAEzF,GAAcrhB,EACxF,IAAKipB,EAAiB,OAEtB,MAAMxgB,EAAU0U,EAAWkE,EAAUrU,QAAQrpB,MAAQ,EAC/CypC,EAAUhQ,EAAWiE,EAAUrU,QAAQppB,OAAS,EAEhDkhC,EAAQ1/B,KAAKuT,MAAM8P,EAAUplB,GAE7BjB,EADQgD,KAAKuT,MAAMy0B,EAAU/pC,GACblC,EAAW2jC,EACjC,GAAI1iC,EAAQ,GAAKA,GAAS6mC,EAAgBxzB,OAAQ,OAElD,MAAM43B,EAASpE,EAAgB7mC,GAC/B,IAAKirC,EAAQ,OAEb,MAAMC,EAAU9oB,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOqtC,GACjD,GAAKC,GAAYA,EAAQC,SAAUF,EAAOxqC,SAAS,aAG/CyqC,EAAQ3rC,OAAQ2rC,EAAQ3rC,KAAKsS,WAAW,kBAA5C,CAGA,GAAIq5B,EAAQE,QAAUF,EAAQE,OAAOtpC,OAAQ,CAC3C,MAAMupC,EAAcle,SAAS+d,EAAQE,OAAOtpC,OAAQ,IACpD,GAAIm9B,EAAUrU,QAAQ9oB,QAAUZ,EAAY,OAC5C,MAAMoqC,EAAYtoC,KAAKE,IAAI+7B,EAAUrU,QAAQ9oB,OAASupC,EAAanqC,GACnE+9B,EAAUrU,QAAQ9oB,OAASwpC,EAC3B,IACE,MAAMlP,EAAMp5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGgoC,GAAS3mC,WAAa,IAC1D+hC,EAAY4E,GAASn4B,IAAKqpB,EAC5B,CAAE,MAAO,CAET,YADIsI,GAAeA,EAAc,cAAe1kC,GAElD,CAGA,GAAIkrC,EAAQE,QAAUF,EAAQE,OAAOG,SAAU,CAC7C,MAAMC,EAAYre,SAAS+d,EAAQE,OAAOG,SAAU,KAAO,EAC3DtM,EAAUrU,QAAQ5oB,KAAOgB,KAAKC,IAAI,GAAIg8B,EAAUrU,QAAQ5oB,MAAQ,GAAKwpC,GACrE,IACE,MAAMpP,EAAMp5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGgoC,GAAS3mC,WAAa,IAC1D+hC,EAAY4E,GAASn4B,IAAKqpB,EAC5B,CAAE,MAAO,CAET,YADIsI,GAAeA,EAAc,cAAe1kC,GAElD,CA1BoE,CA2BtE,CJuToBsgC,CAAY,CAAEle,gBAAenhB,UAAS,EAAEC,WAAU,EAAEolC,cAAa5B,gBAAezF,aAAa59B,EAAGC,EAAGvC,EAAUgsC,GACjHxK,mBAAoBA,CAACl/B,EAAGC,EAAGvC,EAAUgsC,IKxW9C,SAA4BntB,EAAKmd,EAAUC,EAAUj8B,EAAU8nC,GACpE,MAAM,cAAEzkB,EAAa,UAAEnhB,EAAS,WAAEC,EAAU,YAAEolC,EAAW,cAAE5B,EAAa,UAAEzF,GAAcrhB,EACxF,IAAKipB,EAAiB,OAEtB,MAAMxgB,EAAU0U,EAAWkE,EAAUrU,QAAQrpB,MAAQ,EAC/CypC,EAAUhQ,EAAWiE,EAAUrU,QAAQppB,OAAS,EAEhDkhC,EAAQ1/B,KAAKuT,MAAM8P,EAAUplB,GAE7BjB,EADQgD,KAAKuT,MAAMy0B,EAAU/pC,GACblC,EAAW2jC,EACjC,GAAI1iC,EAAQ,GAAKA,GAAS6mC,EAAgBxzB,OAAQ,OAElD,MAAM6zB,EAAQL,EAAgB7mC,GAC9B,IAAKknC,EAAO,OAEZ,MAAMgB,EAAS9lB,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOspC,GAChD,GAAKgB,GAAWA,EAAO3oC,MAAS2oC,EAAO3oC,KAAKsS,WAAW,mBAGlDotB,EAAUrU,QAAQ6gB,oBACrBxM,EAAUrU,QAAQ6gB,kBAAoB,IAAI7iB,MAGxCqW,EAAUrU,QAAQ6gB,kBAAkBn2B,IAAItV,IAGvCkoC,EAAOkD,QAAZ,CAGA,GAAIlD,EAAOkD,OAAOtpC,OAAQ,CACxB,MAAMupC,EAAcle,SAAS+a,EAAOkD,OAAOtpC,OAAQ,IACnD,GAAIm9B,EAAUrU,QAAQ9oB,QAAUZ,EAAY,OAE5C,MAAMoqC,EAAYtoC,KAAKE,IAAI+7B,EAAUrU,QAAQ9oB,OAASupC,EAAanqC,GACnE+9B,EAAUrU,QAAQ9oB,OAASwpC,EAG3B,IACE,MAAMlP,EAAMp5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGglC,GAAQ3jC,WAAa,IACzD+hC,EAAY4B,GAAQn1B,IAAKqpB,EAC3B,CAAE,MAAO,CAOT,OAJA6C,EAAUrU,QAAQ6gB,kBAAkB/U,IAAI12B,QAGpC0kC,GAAeA,EAAc,eAAgB1kC,GAEnD,CAGA,GAAIkoC,EAAOkD,OAAOG,SAAU,CAC1B,MAAMC,EAAYre,SAAS+a,EAAOkD,OAAOG,SAAU,KAAO,EAC1DtM,EAAUrU,QAAQ5oB,KAAOgB,KAAKC,IAAI,GAAIg8B,EAAUrU,QAAQ5oB,MAAQ,GAAKwpC,GAErE,IACE,MAAMpP,EAAMp5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGglC,GAAQ3jC,WAAa,IACzD+hC,EAAY4B,GAAQn1B,IAAKqpB,EAC3B,CAAE,MAAO,CAIT,OAFA6C,EAAUrU,QAAQ6gB,kBAAkB/U,IAAI12B,QACpC0kC,GAAeA,EAAc,eAAgB1kC,GAEnD,CArC0B,CAsC5B,CLySoBugC,CAAmB,CAAEne,gBAAenhB,UAAS,EAAEC,WAAU,EAAEolC,cAAa5B,gBAAezF,aAAa59B,EAAGC,EAAGvC,EAAUgsC,GACxHvK,kBAAmBA,CAACn/B,EAAGC,EAAGvC,EAAUgsC,EAAahM,IAC7C6H,EAAyBvlC,EAAGC,EAAGvC,EAAUgsC,EAAahM,GAC1D0B,aAAcA,CAACp/B,EAAGC,EAAGC,EAAOC,EAAQzC,EAAUC,IA9N9B0sC,EAAC3Q,EAAUC,EAAUz5B,EAAOC,EAAQzC,EAAUC,KACtE,IACI,IAAKqjC,IAAesC,EAAgB,OAGpC,MAAMgH,EAAiB,IACf9sC,GAAmB,MACpB+T,MAAM6C,KAAKqzB,EAAiBle,UAG7BghB,EAAkB9Q,GAAqB,CACzCC,WACAC,WACAz5B,QACAC,SACA5C,cAAeyjC,EACfxjC,gBAAiB8sC,EACjB5sC,WACAC,YACAojB,gBACAnhB,UAASA,IAGT2qC,GAAmBA,EAAgBv4B,OAAS,IAE5Cu4B,EAAgBrrC,QAAQC,GAAOsoC,EAAiBle,QAAQ8L,IAAIl2B,IAC5DmkC,EAAeiH,GAEvB,CAAE,MAAO1sC,GACLupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,gBACXC,SAAU,sBACVC,eAAgB,CAAEvnC,EAAG05B,EAAUz5B,EAAG05B,IAE1C,GA6LY0Q,CAAoBrqC,EAAGC,EAAGC,EAAOC,EAAQzC,EAAUC,GACvD0hC,gBAAiBA,CAACmJ,EAASC,EAASloC,IAChC8+B,EAAgBmJ,EAASC,EAASloC,GACtC++B,kBAAmBA,CAAC5B,EAAShgC,EAAUC,IM/WhD,SAA2B4e,EAAKmhB,EAAShgC,EAAUC,GACxD,MAAM,eAAE0gC,EAAc,UAAEz+B,EAAS,eAAEmhC,EAAc,aAAEruB,GAAiB6J,EAC9DiuB,EAAS9M,EAAU,IACnBzX,EAASvoB,EAAWkC,EACpBsmB,EAASvoB,EAAYiC,EAErB6qC,EAAcA,CAACnwB,EAAIE,EAAIkwB,EAAIC,KAC/B,MAAMC,EAAM,CACV,CAAE5qC,EAAGsa,EAAKowB,EAAIzqC,EAAGua,EAAKmwB,GACtB,CAAE3qC,EAAGsa,EAAKowB,EAAIzqC,EAAGua,EAAKmwB,GACtB,CAAE3qC,EAAGsa,EAAKowB,EAAIzqC,EAAGua,EAAKmwB,GACtB,CAAE3qC,EAAGsa,EAAKowB,EAAIzqC,EAAGua,EAAKmwB,IAExB,IAAK,IAAIxwB,EAAI,EAAGA,EAAIywB,EAAI54B,OAAQmI,IAAK,CACnC,MAAM0wB,EAAKD,EAAIzwB,GACf,GAAI4mB,EAAe8J,EAAG7qC,EAAG6qC,EAAG5qC,EAAGvC,EAAUC,GAAY,OAAO,CAC9D,CACA,OAAO,GAGT,GAAK0gC,EAAe9U,QAAQvX,OAE5B,IAAK,IAAI8E,EAAIunB,EAAe9U,QAAQvX,OAAS,EAAG8E,GAAK,EAAGA,IAAK,CAC3D,MAAMtU,EAAI67B,EAAe9U,QAAQzS,GAEhB,MAAbtU,EAAEyT,UAAiBzT,EAAEyT,QAAU,GACnC,MAAM60B,EAAaz1B,OAAOsC,SAASnV,EAAEsoC,YACjCtoC,EAAEsoC,WACDp4B,EAAalQ,EAAEg2B,QAAQsS,YAAc,EACpCC,EAAa11B,OAAOsC,SAASnV,EAAEwoC,eACjCxoC,EAAEwoC,cACDt4B,EAAalQ,EAAEg2B,QAAQwS,eAAiB,GACvCC,EAAU51B,OAAOsC,SAASnV,EAAE0oC,gBAC9B1oC,EAAE0oC,eACDx4B,EAAalQ,EAAEg2B,QAAQ0S,gBAAkB,IAExCC,EAAWxpC,KAAKC,IAAID,KAAKuW,IAAI1V,EAAEpC,GAAKoqC,GAAS7oC,KAAKuW,IAAI1V,EAAEnC,GAAKmqC,IACnE,IAAIY,EAAQzpC,KAAKiV,KAAKu0B,EAAW,KAC5B91B,OAAOsC,SAASyzB,IAAUA,EAAQ,KAAGA,EAAQ,GAClDA,EAAQzpC,KAAKE,IAAIupC,EAAO,IACxB,MAAMC,EAAWb,EAASY,EAE1B,IAAI9wB,EAAK9X,EAAExC,EACPwa,EAAKhY,EAAEvC,EACX,MAAMyqC,EAAMloC,EAAEqX,GAAKrX,EAAE0mC,KAAO,GAAM,GAC5ByB,EAAMnoC,EAAEsX,GAAKtX,EAAE0mC,KAAO,GAAM,GAElC,IAAIoC,GAAU,EAEd,IAAK,IAAIlrB,EAAI,EAAGA,EAAIgrB,EAAOhrB,IAAK,CAE9B,IAAImrB,EAAQjxB,EAAK9X,EAAEpC,GAAKirC,EACxB,GAAI7oC,EAAEwmC,KAAOyB,EAAYc,EAAO/wB,EAAIkwB,EAAIC,GAAK,CAC3C,IAAInoC,EAAE4mC,IAOC,CACLkC,GAAU,EACV,KACF,CAVW,CACT9oC,EAAEpC,IAAMoC,EAAEpC,GAAK2qC,EACf,MAAMS,EAAK7pC,KAAKC,IAAI,GAAID,KAAK8pC,MAAMjpC,EAAEpC,GAAIoC,EAAEnC,KACrCqrC,GAA0B,EAAhB/pC,KAAKkU,SAAe,GAAK21B,EAAKP,EAC9CzoC,EAAEnC,IAAe,IAATqrC,EACRlpC,EAAEyT,SAAW,EACbzT,EAAEmW,KAAOhX,KAAKC,IAAI,EAAGY,EAAEmW,KAAO,GAChC,CAIF,MACE2B,EAAKixB,EAIP,IAAII,EAAQnxB,EAAKhY,EAAEnC,GAAKgrC,EACxB,GAAI7oC,EAAEwmC,KAAOyB,EAAYnwB,EAAIqxB,EAAOjB,EAAIC,GAAK,CAC3C,IAAInoC,EAAE4mC,IAOC,CACLkC,GAAU,EACV,KACF,CAVW,CACT9oC,EAAEnC,IAAMmC,EAAEnC,GAAK0qC,EACf,MAAMS,EAAK7pC,KAAKC,IAAI,GAAID,KAAK8pC,MAAMjpC,EAAEpC,GAAIoC,EAAEnC,KACrCqrC,GAA0B,EAAhB/pC,KAAKkU,SAAe,GAAK21B,EAAKP,EAC9CzoC,EAAEpC,IAAe,IAATsrC,EACRlpC,EAAEyT,SAAW,EACbzT,EAAEmW,KAAOhX,KAAKC,IAAI,EAAGY,EAAEmW,KAAO,GAChC,CAIF,MACE6B,EAAKmxB,EAIP,GAAInpC,EAAEwmC,KAAOyB,EAAYnwB,EAAIE,EAAIkwB,EAAIC,GAAK,CACxC,IAAInoC,EAAE4mC,IAMC,CACLkC,GAAU,EACV,KACF,CARE9oC,EAAEpC,IAAMoC,EAAEpC,GAAK2qC,EACfvoC,EAAEnC,IAAMmC,EAAEnC,GAAK0qC,EACfvoC,EAAEyT,SAAW,EACbqE,GAA6B,GAAvB3Y,KAAKiqC,KAAKppC,EAAEpC,IAAM,GACxBoa,GAA6B,GAAvB7Y,KAAKiqC,KAAKppC,EAAEnC,IAAM,EAK5B,CACF,CAEAmC,EAAExC,EAAIsa,EACN9X,EAAEvC,EAAIua,EAENhY,EAAEmW,MAAQ+kB,GAERl7B,EAAEmW,MAAQ,GACVnW,EAAExC,GAAK,IACPwC,EAAEvC,GAAK,IACPuC,EAAExC,EAAIimB,EAAS,IACfzjB,EAAEvC,EAAIimB,EAAS,IACfolB,IACC9oC,EAAEyT,SAAW,IAAM60B,GAAc,KAElCzM,EAAe9U,QAAQnR,OAAOtB,EAAG,EAGrC,CACF,CN0PoBwoB,CAAkB,CAAEjB,iBAAgBz+B,UAAS,EAAEmhC,iBAAgBruB,aAAYA,IAAIgrB,EAAShgC,EAAUC,GACtG4hC,UAAYsM,GAAStM,EAAUsM,GAC/BrM,eAGFsM,EAAMhO,GAAYvhB,EAAKtV,IACP,IAAlB6kC,GAAKrM,WACL8E,EAAWhb,QAAUwiB,sBAAsB51B,KAUnD,OALAxD,EAAAA,EAAAA,WAAU,KACN4xB,EAAWhb,QAAUwiB,sBAAsB51B,GACpC,IAAM61B,qBAAqBzH,EAAWhb,UAC9C,CAAChrB,EAAS49B,EAAU4B,IAEhBl2B,GOjYLokC,GAAkB7+B,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,iOAgB5B8+B,GAAc9+B,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,oJASxB++B,GAAe/+B,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,+CAMzBg/B,GAAgBh/B,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,kJAS1Bi/B,GAAcj/B,EAAAA,GAAO0B,OAAMxB,WAAA,CAAAC,YAAA,gBAAbH,CAAa,mOAWTk/B,GAASA,EAAMC,SAAW,yBAA2B,yBACzDD,GAASA,EAAMC,SAAW,UAAY,WAOpDC,GAAaA,EAAG/rC,SAAQE,OAAO,EAAG8rC,gBAAe,EAAOC,oBAEtD1+B,EAAAA,GAAAA,MAACi+B,GAAe,CAAA79B,SAAA,EACZJ,EAAAA,GAAAA,MAACk+B,GAAW,CAAA99B,SAAA,CAAC,gBACLzN,GAAQ,MAGhBqN,EAAAA,GAAAA,MAACm+B,GAAY,CAAA/9B,SAAA,EACTJ,EAAAA,GAAAA,MAACo+B,GAAa,CAAAh+B,SAAA,CAAC,gBACP3N,MAER4N,EAAAA,GAAAA,KAACg+B,GAAW,CACRE,SAAUE,EACVh+B,QAASA,KACwB,oBAAlBi+B,GAA8BA,IACzC,IAAM/lC,OAAOgI,cAAc,IAAIo1B,YAAY,2BAA6B,CAAE,MAAO,GAErF4I,MAAOF,EAAe,WAAa,YAAYr+B,SAE9Cq+B,EAAe,WAAa,oBAOjDD,GAAWvT,UAAY,CACnBx4B,OAAQy4B,KAAAA,OAAiBC,WACzBx4B,KAAMu4B,KAAAA,OACNuT,aAAcvT,KAAAA,KACdwT,cAAexT,KAAAA,KAAeC,YAGlC,YC7FMyT,GAAW,GAEXC,GAAYC,IACXA,GAAQA,EAAI5uC,MACjB0uC,GAASvtC,KAAKytC,IAGHC,GAAeA,IAAMH,GAASxwC,IAAIqtB,IAAK,CAAGvrB,KAAMurB,EAAEvrB,KAAM8uC,YAAavjB,EAAEujB,eAEvEC,GAAiBA,CAACjP,EAAOgE,EAAU,CAAC,KAC/C,MAAMkL,EAAM/K,OAAOnE,GAAS,IAAIkF,OAChC,IAAKgK,EAAK,MAAO,GACjB,MAAOhvC,KAAS6kC,GAAQmK,EAAIza,MAAM,OAC5Bqa,EAAMF,GAAS96B,KAAK2X,GAAKA,EAAEvrB,KAAKilC,gBAAkBjlC,EAAKilC,eAC7D,IAAK2J,EACH,MAAO,oBAAoB5uC,mCAE7B,IACE,MAAM4tC,EAAMgB,EAAIK,QAAQ,CAAEpK,OAAMmK,MAAKlL,YACrC,MAAsB,kBAAR8J,EAAmBA,EAAM,EACzC,CAAE,MAAOnvC,GACP,MAAO,oBAAoBuB,OAAUvB,GAAG0lC,SAAW1lC,GACrD,GAIFkwC,GAAS,CACP3uC,KAAM,OACN8uC,YAAa,0BACbG,QAAOA,IACQJ,KACV3wC,IAAIqtB,GAAK,KAAKA,EAAEvrB,OAAOurB,EAAEujB,YAAc,KAAKvjB,EAAEujB,cAAgB,MAC9DhuB,KAAK,OACO,2BAKnB6tB,GAAS,CACP3uC,KAAM,QACN8uC,YAAa,wBACbG,OAAAA,GAEE,IAAMxmC,OAAOgI,cAAc,IAAIo1B,YAAY,uBAAyB,CAAE,MAAO,CAC7E,MAAO,EACT,IAIF8I,GAAS,CACP3uC,KAAM,WACN8uC,YAAa,0CACbG,OAAAA,GACE,IACExmC,OAAOgI,cAAc,IAAIo1B,YAAY,uBAErCp9B,OAAOgI,cAAc,IAAIo1B,YAAY,uBACvC,CAAE,MAAO,CACT,MAAO,qBACT,IAGF,MC9DMqJ,GAAiB,CACrBC,SAAU,QACVra,KAAM,EACNC,MAAO,EACPF,OAAQ,EACR5yB,OAAQ,QACRqvB,gBAAiB,yBACjB3Q,MAAO,UACPyuB,WAAY,qGACZ/iC,SAAU,OACVgjC,UAAW,iBACXC,UAAW,8BACXt/B,QAAS,OACT2E,cAAe,SACf3H,OAAQ,IACRuiC,WAAY,wBAGC,SAASC,KACtB,MAAOC,EAAMC,IAAWtJ,EAAAA,EAAAA,WAAS,IAC1BuJ,EAAOC,IAAYxJ,EAAAA,EAAAA,UAAS,CAAC,uDAC7BtG,EAAO+P,IAAYzJ,EAAAA,EAAAA,UAAS,IAC7B0J,GAAYte,EAAAA,EAAAA,QAAO,MACnBue,GAAWve,EAAAA,EAAAA,QAAO,MAClBwe,GAAmBxe,EAAAA,EAAAA,QAAO,IACNA,EAAAA,EAAAA,SAAO,IAGjC/c,EAAAA,EAAAA,WAAU,KACR,MAAMmyB,EAAWA,IAAM8I,EAAQ7lB,IAASA,GAClComB,EAAUA,IAAML,EAAS,IACzBM,EAAUA,IAAMR,GAAQ,GAI9B,OAHAjnC,OAAO0vB,iBAAiB,uBAAwByO,GAChDn+B,OAAO0vB,iBAAiB,sBAAuB8X,GAC/CxnC,OAAO0vB,iBAAiB,sBAAuB+X,GACxC,KACLznC,OAAO09B,oBAAoB,uBAAwBS,GACnDn+B,OAAO09B,oBAAoB,sBAAuB8J,GAClDxnC,OAAO09B,oBAAoB,sBAAuB+J,KAEnD,KAGHz7B,EAAAA,EAAAA,WAAU,KACR,IAAMhM,OAAOC,uBAAyB+mC,CAAM,CAAE,MAAO,CACrD,GAAIA,EAAM,CAERI,EAAS,IACT,IAAMG,EAAiB3kB,SAAkC,qBAAhB8kB,YAA8BA,YAAYrnC,MAAQD,KAAKC,OAAS,GAAK,CAAE,MAAQknC,EAAiB3kB,QAAUxiB,KAAKC,MAAQ,GAAK,CACrKsnC,WAAW,IAAML,EAAS1kB,SAAW0kB,EAAS1kB,QAAQglB,QAAS,EACjE,GACC,CAACZ,KAGJh7B,EAAAA,EAAAA,WAAU,KACR,MAAM67B,EAAS7xC,IACRgxC,GACS,WAAVhxC,EAAE+I,KACJkoC,GAAQ,IAIZ,OADAjnC,OAAO0vB,iBAAiB,UAAWmY,GAC5B,IAAM7nC,OAAO09B,oBAAoB,UAAWmK,IAClD,CAACb,KAGJh7B,EAAAA,EAAAA,WAAU,KACHq7B,EAAUzkB,UACfykB,EAAUzkB,QAAQklB,UAAYT,EAAUzkB,QAAQmlB,eAC/C,CAACb,EAAOF,IAEX,MAUM1/B,EAAQ,IACTm/B,GACHuB,UAAWhB,EAAO,gBAAkB,oBAGtC,OACE3/B,EAAAA,GAAAA,MAAA,OAAKC,MAAOA,EAAO,eAAc0/B,EAAKv/B,SAAA,EACpCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE2gC,QAAS,UAAWC,aAAc,iBAAkBhwB,MAAO,WAAYzQ,SAAC,+CAGtFC,EAAAA,GAAAA,KAAA,OAAK2qB,IAAKgV,EAAW//B,MAAO,CAAE6gC,KAAM,EAAGC,UAAW,OAAQH,QAAS,WAAYI,WAAY,WAAYC,WAAY,KAAM7gC,SACtHy/B,EAAMzxC,IAAI,CAAC0rC,EAAGhxB,KACbzI,EAAAA,GAAAA,KAAA,OAAaJ,MAAO,CAAE4Q,MAAOipB,EAAEt3B,WAAW,KAAO,UAAY,WAAYpC,SAAE05B,GAAjEhxB,OAGd9I,EAAAA,GAAAA,MAAA,QAAMkhC,SAzBQvyC,IAChBA,EAAE25B,iBACF,MAAM3wB,EAAQq4B,EAAMkF,OACpB,IAAKv9B,EAAO,OACZmoC,EAAS/lB,GAAQ,IAAIA,EAAM,KAAKpiB,MAChC,MAAMmmC,EAAMmB,GAAetnC,EAAO,CAAC,GAC/BmmC,GAAKgC,EAAS/lB,GAAQ,IAAIA,EAAM+jB,IACpCiC,EAAS,KAkBmB9/B,MAAO,CAAEC,QAAS,OAAQC,IAAK,MAAOygC,QAAS,MAAOrB,UAAW,kBAAmBn/B,SAAA,EAC5GC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE4Q,MAAO,WAAYzQ,SAAC,OACnCC,EAAAA,GAAAA,KAAA,SACE2qB,IAAKiV,EACLtoC,MAAOq4B,EACPmR,UAAYxyC,IAEV,IADoC,qBAAhB0xC,YAA8BA,YAAYrnC,MAAQD,KAAKC,QAChEknC,EAAiB3kB,SAAW,IAAgB,WAAV5sB,EAAE+I,IAG7C,MAFgC,oBAArB/I,EAAE25B,gBAA+B35B,EAAE25B,sBACb,oBAAtB35B,EAAEyyC,iBAAgCzyC,EAAEyyC,oBAInDC,SAAW1yC,GAAMoxC,EAASpxC,EAAE6Z,OAAO7Q,OACnC2pC,YAAY,mBACZrhC,MAAO,CAAE6gC,KAAM,EAAGzlC,WAAY,OAAQwV,MAAO,OAAQlV,OAAQ,iBAAkBilC,QAAS,UAAWxkC,aAAc,MAAOmlC,QAAS,WAEnIlhC,EAAAA,GAAAA,KAAA,UAAQ9I,KAAK,SAAS0I,MAAO,CAAE5E,WAAY,UAAWwV,MAAO,OAAQlV,OAAQ,oBAAqBilC,QAAS,WAAYxkC,aAAc,MAAOolC,OAAQ,WAAYphC,SAAC,aAMzK,CCrHe,SAASqhC,KAEtB,MAAOC,EAAWC,IAAgBrL,EAAAA,EAAAA,UAAS,KACzC,IACE,OAAO3/B,aAAaC,QAAQ,sBAAwB,OACtD,CAAE,MAAO,CACT,MAAO,WAEFmlB,EAAU6lB,IAAetL,EAAAA,EAAAA,UAAS,KACvC,IACE,MAAM/uB,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAA2C,kBAA/BA,EAAElS,yBAAuC,OAAOkS,EAAElS,wBACpE,CAAE,MAAO,CACT,MAAO,MAEFwtB,EAAMif,IAAWxL,EAAAA,EAAAA,UAAS,KAC/B,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,qBAChC,GAAW,OAAPmrC,EAAa,OAAOpuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASikB,EAAI,KAAO,IACtE,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAA8B,kBAAlBA,EAAEjS,YAA0B,OAAO3B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAEjS,aACjF,CAAE,MAAO,CACT,OAAO,KAEFwtB,EAAMkf,IAAW1L,EAAAA,EAAAA,UAAS,KAC/B,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,qBAChC,GAAW,OAAPmrC,EAAa,OAAOpuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASikB,EAAI,KAAO,IACtE,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAA8B,kBAAlBA,EAAEhS,YAA0B,OAAO5B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAEhS,aACjF,CAAE,MAAO,CACT,OAAO,KAEFwtB,EAAQkf,IAAa3L,EAAAA,EAAAA,UAAS,KACnC,IAEE,MAAM4L,EAAQvrC,aAAaC,QAAQ,uBACnC,GAAc,OAAVsrC,EAAgB,OAAOvuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASokB,EAAO,KAAO,IAE5E,MAAMC,EAAQxrC,aAAaC,QAAQ,oBACnC,GAAc,OAAVurC,EAAgB,OAAOxuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASqkB,EAAO,KAAO,IAC5E,MAAM56B,EAAI5O,OAAOkpC,0BAEjB,GAAIt6B,GAAgC,kBAApBA,EAAE/R,cAA4B,OAAO7B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE/R,gBACjF,GAAI+R,GAA6B,kBAAjBA,EAAE9R,WAAyB,OAAO9B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE9R,YAChF,CAAE,MAAO,CACT,OAAO,KAGFutB,EAASof,IAAc9L,EAAAA,EAAAA,UAAS,KACrC,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,wBAChC,GAAW,OAAPmrC,EAAa,OAAOpuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASikB,EAAI,KAAO,IACtE,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAAiC,kBAArBA,EAAE7R,eAA6B,OAAO/B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE7R,gBACpF,CAAE,MAAO,CACT,OAAO,KAGF2mB,EAAKgmB,IAAU/L,EAAAA,EAAAA,UAAS,KAC7B,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,oBAChC,GAAW,OAAPmrC,EAAa,OAAOpuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASikB,EAAI,KAAO,IACtE,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAA6B,kBAAjBA,EAAE9R,WAAyB,OAAO9B,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE9R,YAChF,CAAE,MAAO,CACT,OAAO,KAGFG,EAAkB0sC,IAAuBhM,EAAAA,EAAAA,UAAS,KACvD,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,qBAChC,GAAW,OAAPmrC,EAAa,MAAc,MAAPA,EACxB,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAAmC,mBAAvBA,EAAE3R,iBAAgC,OAAO2R,EAAE3R,gBAC7D,CAAE,MAAO,CACT,OAAO,KAGFC,EAAkB0sC,IAAuBjM,EAAAA,EAAAA,UAAS,KACvD,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,qBAChC,GAAW,OAAPmrC,EAAa,MAAc,MAAPA,EACxB,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAAmC,mBAAvBA,EAAE1R,iBAAgC,OAAO0R,EAAE1R,gBAC7D,CAAE,MAAO,CACT,OAAO,KAEFC,EAAgB0sC,IAAqBlM,EAAAA,EAAAA,UAAS,KACnD,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,mBAChC,GAAW,OAAPmrC,EAAa,MAAc,MAAPA,EACxB,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAAiC,mBAArBA,EAAEzR,eAA8B,OAAOyR,EAAEzR,cAC3D,CAAE,MAAO,CACT,OAAO,KAGFC,EAAsB0sC,IAA2BnM,EAAAA,EAAAA,UAAS,KAC/D,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,0BAChC,GAAW,OAAPmrC,EAAa,MAAc,MAAPA,EACxB,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAAuC,mBAA3BA,EAAExR,qBAAoC,OAAOwR,EAAExR,oBACjE,CAAE,MAAO,CACT,OAAO,KAEFC,EAAmB0sC,IAAwBpM,EAAAA,EAAAA,UAAS,KACzD,IACE,MAAMyL,EAAKprC,aAAaC,QAAQ,uBAChC,GAAW,OAAPmrC,EAAa,MAAc,MAAPA,EACxB,MAAMx6B,EAAI5O,OAAOkpC,0BACjB,GAAIt6B,GAAoC,mBAAxBA,EAAEvR,kBAAiC,OAAOuR,EAAEvR,iBAC9D,CAAE,MAAO,CACT,OAAO,KAEF2pC,EAAMC,IAAWtJ,EAAAA,EAAAA,WAAS,IAC1BqM,EAAWC,IAAgBtM,EAAAA,EAAAA,WAAS,IACpCuM,EAAKC,IAAUxM,EAAAA,EAAAA,UAAS,KAE7B,IACE,MAAM4I,EAAMvoC,aAAaC,QAAQ,qBACjC,GAAIsoC,EAAK,OAAOpoC,KAAKC,MAAMmoC,EAC7B,CAAE,MAAO,CACT,MAAO,CAAEla,KAAM,GAAIF,IAAK,OAGnBtS,EAAMuwB,IAAWzM,EAAAA,EAAAA,UAAS,KAC/B,IACE,MAAM4I,EAAMvoC,aAAaC,QAAQ,sBACjC,GAAIsoC,EAAK,OAAOpoC,KAAKC,MAAMmoC,EAC7B,CAAE,MAAO,CACT,MAAO,CAAEhtC,MAAO,IAAKC,OAAQ,OAGzB6wC,GAActhB,EAAAA,EAAAA,QAAO,CAAEuhB,QAAQ,EAAO7oB,QAAS,EAAGC,QAAS,IAG3D6oB,EAAWA,CAAC1uC,EAAG2uC,EAAIC,KACvB,MACMC,GAAwB,qBAAX1qC,OAAyBA,OAAO2qC,WAAa,IAAM,EAChEC,GAAwB,qBAAX5qC,OAAyBA,OAAO6qC,YAAc,IAAM,EACjEC,EAAO9vC,KAAKC,IAAI,EAAGyvC,GAAMF,GAAIjxC,OAAS,KAH7B,IAITwxC,EAAO/vC,KAAKC,IAAI,EAAG2vC,GAAMH,EAAQ,GAAMD,GAAIhxC,QAAU,KAJ5C,IAKf,IAAI6yB,EAAO3d,OAAO7S,GAAGwwB,MACjBF,EAAMzd,OAAO7S,GAAGswB,KAKpB,OAJKzd,OAAOsC,SAASqb,KAAOA,EAPb,IAQV3d,OAAOsC,SAASmb,KAAMA,EARZ,IASfE,EAAOrxB,KAAKC,IAAI,EAAGD,KAAKE,IAAI4vC,EAAMze,IAClCF,EAAMnxB,KAAKC,IAAI,EAAGD,KAAKE,IAAI6vC,EAAM5e,IAC1B,CAAEE,OAAMF,SAIjBngB,EAAAA,EAAAA,WAAU,KACR,IACE,MAAMu6B,EAAMvoC,aAAaC,QAAQ,qBAC7BsoC,GAAK0D,EAAqB,MAAR1D,EACxB,CAAE,MAAO,GACR,KAGHv6B,EAAAA,EAAAA,WAAU,KACR,MAAMg/B,EAASA,KAEbb,EAAQtuC,GAAM0uC,EAAS1uC,EAAGge,GAAM,IAChCotB,GAAQ,GACRgD,GAAa,GAEb,IACE,MAAMr7B,EAAI5O,OAAOkpC,2BAA6B,CAAC,EACL,kBAA/Bt6B,EAAElS,0BACXusC,EAAYr6B,EAAElS,0BAEa,kBAAlBkS,EAAEjS,aAA0BwsC,EAAQnuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAEjS,eAC9C,kBAAlBiS,EAAEhS,aAA0BysC,EAAQruC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAEhS,eAC5C,kBAApBgS,EAAE/R,eAA4BysC,EAAUtuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE/R,iBACnD,kBAAjB+R,EAAE9R,YAAyB4sC,EAAO1uC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE9R,cACzC,kBAArB8R,EAAE7R,gBAA6B0sC,EAAWzuC,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK0T,EAAE7R,kBAC/C,mBAAvB6R,EAAE3R,kBAAgC0sC,IAAsB/6B,EAAE3R,kBACnC,mBAAvB2R,EAAE1R,kBAAgC0sC,IAAsBh7B,EAAE1R,kBACrC,mBAArB0R,EAAEzR,gBAA8B0sC,IAAoBj7B,EAAEzR,gBAC3B,mBAA3ByR,EAAExR,sBAAoC0sC,IAA0Bl7B,EAAExR,sBAC1C,mBAAxBwR,EAAEvR,mBAAiC0sC,IAAuBn7B,EAAEvR,kBACzE,CAAE,MAAO,CAET,IAAM2C,OAAOgI,cAAc,IAAIo1B,YAAY,uBAAyB,CAAE,MAAO,GAG/E,OADAp9B,OAAO0vB,iBAAiB,qBAAsBsb,GACvC,IAAMhrC,OAAO09B,oBAAoB,qBAAsBsN,IAC7D,KAGHh/B,EAAAA,EAAAA,WAAU,KACR,IAAMhO,aAAaQ,QAAQ,oBAAqBL,KAAKM,UAAUyrC,GAAO,CAAE,MAAO,GAC9E,CAACA,KACJl+B,EAAAA,EAAAA,WAAU,KACR,IAAMhO,aAAaQ,QAAQ,qBAAsBL,KAAKM,UAAUob,GAAQ,CAAE,MAAO,GAChF,CAACA,KACJ7N,EAAAA,EAAAA,WAAU,KACR,IAAMhO,aAAaQ,QAAQ,oBAAqBwrC,EAAY,IAAM,IAAM,CAAE,MAAO,GAChF,CAACA,KACJh+B,EAAAA,EAAAA,WAAU,KACR,IAAMhO,aAAaQ,QAAQ,oBAAqBg9B,OAAOuN,GAAa,CAAE,MAAO,GAC5E,CAACA,KAGJ/8B,EAAAA,EAAAA,WAAU,KACR,MAAMi/B,EAAUj1C,IACd,IAAKq0C,EAAYznB,QAAQ0nB,OAAQ,OACjCt0C,EAAE25B,iBACF,MAAM/e,EAAK5a,EAAEk1C,QAAUb,EAAYznB,QAAQnB,QACrC5Q,EAAK7a,EAAEm1C,QAAUd,EAAYznB,QAAQlB,QACrCopB,EAAO9vC,KAAKC,IAAI,GAAI+E,OAAO2qC,YAAc,GAAK9wB,EAAKtgB,MAAQ,GAC3DwxC,EAAO/vC,KAAKC,IAAI,GAAI+E,OAAO6qC,aAAe,IAAMb,EAAY,GAAKnwB,EAAKrgB,QAAU,GACtF2wC,EAAO,CACL9d,KAAMrxB,KAAKC,IAAI,EAAGD,KAAKE,IAAI4vC,EAAMl6B,IACjCub,IAAKnxB,KAAKC,IAAI,EAAGD,KAAKE,IAAI6vC,EAAMl6B,OAG9Bu6B,EAAOA,KAAQf,EAAYznB,QAAQ0nB,QAAS,GAGlD,OAFAtqC,OAAO0vB,iBAAiB,YAAaub,GACrCjrC,OAAO0vB,iBAAiB,UAAW0b,GAC5B,KACLprC,OAAO09B,oBAAoB,YAAauN,GACxCjrC,OAAO09B,oBAAoB,UAAW0N,KAEvC,CAACvxB,EAAKtgB,MAAOsgB,EAAKrgB,OAAQwwC,KAG7Bh+B,EAAAA,EAAAA,WAAU,KACR,IAAKg7B,EAAM,OACX,MAAMqE,EAAWA,IAAMlB,EAAQtuC,GAAM0uC,EAAS1uC,EAAGge,EAAMmwB,IAIvD,OAHAhqC,OAAO0vB,iBAAiB,SAAU2b,GAElCA,IACO,IAAMrrC,OAAO09B,oBAAoB,SAAU2N,IACjD,CAACrE,EAAMntB,EAAKtgB,MAAOsgB,EAAKrgB,OAAQwwC,IAEnC,MASMsB,EAAcC,IAClB,IACEvrC,OAAOgI,cAAc,IAAIo1B,YAAY,uBAAwB,CAAEgB,OAAQmN,KAEvEvrC,OAAOkpC,0BAA4B,IAC7BlpC,OAAOkpC,2BAA6B,CAAC,KACtCqC,EAEP,CAAE,MAAO,GA0BX,IAAKvE,EAAM,OAAO,KAElB,MAAMwE,EAAa,CACjB9E,SAAU,QACVra,KAAM6d,EAAI7d,KACVF,IAAK+d,EAAI/d,IACT5yB,MAAOsgB,EAAKtgB,MACZC,OAAQwwC,EAAY,GAAKnwB,EAAKrgB,OAC9BkJ,WAAY,sBACZwV,MAAO,UACPlV,OAAQ,oBACRS,aAAc,EACdojC,UAAW,6BACXtiC,OAAQ,KACRgD,QAAS,OACT2E,cAAe,SACfu/B,WAAYpB,EAAYznB,QAAQ0nB,OAAS,OAAS,OAClDj+B,SAAU,UAcNq/B,EAAe,CACnBvD,KAAM,EACN5gC,QAASyiC,EAAY,OAAS,QAC9B/B,QAAS,GACT57B,SAAU,OACV3J,WAAY,sBAGRipC,EAAc,CAClBjpC,WAAY,UACZwV,MAAO,OACPlV,OAAQ,oBACRilC,QAAS,UACTxkC,aAAc,EACdG,SAAU,GACVilC,OAAQ,UACR+C,WAAY,GAGRC,EAAe,CACnBtkC,QAASyiC,EAAY,OAAS,OAC9B59B,WAAY,SACZ5E,IAAK,EACLygC,QAAS,UACTC,aAAc,oBACdxlC,WAAY,mBACZ2lC,WAAY,SACZyD,UAAW,QAsNb,OACEzkC,EAAAA,GAAAA,MAAA,OAAKC,MAAOkkC,EAAW/jC,SAAA,EACrBJ,EAAAA,GAAAA,MAAA,OAAKC,MA9PW,CAClBuhC,OAAQ,OACRnmC,WAAY,4CACZulC,QAAS,UACT1gC,QAAS,OACT6E,WAAY,SACZD,eAAgB,gBAChB+7B,aAAc,iBACdtkC,SAAU,IAsPiBmoC,YA7TF/1C,IACzBq0C,EAAYznB,QAAQ0nB,QAAS,EAC7BD,EAAYznB,QAAQnB,QAAUzrB,EAAEk1C,QAAUhB,EAAI7d,KAC9Cge,EAAYznB,QAAQlB,QAAU1rB,EAAEm1C,QAAUjB,EAAI/d,KA0TY1kB,SAAA,EACtDC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAExD,WAAY,IAAKoU,MAAO,WAAYzQ,SAAC,mBACnDJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,UAAW3E,SAAA,EACpDC,EAAAA,GAAAA,KAAA,UAAQI,QAzTIkkC,IAAM/B,EAAc58B,IAAOA,GAyTT24B,MAAOgE,EAAY,SAAW,WAAY1iC,MAAOqkC,EAAYlkC,SACxFuiC,EAAY,SAAM,YAErBtiC,EAAAA,GAAAA,KAAA,UAAQI,QA7TA2/B,IAAMR,GAAQ,GA6TIjB,MAAM,QAAQ1+B,MAAO,IAAKqkC,EAAajpC,WAAY,OAAQof,YAAa,QAASra,SAAC,kBAKhHC,EAAAA,GAAAA,KAAA,OAAKJ,MAAOukC,EAAapkC,SACtB,CAAC,QAAQ,WAAW,WAAWhS,IAAKqR,IACnCY,SAAAA,GAAAA,KAAA,UAAgBJ,OAnOH2kC,EAmOsBnlC,EAnOnB,CACtBpE,WAAYqmC,IAAckD,EAAM,UAAY,cAC5C/zB,MAAO6wB,IAAckD,EAAM,UAAY,OACvCjpC,OAAQ+lC,IAAckD,EAAM,oBAAsB,wBAClDhE,QAAS,WACTxkC,aAAc,EACdG,SAAU,GACVilC,OAAQ,YA4NqC/gC,QAASA,IAAMkhC,EAAaliC,GAAGW,SAAEX,GAA3DA,GAnOAmlC,WAuOjB5kC,EAAAA,GAAAA,MAAA,OAAKC,MAAOokC,EAAajkC,SAAA,CACR,UAAdshC,IA7NL1hC,EAAAA,GAAAA,MAAA,WAASC,MAAO,CAAE4kC,aAAc,IAAKzkC,SAAA,EACnCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE1D,SAAU,GAAIsoC,aAAc,EAAGh0B,MAAO,WAAYzQ,SAAC,WACjEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,GAAIC,SAAA,EAC5DC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,mBAC5CC,EAAAA,GAAAA,KAAA,SAAO9I,KAAK,QAAQ1D,IAAI,IAAID,IAAI,IAAIkxC,KAAK,OAAOC,aAAc,WA0N/C,aAAdrD,IApNL1hC,EAAAA,GAAAA,MAAAwF,GAAAA,SAAA,CAAApF,SAAA,EACEJ,EAAAA,GAAAA,MAAA,WAASC,MAAO,CAAE4kC,aAAc,IAAKzkC,SAAA,EACnCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE1D,SAAU,GAAIsoC,aAAc,EAAGh0B,MAAO,WAAYzQ,SAAC,cACjEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAG0kC,aAAc,GAAIzkC,SAAA,EAC7EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,qBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,QACL1D,IAAI,IACJD,IAAI,IACJkxC,KAAK,OACLntC,MAAO0P,OAAOsC,SAASoS,GAAYA,EAAW,GAC9CslB,SAAW1yC,IACT,MAAMyY,EAAI49B,WAAWr2C,EAAE6Z,OAAO7Q,OAC9BiqC,EAAYx6B,GACZ68B,EAAW,CAAE5uC,yBAA0B+R,QAG3C/G,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,GAAI+yC,UAAW,SAAU7kC,UAAGiH,OAAOsC,SAASoS,GAAYA,EAAW,IAAKmpB,QAAQ,SAEtHllC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,GAAIC,SAAA,EAC5DC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,WAC5CC,EAAAA,GAAAA,KAAA,SAAO9I,KAAK,WAAW4tC,gBAAc,WAIzCnlC,EAAAA,GAAAA,MAAA,WAAAI,SAAA,EACEC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE1D,SAAU,GAAIsoC,aAAc,EAAGh0B,MAAO,WAAYzQ,SAAC,cACjEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,GAAIC,SAAA,EAC5DC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,qBAC5CC,EAAAA,GAAAA,KAAA,SAAO9I,KAAK,iBAEdyI,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAGilC,UAAW,GAAIhlC,SAAA,EAC1EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,qBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,WACL8tC,UAAWzvC,EACXyrC,SAAW1yC,IACT,MAAMyY,IAAMzY,EAAE6Z,OAAO68B,QACrB/C,EAAoBl7B,GACpB,IAAMzQ,aAAaQ,QAAQ,oBAAqBiQ,EAAI,IAAM,IAAM,CAAE,MAAO,CACzE68B,EAAW,CAAEruC,iBAAkBwR,WAIrCpH,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAGilC,UAAW,GAAIhlC,SAAA,EAC1EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,qBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,WACL8tC,UAAWxvC,EACXwrC,SAAW1yC,IACT,MAAMyY,IAAMzY,EAAE6Z,OAAO68B,QACrB9C,EAAoBn7B,GACpB,IAAMzQ,aAAaQ,QAAQ,oBAAqBiQ,EAAI,IAAM,IAAM,CAAE,MAAO,CACzE68B,EAAW,CAAEpuC,iBAAkBuR,WAIrCpH,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAGilC,UAAW,GAAIhlC,SAAA,EAC1EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,mBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,WACL8tC,UAAWvvC,EACXurC,SAAW1yC,IACT,MAAMyY,IAAMzY,EAAE6Z,OAAO68B,QACrB7C,EAAkBp7B,GAClB,IAAMzQ,aAAaQ,QAAQ,kBAAmBiQ,EAAI,IAAM,IAAM,CAAE,MAAO,CACvE68B,EAAW,CAAEnuC,eAAgBsR,WAInCpH,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAGilC,UAAW,GAAIhlC,SAAA,EAC1EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,oBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,WACL8tC,UAAWtvC,EACXsrC,SAAW1yC,IACT,MAAMyY,IAAMzY,EAAE6Z,OAAO68B,QACrB5C,EAAwBr7B,GACxB,IAAMzQ,aAAaQ,QAAQ,yBAA0BiQ,EAAI,IAAM,IAAM,CAAE,MAAO,CAC9E68B,EAAW,CAAEluC,qBAAsBqR,WAIzCpH,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAGilC,UAAW,GAAIhlC,SAAA,EAC1EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,iBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,WACL8tC,UAAWrvC,EACXqrC,SAAW1yC,IACT,MAAMyY,IAAMzY,EAAE6Z,OAAO68B,QACrB3C,EAAqBt7B,GACrB,IAAMzQ,aAAaQ,QAAQ,sBAAuBiQ,EAAI,IAAM,IAAM,CAAE,MAAO,CAC3E68B,EAAW,CAAEjuC,kBAAmBoR,gBAyHvB,YAAds6B,IAhHL1hC,EAAAA,GAAAA,MAAA,WAASC,MAAO,CAAE4kC,aAAc,IAAKzkC,SAAA,EACnCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE1D,SAAU,GAAIsoC,aAAc,EAAGh0B,MAAO,WAAYzQ,SAAC,aACjEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAG0kC,aAAc,GAAIzkC,SAAA,EAC7EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,mBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,QACL1D,IAAI,IACJD,IAAI,MACJkxC,KAAK,IACLntC,MAAO0P,OAAOsC,SAASkZ,GAAQA,EAAO,EACtCwe,SAAW1yC,IACT,MAAMyY,EAAIzT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASnvB,EAAE6Z,OAAO7Q,MAAO,KAAO,IACpEmqC,EAAQ16B,GACR,IAAMzQ,aAAaQ,QAAQ,oBAAqBg9B,OAAO/sB,GAAK,CAAE,MAAO,CACrE68B,EAAW,CAAE3uC,YAAa8R,QAG9B/G,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,GAAI+yC,UAAW,SAAU7kC,SAAEiH,OAAOsC,SAASkZ,GAAQA,EAAO,QAEhG7iB,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAG0kC,aAAc,GAAIzkC,SAAA,EAC7EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,mBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,QACL1D,IAAI,IACJD,IAAI,MACJkxC,KAAK,IACLntC,MAAO0P,OAAOsC,SAASmZ,GAAQA,EAAO,EACtCue,SAAW1yC,IACT,MAAMyY,EAAIzT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASnvB,EAAE6Z,OAAO7Q,MAAO,KAAO,IACpEqqC,EAAQ56B,GACR,IAAMzQ,aAAaQ,QAAQ,oBAAqBg9B,OAAO/sB,GAAK,CAAE,MAAO,CACrE68B,EAAW,CAAE1uC,YAAa6R,QAG9B/G,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,GAAI+yC,UAAW,SAAU7kC,SAAEiH,OAAOsC,SAASmZ,GAAQA,EAAO,QAEhG9iB,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAG0kC,aAAc,GAAIzkC,SAAA,EAC7EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,iBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,QACL1D,IAAI,IACJD,IAAI,MACJkxC,KAAK,IACLntC,MAAO0P,OAAOsC,SAAS0S,GAAOA,EAAM,EACpCglB,SAAW1yC,IACT,MAAMyY,EAAIzT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASnvB,EAAE6Z,OAAO7Q,MAAO,KAAO,IACpE0qC,EAAOj7B,GACP,IAAMzQ,aAAaQ,QAAQ,mBAAoBg9B,OAAO/sB,GAAK,CAAE,MAAO,CACpE68B,EAAW,CAAExuC,WAAY2R,QAG7B/G,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,GAAI+yC,UAAW,SAAU7kC,SAAEiH,OAAOsC,SAAS0S,GAAOA,EAAM,QAE9Frc,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,EAAG0kC,aAAc,GAAIzkC,SAAA,EAC7EC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,sBAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,QACL1D,IAAI,IACJD,IAAI,MACJkxC,KAAK,IACLntC,MAAO0P,OAAOsC,SAASqZ,GAAWA,EAAU,EAC5Cqe,SAAW1yC,IACT,MAAMyY,EAAIzT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASnvB,EAAE6Z,OAAO7Q,MAAO,KAAO,IACpEyqC,EAAWh7B,GACX,IAAMzQ,aAAaQ,QAAQ,uBAAwBg9B,OAAO/sB,GAAK,CAAE,MAAO,CACxE68B,EAAW,CAAEvuC,eAAgB0R,QAGjC/G,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,GAAI+yC,UAAW,SAAU7kC,SAAEiH,OAAOsC,SAASqZ,GAAWA,EAAU,QAEtGhjB,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,GAAIC,SAAA,EAC5DC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,KAAMkO,SAAC,+BAC5CC,EAAAA,GAAAA,KAAA,SACE9I,KAAK,QACL1D,IAAI,IACJD,IAAI,MACJkxC,KAAK,IACLntC,MAAO0P,OAAOsC,SAASoZ,GAAUA,EAAS,EAC1Cse,SAAW1yC,IACT,MAAMyY,EAAIzT,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAKiqB,SAASnvB,EAAE6Z,OAAO7Q,MAAO,KAAO,IACpEsqC,EAAU76B,GACV,IAAMzQ,aAAaQ,QAAQ,sBAAuBg9B,OAAO/sB,GAAK,CAAE,MAAO,CACvE68B,EAAW,CAAEzuC,cAAe4R,QAGhC/G,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,GAAIrK,MAAO,GAAI+yC,UAAW,SAAU7kC,SAAEiH,OAAOsC,SAASoZ,GAAUA,EAAS,cA+BlG4f,IACAtiC,EAAAA,GAAAA,KAAA,OACEqkC,YAnUmB/1C,IAEzBA,EAAE25B,iBACF,MAAM0R,EAASrrC,EAAEk1C,QACX5J,EAAStrC,EAAEm1C,QACXwB,EAAS9yB,EAAKtgB,MACdqzC,EAAS/yB,EAAKrgB,OAEdqzC,EAAQC,IACZ,MAAMC,EAAKD,EAAG5B,QAAU7J,EAClB2L,EAAKF,EAAG3B,QAAU7J,EAClB2L,EAAKjyC,KAAKC,IAAI,IAAK0xC,EAASI,GAC5BG,EAAKlyC,KAAKC,IAAI,IAAK2xC,EAASI,GAClC5C,EAAQ,CAAE7wC,MAAO0zC,EAAIzzC,OAAQ0zC,KAEzBC,EAAKA,KACTntC,OAAO09B,oBAAoB,YAAamP,GACxC7sC,OAAO09B,oBAAoB,UAAWyP,IAExCntC,OAAO0vB,iBAAiB,YAAamd,GACrC7sC,OAAO0vB,iBAAiB,UAAWyd,IAgT7BnH,MAAM,SACN1+B,MAAO,CAAEo/B,SAAU,WAAYpa,MAAO,EAAGF,OAAQ,EAAG7yB,MAAO,GAAIC,OAAQ,GAAIqvC,OAAQ,cAC1EnmC,WAAY,oFAK/B,CC1kBe,SAAS0qC,IAAsB,SAAEvhB,EAAQ,QAAExvB,GAAU,EAAK,OAAEwC,EAAS,KAClF,MAAMwuC,GAAWtkB,EAAAA,EAAAA,QAAO,MAClBukB,GAAgBvkB,EAAAA,EAAAA,QAAO,MAG7B,IAAIwkB,EAAe,KACnB,IAEEA,EAAenkC,EAAAA,KACjB,CAAE,MAAOpT,GACPu3C,EAAe,IACjB,CAEA,MAeMC,EAAUA,KACd,IACMH,EAASzqB,UACXyqB,EAASzqB,QAAQ6b,QACjB4O,EAASzqB,QAAQ6qB,IAAM,GACvBJ,EAASzqB,QAAU,KACnB0qB,EAAc1qB,QAAU,KAE5B,CAAE,MAAO,GA0EX,OAtEA5W,EAAAA,EAAAA,WAAU,KACR,MAAMoB,EA5BYtC,KAClB,IAAKA,EAAM,OAAO,KAClB,MAAMvT,EAAOuT,EAAKghB,MAAM,KAAKxb,MAC7B,IAAK/Y,EAAM,OAAO,KAClB,GAAIg2C,EACF,IACE,MAAMljC,EAAMkjC,EAAa,KAAKh2C,KAC9B,OAAO8S,EAAIN,SAAWM,CACxB,CAAE,MAAOrU,GACPqI,QAAQkL,KAAK,+BAA+BhS,IAC9C,CAEF,OAAO,MAgBKm2C,CAAW7hB,GAGvB,GAAIze,GAAOkgC,EAAc1qB,UAAYxV,GAAOigC,EAASzqB,QACnD,MAAO,OAKT,GADA4qB,KACKpgC,EAAK,MAAO,OAEjB,MAAMmxB,EAAQ,IAAIC,MAAMpxB,GAaxB,OAZAmxB,EAAMoP,MAAO,EACbpP,EAAM1/B,OAAS7D,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGwT,OAAO7P,IAAW,IACzDwuC,EAASzqB,QAAU2b,EACnB+O,EAAc1qB,QAAUxV,EAGpB/Q,GACFkiC,EAAMvX,OAAOR,MAAM,QAKd,IAAMgnB,KAEZ,CAAC3hB,KAGJ7f,EAAAA,EAAAA,WAAU,KACR,MAAMuyB,EAAQ8O,EAASzqB,QACvB,GAAK2b,EAEL,GADAA,EAAM1/B,OAAS7D,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGwT,OAAO7P,IAAW,IACrDxC,EAEFkiC,EAAMvX,OAAOR,MAAM,aAInB,IAAM+X,EAAME,OAAS,CAAE,MAAO,GAE/B,CAACpiC,EAASwC,KAGbmN,EAAAA,EAAAA,WAAU,KACR,MAAM4hC,EAAYA,KAChB,MAAMrP,EAAQ8O,EAASzqB,QACnB2b,GAASliC,GACXkiC,EAAMvX,OAAOR,MAAM,SAGjB2X,EAAYnoC,IAChB,MAAM63C,KAAS73C,GAAKA,EAAEooC,QAAUpoC,EAAEooC,OAAO/hC,SACnCkiC,EAAQ8O,EAASzqB,QACvB,GAAK2b,EACL,GAAIsP,EACFtP,EAAMvX,OAAOR,MAAM,aAEnB,IAAM+X,EAAME,OAAS,CAAE,MAAO,GAKlC,OAFAz+B,OAAO0vB,iBAAiB,0BAA2Bke,GACnD5tC,OAAO0vB,iBAAiB,oBAAqByO,GACtC,KACLn+B,OAAO09B,oBAAoB,0BAA2BkQ,GACtD5tC,OAAO09B,oBAAoB,oBAAqBS,KAEjD,CAAC9hC,IAEG,IACT,C,MC/FMyxC,GAAgB,C,sp9OAGhBC,GAAgBtnC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,0EAO1BunC,GAAevnC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,2LAczBwnC,GAAexnC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,yLAazBynC,GAAaznC,EAAAA,GAAO0nC,GAAExnC,WAAA,CAAAC,YAAA,gBAATH,CAAS,gEAMtB2nC,GAAU3nC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,kDAMpB4nC,GAAU5nC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,mMAepB6nC,GAAW7nC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,sCAKrB8nC,GAAY9nC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,gCAKtB+nC,GAAU/nC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,iDAMpBgoC,GAAehoC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,gBAAVH,CAAU,iEAMzBioC,GAAkBjoC,EAAAA,GAAOkoC,MAAKhoC,WAAA,CAAAC,YAAA,iBAAZH,CAAY,oOAkB9BmoC,GAAkBnoC,EAAAA,GAAO4wB,MAAK1wB,WAAA,CAAAC,YAAA,iBAAZH,CAAY,mBAI9BooC,GAAWpoC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,iBAAVH,CAAU,yIAEZk/B,GAASA,EAAMmJ,UAAY,OAAS,QAChCnJ,GAASA,EAAMmJ,UAAY,SAAW,UAClCnJ,GAASA,EAAMmJ,UAAY,SAAW,aAE/CnJ,GAASA,EAAMoJ,SAAW,YAAc,OAChCpJ,GAASA,EAAMoJ,SAAW,OAAS,QAInDC,GAAavoC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,iBAAVH,CAAU,gIAEhBk/B,GAASA,EAAMsJ,OACdtJ,GAASA,EAAMuJ,SAMvBC,GAAqB1oC,EAAAA,GAAOoC,IAAGlC,WAAA,CAAAC,YAAA,iBAAVH,CAAU,gCAKtB,SAAS2oC,KACpB,MAAMC,GAAWC,EAAAA,EAAAA,MACXC,GAAcxmB,EAAAA,EAAAA,QAAO,OAGrB,cAAEtyB,EAAa,YAAEC,EAAW,cAAEC,EAAa,cAAEC,EAAa,gBAAEC,EAAe,qBAAEC,EAAoB,SAAEC,EAAQ,UAAEC,IAAcw4C,EAAAA,EAAAA,IAAY93C,GAASA,EAAMsJ,OACtJ,eAAE3B,EAAc,cAAEK,EAAa,gBAAEC,IAAoB6vC,EAAAA,EAAAA,IAAY93C,GAASA,EAAMsF,KAChF,MAAEZ,IAAUozC,EAAAA,EAAAA,IAAY93C,GAASA,EAAM0J,UACvC0kC,EAAe1pC,EAAMC,SAGpBozC,EAAiBC,IAAsB/R,EAAAA,EAAAA,UAAS,CAAC,GAGlDvjB,EAAgBtO,MAAiB,GAsCjCwQ,EAAcmgB,GAChBhmC,EACAC,EACAC,EACAC,EACAC,EACAujB,EA1CmBu1B,KAEfl5C,IACA4H,QAAQuN,IAAI,+BACZgkC,EAAY,IAAIn5C,MAKEo5C,CAACl4C,EAAQE,KAC/B,GAAe,gBAAXF,EAA0B,CAE1B03C,EAASt3C,EADaF,GAE1B,MAAO,GAAe,iBAAXF,EAA2B,CAClC,MAAMK,EAAQH,EAGRi4C,EAAYn5C,EAAcqB,GAC5B83C,GACAT,EAASn3C,EAAoB,CAAEF,QAAOG,MAAO23C,EAAY,UAEjE,GAQwBC,IACxBV,EAAS/2C,EAAiBy3C,MAmBxBpnB,GAAgB+C,EAAAA,EAAAA,SAAQ,IAGnB3f,GAAa,uBAAyBA,GAAa,UAC3D,KAIHC,EAAAA,EAAAA,WAAU,KACN,MAAMktB,EAAKqW,EAAY3sB,QACvB,IAAKsW,EAAI,OACT,MAAM8W,EAASA,KACX,MAAMtF,EAAKxR,EAAG+W,aAAe,EACvBrF,EAAK1R,EAAGgX,cAAgB,EAGxBC,EAFgB,GAAXp5C,GAEQ2zC,GADI,GAAZ1zC,GACoB4zC,EAC/ByE,EAASzuC,GAAmBuvC,IACxBA,IAEKjX,EAAGkX,YAAclX,EAAG4O,YACrB5O,EAAGmX,SAAS,CAAEhkB,KAAM,EAAGF,IAAK,EAAGmkB,SAAU,UAMrD,OAFAN,IACAhwC,OAAO0vB,iBAAiB,SAAUsgB,GAC3B,IAAMhwC,OAAO09B,oBAAoB,SAAUsS,IACnD,CAACj5C,EAAUC,EAAWqI,EAAgBgwC,KAGzCrjC,EAAAA,EAAAA,WAAU,KACN,MAAMktB,EAAKqW,EAAY3sB,QACvB,IAAKsW,IAAOziC,GAAiB4I,GAAkBM,EAAiB,OAEhE,MAAM+qC,EAAKxR,EAAG+W,aAAe,EACvBM,EAA0B,GAAXx5C,EACfy5C,EAAgBx1C,KAAKC,IAAI,EAAGs1C,EAAe7F,GAI3C+F,GAFK/hC,OAAO4N,GAAajjB,IAAM,IAC1BqV,OAAO4N,GAAa/iB,QAAU,IACV,EAEzBm3C,EAAcxX,EAAGkX,YAAc,EAIrC,IAAIO,EAAaD,EACbD,EAHcC,EAAmB,GAALhG,EAI5BiG,EAAaF,EAAoB,GAAL/F,EACrB+F,EANMC,EAAmB,GAALhG,IAO3BiG,EAAaF,EAAoB,GAAL/F,GAEhCiG,EAAa31C,KAAKC,IAAI,EAAGD,KAAKE,IAAIs1C,EAAeG,IAE7C31C,KAAKuW,IAAIo/B,EAAaD,GAAe,IACrCxX,EAAGmX,SAAS,CAAEhkB,KAAMskB,EAAYxkB,IAAK,EAAGmkB,SAAU,UAEvD,CAACh0B,EAAa7lB,EAAe4I,EAAgBtI,EAAU4I,KAG1DqM,EAAAA,EAAAA,WAAU,KACN,MAAM4kC,EAAoB56C,IACtB,MAAMu1C,EAASv1C,GAAKA,EAAEooC,QAAW,CAAC,EAClCsR,EAAmBtuB,IAAQ,IAAMA,KAASmqB,MAG9C,OADAvrC,OAAO0vB,iBAAiB,uBAAwBkhB,GACzC,IAAM5wC,OAAO09B,oBAAoB,uBAAwBkT,IACjE,KAGH5kC,EAAAA,EAAAA,WAAU,KACN,MAAM6kC,EAAuBA,IAAMxB,EAASxvC,IAAgB,IAE5D,OADAG,OAAO0vB,iBAAiB,sBAAuBmhB,GACxC,IAAM7wC,OAAO09B,oBAAoB,sBAAuBmT,IAChE,CAACxB,KAGJrjC,EAAAA,EAAAA,WAAU,KACN,IACI,MAAMoe,EAAUqlB,EAAgB5yC,eAAiB,EAC3C6mB,EAAO+rB,EAAgB3yC,YAAc,EACrCutB,EAAWolB,EAAgB1yC,gBAAkB,EACnDiD,OAAOkpC,0BAA4B,IAC3BlpC,OAAOkpC,2BAA6B,CAAC,EACzCxsC,yBAA2B+yC,EAAgB/yC,0BAA4BjG,GAAesiC,MAAMr8B,0BAA4B,GACxHC,YAAc8yC,EAAgB9yC,aAAe,EAC7CC,YAAc6yC,EAAgB7yC,aAAe,EAC7CC,cAAeutB,EACfttB,WAAY4mB,EACZ3mB,eAAgBstB,EAChBptB,iBAAmBwyC,EAAgBxyC,mBAAoB,EACvDC,iBAAmBuyC,EAAgBvyC,mBAAoB,EACvDC,eAAiBsyC,EAAgBtyC,iBAAkB,EACnDC,qBAAuBqyC,EAAgBryC,uBAAwB,EAC/DC,kBAAoBoyC,EAAgBpyC,oBAAqB,EAEzDyzC,iBAAkBptB,EAE1B,CAAE,MAAO,GACV,CAAC+rB,EAAiBh5C,IAErB,MAAMm5C,EAAeh4C,IACjB,IACI,IAAKA,EAED,YADA6oC,GAAal3B,KAAK,wCAAyC,CAAEm3B,UAAW,SAI5E,MAAMxtB,EAAItb,EAAQmhC,MAAMx/B,OAAS3B,EAAQ2B,OAAS,GAC5C4Z,EAAIvb,EAAQmhC,MAAMv/B,QAAU5B,EAAQ4B,QAAU,GAEpD,IAAIg8B,EAAW,GACXub,EAAU,GACV1W,EAAa,GAEjB,GAAIziC,EAAQmpC,OAAQ,CAChB,MAAMiQ,EAAUp5C,EAAQmpC,OAAO51B,KAAKg2B,GAAgB,eAAXA,EAAE5pC,MAC3Ci+B,EAAWwb,EAAUA,EAAQ1mC,KAAOM,MAAMsI,EAAIC,GAAG89B,KAAK,MAEtD,MAAM/P,EAAWtpC,EAAQmpC,OAAO51B,KAAKg2B,GAAgB,aAAXA,EAAE5pC,MAC5Cw5C,EAAU7P,EAAWA,EAAS52B,KAAOM,MAAMsI,EAAIC,GAAG89B,KAAK,MAEvD,MAAMC,EAAct5C,EAAQmpC,OAAO51B,KAAKg2B,GAAgB,YAAXA,EAAE5pC,MAC/C8iC,EAAa6W,EAAcA,EAAY5mC,KAAOM,MAAMsI,EAAIC,GAAG89B,KAAK,KACpE,MACIzb,EAAW59B,EAAQisB,OAASjZ,MAAMsI,EAAIC,GAAG89B,KAAK,MAC9CF,EAAUnmC,MAAMsI,EAAIC,GAAG89B,KAAK,MAC5B5W,EAAazvB,MAAMsI,EAAIC,GAAG89B,KAAK,MAInC5yC,QAAQuN,IAAI,oCAAqC,CAC7CulC,kBAAmBv5C,EAAQmpC,QAAQ51B,KAAKg2B,GAAgB,YAAXA,EAAE5pC,MAC/C65C,iBAAkB/W,GAAYhvB,OAC9BgmC,kBAAmBhX,GAAYz+B,OAAO6d,GAAW,OAANA,GAAYpO,OACvDimC,iBAAkBjX,GAAYz+B,OAAO6d,GAAW,OAANA,GAAY2L,MAAM,EAAG,KAInEiqB,EAAS53C,EAAa,CAClBG,UACAlB,YAAa8+B,EACb7+B,cAAeo6C,EACfn6C,cAAeyjC,EACftjC,SAAUmc,EACVlc,UAAWmc,KAEfk8B,EAAS1uC,GAAiB,IAC1B0uC,EAASxvC,IAAgB,IAEzB4gC,GAAap+B,KAAK,0BAA2B,CACzCq+B,UAAW,OACX6Q,QAAS35C,EAAQmhC,MAAMxhC,MAAQ,UAC/Bi6C,WAAY,GAAGt+B,KAAKC,KAE5B,CAAE,MAAOjc,GACLupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,OACXC,SAAU,cACV/oC,YAEJ65C,MAAM,gDACV,GAwCJ,OACIpqC,EAAAA,GAAAA,MAAC0mC,GAAa,CAAAtmC,SAAA,EAGVC,EAAAA,GAAAA,KAACm+B,GAAU,CAAC/rC,OAAQwiB,EAAYxiB,OAAQE,KAAMsiB,EAAYtiB,MAAQ,EAAG8rC,aAAcA,EAAcC,cAAeA,KAC5G,MAAMb,GAAQY,EACduJ,EAAS3wC,EAAgBwmC,IACzB,IAAMllC,OAAOgI,cAAc,IAAIo1B,YAAY,oBAAqB,CAAEgB,OAAQ,CAAE/hC,QAAS6oC,KAAY,CAAE,MAAO,CAC1G,IAAMllC,OAAOgI,cAAc,IAAIo1B,YAAY,2BAA6B,CAAE,MAAO,KAIpF/9B,IACGqI,EAAAA,GAAAA,KAACsmC,GAAY,CAAAvmC,UACTJ,EAAAA,GAAAA,MAAC4mC,GAAY,CAAAxmC,SAAA,EACTC,EAAAA,GAAAA,KAACwmC,GAAU,CAAAzmC,SAAC,kBACZC,EAAAA,GAAAA,KAAC0mC,GAAO,CAAA3mC,SACHqmC,GAAcr4C,IAAI,CAACA,EAAKuC,KACrBqP,EAAAA,GAAAA,MAACgnC,GAAO,CAAavmC,QAASA,IAAM8nC,EAAYn6C,GAAKgS,SAAA,EACjDJ,EAAAA,GAAAA,MAAA,OAAAI,SAAA,EACIC,EAAAA,GAAAA,KAAC4mC,GAAQ,CAAA7mC,SAAEhS,EAAIsjC,MAAMxhC,MAAQ,iBAC7B8P,EAAAA,GAAAA,MAACknC,GAAS,CAAA9mC,SAAA,CAAC,OAAKhS,EAAIsjC,MAAM2Y,QAAU,iBAExChqC,EAAAA,GAAAA,KAAC8mC,GAAO,CAAA/mC,UACJJ,EAAAA,GAAAA,MAAA,OAAAI,SAAA,CAAK,SAAOhS,EAAIsjC,MAAMx/B,MAAM,IAAE9D,EAAIsjC,MAAMv/B,cANlCxB,OAWtB0P,EAAAA,GAAAA,KAAC+mC,GAAY,CAAAhnC,UACTJ,EAAAA,GAAAA,MAACqnC,GAAe,CAAAjnC,SAAA,CAAC,8CAEbC,EAAAA,GAAAA,KAACknC,GAAe,CAAChwC,KAAK,OAAO+yC,OAAO,QAAQjJ,SArEzCkJ,IAC3B,IACI,MAAMC,EAAOD,EAAM/hC,OAAOiiC,MAAM,GAChC,IAAKD,EAAM,OAEX,MAAME,EAAa,IAAIC,WACvBD,EAAWE,WAAWJ,EAAM,SAC5BE,EAAWG,OAAUl8C,IACjB,IACI,MAAMm8C,EAASh0C,KAAKC,MAAMpI,EAAE6Z,OAAOgjB,QACnC+c,EAAYuC,EAChB,CAAE,MAAOj7C,GACLupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,OACXC,SAAU,wBACVyR,SAAUP,EAAKt6C,OAEnBk6C,MAAM,+CACV,GAEJM,EAAWM,QAAWn7C,IAClBupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,OACXC,SAAU,wBACVyR,SAAUP,EAAKt6C,KACf0a,MAAO,eAEXw/B,MAAM,uBAEd,CAAE,MAAOv6C,GACLupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,OACXC,SAAU,yBAElB,gBA0CIj5B,EAAAA,GAAAA,KAACmnC,GAAQ,CACLxc,IAAKkd,EACL+C,SAAWt8C,GAAMq5C,EAAS1uC,GAAiB3K,EAAEu8C,cAAcnC,YAAc,IACzEtB,UAAWnvC,EACXovC,SAAU1vC,EAAeoI,SAExBhR,GACGiR,EAAAA,GAAAA,KAACsnC,GAAU,CAACC,OAAmB,GAAXl4C,EAAem4C,QAAqB,GAAZl4C,EAAeyQ,UAGvDC,EAAAA,GAAAA,KAACghB,GAAS,CACN3xB,SAAUA,EACVC,UAAWA,EACXkX,SAAU,GACVxX,YAAaA,EACbC,cAAeA,EACfC,cAAeA,EACfC,gBAAiBA,EACjBC,qBAAsBA,EACtBsjB,cAAeA,EACfkC,YAAaA,EACbqM,cAAeA,EACftuB,YAAaiiB,EAAYjiB,aAAe,GACxCuuB,gBAAiBnyB,GAAesiC,MAAMnQ,gBACtCC,gBAAiBpyB,GAAesiC,MAAMlQ,gBACtCnsB,yBAA2B+yC,EAAgB/yC,0BAA4BjG,GAAesiC,MAAMr8B,yBAC5FgD,cAAeA,EACf/C,YAAa8yC,EAAgB9yC,aAAe,EAC5CC,YAAa6yC,EAAgB7yC,aAAe,EAC5CC,cAAe4yC,EAAgB5yC,eAAiB,EAChDC,WAAY2yC,EAAgB3yC,YAAc,EAC1CC,eAAgB0yC,EAAgB1yC,gBAAkB,EAClDE,iBAAkBwyC,EAAgBxyC,mBAAoB,EACtDC,iBAAkBuyC,EAAgBvyC,mBAAoB,EACtDC,eAAgBsyC,EAAgBtyC,iBAAkB,EAClDC,qBAAsBqyC,EAAgBryC,uBAAwB,EAC9DC,kBAAmBoyC,EAAgBpyC,oBAAqB,OAKhEqK,EAAAA,GAAAA,KAACynC,GAAkB,CAAA1nC,SAAC,qCAK5BC,EAAAA,GAAAA,KAAC0lC,GAAqB,CAACvhB,SAAUp1B,GAAesiC,MAAMyZ,gBAAiBn2C,QAASypC,EAAcjnC,OAAQ,MAGtG6I,EAAAA,GAAAA,KAACohC,GAAY,KACbphC,EAAAA,GAAAA,KAACq/B,GAAY,MAGzB,CCzcA,SAnDO3Z,eAAwBqlB,EAAUC,EAAgB,WAAYC,EAAW,4BAC9E,IAGE,GADoC,qBAAX3yC,QAA+D,oBAA9BA,OAAO4yC,mBAClD,CACb,MAAM92B,EAAO,CACX42B,gBACAG,MAAO,CACL,CACExM,YAAa,OACbsL,OAAQ,CAAE,CAACgB,GAAY,4BAA6B,CAAC,IAAKD,EAAc5mB,MAAM,KAAKxb,OAAS,aAIlG,IAAIgrB,EACJ,IACEA,QAAet7B,OAAO4yC,mBAAmB92B,EAC3C,CAAE,MAAO9lB,GAEP,GAAIA,IAAiB,eAAXA,EAAEuB,MAAoC,oBAAXvB,EAAEuB,MAA6B,OAAO,EAC3E,MAAMvB,CACR,CAEA,MAAM88C,QAAiBxX,EAAOyX,iBACxBC,EAAOP,aAAoBQ,KAAOR,EAAW,IAAIQ,KAAK,CAACR,GAAW,CAAE7zC,KAAM+zC,IAGhF,aAFMG,EAASI,MAAMF,SACfF,EAASK,SACR,CACT,CACF,CAAE,MAAOn9C,GAEP,IAAMqI,QAAQkL,KAAK,sDAAuDvT,EAAI,CAAE,MAAO,CACzF,CAGA,IACE,MAAMg9C,EAAOP,aAAoBQ,KAAOR,EAAW,IAAIQ,KAAK,CAACR,GAAW,CAAE7zC,KAAM+zC,IAC1ES,EAAO19B,SAASC,cAAc,KAOpC,OANAy9B,EAAKC,KAAOC,IAAIC,gBAAgBP,GAChCI,EAAKI,SAAWd,GAAiB,WACjCh9B,SAAS+9B,KAAKnkB,YAAY8jB,GAC1BA,EAAKM,QACLh+B,SAAS+9B,KAAKjjC,YAAY4iC,GAC1BzL,WAAW,IAAM2L,IAAIK,gBAAgBP,EAAKC,MAAO,IAC1C,CACT,CAAE,MAAOr9C,GACP,IAAMqI,QAAQnH,MAAM,4BAA6BlB,EAAI,CAAE,MAAO,CAC9D,OAAO,CACT,CACF,EC3Da49C,GAAsBA,CAAClhB,EAAYmhB,EAAa98C,EAAUC,KACnE,MAAM88C,EAAUD,EAAYnhB,GACtBn5B,EAAQxC,EACRyC,EAASxC,EACT2kC,EAAQ,CAACjJ,GACT5T,EAAU,IAAI8B,IACdmzB,EAAkB,GAExB,KAAOpY,EAAMtwB,OAAS,GAAG,CACrB,MAAM7S,EAAMmjC,EAAMrrB,MAClB,GAAIwO,EAAQxR,IAAI9U,GAAM,SAEtB,GADAsmB,EAAQ4P,IAAIl2B,GACRA,EAAM,GAAKA,GAAOq7C,EAAYxoC,OAAQ,SAC1C,GAAIwoC,EAAYr7C,KAASs7C,EAAS,SAClCC,EAAgBr7C,KAAKF,GAErB,MAAMa,EAAIb,EAAMe,EACVD,EAAI0B,KAAKuT,MAAM/V,EAAMe,GACvBF,EAAI,GAAGsiC,EAAMjjC,KAAKF,EAAM,GACxBa,EAAIE,EAAQ,GAAGoiC,EAAMjjC,KAAKF,EAAM,GAChCc,EAAI,GAAGqiC,EAAMjjC,KAAKF,EAAMe,GACxBD,EAAIE,EAAS,GAAGmiC,EAAMjjC,KAAKF,EAAMe,EACzC,CACA,OAAOw6C,GAcEC,GAAYA,CAACh8C,EAAOi8C,EAAcC,EAAWn9C,EAAUC,EAAWm9C,EAAgBC,KAC3F,MACMC,EAAU,IADIF,KAEd96C,EAAIrB,EAAQjB,EACZuC,EAAI0B,KAAKuT,MAAMvW,EAAQjB,GAE7B,IAAK,IAAIqnB,EAAK,EAAGA,EAAK81B,EAAW91B,IAC7B,IAAK,IAAIE,EAAK,EAAGA,EAAK41B,EAAW51B,IAAM,CACnC,MAAMg2B,EAAUj7C,EAAIilB,EACd3G,EAAUre,EAAI8kB,EACpB,GAAIk2B,EAAUv9C,GAAY4gB,EAAU3gB,EAAW,CAE3Cq9C,EADoB18B,EAAU5gB,EAAWu9C,GAClBL,EAAeA,EAAar+C,GAAK,IAC5D,CACJ,CAEJw+C,EAAeC,IChBnB,GAnCqBE,EAAG5pC,WAAUF,UAAS0E,QAAO7H,QAAOktC,MAAK5sC,gBAC1D,MAAO5P,EAAOy8C,IAAY9W,EAAAA,EAAAA,UAAS,IAEnC3xB,EAAAA,EAAAA,WAAU,KAEN,GAAIrB,GAAYA,EAASU,OAAS,EAAG,CACjC,MAAMqpC,EAAWC,YAAY,KACzBF,EAAUtU,IAAeA,EAAY,GAAKx1B,EAASU,SACpD8D,GAAS,KAEZ,MAAO,IAAMylC,cAAcF,EAC/B,GACD,CAAC/pC,EAAUwE,IAGd,IAAI0lC,EAAS,KAOb,OANIlqC,GAAYA,EAASU,OAAS,EAC9BwpC,EAASlqC,EAAS3S,EAAQ2S,EAASU,QAC5BZ,IACPoqC,EAASpqC,GAGRoqC,GAGDntC,EAAAA,GAAAA,KAAA,OACI+lC,IAAKoH,EACLL,IAAKA,GAAO,GACZltC,MAAOA,EACPM,UAAWA,EACXktC,WAAW,IARC,MCpBXjG,GAAWA,EACpB93C,WACAC,YACA+9C,wBACAC,0BACAC,0BACAC,WACAC,cACAC,aACA1+C,cACAC,gBACAC,gBACAwjB,gBACAi7B,aACAnB,YACAoB,uBACAC,YACAC,kBACAC,YACAC,aACAC,sBACAC,uBACAC,oBACAC,uBACAC,oBAGIruC,EAAAA,GAAAA,KAAA,OAAKE,UAAU,WACXN,MAAO,CACH6gC,KAAM,EAAGF,QAAS,OAAQpf,gBAAiB,OAC3Cxc,SAAU,OAAQq6B,SAAU,WAAY+E,WAAY,QAExDuK,UAAWA,IAAMD,GAAc,GAAOtuC,UACtCJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEo/B,SAAU,WAAYntC,MAAO,eAAiB08C,aAAcH,EAAqBruC,SAAA,EAE3FC,EAAAA,GAAAA,KAAA,OACIJ,MAAO,CACHo/B,SAAU,WACVva,IAAK,EACLE,KAAM,EACN9yB,MAAkB,GAAXxC,EACPyC,OAAoB,GAAZxC,EACR4xB,gBAAiBmsB,EAAwB,OAAOA,KAA2B,OAC3ElsB,gBAAkBksB,EAAkD,cAA1BC,EAC1CkB,iBAAkB,WAClBC,eAAgB,YAChB5xC,OAAQ,EACR6xC,cAAe,WAGvB1uC,EAAAA,GAAAA,KAAA,OAAKE,UAAU,OACXN,MAAO,CACHC,QAAS,OACT8uC,oBAAqB,UAAUt/C,WAC/Bu/C,iBAAkB,UAAUt/C,WAC5BwQ,IAAK,MACLxE,OAAQ,iBACR6lB,gBAAiB,cACjB6d,SAAU,WACVmC,OAAuB,WAAfuM,EAA0B,OAAS,UAC3C7wC,OAAQ,GACVkD,SACDmD,MAAM7T,EAAWC,GAAWi6C,KAAK,GAAGx7C,IAAI,CAAC8gD,EAAGv+C,KACzC,MAAMqB,EAAIrB,EAAQjB,EACZuC,EAAI0B,KAAKuT,MAAMvW,EAAQjB,GAG7B,IAAIy/C,EAAgB9/C,EAAYsB,GAC5By+C,EAAkB9/C,EAAcqB,GAChC0+C,EAAkB9/C,IAAgBoB,GAGtC,GAAIu9C,GAAaC,EAAiB,CAC9B,MAAMmB,EAAOnB,EAAgBn8C,EACvBu9C,EAAOpB,EAAgBl8C,EAE7B,GAAID,GAAKs9C,GAAQt9C,EAAIs9C,EAAOpB,EAAUriC,GAAK5Z,GAAKs9C,GAAQt9C,EAAIs9C,EAAOrB,EAAUpiC,EAAG,CAE5E,MAAMsO,EAAUpoB,EAAIs9C,EAEdE,GADUv9C,EAAIs9C,GACarB,EAAUriC,EAAIuO,EAE/C+0B,EAAgBjB,EAAU/f,SAASqhB,GACnCJ,EAAkBlB,EAAUne,WAAWyf,GACvCH,EAAkBnB,EAAUlb,aAAawc,EAC7C,CACJ,CAEA,MAAMC,EAAUN,EAAgBp8B,EAAcjP,KAAKC,GAAKA,EAAExV,KAAO4gD,GAAiB,KAC5EO,EAASN,EAAkBr8B,EAAcjP,KAAKC,GAAKA,EAAExV,KAAO6gD,GAAmB,KAC/EO,EAAYN,EAAkBt8B,EAAcjP,KAAKC,GAAKA,EAAExV,KAAO8gD,GAAmB,KAExF,IAAIO,GAAa,EACbC,GAAqB,EAGzB,MAAMP,EAAOnB,EAAkBA,EAAgBn8C,EAAKk8C,EAAYA,EAAUl8C,EAAI,EACxEu9C,EAAOpB,EAAkBA,EAAgBl8C,EAAKi8C,EAAYA,EAAUj8C,EAAI,EAE1Ei8C,GAAal8C,GAAKs9C,GAAQt9C,EAAIs9C,EAAOpB,EAAUriC,GAAK5Z,GAAKs9C,GAAQt9C,EAAIs9C,EAAOrB,EAAUpiC,IACtF8jC,GAAa,GACTzB,GAAoBA,EAAgBn8C,IAAMk8C,EAAU4B,WAAa3B,EAAgBl8C,IAAMi8C,EAAU6B,YACjGF,GAAqB,IAI7B,IAAIG,GAAkB,EAClBC,GAAc,EAClB,GAAmB,SAAflC,EACA,GAAIM,GAAcD,GAA4B,OAAfJ,EAAqB,CAChD,MAAMkC,EAAKlC,EAAat+C,EAClBygD,EAAKx8C,KAAKuT,MAAM8mC,EAAat+C,GAC7B0gD,EAAKhC,EAAUp8C,EACfo3B,EAAKglB,EAAUn8C,EACfo+C,EAAO18C,KAAKE,IAAIu8C,EAAIF,GACpBI,EAAO38C,KAAKE,IAAIu1B,EAAI+mB,GACpBrd,EAAOn/B,KAAKC,IAAIw8C,EAAIF,GACpBK,EAAO58C,KAAKC,IAAIw1B,EAAI+mB,GACtBn+C,GAAKq+C,GAAQr+C,GAAK8gC,GAAQ7gC,GAAKq+C,GAAQr+C,GAAKs+C,IAAMP,GAAkB,EAC5E,MAAY3B,GAAcL,IAAer9C,IACrCs/C,GAAc,GAItB,IAAIO,GAAgB,EACpB,GAAoB,UAAfzC,GAA0C,OAAfC,EAAqB,CACjD,MAAMkC,EAAKlC,EAAat+C,EAClBygD,EAAKx8C,KAAKuT,MAAM8mC,EAAat+C,GAC/BsC,GAAKk+C,GAAMl+C,EAAIk+C,EAAKrD,GAAa56C,GAAKk+C,GAAMl+C,EAAIk+C,EAAKtD,IAAW2D,GAAgB,EACxF,CAEA,IAAIC,GAAiB,EACjBC,GAAkB,EACH,WAAf3C,IACIE,EAAqBhoC,IAAItV,GAAQ+/C,GAAkB,EAC9C1C,IAAer9C,IAAO8/C,GAAiB,IAGpD,IAAIE,EAAc9C,EAAW,oCAAsC,OAC/D+C,EAAU,cAEd,MAAMC,KAAkBpB,GAAWA,EAAQt8B,OAASs8B,EAAQt8B,MAAMoE,QAC5Du5B,KAAiBrB,GAAWA,EAAQt8B,OAASs8B,EAAQt8B,MAAMqE,OAC3Du5B,KAAgBtB,GAAWA,EAAQt8B,OAASs8B,EAAQt8B,MAAMC,MAE5Do9B,EAAeG,EAAc,gBACxBD,GAAmBC,EAAc,oBAAqBC,EAAU,oBAChEH,EAAgBE,EAAc,mBAC9BV,EAAaU,EAAc,iBAC3BX,GAAmBW,EAAc,kBAAmBC,EAAU,wBAC9DhB,EACDC,GACAc,EAAc,iBACdC,EAAU,2BAEVD,EAAc,iBACdC,EAAU,0BAGR/C,IAAU8C,EAAc,QAElC,IAAIK,EAAqB,CAAC,EAa1B,MAZgB,gBAAZJ,EACAI,EAAmBxvB,gBAAkBovB,EAC9BC,IAEHG,EAAmB31C,WADnBy1C,EACgC,4CACzBC,EACyB,4CAEA,8CAKpC/wC,EAAAA,GAAAA,MAAA,OACI0kC,YAAc/1C,GAAM2/C,EAAoB39C,EAAOhC,GAC/CsiD,aAAcA,IAAM1C,EAAqB59C,GACzCg+C,UAAWA,IAAMH,EAAkB79C,GACnCsP,MAAO,CACH/N,MAAO,OAAQC,OAAQ,OAAQwJ,OAAQg1C,EACvCzzC,OAASszC,GAAiBC,GAAkBC,GAAmBT,GAAeD,EAAmB,GAAMJ,EAAa,GAAK,EACzHsB,UAAW,aAAchxC,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SAAUu6B,SAAU,cACjG2R,GACL5wC,SAAA,CAEDqvC,IAAWpvC,EAAAA,GAAAA,KAAC6sC,GAAY,CACrB5pC,SAAUmsC,EAAQnsC,SAClBF,QAASqsC,EAAQrsC,QACjB0E,MAAO2nC,EAAQxrC,eACfhE,MAAO,CAAEo/B,SAAU,WAAYntC,MAAO,OAAQC,OAAQ,OAAQg/C,UAAW,UAAWj0C,OAAQ,KAI/FwyC,IAAUrvC,EAAAA,GAAAA,KAAC6sC,GAAY,CACpB5pC,SAAUosC,EAAOpsC,SACjBF,QAASssC,EAAOtsC,QAChB0E,MAAO4nC,EAAOzrC,eACdhE,MAAO,CAAEo/B,SAAU,WAAYntC,MAAO,OAAQC,OAAQ,OAAQg/C,UAAW,UAAWj0C,OAAQ,KAI/FyyC,IACGtvC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CACRo/B,SAAU,WACVntC,MAAO,OACPC,OAAQ,OACRkJ,WAAYs0C,EAAUyB,aAAe,qBACrCl0C,OAAQ,EACRgD,QAAS,OACT6E,WAAY,SACZD,eAAgB,SAChBvI,SAAU,MACVsU,MAAO,2BACPpU,WAAY,OACZsyC,cAAe,QACjB3uC,SACyB,UAAtBuvC,EAAUjvB,QAAsB,IAAM,OAI/CrgB,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEo/B,SAAU,WAAYva,IAAK,EAAGE,KAAM,EAAG9yB,MAAO,OAAQC,OAAQ,OAAQ+K,OAAQ,QA9CtFvM,YCnLzB0gD,GAAkB,CAC3BnxC,QAAS,cACT6E,WAAY,SACZD,eAAgB,SAChB08B,OAAQ,UACR7lC,OAAQ,iBACRilC,QAAS,SACTzuC,OAAQ,OACRqvB,gBAAiB,UACjB8vB,YAAa,MACbzM,aAAc,MACdtoC,SAAU,OACVsU,MAAO,OACPzU,aAAc,MACdgoC,WAAY,OACZmN,SAAU,OACVL,UAAW,aACXM,eAAgB,OAChBvQ,WAAY,UAGHqD,GAAc,IAAK+M,IAEnBI,GAAoB,IAC1BJ,GACH7vB,gBAAiB,OACjB/G,YAAa,OACbhe,WAAY,QCxBHi1C,GAAcA,EACvBC,SACAC,cACAC,iBACAC,kBACAC,qBACAC,gBACA5R,aAEKuR,GAGDtxC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CACRo/B,SAAU,WAAYva,IAAK,EAAGE,KAAM,EAAG9yB,MAAO,OAAQC,OAAQ,OAC9DqvB,gBAAiB,qBAAsBtkB,OAAQ,IAC/CgD,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,UACzD1E,UACEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CACRuhB,gBAAiB,OAAQof,QAAS,OAAQxkC,aAAc,MACxDojC,UAAW,4BAA6BttC,MAAO,QAC/CgO,QAAS,OAAQ2E,cAAe,SAAU1E,IAAK,QACjDC,SAAA,EACEC,EAAAA,GAAAA,KAAA,MAAIJ,MAAO,CAAEmlC,UAAW,GAAIhlC,SAAC,oBAE7BJ,EAAAA,GAAAA,MAAA,OAAAI,SAAA,EACIC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAEC,QAAS,QAAS3D,SAAU,OAAQsoC,aAAc,OAAQzkC,SAAC,eAC3EC,EAAAA,GAAAA,KAAA,SACI9I,KAAK,OACLI,MAAOi6C,EACPvQ,SAAW1yC,GAAMkjD,EAAeljD,EAAE6Z,OAAO7Q,OACzCsI,MAAO,CAAE/N,MAAO,OAAQ0uC,QAAS,MAAOsQ,UAAW,oBAI3DlxC,EAAAA,GAAAA,MAAA,OAAAI,SAAA,EACIC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAEC,QAAS,QAAS3D,SAAU,OAAQsoC,aAAc,OAAQzkC,SAAC,uBAC3EC,EAAAA,GAAAA,KAAA,SACI9I,KAAK,OACLI,MAAOm6C,EACPzQ,SAAW1yC,GAAMojD,EAAmBpjD,EAAE6Z,OAAO7Q,OAC7CsI,MAAO,CAAE/N,MAAO,OAAQ0uC,QAAS,MAAOsQ,UAAW,oBAI3DlxC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ4E,eAAgB,WAAY3E,IAAK,OAAQilC,UAAW,QAAShlC,SAAA,EACxFC,EAAAA,GAAAA,KAAA,UAAQI,QAAS2/B,EAASngC,MAAO,IAAKqkC,GAAa9iB,gBAAiB,WAAYphB,SAAC,YACjFC,EAAAA,GAAAA,KAAA,UAAQI,QAASuxC,EAAe/xC,MAAO,IAAKqkC,GAAa9iB,gBAAiB,UAAW3Q,MAAO,QAAS4J,YAAa,WAAYra,SAAC,mBArC3H,KCVX6xC,GAAkBA,EAC3BtT,QACAv+B,WACA8xC,kBAAkB,CAAElgD,EAAG,GAAIC,EAAG,IAC9BkgD,eAAe,IACfC,iBAAgB,EAChBC,qBAEA,MAAOhT,IAAY/I,EAAAA,EAAAA,UAAS4b,IACrB7D,EAAYK,IAAiBpY,EAAAA,EAAAA,WAAS,IACtCgc,EAAYC,IAAiBjc,EAAAA,EAAAA,UAAS,CAAEtkC,EAAG,EAAGC,EAAG,KACjDugD,EAAiBC,IAAsBnc,EAAAA,EAAAA,UAAS4b,IAChDQ,EAAaC,IAAkBrc,EAAAA,EAAAA,WAAU8b,IACzCQ,EAAUC,IAAevc,EAAAA,EAAAA,WAAS,IAClCwc,EAAgBC,IAAqBzc,EAAAA,EAAAA,WAAS,GAC/C0c,GAAYtxB,EAAAA,EAAAA,QAAO,OAGzB/c,EAAAA,EAAAA,WAAU,KACDmuC,GACDL,EAAmBP,IAExB,CAACA,EAAiBY,KAGrBnuC,EAAAA,EAAAA,WAAU,KACN,GAAIquC,EAAUz3B,SAAW82B,EAAgB,CACrC,MAAMlgD,EAAS6gD,EAAUz3B,QAAQ03B,aACjCZ,EAAelgD,EACnB,GACD,CAACugD,EAAaL,KAEjB1tC,EAAAA,EAAAA,WAAU,KACN,GAAI0pC,EAAY,CACZ,MAAM6E,EAAmBvkD,IACrB8jD,EAAmB,CACfzgD,EAAGrD,EAAEk1C,QAAUyO,EAAWtgD,EAC1BC,EAAGtD,EAAEm1C,QAAUwO,EAAWrgD,KAI5BgkC,EAAgBA,KAClByY,GAAc,IAMlB,OAHArgC,SAASga,iBAAiB,YAAa6qB,GACvC7kC,SAASga,iBAAiB,UAAW4N,GAE9B,KACH5nB,SAASgoB,oBAAoB,YAAa6c,GAC1C7kC,SAASgoB,oBAAoB,UAAWJ,GAEhD,GACD,CAACoY,EAAYiE,IAchB,OAAIM,EAAiB,MAGjB5yC,EAAAA,GAAAA,MAAA,OACIgrB,IAAKgoB,EACL/yC,MAAO,CACHo/B,SAAU,QACVra,KAAMwtB,EAAgBxgD,EACtB8yB,IAAK0tB,EAAgBvgD,EACrBC,MAAOigD,EACP3wB,gBAAiB,UACjB7lB,OAAQ,iBACRS,aAAc,MACdojC,UAAW,6BACXtiC,OAAQ,GACRgD,QAAS,OACT2E,cAAe,SACfsuC,UAAW,QACb/yC,SAAA,EAGFJ,EAAAA,GAAAA,MAAA,OACI0kC,YAlCa/1C,IACrB,GAAIqkD,EAAUz3B,QAAS,CACnB,MAAM63B,EAAOJ,EAAUz3B,QAAQ83B,wBAC/Bd,EAAc,CACVvgD,EAAGrD,EAAEk1C,QAAUuP,EAAKpuB,KACpB/yB,EAAGtD,EAAEm1C,QAAUsP,EAAKtuB,MAExB4pB,GAAc,GACdqE,GAAkB,EACtB,GA0BQ9yC,MAAO,CACH2gC,QAAS,WACTpf,gBAAiB,UACjB8xB,oBAAqB,MACrBC,qBAAsB,MACtB/R,OAAQ6M,EAAa,WAAa,OAClC5xC,WAAY,OACZF,SAAU,OACV2D,QAAS,OACT4E,eAAgB,gBAChBC,WAAY,SACZq/B,WAAY,OACZvD,aAAc,kBAChBzgC,SAAA,EAEFC,EAAAA,GAAAA,KAAA,QAAAD,SAAOu+B,KACP3+B,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQC,IAAK,OAAQC,SAAA,EACxCC,EAAAA,GAAAA,KAAA,UACII,QAAU9R,IACNA,EAAEyyC,kBACFuR,GAAgBD,IAEpBzyC,MAAO,CACH5E,WAAY,UACZM,OAAQ,OACRS,aAAc,MACdlK,MAAO,OACPC,OAAQ,OACRqvC,OAAQ,UACRjlC,SAAU,OACV2D,QAAS,OACT6E,WAAY,SACZD,eAAgB,SAChB87B,QAAS,GAEbjC,MAAO+T,EAAc,WAAa,WAAWtyC,SAE5CsyC,EAAc,SAAM,YAEzBryC,EAAAA,GAAAA,KAAA,UACII,QAAU9R,IACNA,EAAEyyC,kBACFyR,GAAY,IAEhB5yC,MAAO,CACH5E,WAAY,UACZM,OAAQ,OACRS,aAAc,MACdlK,MAAO,OACPC,OAAQ,OACRqvC,OAAQ,UACR3wB,MAAO,OACPtU,SAAU,OACV2D,QAAS,OACT6E,WAAY,SACZD,eAAgB,SAChB87B,QAAS,GAEbjC,MAAM,QAAOv+B,SAChB,kBAOPsyC,IACEryC,EAAAA,GAAAA,KAAA,OACIJ,MAAO,CACH2gC,QAAS,OACTG,UAAW,OACXD,KAAM,GACR1gC,SAEDA,QCpKRozC,GAAiBA,EAAG7U,QAAOv+B,WAAUgyC,iBAAgB,MAC9D,MAAOT,EAAQ8B,IAAand,EAAAA,EAAAA,UAAS8b,GACrC,OACIpyC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE4kC,aAAc,MAAOlpC,OAAQ,iBAAkBS,aAAc,MAAOolB,gBAAiB,QAASphB,SAAA,EACxGJ,EAAAA,GAAAA,MAAA,OAAKS,QAASA,IAAMgzC,GAAW9B,GAAS1xC,MAAO,CAAE2gC,QAAS,MAAOY,OAAQ,UAAWhgB,gBAAiB,UAAW/kB,WAAY,OAAQF,SAAU,OAAQ2D,QAAS,OAAQ4E,eAAgB,gBAAiBC,WAAY,SAAUq/B,WAAY,QAAShkC,SAAA,EAC/OC,EAAAA,GAAAA,KAAA,QAAAD,SAAOu+B,KAAat+B,EAAAA,GAAAA,KAAA,QAAAD,SAAOuxC,EAAS,SAAM,cAE7CA,IAAUtxC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE2gC,QAAS,MAAOuS,UAAW,QAASpS,UAAW,QAAS3gC,SAAEA,QCPlFszC,GAAUA,EACnBhkD,WACAC,YACAN,cACAC,gBACAyjB,oBAEA,MAAM4gC,GAAYjyB,EAAAA,EAAAA,QAAO,MACnBkyB,EAAe,IACfC,EAAgB,IAoFtB,OAlFAlvC,EAAAA,EAAAA,WAAU,KACN,MAAMyJ,EAASulC,EAAUp4B,QACzB,IAAKnN,EAAQ,OAEb,MAAMG,EAAMH,EAAOI,WAAW,MACxBslC,EAAYF,EAAelkD,EAC3BqkD,EAAaF,EAAgBlkD,EAGnC4e,EAAImK,UAAY,UAChBnK,EAAIoK,SAAS,EAAG,EAAGi7B,EAAcC,GAGjC,IAAK,IAAI5hD,EAAI,EAAGA,EAAItC,EAAWsC,IAC3B,IAAK,IAAID,EAAI,EAAGA,EAAItC,EAAUsC,IAAK,CAC/B,MAAMrB,EAAQsB,EAAIvC,EAAWsC,EACvBihC,EAAS5jC,EAAYsB,GACrBqjD,EAAW1kD,EAAcqB,GAEzBykB,EAAKpjB,EAAI8hD,EACTz+B,EAAKpjB,EAAI8hD,EAGf,GAAe,OAAX9gB,EAAiB,CACjB,MAAMghB,EAAOlhC,EAAcjP,KAAKZ,GAAQA,EAAK3U,KAAO0kC,GAChDghB,IACIA,EAAK9gC,OAAOoE,OACR08B,EAAK9gC,MAAMqE,MACXjJ,EAAImK,UAAY,UACTu7B,EAAK9gC,MAAMC,KAClB7E,EAAImK,UAAY,UAEhBnK,EAAImK,UAAY,OAIpBnK,EAAImK,UAAY,UAEpBnK,EAAIoK,SAASvD,EAAIC,EAAI1hB,KAAKiV,KAAKkrC,GAAYngD,KAAKiV,KAAKmrC,IAE7D,CAGA,GAAiB,OAAbC,EAAmB,CACnB,MAAME,EAAMnhC,EAAcjP,KAAKZ,GAAQA,EAAK3U,KAAOylD,GAC/CE,IAEIA,EAAIhkD,MAAMsS,WAAW,aACrB+L,EAAImK,UAAY,UACTw7B,EAAIhkD,MAAMsS,WAAW,SAC5B+L,EAAImK,UAAY,UACTw7B,EAAIhkD,MAAMsS,WAAW,iBAC5B+L,EAAImK,UAAY,UACI,WAAbw7B,EAAI38C,KACXgX,EAAImK,UAAY,UAEhBnK,EAAImK,UAAY,UAEpBnK,EAAIoK,SAASvD,EAAIC,EAAI1hB,KAAKiV,KAAKkrC,GAAYngD,KAAKiV,KAAKmrC,IAE7D,CACJ,CAIJxlC,EAAI4lC,YAAc,2BAClB5lC,EAAI6lC,UAAY,GAChB,IAAK,IAAIpiD,EAAI,EAAGA,GAAKtC,EAAUsC,IAC3Buc,EAAI8lC,YACJ9lC,EAAI0C,OAAOjf,EAAI8hD,EAAW,GAC1BvlC,EAAI2C,OAAOlf,EAAI8hD,EAAWD,GAC1BtlC,EAAI+lC,SAER,IAAK,IAAIriD,EAAI,EAAGA,GAAKtC,EAAWsC,IAC5Bsc,EAAI8lC,YACJ9lC,EAAI0C,OAAO,EAAGhf,EAAI8hD,GAClBxlC,EAAI2C,OAAO0iC,EAAc3hD,EAAI8hD,GAC7BxlC,EAAI+lC,UAGT,CAAC5kD,EAAUC,EAAWN,EAAaC,EAAeyjB,KAGjD1S,EAAAA,GAAAA,KAAA,UACI2qB,IAAK2oB,EACLzhD,MAAO0hD,EACPzhD,OAAQ0hD,EACR5zC,MAAO,CACH/N,MAAO,OACPC,OAAQ,OACRwJ,OAAQ,iBACRS,aAAc,MACdolB,gBAAiB,UACjB+yB,eAAgB,gBCxGnBC,GAAaA,EACtB9kD,WACAC,YACAq0C,eAEA,MAAMyQ,GAAe/yB,EAAAA,EAAAA,QAAO,OACrB2sB,EAAYK,IAAiBpY,EAAAA,EAAAA,WAAS,IACtCoe,EAAWC,IAAgBre,EAAAA,EAAAA,UAAS,CAAEpkC,MAAOxC,EAAUyC,OAAQxC,KAC/DilD,EAAeC,IAAoBve,EAAAA,EAAAA,UAAS,CAAEtkC,EAAG,EAAGC,EAAG,IAGxD6iD,EAA0B,GAAXplD,EACfqlD,EAA4B,GAAZplD,EA0CtB,OAhCAgV,EAAAA,EAAAA,WAAU,KACN,IAAK0pC,EAAY,OAEjB,MAAM6E,EAAmBvkD,IACrB,MAAMsoB,EAAKtoB,EAAEk1C,QAAU+Q,EAAc5iD,EAC/B+kB,EAAKpoB,EAAEm1C,QAAU8Q,EAAc3iD,EAG/B+iD,EAAUrhD,KAAK0I,MAAM4a,EAAK,IAC1Bg+B,EAAUthD,KAAK0I,MAAM0a,EAAK,IAE1Bm+B,EAAWvhD,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK6gD,EAAUxiD,MAAQ8iD,IACvDG,EAAYxhD,KAAKC,IAAI,EAAGD,KAAKE,IAAI,IAAK6gD,EAAUviD,OAAS8iD,IAE3DC,IAAaxlD,GAAYylD,IAAcxlD,GACvCq0C,EAASkR,EAAUC,IAIrBlf,EAAgBA,KAClByY,GAAc,IAMlB,OAHArgC,SAASga,iBAAiB,YAAa6qB,GACvC7kC,SAASga,iBAAiB,UAAW4N,GAE9B,KACH5nB,SAASgoB,oBAAoB,YAAa6c,GAC1C7kC,SAASgoB,oBAAoB,UAAWJ,KAE7C,CAACoY,EAAYuG,EAAeF,EAAWhlD,EAAUC,EAAWq0C,KAG3DhkC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ2E,cAAe,SAAU1E,IAAK,QAASC,SAAA,EAClEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,OAAQE,WAAY,OAAQwoC,UAAW,UAAW7kC,SAAA,CAAC,cAC7DJ,EAAAA,GAAAA,MAAA,QAAMC,MAAO,CAAE4Q,MAAO,WAAYzQ,SAAA,CAAE1Q,EAAS,SAAIC,KAAiB,cAGhFqQ,EAAAA,GAAAA,MAAA,OACIgrB,IAAKypB,EACLx0C,MAAO,CACHo/B,SAAU,WACVntC,MAAO4iD,EAAe,KACtB3iD,OAAQ4iD,EAAgB,KACxBp5C,OAAQ,oBACR6lB,gBAAiB,UACjBplB,aAAc,MACd8D,QAAS,OACT6E,WAAY,SACZD,eAAgB,SAChBvI,SAAU,OACVsU,MAAO,UACPpU,WAAY,OACZ2nC,WAAY,OACZmN,SAAU,OACV6D,UAAW,QACbh1C,SAAA,CAED1Q,EAAS,SAAIC,GAGd0Q,EAAAA,GAAAA,KAAA,OACIqkC,YAtEe/1C,IAC3BA,EAAE25B,iBACF35B,EAAEyyC,kBACFsN,GAAc,GACdiG,EAAa,CAAEziD,MAAOxC,EAAUyC,OAAQxC,IACxCklD,EAAiB,CAAE7iD,EAAGrD,EAAEk1C,QAAS5xC,EAAGtD,EAAEm1C,WAkE1B7jC,MAAO,CACHo/B,SAAU,WACVta,QAAS,EACTE,OAAQ,EACR/yB,MAAO,OACPC,OAAQ,OACRqvB,gBAAiB,UACjBggB,OAAQ,cACRplC,aAAc,MACdT,OAAQ,iBACR6jC,UAAW,4BACXtiC,OAAQ,UAKpB8C,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,OAAQsU,MAAO,OAAQo0B,UAAW,UAAW7kC,SAAA,CAAC,kDAC9BC,EAAAA,GAAAA,KAAA,SAAK,wCC/F5Cg1C,GAAiBA,EAC1BnL,UACAoL,cACAC,kBACAC,UACAC,UACA5H,WACA6H,cACAC,WACA5H,aACA6H,gBACA/I,YACAgJ,eACA/H,cACAI,YACA4H,gBACAC,eACAC,gBACAC,mBACAC,kBACAC,kBACAvJ,eACAwJ,sBACAC,SACA/5B,UACAg6B,WACA1xC,QACA2xC,gBACAC,UACAC,UACAC,oBACA9I,0BACA+I,6BACAhJ,0BACAiJ,6BACAvhD,2BACAwhD,8BACAC,eACAC,0BACAC,6BACAC,aACAC,eACAC,cACAC,eACA1nD,WACAC,YACAN,cACAC,gBACAyjB,gBACAskC,kBAEA,MAAOC,EAAoBC,IAAyBjhB,EAAAA,EAAAA,WAAS,GACvDkhB,EAAoBA,CAACt0C,EAAM2N,EAAOuU,KACpC,MAAMqyB,KAAcv0C,EAAKE,SAAYG,MAAMC,QAAQN,EAAKI,WAAaJ,EAAKI,SAASU,OAAS,GACtF0zC,KAAcx0C,EAAKiQ,QAASjQ,EAAKiQ,MAAMoE,QACvCogC,KAAaz0C,EAAKiQ,QAASjQ,EAAKiQ,MAAMqE,OACtCvE,KAAY/P,EAAKiQ,QAASjQ,EAAKiQ,MAAMC,MACrCwkC,EAAyB,WAAd10C,EAAK3L,KAChBsgD,EAAcF,EACd,CAAEt8C,WAAY,2CACb4X,EAAS,CAAE5X,WAAY,2CAA8C,CAAEA,WAAY,QAE1F,OACIgF,EAAAA,GAAAA,KAAA,OAEII,QAASA,IAAM21C,EAAoBlzC,EAAMkiB,GACzCuZ,MAAOz7B,EAAKhT,KACZ+P,MAAO,CACHtE,OAAQixC,GAAcr+C,KAAO2U,EAAK3U,GAAK,aAAasiB,IAAU,iBAC9D2wB,OAAQ,UAAWZ,QAAS,MAAO1uC,MAAO,OAAQC,OAAQ,OAC1D+N,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SAAU0c,gBAAiB,OAClF6d,SAAU,YACZj/B,SAEDw3C,GACGv3C,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CACR/N,MAAO,OAAQC,OAAQ,OAAQiK,aAAc,EAC7C8D,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SACvDzJ,WAAY6H,EAAKkuC,aAAe,qBAChCvgC,MAAO,OAAQtU,SAAU,EAAG0oC,UAAW,SAAUhE,WAAY,IAAKxkC,WAAY,QAChF2D,SACoB,UAAjB8C,EAAKwd,QAAsB,QAAU,UAE1C+2B,GACAp3C,EAAAA,GAAAA,KAAC6sC,GAAY,CACT5pC,SAAUJ,EAAKI,SACfF,QAASF,EAAKE,QACd0E,MAAO5E,EAAKe,eACZhE,MAAO,CAAE63C,SAAU,OAAQ3E,UAAW,OAAQhC,UAAW,WACzDhE,IAAKjqC,EAAKhT,QAGdmQ,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CACR/N,MAAO,OAAQC,OAAQ,OAAQiK,aAAc,EAC7C8D,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SAAU+L,MAAO,OACxEtU,SAAU,GAAI0oC,UAAW,SAAUhE,WAAY,OAC5C4W,GACLz3C,SACGs3C,EAAYC,EAAU,QAAW1kC,EAAS,OAAS,MAAW/P,EAAKhT,MAAQ,YAlC/EgT,EAAK3U,KAyChBwpD,EAAcA,KAChB13C,EAAAA,GAAAA,KAAA,OAAKI,QAASA,KAAQ21C,EAAoB,KAAM,SAAYzX,MAAM,4BAC9D1+B,MAAO,CACHtE,OAA0B,OAAjBixC,GAAyC,SAAhBkB,EAA0B,iBAAmB,iBAC/EtM,OAAQ,UAAWZ,QAAS,MAAO1uC,MAAO,OAAQC,OAAQ,OAC1D+N,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SACvD0c,gBAAiB,UAAWjlB,SAAU,OAAQsU,MAAO,QACvDzQ,SAAC,YAKL43C,GAAeA,KACjB33C,EAAAA,GAAAA,KAAA,OAAKI,QAASA,KAAQ21C,EAAoB,KAAM,WAAczX,MAAM,iCAChE1+B,MAAO,CACHtE,OAA0B,OAAjBixC,GAAyC,WAAhBkB,EAA4B,gBAAkB,iBAChFtM,OAAQ,UAAWZ,QAAS,MAAO1uC,MAAO,OAAQC,OAAQ,OAC1D+N,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SACvD0c,gBAAiB,UAAWjlB,SAAU,OAAQsU,MAAO,OACvDzQ,SAAC,YAKL63C,GAAeA,KACjB53C,EAAAA,GAAAA,KAAA,OAAKI,QAASA,KAAQ21C,EAAoB,KAAM,WAAczX,MAAM,gBAChE1+B,MAAO,CACHtE,OAA0B,OAAjBixC,GAAyC,WAAhBkB,EAA4B,mBAAqB,iBACnFtM,OAAQ,UAAWZ,QAAS,MAAO1uC,MAAO,OAAQC,OAAQ,OAC1D+N,QAAS,OAAQ6E,WAAY,SAAUD,eAAgB,SACvD0c,gBAAiB,UAAWjlB,SAAU,OAAQsU,MAAO,UACvDzQ,SAAC,aAMJ83C,GAASC,KAAc7hB,EAAAA,EAAAA,UAAS,CAAC,GAAI,GAAI,GAAI,GAAI,KAKlD8hB,GAAYF,GAAQG,OAAO,CAACC,EAAKnmD,EAAQxB,KAC3C,MAAMsB,EAAc,IAAVtB,EALA,GAKsB2nD,EAAI3nD,EAAQ,GAAGsB,EAAIimD,GAAQvnD,EAAQ,GAEnE,OADA2nD,EAAIjnD,KAAK,CAAEW,EALA,GAKWC,MACfqmD,GACR,IAEH,OACIt4C,EAAAA,GAAAA,MAAAwF,GAAAA,SAAA,CAAApF,SAAA,EAEIC,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,eACNuT,gBAAiBkG,GAAU,GAC3BjG,aAAc,IACdC,eAAe,EACfC,eAAiBvmC,GAAMqsC,GAAWp+B,IAC9B,MAAMw+B,EAAa,IAAIx+B,GAEvB,OADAw+B,EAAW,GAAKzsC,EACTysC,IACRn4C,UAEHJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ2E,cAAe,SAAU1E,IAAK,QAASC,SAAA,EAClEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,QAAS6D,SAAA,CAAC,cAAUC,EAAAA,GAAAA,KAAA,UAAAD,SAAS8pC,QACrDlqC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,QAAS6D,SAAA,CAAC,aAASC,EAAAA,GAAAA,KAAA,UAAAD,SAASk1C,QAEpDt1C,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SAAA,EAC1DC,EAAAA,GAAAA,KAAA,UAAQI,QAAS80C,EAAiBt1C,MAAO,IAAKqkC,GAAa9iB,gBAAiB,UAAW3Q,MAAO,OAAQ4J,YAAa,WAAYra,SAAC,SAChIC,EAAAA,GAAAA,KAAA,UAAQI,QAAS+0C,EAASv1C,MAAOqkC,GAAYlkC,SAAC,UAC9CJ,EAAAA,GAAAA,MAAA,SAAOC,MAAOqkC,GAAYlkC,SAAA,CAAC,SAAKC,EAAAA,GAAAA,KAAA,SAAO9I,KAAK,OAAO+yC,OAAO,aAAajJ,SAAUoU,EAASx1C,MAAO,CAAEC,QAAS,cAC5GG,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAM82C,GAAuBD,GAAqBr3C,MAAOq3C,EAAqB7F,GAAoBnN,GAAa3F,MAAM,aAAYv+B,SAAC,kBACnJC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMi1C,GAAa7H,GAAW5tC,MAAO4tC,EAAW4D,GAAoBnN,GAAYlkC,SAAC,OAClGC,EAAAA,GAAAA,KAAA,UAAQI,QAASk1C,EAAU11C,MAAO,IAAKqkC,GAAazzB,MAAO,OAAS8tB,MAAM,YAAWv+B,SAAC,oBAMlGC,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,gBACNuT,gBAAiBkG,GAAU,GAC3BjG,aAAc,IACdC,eAAe,EACfC,eAAiBvmC,GAAMqsC,GAAWp+B,IAC9B,MAAMw+B,EAAa,IAAIx+B,GAEvB,OADAw+B,EAAW,GAAKzsC,EACTysC,IACRn4C,UAEHJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ2E,cAAe,SAAU1E,IAAK,QAASC,SAAA,EAClEJ,EAAAA,GAAAA,MAAA,OAAAI,SAAA,EACIC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQE,WAAY,OAAQyD,QAAS,QAAS2kC,aAAc,OAAQzkC,SAAC,WAC9FC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMm1C,EAAc,SAAU31C,MAAsB,UAAf8tC,EAAyB0D,GAAoBnN,GAAYlkC,SAAC,wBAChHC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMm1C,EAAc,UAAW31C,MAAsB,WAAf8tC,EAA0B0D,GAAoBnN,GAAYlkC,SAAC,kBAClHC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMm1C,EAAc,QAAS31C,MAAsB,SAAf8tC,EAAwB0D,GAAoBnN,GAAYlkC,SAAC,WAE7F,UAAf2tC,IACE/tC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,OAAQhlC,SAAA,EAC7BC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQ+0C,YAAa,OAAQlxC,SAAC,UACtD,CAAC,EAAG,EAAG,EAAG,EAAG,GAAGhS,IAAIokB,IACjBnS,EAAAA,GAAAA,KAAA,UAAmBI,QAASA,IAAMo1C,EAAarjC,GAC3CvS,MAAO,IAAM4sC,IAAcr6B,EAAOi/B,GAAoBnN,GAAc1D,QAAS,QAAS2Q,SAAU,QAASnxC,SACxGoS,GAFQA,QAQzBnS,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEmlC,UAAW,OAAQxE,QAAS,MAAOpf,gBAAiC,SAAhBssB,EAAyB,UAA6B,WAAhBA,EAA2B,UAAY,UAAY1xC,aAAc,MAAOT,OAAQ,kBAAmByE,UACvMJ,EAAAA,GAAAA,MAAA,QAAMC,MAAO,CAAE1D,SAAU,QAAS6D,SAAA,CAAC,YAAQC,EAAAA,GAAAA,KAAA,UAAAD,SAAyB,SAAhB0tC,EAAyB,0BAAmC,WAAhBA,EAA2B,uBAAe,8BAG9H,SAAfC,IACG/tC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,QAAShlC,SAAA,EAC9BC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQ2D,QAAS,QAAS2kC,aAAc,OAAQzkC,SAAC,qBAC1EC,EAAAA,GAAAA,KAAA,UACII,QAASA,IAAMw1C,EAAiB,OAChCh2C,MAAyB,QAAlB+1C,EAA0BvE,GAAoBnN,GACrD3F,MAAM,aAAYv+B,SACrB,sBAGDC,EAAAA,GAAAA,KAAA,UACII,QAASA,IAAMw1C,EAAiB,QAChCh2C,MAAyB,SAAlB+1C,EAA2BvE,GAAoBnN,GACtD3F,MAAM,mBAAkBv+B,SAC3B,yBAMO,SAAf2tC,GAAyBG,IACtBluC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,OAAQxE,QAAS,MAAOpf,gBAAiB,UAAWplB,aAAc,MAAOT,OAAQ,qBAAsByE,SAAA,EAC5HC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQ2D,QAAS,QAAS2kC,aAAc,MAAOpoC,WAAY,QAAS2D,SAAC,sBAC9FJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,OAAQsoC,aAAc,OAAQzkC,SAAA,CAAC,wCACpBC,EAAAA,GAAAA,KAAA,SAAK,iBAC5BA,EAAAA,GAAAA,KAAA,UAAAD,SAAQ,UAAc,eAAWC,EAAAA,GAAAA,KAAA,SAAK,iBACtCA,EAAAA,GAAAA,KAAA,UAAAD,SAAQ,QAAY,iBAEhCJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,OAAQhlC,SAAA,EAC7BC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMq1C,EAAc,GAAI,GAAI71C,MAAOqkC,GAAYlkC,SAAC,YACjEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,gBAAiBE,SAAA,EACpCC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMq1C,GAAe,EAAG,GAAI71C,MAAOqkC,GAAYlkC,SAAC,YACjEC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMq1C,EAAc,EAAG,GAAI71C,MAAOqkC,GAAYlkC,SAAC,eAEpEC,EAAAA,GAAAA,KAAA,UAAQI,QAASA,IAAMq1C,EAAc,EAAG,GAAI71C,MAAOqkC,GAAYlkC,SAAC,eAEpEJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,OAAQhlC,SAAA,EAC7BC,EAAAA,GAAAA,KAAA,UAAQI,QAASy1C,EAAiBj2C,MAAO,IAAKqkC,GAAa9iB,gBAAiB,UAAW3Q,MAAO,QAASzQ,SAAC,oBACxGC,EAAAA,GAAAA,KAAA,UAAQI,QAAS01C,EAAiBl2C,MAAO,IAAKqkC,GAAa9iB,gBAAiB,UAAW3Q,MAAO,QAASzQ,SAAC,4BAMxHJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEs/B,UAAW,iBAAkBkZ,WAAY,QAASr4C,SAAA,EAC5DC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQE,WAAY,OAAQyD,QAAS,QAAS2kC,aAAc,OAAQzkC,SAAC,aAC9FJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SAAA,EAC1DC,EAAAA,GAAAA,KAAC03C,EAAW,KACZ13C,EAAAA,GAAAA,KAAC23C,GAAY,KACb33C,EAAAA,GAAAA,KAAC43C,GAAY,gBAO7B53C,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,8BACNuT,gBAAiBkG,GAAU,GAC3BjG,aAAc,IACdC,eAAe,EACfC,eAAiBvmC,GAAMqsC,GAAWp+B,IAC9B,MAAMw+B,EAAa,IAAIx+B,GAEvB,OADAw+B,EAAW,GAAKzsC,EACTysC,IACRn4C,UAEHJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ2E,cAAe,SAAU1E,IAAK,OAAQC,SAAA,EACjEC,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,sBAAsByT,eAAe,EAAKhyC,UAC5DC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDi2C,EAAOjoD,IAAI8f,GAAKspC,EAAkBtpC,EAAG,OAAQ,cAItD7N,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,mBAAmByT,eAAe,EAAKhyC,UACzDC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDkc,EAAQluB,IAAIsqD,GAAMlB,EAAkBkB,EAAI,OAAQ,cAIzDr4C,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,qBAAoBv+B,UACtCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDk2C,EAASloD,IAAIO,GAAK6oD,EAAkB7oD,EAAG,MAAO,gBAIvD0R,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,kBAAiBv+B,UACnCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDwE,EAAMxW,IAAI0a,GAAK0uC,EAAkB1uC,EAAG,QAAS,gBAItDzI,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,0BAAyBv+B,UAC3CC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDm2C,EAAcnoD,IAAI0a,GAAK0uC,EAAkB1uC,EAAG,SAAU,gBAI/DzI,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,oBAAmBv+B,UACrCC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDo2C,EAAQpoD,IAAI0d,GAAK0rC,EAAkB1rC,EAAG,SAAU,gBAIzDzL,EAAAA,GAAAA,KAACmzC,GAAc,CAAC7U,MAAM,UAASv+B,UAC3BC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAEC,QAAS,OAAQs4C,SAAU,OAAQr4C,IAAK,OAAQC,SACzDq2C,GAAWA,EAAQroD,IAAIgkB,GAAKolC,EAAkBplC,EAAG,SAAU,qBAO5E/R,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,qBACNuT,gBAAiBkG,GAAU,GAC3BjG,aAAc,IACdC,eAAe,EACfC,eAAiBvmC,GAAMqsC,GAAWp+B,IAC9B,MAAMw+B,EAAa,IAAIx+B,GAEvB,OADAw+B,EAAW,GAAKzsC,EACTysC,IACRn4C,UAEHJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ2E,cAAe,SAAU1E,IAAK,QAASC,SAAA,EAClEJ,EAAAA,GAAAA,MAAA,OAAAI,SAAA,EACIC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQE,WAAY,OAAQyD,QAAS,QAAS2kC,aAAc,OAAQzkC,SAAC,sBAC9FJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEC,QAAS,OAAQ8uC,oBAAqB,iBAAkB7uC,IAAK,OAAQC,SAAA,EAC/EJ,EAAAA,GAAAA,MAAA,OAAKS,QAASA,IAAMk2C,EAA2B,MAC3C12C,MAAO,CACHtE,OAAQiyC,EAA0B,iBAAmB,oBACrDxxC,aAAc,MAAOwkC,QAAS,MAAOY,OAAQ,UAAWnmC,WAAY,QAExEsjC,MAAM,cAAav+B,SAAA,EACnBC,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE/N,MAAO,OAAQC,OAAQ,OAAQkJ,WAAYsyC,EAAyBztC,QAAS,QAAS9D,aAAc,UAClHiE,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE1D,SAAU,OAAQ0oC,UAAW,SAAUwT,WAAY,OAAQr4C,SAAC,mBAE7Es2C,EAAkBtoD,IAAKm4B,IACpBvmB,EAAAA,GAAAA,MAAA,OAAmBS,QAASA,IAAMk2C,EAA2BpwB,EAAG/B,UAC5DvkB,MAAO,CACHtE,OAAQiyC,IAA4BrnB,EAAG/B,SAAW,oBAAsB,iBACxEpoB,aAAc,MAAOwkC,QAAS,MAAOY,OAAQ,UAAWnmC,WAAY,QAExEsjC,MAAOpY,EAAGr2B,KAAKkQ,SAAA,EACfC,EAAAA,GAAAA,KAAA,OAAK+lC,IAAK7f,EAAG6f,IAAK+G,IAAK5mB,EAAGr2B,KAAM+P,MAAO,CAAE/N,MAAO,OAAQC,OAAQ,OAAQg/C,UAAW,QAASjxC,QAAS,YACrGG,EAAAA,GAAAA,KAAA,OAAKJ,MAAO,CAAE1D,SAAU,OAAQ0oC,UAAW,SAAUwT,WAAY,OAAQr4C,SAAEmmB,EAAGr2B,SAPxEq2B,EAAGr2B,WAWrB8P,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,MAAOllC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,OAAQC,SAAA,EAChFC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,QAAS6D,SAAC,gBACpCC,EAAAA,GAAAA,KAAA,SAAO9I,KAAK,QAAQ1D,IAAI,IAAID,IAAI,IAAIkxC,KAAK,OAAOntC,MAAOtC,EACnDgsC,SAAW1yC,GAAMkoD,EAA4B7R,WAAWr2C,EAAE6Z,OAAO7Q,WACrE0I,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,QAAS6D,SAAE/K,EAAyB6vC,QAAQ,SAEzEllC,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEmlC,UAAW,MAAOllC,QAAS,OAAQ6E,WAAY,SAAU5E,IAAK,OAAQC,SAAA,EAChFC,EAAAA,GAAAA,KAAA,SAAOJ,MAAO,CAAE1D,SAAU,QAAS6D,SAAC,uBACpCC,EAAAA,GAAAA,KAAA,SAAO9I,KAAK,QAAQI,MAAOg2C,EACvBtM,SAAW1yC,GAAMioD,EAA2BjoD,EAAE6Z,OAAO7Q,gBAIjEqI,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAEs/B,UAAW,iBAAkBkZ,WAAY,QAASr4C,SAAA,EAC5DC,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAE1D,SAAU,OAAQE,WAAY,OAAQyD,QAAS,QAAS2kC,aAAc,OAAQzkC,SAAC,sBAC9FJ,EAAAA,GAAAA,MAAA,UACIrI,MAAOo/C,GAA2B,GAClC1V,SAAW1yC,GAAMqoD,EAA2BroD,EAAE6Z,OAAO7Q,OAAS,MAC9DsI,MAAO,CAAE/N,MAAO,OAAQ0uC,QAAS,MAAOrkC,SAAU,OAAQsoC,aAAc,OAAQzkC,SAAA,EAChFC,EAAAA,GAAAA,KAAA,UAAQ1I,MAAM,GAAEyI,SAAC,uBAChB02C,EAAa1oD,IAAI4X,IACd3F,EAAAA,GAAAA,KAAA,UAAqB1I,MAAOqO,EAAEwe,SAASpkB,SAAE4F,EAAE9V,MAA9B8V,EAAE9V,WAGvBmQ,EAAAA,GAAAA,KAAC0lC,GAAqB,CAACvhB,SAAUuyB,EAAyB/hD,SAAS,EAAMwC,OAAQ,MACjFwI,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,OAAQsU,MAAO,OAAQu0B,UAAW,OAAQhlC,SAAA,CAAC,aACpD22C,EAA0BA,EAAwBtyB,MAAM,KAAKxb,MAAQ,mBAOhG5I,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,aACNuT,gBAAiBkG,GAAU,GAC3BjG,aAAc,IACdC,eAAe,EACfC,eAAiBvmC,GAAMqsC,GAAWp+B,IAC9B,MAAMw+B,EAAa,IAAIx+B,GAEvB,OADAw+B,EAAW,GAAKzsC,EACTysC,IACRn4C,UAEHJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE1D,SAAU,QAAS6D,SAAA,EAC7BJ,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE4kC,aAAc,OAAQzkC,SAAA,CAAC,UAAMC,EAAAA,GAAAA,KAAA,UAAAD,SAAS62C,IAAoB,aACxEj3C,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE4kC,aAAc,MAAOh0B,MAAO,QAASzQ,SAAA,CAAC,gCAAkBC,EAAAA,GAAAA,KAAA,UAAAD,SAAS82C,QAC/El3C,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE4kC,aAAc,MAAOh0B,MAAO,QAASzQ,SAAA,CAAC,yBAAgBC,EAAAA,GAAAA,KAAA,UAAAD,SAAS+2C,QAC7En3C,EAAAA,GAAAA,MAAA,OAAKC,MAAO,CAAE4kC,aAAc,MAAOh0B,MAAO,OAAQzQ,SAAA,CAAC,gCAAkBC,EAAAA,GAAAA,KAAA,UAAAD,SAASg3C,aAKtF/2C,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,UACNuT,gBAAiB,CAAElgD,EAAG2G,OAAO2qC,WAAa,IAAKrxC,EAAG,IAClDkgD,aAAc,IACdC,eAAe,EAAMhyC,UAErBC,EAAAA,GAAAA,KAACqzC,GAAO,CACJhkD,SAAUA,EACVC,UAAWA,EACXN,YAAaA,EACbC,cAAeA,EACfyjB,cAAeA,MAKtBukC,IACGj3C,EAAAA,GAAAA,KAAC4xC,GAAe,CACZtT,MAAM,aACNuT,gBAAiB,CAAElgD,EAAG2G,OAAO2qC,WAAa,IAAKrxC,EAAG,KAClDkgD,aAAc,IACdC,eAAe,EAAKhyC,UAEpBC,EAAAA,GAAAA,KAACm0C,GAAU,CACP9kD,SAAUA,EACVC,UAAWA,EACXq0C,SAAUqT,UC5brBsB,GAASA,KAElB,MAAOjpD,EAAUkpD,IAAetiB,EAAAA,EAAAA,UAAS,KAClC3mC,EAAWkpD,IAAgBviB,EAAAA,EAAAA,UAAS,KACpCjnC,EAAaypD,IAAkBxiB,EAAAA,EAAAA,UAAS,KACxChnC,EAAeypD,IAAoBziB,EAAAA,EAAAA,UAAS,KAC5C/mC,EAAeypD,IAAoB1iB,EAAAA,EAAAA,UAAS,KAC5CsW,EAAcqM,IAAmB3iB,EAAAA,EAAAA,UAAS,OAC1CuX,EAAU6H,IAAepf,EAAAA,EAAAA,WAAS,IAElC+X,EAAYK,IAAiBpY,EAAAA,EAAAA,WAAS,IACtCuW,EAAWgJ,IAAgBvf,EAAAA,EAAAA,UAAS,IACpCyX,EAAY6H,IAAiBtf,EAAAA,EAAAA,UAAS,UAEtC4X,EAAW6H,IAAgBzf,EAAAA,EAAAA,UAAS,OACpC0X,EAAYkL,IAAiB5iB,EAAAA,EAAAA,UAAS,OACtCwX,EAAaqL,IAAkB7iB,EAAAA,EAAAA,UAAS,SACxC8X,EAAWgL,IAAgB9iB,EAAAA,EAAAA,UAAS,OACpC2X,EAAsBoL,IAA2B/iB,EAAAA,EAAAA,UAAS,IAAI/c,MAC9Dy8B,EAAeC,IAAoB3f,EAAAA,EAAAA,UAAS,QAC5CgjB,EAAmBC,IAAwBjjB,EAAAA,EAAAA,WAAS,IACpD6X,EAAiBqL,IAAsBljB,EAAAA,EAAAA,UAAS,OAChDmjB,EAAiBC,IAAsBpjB,EAAAA,EAAAA,UAAS,MACjDqjB,GAAiBj4B,EAAAA,EAAAA,QAAO,MACxBk4B,GAAWl4B,EAAAA,EAAAA,QAAO,CAAEhyB,WAAUC,YAAWN,cAAaC,gBAAeC,mBAGpE26C,EAAS2P,IAAcvjB,EAAAA,EAAAA,UAAS,YAChCgf,EAAawE,IAAkBxjB,EAAAA,EAAAA,UAAS,cACxCyjB,EAAWC,IAAgB1jB,EAAAA,EAAAA,UAAS,OACpC2jB,EAAmBC,IAAwB5jB,EAAAA,EAAAA,WAAS,IACpDsb,EAAaC,IAAkBvb,EAAAA,EAAAA,UAAS,KACxCwb,EAAiBC,IAAsBzb,EAAAA,EAAAA,UAAS,KAEvD3xB,EAAAA,EAAAA,WAAU,KACNi1C,EAASr+B,QAAU,CAAE7rB,WAAUC,YAAWN,cAAaC,gBAAeC,kBACvE,CAACG,EAAUC,EAAWN,EAAaC,EAAeC,KAErDoV,EAAAA,EAAAA,WAAU,KAENm0C,EAAev1C,MADF,KACcqmC,KAAK,OAChCmP,EAAiBx1C,MAFJ,KAEgBqmC,KAAK,OAClCoP,EAAiBz1C,MAHJ,KAGgBqmC,KAAK,QACnC,KAGHjlC,EAAAA,EAAAA,WAAU,KACN,MAAM8wB,EAAiB9mC,IACfu/C,IACc,UAAVv/C,EAAE+I,KACF/I,EAAE25B,iBACF4tB,MACiB,WAAVvnD,EAAE+I,MACT/I,EAAE25B,iBACF6tB,QAMZ,OADAx9C,OAAO0vB,iBAAiB,UAAWoN,GAC5B,IAAM98B,OAAO09B,oBAAoB,UAAWZ,IACpD,CAACyY,EAAWC,EAAiBsL,EAAiBzD,IAEjD,MAAMjjC,GAAgBtO,MAAiB,GACjC4xC,GAAStjC,GAAcxe,OAAO2O,GAAQA,EAAKhT,MAAQgT,EAAKhT,KAAKsS,WAAW,aAAeU,EAAKiQ,OAASjQ,EAAKiQ,MAAMoE,SAChH+E,GAAUvJ,GAAcxe,OAAO2O,GAAQA,EAAKiQ,OAASjQ,EAAKiQ,MAAMoE,QAChE++B,GAAWvjC,GAAcxe,OAAO2O,MAC7BA,EAAKhT,OAASgT,EAAKhT,KAAKsS,WAAW,iBACpCU,EAAKgB,oBACDhB,EAAK3L,MAAsB,YAAd2L,EAAK3L,QAExBqN,GAAQmO,GAAcxe,OAAO2O,GAAQA,EAAKhT,MAAQgT,EAAKhT,KAAKsS,WAAW,UACvE+zC,GAAgBxjC,GAAcxe,OAAO2O,GAAQA,EAAKhT,MAAQgT,EAAKhT,KAAKsS,WAAW,kBAC/Eg0C,GAAUzjC,GAAcxe,OAAO2O,GAAsB,WAAdA,EAAK3L,MAC5Ck/C,GAAU1jC,GAAcxe,OAAO2O,GAAsB,WAAdA,EAAK3L,MAE5Cm/C,GCtF2ByD,MACjC,MAAM51B,EAAYxiB,EAAAA,MAClB,OAAOwiB,EAAUz1B,OAAOV,IAAKsJ,IACzB,MAAMsL,EAAMuhB,EAAU7sB,GAChBqO,EAAM/C,EAAIN,SAAWM,EACrB9S,EAAOwH,EAAI4K,QAAQ,KAAM,IAC/B,MAAO,CAAE5K,MAAKxH,OAAMk2C,IAAKrgC,EAAKye,SAAU,sBAAsBt0B,QDgFxCiqD,GACpBrD,GC7EsBsD,MAC5B,MAAMlU,EAAenkC,EAAAA,MACrB,OAAOmkC,EAAap3C,OAAOV,IAAKsJ,IAC5B,MAAMsL,EAAMkjC,EAAaxuC,GACnBxH,EAAOwH,EAAI4K,QAAQ,KAAM,IAC/B,MAAO,CAAE5K,MAAKxH,OAAMk2C,IAAMpjC,EAAIN,SAAWM,EAAMwhB,SAAU,4BAA4Bt0B,QDwEpEkqD,IAEdxM,GAAyB+I,KAA8BrgB,EAAAA,EAAAA,UAASogB,GAAkB,IAAIlyB,UAAY,OAClGnvB,GAA0BwhD,KAA+BvgB,EAAAA,EAAAA,UAAS,KAClEqX,GAAyBiJ,KAA8BtgB,EAAAA,EAAAA,UAAS,YAChEygB,GAAyBC,KAA8B1gB,EAAAA,EAAAA,UAAS,MAEjE+jB,GAAmB3D,GAAkB5yC,KAAMyiB,GAAOA,EAAG/B,WAAaopB,KAA4B8I,GAAkB,GAChHhJ,GAAwB2M,IAAoBzM,GAA0ByM,GAAiBjU,IAAM,KA6B7F0G,GAAiBA,IACC,SAAhBgB,EAA+Bz+C,EACf,WAAhBy+C,EAAiCx+C,EACjB,WAAhBw+C,EAAiCv+C,EAC9BF,EAEL09C,GAAkBC,IACA,SAAhBc,EAAwBgL,EAAe9L,GAClB,WAAhBc,EAA0BiL,EAAiB/L,GAC3B,WAAhBc,GAA0BkL,EAAiBhM,IA+HlDkJ,GAAkBA,KACpB,IAAKhI,IAAcC,IAAoBsL,EAAiB,OAExD,MAAMa,EAAa,IAAIb,EAAgBc,SACjCC,EAAe,IAAIf,EAAgBgB,WACnCC,EAAe,IAAIjB,EAAgBkB,WAGzC,GAAsB,QAAlB3E,EACA,IAAK,IAAI3gC,EAAK,EAAGA,EAAK64B,EAAUpiC,EAAGuJ,IAC/B,IAAK,IAAID,EAAK,EAAGA,EAAK84B,EAAUriC,EAAGuJ,IAAM,CACrC,MAAMjkB,GAAO+8C,EAAU6B,UAAY16B,GAAM3lB,GAAYw+C,EAAU4B,UAAY16B,GACvEjkB,GAAO,GAAKA,EAAMmpD,EAAWt2C,SAC7Bs2C,EAAWnpD,GAAO,KAClBqpD,EAAarpD,GAAO,KACpBupD,EAAavpD,GAAO,KAE5B,CAKR,IAAK,IAAIkkB,EAAK,EAAGA,EAAK64B,EAAUpiC,EAAGuJ,IAC/B,IAAK,IAAID,EAAK,EAAGA,EAAK84B,EAAUriC,EAAGuJ,IAAM,CACrC,MAAMwlC,EAAQzM,EAAgBn8C,EAAIojB,EAC5BylC,EAAQ1M,EAAgBl8C,EAAIojB,EAClC,GAAIulC,GAAS,GAAKA,EAAQlrD,GAAYmrD,GAAS,GAAKA,EAAQlrD,EAAW,CACnE,MAAMmrD,EAAUD,EAAQnrD,EAAWkrD,EAC7BG,EAAa1lC,EAAK64B,EAAUriC,EAAIuJ,EAEtCklC,EAAWQ,GAAW5M,EAAU/f,SAAS4sB,GACzCP,EAAaM,GAAW5M,EAAUne,WAAWgrB,GAC7CL,EAAaI,GAAW5M,EAAUlb,aAAa+nB,IAAe,IAClE,CACJ,CAGJjC,EAAewB,GACfvB,EAAiByB,GACjBxB,EAAiB0B,GACjB3E,EAAa,MACbyD,EAAmB,MACnBE,EAAmB,OAGjBvD,GAAkBA,KACpBJ,EAAa,MACbyD,EAAmB,MACnBE,EAAmB,MACnBH,GAAqB,IAyBnBtC,GAAavnD,EAAWC,EACxBunD,GAAe7nD,EAAYkF,OAAOkL,GAAW,OAANA,GAAYuE,OACnDmzC,GAAcF,GAAaC,GAC3BE,GAAe9nD,EAAciF,OAAO7F,GAAW,OAANA,GAAYsV,OAE3D,OACIhE,EAAAA,GAAAA,MAAA,OAAKO,UAAU,iBAAiBN,MAAO,CAAEo/B,SAAU,WAAYltC,OAAQ,OAAQ6S,SAAU,UAAW5E,SAAA,EAChGC,EAAAA,GAAAA,KAACqxC,GAAW,CACRC,OAAQsI,EACRrI,YAAaA,EACbC,eAAgBA,EAChBC,gBAAiBA,EACjBC,mBAAoBA,EACpBC,cApPUA,KAClB,GAAIr5C,OAAOqiD,QAAQ,4EAA6E,CAC5F,MAAMxoC,EAAO,IACbomC,EAAY,IACZC,EAAa,IACbC,EAAev1C,MAAMiP,GAAMo3B,KAAK,OAChCmP,EAAiBx1C,MAAMiP,GAAMo3B,KAAK,OAClCoP,EAAiBz1C,MAAMiP,GAAMo3B,KAAK,OAElCiQ,EAAWjI,GAAe,WAC1BkI,EAAehI,GAAmB,aAClCkI,EAAa,MACbrD,GAA2BD,GAAkB,IAAIlyB,UAAY,MAC7DqyB,GAA4B,IAC5BD,GAA2B,WAC3BI,GAA2B,MAE3BkD,GAAqB,EACzB,GAmOQ9Z,QAASA,IAAM8Z,GAAqB,MAGxCl6C,EAAAA,GAAAA,MAAA,OAAKO,UAAU,mBAAmBN,MAAO,CACrCC,QAAS,OAAQ/N,OAAQ,OAAQ0S,cAAe,MAChDtQ,OAAQ0lD,EAAoB,4BAA8B,OAC1Dxa,WAAY,mBACZsP,cAAekL,EAAoB,OAAS,QAC9C75C,SAAA,EACEC,EAAAA,GAAAA,KAACg1C,GAAc,CACXnL,QAASA,EACToL,YAAaA,EACbC,gBAvQQA,KACpB1D,EAAe,WACfE,EAAmBuD,GACnB4E,GAAqB,IAqQT1E,QAASA,IEtWNzvB,QACnBr2B,WACAC,YACAN,cACAC,gBACAC,gBACA26C,UACAoL,cACAyE,YACAnM,0BACAD,0BACAt4C,2BACA0hD,0BACAhkC,gBACAinC,mBAEA,MAAMiB,GAAc,IAAIliD,MAAOG,cAYzB3I,EAAU,CACZmhC,KAAM,CACFx/B,MAAOxC,EACPyC,OAAQxC,EACRkX,SAAU,GACVq0C,QAAS,MACThrD,KAAMg6C,EACNG,OAAQiL,EACR6F,oBAnBYpB,GAAakB,EAoBzBG,sBAAuBH,EACvB15B,gBAAiBqsB,GAA2B,KAC5CpsB,gBAAiBosB,EAA0B,KAAOD,EAClDt4C,yBAA0BA,EAC1B81C,gBAAiB4L,GAA2B,MAEhDsE,WAAY,CACRC,YAAa5rD,EAAWC,EACxB4rD,aAzBalsD,EAAYkF,OAAOkL,GAAW,OAANA,GAAYuE,OA0BjDw3C,cAzBalsD,EAAciF,OAAO7F,GAAW,OAANA,GAAYsV,OA0BnDy3C,YAzBWnsD,EAAciF,OAAO7F,IACpC,IAAKA,EAAG,OAAO,EACf,MAAMwU,EAAO6P,EAAcjP,KAAKC,GAAKA,EAAExV,KAAOG,GAC9C,OAAOwU,GAAQA,EAAKhT,MAAQgT,EAAKhT,KAAKsS,WAAW,WAClDwB,QAuBC01B,OAAQ,CACJ,CAAEniC,KAAM,OAAQrH,KAAM,aAAc+S,KAAM5T,GAC1C,CAAEkI,KAAM,SAAUrH,KAAM,WAAY+S,KAAM3T,GAC1C,CAAEiI,KAAM,SAAUrH,KAAM,UAAW+S,KAAM1T,GAAiBgU,MAAM7T,EAAWC,GAAWi6C,KAAK,SAI7FmB,EAAW,GAAGb,EAAQ5nC,QAAQ,OAAQ,YACtCo5C,EAAO5kD,KAAKM,UAAU7G,EAAS,KAAM,GAE3C,UACwBorD,GAASD,EAAM3Q,EAAU,sBAEpCgP,GAAWC,EAAaiB,GAC7B7hB,GAAap+B,KAAK,yBAA0B,CACxCq+B,UAAW,SACX6Q,UACAa,WACAZ,WAAY,GAAGz6C,KAAYC,MAGvC,CAAE,MAAOE,GACLupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,SACXC,SAAU,UACV4Q,UACAa,aAEJX,MAAM,iDACV,GFwR+BoL,CAAQ,CACnB9lD,WAAUC,YAAWN,cAAaC,gBAAeC,gBACjD26C,UAASoL,cAAayE,YACtBnM,2BAAyBD,2BACzBt4C,4BAA0B0hD,2BAC1BhkC,iBAAeinC,iBAEnBvE,QAAUlL,GE5RPkL,GACnBlL,QACAqO,cACAC,eACAgB,aACAC,iBACAE,eACArD,6BACAC,6BACAC,8BACAG,6BACA8B,iBACAC,mBACAC,uBAEA,MAAMtO,EAAa,IAAIC,WACjBH,EAAOD,EAAM/hC,OAAOiiC,MAAM,GAC5BD,IACAE,EAAWE,WAAWJ,EAAM,SAC5BE,EAAWG,OAAUl8C,IACjB,IACI,MAAMm8C,EAASh0C,KAAKC,MAAMpI,EAAE6Z,OAAOgjB,QACnC,GAAIsf,EAAOpZ,KAAM,CAqBb,GApBAknB,EAAY9N,EAAOpZ,KAAKx/B,OACxB2mD,EAAa/N,EAAOpZ,KAAKv/B,QAErB24C,EAAOpZ,KAAKxhC,MAAM2pD,EAAW/O,EAAOpZ,KAAKxhC,MACzC46C,EAAOpZ,KAAK2Y,QAAQyP,EAAehP,EAAOpZ,KAAK2Y,QAC/CS,EAAOpZ,KAAKypB,qBAAqBnB,EAAalP,EAAOpZ,KAAKypB,qBAEnB,qBAAhCrQ,EAAOpZ,KAAKnQ,iBAAmCupB,EAAOpZ,KAAKnQ,gBAClEo1B,EAA2B7L,EAAOpZ,KAAKnQ,iBAEvCo1B,EAA2B,MAEY,qBAAhC7L,EAAOpZ,KAAKlQ,iBAAmCspB,EAAOpZ,KAAKlQ,iBAClEo1B,EAA2B9L,EAAOpZ,KAAKlQ,iBAES,qBAAzCspB,EAAOpZ,KAAKr8B,yBACnBwhD,EAA4B/L,EAAOpZ,KAAKr8B,0BAExCwhD,EAA4B,IAEW,qBAAhC/L,EAAOpZ,KAAKyZ,iBAAmCL,EAAOpZ,KAAKyZ,gBAAiB,CACnF,MAAMnlC,EAAI8kC,EAAOpZ,KAAKyZ,gBAChByQ,EAA0B,kBAAN51C,EAAiBA,EAAE1D,QAAQ,qBAAsB,6BAA+B0D,EAC1GgxC,EAA2B4E,EAC/B,MACI5E,EAA2B,MAG/B,MAAMrN,EAAUmB,EAAOpR,OAAO51B,KAAKg2B,GAAgB,eAAXA,EAAE5pC,MACpC2pC,EAAWiR,EAAOpR,OAAO51B,KAAKg2B,GAAgB,aAAXA,EAAE5pC,MACrC25C,EAAciB,EAAOpR,OAAO51B,KAAKg2B,GAAgB,YAAXA,EAAE5pC,MAC1Cy5C,GAASmP,EAAenP,EAAQ1mC,MAChC42B,GAAUkf,EAAiBlf,EAAS52B,MAEpC+1C,EADAnP,EACiBA,EAAY5mC,KAEZM,MAAMunC,EAAOpZ,KAAKx/B,MAAQ44C,EAAOpZ,KAAKv/B,QAAQy3C,KAAK,OAGxExQ,GAAap+B,KAAK,0BAA2B,CACzCq+B,UAAW,SACX6Q,QAASY,EAAOpZ,KAAKxhC,KACrBi6C,WAAY,GAAGW,EAAOpZ,KAAKx/B,SAAS44C,EAAOpZ,KAAKv/B,UAExD,MAEQ24C,EAAO54C,OAAO0mD,EAAY9N,EAAO54C,OACjC44C,EAAO34C,QAAQ0mD,EAAa/N,EAAO34C,QACnC24C,EAAOtuB,OAAOs8B,EAAehO,EAAOtuB,OACxCu8B,EAAiBx1C,MAAMunC,EAAO54C,MAAQ44C,EAAO34C,QAAQy3C,KAAK,OAE1DxQ,GAAal3B,KAAK,8BAA+B,CAC7Cm3B,UAAW,SACX0R,SAAUP,EAAKt6C,MAG3B,CAAE,MAAOL,GACLupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,SACXC,SAAU,UACVyR,SAAUP,EAAKt6C,OAEnBk6C,MAAM,gDACV,GAEJM,EAAWM,QAAWn7C,IAClBupC,GAAavpC,MAAMA,EAAO,CACtBwpC,UAAW,SACXC,SAAU,UACVyR,SAAUP,EAAKt6C,KACf0a,MAAO,eAEXw/B,MAAM,0BF6LsBqL,CAAQ,CACxBlL,QAAOqO,cAAaC,eAAcgB,aAAYC,iBAC9CE,eAAcrD,8BAA4BC,8BAC1CC,+BAA6BG,8BAC7B8B,iBAAgBC,mBAAkBC,qBAEtCnL,SAAUA,EACV6H,YAAaA,EACbC,SAAUA,IEhMNA,GAAGjmD,WAAUC,YAAWmpD,iBAAgBC,mBAAkBC,uBAC9E,GAAIrgD,OAAOqiD,QAAQ,2CAA4C,CAC3D,MAAMxoC,EAAO9iB,EAAWC,EACxBmpD,EAAev1C,MAAMiP,GAAMo3B,KAAK,OAChCmP,EAAiBx1C,MAAMiP,GAAMo3B,KAAK,OAClCoP,EAAiBz1C,MAAMiP,GAAMo3B,KAAK,MACtC,GF0LgC+L,CAAS,CAAEjmD,WAAUC,YAAWmpD,iBAAgBC,mBAAkBC,qBAClFjL,WAAYA,EACZ6H,cAAeA,EACf/I,UAAWA,EACXgJ,aAAcA,EACd/H,YAAaA,EACbI,UAAWA,EACX4H,cArIMA,CAAC7+B,EAAIF,KACvB,IAAKm3B,IAAcC,EAAiB,OAEpC,MAAMhb,EAAOgb,EAAgBn8C,EAAIilB,EAC3Bmc,EAAO+a,EAAgBl8C,EAAI8kB,EAGjCyiC,EAAmB,CAAExnD,EAAGmhC,EAAMlhC,EAAGmhC,KA+HrB2iB,aAAcA,EACdC,cAAeA,EACfC,iBAAkBA,EAClBC,gBAAiBA,GACjBC,gBAAiBA,GACjBvJ,aAAcA,EACdwJ,oBA/DYA,CAAClzC,EAAMkiB,KAC/B6zB,EAAgB/1C,GAChBi2C,EAAe/zB,GACfwwB,EAAc,SACdG,EAAa,OA4DDM,OAAQA,GACR/5B,QAASA,GACTg6B,SAAUA,GACV1xC,MAAOA,GACP2xC,cAAeA,GACfC,QAASA,GACTC,QAASA,GACTC,kBAAmBA,GACnB9I,wBAAyBA,GACzB+I,2BAA4BA,GAC5BhJ,wBAAyBA,GACzBiJ,2BAA4BA,GAC5BvhD,yBAA0BA,GAC1BwhD,4BAA6BA,GAC7BC,aAAcA,GACdC,wBAAyBA,GACzBC,2BAA4BA,GAC5BC,WAAYA,GACZC,aAAcA,GACdC,YAAaA,GACbC,aAAcA,GACd1nD,SAAUA,EACVC,UAAWA,EACXN,YAAaA,EACbC,cAAeA,EACfyjB,cAAeA,GACfskC,YAzGQwE,CAAC3G,EAAUC,KAC3BD,IAAaxlD,GAAYylD,IAAcxlD,GExHtBmsD,GAAG5G,WAAUC,YAAWyE,WAAUhB,cAAaC,eAAcC,iBAAgBC,mBAAkBC,uBACxH,MAAQtpD,SAAUqsD,EAAMpsD,UAAWqsD,EAAM3sD,YAAa4sD,EAAU3sD,cAAe4sD,EAAS3sD,cAAe4sD,GAAevC,EAASr+B,QAC/H,GAAI25B,EAAW,GAAKC,EAAY,EAAG,OACnC,GAAID,IAAa6G,GAAQ5G,IAAc6G,EAAM,OAE7C,MAAMI,EAAeC,IACjB,MAAMC,EAAS/4C,MAAM2xC,EAAWC,GAAWvL,KAAK,MAChD,IAAK,IAAI33C,EAAI,EAAGA,EAAI0B,KAAKE,IAAImoD,EAAM7G,GAAYljD,IAC3C,IAAK,IAAID,EAAI,EAAGA,EAAI2B,KAAKE,IAAIkoD,EAAM7G,GAAWljD,IAC1CsqD,EAAOrqD,EAAIijD,EAAWljD,GAAKqqD,EAAOpqD,EAAI8pD,EAAO/pD,GAGrD,OAAOsqD,GAGX1D,EAAY1D,GACZ2D,EAAa1D,GACb2D,EAAesD,EAAYH,IAC3BlD,EAAiBqD,EAAYF,IAC7BlD,EAAiBoD,EAAYD,GAAc,MFuGvCL,CAAc,CACV5G,WACAC,YACAyE,WACAhB,cACAC,eACAC,iBACAC,mBACAC,yBAiGI34C,EAAAA,GAAAA,KAACmnC,GAAQ,CACL93C,SAAUA,EACVC,UAAWA,EACX+9C,sBAAuBA,GACvBC,wBAAyBA,GACzBC,wBAAyBA,GACzBC,SAAUA,EACVC,YAAaA,EACbC,WAAYA,EACZ1+C,YAAaA,EACbC,cAAeA,EACfC,cAAeA,EACfwjB,cAAeA,GACfi7B,WAAYA,EACZnB,UAAWA,EACXoB,qBAAsBA,EACtBC,UAAWA,EACXC,gBAAiBA,EACjBC,UAAWA,EACXC,WAAYA,EACZC,oBAhTYA,CAAC39C,EAAOhC,KAIhC,GAHAA,EAAE25B,iBAGE4lB,GAAaC,EAAiB,CAC9B,MAAMn8C,EAAIrB,EAAQjB,EACZuC,EAAI0B,KAAKuT,MAAMvW,EAAQjB,GAG7B,GAAIsC,GAAKm8C,EAAgBn8C,GAAKA,EAAIm8C,EAAgBn8C,EAAIk8C,EAAUriC,GAC5D5Z,GAAKk8C,EAAgBl8C,GAAKA,EAAIk8C,EAAgBl8C,EAAIi8C,EAAUpiC,EAG5D,OAFAytC,GAAqB,QACrB7K,GAAc,EAGtB,CAEA,GAAmB,UAAfX,EACAW,GAAc,GACd/B,GAAUh8C,EAAOi8C,EAAcC,EAAWn9C,EAAUC,EAAWm9C,GAAgBC,SAE9E,GAAmB,WAAfgB,EAAyB,CVnIjBwO,EAAClxB,EAAYmxB,EAAU1P,EAAgBC,EAAgBr9C,EAAUC,KACtF,MAAM68C,EAAcM,IAEpB,GADgBN,EAAYnhB,KACZmxB,EAAU,OAE1B,MAAM9T,EAAU6D,GAAoBlhB,EAAYmhB,EAAa98C,EAAUC,GACjEq9C,EAAU,IAAIR,GACpB9D,EAAQx3C,QAAQC,GAAO67C,EAAQ77C,GAAOqrD,GACtCzP,EAAeC,IU6HPuP,CAAU5rD,EADOi8C,EAAeA,EAAar+C,GAAK,KACvBu+C,GAAgBC,GAAgBr9C,EAAUC,GACrE0pD,EAAwB,IAAI9/B,IAChC,MAAO,GAAmB,SAAfw0B,EAAuB,CAC9B,MAAM/7C,EAAIrB,EAAQjB,EACZuC,EAAI0B,KAAKuT,MAAMvW,EAAQjB,GAC7B0pD,EAAa,CAAEpnD,IAAGC,MAClB8jD,EAAa,MACbyD,EAAmB,MACnBE,EAAmB,MACnBhL,GAAc,EAClB,GAgRYH,qBA7Qc59C,IAI1B,GAHAuoD,EAAcvoD,GAGV2oD,GAAqBjL,GAAcF,EAAiB,CACpD,MAAMn8C,EAAIrB,EAAQjB,EACZuC,EAAI0B,KAAKuT,MAAMvW,EAAQjB,GAE7B,YADA8pD,EAAmB,CAAExnD,IAAGC,KAE5B,CAEI0nD,EAAep+B,UACfkhC,aAAa9C,EAAep+B,SAC5Bo+B,EAAep+B,QAAU,MAE7B89B,EAAwB,IAAI9/B,KACT,UAAfw0B,GAA0BM,EAC1B1B,GAAUh8C,EAAOi8C,EAAcC,EAAWn9C,EAAUC,EAAWm9C,GAAgBC,IAE3D,WAAfgB,GAA4BM,IACjCsL,EAAep+B,QAAU+kB,WAAW,KAChC,MAAMkM,EAAcM,KACdpE,EAAU6D,GAAoB57C,EAAO67C,EAAa98C,EAAUC,GAClE0pD,EAAwB,IAAI9/B,IAAImvB,KACjC,OAsPK8F,kBA5OW79C,IACvB,GAAI2oD,EAEAC,GAAqB,QAKzB,GADA7K,GAAc,GACK,SAAfX,GAAyBK,EAAW,CACpC,MAAMsO,EAAO/rD,EAAQjB,EACf8gB,EAAO7c,KAAKuT,MAAMvW,EAAQjB,GAC1BitD,EAAKhpD,KAAKE,IAAIu6C,EAAUp8C,EAAG0qD,GAC3BE,EAAKjpD,KAAKE,IAAIu6C,EAAUn8C,EAAGue,GAG3B3E,EAFKlY,KAAKC,IAAIw6C,EAAUp8C,EAAG0qD,GAElBC,EAAK,EACd7wC,EAFKnY,KAAKC,IAAIw6C,EAAUn8C,EAAGue,GAElBosC,EAAK,EAEdC,EAAc,GACdC,EAAgB,GAChBC,EAAgB,GAEtB,IAAK,IAAI1nC,EAAK,EAAGA,EAAKvJ,EAAGuJ,IACrB,IAAK,IAAID,EAAK,EAAGA,EAAKvJ,EAAGuJ,IAAM,CAC3B,MAAMjkB,GAAOyrD,EAAKvnC,GAAM3lB,GAAYitD,EAAKvnC,GACzCynC,EAAYxrD,KAAKhC,EAAY8B,IAC7B2rD,EAAczrD,KAAK/B,EAAc6B,IACjC4rD,EAAc1rD,KAAK9B,EAAc4B,GACrC,CAIJuoD,EAAmB,CACfa,QAAS,IAAIlrD,GACborD,UAAW,IAAInrD,GACfqrD,UAAW,IAAIprD,KAGnBwmD,EAAa,CAAE/jD,EAAG2qD,EAAI1qD,EAAG2qD,EAAI/wC,IAAGC,IAAGqiB,SAAU0uB,EAAa9sB,WAAY+sB,EAAe9pB,WAAY+pB,EAAejN,UAAW6M,EAAI5M,UAAW6M,IAC1IpD,EAAmB,CAAExnD,EAAG2qD,EAAI1qD,EAAG2qD,IAC/BxD,EAAa,KACjB,GAoMY3K,qBAnPaA,KACzByK,EAAc,MACVS,EAAep+B,SAASkhC,aAAa9C,EAAep+B,SACxD89B,EAAwB,IAAI9/B,MAiPhBm1B,cAAeA,WG1bpB,SAASsO,KAEpB,OACI38C,EAAAA,GAAAA,KAAAmF,GAAAA,SAAA,CAAApF,UACIC,EAAAA,GAAAA,KAAA,KAAAD,SAAG,cAGf,CCLe,SAAS68C,KACpB,MAAMlqC,EAAgBtO,KAWhBy4C,EAAY,CACdvhD,OAAQ,iBACRS,aAAc,MACdwkC,QAAS,OACT1uC,MAAO,QACPgO,QAAS,OACT2E,cAAe,SACfE,WAAY,SACZyc,gBAAiB,WAIf27B,EAAa,CACfjrD,MAAO,OACPC,OAAQ,OACRg/C,UAAW,UACXoD,eAAgB,YAChB1P,aAAc,OACdlpC,OAAQ,mBAGNyhD,EAAuB,CACzBlrD,MAAO,OACPqK,SAAU,OACV0oC,UAAW,QAGf,OACIjlC,EAAAA,GAAAA,MAAA,OAAKC,MApCc,CACnBC,QAAS,OACTs4C,SAAU,OACVr4C,IAAK,OACLygC,QAAS,QAgCkBxgC,SAAA,CACtB2S,EAAc3kB,IAAI,CAAC8U,EAAMvS,KACtBqP,EAAAA,GAAAA,MAAA,OAA4BC,MAAOi9C,EAAU98C,SAAA,CAGxC8C,EAAKI,UAAYJ,EAAKI,SAASU,OAAS,GACrC3D,EAAAA,GAAAA,KAAC6sC,GAAY,CACT5pC,SAAUJ,EAAKI,SACfF,QAASF,EAAKE,QACd0E,MAAO5E,EAAKe,eACZhE,MAAOk9C,EACPhQ,IAAKjqC,EAAKhT,QAGdmQ,EAAAA,GAAAA,KAAA,OACI+lC,IAAKljC,EAAKE,QACV+pC,IAAKjqC,EAAKhT,KACV+P,MAAOk9C,EACPE,QAAU1uD,IAAQA,EAAE6Z,OAAOvI,MAAMC,QAAU,WAKnDG,EAAAA,GAAAA,KAAA,OAAKJ,MAAOm9C,EAAqBh9C,SAC5BrR,OAAO6qB,QAAQ1W,GACX3O,OAAO,EAAEmD,MAAU,CAAC,UAAW,WAAY,kBAAkBtG,SAASsG,IACtEtJ,IAAI,EAAEsJ,EAAKC,MACRqI,EAAAA,GAAAA,MAAA,OAAeC,MAAO,CAAE4kC,aAAc,MAAOyY,UAAW,aAAcl9C,SAAA,EAClEJ,EAAAA,GAAAA,MAAA,UAAAI,SAAA,CAAS1I,EAAI,QACb2I,EAAAA,GAAAA,KAAA,QAAMJ,MAAO,CAAEskC,WAAY,MAAO1zB,MAAO,QAASzQ,SAC5B,kBAAVzI,EAAqBb,KAAKM,UAAUO,GAASw8B,OAAOx8B,OAH1DD,QAzBhBwL,EAAK3U,IAAMoC,IAoCC,IAAzBoiB,EAAc/O,SAAgB3D,EAAAA,GAAAA,KAAA,KAAAD,SAAG,kCAG9C,CCpEam9C,EAAAA,WAAoBlvC,SAASmvC,eAAe,SACpDC,QACDp9C,EAAAA,GAAAA,KAACq9C,EAAAA,GAAQ,CAACC,MAAOA,GAAMv9C,UACnBJ,EAAAA,GAAAA,MAAC49C,EAAAA,GAAa,CAACC,MAAOA,GAAMz9C,SAAA,EACxBC,EAAAA,GAAAA,KAACy9C,GAAY,KACbz9C,EAAAA,GAAAA,KAAC09C,EAAAA,GAAa,CAACC,SAAUvjD,mBAAuB2F,UAC5CC,EAAAA,GAAAA,KAAC49C,EAAAA,GAAM,CAAA79C,UAEPJ,EAAAA,GAAAA,MAACk+C,EAAAA,GAAK,CAACz6C,KAAK,IAAI06C,SAAS99C,EAAAA,GAAAA,KAAC+9C,GAAG,IAAIh+C,SAAA,EAC7BC,EAAAA,GAAAA,KAAC69C,EAAAA,GAAK,CAACvtD,OAAK,EAACwtD,SAAS99C,EAAAA,GAAAA,KAACkF,GAAI,OAC3BlF,EAAAA,GAAAA,KAAC69C,EAAAA,GAAK,CAACz6C,KAAK,OAAO06C,SAAS99C,EAAAA,GAAAA,KAAC0nC,GAAI,OACjC1nC,EAAAA,GAAAA,KAAC69C,EAAAA,GAAK,CAACz6C,KAAK,SAAS06C,SAAS99C,EAAAA,GAAAA,KAACs4C,GAAM,OACrCt4C,EAAAA,GAAAA,KAAC69C,EAAAA,GAAK,CAACz6C,KAAK,WAAW06C,SAAS99C,EAAAA,GAAAA,KAAC28C,GAAQ,OACzC38C,EAAAA,GAAAA,KAAC69C,EAAAA,GAAK,CAACz6C,KAAK,aAAa06C,SAAS99C,EAAAA,GAAAA,KAAC48C,GAAU,kB,4iMC9BjE,IAAI7uD,EAAM,CACT,oBAAqB,KACrB,oBAAqB,KACrB,oBAAqB,KACrB,oBAAqB,KACrB,oBAAqB,KACrB,oBAAqB,KAItB,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,EAC5B,CACA,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,CACP,CACA,OAAOP,EAAIE,EACZ,CACAD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,EACpB,EACAC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,I","sources":["webpack://element_masters/./src/assets/sound/background/ sync nonrecursive \\.ogg$","webpack://element_masters/./src/assets/images/ sync \\.(png%7Cjpe","webpack://element_masters/./src/assets/sound/ sync \\.(mp3%7Cwav%7Cogg%7Cm4a%7Caac%7Cflac%7Cwebm)$","webpack://element_masters/./src/assets/json/ sync \\.json$","webpack://element_masters/./src/store/slices/gameSlice.js","webpack://element_masters/./src/constants/gameConstants.js","webpack://element_masters/./src/store/slices/playerSlice.js","webpack://element_masters/./src/store/slices/settingsSlice.js","webpack://element_masters/./src/store/slices/uiSlice.js","webpack://element_masters/./src/store/index.js","webpack://element_masters/./src/styles/theme.js","webpack://element_masters/./src/styles/GlobalStyles.js","webpack://element_masters/./src/i18n/i18n.js","webpack://element_masters/./src/sections/section.header.navigation.chapters.js","webpack://element_masters/./src/sections/section.header.navigation.languages.js","webpack://element_masters/./src/sections/section.header.navigation.logo.js","webpack://element_masters/./src/sections/section.header.js","webpack://element_masters/./src/sections/section.footer.js","webpack://element_masters/./src/sections/section.content.js","webpack://element_masters/./src/engine/registry/index.js","webpack://element_masters/./src/App.js","webpack://element_masters/./src/sections/chapters/home.jsx","webpack://element_masters/./src/Pixi/TextureCache.js","webpack://element_masters/./src/Pixi/effects/weather/Rain.js","webpack://element_masters/./src/Pixi/effects/weather/Snow.js","webpack://element_masters/./src/Pixi/effects/weather/Clouds.js","webpack://element_masters/./src/Pixi/effects/weather/Fog.js","webpack://element_masters/./src/Pixi/effects/weather/Thunder.js","webpack://element_masters/./src/Pixi/effects/liquids/WaterSplashFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaEmbers.js","webpack://element_masters/./src/Pixi/effects/liquids/LavaSteamFX.js","webpack://element_masters/./src/Pixi/effects/liquids/LiquidRegionSystem.js","webpack://element_masters/./src/Pixi/ui/HealthBar.js","webpack://element_masters/./src/renderer/stage/layers/LayerOrder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/helpers.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/liquidRendering.js","webpack://element_masters/./src/Pixi/layers/ParallaxBackground.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/parallaxManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/playerManager.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/layerBuilder.js","webpack://element_masters/./src/sections/chapters/game/PixiStage/index.jsx","webpack://element_masters/./src/sections/chapters/game/PixiStage/projectileManager.js","webpack://element_masters/./src/engine/gameplay/secrets.js","webpack://element_masters/./src/engine/audio/audio.js","webpack://element_masters/./src/engine/liquids/liquidUtils.js","webpack://element_masters/./src/engine/loop/updateFrame.js","webpack://element_masters/./src/engine/physics/horizontal.js","webpack://element_masters/./src/engine/physics/vertical.js","webpack://element_masters/./src/engine/physics/collision.js","webpack://element_masters/./src/services/errorHandler.js","webpack://element_masters/./src/utilities/useGameEngine.js","webpack://element_masters/./src/utilities/useInput.js","webpack://element_masters/./src/engine/gameplay/hazards.js","webpack://element_masters/./src/engine/gameplay/spawnProjectile.js","webpack://element_masters/./src/engine/gameplay/collectItem.js","webpack://element_masters/./src/engine/gameplay/interactables.js","webpack://element_masters/./src/engine/gameplay/updateProjectiles.js","webpack://element_masters/./src/sections/chapters/game/GameHeader.jsx","webpack://element_masters/./src/commands/gameCommands.js","webpack://element_masters/./src/sections/chapters/game/GameTerminal.jsx","webpack://element_masters/./src/sections/chapters/game/GameSettings.jsx","webpack://element_masters/./src/utilities/BackgroundMusicPlayer.jsx","webpack://element_masters/./src/sections/chapters/game/index.jsx","webpack://element_masters/./src/utilities/saveFile.js","webpack://element_masters/./src/sections/chapters/editor/paintingTools.js","webpack://element_masters/./src/utilities/AnimatedItem.jsx","webpack://element_masters/./src/sections/chapters/editor/Viewport.jsx","webpack://element_masters/./src/sections/chapters/editor/constants.js","webpack://element_masters/./src/sections/chapters/editor/NewMapModal.jsx","webpack://element_masters/./src/sections/chapters/editor/DraggableWindow.jsx","webpack://element_masters/./src/sections/chapters/editor/PaletteSection.jsx","webpack://element_masters/./src/sections/chapters/editor/Minimap.jsx","webpack://element_masters/./src/sections/chapters/editor/MapResizer.jsx","webpack://element_masters/./src/sections/chapters/editor/ToolbarWindows.jsx","webpack://element_masters/./src/sections/chapters/editor/index.jsx","webpack://element_masters/./src/sections/chapters/editor/assetLoaders.js","webpack://element_masters/./src/sections/chapters/editor/mapOperations.js","webpack://element_masters/./src/sections/chapters/crystals.jsx","webpack://element_masters/./src/sections/chapters/repository.jsx","webpack://element_masters/./src/index.js","webpack://element_masters/./src/assets/background/ sync nonrecursive \\.(png%7Cjpe"],"sourcesContent":["var map = {\n\t\"./170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1032;","var map = {\n\t\"./blocks/diorite_block.png\": 8276,\n\t\"./blocks/dirt_block_0001.png\": 7157,\n\t\"./blocks/grass_block_0001.png\": 1764,\n\t\"./blocks/sand_block_0001.png\": 2250,\n\t\"./blocks/sand_block_0002.png\": 2145,\n\t\"./blocks/water_block.png\": 1635,\n\t\"./entities/player/player_dead_01.png\": 2735,\n\t\"./entities/player/player_dead_02.png\": 2820,\n\t\"./entities/player/player_dead_03.png\": 5325,\n\t\"./entities/player/player_dead_04.png\": 3762,\n\t\"./entities/player/player_dead_05.png\": 2763,\n\t\"./entities/player/player_dead_06.png\": 7728,\n\t\"./entities/player/player_dead_07.png\": 8905,\n\t\"./entities/player/player_dead_08.png\": 3662,\n\t\"./entities/player/player_dead_09.png\": 1351,\n\t\"./entities/player/player_dead_10.png\": 1297,\n\t\"./entities/player/player_default_100.A.png\": 6847,\n\t\"./entities/player/player_default_100.B.png\": 4388,\n\t\"./entities/player/player_target_100.A.png\": 2155,\n\t\"./entities/player/player_target_100.B.png\": 8336,\n\t\"./hazards/bushes_001.png\": 6343,\n\t\"./interactables/berry_bush_01_A.png\": 2534,\n\t\"./interactables/berry_bush_01_B.png\": 4157,\n\t\"./interactables/berry_bush_02_A.png\": 3945,\n\t\"./interactables/berry_bush_02_B.png\": 7858,\n\t\"./items/fireball_basic_A.png\": 9240,\n\t\"./items/fireball_basic_B.png\": 4851,\n\t\"./items/fireball_basic_C.png\": 9290,\n\t\"./items/fireball_basic_D.png\": 9717,\n\t\"./items/hertz_item.A.png\": 7720,\n\t\"./items/hertz_item.B.png\": 3475,\n\t\"./projectiles/fireball_basic_A.png\": 9792,\n\t\"./projectiles/fireball_basic_B.png\": 1083,\n\t\"./projectiles/fireball_basic_C.png\": 9954,\n\t\"./projectiles/fireball_basic_D.png\": 4205\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1621;","var map = {\n\t\"./background/170515__rolandasb__forest_ambient_01_loop.ogg\": 344,\n\t\"./background/830253__nicktayloe__afternoon-woods-in-october-midwest-us-loop.ogg\": 3004,\n\t\"./sfx/zzox-fx_nite-hit-item.ogg\": 9750,\n\t\"./sfx/zzox-fx_sling-selector.ogg\": 7973\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6431;","var map = {\n\t\"./blocks/diorite_block.json\": 3929,\n\t\"./blocks/dirt_block_0001.json\": 3462,\n\t\"./blocks/grass_block_0001.json\": 7865,\n\t\"./blocks/lava_block.json\": 2619,\n\t\"./blocks/sand_block_0001.json\": 7323,\n\t\"./blocks/sand_block_0002.json\": 7210,\n\t\"./blocks/water_block.json\": 5688,\n\t\"./entities/player/player.json\": 6411,\n\t\"./entities/player/player_dead.json\": 5998,\n\t\"./entities/player/player_default.json\": 2333,\n\t\"./entities/player/player_target.json\": 6513,\n\t\"./hazards/bushes_001.json\": 3540,\n\t\"./interactables/berry_bush_01.json\": 7043,\n\t\"./interactables/berry_bush_01_used.json\": 8669,\n\t\"./items/fireball_ammo.json\": 8443,\n\t\"./items/hertz_item.json\": 1752,\n\t\"./projectiles/firebal_basic.json\": 8097,\n\t\"./secrets/open_area.json\": 3106,\n\t\"./secrets/secret_above.json\": 5536,\n\t\"./secrets/secret_area.json\": 4330,\n\t\"./secrets/secret_below.json\": 632\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6570;","/**\n * Game Slice\n * Manages game-level state (maps, registry, game status)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  activeMapData: null,\n  tileMapData: [],\n  objectMapData: [],\n  secretMapData: [],\n  revealedSecrets: [], // Track which secret zones have been revealed (array of indices)\n  objectTextureIndices: {}, // Track texture index per object position { index: textureIndex }\n  mapWidth: 20,\n  mapHeight: 15,\n  isLoading: false,\n  error: null,\n  isPaused: false,\n  isGameOver: false,\n};\n\nconst gameSlice = createSlice({\n  name: 'game',\n  initialState,\n  reducers: {\n    setActiveMap: (state, action) => {\n      const { mapData, tileMapData, objectMapData, secretMapData, mapWidth, mapHeight } = action.payload;\n      state.activeMapData = mapData;\n      state.tileMapData = tileMapData;\n      state.objectMapData = objectMapData;\n      state.secretMapData = secretMapData || [];\n      state.revealedSecrets = []; // Reset revealed secrets on new map\n      state.objectTextureIndices = {}; // Reset texture indices on new map\n      state.mapWidth = mapWidth;\n      state.mapHeight = mapHeight;\n      state.isGameOver = false;\n    },\n    updateObjectMap: (state, action) => {\n      state.objectMapData = action.payload;\n    },\n    removeObjectAtIndex: (state, action) => {\n      const index = action.payload;\n      if (state.objectMapData[index] !== undefined) {\n        state.objectMapData[index] = null;\n      }\n    },\n    updateObjectAtIndex: (state, action) => {\n      const { index, newId } = action.payload;\n      if (state.objectMapData[index] !== undefined) {\n        state.objectMapData[index] = newId;\n      }\n    },\n    setObjectTextureIndex: (state, action) => {\n      const { index, textureIndex } = action.payload;\n      state.objectTextureIndices[index] = textureIndex;\n    },\n    revealSecretZone: (state, action) => {\n      const indices = action.payload; // Array of tile indices to reveal\n      // Add new indices to revealed array (avoid duplicates)\n      indices.forEach(idx => {\n        if (!state.revealedSecrets.includes(idx)) {\n          state.revealedSecrets.push(idx);\n        }\n      });\n    },\n    setLoading: (state, action) => {\n      state.isLoading = action.payload;\n    },\n    setError: (state, action) => {\n      state.error = action.payload;\n    },\n    setPaused: (state, action) => {\n      state.isPaused = action.payload;\n    },\n    setGameOver: (state, action) => {\n      state.isGameOver = action.payload;\n    },\n    resetGame: (state) => {\n      return { ...initialState, activeMapData: state.activeMapData };\n    },\n  },\n});\n\nexport const {\n  setActiveMap,\n  updateObjectMap,\n  removeObjectAtIndex,\n  updateObjectAtIndex,\n  setObjectTextureIndex,\n  revealSecretZone,\n  setLoading,\n  setError,\n  setPaused,\n  setGameOver,\n  resetGame,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","/**\n * Game Constants\n * All game-wide constants centralized in one place\n */\n\n// Physics Constants\nexport const TILE_SIZE = 32;\nexport const GRAVITY = 0.6;\nexport const TERMINAL_VELOCITY = 12;\nexport const MOVE_SPEED = 4;\nexport const JUMP_FORCE = 10;\n\n// Player Stats Constants\nexport const MAX_HEALTH = 100;\nexport const MAX_OXYGEN = 100;\nexport const MAX_LAVA_RESIST = 100;\n\n// Combat Constants\nexport const SHOOT_COOLDOWN = 350; // milliseconds\nexport const HIT_FLASH_DURATION = 500; // milliseconds\n\n// Animation Constants\nexport const IDLE_ANIMATION = 'idle';\nexport const RUN_ANIMATION = 'run';\nexport const JUMP_ANIMATION = 'jump';\n\n// Liquid Constants\nexport const WATER_HORIZONTAL_DAMPING = 0.82;\nexport const LAVA_HORIZONTAL_DAMPING = 0.78;\n\n// Default Liquid Parameters\nexport const DEFAULT_OXYGEN_PARAMS = {\n  drainPerSecond: 20,\n  regenPerSecond: 35,\n  damagePerSecondWhenDepleted: 10,\n};\n\nexport const DEFAULT_LAVA_PARAMS = {\n  drainPerSecond: 25,\n  regenPerSecond: 40,\n  damagePerSecondWhenDepleted: 15,\n};\n\n// Timing Constants\nexport const HAZARD_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\nexport const LIQUID_DAMAGE_TICK_INTERVAL = 1000; // milliseconds\n\n// Direction Constants\nexport const DIRECTION_RIGHT = 1;\nexport const DIRECTION_LEFT = -1;\n\n// Map Defaults\nexport const DEFAULT_MAP_WIDTH = 20;\nexport const DEFAULT_MAP_HEIGHT = 15;\n\n// Viewport Constants\nexport const VIEWPORT_DEAD_ZONE_LEFT = 0.3;\nexport const VIEWPORT_DEAD_ZONE_RIGHT = 0.7;\n\n// Sound Constants\nexport const DEFAULT_BACKGROUND_MUSIC_VOLUME = 0.6;\nexport const DEFAULT_SFX_VOLUME = 0.5;\n","/**\n * Player Slice\n * Manages player state (position, health, resources, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\nimport { MAX_HEALTH, MAX_OXYGEN, MAX_LAVA_RESIST } from '../../constants/gameConstants';\n\nconst initialState = {\n  x: 0,\n  y: 0,\n  width: 32,\n  height: 32,\n  vx: 0,\n  vy: 0,\n  isGrounded: false,\n  direction: 1,\n  animation: 'idle',\n  health: 90,\n  maxHealth: MAX_HEALTH,\n  ammo: 0,\n  oxygen: MAX_OXYGEN,\n  maxOxygen: MAX_OXYGEN,\n  lavaResist: MAX_LAVA_RESIST,\n  maxLavaResist: MAX_LAVA_RESIST,\n  projectiles: [],\n  inWater: false,\n  headUnderWater: false,\n  atSurface: false,\n  liquidType: null,\n  hitTimerMs: 0,\n};\n\nconst playerSlice = createSlice({\n  name: 'player',\n  initialState,\n  reducers: {\n    updateState: (state, action) => {\n      return { ...state, ...action.payload };\n    },\n    setPosition: (state, action) => {\n      const { x, y } = action.payload;\n      state.x = x;\n      state.y = y;\n    },\n    setVelocity: (state, action) => {\n      const { vx, vy } = action.payload;\n      state.vx = vx;\n      state.vy = vy;\n    },\n    setHealth: (state, action) => {\n      state.health = Math.max(0, Math.min(state.maxHealth, action.payload));\n    },\n    addHealth: (state, action) => {\n      state.health = Math.max(0, Math.min(state.maxHealth, state.health + action.payload));\n    },\n    takeDamage: (state, action) => {\n      state.health = Math.max(0, state.health - action.payload);\n      state.hitTimerMs = Math.max(state.hitTimerMs, 500);\n    },\n    setAmmo: (state, action) => {\n      state.ammo = Math.max(0, action.payload);\n    },\n    addAmmo: (state, action) => {\n      state.ammo = Math.max(0, state.ammo + action.payload);\n    },\n    setOxygen: (state, action) => {\n      state.oxygen = Math.max(0, Math.min(state.maxOxygen, action.payload));\n    },\n    setLavaResist: (state, action) => {\n      state.lavaResist = Math.max(0, Math.min(state.maxLavaResist, action.payload));\n    },\n    setProjectiles: (state, action) => {\n      state.projectiles = action.payload;\n    },\n    addProjectile: (state, action) => {\n      state.projectiles.push(action.payload);\n    },\n    removeProjectile: (state, action) => {\n      state.projectiles = state.projectiles.filter(p => p.id !== action.payload);\n    },\n    setDirection: (state, action) => {\n      state.direction = action.payload;\n    },\n    setAnimation: (state, action) => {\n      state.animation = action.payload;\n    },\n    setGrounded: (state, action) => {\n      state.isGrounded = action.payload;\n    },\n    setInWater: (state, action) => {\n      state.inWater = action.payload;\n    },\n    setLiquidType: (state, action) => {\n      state.liquidType = action.payload;\n    },\n    resetPlayer: () => initialState,\n  },\n});\n\nexport const {\n  updateState,\n  setPosition,\n  setVelocity,\n  setHealth,\n  addHealth,\n  takeDamage,\n  setAmmo,\n  addAmmo,\n  setOxygen,\n  setLavaResist,\n  setProjectiles,\n  addProjectile,\n  removeProjectile,\n  setDirection,\n  setAnimation,\n  setGrounded,\n  setInWater,\n  setLiquidType,\n  resetPlayer,\n} = playerSlice.actions;\n\nexport default playerSlice.reducer;\n","/**\n * Settings Slice\n * Manages game settings (audio, graphics, controls, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  sound: {\n    enabled: false,\n    masterVolume: 1.0,\n    sfxVolume: 0.5,\n    musicVolume: 0.6,\n  },\n  graphics: {\n    backgroundParallaxFactor: 0.3,\n    weatherRain: 0,\n    weatherSnow: 0,\n    weatherClouds: 0,\n    weatherFog: 0,\n    weatherThunder: 0,\n  },\n  ui: {\n    healthBarEnabled: true,\n    oxygenBarEnabled: true,\n    lavaBarEnabled: true,\n    waterSplashesEnabled: true,\n    lavaEmbersEnabled: true,\n  },\n  controls: {\n    keyUp: 'w',\n    keyDown: 's',\n    keyLeft: 'a',\n    keyRight: 'd',\n    keyJump: 'Space',\n    keyShoot: 'MouseLeft',\n  },\n};\n\n// Load settings from localStorage\nconst loadSettings = () => {\n  try {\n    const saved = localStorage.getItem('game_settings');\n    if (saved) {\n      const parsed = JSON.parse(saved);\n      return { ...initialState, ...parsed };\n    }\n  } catch (error) {\n    console.error('Failed to load settings:', error);\n  }\n  return initialState;\n};\n\nconst settingsSlice = createSlice({\n  name: 'settings',\n  initialState: loadSettings(),\n  reducers: {\n    updateSettings: (state, action) => {\n      const newState = { ...state, ...action.payload };\n      // Save to localStorage\n      try {\n        localStorage.setItem('game_settings', JSON.stringify(newState));\n      } catch (error) {\n        console.error('Failed to save settings:', error);\n      }\n      return newState;\n    },\n    setSoundEnabled: (state, action) => {\n      state.sound.enabled = action.payload;\n      try {\n        localStorage.setItem('game_sound_enabled', action.payload ? '1' : '0');\n      } catch (error) {\n        console.error('Failed to save sound setting:', error);\n      }\n    },\n    setSoundVolume: (state, action) => {\n      const { type, volume } = action.payload;\n      if (type === 'master') state.sound.masterVolume = volume;\n      else if (type === 'sfx') state.sound.sfxVolume = volume;\n      else if (type === 'music') state.sound.musicVolume = volume;\n    },\n    setGraphicsSetting: (state, action) => {\n      const { key, value } = action.payload;\n      if (state.graphics[key] !== undefined) {\n        state.graphics[key] = value;\n      }\n    },\n    setUISetting: (state, action) => {\n      const { key, value } = action.payload;\n      if (state.ui[key] !== undefined) {\n        state.ui[key] = value;\n      }\n    },\n    setControlBinding: (state, action) => {\n      const { key, value } = action.payload;\n      if (state.controls[key] !== undefined) {\n        state.controls[key] = value;\n      }\n    },\n    resetSettings: () => {\n      try {\n        localStorage.removeItem('game_settings');\n      } catch (error) {\n        console.error('Failed to clear settings:', error);\n      }\n      return initialState;\n    },\n  },\n});\n\nexport const {\n  updateSettings,\n  setSoundEnabled,\n  setSoundVolume,\n  setGraphicsSetting,\n  setUISetting,\n  setControlBinding,\n  resetSettings,\n} = settingsSlice.actions;\n\nexport default settingsSlice.reducer;\n","/**\n * UI Slice\n * Manages UI state (modals, menus, notifications, etc.)\n */\n\nimport { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  isMapModalOpen: true,\n  isSettingsOpen: false,\n  isTerminalOpen: false,\n  isPauseMenuOpen: false,\n  notifications: [],\n  cameraScrollX: 0,\n  shouldCenterMap: false,\n};\n\nconst uiSlice = createSlice({\n  name: 'ui',\n  initialState,\n  reducers: {\n    setMapModalOpen: (state, action) => {\n      state.isMapModalOpen = action.payload;\n    },\n    setSettingsOpen: (state, action) => {\n      state.isSettingsOpen = action.payload;\n    },\n    setTerminalOpen: (state, action) => {\n      state.isTerminalOpen = action.payload;\n      // Also set global flag for game loop\n      try {\n        window.__GAME_TERMINAL_OPEN__ = action.payload;\n      } catch {}\n    },\n    setPauseMenuOpen: (state, action) => {\n      state.isPauseMenuOpen = action.payload;\n    },\n    addNotification: (state, action) => {\n      state.notifications.push({\n        id: Date.now(),\n        timestamp: new Date().toISOString(),\n        ...action.payload,\n      });\n    },\n    removeNotification: (state, action) => {\n      state.notifications = state.notifications.filter(n => n.id !== action.payload);\n    },\n    clearNotifications: (state) => {\n      state.notifications = [];\n    },\n    setCameraScrollX: (state, action) => {\n      state.cameraScrollX = action.payload;\n    },\n    setShouldCenterMap: (state, action) => {\n      state.shouldCenterMap = action.payload;\n    },\n    resetUI: () => initialState,\n  },\n});\n\nexport const {\n  setMapModalOpen,\n  setSettingsOpen,\n  setTerminalOpen,\n  setPauseMenuOpen,\n  addNotification,\n  removeNotification,\n  clearNotifications,\n  setCameraScrollX,\n  setShouldCenterMap,\n  resetUI,\n} = uiSlice.actions;\n\nexport default uiSlice.reducer;\n","/**\n * Redux Store Configuration\n * Centralized state management for the game\n */\n\nimport { configureStore } from '@reduxjs/toolkit';\nimport gameReducer from './slices/gameSlice';\nimport playerReducer from './slices/playerSlice';\nimport settingsReducer from './slices/settingsSlice';\nimport uiReducer from './slices/uiSlice';\n\nconst store = configureStore({\n  reducer: {\n    game: gameReducer,\n    player: playerReducer,\n    settings: settingsReducer,\n    ui: uiReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        // Ignore these action types for serialization checks\n        ignoredActions: ['game/setActiveMap', 'player/updateState'],\n        // Ignore these field paths in all actions\n        ignoredActionPaths: ['payload.projectiles', 'payload.timestamp'],\n        // Ignore these paths in the state\n        ignoredPaths: ['game.activeMapData', 'player.projectiles'],\n      },\n    }),\n  devTools: process.env.NODE_ENV !== 'production',\n});\n\nexport default store;\n","/**\n * Theme Configuration for Styled Components\n * Centralized design tokens and theme variables\n */\n\nconst theme = {\n  colors: {\n    primary: '#4CAF50',\n    secondary: '#2196F3',\n    danger: '#f44336',\n    warning: '#ff9800',\n    success: '#8bc34a',\n    info: '#00bcd4',\n    dark: '#222',\n    darkGray: '#333',\n    mediumGray: '#555',\n    lightGray: '#777',\n    background: '#111',\n    surface: '#f9f9f9',\n    overlay: 'rgba(0, 0, 0, 0.6)',\n    text: '#333',\n    textLight: '#666',\n    textDark: '#fff',\n    border: '#ddd',\n    borderLight: '#eee',\n  },\n\n  spacing: {\n    xs: '4px',\n    sm: '8px',\n    md: '16px',\n    lg: '24px',\n    xl: '32px',\n    xxl: '48px',\n  },\n\n  borderRadius: {\n    sm: '4px',\n    md: '6px',\n    lg: '8px',\n    xl: '12px',\n    round: '50%',\n  },\n\n  shadows: {\n    sm: '0 2px 4px rgba(0,0,0,0.1)',\n    md: '0 4px 8px rgba(0,0,0,0.2)',\n    lg: '0 10px 25px rgba(0,0,0,0.5)',\n  },\n\n  fontSize: {\n    xs: '11px',\n    sm: '12px',\n    md: '14px',\n    base: '16px',\n    lg: '18px',\n    xl: '24px',\n    xxl: '32px',\n  },\n\n  fontWeight: {\n    light: 300,\n    normal: 400,\n    medium: 500,\n    semibold: 600,\n    bold: 700,\n  },\n\n  transitions: {\n    fast: '0.15s ease',\n    normal: '0.3s ease',\n    slow: '0.5s ease',\n  },\n\n  zIndex: {\n    base: 1,\n    dropdown: 100,\n    modal: 1000,\n    tooltip: 1100,\n    notification: 1200,\n  },\n\n  breakpoints: {\n    mobile: '480px',\n    tablet: '768px',\n    desktop: '1024px',\n    wide: '1280px',\n  },\n};\n\nexport default theme;\n","/**\n * Global Styles using Styled Components\n */\n\nimport { createGlobalStyle } from 'styled-components';\n\nconst GlobalStyles = createGlobalStyle`\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n      sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overflow: hidden;\n  }\n\n  code {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n      monospace;\n  }\n\n  button {\n    cursor: pointer;\n    font-family: inherit;\n\n    &:disabled {\n      cursor: not-allowed;\n      opacity: 0.6;\n    }\n  }\n\n  input, textarea, select {\n    font-family: inherit;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  ul, ol {\n    list-style: none;\n  }\n\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  /* Scrollbar Styles */\n  ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #222;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #555;\n    border-radius: 5px;\n\n    &:hover {\n      background: #777;\n    }\n  }\n`;\n\nexport default GlobalStyles;\n","import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\n\nimport lv_navigation_home from \"./translations/lv/navigation_home.json\"\nimport no_navigation_home from  \"./translations/no/navigation_home.json\"\nimport en_navigation_home from  \"./translations/en/navigation_home.json\"\nimport ru_navigation_home from  \"./translations/ru/navigation_home.json\"\nimport ja_navigation_home from  \"./translations/ja/navigation_home.json\"\n\nconst lv_navigation = {\n    ...lv_navigation_home\n}\n\nconst no_navigation = {\n    ...no_navigation_home\n}\n\nconst en_navigation = {\n    ...en_navigation_home\n}\n\nconst ru_navigation = {\n    ...ru_navigation_home\n}\n\nconst ja_navigation = {\n    ...ja_navigation_home\n}\n\ni18n\n    .use(initReactI18next)\n    .init({\n        lng: \"lv\",\n        fallbackLng: \"lv\",\n        supportedLngs: [\"lv\", \"no\", \"en\", \"ru\", \"ja\"],\n        ns: [\"navigation\"],\n        defaultNS: \"navigation\",\n        interpolation: { escapeValue: false },\n        resources: {\n            lv: {\n                navigation: lv_navigation\n            },\n            no: {\n                navigation: no_navigation\n            },\n            en: {\n                navigation: en_navigation\n            },\n            ru: {\n                navigation: ru_navigation\n            },\n            ja: {\n                navigation: ja_navigation\n            },\n        },\n    })\n\nexport default i18n","import styled from \"styled-components\"\nimport { NavLink } from \"react-router-dom\"\nimport { useTranslation } from \"react-i18next\"\n\nexport const NavLinkButton = styled(NavLink)`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    padding: 0 10px;\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n    text-decoration: none;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport function SectionHeaderNavigationChapters() {\n    const { t } = useTranslation(\"navigation\");\n    const chapter_home = t(\"NAVIGATION_HOME\")\n    const chapter_game = t(\"NAVIGATION_NEW_GAME\")\n    const chapter_editor = t(\"NAVIGATION_EDITOR\")\n    const chapter_crystals = t(\"NAVIGATION_CRYSTALS\")\n    const chapter_repository = t(\"NAVIGATION_REPOSITORY\")\n\n    // JAUNS: Funkcija, kas nosta signlu atvrt modlo logu\n    const handleNewGameClick = () => {\n        // Nostam globlu notikumu, ko 'game.jsx' vars uztvert\n        window.dispatchEvent(new Event('open-new-game-modal'));\n    };\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavLinkButton to=\"/\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_home }\n            </NavLinkButton>\n\n            {/* JAUNS: Pievienots onClick handleris */}\n            <NavLinkButton to=\"/game\" onClick={handleNewGameClick} className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_game }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/editor\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_editor }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/crystals\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_crystals }\n            </NavLinkButton>\n\n            <NavLinkButton to=\"/repository\" className={({ isActive }) => isActive ? \"active\" : \"\"}>\n                { chapter_repository }\n            </NavLinkButton>\n        </nav>\n    )\n}\n","import styled from \"styled-components\"\nimport { useTranslation } from \"react-i18next\"\n\nconst NavButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    background-color: transparent;\n    color: lightgray;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    //height: 36px;              /* fiksts augstums desktop */\n    padding: 0 10px;           /* horizontlais padding */\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: nowrap;\n    border-radius: 0;\n\n    &:hover {\n        background-color: #f4c542;\n        color: #2a2a2a;\n        border-color: #f4c542;\n    }\n\n    &.active {\n        background-color: rgba(255, 255, 255, 0.15);\n        border-color: rgba(255, 255, 255, 0.5);\n        color: black;\n    }\n`\n\nexport default function SectionHeaderNavigationLanguages() {\n    const { i18n } = useTranslation();\n    const currentLang = i18n.language || 'lv'\n\n    const handleLanguageChange = (newLang) => {\n        i18n.changeLanguage(newLang)\n    }\n\n    return (\n        <nav style={{ display: \"flex\", gap: \"0\" }}>\n            <NavButton\n                className={currentLang === 'lv' ? 'active' : ''}\n                onClick={() => handleLanguageChange('lv')}\n            >\n                LV\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'no' ? 'active' : ''}\n                onClick={() => handleLanguageChange('no')}\n            >\n                NO\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'en' ? 'active' : ''}\n                onClick={() => handleLanguageChange('en')}\n            >\n                EN\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ru' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ru')}\n            >\n                RU\n            </NavButton>\n\n            <NavButton\n                className={currentLang === 'ja' ? 'active' : ''}\n                onClick={() => handleLanguageChange('ja')}\n            >\n                JA\n            </NavButton>\n        </nav>\n    )\n}","import styled from \"styled-components\"\n\nconst StyledLogo = styled.p`\n    text-transform: uppercase;\n`\n\nexport function SectionHeaderNavigationLogo() {\n\n    return (\n        <StyledLogo>\n            Element Masters\n        </StyledLogo>\n    )\n}","import styled from \"styled-components\"\nimport { SectionHeaderNavigationChapters } from \"./section.header.navigation.chapters\"\nimport SectionHeaderNavigationLanguages from \"./section.header.navigation.languages\"\nimport {SectionHeaderNavigationLogo} from \"./section.header.navigation.logo\";\n\nconst StyledSectionHeaderNavigation = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgrey;\n    \n    .innerHeader {\n        display: flex;\n        flex-direction: row;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n        \n        .innerHeaderLogo {\n            display: flex;\n            flex-direction: row;\n            width: 220px;\n            height: auto;\n            //border: solid 1px green;\n        }\n        \n        .innerHeaderChapters {\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            width: 100%;\n            height: auto;\n            //border: solid 1px brown;\n        }\n        \n        .innerHeaderLanguages {\n            display: flex;\n            flex-direction: row;\n            width: auto;\n            height: auto;\n            //border: solid 1px red;\n        }\n    }\n`\n\nfunction SectionHeader() {\n\n    return (\n        <StyledSectionHeaderNavigation>\n            <div className=\"innerHeader\">\n                <div className=\"innerHeaderLogo\">\n                    <SectionHeaderNavigationLogo />\n                </div>\n\n                <div className=\"innerHeaderChapters\">\n                    <SectionHeaderNavigationChapters />\n                </div>\n\n                <div className=\"innerHeaderLanguages\">\n                    <SectionHeaderNavigationLanguages />\n                </div>\n            </div>\n        </StyledSectionHeaderNavigation>\n    )\n}\n\nexport default SectionHeader","import styled from \"styled-components\"\n\nconst StyledSectionHeaderFooter = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: 100%;\n    height: auto;\n    border: solid 1px lightgray;\n\n    .innerFooter {\n        display: flex;\n        flex-direction: row;\n        justify-content: flex-end;\n        width: 100%;\n        height: auto;\n        margin: 5px 20px;\n        //border: solid 1px red;\n    }\n\n    p {\n        font-size: 12px;\n        color: lightgrey;\n    }\n`\n\nfunction SectionFooter() {\n\n    return (\n        <StyledSectionHeaderFooter>\n            <div className=\"innerFooter\">\n                <p>element_masters v.0.0.0</p>\n            </div>\n        </StyledSectionHeaderFooter>\n    )\n}\n\nexport default SectionFooter","import styled from \"styled-components\"\n\nconst StyledSectionContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    height: 100%;\n    border: solid 1px lightgray;\n`\n\nfunction SectionContent({ children, style }) {\n\n    return (\n        <StyledSectionContent style={style}>\n            { children }\n        </StyledSectionContent>\n    )\n}\n\nexport default SectionContent","/**\n * Game Registry Module\n * Loads all JSON files and creates a registry array.\n * Executed only once during initialization.\n */\n\nlet _registry = null;\n\n/**\n * Initialize the registry by loading all JSON, image, and sound assets.\n * This is executed only once when the module is first imported.\n * @returns {Array} The loaded registry items\n */\nconst initRegistry = () => {\n    // If registry already exists, do nothing\n    if (_registry) return _registry;\n\n    console.time(\"Registry Load Time\");\n\n    try {\n        // 1. Load JSON data\n        const jsonContext = require.context('../../assets/json', true, /\\.json$/);\n\n        // 2. Load IMAGES\n        const imageContext = require.context('../../assets/images', true, /\\.(png|jpe?g|svg)$/);\n\n        // 3. Load SOUNDS (non-fatal: if not supported or directory doesn't exist, continue without sounds)\n        let soundContext = null;\n        try {\n            soundContext = require.context('../../assets/sound', true, /\\.(mp3|wav|ogg|m4a|aac|flac|webm)$/);\n        } catch (e) {\n            // Sound context not available  not fatal\n            soundContext = null;\n        }\n\n        // Check if sound context is available\n        if (!soundContext) {\n            console.warn('Sound context unavailable. Continuing without pre-resolved sound assets.');\n        }\n\n        // Helper function for path resolution\n        const resolvePath = (rawPath) => {\n            if (!rawPath) return null;\n            try {\n                // Convert JSON path to relative Webpack path\n                // Example: \"/assets/images/blocks/dirt.png\" -> \"./blocks/dirt.png\"\n                const cleanPath = rawPath.replace('/assets/images/', './').replace('src/assets/images/', './');\n                const relativePath = cleanPath.startsWith('./') ? cleanPath : `./${cleanPath}`;\n\n                const imageModule = imageContext(relativePath);\n                return imageModule.default || imageModule;\n            } catch (e) {\n                console.warn(`Image not found: ${rawPath}`);\n                return rawPath; // If not found, return original path\n            }\n        };\n\n        let _warnedUnresolvedSound = false;\n        const resolveSound = (rawPath) => {\n            if (!rawPath) return null;\n            // Normalize path for sound context\n            const normalize = (p) => {\n                let out = p;\n                out = out.replace('/assets/sounds/', './').replace('src/assets/sounds/', './');\n                out = out.replace('/assets/sound/', './').replace('src/assets/sound/', './');\n                return out.startsWith('./') ? out : `./${out}`;\n            };\n            const rel = normalize(rawPath);\n            // Try to resolve with sound context\n            if (soundContext) {\n                try {\n                    const mod = soundContext(rel);\n                    return mod.default || mod;\n                } catch {}\n            }\n            // Unable to resolve in bundler  return original path to try loading via public URL\n            if (!_warnedUnresolvedSound) {\n                console.warn(`SFX not bundled: ${rawPath}. Will try loading via public URL. Place files under src/assets/sound, or copy to public/assets/sound.`);\n                _warnedUnresolvedSound = true;\n            }\n            return rawPath;\n        };\n\n        _registry = jsonContext.keys().map((key) => {\n            const data = jsonContext(key);\n            const item = data.default || data;\n\n            // Apstrdjam vienu bildi (vecais variants)\n            let resolvedTexture = resolvePath(item.texture);\n\n            // Apstrdjam bilu masvu (jaunais variants animcijm)\n            let resolvedTextures = [];\n            if (item.textures && Array.isArray(item.textures)) {\n                resolvedTextures = item.textures.map(path => resolvePath(path));\n            }\n\n            return {\n                ...item,\n                texture: resolvedTexture,     // Viena bilde (ja ir)\n                textures: resolvedTextures,   // Masvs (ja ir)\n                // Skaas ce (ja ir)  prvrsts uz bundlera URL\n                sfx: resolveSound(item.sfx || item.sfxResolved || null)\n            };\n        });\n\n        // --- JAUNS: Pcapstrde (Linking & Merging) ---\n        // Ms ejam cauri visiem elementiem un mekljam tos, kuriem ir 'defaultAnimation'.\n        // Ja atrodam, ms kopjam vizulos datus no animcijas uz galveno objektu.\n        \n        _registry.forEach(item => {\n            if (item.defaultAnimation) {\n                // Mekljam animcijas objektu pc ID\n                // Piezme: Tav piemr player.json ir \"player_default\", bet fail id ir \"player_default_100\". \n                // eit ms minm atrast preczu vai daju atbilstbu, lai kods strdtu abos gadjumos.\n                const animItem = _registry.find(r => r.id === item.defaultAnimation || r.id === item.defaultAnimation + \"_100\");\n                \n                if (animItem) {\n                    // Kopjam vizulos datus uz galveno 'player' objektu\n                    if (!item.texture) item.texture = animItem.texture;\n                    if (!item.textures || item.textures.length === 0) item.textures = animItem.textures;\n                    if (!item.animationSpeed) item.animationSpeed = animItem.animationSpeed;\n                    \n                    // Iezmjam animcijas objektu k 'hidden', lai to nerdtu Editor\n                    animItem.isHiddenInEditor = true;\n                }\n                \n                // Tpat paslpjam ar dead un target animcijas, ja ts eksist k atsevii itemi\n                if (item.deadAnimation) {\n                     const deadItem = _registry.find(r => r.id === item.deadAnimation);\n                     if (deadItem) deadItem.isHiddenInEditor = true;\n                }\n                if (item.targetAnimation) {\n                     const targetItem = _registry.find(r => r.id === item.targetAnimation || r.id === item.targetAnimation + \"_100\");\n                     if (targetItem) targetItem.isHiddenInEditor = true;\n                }\n            }\n        });\n\n        console.log(` Game Registry initialized. Loaded ${_registry.length} items.`);\n\n    } catch (error) {\n        console.error(\" Failed to load Game Registry:\", error);\n        _registry = [];\n    }\n\n    console.timeEnd(\"Registry Load Time\");\n    return _registry;\n};\n\n// Automtiski inicializjam, kad is fails tiek importts pirmo reizi\ninitRegistry();\n\n// Eksportjam funkciju, lai piektu datiem (getter)\nexport const getRegistry = () => {\n    return _registry;\n};\n\n// Eksportjam palgfunkciju, lai mekltu pc ID\nexport const findItemById = (id) => {\n    return _registry ? _registry.find(item => item.id === id) : null;\n};\n\nexport default _registry;\n","import React, { useEffect } from 'react';\nimport { Outlet, Link } from \"react-router-dom\"\nimport SectionHeader from \"./sections/section.header\";\nimport SectionFooter from \"./sections/section.footer\";\nimport SectionContent from \"./sections/section.content\";\n\n// Import the registry getter from the centralized engine registry\n// The import itself ensures that the registry code executes and data loads into memory.\nimport { getRegistry } from './engine/registry';\n\nfunction App() {\n\n  useEffect(() => {\n    // Verify that registry data is loaded into memory\n    const items = getRegistry();\n    console.log(\"App start - Current Registry in Memory:\", items);\n  }, []);\n\n  return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden'\n        }}>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionHeader />\n            </div>\n            <SectionContent style={{ flexGrow: 1, width: '100%', overflow: 'auto' }}>\n                <Outlet />\n            </SectionContent>\n            <div style={{ width: '100%', flexShrink: 0 }}>\n                <SectionFooter />\n            </div>\n        </div>\n      )\n    }\n\nexport default App","\n\nexport default function Home() {\n\n    return (\n        <>\n            <p>Home</p>\n        </>\n    )\n}","// Lightweight texture cache around PIXI.Texture.from\n// Usage:\n//   const cache = new TextureCache();\n//   const tex = cache.get(url);\n//   cache.dispose(); // optional\n\nimport { Texture } from 'pixi.js';\n\nexport class TextureCache {\n  constructor() {\n    this._map = new Map();\n  }\n\n  get(url) {\n    if (!url) return null;\n    const m = this._map;\n    if (m.has(url)) return m.get(url);\n    const tex = Texture.from(url);\n    m.set(url, tex);\n    return tex;\n  }\n\n  has(url) {\n    return this._map.has(url);\n  }\n\n  dispose(url) {\n    // Do not destroy textures created by Texture.from (managed by Pixi's cache);\n    // only release our Map reference.\n    if (url && this._map.has(url)) this._map.delete(url);\n  }\n\n  clear() {\n    this._map.clear();\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Simple rain system with variable speeds and single-bounce behavior on solid tiles.\nexport default class WeatherRain {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.particles = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Reasonable particle cap depending on map area to keep FPS stable\n    this.maxParticles = Math.max(160, Math.floor(area / 2600));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Draw a thin slanted line to mimic a raindrop motion blur\n    g.lineStyle(0);\n    g.beginFill(0x4aa3ff, 0.92);\n    // Slightly longer/brighter to be more visible\n    g.drawRect(0, 0, 1.3, 9);\n    g.endFill();\n    const x = Math.random() * this.width;\n    const y = -10 - Math.random() * 30;\n    const speed = 520 + Math.random() * 520; // px/s, different speeds for depth\n    const vx = (Math.random() * 60 - 30); // slight wind\n    const vy = speed;\n    g.x = x;\n    g.y = y;\n    g.rotation = 0.15; // slight tilt\n    this.container.addChild(g);\n    this.particles.push({ g, x, y, vx, vy, bounces: 0, alive: true });\n  }\n\n  update(dtMs) {\n    // adjust intensity dynamically\n    this.setIntensity(this.getIntensity());\n\n    // Constant-density controller: keep active particles near target count\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxParticles * scaled);\n    if (scaled > 0 && target < 8) target = 8; // small baseline so low intensity still visible\n\n    const deficit = target - this.particles.length;\n    if (deficit > 0) {\n      // Smooth ramp, spawn only a fraction per frame to avoid bursts\n      const maxPerFrame = 48;\n      const smooth = Math.max(1, Math.ceil(target * 0.02));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady\n    if (this.particles.length > target) {\n      const surplus = this.particles.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.particles.length * 0.02)));\n      for (let i = 0; i < toCull; i++) {\n        const p = this.particles.pop();\n        if (!p) break;\n        try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n        try { p.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 1800; // gravity px/s^2\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n      if (!p.alive) { toRemove.push(i); continue; }\n\n      p.vy += gAcc * dt;\n      let nx = p.x + p.vx * dt;\n      let ny = p.y + p.vy * dt;\n\n      // Liquid surface interaction: water/lava\n      try {\n        if (typeof this.api.getLiquidSurfaceY === 'function') {\n          // Prefer closest surface above current ny\n          const syWater = this.api.getLiquidSurfaceY('water', nx);\n          if (Number.isFinite(syWater) && ny >= syWater) {\n            // Hit water surface  spawn small splash and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.4 + speed / 900);\n            if (typeof this.api.onWaterImpact === 'function') this.api.onWaterImpact({ x: nx, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n          const syLava = this.api.getLiquidSurfaceY('lava', nx);\n          if (Number.isFinite(syLava) && ny >= syLava) {\n            // Hit lava  steam puff and despawn\n            const speed = Math.max(0, Math.min(1500, p.vy));\n            const strength = Math.min(2, 0.35 + speed / 1200);\n            if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: syLava, strength });\n            p.alive = false; toRemove.push(i);\n            continue;\n          }\n        }\n      } catch {}\n\n      // Collision check (treat as point)\n      if (this.api.isSolidAt(nx, ny)) {\n        // Backtrack slightly to stand above surface\n        let guard = 0;\n        while (this.api.isSolidAt(nx, ny) && guard < 6) { ny -= 1; guard++; }\n        // Bounce once, then fade out quickly on next impact\n        if (p.bounces === 0 && Math.abs(p.vy) > 150) {\n          p.vy = -p.vy * 0.3; // dampened bounce\n          p.vx *= 0.8;\n          p.bounces++;\n        } else {\n          // Small splash effect: shrink line and fade\n          p.alive = false;\n          toRemove.push(i);\n        }\n      }\n\n      p.x = nx;\n      p.y = ny;\n      p.g.x = p.x;\n      p.g.y = p.y;\n\n      // Off-screen cleanup\n      if (p.y > this.height + 40 || p.x < -40 || p.x > this.width + 40) {\n        p.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    // remove in reverse\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const p = this.particles[idx];\n      if (p && p.g && p.g.parent) p.g.parent.removeChild(p.g);\n      if (p && p.g && p.g.destroy) try { p.g.destroy(); } catch {}\n      this.particles.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.particles.forEach(p => {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    });\n    this.particles = [];\n  }\n}\n","import { Graphics } from 'pixi.js';\n\n// Snow system: slow fluttering flakes with varied speeds; stop on blocks without bouncing.\nexport default class WeatherSnow {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.flakes = [];\n    this.intensity = 0;\n    const area = this.width * this.height;\n    // Snow lasts longer; keep a tighter cap than rain for performance\n    this.maxFlakes = Math.max(120, Math.floor(area / 3800));\n  }\n\n  setIntensity(v) {\n    this.intensity = Math.max(0, Math.min(100, Number(v) || 0));\n  }\n\n  spawnOne() {\n    const g = new Graphics();\n    g.clear();\n    // Slightly larger/more visible flakes on average\n    const r = 1.2 + Math.random() * 2.0; // radius\n    g.beginFill(0xffffff, 0.97);\n    g.drawCircle(0, 0, r);\n    g.endFill();\n    const x = Math.random() * this.width;\n    const y = -10 - Math.random() * 30;\n    const speed = 40 + Math.random() * 80; // slower than rain, but a bit more range\n    const drift = (Math.random() * 50 - 25); // horizontal drift\n    g.x = x;\n    g.y = y;\n    this.container.addChild(g);\n    this.flakes.push({ g, x, y, vx: drift, vy: speed, alive: true, settled: false, life: 1.0, phase: 'fall', restMs: 0 });\n  }\n\n  update(dtMs) {\n    // adjust intensity dynamically\n    this.setIntensity(this.getIntensity());\n\n    // Constant-density controller to avoid wavey bursts\n    const norm = Math.max(0, Math.min(1, this.intensity / 100));\n    const scaled = Math.pow(norm, 1.15);\n    let target = Math.floor(this.maxFlakes * scaled);\n    if (scaled > 0 && target < 10) target = 10;\n\n    const deficit = target - this.flakes.length;\n    if (deficit > 0) {\n      const maxPerFrame = 24; // slower than rain\n      const smooth = Math.max(1, Math.ceil(target * 0.015));\n      const toSpawn = Math.min(deficit, smooth, maxPerFrame);\n      for (let i = 0; i < toSpawn; i++) this.spawnOne();\n    }\n    // Gentle over-target culling to keep density steady when slider decreases\n    if (this.flakes.length > target) {\n      const surplus = this.flakes.length - target;\n      const toCull = Math.min(surplus, Math.max(1, Math.ceil(this.flakes.length * 0.015)));\n      for (let i = 0; i < toCull; i++) {\n        const f = this.flakes.pop();\n        if (!f) break;\n        try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n        try { f.g.destroy(); } catch {}\n      }\n    }\n\n    const gAcc = 200; // gentle gravity\n    const dt = dtMs / 1000;\n    const toRemove = [];\n\n    for (let i = 0; i < this.flakes.length; i++) {\n      const f = this.flakes[i];\n      if (!f.alive) { toRemove.push(i); continue; }\n\n      if (f.phase === 'fall') {\n        f.vy = Math.min(140, f.vy + gAcc * dt);\n        // small oscillation for flutter\n        f.vx += Math.sin((f.y + i) * 0.02) * 7 * dt;\n        let nx = f.x + f.vx * dt;\n        let ny = f.y + f.vy * dt;\n\n        // Liquid interaction first\n        try {\n          if (typeof this.api.getLiquidSurfaceY === 'function') {\n            const sYwater = this.api.getLiquidSurfaceY('water', nx);\n            if (Number.isFinite(sYwater) && ny >= sYwater) {\n              // Land on water surface and rest for a bit\n              ny = sYwater - 0.5;\n              f.x = nx; f.y = ny; f.vx = 0; f.vy = 0;\n              f.phase = 'rest';\n              f.restMs = 800 + Math.random() * 400; // 0.8..1.2s\n              // Do not continue to solid collision checks this frame\n              // Update display and proceed to next flake\n              f.g.x = f.x; f.g.y = f.y;\n              continue;\n            }\n            const sYlava = this.api.getLiquidSurfaceY('lava', nx);\n            if (Number.isFinite(sYlava) && ny >= sYlava) {\n              // Steam puff and despawn\n              if (typeof this.api.onLavaImpact === 'function') this.api.onLavaImpact({ x: nx, y: sYlava, strength: 0.5 });\n              f.alive = false; toRemove.push(i); continue;\n            }\n          }\n        } catch {}\n\n        // Solid collision\n        if (this.api.isSolidAt(nx, ny)) {\n          // backtrack up to stand above the surface\n          let guard = 0;\n          while (this.api.isSolidAt(nx, ny) && guard < 10) { ny -= 1; guard++; }\n          f.settled = true;\n          f.vx = 0;\n          f.vy = 0;\n          f.phase = 'rest';\n          f.restMs = 800 + Math.random() * 400;\n        }\n\n        f.x = nx;\n        f.y = ny;\n      } else if (f.phase === 'rest') {\n        // Flake rests on surface for a short time (water or ground), then starts sinking/falling slowly\n        f.restMs -= dtMs;\n        if (f.restMs <= 0) {\n          f.phase = 'sinking';\n          // resume gentle fall with reduced alpha\n          f.vx = (Math.random() * 20 - 10);\n          f.vy = 20 + Math.random() * 20;\n        }\n      } else if (f.phase === 'sinking') {\n        // Continue downward slowly; fade out progressively\n        f.vy = Math.min(60, f.vy + gAcc * 0.3 * dt);\n        f.x += f.vx * dt;\n        f.y += f.vy * dt;\n        f.life -= 0.22 * dt;\n        if (f.life <= 0) { f.alive = false; toRemove.push(i); }\n      }\n\n      f.g.x = f.x;\n      f.g.y = f.y;\n      if (f.phase === 'rest' || f.phase === 'sinking' || f.settled) f.g.alpha = Math.max(0, Math.min(1, f.life));\n\n      if (f.y > this.height + 40 || f.x < -40 || f.x > this.width + 40) {\n        f.alive = false;\n        toRemove.push(i);\n      }\n    }\n\n    for (let j = toRemove.length - 1; j >= 0; j--) {\n      const idx = toRemove[j];\n      const f = this.flakes[idx];\n      if (f && f.g && f.g.parent) f.g.parent.removeChild(f.g);\n      if (f && f.g && f.g.destroy) try { f.g.destroy(); } catch {}\n      this.flakes.splice(idx, 1);\n    }\n  }\n\n  destroy() {\n    this.flakes.forEach(f => {\n      try { f.g.parent && f.g.parent.removeChild(f.g); } catch {}\n      try { f.g.destroy(); } catch {}\n    });\n    this.flakes = [];\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Clouds overlay: organic cloud blobs drifting in the top 30% of the screen.\nexport default class WeatherClouds {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.bandHeight = Math.max(1, Math.floor(this.height * 0.3)); // top 30%\n    this.patches = [];\n    this.intensity = 0;\n\n    // Soft blur for nicer cloud appearance\n    try {\n      this.container.filters = [new BlurFilter({ strength: 2.0, quality: 2 })];\n    } catch {}\n\n    this.rebuild();\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this.rebuild();\n  }\n\n  rebuild() {\n    // Clear existing\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n\n    const count = Math.round((this.intensity / 100) * 18); // a bit fewer than fog by default\n    for (let i = 0; i < count; i++) {\n      const g = new Graphics();\n      const w = 140 + Math.random() * 300; // cloud size\n      const h = 80 + Math.random() * 160;\n      const x = Math.random() * (this.width + 200) - 100;\n      const y = -40 + Math.random() * (this.bandHeight - 20); // only in band\n      const alpha = 0.08 + (this.intensity / 100) * (0.12 + Math.random() * 0.08);\n      const speed = 8 + Math.random() * 22; // horizontal drift speed\n      const vy = (Math.random() - 0.5) * 4; // subtle vertical drift\n\n      // Draw an organic cloud using overlapping circles (soft edges)\n      g.beginFill(0xffffff, 1.0);\n      const rx = w * 0.5;\n      const ry = h * 0.5;\n      const circles = 8 + Math.floor(Math.random() * 6); // 8..13 lobes\n      const baseR = Math.min(rx, ry) * 0.55;\n      for (let k = 0; k < circles; k++) {\n        const t = (k / circles) * Math.PI * 2 + Math.random() * 0.6;\n        const dist = 0.2 + Math.random() * 0.35;\n        const cx = Math.cos(t) * rx * dist;\n        const cy = Math.sin(t) * ry * dist;\n        const r = baseR * (0.7 + Math.random() * 0.7);\n        g.drawCircle(cx, cy, r);\n      }\n      // central mass\n      g.drawCircle(0, 0, baseR * (0.9 + Math.random() * 0.5));\n      g.endFill();\n      g.alpha = alpha;\n      g.x = x;\n      g.y = y;\n      this.container.addChild(g);\n      this.patches.push({ g, w, h, vx: speed * (Math.random() < 0.5 ? -1 : 1), vy, alpha, phase: Math.random() * Math.PI * 2 });\n    }\n  }\n\n  update(dtMs) {\n    // live intensity update\n    const cur = Math.max(0, Math.min(100, this.getIntensity()));\n    if (cur !== this.intensity) this.setIntensity(cur);\n\n    const dt = dtMs / 1000;\n    const W = this.width;\n    const bandTop = -100; // allow spawn/wrap margin above\n    const bandBottom = this.bandHeight - 20; // keep away from lower area\n    for (const p of this.patches) {\n      // drift\n      p.g.x += p.vx * dt;\n      p.g.y += p.vy * dt;\n\n      // very gentle alpha oscillation\n      p.phase += dt * 0.35;\n      const osc = (Math.sin(p.phase) + 1) * 0.5; // 0..1\n      p.g.alpha = Math.max(0.04, Math.min(0.55, p.alpha * (0.75 + 0.5 * osc)));\n\n      // wrap horizontally\n      if (p.g.x < -180) p.g.x = W + 180;\n      if (p.g.x > W + 180) p.g.x = -180;\n      // constrain within top band vertically (wrap within band only)\n      if (p.g.y < bandTop) p.g.y = bandBottom;\n      if (p.g.y > bandBottom) p.g.y = bandTop;\n    }\n  }\n\n  destroy() {\n    try { this.container.filters = []; } catch {}\n    for (const p of this.patches) {\n      try { p.g.parent && p.g.parent.removeChild(p.g); } catch {}\n      try { p.g.destroy(); } catch {}\n    }\n    this.patches = [];\n  }\n}\n","import { Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// Full-screen fog overlay: a semi-transparent rectangle covering entire viewport.\n// Intensity 0..100 maps to alpha 0..0.65.\nexport default class WeatherFog {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api;\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = api.mapWidth * api.tileSize;\n    this.height = api.mapHeight * api.tileSize;\n    this.intensity = 0;\n    this.time = 0; // ms accumulator for subtle breathing\n\n    // Base tint rectangle drawn once; alpha controlled via displayObject alpha (no redraws per frame)\n    this.g = new Graphics();\n    this.container.addChild(this.g);\n\n    // Build procedural noise texture once (small size, repeats as tiling sprites)\n    this.noiseTex = WeatherFog._createNoiseTexture(128, 128);\n    this.layer1 = new TilingSprite(this.noiseTex, this.width, this.height);\n    this.layer2 = new TilingSprite(this.noiseTex, this.width, this.height);\n    // Different scales for parallax effect\n    this.layer1.tileScale.set(1.0, 1.0);\n    this.layer2.tileScale.set(0.6, 0.8);\n    // Start with zero alpha; will be set based on intensity\n    this.layer1.alpha = 0;\n    this.layer2.alpha = 0;\n    this.container.addChild(this.layer1);\n    this.container.addChild(this.layer2);\n\n    // Precompute parameters\n    this._recalcParams();\n    this._draw();\n  }\n\n  _alphaFromIntensity(v) {\n    const t = Math.max(0, Math.min(100, Number(v) || 0)) / 100; // 0..1\n    return Math.max(0, Math.min(0.65, t * 0.65));\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    this._recalcParams();\n    this._applyAlphas(0); // update layer alphas based on new intensity\n    this._draw();\n  }\n\n  resize(width, height) {\n    const w = Math.max(1, Math.floor(width));\n    const h = Math.max(1, Math.floor(height));\n    if (w === this.width && h === this.height) return;\n    this.width = w;\n    this.height = h;\n    // Resize tiling sprites and redraw base rect\n    if (this.layer1) { this.layer1.width = w; this.layer1.height = h; }\n    if (this.layer2) { this.layer2.width = w; this.layer2.height = h; }\n    this._draw();\n  }\n\n  _draw() {\n    const w = this.width;\n    const h = this.height;\n    const g = this.g;\n    g.clear();\n    const baseAlpha = this._alphaFromIntensity(this.intensity);\n    if (baseAlpha <= 0) {\n      g.alpha = 0;\n      return;\n    }\n    // Draw once with alpha 1, then control real alpha via g.alpha each frame\n    g.beginFill(0x9fb7c9, 1);\n    g.drawRect(0, 0, w, h);\n    g.endFill();\n    g.alpha = baseAlpha;\n  }\n\n  update(dtMs) {\n    // Live intensity update from settings\n    const cur = Math.max(0, Math.min(100, this.getIntensity()));\n    if (cur !== this.intensity) this.setIntensity(cur);\n\n    // Advance time for breathing/pulse\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this.time += dt;\n    // Very subtle breathing: sine between ~0.96 .. 1.04\n    const pulse = 1 + 0.04 * Math.sin(this.time * 0.0012);\n    this._applyAlphas(pulse);\n\n    // Scroll noise layers slowly\n    if (this.layer1) {\n      this.layer1.tilePosition.x += this.speed1.x * dt;\n      this.layer1.tilePosition.y += this.speed1.y * dt;\n    }\n    if (this.layer2) {\n      this.layer2.tilePosition.x += this.speed2.x * dt;\n      this.layer2.tilePosition.y += this.speed2.y * dt;\n    }\n  }\n\n  destroy() {\n    if (this.g) {\n      try { this.g.parent && this.g.parent.removeChild(this.g); } catch {}\n      try { this.g.destroy(); } catch {}\n    }\n    this.g = null;\n    try {\n      if (this.layer1) { this.layer1.parent && this.layer1.parent.removeChild(this.layer1); this.layer1.destroy(true); }\n    } catch {}\n    try {\n      if (this.layer2) { this.layer2.parent && this.layer2.parent.removeChild(this.layer2); this.layer2.destroy(true); }\n    } catch {}\n    this.layer1 = null;\n    this.layer2 = null;\n    try { this.noiseTex?.destroy(true); } catch {}\n    this.noiseTex = null;\n  }\n\n  _applyAlphas(pulseFactor = 1) {\n    const base = this._alphaFromIntensity(this.intensity);\n    // Noise contribution grows with intensity but remains subtle\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const noiseAlpha = base * (0.25 + 0.35 * t); // up to ~0.4 of base\n    if (this.g) this.g.alpha = base * pulseFactor;\n    if (this.layer1) this.layer1.alpha = noiseAlpha * 0.8;\n    if (this.layer2) this.layer2.alpha = noiseAlpha;\n  }\n\n  _recalcParams() {\n    // Map intensity to drift speeds (pixels per ms)\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const lerp = (a, b, u) => a + (b - a) * u;\n    // Two layers drifting in different directions\n    this.speed1 = { x: lerp(0.005, 0.025, t), y: lerp(0.0, 0.012, t) };\n    this.speed2 = { x: lerp(-0.006, -0.018, t), y: lerp(0.004, 0.02, t) };\n  }\n\n  // Static helper: generate small grayscale noise texture\n  static _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    // Use a gentle noise range to avoid harsh contrast\n    for (let i = 0; i < img.data.length; i += 4) {\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v;\n      img.data[i + 1] = v;\n      img.data[i + 2] = v;\n      img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n}\n","import { Graphics, BlurFilter } from 'pixi.js';\n\n// Thunder/Lightning weather effect\n// API:\n//   new WeatherThunder(container, api, getIntensity)\n//   setIntensity(v), resize(w,h), update(dtMs), destroy()\n// Notes:\n// - Renders inside weather layer (below fog). Blocks/tiles remain above fog.\n// - Picks random strike targets above solid tiles using api.isSolidAt(x,y).\nexport default class WeatherThunder {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.width = (api?.mapWidth || 0) * (api?.tileSize || 32);\n    this.height = (api?.mapHeight || 0) * (api?.tileSize || 32);\n\n    this.intensity = 0;\n    this.time = 0;\n    this.nextStrikeMs = Infinity; // scheduled delay to next strike\n    this.flashAlpha = 0; // global white flash\n    this.flashDecay = 0.0;\n    this.boltAlive = false;\n    this.boltTime = 0; // ms since bolt spawned\n    this.boltDuration = 0; // ms total\n\n    // Graphics\n    this.flashG = new Graphics();\n    this.boltG = new Graphics();\n    // Add slight glow to bolt\n    try {\n      this.boltG.filters = [new BlurFilter(2, 1)];\n    } catch {}\n    this.container.addChild(this.flashG);\n    this.container.addChild(this.boltG);\n\n    // Build once\n    this._scheduleNextStrike(true);\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    if (nv === this.intensity) return;\n    this.intensity = nv;\n    if (nv <= 0) {\n      // disable visuals\n      this.flashAlpha = 0;\n      this.boltAlive = false;\n      this._redrawFlash();\n      this._clearBolt();\n      this.nextStrikeMs = Infinity;\n    } else if (!Number.isFinite(this.nextStrikeMs) || this.nextStrikeMs === Infinity) {\n      this._scheduleNextStrike(true);\n    }\n  }\n\n  resize(w, h) {\n    const W = Math.max(1, Math.floor(w));\n    const H = Math.max(1, Math.floor(h));\n    if (W === this.width && H === this.height) return;\n    this.width = W;\n    this.height = H;\n    // redraw flash when active\n    if (this.flashAlpha > 0) this._redrawFlash();\n  }\n\n  update(dtMs) {\n    // live intensity updates\n    const curInt = Math.max(0, Math.min(100, this.getIntensity()));\n    if (curInt !== this.intensity) this.setIntensity(curInt);\n\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    if (this.intensity <= 0) return;\n\n    // Update scheduling\n    this.nextStrikeMs -= dt;\n    if (this.nextStrikeMs <= 0) {\n      // Perform strike: trigger screen flash and draw bolt\n      this._triggerFlash();\n      this._createBolt();\n      this._scheduleNextStrike(false); // schedule next time after immediate strike window\n    }\n\n    // Flash decay\n    if (this.flashAlpha > 0) {\n      // exponential-like decay via linear factor raised with dt\n      const decayPerMs = this.flashDecay || 0.004; // higher = quicker fade\n      this.flashAlpha = Math.max(0, this.flashAlpha - decayPerMs * dt);\n      this._redrawFlash();\n    }\n\n    // Bolt lifetime\n    if (this.boltAlive) {\n      this.boltTime += dt;\n      const t = this.boltTime / Math.max(1, this.boltDuration);\n      // Fade color/alpha over time\n      const remain = Math.max(0, 1 - t);\n      this.boltG.alpha = 0.25 + 0.75 * remain;\n      if (this.boltTime >= this.boltDuration) {\n        this._clearBolt();\n      }\n    }\n  }\n\n  destroy() {\n    try { this.flashG.parent && this.flashG.parent.removeChild(this.flashG); } catch {}\n    try { this.flashG.destroy(true); } catch {}\n    try { this.boltG.parent && this.boltG.parent.removeChild(this.boltG); } catch {}\n    try { this.boltG.destroy(true); } catch {}\n    this.flashG = null;\n    this.boltG = null;\n    this.container = null;\n  }\n\n  // Internal helpers\n  _scheduleNextStrike(initial) {\n    // Map intensity 1..100 to delay: from ~9000..6000 ms down to ~2500..1000 ms\n    if (this.intensity <= 0) { this.nextStrikeMs = Infinity; return; }\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const minDelay = this._lerp(1000, 2500, 1 - t); // at high intensity, between 12.5s\n    const maxDelay = this._lerp(2500, 9000, 1 - t); // at low intensity, up to ~9s\n    const delay = this._rand(minDelay, maxDelay);\n    this.nextStrikeMs = initial ? this._rand(400, 1400) : delay; // first strike quicker on enable\n  }\n\n  _triggerFlash() {\n    // Brightness based on intensity, with slight randomness\n    const t = Math.max(0, Math.min(1, this.intensity / 100));\n    const base = this._lerp(0.25, 0.9, t);\n    this.flashAlpha = Math.min(1, base * this._rand(0.8, 1));\n    // fade time scales with intensity (brighter fades a bit slower)\n    this.flashDecay = this._lerp(0.008, 0.004, t);\n    this._redrawFlash();\n  }\n\n  _redrawFlash() {\n    const g = this.flashG;\n    g.clear();\n    if (this.flashAlpha <= 0) return;\n    g.beginFill(0xffffff, this.flashAlpha);\n    g.drawRect(0, 0, this.width, this.height);\n    g.endFill();\n  }\n\n  _createBolt() {\n    // Determine target using solid scan from top\n    const W = this.width, H = this.height;\n    const x = Math.floor(this._rand(8, W - 8));\n    const topY = -Math.floor(this._rand(10, 40)); // start slightly above top\n    const targetY = this._findGroundY(x, H);\n    const endY = Number.isFinite(targetY) ? Math.max(0, targetY - this._rand(8, 16)) : Math.floor(H * 0.6);\n\n    // Build polyline with jittered segments from top to end\n    const segments = Math.max(8, Math.floor((endY - topY) / this._rand(10, 16)));\n    const jitterX = this._lerp(6, 18, Math.max(0, Math.min(1, this.intensity / 100)));\n    const points = [];\n    let cx = x;\n    let cy = topY;\n    points.push({ x: cx, y: cy });\n    for (let i = 1; i <= segments; i++) {\n      const ny = topY + Math.floor(((endY - topY) * i) / segments);\n      const nx = x + this._rand(-jitterX, jitterX);\n      cx = nx; cy = ny;\n      points.push({ x: cx, y: cy });\n    }\n\n    // Draw main bolt\n    const g = this.boltG;\n    g.clear();\n    const thickness = this._lerp(2, 5, Math.max(0, Math.min(1, this.intensity / 100)));\n    const color = 0xCCEEFF;\n    g.lineStyle({ width: thickness, color, alpha: 1, alignment: 0.5, cap: 'round', join: 'round' });\n    g.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) g.lineTo(points[i].x, points[i].y);\n\n    // Branches: some short forks from random mid points\n    const branchCount = Math.floor(this._lerp(1, 3, Math.max(0, Math.min(1, this.intensity / 100))));\n    for (let b = 0; b < branchCount; b++) {\n      const idx = Math.floor(this._rand(2, points.length - 2));\n      const p = points[idx];\n      const len = this._rand(30, 80);\n      const ang = this._rand(-Math.PI * 0.5, Math.PI * 0.5);\n      const bx = p.x + Math.cos(ang) * len;\n      const by = p.y + Math.sin(ang) * len;\n      g.lineStyle({ width: Math.max(1, thickness * 0.55), color, alpha: 0.9, alignment: 0.5 });\n      g.moveTo(p.x, p.y);\n      g.lineTo(bx, by);\n    }\n\n    this.boltAlive = true;\n    this.boltTime = 0;\n    this.boltDuration = this._rand(120, 260); // very brief\n    this.boltG.alpha = 1;\n  }\n\n  _clearBolt() {\n    if (!this.boltG) return;\n    this.boltAlive = false;\n    this.boltTime = 0;\n    this.boltDuration = 0;\n    try { this.boltG.clear(); } catch {}\n  }\n\n  _findGroundY(worldX, maxH) {\n    // Scan from top to bottom to find first solid tile boundary\n    const isSolid = this.api?.isSolidAt;\n    if (typeof isSolid !== 'function') return null;\n    for (let y = 0; y < maxH; y += 4) {\n      if (isSolid(worldX, y)) {\n        return y;\n      }\n    }\n    return null;\n  }\n\n  _rand(a, b) {\n    if (b === undefined) { b = a; a = 0; }\n    return a + Math.random() * (b - a);\n  }\n\n  _lerp(a, b, t) { return a + (b - a) * t; }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// WaterSplashFX: lightweight pooled splash particles (droplets + ring ripples)\n// API:\n//   const fx = new WaterSplashFX(container)\n//   fx.trigger({ x, y, strength, upward }) // upward=true for exit splash\n//   fx.update(dtMs)\n//   fx.resize(w,h) // noop (kept for symmetry)\n//   fx.destroy()\nexport default class WaterSplashFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.droplets = []; // {g,x,y,vx,vy,life,max}\n    this.rings = [];    // {g,x,y,r,vr,life,max}\n    this.maxDroplets = 48;\n    this.maxRings = 6;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.droplets = [];\n    this.rings = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 1, upward = false } = {}) {\n    const s = Math.max(0.2, Math.min(3, Number(strength) || 1));\n    // Ring ripple on surface (entry/exit)\n    if (this.rings.length < this.maxRings) {\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 0.8;\n      this.node.addChild(g);\n      this.rings.push({ g, x, y, r: 2 + 4 * s, vr: 0.08 + 0.12 * s, life: 0, max: 450 + 250 * s });\n    }\n    // Droplets burst\n    const count = Math.floor(8 + 18 * s);\n    for (let i = 0; i < count && this.droplets.length < this.maxDroplets; i++) {\n      const ang = upward ? (-Math.PI * 0.15 + Math.random() * Math.PI * 0.3) : (Math.PI * 0.6 + (Math.random() - 0.5) * Math.PI * 0.6);\n      const spd = (0.12 + Math.random() * 0.25) * (upward ? 1.2 : 1) * (0.6 + 0.8 * s);\n      const g = new Graphics();\n      g.x = 0; g.y = 0; g.alpha = 1;\n      this.node.addChild(g);\n      this.droplets.push({ g, x, y, vx: Math.cos(ang) * spd, vy: Math.sin(ang) * spd, life: 0, max: 500 + Math.random() * 400 });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // Droplets update\n    for (let i = this.droplets.length - 1; i >= 0; i--) {\n      const d = this.droplets[i];\n      d.life += dt;\n      d.vy += 0.0018 * dt; // gravity\n      d.x += d.vx * dt;\n      d.y += d.vy * dt;\n      const t = Math.min(1, d.life / d.max);\n      const alpha = 1 - t;\n      const size = 1 + 1.5 * (1 - t);\n      const g = d.g; g.clear();\n      g.beginFill(0xc9ecff, Math.max(0, alpha));\n      g.drawCircle(d.x, d.y, size);\n      g.endFill();\n      if (d.life >= d.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.droplets.splice(i, 1);\n      }\n    }\n    // Rings update\n    for (let i = this.rings.length - 1; i >= 0; i--) {\n      const r = this.rings[i];\n      r.life += dt;\n      r.r += r.vr * dt;\n      const t = Math.min(1, r.life / r.max);\n      const alpha = 0.6 * (1 - t);\n      const g = r.g; g.clear();\n      g.lineStyle({ width: 1.5, color: 0xc9ecff, alpha: Math.max(0, alpha) });\n      g.drawCircle(r.x, r.y, r.r);\n      if (r.life >= r.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.rings.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaEmbers: ambient embers with tiny smoke trails spawning from lava surface tiles\n// API:\n//   const fx = new LavaEmbers(container, api, getIntensity)\n//   fx.setIntensity(v)\n//   fx.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems })\n//   fx.update(dtMs)\n//   fx.resize(w,h)\n//   fx.destroy()\nexport default class LavaEmbers {\n  constructor(container, api, getIntensity) {\n    this.container = container;\n    this.api = api || {};\n    this.getIntensity = getIntensity || (() => 0);\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.intensity = 0;\n    this.time = 0;\n    this.spawnAcc = 0;\n    this.embers = []; // {g,x,y,vx,vy,life,max,trail}\n    this.maxEmbers = 60;\n    this.surfaces = []; // {x,y,w}\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.embers = [];\n    this.surfaces = [];\n  }\n\n  setIntensity(v) {\n    const nv = Math.max(0, Math.min(100, Number(v) || 0));\n    this.intensity = nv;\n  }\n\n  resize() {}\n\n  rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    const getDef = (id) => Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n    const isLava = (def) => !!(def && def.flags && def.flags.lava);\n    const W = mapWidth, H = mapHeight, TS = tileSize;\n    const spans = [];\n    for (let gy = 0; gy < H; gy++) {\n      let runStart = -1;\n      for (let gx = 0; gx < W; gx++) {\n        const idx = gy * W + gx;\n        const id = tileMapData[idx];\n        if (!id) { if (runStart !== -1) { runStart = -1; } continue; }\n        const def = getDef(id);\n        const aboveIdx = (gy - 1) * W + gx;\n        const aboveLava = gy > 0 && isLava(getDef(tileMapData[aboveIdx]));\n        const hereLava = isLava(def);\n        const isSurface = hereLava && !aboveLava;\n        if (isSurface) {\n          if (runStart === -1) runStart = gx;\n        } else {\n          if (runStart !== -1) {\n            const w = (gx - runStart) * TS;\n            if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n            runStart = -1;\n          }\n        }\n      }\n      if (runStart !== -1) {\n        const w = (W - runStart) * TS;\n        if (w > 0) spans.push({ x: runStart * TS, y: gy * TS, w });\n      }\n    }\n    this.surfaces = spans;\n  }\n\n  _spawnOne() {\n    if (!this.surfaces.length) return;\n    if (this.embers.length >= this.maxEmbers) return;\n    const s = this.surfaces[Math.floor(Math.random() * this.surfaces.length)];\n    const x = s.x + Math.random() * s.w;\n    const y = s.y - 2; // just above surface\n    const g = new Graphics();\n    this.node.addChild(g);\n    const vx = (Math.random() - 0.5) * 0.02; // small horizontal drift\n    const vy = -0.05 - Math.random() * 0.06; // initial upward\n    const life = 0; const max = 1200 + Math.random() * 1200; // 1.2..2.4s\n    this.embers.push({ g, x, y, vx, vy, life, max, trail: [] });\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    // live intensity\n    const cur = Math.max(0, Math.min(100, this.getIntensity()))\n    this.setIntensity(cur);\n    if (this.intensity <= 0) return;\n\n    // Spawn rate depends on intensity and surface count\n    const baseRate = 0.0015 + 0.0035 * (this.intensity / 100); // embers per ms\n    const mult = Math.max(0.5, Math.min(3, this.surfaces.length / 6));\n    this.spawnAcc += dt * baseRate * mult;\n    while (this.spawnAcc >= 1) {\n      this._spawnOne();\n      this.spawnAcc -= 1;\n    }\n\n    // Update embers\n    for (let i = this.embers.length - 1; i >= 0; i--) {\n      const e = this.embers[i];\n      e.life += dt;\n      // motion: rise then fall slightly\n      e.vy += 0.00006 * dt; // gravity slowly pulls down\n      e.x += e.vx * dt;\n      e.y += e.vy * dt;\n      // record simple smoke trail points\n      if (e.trail.length < 14) e.trail.push({ x: e.x, y: e.y });\n      else { e.trail.shift(); e.trail.push({ x: e.x, y: e.y }); }\n\n      const t = Math.min(1, e.life / e.max);\n      const emberAlpha = 1 - t;\n      const emberSize = 1 + 1.5 * (1 - t);\n      const g = e.g; g.clear();\n      // smoke trail (fainter)\n      g.lineStyle({ width: 1, color: 0x555555, alpha: 0.25 * emberAlpha });\n      for (let k = 1; k < e.trail.length; k++) {\n        const p0 = e.trail[k - 1]; const p1 = e.trail[k];\n        g.moveTo(p0.x, p0.y);\n        g.lineTo(p1.x, p1.y);\n      }\n      // glowing ember\n      g.beginFill(0xffa229, 0.9 * emberAlpha);\n      g.drawCircle(e.x, e.y, emberSize);\n      g.endFill();\n\n      if (e.life >= e.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.embers.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics } from 'pixi.js';\n\n// LavaSteamFX: tiny steam puffs when rain/snow hits lava surface\n// API:\n//   const steam = new LavaSteamFX(parentContainer)\n//   steam.trigger({ x, y, strength })\n//   steam.update(dtMs)\n//   steam.destroy()\nexport default class LavaSteamFX {\n  constructor(container) {\n    this.container = container;\n    this.node = new Container();\n    this.container.addChild(this.node);\n    this.puffs = []; // {g,x,y,vx,vy,life,max,r}\n    this.maxPuffs = 80;\n  }\n\n  destroy() {\n    try { this.node.parent && this.node.parent.removeChild(this.node); } catch {}\n    try { this.node.destroy({ children: true }); } catch {}\n    this.node = null;\n    this.puffs = [];\n  }\n\n  resize() {}\n\n  trigger({ x = 0, y = 0, strength = 0.7 } = {}) {\n    const s = Math.max(0.2, Math.min(2.5, Number(strength) || 0.7));\n    const count = Math.max(2, Math.floor(3 + 4 * s));\n    for (let i = 0; i < count && this.puffs.length < this.maxPuffs; i++) {\n      const g = new Graphics();\n      this.node.addChild(g);\n      const vx = (Math.random() - 0.5) * (0.03 + 0.03 * s);\n      const vy = -(0.08 + Math.random() * 0.08) * (0.8 + 0.4 * s);\n      const r = 1.5 + Math.random() * (2.5 * s);\n      const max = 450 + Math.random() * 350;\n      this.puffs.push({ g, x, y: y - 2, vx, vy, life: 0, max, r });\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    for (let i = this.puffs.length - 1; i >= 0; i--) {\n      const p = this.puffs[i];\n      p.life += dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      // slight expansion and fade\n      const t = Math.min(1, p.life / p.max);\n      const alpha = 0.75 * (1 - t);\n      const radius = p.r * (1 + 0.8 * t);\n      const g = p.g; g.clear();\n      // soft grey-white steam\n      g.beginFill(0xdfdad2, Math.max(0, alpha));\n      g.drawCircle(p.x, p.y, radius);\n      g.endFill();\n      if (p.life >= p.max) {\n        try { g.parent && g.parent.removeChild(g); } catch {}\n        try { g.destroy(); } catch {}\n        this.puffs.splice(i, 1);\n      }\n    }\n  }\n}\n","import { Container, Graphics, Texture, TilingSprite } from 'pixi.js';\n\n// LiquidRegionSystem: groups contiguous liquid tiles (water/lava) into regions\n// and renders each region as a masked, animated tiling surface (weather-like style)\n// while constrained to the exact sector (region) shape.\n//\n// API:\n//   const sys = new LiquidRegionSystem(parentContainer, { mapWidth, mapHeight, tileSize });\n//   sys.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n//   sys.update(dtMs);\n//   sys.resize(mapWidth, mapHeight, tileSize);\n//   sys.destroy();\n\nexport default class LiquidRegionSystem {\n  constructor(container, opts = {}) {\n    this.container = container;\n    this.mapWidth = opts.mapWidth || 0;\n    this.mapHeight = opts.mapHeight || 0;\n    this.tileSize = opts.tileSize || 32;\n    this._regions = []; // { type, node, mask, sprite, noise1, noise2, capG, topEdges, waves:[] }\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._time = 0;\n    this._noiseTex = null;\n    this._playerState = null; // Will be set from PixiStage\n  }\n\n  setPlayerState(playerState) {\n    this._playerState = playerState;\n  }\n\n  _checkPlayerInRegion(region) {\n    if (!this._playerState || !region || !region.node) return false;\n    const p = this._playerState;\n    const px = p.x || 0;\n    const py = p.y || 0;\n    const pw = p.width || 32;\n    const ph = p.height || 32;\n    // Simple AABB check against region bounds\n    const b = region.node.getBounds();\n    return (px + pw > b.x && px < b.x + b.width && py + ph > b.y && py < b.y + b.height);\n  }\n\n  // Query approximate surface Y (pixel) for a given X within liquid regions of type ('water'|'lava')\n  getSurfaceY(type, x) {\n    if (!Array.isArray(this._regions) || this._regions.length === 0) return null;\n    const X = Math.max(0, Math.floor(Number(x) || 0));\n    for (const r of this._regions) {\n      if (r.type !== type) continue;\n      if (!Array.isArray(r.topEdges)) continue;\n      for (let i = 0; i < r.topEdges.length; i++) {\n        const e = r.topEdges[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          return e.y; // region tile top in pixels\n        }\n      }\n    }\n    return null;\n  }\n\n  destroy() {\n    try {\n      for (const r of this._regions) {\n        try { if (r.node && r.node.parent) r.node.parent.removeChild(r.node); } catch {}\n        try { r.node?.destroy({ children: true }); } catch {}\n      }\n    } catch {}\n    this._regions = [];\n    try { this._waterTex?.destroy(true); } catch {}\n    try { this._lavaTex?.destroy(true); } catch {}\n    try { this._noiseTex?.destroy(true); } catch {}\n    this._waterTex = null;\n    this._lavaTex = null;\n    this._noiseTex = null;\n  }\n\n  clear() {\n    for (const r of this._regions) {\n      try { r.node?.parent && r.node.parent.removeChild(r.node); } catch {}\n      try { r.node?.destroy({ children: true }); } catch {}\n    }\n    this._regions = [];\n  }\n\n  resize(mapWidth, mapHeight, tileSize) {\n    const mw = Math.max(1, mapWidth | 0);\n    const mh = Math.max(1, mapHeight | 0);\n    const ts = Math.max(1, tileSize | 0);\n    const changed = mw !== this.mapWidth || mh !== this.mapHeight || ts !== this.tileSize;\n    this.mapWidth = mw; this.mapHeight = mh; this.tileSize = ts;\n    if (changed) {\n      // rebuild textures at new tile size; regions will be rebuilt by caller\n      try { this._waterTex?.destroy(true); } catch {}\n      try { this._lavaTex?.destroy(true); } catch {}\n      this._waterTex = null; this._lavaTex = null;\n    }\n  }\n\n  update(dtMs) {\n    const dt = Math.max(0, Number(dtMs) || 16.67);\n    this._time += dt;\n    // Gentle drift speeds (px/ms) per liquid type\n    const waterDrift = { x: 0.010, y: 0.004 };\n    const lavaDrift = { x: -0.012, y: 0.006 };\n    for (const r of this._regions) {\n      const sprite = r.sprite;\n      if (!sprite) continue;\n      const drift = r.type === 'lava' ? lavaDrift : waterDrift;\n      sprite.tilePosition.x += drift.x * dt;\n      sprite.tilePosition.y += drift.y * dt;\n      // Alpha: normally opaque, but becomes transparent when player is inside!\n      // (We'll detect player position and adjust alpha accordingly)\n      if (r.type === 'water') {\n        // Check if player is in this water region (simplified check)\n        const playerInRegion = this._checkPlayerInRegion(r);\n        if (playerInRegion) {\n          sprite.alpha = 0.50; // Transparent when player is inside - can see player/items!\n        } else {\n          sprite.alpha = 0.95; // Opaque when player is outside\n        }\n      } else {\n        // Lava\n        const playerInRegion = this._checkPlayerInRegion(r);\n        if (playerInRegion) {\n          sprite.alpha = 0.60; // Transparent when player is inside\n        } else {\n          sprite.alpha = 0.95; // Opaque when player is outside\n        }\n      }\n\n      // Animate noise overlays to break repetition\n      if (r.noise1) {\n        r.noise1.tilePosition.x += drift.x * 1.6 * dt;\n        r.noise1.tilePosition.y += drift.y * 1.2 * dt;\n      }\n      if (r.noise2) {\n        r.noise2.tilePosition.x += -drift.x * 1.1 * dt;\n        r.noise2.tilePosition.y += drift.y * 0.9 * dt;\n      }\n\n      // Update interactive surface waves (small ripples from impacts)\n      if (!Array.isArray(r.waves)) r.waves = [];\n      if (r.waves.length) {\n        for (let i = r.waves.length - 1; i >= 0; i--) {\n          const w = r.waves[i];\n          w.t += dt; // ms\n          // Lifetimes: water longer than lava\n          const life = r.type === 'water' ? w.lifeMsWater : w.lifeMsLava;\n          if (w.t >= life) { r.waves.splice(i, 1); continue; }\n          // expand radius over time (px)\n          w.radius = w.startRadius + w.speed * (w.t / 1000);\n          // exponential decay of amplitude\n          const decay = Math.exp(-w.t / (r.type === 'water' ? 1400 : 900));\n          w.ampNow = w.amp * decay;\n        }\n      }\n\n      // Animate water surface cap (rim light) with slight sine undulation\n      if (r.type === 'water' && r.capG && Array.isArray(r.topEdges) && r.topEdges.length) {\n        const g = r.capG;\n        const amp = Math.max(1, Math.floor(this.tileSize * 0.06));\n        const thickness = Math.max(1, Math.floor(this.tileSize * 0.08));\n        g.clear();\n        g.beginFill(0xc9ecff, 0.35);\n        for (let i = 0; i < r.topEdges.length; i++) {\n          const e = r.topEdges[i];\n          // slight vertical offset wave\n          let dy = Math.sin((this._time * 0.002) + e.x * 0.15) * (amp * 0.5);\n          // Add contributions from interactive waves (Gaussian falloff)\n          if (r.waves && r.waves.length) {\n            // use span center for sampling; keeps draw perf O(spans + waves)\n            const centerX = e.x + e.w * 0.5;\n            for (let k = 0; k < r.waves.length; k++) {\n              const w = r.waves[k];\n              const dx = centerX - w.cx;\n              const dist = Math.abs(dx);\n              if (dist > w.radius + e.w * 0.6) continue; // early reject\n              const sigma = Math.max(8, w.radius * 0.6);\n              const gauss = Math.exp(-(dx * dx) / (2 * sigma * sigma));\n              dy += w.ampNow * gauss;\n            }\n            // clamp to avoid excessive displacement\n            const maxDisp = Math.max(2, this.tileSize * 0.22);\n            if (dy > maxDisp) dy = maxDisp;\n            if (dy < -maxDisp) dy = -maxDisp;\n          }\n          g.drawRect(e.x, e.y - thickness + dy, e.w, thickness);\n        }\n        g.endFill();\n      }\n    }\n  }\n\n  build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }) {\n    if (!Array.isArray(tileMapData) || !Array.isArray(registryItems)) return;\n    this.resize(mapWidth, mapHeight, tileSize);\n    this.clear();\n\n    const W = this.mapWidth;\n    const H = this.mapHeight;\n    const TS = this.tileSize;\n    const count = W * H;\n\n    const getDef = (id) => registryItems.find((r) => r.id === id);\n    const typeAt = (i) => {\n      const id = tileMapData[i];\n      if (!id) return null;\n      const def = getDef(id);\n      if (!def || !def.flags || !def.flags.liquid) return null;\n      if (def.flags.water) return 'water';\n      if (def.flags.lava) return 'lava';\n      return 'liquid';\n    };\n\n    const visited = new Uint8Array(count);\n    const dirs = [1, -1, W, -W]; // 4-connectivity\n\n    for (let i = 0; i < count; i++) {\n      if (visited[i]) continue;\n      const t = typeAt(i);\n      if (!t) { visited[i] = 1; continue; }\n\n      // Flood fill this region for same liquid type\n      const regionTiles = [];\n      const queue = [i];\n      visited[i] = 1;\n      while (queue.length) {\n        const idx = queue.pop();\n        regionTiles.push(idx);\n        for (let d = 0; d < 4; d++) {\n          const n = idx + dirs[d];\n          if (n < 0 || n >= count) continue;\n          if (visited[n]) continue;\n          // prevent wrapping on left/right when using +/-1\n          if (d < 2) {\n            const row = Math.floor(idx / W);\n            const nrow = Math.floor(n / W);\n            if (row !== nrow) continue;\n          }\n          const nt = typeAt(n);\n          if (nt === t) { visited[n] = 1; queue.push(n); }\n          else { visited[n] = visited[n] || 0; }\n        }\n      }\n\n      if (regionTiles.length === 0) continue;\n      this._addRegion(t, regionTiles, W, H, TS);\n    }\n  }\n\n  _addRegion(type, tileIndices, mapWidth, mapHeight, tileSize) {\n    const node = new Container();\n    const mask = new Graphics();\n    const worldW = mapWidth * tileSize;\n    const worldH = mapHeight * tileSize;\n\n    // Draw mask as union of tile rects (grid-aligned)\n    // To avoid hairline gaps between rows/columns due to AA/subpixel sampling,\n    // slightly expand each rect by a small bleed so neighbors overlap.\n    mask.clear();\n    mask.beginFill(0xffffff, 1);\n    const bleed = 0.5; // px\n    for (let k = 0; k < tileIndices.length; k++) {\n      const idx = tileIndices[k];\n      const gx = (idx % mapWidth);\n      const gy = Math.floor(idx / mapWidth);\n      mask.drawRect(\n        gx * tileSize - bleed,\n        gy * tileSize - bleed,\n        tileSize + bleed * 2,\n        tileSize + bleed * 2\n      );\n    }\n    mask.endFill();\n\n    const tex = type === 'lava' ? (this._lavaTex || (this._lavaTex = this._createLavaTexture(tileSize)))\n                                 : (this._waterTex || (this._waterTex = this._createWaterTexture(tileSize)));\n    const tiling = new TilingSprite(tex, worldW, worldH);\n    tiling.tileScale.set(1, 1);\n    tiling.alpha = type === 'lava' ? 0.98 : 0.92;\n    // Ensure integer placement to reduce sampling seams\n    tiling.x = 0; tiling.y = 0;\n\n    // Constrain fill to region mask\n    node.addChild(tiling);\n    // Add subtle noise overlays to break repetition\n    const noiseTex = this._noiseTex || (this._noiseTex = this._createNoiseTexture(128, 128));\n    const noise1 = new TilingSprite(noiseTex, worldW, worldH);\n    const noise2 = new TilingSprite(noiseTex, worldW, worldH);\n    // Different scales/alphas per liquid\n    if (type === 'water') {\n      noise1.tileScale.set(0.9, 1.1);\n      noise2.tileScale.set(0.6, 0.7);\n      noise1.alpha = 0.06; noise2.alpha = 0.08;\n    } else {\n      noise1.tileScale.set(1.2, 0.9);\n      noise2.tileScale.set(0.7, 0.6);\n      noise1.alpha = 0.08; noise2.alpha = 0.12;\n    }\n    node.addChild(noise1);\n    node.addChild(noise2);\n\n    node.addChild(mask);\n    node.mask = mask;\n\n    // Water surface rim highlight along top edges of the region\n    let capG = null;\n    let topEdges = null;\n    if (type === 'water') {\n      capG = new Graphics();\n      node.addChild(capG);\n      topEdges = this._computeTopEdgeSpans(tileIndices, mapWidth, tileSize);\n    }\n\n    this.container.addChild(node);\n    this._regions.push({ type, node, mask, sprite: tiling, noise1, noise2, capG, topEdges, waves: [] });\n  }\n\n  _createWaterTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = tileSize * 2;\n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid BLUE gradient base\n    const g = ctx.createLinearGradient(0, 0, 0, size);\n    g.addColorStop(0, '#5ba3d9');     // bright blue top\n    g.addColorStop(0.5, '#3a7fb8');   // medium blue\n    g.addColorStop(1, '#2a5d8f');     // darker blue bottom\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, size, size);\n\n    // Simple noise function for organic look\n    const noise = (x, y, scale) => {\n      const val = Math.sin(x * scale) * Math.cos(y * scale * 1.3) +\n                  Math.sin(x * scale * 2.1 + 1.7) * Math.cos(y * scale * 1.7 + 2.3);\n      return (val + 2) / 4; // 0..1\n    };\n\n    // Add subtle organic pattern with noise (no obvious horizontal lines)\n    const imageData = ctx.getImageData(0, 0, size, size);\n    const data = imageData.data;\n    for (let y = 0; y < size; y++) {\n      for (let x = 0; x < size; x++) {\n        const idx = (y * size + x) * 4;\n        const n = noise(x, y, 0.05);\n        // Subtle brightness variation\n        const brightness = 0.95 + n * 0.1;\n        data[idx] = Math.min(255, data[idx] * brightness);     // R\n        data[idx + 1] = Math.min(255, data[idx + 1] * brightness); // G\n        data[idx + 2] = Math.min(255, data[idx + 2] * brightness); // B\n      }\n    }\n    ctx.putImageData(imageData, 0, 0);\n\n    // Top shimmer - very subtle\n    ctx.globalAlpha = 0.15;\n    const shimmer = ctx.createLinearGradient(0, 0, 0, size * 0.2);\n    shimmer.addColorStop(0, '#a8d8f0');\n    shimmer.addColorStop(1, 'rgba(168, 216, 240, 0)');\n    ctx.fillStyle = shimmer;\n    ctx.fillRect(0, 0, size, size * 0.2);\n\n    return Texture.from(canvas);\n  }\n\n  _createLavaTexture(tileSize) {\n    const canvas = document.createElement('canvas');\n    const size = tileSize * 2;\n    canvas.width = size; canvas.height = size;\n    const ctx = canvas.getContext('2d');\n\n    // Solid ORANGE gradient - ember color (#ffa229)!\n    const g = ctx.createLinearGradient(0, 0, 0, size);\n    g.addColorStop(0, '#ffb84d');     // bright orange top\n    g.addColorStop(0.5, '#ffa229');   // EMBER ORANGE - main color\n    g.addColorStop(1, '#d94f14');     // darker orange bottom\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, size, size);\n\n    // Simple noise function for organic flow\n    const noise = (x, y, scale) => {\n      const val = Math.sin(x * scale * 0.8) * Math.cos(y * scale * 1.5) +\n                  Math.sin(x * scale * 1.9 + 2.1) * Math.cos(y * scale * 1.3 + 1.7);\n      return (val + 2) / 4; // 0..1\n    };\n\n    // Add organic pattern with noise - no horizontal lines!\n    const imageData = ctx.getImageData(0, 0, size, size);\n    const data = imageData.data;\n    for (let y = 0; y < size; y++) {\n      for (let x = 0; x < size; x++) {\n        const idx = (y * size + x) * 4;\n        const n1 = noise(x, y, 0.06);\n        const n2 = noise(x * 1.3, y * 0.7, 0.04);\n        // Combine noise for flowing veins effect\n        const brightness = 0.9 + n1 * 0.15 + n2 * 0.1;\n        data[idx] = Math.min(255, data[idx] * brightness);     // R\n        data[idx + 1] = Math.min(255, data[idx + 1] * brightness); // G\n        data[idx + 2] = Math.min(255, data[idx + 2] * brightness); // B\n\n        // Add bright spots where noise peaks\n        if (n1 > 0.7 && n2 > 0.6) {\n          const glow = (n1 + n2 - 1.3) * 80;\n          data[idx] = Math.min(255, data[idx] + glow);\n          data[idx + 1] = Math.min(255, data[idx + 1] + glow * 0.7);\n          data[idx + 2] = Math.min(255, data[idx + 2] + glow * 0.3);\n        }\n      }\n    }\n    ctx.putImageData(imageData, 0, 0);\n\n    // Top surface glow - very subtle\n    ctx.globalAlpha = 0.2;\n    const surfaceGlow = ctx.createLinearGradient(0, 0, 0, size * 0.25);\n    surfaceGlow.addColorStop(0, '#ffed8a');\n    surfaceGlow.addColorStop(1, 'rgba(255, 237, 138, 0)');\n    ctx.fillStyle = surfaceGlow;\n    ctx.fillRect(0, 0, size, size * 0.25);\n\n    return Texture.from(canvas);\n  }\n\n  _createNoiseTexture(w = 128, h = 128) {\n    const canvas = document.createElement('canvas');\n    canvas.width = w; canvas.height = h;\n    const ctx = canvas.getContext('2d');\n    const img = ctx.createImageData(w, h);\n    for (let i = 0; i < img.data.length; i += 4) {\n      // soft noise around mid-high values\n      const v = 200 + Math.floor(Math.random() * 55); // 200..254\n      img.data[i] = v; img.data[i + 1] = v; img.data[i + 2] = v; img.data[i + 3] = 255;\n    }\n    ctx.putImageData(img, 0, 0);\n    return Texture.from(canvas);\n  }\n\n  // Given tile indices of a region, compute horizontal spans representing its top boundary per row.\n  _computeTopEdgeSpans(tileIndices, mapWidth, tileSize) {\n    // Build a set for O(1) membership\n    const set = new Set(tileIndices);\n    const spans = [];\n    // For each tile that has no neighbor directly above, create a span; merge contiguous tiles in that row\n    const tilesByRow = new Map();\n    for (const idx of tileIndices) {\n      const gy = Math.floor(idx / mapWidth);\n      const gx = idx % mapWidth;\n      const above = idx - mapWidth;\n      if (!set.has(above)) {\n        // This tile contributes to the top edge\n        const rowList = tilesByRow.get(gy) || [];\n        rowList.push(gx);\n        tilesByRow.set(gy, rowList);\n      }\n    }\n    // Merge contiguous gx into spans\n    for (const [gy, cols] of tilesByRow.entries()) {\n      cols.sort((a, b) => a - b);\n      let start = null; let prev = null;\n      for (const gx of cols) {\n        if (start === null) { start = gx; prev = gx; continue; }\n        if (gx === prev + 1) { prev = gx; continue; }\n        // flush previous span\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n        start = gx; prev = gx;\n      }\n      if (start !== null) {\n        spans.push({ x: start * tileSize, y: gy * tileSize, w: (prev - start + 1) * tileSize });\n      }\n    }\n    return spans;\n  }\n\n  // Public: add a ripple/wave on a liquid surface of given type at world x\n  // type: 'water'|'lava'\n  // x: world pixel X\n  // strength: 0.2..3 roughly; maps to amplitude and speed\n  addWave(type, x, strength = 1) {\n    const t = (type === 'lava') ? 'lava' : 'water';\n    const X = Math.max(0, Math.min(this.mapWidth * this.tileSize, Number(x) || 0));\n    // Find region and a top edge span containing x\n    for (const r of this._regions) {\n      if (r.type !== t) continue;\n      const spans = r.topEdges;\n      if (!Array.isArray(spans) || spans.length === 0) continue;\n      for (let i = 0; i < spans.length; i++) {\n        const e = spans[i];\n        if (X >= e.x && X <= e.x + e.w) {\n          if (!Array.isArray(r.waves)) r.waves = [];\n          // Cap total waves to keep perf stable\n          if (r.waves.length > 24) r.waves.shift();\n          const ts = this.tileSize;\n          const s = Math.max(0.15, Math.min(3, Number(strength) || 1));\n          const baseAmp = (t === 'water') ? ts * 0.18 : ts * 0.10; // pixels\n          const amp = baseAmp * (0.4 + 0.6 * Math.min(1.0, s));\n          const speed = (t === 'water') ? (40 + 60 * s) : (30 + 40 * s); // px/s growth\n          const startRadius = Math.max(4, ts * 0.2);\n          // lifetimes in ms\n          const lifeMsWater = 1600 + 900 * s;\n          const lifeMsLava = 900 + 600 * s;\n          r.waves.push({ cx: X, t: 0, amp, ampNow: amp, speed, radius: startRadius, startRadius, lifeMsWater, lifeMsLava });\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n}\n","// Lightweight reusable health bar for PixiJS\n// Usage:\n//   import { HealthBar } from './HealthBar';\n//   const hb = new HealthBar({ width: 32, height: 4, offsetY: -6 });\n//   container.addChild(hb);\n//   hb.update(currentHealth, maxHealth);\n\nimport { Container, Graphics } from 'pixi.js';\n\nexport class HealthBar extends Container {\n  constructor(options = {}) {\n    super();\n    const {\n      width = 32,\n      height = 4,\n      offsetX = 0,\n      offsetY = -6,\n      thresholds = { warn: 0.55, danger: 0.35 },\n      colors = { ok: 0x2ecc71, warn: 0xf1c40f, danger: 0xe74c3c },\n      // Use a neutral gray track instead of near-black; keep border options for backward compat (unused)\n      trackColor = 0x666666,\n      borderColor = 0x000000,\n      borderAlpha = 0.8,\n    } = options;\n\n    this._w = Math.max(4, Math.floor(width));\n    this._h = Math.max(2, Math.floor(height));\n    this._pct = -1; // force first draw\n    this._color = 0xffffff;\n    this._thresholds = thresholds;\n    this._colors = colors;\n    this._trackColor = trackColor;\n    this._borderColor = borderColor;\n    this._borderAlpha = borderAlpha;\n\n    this.x = offsetX || 0;\n    this.y = offsetY || 0;\n\n    this._track = new Graphics();\n    this._fill = new Graphics();\n    this.addChild(this._track);\n    this.addChild(this._fill);\n\n    this._redrawAll();\n  }\n\n  resize(width, height) {\n    const w = Math.max(4, Math.floor(width || this._w));\n    const h = Math.max(2, Math.floor(height || this._h));\n    if (w === this._w && h === this._h) return;\n    this._w = w; this._h = h;\n    this._redrawAll();\n  }\n\n  update(current, max) {\n    const m = Math.max(0, Number(max) || 0);\n    if (m <= 0 || !Number.isFinite(current)) {\n      this.visible = false;\n      return;\n    }\n    const c = Math.max(0, Math.min(m, Number(current)));\n    const pct = m > 0 ? c / m : 0;\n    this.visible = true;\n\n    const color = pct < this._thresholds.danger\n      ? this._colors.danger\n      : (pct < this._thresholds.warn ? this._colors.warn : this._colors.ok);\n\n    // Only redraw fill if percent or color changed noticeably\n    if (Math.abs(pct - this._pct) > 0.001 || color !== this._color) {\n      this._pct = pct;\n      this._color = color;\n      this._redrawFill();\n    }\n  }\n\n  _redrawAll() {\n    // Track (no border)\n    const w = this._w, h = this._h;\n    this._track.clear();\n    this._track.beginFill(this._trackColor, 0.85);\n    this._track.drawRoundedRect(0, 0, w, h, Math.min(3, h * 0.5));\n    this._track.endFill();\n    // Redraw fill with current state\n    this._redrawFill();\n  }\n\n  _redrawFill() {\n    const w = this._w, h = this._h;\n    const innerW = Math.max(0, Math.floor(w * Math.max(0, Math.min(1, this._pct))));\n    const radius = Math.min(2, Math.floor(h / 2));\n    this._fill.clear();\n    if (innerW <= 0) return;\n    this._fill.beginFill(this._color, 1);\n    // Draw flush with track (no border/padding)\n    this._fill.drawRoundedRect(0, 0, innerW, h, radius);\n    this._fill.endFill();\n  }\n}\n\nexport default HealthBar;\n","// Centralized z-order constants for Pixi stage layers\n// Higher numbers render above lower numbers when sortableChildren = true\nexport const LAYERS = Object.freeze({\n  parallax: 10,\n  objBehind: 20,\n  secretsBelow: 25, // secret overlays below player\n  player: 30,\n  projectiles: 40,\n  objFront: 50,\n  secretsAbove: 55, // secret overlays above player\n  weather: 60,\n  fog: 70,\n  liquids: 80,\n  liquidFx: 90,\n  tiles: 100,\n  tilesAnim: 110,\n  overlay: 120,\n});\n\nexport default LAYERS;\n","import { Texture } from 'pixi.js';\n\n// Small helper cache for textures\nconst textureCacheMap = new Map();\n\nexport const getTexture = (url) => {\n  if (!url) {\n    console.warn('[getTexture] No URL provided');\n    return null;\n  }\n  if (textureCacheMap.has(url)) {\n    return textureCacheMap.get(url);\n  }\n  try {\n    const tex = Texture.from(url);\n    if (!tex) {\n      console.warn('[getTexture] Failed to create texture from URL:', url);\n      return null;\n    }\n    textureCacheMap.set(url, tex);\n    return tex;\n  } catch (e) {\n    console.error('[getTexture] Error creating texture:', url, e);\n    return null;\n  }\n};\n\nexport const clearTextureCache = () => {\n  textureCacheMap.forEach((t) => t.destroy && t.destroy(true));\n  textureCacheMap.clear();\n};\n\n// Background images resolver (from src/assets/background)\n// Meta stores `/assets/background/<name>`\nexport const createBackgroundResolver = () => {\n  let bgContext;\n  try {\n    // webpack require.context (CRA)\n    // relative to this file: '../../../../assets/background'\n    bgContext = require.context('../../../../assets/background', false, /\\.(png|jpe?g|svg)$/);\n  } catch (e) {\n    bgContext = null;\n  }\n\n  return (metaPath) => {\n    if (!bgContext) {\n      console.warn('[BackgroundResolver] No bgContext available');\n      return null;\n    }\n    if (!metaPath) {\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n    const name = metaPath.split('/').pop();\n    const rel = `./${name}`;\n    try {\n      const mod = bgContext(rel);\n      return mod.default || mod;\n    } catch (e) {\n      // fallback to first available\n      const keys = bgContext.keys();\n      if (keys && keys.length) {\n        const mod = bgContext(keys[0]);\n        return mod.default || mod;\n      }\n      return null;\n    }\n  };\n};\n\n// Convert ms-per-frame (JSON) to Pixi AnimatedSprite speed factor (1 = 60fps)\nexport const msToSpeed = (ms) => {\n  const m = Number(ms);\n  const msPerFrame = Number.isFinite(m) && m > 0 ? m : 500;\n  const fps = 1000 / msPerFrame;\n  return fps / 60; // Pixi speed factor\n};\n\n// Helper to get registry item by id\nexport const getRegItem = (registryItems, id) => registryItems.find((r) => r.id === id);\n\n// Solid collision helper for world tiles (used by weather systems)\nexport const createSolidChecker = (mapWidth, mapHeight, tileSize, tileMapData, registryItems) => {\n  return (wx, wy) => {\n    // Allow particles (snow/rain) to spawn above the top edge and fall into the world.\n    // Negative Y should NOT be treated as solid, otherwise flakes will \"settle\" off-screen.\n    if (wy < 0) return false;\n    // Keep left-of-world as solid to avoid pushing from outside horizontally.\n    if (wx < 0) return true;\n    const gx = Math.floor(wx / tileSize);\n    const gy = Math.floor(wy / tileSize);\n    if (gx < 0 || gy < 0 || gx >= mapWidth || gy >= mapHeight) return false; // below world is not solid\n    const idx = gy * mapWidth + gx;\n    const id = tileMapData[idx];\n    if (!id) return false;\n    const def = getRegItem(registryItems, id);\n    if (!def) return false;\n    const c = def.collision;\n    if (!c) return false;\n    if (c === true) return true;\n    if (typeof c === 'object') {\n      return !!(c.top || c.bottom || c.left || c.right);\n    }\n    return false;\n  };\n};\n","import { Texture } from 'pixi.js';\n\n// Generate procedural water frames (cached per tile size)\nexport const createWaterFrames = (tileSize) => {\n  const frames = [];\n  const F = 8; // frame count\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // background gradient\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#2a5d8f');\n    g.addColorStop(1, '#174369');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // animated ripples via sine stripes\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#8fc0ff';\n    const t = i / F;\n    const bands = 3;\n    for (let b = 0; b < bands; b++) {\n      const y = Math.floor((tileSize / bands) * b + (tileSize / bands) * 0.5 + Math.sin((t + b * 0.33) * Math.PI * 2) * (tileSize * 0.08));\n      ctx.fillRect(0, y, tileSize, Math.max(1, Math.floor(tileSize * 0.06)));\n    }\n\n    // soft top highlight\n    ctx.globalAlpha = 0.18;\n    ctx.fillStyle = '#c9ecff';\n    ctx.fillRect(0, 0, tileSize, Math.max(1, Math.floor(tileSize * 0.12)));\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Generate procedural lava frames (cached per tile size)\nexport const createLavaFrames = (tileSize) => {\n  const frames = [];\n  const F = 8;\n  for (let i = 0; i < F; i++) {\n    const canvas = document.createElement('canvas');\n    canvas.width = tileSize;\n    canvas.height = tileSize;\n    const ctx = canvas.getContext('2d');\n\n    // base gradient (dark red to orange)\n    const g = ctx.createLinearGradient(0, 0, 0, tileSize);\n    g.addColorStop(0, '#6b1a07');\n    g.addColorStop(1, '#c43f0f');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, tileSize, tileSize);\n\n    // glowing veins\n    const t = i / F;\n    ctx.globalAlpha = 0.3;\n    for (let b = 0; b < 3; b++) {\n      const y = Math.floor((tileSize / 3) * b + (tileSize / 3) * 0.5 + Math.sin((t * 2 + b * 0.6) * Math.PI * 2) * (tileSize * 0.1));\n      const h = Math.max(1, Math.floor(tileSize * 0.07));\n      const grad = ctx.createLinearGradient(0, y, 0, y + h);\n      grad.addColorStop(0, '#ffed8a');\n      grad.addColorStop(1, '#ff7b00');\n      ctx.fillStyle = grad;\n      ctx.fillRect(0, y, tileSize, h);\n    }\n\n    // bubbles/dots\n    ctx.globalAlpha = 0.25;\n    ctx.fillStyle = '#ffd36e';\n    const count = Math.max(2, Math.floor(tileSize * 0.12));\n    for (let k = 0; k < count; k++) {\n      const rx = Math.floor((k * 37 + i * 13) % tileSize);\n      const ry = Math.floor((k * 53 + i * 29) % tileSize);\n      ctx.fillRect(rx, ry, 1, 1);\n    }\n\n    const tex = Texture.from(canvas);\n    frames.push(tex);\n  }\n  return frames;\n};\n\n// Helpers to check if a definition is water or lava\nexport const isWaterDef = (def) => !!(def && def.flags && def.flags.water);\nexport const isLavaDef = (def) => !!(def && def.flags && def.flags.lava);\n","import { TilingSprite, Sprite, Texture, WRAP_MODES, BlurFilter, Assets } from 'pixi.js';\n\n// Parallax background helper. Manages background layers (solid color and image).\nexport class ParallaxBackground {\n  constructor(container, textureCache) {\n    this.container = container;\n    this.cache = textureCache;\n    this.bgSprite = null; // Solid color layer\n    this.imgSprite = null; // Image layer\n    this._worldW = 0;\n    this._worldH = 0;\n    this._lastCameraX = 0;\n    this._currentUrl = null;\n  }\n\n  build({ worldWidth, worldHeight, url, color, factor = 0.3 }) {\n    if (!this.container) return;\n    this.clear();\n\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    this._currentUrl = url;\n\n    // 1. Render solid color background FIRST (always present as base)\n    const hex = (typeof color === 'string' && color.startsWith('#'))\n      ? parseInt(color.slice(1), 16)\n      : (Number(color) || 0x87CEEB);\n    \n    const solid = new Sprite(Texture.WHITE);\n    solid.tint = hex;\n    solid.width = worldWidth;\n    solid.height = worldHeight;\n    solid.alpha = 1.0;\n    try {\n      solid.filters = [new BlurFilter({ strength: 0.8, quality: 2 })];\n    } catch {}\n    this.container.addChild(solid);\n    this.bgSprite = solid;\n\n    // 2. If URL is provided, attempt to load and render image on top\n    if (url) {\n      const setupImage = (tex) => {\n        if (!this.container || this._currentUrl !== url) return;\n        \n        // Remove old image if any\n        if (this.imgSprite) {\n          try { this.container.removeChild(this.imgSprite); } catch {}\n          try { this.imgSprite.destroy(); } catch {}\n          this.imgSprite = null;\n        }\n\n        if (!tex) {\n          console.warn('[ParallaxBackground] setupImage called with no texture');\n          return;\n        }\n\n        // Fix wrap mode for tiling\n        if (tex.baseTexture) tex.baseTexture.wrapMode = WRAP_MODES.REPEAT;\n        if (tex.source) tex.source.addressMode = 'repeat';\n\n        const sprite = new TilingSprite({ texture: tex, width: worldWidth, height: worldHeight });\n        const texH = (tex.height || (tex.source ? tex.source.height : 0) || 1);\n        const scaleY = worldHeight / texH;\n        sprite.tileScale.set(1, scaleY);\n        sprite.alpha = 1.0;\n        try {\n          sprite.filters = [new BlurFilter({ strength: 1.2, quality: 2 })];\n        } catch {}\n        \n        this.container.addChild(sprite);\n        this.imgSprite = sprite;\n        this.setScroll(this._lastCameraX || 0, factor);\n      };\n\n      // Try to get from Assets cache or Texture cache\n      let tex = null;\n      try {\n        tex = Assets.get(url);\n      } catch (e) {\n        tex = this.cache?.get(url) || Texture.from(url);\n      }\n\n      const isValid = tex && (\n        tex.valid || \n        (tex.baseTexture && tex.baseTexture.valid) || \n        (tex.source && tex.source.width > 0)\n      );\n\n      if (isValid) {\n        console.log('[ParallaxBackground] Texture already ready');\n        setupImage(tex);\n      } else {\n        console.log('[ParallaxBackground] Texture not ready, loading via Assets.load...');\n        Assets.load(url).then((loadedTex) => {\n          console.log('[ParallaxBackground] Texture loaded via Assets.load');\n          setupImage(loadedTex);\n        }).catch(err => {\n          console.error('[ParallaxBackground] Failed to load background image:', url, err);\n        });\n      }\n    }\n  }\n\n  setScroll(cameraX, factor = 0.3) {\n    this._lastCameraX = cameraX;\n    if (this.imgSprite && 'tilePosition' in this.imgSprite) {\n      this.imgSprite.tilePosition.x = -cameraX * factor;\n      this.imgSprite.tilePosition.y = 0;\n    }\n  }\n\n  resize(worldWidth, worldHeight) {\n    this._worldW = worldWidth;\n    this._worldH = worldHeight;\n    if (this.bgSprite) {\n      this.bgSprite.width = worldWidth;\n      this.bgSprite.height = worldHeight;\n    }\n    if (this.imgSprite) {\n      this.imgSprite.width = worldWidth;\n      this.imgSprite.height = worldHeight;\n      const tex = this.imgSprite.texture;\n      const texH = (tex?.height || (tex?.source ? tex.source.height : 0) || 1);\n      if (this.imgSprite.tileScale && texH > 0) {\n        const scaleY = worldHeight / texH;\n        this.imgSprite.tileScale.set(1, scaleY);\n      }\n    }\n  }\n\n  clear() {\n    if (this.bgSprite) {\n      try { this.container.removeChild(this.bgSprite); } catch {}\n      try { this.bgSprite.destroy(); } catch {}\n      this.bgSprite = null;\n    }\n    if (this.imgSprite) {\n      try { this.container.removeChild(this.imgSprite); } catch {}\n      try { this.imgSprite.destroy(); } catch {}\n      this.imgSprite = null;\n    }\n  }\n\n  destroy() {\n    this.clear();\n    this.container = null;\n    this.cache = null;\n  }\n}\n","import { ParallaxBackground } from '../../../../Pixi/layers/ParallaxBackground';\n\n// Build or rebuild parallax background via helper\nexport const createParallaxManager = (parallaxLayer, textureCacheRef) => {\n  let parallaxHelper = null;\n  let parallaxSprite = null;\n\n  const build = (options) => {\n    const { worldWidth, worldHeight, url, color, factor, resolveBackgroundUrl } = options;\n\n    if (!parallaxHelper) {\n      parallaxHelper = new ParallaxBackground(parallaxLayer, textureCacheRef);\n    }\n\n    // Resolve URL and validate it exists\n    let resolvedUrl = null;\n    if (url) {\n      resolvedUrl = resolveBackgroundUrl ? resolveBackgroundUrl(url) : url;\n    }\n\n    // If no valid URL, pass null so ParallaxBackground uses solid color fallback\n    parallaxHelper.build({\n      worldWidth,\n      worldHeight,\n      url: resolvedUrl,\n      color: color || '#87CEEB',\n      factor: factor || 0.3,\n    });\n\n    parallaxSprite = parallaxHelper.imgSprite || parallaxHelper.bgSprite;\n  };\n\n  const setScroll = (cameraX, factor) => {\n    if (parallaxHelper) {\n      parallaxHelper.setScroll(cameraX, factor);\n    }\n  };\n\n  const destroy = () => {\n    if (parallaxHelper) {\n      try {\n        parallaxHelper.destroy();\n      } catch (e) {\n        // ignore\n      }\n      parallaxHelper = null;\n      parallaxSprite = null;\n    }\n  };\n\n  return {\n    build,\n    setScroll,\n    destroy,\n    get sprite() {\n      return parallaxHelper?.imgSprite || parallaxHelper?.bgSprite;\n    },\n    get helper() {\n      return parallaxHelper;\n    }\n  };\n};\n","import { Sprite, AnimatedSprite, Texture, Container } from 'pixi.js';\nimport { getTexture, msToSpeed } from './helpers';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\n\n// Build sprite from definition (static or animated)\nexport const buildSpriteFromDef = (def) => {\n  if (!def) return null;\n\n  let spr = null;\n  if (Array.isArray(def.textures) && def.textures.length > 1) {\n    const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n    if (frames.length > 0) {\n      spr = new AnimatedSprite(frames);\n      spr.animationSpeed = msToSpeed(def.animationSpeed);\n      spr.play();\n    }\n  }\n  if (!spr) {\n    const tex = getTexture(def.texture) || Texture.WHITE;\n    spr = new Sprite(tex);\n  }\n  spr.anchor.set(0, 0);\n  return spr;\n};\n\n// Create player container with default and hit sprites\nexport const createPlayerContainer = (playerVisuals, registryItems, playerState, tileSize) => {\n  const playerContainer = new Container();\n\n  // Default visuals from prop\n  const defaultDef = playerVisuals || null;\n\n  // Target visuals: try specific IDs\n  const targetDef = Array.isArray(registryItems)\n    ? (registryItems.find(r => r.id === 'player_target_100') || registryItems.find(r => r.id === 'player_target'))\n    : null;\n\n  const defSprite = buildSpriteFromDef(defaultDef) || new Sprite(Texture.WHITE);\n  const hitSprite = buildSpriteFromDef(targetDef) || null;\n\n  playerContainer.addChild(defSprite);\n  if (hitSprite) playerContainer.addChild(hitSprite);\n\n  // Health bar above player\n  let healthBar = null;\n  try {\n    healthBar = new HealthBar({\n      width: (playerState?.width) || tileSize,\n      height: 4,\n      offsetX: 0,\n      offsetY: -5\n    });\n    playerContainer.addChild(healthBar);\n  } catch (e) {\n    console.warn('Failed to create health bar:', e);\n  }\n\n  // Initial visibility\n  defSprite.visible = true;\n  if (hitSprite) hitSprite.visible = false;\n\n  return {\n    container: playerContainer,\n    sprites: { def: defSprite, hit: hitSprite },\n    healthBar\n  };\n};\n\n// Update player sprite position, direction, and visibility\nexport const updatePlayerSprite = (refs, playerState, tileSize, healthBarEnabled) => {\n  const { container, sprites, healthBar } = refs;\n  if (!playerState || !container) return;\n\n  const { def, hit } = sprites || {};\n\n  // Resize child sprites to match player state\n  if (def) {\n    if (playerState.width) def.width = playerState.width;\n    if (playerState.height) def.height = playerState.height;\n  }\n  if (hit) {\n    if (playerState.width) hit.width = playerState.width;\n    if (playerState.height) hit.height = playerState.height;\n  }\n\n  // Update health bar size and value\n  if (healthBar) {\n    const enabled = healthBarEnabled !== false;\n    const inWater = !!playerState.inWater;\n    const inLava = playerState.liquidType === 'lava';\n    if (!enabled) {\n      healthBar.visible = false;\n    } else {\n      // When in water or lava, hide the player-attached HB and use overlay version instead\n      healthBar.visible = !(inWater || inLava);\n      const effectiveWidth = playerState.width || (def?.width) || tileSize;\n      healthBar.resize(effectiveWidth, 4);\n      healthBar.y = -Math.max(4, Math.floor((playerState.height || def?.height || tileSize) * 0.12));\n      healthBar.update(playerState.health, (Number(playerState.maxHealth) || 100));\n    }\n  }\n\n  // Choose which sprite is visible based on hit timer\n  const isHit = Number(playerState.hitTimerMs) > 0 && !!hit;\n  if (def) def.visible = !isHit;\n  if (hit) hit.visible = isHit;\n\n  // Direction flip is applied to the container\n  const dir = playerState.direction || 1;\n  const mag = Math.abs(container.scale.x || 1);\n  container.scale.x = dir >= 0 ? mag : -mag;\n\n  // Position container; when flipped, offset by width\n  const effectiveWidth = playerState.width || (def?.width) || tileSize;\n  container.x = dir >= 0 ? (playerState.x || 0) : ((playerState.x || 0) + effectiveWidth);\n  container.y = playerState.y || 0;\n};\n","import { Sprite, AnimatedSprite } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\nimport { buildSpriteFromDef } from './playerManager';\nimport { isWaterDef, isLavaDef } from './liquidRendering';\n\n// Build layers: tiles, objects, and secret overlays\nexport const rebuildLayers = (refs, options) => {\n  const {\n    mapWidth,\n    mapHeight,\n    tileSize,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    revealedSecrets,\n    registryItems\n  } = options;\n\n  const { bgRef, objBehindRef, objFrontRef, secretLayerRef } = refs;\n\n  if (!bgRef || !objBehindRef || !objFrontRef) return;\n\n  // Clear previous\n  bgRef.removeChildren();\n  objBehindRef.removeChildren();\n  objFrontRef.removeChildren();\n  secretLayerRef?.below?.removeChildren();\n  secretLayerRef?.above?.removeChildren();\n\n  // Helper: resolve registry item by id\n  const getDef = (id) => getRegItem(registryItems, id);\n\n  // Background tiles (skip liquids; they are handled by LiquidRegionSystem)\n  let secretLayerCount = 0;\n  let normalLayerCount = 0;\n\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = tileMapData[i];\n    if (!id) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    // Check if this tile is in a secret zone\n    const secretId = secretMapData?.[i];\n    const secretDef = secretId ? getDef(secretId) : null;\n    const secretSubtype = secretDef?.subtype;\n    const isInOpenArea = secretSubtype === 'open' || secretSubtype === 'below';\n    const isInSecretArea = secretSubtype === 'secret' || secretSubtype === 'above';\n    const isSecretRevealed = revealedSecrets && revealedSecrets.includes(i);\n\n    // Determine if this tile should be rendered with filter on secret layer\n    let renderOnSecretLayer = false;\n    if (isInOpenArea) {\n      // open.area: always render on secret layer with filter\n      renderOnSecretLayer = true;\n      secretLayerCount++;\n    } else if (isInSecretArea && isSecretRevealed) {\n      // secret.area: only render on secret layer with filter AFTER revealed\n      renderOnSecretLayer = true;\n      secretLayerCount++;\n    } else {\n      normalLayerCount++;\n    }\n\n    let sprite;\n    let frames = null;\n    if (isWaterDef(def) || isLavaDef(def)) {\n      // liquids are handled by LiquidRegionSystem; skip per-tile sprite\n      continue;\n    } else {\n      if (Array.isArray(def.textures) && def.textures.length > 1) {\n        frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n      }\n      if (frames && frames.length > 0) {\n        sprite = new AnimatedSprite(frames);\n        sprite.animationSpeed = msToSpeed(def.animationSpeed);\n        sprite.play();\n      } else {\n        const tex = getTexture(def.texture) || null;\n        if (!tex) continue;\n        sprite = new Sprite(tex);\n      }\n    }\n\n    const x = (i % mapWidth) * tileSize;\n    const y = Math.floor(i / mapWidth) * tileSize;\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    // Apply filter if rendering on secret layer\n    if (renderOnSecretLayer) {\n      sprite.alpha = 0.4; // darken the tile\n      // Add to secret layer (below player always for tiles)\n      if (secretLayerRef?.below) {\n        secretLayerRef.below.addChild(sprite);\n      } else {\n        bgRef.addChild(sprite);\n      }\n    } else {\n      // Normal rendering on tiles layer\n      bgRef.addChild(sprite);\n    }\n  }\n\n  console.log('[RENDER] Tiles rendering complete:', {\n    secretLayerTiles: secretLayerCount,\n    normalLayerTiles: normalLayerCount,\n    revealedSecretsCount: revealedSecrets?.length || 0\n  });\n\n  // Objects (non-player)\n  for (let i = 0; i < mapWidth * mapHeight; i++) {\n    const id = objectMapData[i];\n    if (!id || id.includes('player')) continue;\n    const def = getDef(id);\n    if (!def) continue;\n\n    const sprite = buildSpriteFromDef(def);\n    if (!sprite) continue;\n\n    const x = (i % mapWidth) * tileSize;\n    const y = Math.floor(i / mapWidth) * tileSize;\n    sprite.x = x;\n    sprite.y = y;\n    sprite.width = tileSize;\n    sprite.height = tileSize;\n\n    const renderAbove = !!def.renderAbovePlayer;\n    if (renderAbove) {\n      objFrontRef.addChild(sprite);\n    } else {\n      objBehindRef.addChild(sprite);\n    }\n  }\n};\n","import React, { useEffect, useRef, useMemo, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { Application, Container, Graphics, Assets } from 'pixi.js';\nimport { TextureCache } from '../../../../Pixi/TextureCache';\nimport { Rain as WeatherRain, Snow as WeatherSnow, Clouds as WeatherClouds, Fog as WeatherFog, Thunder as WeatherThunder } from '../../../../Pixi/effects/weather';\nimport { WaterSplashFX, LavaEmbers, LavaSteamFX, LiquidRegionSystem } from '../../../../Pixi/effects/liquids';\nimport HealthBar from '../../../../Pixi/ui/HealthBar';\nimport LAYERS from '../../../../renderer/stage/layers/LayerOrder';\nimport { clearTextureCache, createBackgroundResolver, createSolidChecker } from './helpers';\nimport { createWaterFrames, createLavaFrames } from './liquidRendering';\nimport { createParallaxManager } from './parallaxManager';\nimport { createPlayerContainer, updatePlayerSprite } from './playerManager';\nimport { syncProjectiles, cleanupProjectiles } from './projectileManager';\nimport { rebuildLayers } from './layerBuilder';\n\n// Suppress noisy Pixi Assets warnings for inlined data URLs (we load textures directly)\nAssets.setPreferences?.({ skipCacheIdWarning: true });\n\nconst PixiStage = ({\n  mapWidth,\n  mapHeight,\n  tileSize = 32,\n  tileMapData = [],\n  objectMapData = [],\n  secretMapData = [],\n  revealedSecrets = [],\n  objectTextureIndices = {},\n  registryItems = [],\n  playerState,\n  playerVisuals,\n  backgroundImage,\n  backgroundColor,\n  backgroundParallaxFactor = 0.3,\n  cameraScrollX = 0,\n  weatherRain = 0,\n  weatherSnow = 0,\n  weatherClouds = 0,\n  projectiles = [],\n  healthBarEnabled = true,\n  weatherFog = 0,\n  weatherThunder = 0,\n  oxygenBarEnabled = true,\n  lavaBarEnabled = true,\n  waterSplashesEnabled = true,\n  lavaEmbersEnabled = true,\n}) => {\n  const mountRef = useRef(null);\n  const appRef = useRef(null);\n  const parallaxRef = useRef(null);\n  const parallaxManagerRef = useRef(null);\n  const cameraScrollRef = useRef(0);\n  const parallaxFactorRef = useRef(Number(backgroundParallaxFactor) || 0.3);\n  const bgRef = useRef(null);\n  const bgAnimRef = useRef(null);\n  const bgImageRef = useRef(backgroundImage);\n  const bgColorRef = useRef(backgroundColor);\n  const objBehindRef = useRef(null);\n  const objFrontRef = useRef(null);\n  const secretLayerRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerSpriteRefs = useRef({ def: null, hit: null });\n  const playerHealthBarRef = useRef(null);\n  const playerStateRef = useRef(null);\n  const weatherLayerRef = useRef(null);\n  const liquidLayerRef = useRef(null);\n  const liquidSystemRef = useRef(null);\n  const fogLayerRef = useRef(null);\n  const weatherSystemsRef = useRef({ rain: null, snow: null, clouds: null, thunder: null });\n  const projectilesLayerRef = useRef(null);\n  const projectileSpritesRef = useRef(new Map());\n  const projectilesPropRef = useRef([]);\n  const pixiTextureCacheRef = useRef(null);\n  const hbEnabledRef = useRef(healthBarEnabled !== false);\n  const oxyEnabledRef = useRef(oxygenBarEnabled !== false);\n  const lavaEnabledRef = useRef(lavaBarEnabled !== false);\n  const overlayLayerRef = useRef(null);\n  const underwaterRef = useRef({ g: null, time: 0 });\n  const waterFramesRef = useRef(null);\n  const lavaFramesRef = useRef(null);\n  const overlayHBRef = useRef(null);\n  const oxygenBarRef = useRef(null);\n  const lavaBarRef = useRef(null);\n  const waterFxRef = useRef(null);\n  const lavaEmbersRef = useRef(null);\n  const lavaSteamRef = useRef(null);\n  const splashesEnabledRef = useRef(waterSplashesEnabled !== false);\n  const embersEnabledRef = useRef(lavaEmbersEnabled !== false);\n  const waterStateRef = useRef({ inWater: false, headUnder: false, vy: 0 });\n\n  // Keep latest state in refs for ticker\n  useEffect(() => { playerStateRef.current = playerState; }, [playerState]);\n  useEffect(() => { projectilesPropRef.current = Array.isArray(projectiles) ? projectiles : []; }, [projectiles]);\n  useEffect(() => { hbEnabledRef.current = healthBarEnabled !== false; }, [healthBarEnabled]);\n  useEffect(() => { oxyEnabledRef.current = oxygenBarEnabled !== false; }, [oxygenBarEnabled]);\n  useEffect(() => { lavaEnabledRef.current = lavaBarEnabled !== false; }, [lavaBarEnabled]);\n  useEffect(() => { splashesEnabledRef.current = waterSplashesEnabled !== false; }, [waterSplashesEnabled]);\n  useEffect(() => { embersEnabledRef.current = lavaEmbersEnabled !== false; }, [lavaEmbersEnabled]);\n  useEffect(() => { cameraScrollRef.current = Number(cameraScrollX) || 0; }, [cameraScrollX]);\n  useEffect(() => { parallaxFactorRef.current = Number(backgroundParallaxFactor) || 0.3; }, [backgroundParallaxFactor]);\n  useEffect(() => { bgImageRef.current = backgroundImage; }, [backgroundImage]);\n  useEffect(() => { bgColorRef.current = backgroundColor; }, [backgroundColor]);\n\n  // Background resolver and solid checker (memoized per map)\n  const resolveBackgroundUrl = useMemo(() => createBackgroundResolver(), []);\n  const isSolidAt = useMemo(() => createSolidChecker(mapWidth, mapHeight, tileSize, tileMapData, registryItems), [mapWidth, mapHeight, tileSize, tileMapData, registryItems]);\n\n  // Rebuild parallax helper\n  const rebuildParallax = useCallback(() => {\n    const layer = parallaxRef.current;\n    if (!layer) return;\n    if (!pixiTextureCacheRef.current) pixiTextureCacheRef.current = new TextureCache();\n    if (!parallaxManagerRef.current) {\n      parallaxManagerRef.current = createParallaxManager(layer, pixiTextureCacheRef.current);\n    }\n    \n    const bgUrl = bgImageRef.current;\n    const bgColor = bgColorRef.current;\n    const factor = parallaxFactorRef.current || 0.3;\n\n    parallaxManagerRef.current.build({\n      worldWidth: mapWidth * tileSize,\n      worldHeight: mapHeight * tileSize,\n      url: bgUrl,\n      color: bgColor,\n      factor,\n      resolveBackgroundUrl\n    });\n  }, [mapWidth, mapHeight, tileSize, resolveBackgroundUrl]);\n\n  // Initialize Application\n  useEffect(() => {\n    let destroyed = false;\n\n    const init = async () => {\n      const app = new Application();\n      await app.init({\n        width: mapWidth * tileSize,\n        height: mapHeight * tileSize,\n        backgroundAlpha: 0,\n        antialias: false,\n        autoDensity: true,\n      });\n      if (destroyed) { app.destroy(true); return; }\n\n      appRef.current = app;\n      app.stage.sortableChildren = true;\n\n      // Create layers\n      const bg = new Container();\n      const bgAnim = new Container();\n      const objBehind = new Container();\n      const objFront = new Container();\n      const secretBelowLayer = new Container();\n      const secretAboveLayer = new Container();\n      const playerLayer = new Container();\n      const weatherLayer = new Container();\n      const liquidLayer = new Container();\n      const liquidFxLayer = new Container();\n      const fogLayer = new Container();\n      const projLayer = new Container();\n      const overlayLayer = new Container();\n\n      // Assign zIndex\n      const parallaxLayer = new Container();\n      parallaxLayer.zIndex = LAYERS.parallax;\n      bg.zIndex = LAYERS.tiles;\n      bgAnim.zIndex = LAYERS.tilesAnim;\n      objBehind.zIndex = LAYERS.objBehind;\n      objFront.zIndex = LAYERS.objFront;\n      secretBelowLayer.zIndex = LAYERS.secretsBelow;\n      secretAboveLayer.zIndex = LAYERS.secretsAbove;\n      playerLayer.zIndex = LAYERS.player;\n      weatherLayer.zIndex = LAYERS.weather;\n      fogLayer.zIndex = LAYERS.fog;\n      liquidLayer.zIndex = LAYERS.liquids;\n      liquidFxLayer.zIndex = LAYERS.liquidFx;\n      projLayer.zIndex = LAYERS.projectiles;\n      overlayLayer.zIndex = LAYERS.overlay;\n\n      bgRef.current = bg;\n      bgAnimRef.current = bgAnim;\n      objBehindRef.current = objBehind;\n      objFrontRef.current = objFront;\n      secretLayerRef.current = { below: secretBelowLayer, above: secretAboveLayer };\n      weatherLayerRef.current = weatherLayer;\n      liquidLayerRef.current = liquidLayer;\n      fogLayerRef.current = fogLayer;\n      projectilesLayerRef.current = projLayer;\n      overlayLayerRef.current = overlayLayer;\n      parallaxRef.current = parallaxLayer;\n\n      // Add all layers to stage\n      app.stage.addChild(parallaxLayer, objBehind, secretBelowLayer, playerLayer, projLayer, objFront, secretAboveLayer, weatherLayer, fogLayer, liquidLayer, liquidFxLayer, bg, bgAnim, overlayLayer);\n\n      // Preload textures to avoid Assets cache warnings and ensure textures are ready\n      try {\n        const urlSet = new Set();\n        const addUrl = (u) => { if (typeof u === 'string' && u.length) urlSet.add(u); };\n        registryItems.forEach((def) => {\n          addUrl(def?.texture);\n          if (Array.isArray(def?.textures)) def.textures.forEach(addUrl);\n        });\n        if (playerVisuals) {\n          addUrl(playerVisuals.texture);\n          if (Array.isArray(playerVisuals.textures)) playerVisuals.textures.forEach(addUrl);\n        }\n        const bgUrl = resolveBackgroundUrl(bgImageRef.current);\n        if (bgUrl) addUrl(bgUrl);\n        const urls = Array.from(urlSet);\n        if (urls.length) {\n          console.log('[PixiStage] Preloading', urls.length, 'textures...');\n          await Assets.load(urls);\n          console.log('[PixiStage] Textures preloaded successfully');\n        }\n      } catch (e) {\n        console.warn('Pixi Assets preload encountered an issue (continuing):', e);\n      }\n\n      // Create player\n      const playerComponents = createPlayerContainer(playerVisuals, registryItems, playerState, tileSize);\n      playerLayer.addChild(playerComponents.container);\n      playerRef.current = playerComponents.container;\n      playerSpriteRefs.current = playerComponents.sprites;\n      playerHealthBarRef.current = playerComponents.healthBar;\n\n      // Mount canvas\n      if (mountRef.current) {\n        mountRef.current.innerHTML = '';\n        mountRef.current.appendChild(app.canvas);\n      }\n\n      // Build underwater overlay\n      const g = new Graphics();\n      overlayLayer.addChild(g);\n      underwaterRef.current.g = g;\n      const W = mapWidth * tileSize;\n      const H = mapHeight * tileSize;\n      g.clear();\n      g.beginFill(0x1d4875, 1);\n      g.drawRect(0, 0, W, H);\n      g.endFill();\n      g.alpha = 0;\n      g.visible = false;\n\n      // Build overlay bars\n      const hbOverlay = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0 });\n      hbOverlay.visible = false;\n      overlayLayer.addChild(hbOverlay);\n      overlayHBRef.current = hbOverlay;\n\n      const oxyColors = { ok: 0x2ecdf1, warn: 0x3498db, danger: 0x1f6fb2 };\n      const oxyBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: oxyColors });\n      oxyBar.visible = false;\n      overlayLayer.addChild(oxyBar);\n      oxygenBarRef.current = oxyBar;\n\n      const lavaColors = { ok: 0xffa229, warn: 0xff7b00, danger: 0xff3b1a };\n      const lvBar = new HealthBar({ width: (playerState?.width) || tileSize, height: 4, offsetX: 0, offsetY: 0, colors: lavaColors });\n      lvBar.visible = false;\n      overlayLayer.addChild(lvBar);\n      lavaBarRef.current = lvBar;\n\n      // WebGL context loss/restore handlers\n      if (app.canvas) {\n        app.canvas.addEventListener('webglcontextlost', (e) => {\n          e.preventDefault();\n          console.warn('WebGL context lost');\n        });\n        app.canvas.addEventListener('webglcontextrestored', () => {\n          console.info('WebGL context restored');\n          rebuildLayers(\n            { bgRef: bgRef.current, objBehindRef: objBehindRef.current, objFrontRef: objFrontRef.current, secretLayerRef: secretLayerRef.current },\n            { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems }\n          );\n          rebuildParallax();\n          try {\n            if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n            liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { mapWidth, mapHeight, tileSize });\n            liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n          } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n          try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n        });\n      }\n\n      // First draw\n      rebuildLayers(\n        { bgRef: bgRef.current, objBehindRef: objBehindRef.current, objFrontRef: objFrontRef.current, secretLayerRef: secretLayerRef.current },\n        { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems }\n      );\n\n      // Initialize liquid system\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { mapWidth, mapHeight, tileSize });\n        liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n      } catch (e) { console.warn('LiquidRegionSystem init failed:', e); }\n\n      // FX systems\n      try { waterFxRef.current = new WaterSplashFX(liquidFxLayer); } catch {}\n      try { lavaSteamRef.current = new LavaSteamFX(liquidFxLayer); } catch {}\n      try {\n        lavaEmbersRef.current = new LavaEmbers(liquidLayerRef.current, { mapWidth, mapHeight, tileSize }, () => (embersEnabledRef.current ? 100 : 0));\n        lavaEmbersRef.current.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n      } catch {}\n\n      rebuildParallax();\n\n      // Ticker\n      app.ticker.add(() => {\n        const s = playerStateRef.current;\n        if (s && playerRef.current) {\n          updatePlayerSprite(\n            { container: playerRef.current, sprites: playerSpriteRefs.current, healthBar: playerHealthBarRef.current },\n            s,\n            tileSize,\n            hbEnabledRef.current\n          );\n        }\n\n        // Parallax\n        const f = parallaxFactorRef.current;\n        const camX = cameraScrollRef.current || 0;\n        if (parallaxManagerRef.current) {\n          parallaxManagerRef.current.setScroll(camX, f);\n        }\n\n        // Weather\n        const dt = app.ticker?.deltaMS || 16.67;\n        const systems = weatherSystemsRef.current;\n        if (systems.rain) systems.rain.update(dt);\n        if (systems.snow) systems.snow.update(dt);\n        if (systems.clouds) systems.clouds.update(dt);\n        if (systems.fog) systems.fog.update(dt);\n        if (systems.thunder) systems.thunder.update(dt);\n\n        // Liquids\n        try {\n          if (liquidSystemRef.current && s) {\n            liquidSystemRef.current.setPlayerState(s);\n          }\n          liquidSystemRef.current?.update(dt);\n        } catch {}\n\n        // FX\n        try { lavaEmbersRef.current?.update(dt); } catch {}\n        try { waterFxRef.current?.update(dt); } catch {}\n        try { lavaSteamRef.current?.update(dt); } catch {}\n\n        // Underwater overlay\n        try {\n          const u = underwaterRef.current;\n          const sNow = playerStateRef.current || {};\n          if (u && u.g) {\n            const submerged = !!(sNow && sNow.headUnderWater && sNow.liquidType === 'water');\n            if (submerged) {\n              u.time += dt;\n              const pulse = 0.12 + 0.06 * Math.sin(u.time * 0.0025);\n              u.g.visible = true;\n              u.g.alpha = pulse;\n            } else if (u.g.visible) {\n              u.g.alpha *= 0.85;\n              if (u.g.alpha < 0.01) { u.g.alpha = 0; u.g.visible = false; }\n            }\n          }\n\n          // Water splash detection\n          try {\n            const prev = waterStateRef.current || { inWater: false, headUnder: false, vy: 0 };\n            const nowInWater = !!sNow.inWater;\n            const nowLiquid = sNow.liquidType;\n            const centerX = (sNow.x || 0) + (sNow.width || tileSize) * 0.5;\n\n            if (splashesEnabledRef.current && nowLiquid === 'water' && nowInWater && !prev.inWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.12));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: false });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.5, 0.6 + Math.abs(vy) * 0.08)); } catch {}\n            }\n            if (splashesEnabledRef.current && prev.inWater && !nowInWater) {\n              const sy = liquidSystemRef.current?.getSurfaceY?.('water', centerX);\n              const vy = Number(sNow.vy) || 0;\n              const strength = Math.min(3, Math.max(0.2, Math.abs(vy) * 0.08));\n              waterFxRef.current?.trigger({ x: centerX, y: (Number.isFinite(sy) ? sy : (sNow.y || 0)), strength, upward: true });\n              try { liquidSystemRef.current?.addWave?.('water', centerX, Math.min(2.0, 0.4 + Math.abs(vy) * 0.05)); } catch {}\n            }\n            waterStateRef.current = { inWater: nowInWater, headUnder: !!sNow.headUnderWater, vy: Number(sNow.vy) || 0 };\n          } catch {}\n        } catch {}\n\n        // Overlay bars\n        try {\n          const s2 = playerStateRef.current || {};\n          const effW = (s2.width || tileSize);\n          const effH = (s2.height || tileSize);\n          const baseYOffset = Math.max(4, Math.floor(effH * 0.12));\n          const baseX = (s2.x || 0);\n          const baseY = (s2.y || 0) - baseYOffset;\n\n          const hbO = overlayHBRef.current;\n          if (hbO) {\n            const enabled = hbEnabledRef.current !== false;\n            const show = enabled && (!!s2.inWater || s2.liquidType === 'lava');\n            hbO.visible = !!show;\n            if (show) {\n              hbO.x = baseX;\n              hbO.y = baseY;\n              hbO.resize(effW, 4);\n              hbO.update(s2.health, (Number(s2.maxHealth) || 100));\n            }\n          }\n\n          let nextBarY = baseY;\n          if (hbO && hbO.visible) nextBarY += 6;\n\n          const oxyBar = oxygenBarRef.current;\n          if (oxyBar) {\n            const enabled = oxyEnabledRef.current !== false;\n            const maxOxy = Math.max(1, Number(s2.maxOxygen) || 100);\n            const curOxy = Math.max(0, Number(s2.oxygen));\n            const show = enabled && ((s2.liquidType === 'water' || s2.inWater) || (curOxy < maxOxy));\n            oxyBar.visible = !!show;\n            if (show) {\n              oxyBar.x = baseX;\n              oxyBar.y = nextBarY;\n              oxyBar.resize(effW, 4);\n              oxyBar.update((Number.isFinite(curOxy) ? curOxy : maxOxy), maxOxy);\n              nextBarY += 6;\n            }\n          }\n\n          const lvBar = lavaBarRef.current;\n          if (lvBar) {\n            const enabled = lavaEnabledRef.current !== false;\n            const maxLv = Math.max(1, Number(s2.maxLavaResist) || 100);\n            const curLv = Math.max(0, Number(s2.lavaResist));\n            const show = enabled && (s2.liquidType === 'lava' || (curLv < maxLv));\n            lvBar.visible = !!show;\n            if (show) {\n              lvBar.x = baseX;\n              lvBar.y = nextBarY;\n              lvBar.resize(effW, 4);\n              lvBar.update((Number.isFinite(curLv) ? curLv : maxLv), maxLv);\n            }\n          }\n        } catch {}\n\n        // Projectiles\n        syncProjectiles(projectilesLayerRef.current, projectileSpritesRef.current, projectilesPropRef.current, registryItems, tileSize);\n      });\n    };\n\n    init();\n\n    return () => {\n      destroyed = true;\n      if (appRef.current) {\n        appRef.current.destroy(true);\n        appRef.current = null;\n      }\n      try { liquidSystemRef.current?.destroy(); } catch {}\n      try { waterFxRef.current?.destroy(); } catch {}\n      try { lavaEmbersRef.current?.destroy(); } catch {}\n      try { lavaSteamRef.current?.destroy(); } catch {}\n      try { parallaxManagerRef.current?.destroy(); } catch {}\n      parallaxManagerRef.current = null;\n      try { pixiTextureCacheRef.current?.clear?.(); } catch {}\n      try {\n        weatherSystemsRef.current.rain?.destroy();\n        weatherSystemsRef.current.snow?.destroy();\n        weatherSystemsRef.current.fog?.destroy();\n      } catch {}\n      cleanupProjectiles(projectileSpritesRef.current);\n      clearTextureCache();\n    };\n  }, [mapWidth, mapHeight, tileSize, playerVisuals]);\n\n  // Rebuild layers when map data changes\n  useEffect(() => {\n    const app = appRef.current;\n    if (!app) return;\n    if (bgRef.current && objBehindRef.current && objFrontRef.current) {\n      rebuildLayers(\n        { bgRef: bgRef.current, objBehindRef: objBehindRef.current, objFrontRef: objFrontRef.current, secretLayerRef: secretLayerRef.current },\n        { mapWidth, mapHeight, tileSize, tileMapData, objectMapData, secretMapData, revealedSecrets, registryItems }\n      );\n\n      // Rebuild liquid regions\n      try {\n        if (liquidSystemRef.current) liquidSystemRef.current.destroy();\n        if (liquidLayerRef.current) {\n          liquidSystemRef.current = new LiquidRegionSystem(liquidLayerRef.current, { mapWidth, mapHeight, tileSize });\n          liquidSystemRef.current.build({ mapWidth, mapHeight, tileSize, tileMapData, registryItems });\n        }\n      } catch (e) { console.warn('LiquidRegionSystem rebuild failed:', e); }\n      try { lavaEmbersRef.current?.rebuildSurfaces({ mapWidth, mapHeight, tileSize, tileMapData, registryItems }); } catch {}\n    }\n  }, [tileMapData, objectMapData, objectTextureIndices, registryItems, mapWidth, mapHeight, tileSize, secretMapData, revealedSecrets]);\n\n  // Weather systems lifecycle\n  useEffect(() => {\n    const app = appRef.current;\n    const weatherLayer = weatherLayerRef.current;\n    const fogLayer = fogLayerRef.current;\n    if (!app || !weatherLayer || !fogLayer) return;\n\n    const api = {\n      isSolidAt,\n      mapWidth,\n      mapHeight,\n      tileSize,\n      getLiquidSurfaceY: (type, x) => {\n        try { return liquidSystemRef.current?.getSurfaceY?.(type, x); } catch { return null; }\n      },\n      onWaterImpact: ({ x, strength = 0.8 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('water', x);\n          if (Number.isFinite(sy)) waterFxRef.current?.trigger({ x, y: sy, strength: Math.max(0.2, Math.min(2, strength)), upward: false });\n          try { liquidSystemRef.current?.addWave?.('water', x, Math.max(0.2, Math.min(2.2, strength))); } catch {}\n        } catch {}\n      },\n      onLavaImpact: ({ x, y, strength = 0.6 }) => {\n        try {\n          const sy = liquidSystemRef.current?.getSurfaceY?.('lava', x);\n          const yy = Number.isFinite(y) ? y : (Number.isFinite(sy) ? sy : null);\n          if (yy != null) lavaSteamRef.current?.trigger({ x, y: yy, strength });\n        } catch {}\n      }\n    };\n\n    const getRainIntensity = () => Math.max(0, Math.min(100, Number(weatherRain) || 0));\n    const getSnowIntensity = () => Math.max(0, Math.min(100, Number(weatherSnow) || 0));\n    const getCloudsIntensity = () => Math.max(0, Math.min(100, Number(weatherClouds) || 0));\n    const getThunderIntensity = () => Math.max(0, Math.min(100, Number(weatherThunder) || 0));\n\n    // Reset systems\n    try { weatherSystemsRef.current.rain?.destroy(); } catch {}\n    try { weatherSystemsRef.current.snow?.destroy(); } catch {}\n    try { weatherSystemsRef.current.clouds?.destroy(); } catch {}\n    try { weatherSystemsRef.current.fog?.destroy(); } catch {}\n    try { weatherSystemsRef.current.thunder?.destroy(); } catch {}\n    weatherSystemsRef.current.rain = null;\n    weatherSystemsRef.current.snow = null;\n    weatherSystemsRef.current.clouds = null;\n    weatherSystemsRef.current.fog = null;\n    weatherSystemsRef.current.thunder = null;\n\n    // Rain\n    if (getRainIntensity() > 0) {\n      weatherSystemsRef.current.rain = new WeatherRain(weatherLayer, api, getRainIntensity);\n      weatherSystemsRef.current.rain.setIntensity(getRainIntensity());\n    }\n\n    // Snow\n    if (getSnowIntensity() > 0) {\n      weatherSystemsRef.current.snow = new WeatherSnow(weatherLayer, api, getSnowIntensity);\n      weatherSystemsRef.current.snow.setIntensity(getSnowIntensity());\n    }\n\n    // Clouds\n    if (getCloudsIntensity() > 0) {\n      weatherSystemsRef.current.clouds = new WeatherClouds(fogLayer, api, getCloudsIntensity);\n      weatherSystemsRef.current.clouds.setIntensity(getCloudsIntensity());\n    }\n\n    // Fog\n    if (Number(weatherFog) > 0) {\n      weatherSystemsRef.current.fog = new WeatherFog(fogLayer, api, () => Number(weatherFog) || 0);\n      weatherSystemsRef.current.fog.setIntensity(Number(weatherFog) || 0);\n    }\n\n    // Thunder\n    if (getThunderIntensity() > 0) {\n      weatherSystemsRef.current.thunder = new WeatherThunder(fogLayer, api, getThunderIntensity);\n      weatherSystemsRef.current.thunder.setIntensity(getThunderIntensity());\n    }\n  }, [weatherRain, weatherSnow, weatherClouds, weatherFog, weatherThunder, mapWidth, mapHeight, tileSize]);\n\n  // Rebuild parallax when props change\n  useEffect(() => {\n    rebuildParallax();\n  }, [backgroundImage, backgroundColor, rebuildParallax]);\n\n  return <div ref={mountRef} style={{ width: '100%', height: '100%' }} />;\n};\n\nPixiStage.propTypes = {\n  mapWidth: PropTypes.number.isRequired,\n  mapHeight: PropTypes.number.isRequired,\n  tileSize: PropTypes.number,\n  tileMapData: PropTypes.array,\n  objectMapData: PropTypes.array,\n  secretMapData: PropTypes.array,\n  revealedSecrets: PropTypes.array,\n  objectTextureIndices: PropTypes.object,\n  registryItems: PropTypes.array,\n  playerState: PropTypes.object,\n  playerVisuals: PropTypes.object,\n  backgroundImage: PropTypes.string,\n  backgroundColor: PropTypes.string,\n  backgroundParallaxFactor: PropTypes.number,\n  cameraScrollX: PropTypes.number,\n  weatherRain: PropTypes.number,\n  weatherSnow: PropTypes.number,\n  weatherClouds: PropTypes.number,\n  projectiles: PropTypes.array,\n  healthBarEnabled: PropTypes.bool,\n  weatherFog: PropTypes.number,\n  weatherThunder: PropTypes.number,\n  oxygenBarEnabled: PropTypes.bool,\n  lavaBarEnabled: PropTypes.bool,\n  waterSplashesEnabled: PropTypes.bool,\n  lavaEmbersEnabled: PropTypes.bool,\n};\n\nexport default PixiStage;\n","import { Sprite, AnimatedSprite, Texture } from 'pixi.js';\nimport { getTexture, msToSpeed, getRegItem } from './helpers';\n\n// Sync and update projectiles: create missing sprites, remove stale ones, update positions\nexport const syncProjectiles = (projectilesLayer, projectileSpritesMap, projectilesList, registryItems, tileSize) => {\n  if (!projectilesLayer) return;\n\n  const map = projectileSpritesMap;\n  const list = projectilesList || [];\n  const seen = new Set();\n\n  // Create or update sprites for current projectiles\n  for (let i = 0; i < list.length; i++) {\n    const p = list[i];\n    const key = p.id;\n    seen.add(key);\n\n    let spr = map.get(key);\n    if (!spr) {\n      // Create new sprite\n      const def = getRegItem(registryItems, p.defId);\n      if (def && Array.isArray(def.textures) && def.textures.length > 1) {\n        const frames = def.textures.map((u) => getTexture(u)).filter(Boolean);\n        if (frames.length > 0) {\n          spr = new AnimatedSprite(frames);\n          spr.animationSpeed = msToSpeed(def.animationSpeed);\n          spr.play();\n        }\n      }\n      if (!spr) {\n        const tex = getTexture(getRegItem(registryItems, p.defId)?.texture) || Texture.WHITE;\n        spr = new Sprite(tex);\n      }\n      spr.anchor.set(0.5, 0.5);\n      spr.width = Math.max(2, p.w || tileSize * 0.25);\n      spr.height = Math.max(2, p.h || tileSize * 0.25);\n      projectilesLayer.addChild(spr);\n      map.set(key, spr);\n    }\n\n    // Update position and direction\n    spr.x = p.x + (p.dir >= 0 ? 0 : 0);\n    spr.y = p.y;\n    const mag = Math.abs(spr.scale.x || 1);\n    spr.scale.x = p.dir >= 0 ? mag : -mag;\n  }\n\n  // Remove sprites that no longer exist\n  for (const [key, spr] of map.entries()) {\n    if (!seen.has(key)) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n      map.delete(key);\n    }\n  }\n};\n\n// Cleanup all projectile sprites\nexport const cleanupProjectiles = (projectileSpritesMap) => {\n  try {\n    for (const spr of projectileSpritesMap.values()) {\n      try {\n        spr.parent && spr.parent.removeChild(spr);\n      } catch (e) {\n        // ignore\n      }\n      try {\n        spr.destroy && spr.destroy();\n      } catch (e) {\n        // ignore\n      }\n    }\n    projectileSpritesMap.clear();\n  } catch (e) {\n    // ignore\n  }\n};\n","/**\n * Secrets Detection and Reveal Logic\n * Handles AboveSecret zone detection and revealing when player enters\n */\n\n/**\n * Flood fill to find all connected secret tiles of the same type\n * @param {number} startIndex - Starting tile index\n * @param {Array} secretMapData - Secret layer data\n * @param {number} mapWidth - Map width in tiles\n * @param {number} mapHeight - Map height in tiles\n * @param {Array} registryItems - Registry items to lookup secret definitions\n * @returns {Array} - Array of connected tile indices\n */\nexport function floodFillSecretZone(startIndex, secretMapData, mapWidth, mapHeight, registryItems) {\n  const startSecretId = secretMapData[startIndex];\n  if (!startSecretId) return [];\n\n  const startDef = registryItems.find(r => r.id === startSecretId);\n  if (!startDef || startDef.type !== 'secret') return [];\n\n  const visited = new Set();\n  const result = [];\n  const queue = [startIndex];\n\n  while (queue.length > 0) {\n    const idx = queue.shift();\n    if (visited.has(idx)) continue;\n    if (idx < 0 || idx >= secretMapData.length) continue;\n\n    visited.add(idx);\n\n    const secretId = secretMapData[idx];\n    if (!secretId || secretId !== startSecretId) continue;\n\n    result.push(idx);\n\n    // Check 4 neighbors (up, down, left, right)\n    const x = idx % mapWidth;\n    const y = Math.floor(idx / mapWidth);\n\n    // Up\n    if (y > 0) queue.push((y - 1) * mapWidth + x);\n    // Down\n    if (y < mapHeight - 1) queue.push((y + 1) * mapWidth + x);\n    // Left\n    if (x > 0) queue.push(y * mapWidth + (x - 1));\n    // Right\n    if (x < mapWidth - 1) queue.push(y * mapWidth + (x + 1));\n  }\n\n  return result;\n}\n\n/**\n * Check if player is touching any AboveSecret tiles\n * @param {Object} params - Detection parameters\n * @returns {Array|null} - Array of tile indices to reveal, or null if no detection\n */\nexport function checkSecretDetection({\n  currentX,\n  currentY,\n  width,\n  height,\n  secretMapData,\n  revealedSecrets,\n  mapWidth,\n  mapHeight,\n  registryItems,\n  TILE_SIZE\n}) {\n  if (!secretMapData || secretMapData.length === 0) return null;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Check all overlapping tiles for AboveSecret\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      if (gx < 0 || gx >= mapWidth || gy < 0 || gy >= mapHeight) continue;\n\n      const idx = gy * mapWidth + gx;\n      const secretId = secretMapData[idx];\n      if (!secretId) continue;\n\n      // Already revealed?\n      if (revealedSecrets && revealedSecrets.includes(idx)) continue;\n\n      const def = registryItems.find(r => r.id === secretId);\n      if (!def || def.type !== 'secret') continue;\n\n      // Only secret.area (subtype: 'secret' or old name 'above') can be revealed\n      const isSecretArea = def.subtype === 'secret' || def.subtype === 'above';\n      if (!isSecretArea || !def.revealOnEnter) continue;\n\n      // Found an unrevealed secret.area that player is touching!\n      // Flood fill to find all connected tiles\n      const connectedIndices = floodFillSecretZone(idx, secretMapData, mapWidth, mapHeight, registryItems);\n\n      // Filter out already revealed indices to prevent infinite loop\n      const newIndices = connectedIndices.filter(i => !revealedSecrets || !revealedSecrets.includes(i));\n\n      console.log('[SECRETS] Revealing zone:', {\n        triggerIndex: idx,\n        triggerSecretId: secretId,\n        triggerSubtype: def.subtype,\n        totalConnected: connectedIndices.length,\n        newToReveal: newIndices.length,\n        firstFiveNew: newIndices.slice(0, 5),\n        connectedSecretIds: newIndices.slice(0, 5).map(i => secretMapData[i])\n      });\n\n      // Only return if there are NEW indices to reveal\n      return newIndices.length > 0 ? newIndices : null;\n    }\n  }\n\n  return null;\n}\n\nexport default { checkSecretDetection, floodFillSecretZone };\n","// Audio utilities extracted from useGameEngine.js\n\n// Usage: playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef }, url, volume)\nexport function playSfx(ctx, url, volume) {\n  const { soundEnabledRef, audioCtxRef } = ctx || {};\n  try {\n    if (!soundEnabledRef?.current) return;\n    const vol = Math.max(0, Math.min(1, volume ?? 1));\n    // 1) Try HTMLAudio first\n    if (url && typeof url === 'string' && url.length > 0) {\n      try {\n        const audio = new Audio(url);\n        audio.volume = vol;\n        audio.addEventListener?.('error', () => {\n          try { audio.pause(); } catch {}\n          beepFallback(ctx, vol);\n        }, { once: true });\n        const p = audio.play?.();\n        if (p && typeof p.catch === 'function') p.catch(() => beepFallback(ctx, vol));\n        return;\n      } catch {\n        // fallback below\n      }\n    }\n    // 2) Fallback beep via WebAudio\n    beepFallback(ctx, vol);\n  } catch {}\n}\n\nexport function beepFallback(ctx, vol) {\n  try {\n    const AC = window.AudioContext || window.webkitAudioContext;\n    if (!AC) return;\n    if (!ctx?.audioCtxRef) return;\n    if (!ctx.audioCtxRef.current) ctx.audioCtxRef.current = new AC();\n    const audioCtx = ctx.audioCtxRef.current;\n    if (!audioCtx) return;\n    if (audioCtx.state === 'suspended') audioCtx.resume?.();\n    const now = audioCtx.currentTime;\n    const osc = audioCtx.createOscillator();\n    const gain = audioCtx.createGain();\n    // short square click ~520Hz for ~90ms\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(520, now);\n    gain.gain.setValueAtTime(0.0001, now);\n    gain.gain.exponentialRampToValueAtTime(Math.max(0.05, (vol ?? 0.2) * 0.2), now + 0.01);\n    gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);\n    osc.connect(gain);\n    gain.connect(audioCtx.destination);\n    osc.start(now);\n    osc.stop(now + 0.09);\n  } catch {}\n}\n","// Generic liquid helpers (water, lava, etc.)\n// Liquids are defined as blocks with flags.liquid === true and optional flags.water/flags.lava\n// Optional physics params live under def.liquid: { buoyancy, drag:{x,y}, surface, swimmable, damagePerSecond }\n\n/**\n * Sample registry tile definition at world pixel and return liquid info if present.\n * @param {number} wx world x in pixels\n * @param {number} wy world y in pixels\n * @param {number} mapWidthTiles\n * @param {number} mapHeightTiles\n * @param {number} TILE_SIZE\n * @param {Array<string|null>} tileData tile ids array (background layer)\n * @param {Array<object>} registryItems game registry array\n * @returns {null|{def:object, type:'water'|'lava'|'liquid', params:object}}\n */\nexport function getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  if (wy < 0) return null;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return null;\n  const idx = gy * mapWidthTiles + gx;\n  const id = tileData[idx];\n  if (!id) return null;\n  const def = Array.isArray(registryItems) ? registryItems.find(r => r.id === id) : null;\n  if (!def || !def.flags || !def.flags.liquid) return null;\n  const type = def.flags.water ? 'water' : (def.flags.lava ? 'lava' : 'liquid');\n  const params = {\n    buoyancy: Number(def?.liquid?.buoyancy),\n    dragX: Number(def?.liquid?.drag?.x),\n    dragY: Number(def?.liquid?.drag?.y),\n    surface: !!def?.liquid?.surface,\n    swimmable: def?.flags?.swimmable === true || def?.liquid?.swimmable === true,\n    dps: Number(def?.liquid?.damagePerSecond),\n    // Optional resource models\n    oxygen: {\n      drainPerSecond: Number(def?.liquid?.oxygen?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.oxygen?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.oxygen?.damagePerSecondWhenDepleted)\n    },\n    resistance: {\n      drainPerSecond: Number(def?.liquid?.resistance?.drainPerSecond),\n      regenPerSecond: Number(def?.liquid?.resistance?.regenPerSecond),\n      damagePerSecondWhenDepleted: Number(def?.liquid?.resistance?.damagePerSecondWhenDepleted)\n    }\n  };\n  return { def, type, params };\n}\n\n/**\n * Convenience: returns whether any liquid exists at world pixel.\n */\nexport function isLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems) {\n  return !!getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n}\n\n/**\n * Compute liquid occupancy for a player AABB and derive head/feet status.\n * @returns { inLiquid:boolean, headUnder:boolean, atSurface:boolean, type:string|null, params:object }\n */\nexport function sampleLiquidForAABB({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight, tileData, registryItems }) {\n  const cx = x + width * 0.5;\n  const headY = y + Math.min(4, height * 0.125);\n  const chestY = y + height * 0.45;\n  const feetY = y + height - 2;\n\n  const feet = getLiquidAtPixel(cx, feetY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const chest = getLiquidAtPixel(cx, chestY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n  const head = getLiquidAtPixel(cx, headY, mapWidth, mapHeight, TILE_SIZE, tileData, registryItems);\n\n  const candidate = feet || chest || head;\n  if (!candidate) {\n    return { inLiquid: false, headUnder: false, atSurface: false, type: null, params: null };\n  }\n  const type = candidate.type;\n  // Merge params with sane defaults if missing\n  const p = {\n    buoyancy: Number.isFinite(candidate.params.buoyancy) ? candidate.params.buoyancy : 0.5,\n    dragX: Number.isFinite(candidate.params.dragX) ? candidate.params.dragX : 0.55,\n    dragY: Number.isFinite(candidate.params.dragY) ? candidate.params.dragY : 0.65,\n    surface: !!candidate.params.surface,\n    swimmable: !!candidate.params.swimmable,\n    dps: Number.isFinite(candidate.params.dps) ? Math.max(0, candidate.params.dps) : 0,\n    oxygen: {\n      drainPerSecond: Number.isFinite(candidate.params?.oxygen?.drainPerSecond) ? Math.max(0, candidate.params.oxygen.drainPerSecond) : 20,\n      regenPerSecond: Number.isFinite(candidate.params?.oxygen?.regenPerSecond) ? Math.max(0, candidate.params.oxygen.regenPerSecond) : 35,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.oxygen?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.oxygen.damagePerSecondWhenDepleted) : 10\n    },\n    resistance: {\n      drainPerSecond: Number.isFinite(candidate.params?.resistance?.drainPerSecond) ? Math.max(0, candidate.params.resistance.drainPerSecond) : 25,\n      regenPerSecond: Number.isFinite(candidate.params?.resistance?.regenPerSecond) ? Math.max(0, candidate.params.resistance.regenPerSecond) : 40,\n      damagePerSecondWhenDepleted: Number.isFinite(candidate.params?.resistance?.damagePerSecondWhenDepleted) ? Math.max(0, candidate.params.resistance.damagePerSecondWhenDepleted) : 15\n    }\n  };\n  const inLiquid = !!(feet || chest);\n  const headUnder = !!head;\n  const atSurface = inLiquid && !headUnder;\n  return { inLiquid, headUnder, atSurface, type, params: p };\n}\n\n/**\n * Manage per-second liquid damage. Mutates gameState.current.health and hitTimer.\n * @param {{accRef: {current:number}, gameState: any, JUMP_FORCE?:number}} env\n * @param {number} deltaMs\n * @param {{ dps:number }} params\n */\nexport function tickLiquidDamage(env, deltaMs, params) {\n  const dps = Math.max(0, Number(params?.dps) || 0);\n  if (dps <= 0) { env.accRef.current = 0; return; }\n  env.accRef.current += Math.max(0, Number(deltaMs) || 0);\n  const TICK = 1000;\n  while (env.accRef.current >= TICK) {\n    env.accRef.current -= TICK;\n    const cur = Number(env.gameState.current.health) || 0;\n    env.gameState.current.health = Math.max(0, cur - dps);\n    const HIT_FLASH_MS = 500;\n    const prev = Number(env.gameState.current.hitTimerMs) || 0;\n    env.gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n  }\n}\n\nexport default {\n  getLiquidAtPixel,\n  isLiquidAtPixel,\n  sampleLiquidForAABB,\n  tickLiquidDamage\n};\n","// One-frame update orchestrator (migrated from GameEngine/updateFrame.js)\nimport { moveHorizontal } from '../physics/horizontal';\nimport { applyVerticalPhysics } from '../physics/vertical';\nimport { tickLiquidDamage } from '../liquids/liquidUtils';\n\n// updateFrame(ctx, timestamp)  { continue: boolean }\n// ctx expects:\n// - mapData, objectData\n// - input\n// - refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef }\n// - constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE }\n// - helpers: { checkCollision, isWaterAt, getLiquidSample }\n// - actions: {\n//     collectItem(x, y, mapWidth, objectData),\n//     checkHazardDamage(x, y, mapWidth, objectData, deltaMs),\n//     spawnProjectile(originX, originY, direction),\n//     updateProjectiles(deltaMs, mapWidth, mapHeight),\n//     setPlayer(nextState),\n//     onGameOver()\n//   }\nexport function updateFrame(ctx, timestamp) {\n  const {\n    mapData,\n    objectData,\n    input,\n    refs,\n    constants,\n    helpers,\n    actions\n  } = ctx;\n\n  const { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef } = refs;\n  const { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE } = constants;\n  const { checkCollision, isWaterAt, getLiquidSample } = helpers;\n  const { collectItem, checkInteractables, checkHazardDamage, checkSecrets, spawnProjectile, updateProjectiles, setPlayer, onGameOver } = actions;\n\n  // Keep RAF alive even if init not finished yet\n  if (!isInitialized.current || !mapData) {\n    return { continue: true };\n  }\n\n  // Delta time ms\n  if (!lastTimeRef.current) {\n    lastTimeRef.current = timestamp;\n  }\n  const deltaMs = timestamp - lastTimeRef.current;\n  lastTimeRef.current = timestamp;\n\n  // Pause while terminal is open\n  try {\n    if (window.__GAME_TERMINAL_OPEN__) {\n      return { continue: true };\n    }\n  } catch {}\n\n  const mapWidth = mapData.meta?.width || mapData.width || 20;\n  const mapHeight = mapData.meta?.height || mapData.height || 15;\n  const keys = input.current;\n\n  let {\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    ammo\n  } = gameState.current;\n\n  // 1) Horizontal movement\n  const mh = moveHorizontal({\n    keys,\n    state: { x, y, width, direction },\n    MOVE_SPEED,\n    TILE_SIZE,\n    mapWidth,\n    mapHeight,\n    checkCollision\n  });\n  x = mh.x; vx = mh.vx; direction = mh.direction;\n\n  // 2) Vertical physics\n  const vp = applyVerticalPhysics({\n    keys,\n    x,\n    y,\n    vy,\n    isGrounded,\n    animation,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    JUMP_FORCE,\n    TILE_SIZE,\n    width,\n    height,\n    mapWidth,\n    mapHeight,\n    checkCollision,\n    vx,\n    isWaterAt: (wx, wy) => {\n      try { return typeof isWaterAt === 'function' ? !!isWaterAt(wx, wy) : false; } catch { return false; }\n    },\n    prevInWater: !!gameState.current.inWater\n  });\n  y = vp.y; vy = vp.vy; isGrounded = vp.isGrounded; animation = vp.animation;\n  const inWater = !!vp.inWater;\n  const headUnderWater = !!vp.headUnderWater;\n  const atSurface = !!vp.atSurface;\n\n  // 2.5) Generic liquid sampling (water, lava, etc.)\n  let liquidType = null;\n  let liquidParams = null;\n  if (typeof getLiquidSample === 'function') {\n    try {\n      const sample = getLiquidSample({ x, y, width, height, TILE_SIZE, mapWidth, mapHeight });\n      if (sample && sample.inLiquid) {\n        liquidType = sample.type || null;\n        liquidParams = sample.params || null;\n      }\n      // Reset DPS accumulator if we just left liquids\n      if (!sample || !sample.inLiquid) {\n        if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n      }\n    } catch {}\n  }\n\n  // Extra horizontal damping when in liquids\n  if (inWater || liquidType) {\n    if (liquidType === 'lava') {\n      vx *= 0.78;\n    } else {\n      vx *= 0.82;\n    }\n  }\n\n  // 2.6) Apply liquid damage-per-second if defined (e.g., lava)\n  // Will be gated later for lava by resistance depletion; water dps usually 0.\n\n  // 2.7) Resource bars logic (oxygen & lava resistance indicators)\n  try {\n    const dt = Math.max(0, deltaMs || 0);\n    // Initialize defaults if missing\n    const maxOxy = Math.max(1, Number(gameState.current.maxOxygen || 100));\n    const maxLava = Math.max(1, Number(gameState.current.maxLavaResist || 100));\n    let oxy = Number(gameState.current.oxygen);\n    let lavaRes = Number(gameState.current.lavaResist);\n    if (!Number.isFinite(oxy)) oxy = maxOxy;\n    if (!Number.isFinite(lavaRes)) lavaRes = maxLava;\n    // Resolve per-liquid parameters (with safe defaults)\n    const oxyParams = liquidParams?.oxygen || { drainPerSecond: 20, regenPerSecond: 35, damagePerSecondWhenDepleted: 10 };\n    const lavaParams = liquidParams?.resistance || { drainPerSecond: 25, regenPerSecond: 40, damagePerSecondWhenDepleted: 15 };\n\n    // Oxygen: drains only while head is under water; otherwise regenerates to 100 even after leaving water\n    if (headUnderWater && (liquidType === 'water' || inWater)) {\n      oxy -= (Math.max(0, Number(oxyParams.drainPerSecond) || 0) * dt) / 1000;\n    } else {\n      oxy += (Math.max(0, Number(oxyParams.regenPerSecond) || 0) * dt) / 1000;\n    }\n    // Clamp and write back\n    oxy = Math.max(0, Math.min(maxOxy, oxy));\n    gameState.current.oxygen = oxy;\n    gameState.current.maxOxygen = maxOxy;\n\n    // Lava resistance: drains while in lava; regenerates outside\n    if (liquidType === 'lava') {\n      lavaRes -= (Math.max(0, Number(lavaParams.drainPerSecond) || 0) * dt) / 1000;\n    } else {\n      lavaRes += (Math.max(0, Number(lavaParams.regenPerSecond) || 0) * dt) / 1000;\n    }\n    lavaRes = Math.max(0, Math.min(maxLava, lavaRes));\n    gameState.current.lavaResist = lavaRes;\n    gameState.current.maxLavaResist = maxLava;\n\n    // Apply depletion health damage when at zero and still in corresponding liquid\n    const tickDepleteDps = (accRef, dpsValue) => {\n      const v = Math.max(0, Number(dpsValue) || 0);\n      if (v <= 0) { accRef.current = 0; return; }\n      accRef.current += dt;\n      const T = 1000;\n      while (accRef.current >= T) {\n        accRef.current -= T;\n        gameState.current.health = Math.max(0, (Number(gameState.current.health) || 0) - v);\n        // Hit flash\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n    };\n\n    // Oxygen depleted and still underwater  damage\n    if ((headUnderWater && (liquidType === 'water' || inWater)) && oxy <= 0) {\n      tickDepleteDps(oxygenDepleteAccRef, oxyParams.damagePerSecondWhenDepleted);\n    } else if (oxygenDepleteAccRef) {\n      oxygenDepleteAccRef.current = 0;\n    }\n\n    // Lava resist depleted and still in lava  health damage model is gated by base DPS below\n    if (liquidType === 'lava' && lavaRes <= 0) {\n      if (lavaDepleteAccRef) lavaDepleteAccRef.current = 0;\n    } else if (lavaDepleteAccRef) {\n      lavaDepleteAccRef.current = 0;\n    }\n  } catch {}\n\n  // 2.8) Base liquid DPS (e.g., lava)  only after resource logic so we can gate by resistance\n  if (liquidType && liquidParams && Number(liquidParams.dps) > 0) {\n    try {\n      if (liquidType === 'lava') {\n        const curRes = Math.max(0, Number(gameState.current.lavaResist));\n        if (curRes <= 0) {\n          tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, liquidParams);\n        } else {\n          if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n        }\n      } else {\n        // Other liquids (if any in future) apply their DPS normally\n        tickLiquidDamage({ accRef: liquidDamageAccumulatorRef, gameState }, deltaMs, liquidParams);\n      }\n    } catch {}\n  } else {\n    if (liquidDamageAccumulatorRef) liquidDamageAccumulatorRef.current = 0;\n  }\n\n  // 3) Item collection\n  collectItem(x, y, mapWidth, objectData);\n\n  // 3.5) Interactables check (berry bushes etc.)\n  try { checkInteractables(x, y, mapWidth, objectData); } catch {}\n\n  // 4) Hazard damage check (bushes etc.)\n  try { checkHazardDamage(x, y, mapWidth, objectData, deltaMs); } catch {}\n\n  // 4.5) Secrets detection and reveal\n  try { if (checkSecrets) checkSecrets(x, y, width, height, mapWidth, mapHeight); } catch {}\n\n  // 5) Shooting & projectiles\n  // Cooldown update\n  if (shootCooldownRef.current > 0) shootCooldownRef.current = Math.max(0, shootCooldownRef.current - deltaMs);\n  // Get fresh ammo value after item collection\n  const currentAmmo = Math.max(0, Number(gameState.current.ammo) || 0);\n  if (keys?.mouseLeft && shootCooldownRef.current <= 0 && currentAmmo > 0) {\n    const originX = x + width / 2;\n    const originY = y + height / 2;\n    spawnProjectile(originX, originY, direction >= 0 ? 1 : -1);\n    shootCooldownRef.current = 350; // ms cooldown\n    gameState.current.ammo = Math.max(0, currentAmmo - 1);\n  }\n  // Update existing projectiles\n  try { updateProjectiles(deltaMs, mapWidth, mapHeight); } catch {}\n\n  // 6) Clamp player to world bounds horizontally; allow falling below map to trigger game over\n  const maxX = mapWidth * TILE_SIZE - width;\n  x = Math.max(0, Math.min(maxX, x));\n\n  // 7) Death check\n  if ((Number(gameState.current.health) || 0) <= 0) {\n    try { onGameOver && onGameOver(); } catch {}\n  }\n\n  // 8) Decrement hit flash timer\n  try {\n    if (Number(gameState.current.hitTimerMs) > 0) {\n      gameState.current.hitTimerMs = Math.max(0, Number(gameState.current.hitTimerMs) - deltaMs);\n    }\n  } catch {}\n\n  // 9) Commit new state for renderer\n  gameState.current = {\n    ...gameState.current,\n    x,\n    y,\n    vx,\n    vy,\n    width,\n    height,\n    isGrounded,\n    direction,\n    animation,\n    inWater,\n    headUnderWater,\n    atSurface,\n    liquidType: liquidType || null\n  };\n  setPlayer({ ...gameState.current, projectiles: projectilesRef.current || [] });\n\n  return { continue: true };\n}\n\nexport default null;\n","// Horizontal movement extracted from useGameEngine.js\n\n// Calculates horizontal velocity/direction and resolves horizontal collision with snap.\n// Args:\n// - keys: input state (expects boolean a/d)\n// - state: { x, width, direction }\n// - MOVE_SPEED, TILE_SIZE, mapWidth, mapHeight\n// - checkCollision: function(newX, newY, mapWidth, mapHeight)  boolean\n// Returns: { x, vx, direction }\nexport function moveHorizontal({\n  keys,\n  state,\n  MOVE_SPEED,\n  TILE_SIZE,\n  mapWidth,\n  mapHeight,\n  checkCollision\n}) {\n  let { x, width, direction } = state;\n  let vx = 0;\n\n  if (keys?.a) {\n    vx = -MOVE_SPEED;\n    direction = -1;\n  }\n  if (keys?.d) {\n    vx = MOVE_SPEED;\n    direction = 1;\n  }\n\n  const proposedX = x + vx;\n  if (checkCollision(proposedX, state.y ?? 0, mapWidth, mapHeight)) {\n    if (vx > 0) {\n      // Snap to left edge of the blocking tile\n      x = Math.floor((proposedX + width) / TILE_SIZE) * TILE_SIZE - width;\n    } else if (vx < 0) {\n      // Snap to right edge of the blocking tile\n      x = Math.ceil(proposedX / TILE_SIZE) * TILE_SIZE;\n    }\n    vx = 0;\n  } else {\n    x = proposedX;\n  }\n\n  return { x, vx, direction };\n}\n\nexport default null;\n","// Vertical physics (gravity, jump, vertical collisions)\n// Migrated from GameEngine/applyVerticalPhysics.js to make core the source of truth.\n\n// Args:\n// - keys, x, y, vy, isGrounded, animation\n// - GRAVITY, TERMINAL_VELOCITY, JUMP_FORCE, TILE_SIZE\n// - width, height, mapWidth, mapHeight\n// - checkCollision(newX, newY, mapWidth, mapHeight)\n// - isWaterAt(wx, wy): optional helper to detect liquid tiles at a world pixel\n// - vx: horizontal velocity (for deciding run/idle when landing)\n// - prevInWater: whether player was in water on previous frame\n// Returns: { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface }\nexport function applyVerticalPhysics({\n  keys,\n  x,\n  y,\n  vy,\n  isGrounded,\n  animation,\n  GRAVITY,\n  TERMINAL_VELOCITY,\n  JUMP_FORCE,\n  TILE_SIZE,\n  width,\n  height,\n  mapWidth,\n  mapHeight,\n  checkCollision,\n  vx,\n  isWaterAt,\n  prevInWater\n}) {\n  // Liquid defaults (can be overridden in future via per-tile sampling)\n  const LIQ_BUOYANCY = 0.5; // reduces effective gravity by 50%\n  const LIQ_DRAG_Y = 0.88;  // vertical damping per frame when in liquid\n  const LIQ_TERMINAL = Math.max(2, Math.floor(TERMINAL_VELOCITY * 0.4));\n\n  // Water detection using centerline points\n  let inWater = false;\n  let headUnderWater = false;\n  let atSurface = false;\n  if (typeof isWaterAt === 'function') {\n    const cx = x + (width || TILE_SIZE) * 0.5;\n    const headY = y + Math.min(4, (height || TILE_SIZE) * 0.125);\n    const feetY = y + (height || TILE_SIZE) - 2;\n    const chestY = y + (height || TILE_SIZE) * 0.45;\n    inWater = !!(isWaterAt(cx, feetY) || isWaterAt(cx, chestY));\n    headUnderWater = !!isWaterAt(cx, headY);\n    atSurface = inWater && !headUnderWater;\n  }\n\n  // Jump\n  if (keys?.space || keys?.w) {\n    if (inWater) {\n      // Swim stroke (allow even when not grounded)\n      const swimImpulse = Math.max(2, Math.floor(JUMP_FORCE * 0.55));\n      vy = Math.min(vy, 0); // prevent extra downward boost\n      vy -= swimImpulse * 0.5; // smaller continuous impulse\n      animation = 'jump';\n    } else if (isGrounded) {\n      vy = -JUMP_FORCE;\n      isGrounded = false;\n      animation = 'jump';\n    }\n  }\n\n  // Gravity (reduced in liquid) + vertical drag\n  if (inWater) {\n    // Entrance damping to remove harsh fall shock\n    if (!prevInWater) {\n      vy *= 0.4;\n    }\n    vy += GRAVITY * (1 - LIQ_BUOYANCY);\n    vy *= LIQ_DRAG_Y;\n    if (vy > LIQ_TERMINAL) vy = LIQ_TERMINAL;\n  } else {\n    vy += GRAVITY;\n    if (vy > TERMINAL_VELOCITY) vy = TERMINAL_VELOCITY;\n  }\n\n  // Check vertical collision at proposed Y\n  if (checkCollision(x, y + vy, mapWidth, mapHeight)) {\n    if (vy > 0) {\n      // Landing on ground\n      isGrounded = true;\n      y = Math.floor((y + vy + height) / TILE_SIZE) * TILE_SIZE - height;\n      if (Math.abs(vx || 0) > 0) {\n        animation = 'run';\n      } else {\n        animation = 'idle';\n      }\n    } else if (vy < 0) {\n      // Hitting ceiling\n      y = Math.ceil((y + vy) / TILE_SIZE) * TILE_SIZE;\n    }\n    vy = 0;\n  } else {\n    // Free fall\n    isGrounded = false;\n    y += vy;\n    if (vy > 0) {\n      animation = 'fall';\n    }\n  }\n\n  return { y, vy, isGrounded, animation, inWater, headUnderWater, atSurface };\n}\n\nexport default null;\n","// Collision helpers (migrated from GameEngine/collision.js)\n\n// Check whether a world pixel (wx, wy) is solid (collides with a tile)\n// Params:\n// - wx, wy: world pixel coordinates\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE: tile size in pixels\n// - tileData: tile layer array (ids)\n// - registryItems: registry to resolve tile definitions (with `collision` flag)\n// - secretData: secret layer array (ids) - tiles with secrets are passable\nexport function isSolidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, secretData) {\n  // Allow movement above the map\n  if (wy < 0) return false;\n  const gx = Math.floor(wx / TILE_SIZE);\n  const gy = Math.floor(wy / TILE_SIZE);\n  // Out of world is not solid (projectile/later logic will clamp by bounds)\n  if (gx < 0 || gy < 0 || gx >= mapWidthTiles || gy >= mapHeightTiles) return false;\n  const index = gy * mapWidthTiles + gx;\n\n  // Check if this tile has a secret - secrets make tiles passable\n  if (secretData && secretData[index]) {\n    return false;\n  }\n\n  const tileId = tileData[index];\n  if (!tileId) return false;\n  const tileDef = registryItems.find(r => r.id === tileId);\n  if (!tileDef || !tileDef.collision) return false;\n  if (tileDef.collision === true) return true;\n  if (typeof tileDef.collision === 'object') {\n    return !!(\n      tileDef.collision.top ||\n      tileDef.collision.bottom ||\n      tileDef.collision.left ||\n      tileDef.collision.right\n    );\n  }\n  return false;\n}\n\n// AABB collision check for player rectangle at (newX, newY)\n// Params:\n// - newX, newY: proposed player top-left position (pixels)\n// - mapWidthTiles, mapHeightTiles: map size in tiles\n// - TILE_SIZE, tileData, registryItems: see above\n// - width, height: player size in pixels\n// - secretData: secret layer array (ids) - tiles with secrets are passable\nexport function checkCollision(newX, newY, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems, width, height, secretData) {\n  const points = [\n    { x: newX, y: newY }, // Top Left\n    { x: newX + width - 0.01, y: newY }, // Top Right\n    { x: newX, y: newY + height - 0.01 }, // Bottom Left\n    { x: newX + width - 0.01, y: newY + height - 0.01 } // Bottom Right\n  ];\n\n  for (let p of points) {\n    const gridX = Math.floor(p.x / TILE_SIZE);\n    const gridY = Math.floor(p.y / TILE_SIZE);\n    const index = gridY * mapWidthTiles + gridX;\n\n    // Out-of-bounds horizontally or above map is treated as solid to prevent escaping\n    if (gridX < 0 || gridX >= mapWidthTiles || gridY < 0) return true;\n    // Below the map is not a collision  allows falling off the world\n    if (gridY >= mapHeightTiles) continue;\n\n    // Check if this tile has a secret - secrets make tiles passable\n    if (secretData && secretData[index]) {\n      continue;\n    }\n\n    const tileId = tileData[index];\n    if (tileId) {\n      const tileDef = registryItems.find(r => r.id === tileId);\n      if (tileDef && tileDef.collision) return true;\n    }\n  }\n  return false;\n}\n\nexport default {\n  isSolidAtPixel,\n  checkCollision,\n};\n","/**\n * Centralized Error Handler\n * Provides unified error handling and logging across the application\n */\n\nclass ErrorHandler {\n  constructor() {\n    this.errorListeners = [];\n    this.logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';\n  }\n\n  /**\n   * Log levels: debug, info, warn, error\n   */\n  setLogLevel(level) {\n    this.logLevel = level;\n  }\n\n  /**\n   * Add error listener callback\n   * @param {Function} callback - Callback function to receive errors\n   */\n  addListener(callback) {\n    this.errorListeners.push(callback);\n  }\n\n  /**\n   * Remove error listener callback\n   * @param {Function} callback - Callback to remove\n   */\n  removeListener(callback) {\n    this.errorListeners = this.errorListeners.filter(cb => cb !== callback);\n  }\n\n  /**\n   * Notify all listeners of an error\n   * @param {Error} error - The error object\n   * @param {Object} context - Additional context information\n   */\n  notifyListeners(error, context = {}) {\n    this.errorListeners.forEach(callback => {\n      try {\n        callback(error, context);\n      } catch (err) {\n        console.error('Error in error listener:', err);\n      }\n    });\n  }\n\n  /**\n   * Handle and log an error\n   * @param {Error|string} error - The error to handle\n   * @param {Object} context - Additional context information\n   * @param {string} level - Log level (debug, info, warn, error)\n   */\n  handle(error, context = {}, level = 'error') {\n    const errorObj = error instanceof Error ? error : new Error(String(error));\n    const timestamp = new Date().toISOString();\n\n    const logData = {\n      timestamp,\n      level,\n      message: errorObj.message,\n      stack: errorObj.stack,\n      context,\n    };\n\n    // Console logging based on level\n    if (this.shouldLog(level)) {\n      const logMethod = console[level] || console.error;\n      logMethod(`[${timestamp}] [${level.toUpperCase()}]`, errorObj.message, context);\n\n      if (errorObj.stack && level === 'error') {\n        console.error(errorObj.stack);\n      }\n    }\n\n    // Notify listeners\n    if (level === 'error' || level === 'warn') {\n      this.notifyListeners(errorObj, context);\n    }\n\n    // In development, you could send to external logging service\n    if (process.env.NODE_ENV === 'production') {\n      this.sendToLoggingService(logData);\n    }\n\n    return errorObj;\n  }\n\n  /**\n   * Determine if a log level should be printed based on current log level setting\n   * @param {string} level - The log level to check\n   * @returns {boolean}\n   */\n  shouldLog(level) {\n    const levels = { debug: 0, info: 1, warn: 2, error: 3 };\n    const currentLevel = levels[this.logLevel] || 0;\n    const messageLevel = levels[level] || 0;\n    return messageLevel >= currentLevel;\n  }\n\n  /**\n   * Send error data to external logging service (stub for now)\n   * @param {Object} logData - The log data to send\n   */\n  sendToLoggingService(logData) {\n    // TODO: Implement integration with external logging service\n    // (e.g., Sentry, LogRocket, etc.)\n  }\n\n  /**\n   * Convenience methods for different log levels\n   */\n  debug(message, context = {}) {\n    return this.handle(message, context, 'debug');\n  }\n\n  info(message, context = {}) {\n    return this.handle(message, context, 'info');\n  }\n\n  warn(message, context = {}) {\n    return this.handle(message, context, 'warn');\n  }\n\n  error(message, context = {}) {\n    return this.handle(message, context, 'error');\n  }\n\n  /**\n   * Wrap an async function with error handling\n   * @param {Function} fn - The async function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapAsync(fn, context = {}) {\n    return async (...args) => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Wrap a sync function with error handling\n   * @param {Function} fn - The function to wrap\n   * @param {Object} context - Additional context for errors\n   * @returns {Function} Wrapped function\n   */\n  wrapSync(fn, context = {}) {\n    return (...args) => {\n      try {\n        return fn(...args);\n      } catch (error) {\n        this.handle(error, { ...context, args }, 'error');\n        throw error;\n      }\n    };\n  }\n}\n\n// Export singleton instance\nconst errorHandler = new ErrorHandler();\n\nexport default errorHandler;\nexport { ErrorHandler };\n","import { useState, useEffect, useRef } from 'react';\nimport { useInput } from './useInput';\nimport { findItemById } from '../engine/registry';\nimport { checkHazardDamage, spawnProjectile as spawnProjectileExternal, collectItem, checkInteractables, updateProjectiles } from '../engine/gameplay';\nimport { checkSecretDetection } from '../engine/gameplay/secrets';\nimport { playSfx } from '../engine/audio';\nimport { updateFrame } from '../engine/loop/updateFrame';\nimport { getLiquidAtPixel, isLiquidAtPixel as isLiquidAtPixelUtil, sampleLiquidForAABB } from '../engine/liquids/liquidUtils';\nimport { isSolidAtPixel as isSolidAtPixelExternal, checkCollision as checkCollisionExternal } from '../engine/physics';\nimport {\n    TILE_SIZE,\n    GRAVITY,\n    TERMINAL_VELOCITY,\n    MOVE_SPEED,\n    JUMP_FORCE,\n    MAX_HEALTH,\n    MAX_OXYGEN,\n    MAX_LAVA_RESIST\n} from '../constants/gameConstants';\nimport errorHandler from '../services/errorHandler';\n\n// Helper: accept boolean or string values like \"true\"/\"false\"\nconst parseBool = (v, def = false) => {\n    if (typeof v === 'boolean') return v;\n    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';\n    return def;\n};\n\n// Modified arguments: added objectData, secretData, revealedSecrets, onRevealSecret\nexport const useGameEngine = (mapData, tileData, objectData, secretData, revealedSecrets, registryItems, onGameOver, onStateUpdate, onRevealSecret) => {\n    const input = useInput();\n\n    // Player state\n    const [player, setPlayer] = useState({\n        x: 0, // In pixels\n        y: 0, // In pixels\n        width: 32, // Default, will be overwritten from registry\n        height: 32,\n        vx: 0,\n        vy: 0,\n        isGrounded: false,\n        direction: 1, // 1 right, -1 left\n        animation: 'idle', // idle, run, jump\n        health: 90, // Initial health (for testing, to allow picking up hearts)\n        maxHealth: MAX_HEALTH,\n        ammo: 0, // Fireball ammunition\n        // New resources for display\n        oxygen: MAX_OXYGEN,\n        maxOxygen: MAX_OXYGEN,\n        lavaResist: MAX_LAVA_RESIST,\n        maxLavaResist: MAX_LAVA_RESIST,\n        projectiles: [] // Active projectiles for rendering\n  });\n\n    // Ref objects for game logic\n    const gameState = useRef({ ...player });               // Player state for loop (avoids closure issues)\n    const requestRef = useRef();                           // requestAnimationFrame id\n    const isInitialized = useRef(false);                   // Whether game is initialized\n    const lastTimeRef = useRef(0);                         // Time between frames (t)\n    const hazardDamageAccumulatorRef = useRef(0);          // Accumulated time for hazard damage over time\n    const lastHazardIndexRef = useRef(null);               // Last hazard tile index cache (to associate damage with specific hazard)\n    const triggeredHazardsRef = useRef(new Set());         // Hazards with damageOnce: true that have already triggered\n    const projectilesRef = useRef([]);                     // Active projectiles\n    const shootCooldownRef = useRef(0);                    // Remaining cooldown time (ms)\n    const projectileIdRef = useRef(1);                     // Auto-incrementing ID\n    const soundEnabledRef = useRef(false);                 // Global sound toggle\n    const audioCtxRef = useRef(null);                      // WebAudio context (fallback)\n    const audioCtxUnlockedRef = useRef(false);             // Whether AudioContext is unlocked with user gesture\n    const liquidDamageAccumulatorRef = useRef(0);          // Accumulated time for liquid DPS ticking (e.g., lava)\n    const oxygenDepleteAccRef = useRef(0);                 // O2 depletion DPS accumulator\n    const lavaDepleteAccRef = useRef(0);                   // Lava resist depletion DPS accumulator\n\n    // Sync global sound toggle from localStorage and events\n    useEffect(() => {\n        try {\n            const v = localStorage.getItem('game_sound_enabled');\n            soundEnabledRef.current = (v === null ? false : v !== '0');\n        } catch { soundEnabledRef.current = false; }\n        const onToggle = (e) => {\n            try {\n                const enabled = !!(e?.detail?.enabled);\n                soundEnabledRef.current = enabled;\n            } catch {}\n        };\n        window.addEventListener('game-sound-toggle', onToggle);\n        // AudioContext unlocking with user gesture (click on HUD button, etc.)\n        const onUserGesture = () => {\n            try {\n                if (!audioCtxRef.current) {\n                    const AC = window.AudioContext || window.webkitAudioContext;\n                    if (AC) audioCtxRef.current = new AC();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'suspended') {\n                    audioCtxRef.current.resume?.();\n                }\n                if (audioCtxRef.current && audioCtxRef.current.state === 'running') {\n                    audioCtxUnlockedRef.current = true;\n                }\n            } catch {}\n        };\n        window.addEventListener('game-sound-user-gesture', onUserGesture);\n        return () => {\n            window.removeEventListener('game-sound-toggle', onToggle);\n            window.removeEventListener('game-sound-user-gesture', onUserGesture);\n        };\n    }, []);\n\n    // Helper function: play SFX (delegated to GameEngine/audio)\n    const playShotSfx = (url, volume) => {\n        return playSfx({ soundEnabledRef, audioCtxRef, audioCtxUnlockedRef }, url, volume);\n    };\n\n    // Adapter: correctly calls GameEngine/checkHazardDamage with options object\n    const checkHazardDamageWrapper = (currentX, currentY, mapWidth, objectLayerData, deltaMs) => {\n        try {\n            return checkHazardDamage({\n                currentX,\n                currentY,\n                mapWidth,\n                objectLayerData,\n                deltaMs,\n                registryItems,\n                TILE_SIZE,\n                MOVE_SPEED,\n                JUMP_FORCE,\n                hazardDamageAccumulatorRef,\n                lastHazardIndexRef,\n                triggeredHazardsRef,\n                gameState\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkHazardDamageWrapper',\n                playerPosition: { x: currentX, y: currentY },\n                mapWidth\n            });\n            return { damage: 0, damageType: null };\n        }\n    };\n\n    // Track revealed secrets locally to prevent duplicate reveals before state updates\n    const localRevealedRef = useRef(new Set());\n\n    // Secrets detection wrapper\n    const checkSecretsWrapper = (currentX, currentY, width, height, mapWidth, mapHeight) => {\n        try {\n            if (!secretData || !onRevealSecret) return;\n\n            // Merge prop revealedSecrets with local tracking\n            const mergedRevealed = [\n                ...(revealedSecrets || []),\n                ...Array.from(localRevealedRef.current)\n            ];\n\n            const indicesToReveal = checkSecretDetection({\n                currentX,\n                currentY,\n                width,\n                height,\n                secretMapData: secretData,\n                revealedSecrets: mergedRevealed,\n                mapWidth,\n                mapHeight,\n                registryItems,\n                TILE_SIZE\n            });\n\n            if (indicesToReveal && indicesToReveal.length > 0) {\n                // Add to local tracking immediately (before state updates)\n                indicesToReveal.forEach(idx => localRevealedRef.current.add(idx));\n                onRevealSecret(indicesToReveal);\n            }\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'useGameEngine',\n                function: 'checkSecretsWrapper',\n                playerPosition: { x: currentX, y: currentY }\n            });\n        }\n    };\n\n    // Initialize player at starting position\n    // Important: This effect now depends ONLY on mapData (which doesn't change when collecting items)\n    useEffect(() => {\n        // Reset hazard state when map changes\n        isInitialized.current = false;\n        lastTimeRef.current = 0;\n        hazardDamageAccumulatorRef.current = 0;\n        lastHazardIndexRef.current = null;\n        triggeredHazardsRef.current = new Set();\n        projectilesRef.current = [];\n        shootCooldownRef.current = 0;\n        projectileIdRef.current = 1;\n\n        if (mapData && mapData.layers) {\n            const mapW = mapData.meta?.width || mapData.width || 20;\n            const mapH = mapData.meta?.height || mapData.height || 15;\n            const objLayer = mapData.layers.find(l => l.name === 'entities');\n            if (objLayer) {\n                // Search for player (anything containing 'player')\n                const startIndex = objLayer.data.findIndex(id => id && id.includes('player'));\n\n                if (startIndex !== -1) {\n                    let startX = (startIndex % mapW) * TILE_SIZE;\n                    let startY = Math.floor(startIndex / mapW) * TILE_SIZE;\n\n                    // Get data from registry\n                    const playerId = objLayer.data[startIndex];\n                    const registryPlayer = findItemById(playerId) || findItemById(\"player\"); // Fallback to generic player\n                    const maxHealth = Math.max(1, Number(registryPlayer?.maxHealth) || MAX_HEALTH);\n\n                    // Completely overwrite gameState with default values + new position\n                    gameState.current = {\n                        x: startX,\n                        y: startY,\n                        width: (registryPlayer?.width || 1) * TILE_SIZE * 0.8,\n                        height: (registryPlayer?.height || 1) * TILE_SIZE,\n                        vx: 0,\n                        vy: 0,\n                        isGrounded: false,\n                        direction: 1,\n                        animation: 'idle',\n                        health: Math.min(90, maxHealth), // Reset to 90 (not MAX) to allow testing items\n                        maxHealth,\n                        ammo: 0,\n                        // resources\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST\n                    };\n\n                    // If start position sinks into block, move up to safe location\n                    let guard = 0;\n                    while (checkCollision(gameState.current.x, gameState.current.y, mapW, mapH) && guard < mapH) {\n                        gameState.current.y = Math.max(0, gameState.current.y - TILE_SIZE);\n                        guard++;\n                    }\n                    // Ensure we're not outside world boundaries horizontally\n                    const maxXAtStart = mapW * TILE_SIZE - gameState.current.width;\n                    gameState.current.x = Math.max(0, Math.min(gameState.current.x, maxXAtStart));\n\n                    setPlayer({ ...gameState.current, projectiles: [] });\n                    isInitialized.current = true;\n                } else {\n                    // If player not found in map, place at 0,0 or some safe location\n                    gameState.current = {\n                        ...gameState.current,\n                        x: 0,\n                        y: 0,\n                        vx: 0,\n                        vy: 0,\n                        oxygen: MAX_OXYGEN,\n                        maxOxygen: MAX_OXYGEN,\n                        lavaResist: MAX_LAVA_RESIST,\n                        maxLavaResist: MAX_LAVA_RESIST\n                    };\n                    setPlayer({ ...gameState.current, projectiles: [] });\n                    isInitialized.current = true; // allow loop to work even without start position\n                }\n            } else {\n                // No entities layer  still start game at 0,0\n                gameState.current = {\n                    ...gameState.current,\n                    x: 0,\n                    y: 0,\n                    vx: 0,\n                    vy: 0,\n                    oxygen: MAX_OXYGEN,\n                    maxOxygen: MAX_OXYGEN,\n                    lavaResist: MAX_LAVA_RESIST,\n                    maxLavaResist: MAX_LAVA_RESIST\n                };\n                setPlayer({ ...gameState.current, projectiles: [] });\n                isInitialized.current = true;\n            }\n        }\n    }, [mapData]);\n\n    // Helper function for collisions (AABB Collision) with blocks (tile layer)  delegates to GameEngine/collision\n    const checkCollision = (newX, newY, mapWidth, mapHeightParam) => {\n        return checkCollisionExternal(\n            newX,\n            newY,\n            mapWidth,\n            mapHeightParam,\n            TILE_SIZE,\n            tileData,\n            registryItems,\n            gameState.current.width,\n            gameState.current.height,\n            secretData\n        );\n    };\n\n    // Simple point solidity check for projectiles  delegates to GameEngine/collision\n    const isSolidAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        return isSolidAtPixelExternal(\n            wx,\n            wy,\n            mapWidthTiles,\n            mapHeightTiles,\n            TILE_SIZE,\n            tileData,\n            registryItems,\n            secretData\n        );\n    };\n\n    // New: water presence check at a world pixel\n    const isWaterAtPixel = (wx, wy, mapWidthTiles, mapHeightTiles) => {\n        // Strict: Only treat WATER as buoyant/swimmable in vertical physics\n        const liq = getLiquidAtPixel(wx, wy, mapWidthTiles, mapHeightTiles, TILE_SIZE, tileData, registryItems);\n        return !!(liq && liq.type === 'water');\n    };\n\n    // Liquid sampling helper for update loop (AABB based)\n    const sampleLiquid = (aabb, mapWidthTiles, mapHeightTiles) => {\n        return sampleLiquidForAABB({\n            x: aabb.x,\n            y: aabb.y,\n            width: aabb.width,\n            height: aabb.height,\n            TILE_SIZE,\n            mapWidth: mapWidthTiles,\n            mapHeight: mapHeightTiles,\n            tileData,\n            registryItems\n        });\n    };\n\n    // Item collection  moved to GameEngine/collectItem\n\n    // Helper function: create new projectile  moved to separate module\n    const spawnProjectile = (originX, originY, direction) => {\n        return spawnProjectileExternal({\n            findItemById,\n            TILE_SIZE,\n            parseBool,\n            projectilesRef,\n            projectileIdRef,\n            playShotSfx\n        }, originX, originY, direction);\n    };\n\n    // Game Loop (delegated to GameEngine/updateFrame)\n    const update = (timestamp) => {\n        const ctx = {\n            mapData,\n            objectData,\n            input,\n            refs: { gameState, isInitialized, lastTimeRef, projectilesRef, shootCooldownRef, liquidDamageAccumulatorRef, oxygenDepleteAccRef, lavaDepleteAccRef },\n            constants: { TILE_SIZE, GRAVITY, TERMINAL_VELOCITY, MOVE_SPEED, JUMP_FORCE },\n            helpers: {\n                checkCollision,\n                isWaterAt: (wx, wy) => isWaterAtPixel(wx, wy, (mapData?.meta?.width || mapData?.width || 20), (mapData?.meta?.height || mapData?.height || 15)),\n                getLiquidSample: ({ x, y, width, height, TILE_SIZE: TS, mapWidth, mapHeight }) =>\n                    sampleLiquid({ x, y, width, height }, (mapData?.meta?.width || mapData?.width || 20), (mapData?.meta?.height || mapData?.height || 15))\n            },\n            actions: {\n                collectItem: (x, y, mapWidth, objectLayer) =>\n                    collectItem({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState }, x, y, mapWidth, objectLayer),\n                checkInteractables: (x, y, mapWidth, objectLayer) =>\n                    checkInteractables({ registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState }, x, y, mapWidth, objectLayer),\n                checkHazardDamage: (x, y, mapWidth, objectLayer, deltaMs) =>\n                    checkHazardDamageWrapper(x, y, mapWidth, objectLayer, deltaMs),\n                checkSecrets: (x, y, width, height, mapWidth, mapHeight) =>\n                    checkSecretsWrapper(x, y, width, height, mapWidth, mapHeight),\n                spawnProjectile: (originX, originY, direction) =>\n                    spawnProjectile(originX, originY, direction),\n                updateProjectiles: (deltaMs, mapWidth, mapHeight) =>\n                    updateProjectiles({ projectilesRef, TILE_SIZE, isSolidAtPixel, findItemById }, deltaMs, mapWidth, mapHeight),\n                setPlayer: (next) => setPlayer(next),\n                onGameOver\n            }\n        };\n        const res = updateFrame(ctx, timestamp);\n        if (res?.continue !== false) {\n            requestRef.current = requestAnimationFrame(update);\n        }\n    };\n\n    // Loop initialization / restart\n    useEffect(() => {\n        requestRef.current = requestAnimationFrame(update);\n        return () => cancelAnimationFrame(requestRef.current);\n    }, [mapData, tileData, objectData]); // Restart loop if map or objects change\n\n    return player;\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useInput = () => {\n    const keys = useRef({\n        w: false,\n        a: false,\n        s: false,\n        d: false,\n        space: false,\n        mouseLeft: false\n    });\n\n    useEffect(() => {\n        const isTerminalOpen = () => {\n            try { return !!window.__GAME_TERMINAL_OPEN__; } catch { return false; }\n        };\n\n        const clearKeys = () => {\n            keys.current.w = false;\n            keys.current.a = false;\n            keys.current.s = false;\n            keys.current.d = false;\n            keys.current.space = false;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyDown = (e) => {\n            // Do not toggle when typing into inputs/textareas/contenteditable\n            const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : '';\n            const typing = tag === 'INPUT' || tag === 'TEXTAREA' || (e.target && e.target.isContentEditable);\n\n            // Toggle in-game terminal with 'T'\n            if (!typing && e.code === 'KeyT' && !e.repeat) {\n                try { window.dispatchEvent(new CustomEvent('game-toggle-terminal')); } catch {}\n                clearKeys();\n                // prevent game movement while toggling\n                if (typeof e.preventDefault === 'function') e.preventDefault();\n                return;\n            }\n\n            // Prevent browser scrolling / focus hijack for game controls only when NOT typing and terminal is closed\n            if (!typing && !isTerminalOpen()) {\n                switch (e.code) {\n                    case 'KeyW':\n                    case 'ArrowUp':\n                    case 'KeyA':\n                    case 'ArrowLeft':\n                    case 'KeyS':\n                    case 'ArrowDown':\n                    case 'KeyD':\n                    case 'ArrowRight':\n                    case 'Space':\n                        if (typeof e.preventDefault === 'function') e.preventDefault();\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            // If terminal is open, ignore gameplay inputs so player doesn't move while typing\n            if (isTerminalOpen()) return;\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = true; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = true; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = true; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = true; break;\n                case 'Space': keys.current.space = true; break;\n                default: break;\n            }\n        };\n\n        const handleMouseDown = (e) => {\n            // Left button only\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = true;\n        };\n\n        const handleMouseUp = (e) => {\n            if (e.button !== 0) return;\n            if (isTerminalOpen()) return;\n            keys.current.mouseLeft = false;\n        };\n\n        const handleKeyUp = (e) => {\n            // Allow closing terminal with Escape (terminal component also handles it)\n            if (e.code === 'Escape') return;\n\n            if (isTerminalOpen()) {\n                // When terminal is open, we do not change gameplay key states here\n                return;\n            }\n\n            switch (e.code) {\n                case 'KeyW':\n                case 'ArrowUp':\n                    keys.current.w = false; break;\n                case 'KeyA':\n                case 'ArrowLeft':\n                    keys.current.a = false; break;\n                case 'KeyS':\n                case 'ArrowDown':\n                    keys.current.s = false; break;\n                case 'KeyD':\n                case 'ArrowRight':\n                    keys.current.d = false; break;\n                case 'Space': keys.current.space = false; break;\n                default: break;\n            }\n        };\n\n        const onToggleTerminal = () => clearKeys();\n\n        // non-passive to allow preventDefault on Space/Arrow keys\n        window.addEventListener('keydown', handleKeyDown, { passive: false });\n        window.addEventListener('keyup', handleKeyUp, { passive: false });\n        window.addEventListener('game-toggle-terminal', onToggleTerminal);\n        window.addEventListener('mousedown', handleMouseDown, { passive: true });\n        window.addEventListener('mouseup', handleMouseUp, { passive: true });\n\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, { passive: false });\n            window.removeEventListener('keyup', handleKeyUp, { passive: false });\n            window.removeEventListener('game-toggle-terminal', onToggleTerminal);\n            window.removeEventListener('mousedown', handleMouseDown, { passive: true });\n            window.removeEventListener('mouseup', handleMouseUp, { passive: true });\n        };\n    }, []);\n\n    return keys;\n};","// Hazard damage calculation (migrated from GameEngine/checkHazardDamage.js)\n\nexport function checkHazardDamage({\n  currentX,\n  currentY,\n  mapWidth,\n  objectLayerData,\n  deltaMs,\n  registryItems,\n  TILE_SIZE,\n  MOVE_SPEED,\n  JUMP_FORCE,\n  hazardDamageAccumulatorRef,\n  lastHazardIndexRef,\n  triggeredHazardsRef,\n  gameState\n}) {\n  if (!objectLayerData) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  const width = gameState.current.width;\n  const height = gameState.current.height;\n\n  // Player AABB in world pixels\n  const playerLeft = currentX;\n  const playerRight = currentX + width;\n  const playerTop = currentY;\n  const playerBottom = currentY + height;\n\n  // Overlapped tile rectangle (inclusive)\n  const minGX = Math.floor(playerLeft / TILE_SIZE);\n  const maxGX = Math.floor((playerRight - 1) / TILE_SIZE);\n  const minGY = Math.floor(playerTop / TILE_SIZE);\n  const maxGY = Math.floor((playerBottom - 1) / TILE_SIZE);\n\n  // Collect candidate hazards that match direction rules\n  const candidates = [];\n\n  const pushCandidate = (idx, def, touch) => {\n    const dirs = def.damageDirections || { top: true, bottom: true, left: true, right: true };\n    const ok = (touch.top && dirs.top) || (touch.bottom && dirs.bottom) || (touch.left && dirs.left) || (touch.right && dirs.right);\n    if (!ok) return;\n    candidates.push({ index: idx, def, touch });\n  };\n\n  for (let gy = minGY; gy <= maxGY; gy++) {\n    for (let gx = minGX; gx <= maxGX; gx++) {\n      const idx = gy * mapWidth + gx;\n      if (idx < 0 || idx >= objectLayerData.length) continue;\n      const objId = objectLayerData[idx];\n      if (!objId) continue;\n      const def = registryItems.find(r => r.id === objId);\n      if (!def || def.type !== 'hazard') continue;\n\n      const tileLeft = gx * TILE_SIZE;\n      const tileRight = tileLeft + TILE_SIZE;\n      const tileTop = gy * TILE_SIZE;\n      const tileBottom = tileTop + TILE_SIZE;\n\n      const overlapsHorizontally = playerRight > tileLeft && playerLeft < tileRight;\n      const overlapsVertically = playerBottom > tileTop && playerTop < tileBottom;\n      if (!overlapsHorizontally || !overlapsVertically) continue;\n\n      // Allow per-hazard touch margin; default 4px\n      let m = Number(def.touchMargin);\n      if (!Number.isFinite(m)) m = 4;\n      m = Math.max(1, Math.min(8, m));\n\n      let touchingTop = playerBottom >= tileTop && playerBottom <= tileTop + m;\n      let touchingBottom = playerTop <= tileBottom && playerTop >= tileBottom - m;\n      let touchingLeft = playerRight >= tileRight - m && playerRight <= tileRight;\n      let touchingRight = playerLeft <= tileLeft + m && playerLeft >= tileLeft;\n\n      // Fallback: infer side by smallest penetration when inside tile\n      if (!touchingTop && !touchingBottom && !touchingLeft && !touchingRight) {\n        const distTop = Math.abs(playerBottom - tileTop);\n        const distBottom = Math.abs(tileBottom - playerTop);\n        const distLeft = Math.abs(playerRight - tileLeft);\n        const distRight = Math.abs(tileRight - playerLeft);\n        const min = Math.min(distTop, distBottom, distLeft, distRight);\n        touchingTop = (min === distTop);\n        touchingBottom = (!touchingTop && min === distBottom);\n        touchingLeft = (!touchingTop && !touchingBottom && min === distLeft);\n        touchingRight = (!touchingTop && !touchingBottom && !touchingLeft);\n      }\n\n      pushCandidate(idx, def, { top: touchingTop, bottom: touchingBottom, left: touchingLeft, right: touchingRight });\n    }\n  }\n\n  if (candidates.length === 0) {\n    hazardDamageAccumulatorRef.current = 0;\n    lastHazardIndexRef.current = null;\n    return;\n  }\n\n  // Choose deterministic candidate: prefer top > bottom > left > right\n  const sideScore = (t) => (t.top ? 4 : 0) + (t.bottom ? 3 : 0) + (t.left ? 2 : 0) + (t.right ? 1 : 0);\n  candidates.sort((a, b) => sideScore(b.touch) - sideScore(a.touch));\n  const chosen = candidates[0];\n  const index = chosen.index;\n  const objDef = chosen.def;\n  const touch = chosen.touch;\n\n  // Update active hazard index\n  const prevIndex = lastHazardIndexRef.current;\n  lastHazardIndexRef.current = index;\n\n  const damageOnce = !!objDef.damageOnce;\n  const baseDamage = objDef.damage ?? 0;\n  const dps = objDef.damagePerSecond ?? baseDamage;\n\n  if (damageOnce) {\n    if (!triggeredHazardsRef.current.has(index)) {\n      triggeredHazardsRef.current.add(index);\n      gameState.current.health = Math.max(0, gameState.current.health - baseDamage);\n      // Hit flash to trigger temporary target animation\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      if (touch.top) {\n        gameState.current.vy = -JUMP_FORCE * 0.4;\n      } else if (touch.left) {\n        gameState.current.vx = -MOVE_SPEED * 1.5;\n      } else if (touch.right) {\n        gameState.current.vx = MOVE_SPEED * 1.5;\n      }\n      return;\n    }\n  } else {\n    // Continuous DPS: reset accumulator if we switched tiles\n    const firstTouch = prevIndex !== index;\n    if (firstTouch) {\n      // Immediate damage on first contact, then start ticking\n      hazardDamageAccumulatorRef.current = 0;\n      const immediate = Number.isFinite(baseDamage) && baseDamage > 0 ? baseDamage : dps;\n      if (immediate > 0) {\n        gameState.current.health = Math.max(0, gameState.current.health - immediate);\n        // Hit flash on immediate hit\n        const HIT_FLASH_MS = 500;\n        const prev = Number(gameState.current.hitTimerMs) || 0;\n        gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n      }\n      // Skip DPS accumulation this same frame to avoid double damage on long frames\n      return;\n    }\n\n    hazardDamageAccumulatorRef.current += deltaMs;\n    const TICK_MS = 1000;\n    while (hazardDamageAccumulatorRef.current >= TICK_MS) {\n      hazardDamageAccumulatorRef.current -= TICK_MS;\n      gameState.current.health = Math.max(0, gameState.current.health - dps);\n      // Refresh hit timer on each damage tick\n      const HIT_FLASH_MS = 500;\n      const prev = Number(gameState.current.hitTimerMs) || 0;\n      gameState.current.hitTimerMs = Math.max(prev, HIT_FLASH_MS);\n    }\n  }\n}\n\nexport default null;\n","// Projectile spawning extracted from useGameEngine.js\n\nexport function spawnProjectile(ctx, originX, originY, direction) {\n  const { findItemById, TILE_SIZE, parseBool, projectilesRef, projectileIdRef, playShotSfx } = ctx;\n\n  const pDef = findItemById('fireball_basic');\n  const id = projectileIdRef.current++;\n  const w = Math.max(2, ((pDef?.width || 0.25) * TILE_SIZE));\n  const h = Math.max(2, ((pDef?.height || 0.25) * TILE_SIZE));\n  const speedPxPerSec = (pDef?.speed ? pDef.speed * 60 : 14 * 60);\n  const vx = (direction >= 0 ? 1 : -1) * speedPxPerSec;\n  const vy = 0;\n  const life = Math.max(200, pDef?.lifespan || 600);\n  const ricochetFlag = (typeof pDef?.ricochetOnTiles !== 'undefined')\n    ? !!pDef.ricochetOnTiles\n    : parseBool(pDef?.collisionWithPenetration, true);\n\n  const proj = {\n    id,\n    x: originX,\n    y: originY,\n    vx,\n    vy,\n    w,\n    h,\n    life,\n    defId: pDef?.id || 'fireball_basic',\n    dir: direction >= 0 ? 1 : -1,\n    cwt: !!(pDef && pDef.collisionWithTiles),\n    hbs: Math.max(0.1, Math.min(1.0, (pDef?.hitboxScale ?? 1))),\n    ric: ricochetFlag\n  };\n  projectilesRef.current.push(proj);\n\n  try {\n    const vol = Math.max(0, Math.min(1, pDef?.sfxVolume ?? 1));\n    playShotSfx(pDef?.sfx, vol);\n  } catch {}\n}\n","// Item collection extracted from useGameEngine.js\n\n// Collects item under player's center if pickup-able.\n// Args (ctx): { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState }\n// Params: currentX, currentY, mapWidth, objectLayerData\nexport function collectItem(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const itemId = objectLayerData[index];\n  if (!itemId) return;\n\n  const itemDef = registryItems.find(r => r.id === itemId);\n  if (!itemDef || !itemDef.pickup || itemId.includes('player')) return;\n\n  // Skip interactables - they are handled by checkInteractables()\n  if (itemDef.name && itemDef.name.startsWith('interactable.')) return;\n\n  // Health pickup\n  if (itemDef.effect && itemDef.effect.health) {\n    const healthBonus = parseInt(itemDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return;\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', index);\n    return;\n  }\n\n  // Fireball ammo pickup\n  if (itemDef.effect && itemDef.effect.fireball) {\n    const ammoBonus = parseInt(itemDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n    try {\n      const vol = Math.max(0, Math.min(1, itemDef?.sfxVolume ?? 1));\n      playShotSfx(itemDef?.sfx, vol);\n    } catch {}\n    if (onStateUpdate) onStateUpdate('collectItem', index);\n    return;\n  }\n}\n","// Interactables logic - objects that can be used once and change state\n// Unlike items (which disappear), interactables stay but change texture\n\nexport function checkInteractables(ctx, currentX, currentY, mapWidth, objectLayerData) {\n  const { registryItems, TILE_SIZE, MAX_HEALTH, playShotSfx, onStateUpdate, gameState } = ctx;\n  if (!objectLayerData) return;\n\n  const centerX = currentX + gameState.current.width / 2;\n  const centerY = currentY + gameState.current.height / 2;\n\n  const gridX = Math.floor(centerX / TILE_SIZE);\n  const gridY = Math.floor(centerY / TILE_SIZE);\n  const index = gridY * mapWidth + gridX;\n  if (index < 0 || index >= objectLayerData.length) return;\n\n  const objId = objectLayerData[index];\n  if (!objId) return;\n\n  const objDef = registryItems.find(r => r.id === objId);\n  if (!objDef || !objDef.name || !objDef.name.startsWith('interactable.')) return;\n\n  // Check if already used (track used interactables in gameState)\n  if (!gameState.current.usedInteractables) {\n    gameState.current.usedInteractables = new Set();\n  }\n\n  if (gameState.current.usedInteractables.has(index)) return; // Already used\n\n  // Check if has effect\n  if (!objDef.effect) return;\n\n  // Health effect\n  if (objDef.effect.health) {\n    const healthBonus = parseInt(objDef.effect.health, 10);\n    if (gameState.current.health >= MAX_HEALTH) return; // Don't use if already full health\n\n    const newHealth = Math.min(gameState.current.health + healthBonus, MAX_HEALTH);\n    gameState.current.health = newHealth;\n\n    // Play sound\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    // Mark as used\n    gameState.current.usedInteractables.add(index);\n\n    // Notify state update with 'interactable' event - this will switch to next texture\n    if (onStateUpdate) onStateUpdate('interactable', index);\n    return;\n  }\n\n  // Future: Add other interactable effects (ammo, etc.)\n  if (objDef.effect.fireball) {\n    const ammoBonus = parseInt(objDef.effect.fireball, 10) || 0;\n    gameState.current.ammo = Math.max(0, (gameState.current.ammo || 0) + ammoBonus);\n\n    try {\n      const vol = Math.max(0, Math.min(1, objDef?.sfxVolume ?? 1));\n      playShotSfx(objDef?.sfx, vol);\n    } catch {}\n\n    gameState.current.usedInteractables.add(index);\n    if (onStateUpdate) onStateUpdate('interactable', index);\n    return;\n  }\n}\n","// Projectile update and ricochet simulation extracted from useGameEngine.js\n\n// ctx: { projectilesRef, TILE_SIZE, isSolidAtPixel, findItemById }\n// updateProjectiles(ctx, deltaMs, mapWidth, mapHeight)\nexport function updateProjectiles(ctx, deltaMs, mapWidth, mapHeight) {\n  const { projectilesRef, TILE_SIZE, isSolidAtPixel, findItemById } = ctx;\n  const dtProj = deltaMs / 1000;\n  const worldW = mapWidth * TILE_SIZE;\n  const worldH = mapHeight * TILE_SIZE;\n\n  const isSolidRect = (cx, cy, hw, hh) => {\n    const pts = [\n      { x: cx - hw, y: cy - hh },\n      { x: cx + hw, y: cy - hh },\n      { x: cx - hw, y: cy + hh },\n      { x: cx + hw, y: cy + hh },\n    ];\n    for (let k = 0; k < pts.length; k++) {\n      const pt = pts[k];\n      if (isSolidAtPixel(pt.x, pt.y, mapWidth, mapHeight)) return true;\n    }\n    return false;\n  };\n\n  if (!projectilesRef.current.length) return;\n\n  for (let i = projectilesRef.current.length - 1; i >= 0; i--) {\n    const p = projectilesRef.current[i];\n\n    if (p.bounces == null) p.bounces = 0;\n    const maxBounces = Number.isFinite(p.maxBounces)\n      ? p.maxBounces\n      : (findItemById(p.defId)?.maxBounces ?? 3);\n    const bounceDamp = Number.isFinite(p.bounceDamping)\n      ? p.bounceDamping\n      : (findItemById(p.defId)?.bounceDamping ?? 0.6);\n    const ricRand = Number.isFinite(p.ricochetRandom)\n      ? p.ricochetRandom\n      : (findItemById(p.defId)?.ricochetRandom ?? 0.15);\n\n    const maxDelta = Math.max(Math.abs(p.vx * dtProj), Math.abs(p.vy * dtProj));\n    let steps = Math.ceil(maxDelta / 4);\n    if (!Number.isFinite(steps) || steps < 1) steps = 1;\n    steps = Math.min(steps, 20);\n    const stepTime = dtProj / steps;\n\n    let cx = p.x;\n    let cy = p.y;\n    const hw = (p.w * (p.hbs || 1)) * 0.5;\n    const hh = (p.h * (p.hbs || 1)) * 0.5;\n\n    let removed = false;\n\n    for (let s = 0; s < steps; s++) {\n      // 1) X axis\n      let nextX = cx + p.vx * stepTime;\n      if (p.cwt && isSolidRect(nextX, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vy += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cx = nextX;\n      }\n\n      // 2) Y axis\n      let nextY = cy + p.vy * stepTime;\n      if (p.cwt && isSolidRect(cx, nextY, hw, hh)) {\n        if (p.ric) {\n          p.vy = -p.vy * bounceDamp;\n          const sp = Math.max(40, Math.hypot(p.vx, p.vy));\n          const jitter = (Math.random() * 2 - 1) * sp * ricRand;\n          p.vx += jitter * 0.15;\n          p.bounces += 1;\n          p.life = Math.max(0, p.life - 80);\n        } else {\n          removed = true;\n          break;\n        }\n      } else {\n        cy = nextY;\n      }\n\n      // 3) Corner stuck safeguard\n      if (p.cwt && isSolidRect(cx, cy, hw, hh)) {\n        if (p.ric) {\n          p.vx = -p.vx * bounceDamp;\n          p.vy = -p.vy * bounceDamp;\n          p.bounces += 1;\n          cx -= Math.sign(p.vx || 1) * 0.5;\n          cy -= Math.sign(p.vy || 1) * 0.5;\n        } else {\n          removed = true;\n          break;\n        }\n      }\n    }\n\n    p.x = cx;\n    p.y = cy;\n\n    p.life -= deltaMs;\n    if (\n      p.life <= 0 ||\n      p.x < -32 ||\n      p.y < -32 ||\n      p.x > worldW + 32 ||\n      p.y > worldH + 32 ||\n      removed ||\n      (p.bounces || 0) > (maxBounces || 0)\n    ) {\n      projectilesRef.current.splice(i, 1);\n      continue;\n    }\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst HeaderContainer = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 60px;\n    background-color: rgba(0, 0, 0, 0.3);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    box-sizing: border-box;\n    z-index: 1000;\n    pointer-events: none;\n`;\n\nconst AmmoDisplay = styled.div`\n    font-size: 28px;\n    font-weight: bold;\n    color: rgba(255, 200, 50, 0.95);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n`;\n\nconst RightSection = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 12px;\n`;\n\nconst HealthDisplay = styled.div`\n    font-size: 32px;\n    font-weight: bold;\n    color: rgba(255, 50, 50, 0.9);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n    font-family: monospace;\n    pointer-events: none;\n`;\n\nconst SoundButton = styled.button`\n    padding: 6px 10px;\n    border-radius: 4px;\n    border: 1px solid;\n    font-size: 12px;\n    font-weight: 700;\n    cursor: pointer;\n    margin-left: 12px;\n    user-select: none;\n    pointer-events: auto;\n    color: #fff;\n    background-color: ${props => props.$enabled ? 'rgba(40, 140, 60, 0.9)' : 'rgba(160, 40, 40, 0.9)'};\n    border-color: ${props => props.$enabled ? '#2e7d32' : '#7f1d1d'};\n\n    &:hover {\n        opacity: 0.9;\n    }\n`;\n\nconst GameHeader = ({ health, ammo = 0, soundEnabled = false, onToggleSound }) => {\n    return (\n        <HeaderContainer>\n            <AmmoDisplay>\n                 {ammo || 0}\n            </AmmoDisplay>\n\n            <RightSection>\n                <HealthDisplay>\n                     {health}\n                </HealthDisplay>\n                <SoundButton\n                    $enabled={soundEnabled}\n                    onClick={() => {\n                        if (typeof onToggleSound === 'function') onToggleSound();\n                        try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n                    }}\n                    title={soundEnabled ? 'Sound ON' : 'Sound OFF'}\n                >\n                    {soundEnabled ? 'Sound ON' : 'Sound OFF'}\n                </SoundButton>\n            </RightSection>\n        </HeaderContainer>\n    );\n};\n\nGameHeader.propTypes = {\n    health: PropTypes.number.isRequired,\n    ammo: PropTypes.number,\n    soundEnabled: PropTypes.bool,\n    onToggleSound: PropTypes.func.isRequired\n};\n\nexport default GameHeader;","// Simple command registry for in-game terminal\n// Each command: { name, description, handler(input, ctx) => string | void }\n\nconst commands = [];\n\nconst register = (cmd) => {\n  if (!cmd || !cmd.name) return;\n  commands.push(cmd);\n};\n\nexport const listCommands = () => commands.map(c => ({ name: c.name, description: c.description }));\n\nexport const executeCommand = (input, context = {}) => {\n  const raw = String(input || '').trim();\n  if (!raw) return '';\n  const [name, ...args] = raw.split(/\\s+/);\n  const cmd = commands.find(c => c.name.toLowerCase() === name.toLowerCase());\n  if (!cmd) {\n    return `Unknown command: ${name}. Type 'help' to list commands.`;\n  }\n  try {\n    const res = cmd.handler({ args, raw, context });\n    return typeof res === 'string' ? res : '';\n  } catch (e) {\n    return `Error executing '${name}': ${e?.message || e}`;\n  }\n};\n\n// Built-in: help\nregister({\n  name: 'help',\n  description: 'Show available commands',\n  handler() {\n    const list = listCommands()\n      .map(c => `- ${c.name}${c.description ? `: ${c.description}` : ''}`)\n      .join('\\n');\n    return list || 'No commands available.';\n  }\n});\n\n// Built-in: clear\nregister({\n  name: 'clear',\n  description: 'Clear terminal output',\n  handler() {\n    // Signal to UI to clear output; UI can interpret special token\n    try { window.dispatchEvent(new CustomEvent('game-terminal-clear')); } catch {}\n    return '';\n  }\n});\n\n// First requested command: settings\nregister({\n  name: 'settings',\n  description: \"Open the draggable game settings window\",\n  handler() {\n    try { \n      window.dispatchEvent(new CustomEvent('game-open-settings'));\n      // Also close terminal automatically when opening settings\n      window.dispatchEvent(new CustomEvent('game-close-terminal'));\n    } catch {}\n    return 'Opening settings...';\n  }\n});\n\nexport default {\n  register,\n  listCommands,\n  executeCommand,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { executeCommand } from '../../../commands/gameCommands';\n\nconst panelStyleBase = {\n  position: 'fixed',\n  left: 0,\n  right: 0,\n  bottom: 0,\n  height: '220px',\n  backgroundColor: 'rgba(10, 10, 10, 0.95)',\n  color: '#d6d6d6',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace',\n  fontSize: '12px',\n  borderTop: '1px solid #333',\n  boxShadow: '0 -6px 16px rgba(0,0,0,0.5)',\n  display: 'flex',\n  flexDirection: 'column',\n  zIndex: 3000,\n  transition: 'transform 160ms ease',\n};\n\nexport default function GameTerminal() {\n  const [open, setOpen] = useState(false);\n  const [lines, setLines] = useState([\"Type 'help' to list commands. Press ESC to close.\"]);\n  const [input, setInput] = useState('');\n  const scrollRef = useRef(null);\n  const inputRef = useRef(null);\n  const suppressUntilRef = useRef(0);\n  const suppressActiveRef = useRef(false);\n\n  // Toggle handler from global events\n  useEffect(() => {\n    const onToggle = () => setOpen(prev => !prev);\n    const onClear = () => setLines([]);\n    const onClose = () => setOpen(false);\n    window.addEventListener('game-toggle-terminal', onToggle);\n    window.addEventListener('game-terminal-clear', onClear);\n    window.addEventListener('game-close-terminal', onClose);\n    return () => {\n      window.removeEventListener('game-toggle-terminal', onToggle);\n      window.removeEventListener('game-terminal-clear', onClear);\n      window.removeEventListener('game-close-terminal', onClose);\n    };\n  }, []);\n\n  // Track open state globally so input hook can disable movement\n  useEffect(() => {\n    try { window.__GAME_TERMINAL_OPEN__ = open; } catch {}\n    if (open) {\n      // Clear any previous text and suppress initial keystrokes that were held during gameplay\n      setInput('');\n      try { suppressUntilRef.current = (typeof performance !== 'undefined' ? performance.now() : Date.now()) + 220; } catch { suppressUntilRef.current = Date.now() + 220; }\n      setTimeout(() => inputRef.current && inputRef.current.focus(), 0);\n    }\n  }, [open]);\n\n  // Close with ESC when focused\n  useEffect(() => {\n    const onKey = (e) => {\n      if (!open) return;\n      if (e.key === 'Escape') {\n        setOpen(false);\n      }\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, [open]);\n\n  // Auto-scroll to bottom when lines change\n  useEffect(() => {\n    if (!scrollRef.current) return;\n    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n  }, [lines, open]);\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const value = input.trim();\n    if (!value) return;\n    setLines(prev => [...prev, `> ${value}`]);\n    const res = executeCommand(value, {});\n    if (res) setLines(prev => [...prev, res]);\n    setInput('');\n  };\n\n  const style = {\n    ...panelStyleBase,\n    transform: open ? 'translateY(0)' : 'translateY(100%)',\n  };\n\n  return (\n    <div style={style} aria-hidden={!open}>\n      <div style={{ padding: '6px 8px', borderBottom: '1px solid #333', color: '#9cdcfe' }}>\n        In-Game Terminal  press T to toggle\n      </div>\n      <div ref={scrollRef} style={{ flex: 1, overflowY: 'auto', padding: '8px 10px', whiteSpace: 'pre-wrap', lineHeight: 1.4 }}>\n        {lines.map((l, i) => (\n          <div key={i} style={{ color: l.startsWith('>') ? '#dcdcaa' : '#d6d6d6' }}>{l}</div>\n        ))}\n      </div>\n      <form onSubmit={onSubmit} style={{ display: 'flex', gap: '6px', padding: '8px', borderTop: '1px solid #333' }}>\n        <span style={{ color: '#6a9955' }}>$</span>\n        <input\n          ref={inputRef}\n          value={input}\n          onKeyDown={(e) => {\n            const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\n            if (now < (suppressUntilRef.current || 0) && e.key !== 'Escape') {\n              if (typeof e.preventDefault === 'function') e.preventDefault();\n              if (typeof e.stopPropagation === 'function') e.stopPropagation();\n              return;\n            }\n          }}\n          onChange={(e) => setInput(e.target.value)}\n          placeholder=\"Enter command...\"\n          style={{ flex: 1, background: '#111', color: '#fff', border: '1px solid #333', padding: '6px 8px', borderRadius: '3px', outline: 'none' }}\n        />\n        <button type=\"submit\" style={{ background: '#0e639c', color: '#fff', border: '1px solid #0b5c8a', padding: '6px 10px', borderRadius: '3px', cursor: 'pointer' }}>\n          Run\n        </button>\n      </form>\n    </div>\n  );\n}\n","import React, { useEffect, useRef, useState } from 'react';\n\n// Simple draggable, minimizable settings window.\n// Opens when the custom event 'game-open-settings' is dispatched (from terminal command `settings`).\n// Renders above the game canvas but below the in-game terminal.\nexport default function GameSettings() {\n  // Runtime-linked settings (live updates)\n  const [activeTab, setActiveTab] = useState(() => {\n    try {\n      return localStorage.getItem('game_settings_tab') || 'Audio';\n    } catch {}\n    return 'Audio';\n  });\n  const [parallax, setParallax] = useState(() => {\n    try {\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.backgroundParallaxFactor === 'number') return g.backgroundParallaxFactor;\n    } catch {}\n    return 0.3;\n  });\n  const [rain, setRain] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_rain');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherRain === 'number') return Math.max(0, Math.min(100, g.weatherRain));\n    } catch {}\n    return 0;\n  });\n  const [snow, setSnow] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_snow');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherSnow === 'number') return Math.max(0, Math.min(100, g.weatherSnow));\n    } catch {}\n    return 0;\n  });\n  const [clouds, setClouds] = useState(() => {\n    try {\n      // New key first\n      const lsNew = localStorage.getItem('game_weather_clouds');\n      if (lsNew !== null) return Math.max(0, Math.min(100, parseInt(lsNew, 10) || 0));\n      // Backward compatibility: read old fog key if exists\n      const lsOld = localStorage.getItem('game_weather_fog');\n      if (lsOld !== null) return Math.max(0, Math.min(100, parseInt(lsOld, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      // Prefer clouds but also accept legacy fog\n      if (g && typeof g.weatherClouds === 'number') return Math.max(0, Math.min(100, g.weatherClouds));\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // New: Thunder (Lightning) intensity 0..100\n  const [thunder, setThunder] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_thunder');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherThunder === 'number') return Math.max(0, Math.min(100, g.weatherThunder));\n    } catch {}\n    return 0;\n  });\n  // New: dedicated Fog density (0..100)\n  const [fog, setFog] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_weather_fog');\n      if (ls !== null) return Math.max(0, Math.min(100, parseInt(ls, 10) || 0));\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.weatherFog === 'number') return Math.max(0, Math.min(100, g.weatherFog));\n    } catch {}\n    return 0;\n  });\n  // UI: Health bar visibility\n  const [healthBarEnabled, setHealthBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_healthbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.healthBarEnabled === 'boolean') return g.healthBarEnabled;\n    } catch {}\n    return true;\n  });\n  // UI: Oxygen/Lava bars visibility\n  const [oxygenBarEnabled, setOxygenBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_oxygenbar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.oxygenBarEnabled === 'boolean') return g.oxygenBarEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaBarEnabled, setLavaBarEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_ui_lavabar');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaBarEnabled === 'boolean') return g.lavaBarEnabled;\n    } catch {}\n    return true;\n  });\n  // FX toggles\n  const [waterSplashesEnabled, setWaterSplashesEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_water_splashes');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.waterSplashesEnabled === 'boolean') return g.waterSplashesEnabled;\n    } catch {}\n    return true;\n  });\n  const [lavaEmbersEnabled, setLavaEmbersEnabled] = useState(() => {\n    try {\n      const ls = localStorage.getItem('game_fx_lava_embers');\n      if (ls !== null) return ls !== '0';\n      const g = window.__GAME_RUNTIME_SETTINGS__;\n      if (g && typeof g.lavaEmbersEnabled === 'boolean') return g.lavaEmbersEnabled;\n    } catch {}\n    return true;\n  });\n  const [open, setOpen] = useState(false);\n  const [minimized, setMinimized] = useState(false);\n  const [pos, setPos] = useState(() => {\n    // Restore last position from localStorage if available\n    try {\n      const raw = localStorage.getItem('game_settings_pos');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { left: 12, top: 64 };\n  });\n\n  const [size, setSize] = useState(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_size');\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return { width: 300, height: 220 };\n  });\n\n  const draggingRef = useRef({ active: false, offsetX: 0, offsetY: 0 });\n\n  // Helper: clamp position so the window stays within viewport (with small margin)\n  const clampPos = (p, sz, isMin) => {\n    const margin = 12;\n    const vw = (typeof window !== 'undefined' ? window.innerWidth : 0) || 0;\n    const vh = (typeof window !== 'undefined' ? window.innerHeight : 0) || 0;\n    const maxL = Math.max(0, vw - (sz?.width || 300) - margin);\n    const maxT = Math.max(0, vh - (isMin ? 36 : (sz?.height || 220)) - margin);\n    let left = Number(p?.left);\n    let top = Number(p?.top);\n    if (!Number.isFinite(left)) left = margin;\n    if (!Number.isFinite(top)) top = margin;\n    left = Math.max(0, Math.min(maxL, left));\n    top = Math.max(0, Math.min(maxT, top));\n    return { left, top };\n  };\n\n  // Restore minimized state\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('game_settings_min');\n      if (raw) setMinimized(raw === '1');\n    } catch {}\n  }, []);\n\n  // Open handler from global event\n  useEffect(() => {\n    const onOpen = () => {\n      // Ensure the window will be visible even if saved pos was off-screen\n      setPos((p) => clampPos(p, size, false));\n      setOpen(true);\n      setMinimized(false);\n      // Sync current values from global when opening\n      try {\n        const g = window.__GAME_RUNTIME_SETTINGS__ || {};\n        if (typeof g.backgroundParallaxFactor === 'number') {\n          setParallax(g.backgroundParallaxFactor);\n        }\n        if (typeof g.weatherRain === 'number') setRain(Math.max(0, Math.min(100, g.weatherRain)));\n        if (typeof g.weatherSnow === 'number') setSnow(Math.max(0, Math.min(100, g.weatherSnow)));\n        if (typeof g.weatherClouds === 'number') setClouds(Math.max(0, Math.min(100, g.weatherClouds)));\n        if (typeof g.weatherFog === 'number') setFog(Math.max(0, Math.min(100, g.weatherFog)));\n        if (typeof g.weatherThunder === 'number') setThunder(Math.max(0, Math.min(100, g.weatherThunder)));\n        if (typeof g.healthBarEnabled === 'boolean') setHealthBarEnabled(!!g.healthBarEnabled);\n        if (typeof g.oxygenBarEnabled === 'boolean') setOxygenBarEnabled(!!g.oxygenBarEnabled);\n        if (typeof g.lavaBarEnabled === 'boolean') setLavaBarEnabled(!!g.lavaBarEnabled);\n        if (typeof g.waterSplashesEnabled === 'boolean') setWaterSplashesEnabled(!!g.waterSplashesEnabled);\n        if (typeof g.lavaEmbersEnabled === 'boolean') setLavaEmbersEnabled(!!g.lavaEmbersEnabled);\n      } catch {}\n      // Auto-close the in-game terminal when settings opens\n      try { window.dispatchEvent(new CustomEvent('game-close-terminal')); } catch {}\n    };\n    window.addEventListener('game-open-settings', onOpen);\n    return () => window.removeEventListener('game-open-settings', onOpen);\n  }, []);\n\n  // Persist position and size/minimized\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_pos', JSON.stringify(pos)); } catch {}\n  }, [pos]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_size', JSON.stringify(size)); } catch {}\n  }, [size]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_min', minimized ? '1' : '0'); } catch {}\n  }, [minimized]);\n  useEffect(() => {\n    try { localStorage.setItem('game_settings_tab', String(activeTab)); } catch {}\n  }, [activeTab]);\n\n  // Drag logic\n  useEffect(() => {\n    const onMove = (e) => {\n      if (!draggingRef.current.active) return;\n      e.preventDefault();\n      const nx = e.clientX - draggingRef.current.offsetX;\n      const ny = e.clientY - draggingRef.current.offsetY;\n      const maxL = Math.max(0, (window.innerWidth || 0) - size.width - 6);\n      const maxT = Math.max(0, (window.innerHeight || 0) - (minimized ? 36 : size.height) - 6);\n      setPos({\n        left: Math.max(0, Math.min(maxL, nx)),\n        top: Math.max(0, Math.min(maxT, ny)),\n      });\n    };\n    const onUp = () => { draggingRef.current.active = false; };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseup', onUp);\n    return () => {\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseup', onUp);\n    };\n  }, [size.width, size.height, minimized]);\n\n  // Re-clamp into viewport when window resizes while settings are open\n  useEffect(() => {\n    if (!open) return;\n    const onResize = () => setPos((p) => clampPos(p, size, minimized));\n    window.addEventListener('resize', onResize);\n    // Run once immediately to correct if needed\n    onResize();\n    return () => window.removeEventListener('resize', onResize);\n  }, [open, size.width, size.height, minimized]);\n\n  const onHeaderMouseDown = (e) => {\n    draggingRef.current.active = true;\n    draggingRef.current.offsetX = e.clientX - pos.left;\n    draggingRef.current.offsetY = e.clientY - pos.top;\n  };\n\n  const onClose = () => setOpen(false);\n  const onMinToggle = () => setMinimized((m) => !m);\n\n  const emitUpdate = (patch) => {\n    try {\n      window.dispatchEvent(new CustomEvent('game-settings-update', { detail: patch }));\n      // Mirror into a global bag for components that want to read without listeners\n      window.__GAME_RUNTIME_SETTINGS__ = {\n        ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n        ...patch,\n      };\n    } catch {}\n  };\n\n  const onResizeMouseDown = (e) => {\n    // Simple bottom-right resize drag\n    e.preventDefault();\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const startW = size.width;\n    const startH = size.height;\n\n    const move = (ev) => {\n      const dw = ev.clientX - startX;\n      const dh = ev.clientY - startY;\n      const nw = Math.max(220, startW + dw);\n      const nh = Math.max(140, startH + dh);\n      setSize({ width: nw, height: nh });\n    };\n    const up = () => {\n      window.removeEventListener('mousemove', move);\n      window.removeEventListener('mouseup', up);\n    };\n    window.addEventListener('mousemove', move);\n    window.addEventListener('mouseup', up);\n  };\n\n  if (!open) return null;\n\n  const panelStyle = {\n    position: 'fixed',\n    left: pos.left,\n    top: pos.top,\n    width: size.width,\n    height: minimized ? 36 : size.height,\n    background: 'rgba(20,20,20,0.96)',\n    color: '#eaeaea',\n    border: '1px solid #2a2a2a',\n    borderRadius: 6,\n    boxShadow: '0 8px 24px rgba(0,0,0,0.6)',\n    zIndex: 2600, // below terminal (3000), above canvas/HUD\n    display: 'flex',\n    flexDirection: 'column',\n    userSelect: draggingRef.current.active ? 'none' : 'auto',\n    overflow: 'hidden',\n  };\n\n  const headerStyle = {\n    cursor: 'move',\n    background: 'linear-gradient(180deg, #2a2a2a, #1c1c1c)',\n    padding: '6px 8px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    borderBottom: '1px solid #333',\n    fontSize: 12,\n  };\n\n  const contentStyle = {\n    flex: 1,\n    display: minimized ? 'none' : 'block',\n    padding: 10,\n    overflow: 'auto',\n    background: 'rgba(10,10,10,0.4)'\n  };\n\n  const buttonStyle = {\n    background: '#0e639c',\n    color: '#fff',\n    border: '1px solid #0b5c8a',\n    padding: '4px 8px',\n    borderRadius: 4,\n    fontSize: 11,\n    cursor: 'pointer',\n    marginLeft: 6,\n  };\n\n  const tabsBarStyle = {\n    display: minimized ? 'none' : 'flex',\n    alignItems: 'center',\n    gap: 6,\n    padding: '6px 8px',\n    borderBottom: '1px solid #2a2a2a',\n    background: 'rgba(0,0,0,0.25)',\n    whiteSpace: 'nowrap',\n    overflowX: 'auto'\n  };\n  const tabBtnStyle = (tab) => ({\n    background: activeTab === tab ? '#1e1e1e' : 'transparent',\n    color: activeTab === tab ? '#9cdcfe' : '#ddd',\n    border: activeTab === tab ? '1px solid #3a3a3a' : '1px solid transparent',\n    padding: '4px 10px',\n    borderRadius: 4,\n    fontSize: 12,\n    cursor: 'pointer',\n  });\n\n  const renderAudio = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Audio</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Master Volume</label>\n        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={0.7} />\n      </div>\n    </section>\n  );\n\n  const renderGraphics = () => (\n    <>\n      <section style={{ marginBottom: 10 }}>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Graphics</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Parallax Factor</label>\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={Number.isFinite(parallax) ? parallax : 0.3}\n            onChange={(e) => {\n              const v = parseFloat(e.target.value);\n              setParallax(v);\n              emitUpdate({ backgroundParallaxFactor: v });\n            }}\n          />\n          <span style={{ fontSize: 12, width: 40, textAlign: 'right' }}>{(Number.isFinite(parallax) ? parallax : 0.3).toFixed(2)}</span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>VSync</label>\n          <input type=\"checkbox\" defaultChecked />\n        </div>\n      </section>\n      {/* Keep existing Gameplay controls inside Graphics tab for now */}\n      <section>\n        <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Gameplay</div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Invert Jump (W)</label>\n          <input type=\"checkbox\" />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Health Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!healthBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setHealthBarEnabled(v);\n              try { localStorage.setItem('game_ui_healthbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ healthBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Oxygen Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!oxygenBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setOxygenBarEnabled(v);\n              try { localStorage.setItem('game_ui_oxygenbar', v ? '1' : '0'); } catch {}\n              emitUpdate({ oxygenBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Show Lava Bar</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaBarEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaBarEnabled(v);\n              try { localStorage.setItem('game_ui_lavabar', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaBarEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Water Splashes</label>\n          <input\n            type=\"checkbox\"\n            checked={!!waterSplashesEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setWaterSplashesEnabled(v);\n              try { localStorage.setItem('game_fx_water_splashes', v ? '1' : '0'); } catch {}\n              emitUpdate({ waterSplashesEnabled: v });\n            }}\n          />\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 6 }}>\n          <label style={{ fontSize: 12, width: 120 }}>Lava Embers</label>\n          <input\n            type=\"checkbox\"\n            checked={!!lavaEmbersEnabled}\n            onChange={(e) => {\n              const v = !!e.target.checked;\n              setLavaEmbersEnabled(v);\n              try { localStorage.setItem('game_fx_lava_embers', v ? '1' : '0'); } catch {}\n              emitUpdate({ lavaEmbersEnabled: v });\n            }}\n          />\n        </div>\n      </section>\n    </>\n  );\n\n  const renderWeather = () => (\n    <section style={{ marginBottom: 10 }}>\n      <div style={{ fontSize: 12, marginBottom: 6, color: '#d6d6d6' }}>Weather</div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Lietus (Rain)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(rain) ? rain : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setRain(v);\n            try { localStorage.setItem('game_weather_rain', String(v)); } catch {}\n            emitUpdate({ weatherRain: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(rain) ? rain : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Sniegs (Snow)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(snow) ? snow : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setSnow(v);\n            try { localStorage.setItem('game_weather_snow', String(v)); } catch {}\n            emitUpdate({ weatherSnow: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(snow) ? snow : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Migla (Fog)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(fog) ? fog : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setFog(v);\n            try { localStorage.setItem('game_weather_fog', String(v)); } catch {}\n            emitUpdate({ weatherFog: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(fog) ? fog : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Zibens (Thunder)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(thunder) ? thunder : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setThunder(v);\n            try { localStorage.setItem('game_weather_thunder', String(v)); } catch {}\n            emitUpdate({ weatherThunder: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(thunder) ? thunder : 0}</span>\n      </div>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n        <label style={{ fontSize: 12, width: 120 }}>Mkoi (Clouds)</label>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          step=\"1\"\n          value={Number.isFinite(clouds) ? clouds : 0}\n          onChange={(e) => {\n            const v = Math.max(0, Math.min(100, parseInt(e.target.value, 10) || 0));\n            setClouds(v);\n            try { localStorage.setItem('game_weather_clouds', String(v)); } catch {}\n            emitUpdate({ weatherClouds: v });\n          }}\n        />\n        <span style={{ fontSize: 12, width: 34, textAlign: 'right' }}>{Number.isFinite(clouds) ? clouds : 0}</span>\n      </div>\n    </section>\n  );\n\n  return (\n    <div style={panelStyle}>\n      <div style={headerStyle} onMouseDown={onHeaderMouseDown}>\n        <div style={{ fontWeight: 600, color: '#9cdcfe' }}>Game Settings</div>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          <button onClick={onMinToggle} title={minimized ? 'Expand' : 'Minimize'} style={buttonStyle}>\n            {minimized ? '' : ''}\n          </button>\n          <button onClick={onClose} title=\"Close\" style={{ ...buttonStyle, background: '#a33', borderColor: '#822' }}></button>\n        </div>\n      </div>\n\n      {/* Tabs bar: one-line menu */}\n      <div style={tabsBarStyle}>\n        {['Audio','Graphics','Weather'].map((t) => (\n          <button key={t} style={tabBtnStyle(t)} onClick={() => setActiveTab(t)}>{t}</button>\n        ))}\n      </div>\n\n      <div style={contentStyle}>\n        {activeTab === 'Audio' && renderAudio()}\n        {activeTab === 'Graphics' && renderGraphics()}\n        {activeTab === 'Weather' && renderWeather()}\n      </div>\n\n      {/* Resize handle */}\n      {!minimized && (\n        <div\n          onMouseDown={onResizeMouseDown}\n          title=\"Resize\"\n          style={{ position: 'absolute', right: 0, bottom: 0, width: 16, height: 16, cursor: 'nwse-resize',\n                   background: 'linear-gradient(135deg, transparent 0, transparent 50%, #666 50%, #666 100%)' }}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useEffect, useRef } from 'react';\n\n// Lightweight background music player that resolves a meta path like\n// \"/sound/background/track.ogg\" to a build URL via require.context and\n// plays/pauses a looping HTMLAudioElement.\n// Props:\n// - metaPath: string | null  stored in map meta (e.g., \"/sound/background/foo.ogg\")\n// - enabled: boolean  global sound toggle\n// - volume: number (0..1)\nexport default function BackgroundMusicPlayer({ metaPath, enabled = false, volume = 0.6 }) {\n  const audioRef = useRef(null);\n  const currentSrcRef = useRef(null);\n\n  // Resolve ogg assets from src/assets/sound/background\n  let musicContext = null;\n  try {\n    // utilities -> ../assets/sound/background\n    musicContext = require.context('../assets/sound/background', false, /\\.ogg$/);\n  } catch (e) {\n    musicContext = null;\n  }\n\n  const resolveUrl = (path) => {\n    if (!path) return null;\n    const name = path.split('/').pop();\n    if (!name) return null;\n    if (musicContext) {\n      try {\n        const mod = musicContext(`./${name}`);\n        return mod.default || mod;\n      } catch (e) {\n        console.warn(`Background music not found: ${name}`);\n      }\n    }\n    return null;\n  };\n\n  const cleanup = () => {\n    try {\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current.src = '';\n        audioRef.current = null;\n        currentSrcRef.current = null;\n      }\n    } catch {}\n  };\n\n  // Build/rebuild audio element when metaPath changes\n  useEffect(() => {\n    const url = resolveUrl(metaPath);\n\n    // If unchanged, just update enabled/volume in next effect\n    if (url && currentSrcRef.current === url && audioRef.current) {\n      return () => {};\n    }\n\n    // Rebuild\n    cleanup();\n    if (!url) return () => {};\n\n    const audio = new Audio(url);\n    audio.loop = true;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    audioRef.current = audio;\n    currentSrcRef.current = url;\n\n    // Try to pre-play if enabled (may be blocked by autoplay policy)\n    if (enabled) {\n      audio.play().catch(() => {\n        // Will try again on explicit user gesture via custom event\n      });\n    }\n\n    return () => cleanup();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [metaPath]);\n\n  // React to enabled/volume changes\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.volume = Math.max(0, Math.min(1, Number(volume) || 0));\n    if (enabled) {\n      // Attempt to play; may require user gesture\n      audio.play().catch(() => {\n        // try again on gesture event\n      });\n    } else {\n      try { audio.pause(); } catch {}\n    }\n  }, [enabled, volume]);\n\n  // Listen for a gesture-driven event to force playback immediately in handler\n  useEffect(() => {\n    const onGesture = () => {\n      const audio = audioRef.current;\n      if (audio && enabled) {\n        audio.play().catch(() => {});\n      }\n    };\n    const onToggle = (e) => {\n      const val = !!(e && e.detail && e.detail.enabled);\n      const audio = audioRef.current;\n      if (!audio) return;\n      if (val) {\n        audio.play().catch(() => {});\n      } else {\n        try { audio.pause(); } catch {}\n      }\n    };\n    window.addEventListener('game-sound-user-gesture', onGesture);\n    window.addEventListener('game-sound-toggle', onToggle);\n    return () => {\n      window.removeEventListener('game-sound-user-gesture', onGesture);\n      window.removeEventListener('game-sound-toggle', onToggle);\n    };\n  }, [enabled]);\n\n  return null;\n}\n","import React, { useState, useEffect, useMemo, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getRegistry, findItemById } from '../../../engine/registry';\nimport PixiStage from './PixiStage';\nimport { useGameEngine } from '../../../utilities/useGameEngine';\nimport GameHeader from './GameHeader';\nimport GameTerminal from './GameTerminal';\nimport GameSettings from './GameSettings';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { setActiveMap, removeObjectAtIndex, updateObjectAtIndex, setObjectTextureIndex, revealSecretZone, resetGame } from '../../../store/slices/gameSlice';\nimport { setMapModalOpen, setCameraScrollX, setShouldCenterMap } from '../../../store/slices/uiSlice';\nimport { setSoundEnabled } from '../../../store/slices/settingsSlice';\nimport errorHandler from '../../../services/errorHandler';\nimport styled from 'styled-components';\n\n// Import maps (static files usually need to be imported or fetched in React/Webpack)\nimport map1 from '../../../assets/maps/Temp_01.json';\nimport map2 from '../../../assets/maps/Temp_02.json';\nimport map3 from '../../../assets/maps/Temp_03.json';\nimport map4 from '../../../assets/maps/Temp_04.json';\nimport map5 from '../../../assets/maps/Temp_05.json';\nimport map6 from '../../../assets/maps/Temp_06.json';\nimport map7 from '../../../assets/maps/Temp_07.json';\nimport map8 from '../../../assets/maps/Temp_08.json';\n// Simulate file list from folder\nconst BUILT_IN_MAPS = [map1, map2, map3, map4, map5, map6, map7, map8];\n\n// Styled Components\nconst GameContainer = styled.div`\n    position: relative;\n    height: 100%;\n    overflow: hidden;\n    background-color: #333;\n`;\n\nconst ModalOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    z-index: 1000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(2px);\n`;\n\nconst ModalContent = styled.div`\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 500px;\n    max-height: 80%;\n    overflow-y: auto;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n`;\n\nconst ModalTitle = styled.h2`\n    margin: 0;\n    border-bottom: 2px solid #eee;\n    padding-bottom: 10px;\n`;\n\nconst MapList = styled.div`\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n`;\n\nconst MapCard = styled.div`\n    border: 1px solid #ddd;\n    border-radius: 6px;\n    padding: 10px;\n    cursor: pointer;\n    background-color: #f9f9f9;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n\n    &:hover {\n        background-color: #e8e8e8;\n    }\n`;\n\nconst MapTitle = styled.div`\n    font-weight: bold;\n    font-size: 16px;\n`;\n\nconst MapAuthor = styled.div`\n    font-size: 12px;\n    color: #666;\n`;\n\nconst MapInfo = styled.div`\n    text-align: right;\n    font-size: 11px;\n    color: #555;\n`;\n\nconst ModalDivider = styled.div`\n    border-top: 2px solid #eee;\n    padding-top: 15px;\n    margin-top: 10px;\n`;\n\nconst FileUploadLabel = styled.label`\n    padding: 8px 16px;\n    background-color: #2196F3;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    text-align: center;\n    display: inline-block;\n    width: 100%;\n    box-sizing: border-box;\n\n    &:hover {\n        background-color: #1976D2;\n    }\n`;\n\nconst HiddenFileInput = styled.input`\n    display: none;\n`;\n\nconst Viewport = styled.div`\n    height: 100%;\n    display: ${props => props.$centered ? 'flex' : 'block'};\n    align-items: ${props => props.$centered ? 'center' : 'stretch'};\n    justify-content: ${props => props.$centered ? 'center' : 'flex-start'};\n    overflow: auto;\n    filter: ${props => props.$blurred ? 'blur(5px)' : 'none'};\n    pointer-events: ${props => props.$blurred ? 'none' : 'auto'};\n    transition: filter 0.3s ease;\n`;\n\nconst GameCanvas = styled.div`\n    position: relative;\n    width: ${props => props.$width}px;\n    height: ${props => props.$height}px;\n    border: 5px solid #222;\n    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);\n    background-color: #111;\n`;\n\nconst PlaceholderMessage = styled.div`\n    color: #777;\n    font-size: 24px;\n`;\n\nexport default function Game() {\n    const dispatch = useDispatch();\n    const viewportRef = useRef(null);\n\n    // Redux state\n    const { activeMapData, tileMapData, objectMapData, secretMapData, revealedSecrets, objectTextureIndices, mapWidth, mapHeight } = useSelector(state => state.game);\n    const { isMapModalOpen, cameraScrollX, shouldCenterMap } = useSelector(state => state.ui);\n    const { sound } = useSelector(state => state.settings);\n    const soundEnabled = sound.enabled;\n\n    // Runtime settings that can be changed from GameSettings on the fly\n    const [runtimeSettings, setRuntimeSettings] = useState({});\n\n    // Registry\n    const registryItems = getRegistry() || [];\n\n    const handleGameOver = () => {\n        // Reload current map using Redux\n        if (activeMapData) {\n            console.log(\"Game Over! Reloading map...\");\n            loadMapData({...activeMapData});\n        }\n    };\n\n    // NEW: Function for removing items and updating interactables - now uses Redux\n    const handleStateUpdate = (action, payload) => {\n        if (action === 'collectItem') {\n            const indexToRemove = payload;\n            dispatch(removeObjectAtIndex(indexToRemove));\n        } else if (action === 'interactable') {\n            const index = payload;\n            // Switch interactable to \"used\" variant by changing ID\n            // e.g., berry_bush_01 -> berry_bush_01_used\n            const currentId = objectMapData[index];\n            if (currentId) {\n                dispatch(updateObjectAtIndex({ index, newId: currentId + '_used' }));\n            }\n        }\n    };\n\n    // We no longer need 'engineMapData' with layers, as we pass objectMapData separately.\n    // So we pass the original 'activeMapData' as first argument (for initialization to work correctly and not reset),\n    // and 'objectMapData' as third argument for item checking.\n\n    // Callback for revealing secret zones\n    const handleRevealSecret = (indices) => {\n        dispatch(revealSecretZone(indices));\n    };\n\n    // --- START ENGINE ---\n    // Engine returns player coordinates and state\n    // objectMapData contains dynamic data (removed items)\n    const playerState = useGameEngine(\n        activeMapData,\n        tileMapData,\n        objectMapData,\n        secretMapData,\n        revealedSecrets,\n        registryItems,\n        handleGameOver,\n        handleStateUpdate,\n        handleRevealSecret\n    );\n\n    // Iegstam spltja vizulo izskatu (Texture)\n    const playerVisuals = useMemo(() => {\n        // eit vartu bt loika, kas maina tekstru atkarb no playerState.direction vai playerState.vx\n        // Pagaidm paemam noklusto\n        return findItemById(\"player_default_100\") || findItemById(\"player\");\n    }, []);\n    // --- END ENGINE ---\n\n    // Determine if the map fits entirely in the viewport; if so, center it\n    useEffect(() => {\n        const vp = viewportRef.current;\n        if (!vp) return;\n        const recalc = () => {\n            const vw = vp.clientWidth || 0;\n            const vh = vp.clientHeight || 0;\n            const cw = mapWidth * 32;\n            const ch = mapHeight * 32;\n            const fits = cw <= vw && ch <= vh;\n            dispatch(setShouldCenterMap(fits));\n            if (fits) {\n                // Ensure no residual scroll when centered\n                if ((vp.scrollLeft || vp.scrollTop)) {\n                    vp.scrollTo({ left: 0, top: 0, behavior: 'auto' });\n                }\n            }\n        };\n        recalc();\n        window.addEventListener('resize', recalc);\n        return () => window.removeEventListener('resize', recalc);\n    }, [mapWidth, mapHeight, isMapModalOpen, dispatch]);\n\n    // Camera follow with horizontal dead-zone on large maps (disabled when map is centered)\n    useEffect(() => {\n        const vp = viewportRef.current;\n        if (!vp || !activeMapData || isMapModalOpen || shouldCenterMap) return;\n\n        const vw = vp.clientWidth || 0;\n        const contentWidth = mapWidth * 32;\n        const maxScrollLeft = Math.max(0, contentWidth - vw);\n\n        const px = Number(playerState?.x) || 0;\n        const pw = Number(playerState?.width) || 32;\n        const playerCenter = px + pw / 2;\n\n        const currentLeft = vp.scrollLeft || 0;\n        const deadLeft = currentLeft + vw * 0.3;\n        const deadRight = currentLeft + vw * 0.7;\n\n        let targetLeft = currentLeft;\n        if (playerCenter > deadRight) {\n            targetLeft = playerCenter - vw * 0.7;\n        } else if (playerCenter < deadLeft) {\n            targetLeft = playerCenter - vw * 0.3;\n        }\n        targetLeft = Math.max(0, Math.min(maxScrollLeft, targetLeft));\n\n        if (Math.abs(targetLeft - currentLeft) > 0.5) {\n            vp.scrollTo({ left: targetLeft, top: 0, behavior: 'auto' });\n        }\n    }, [playerState, activeMapData, isMapModalOpen, mapWidth, shouldCenterMap]);\n\n    // Listen for runtime settings updates from GameSettings (live apply)\n    useEffect(() => {\n        const onSettingsUpdate = (e) => {\n            const patch = (e && e.detail) || {};\n            setRuntimeSettings(prev => ({ ...prev, ...patch }));\n        };\n        window.addEventListener('game-settings-update', onSettingsUpdate);\n        return () => window.removeEventListener('game-settings-update', onSettingsUpdate);\n    }, []);\n\n    // Listen for navigation buttons\n    useEffect(() => {\n        const handleOpenModalEvent = () => dispatch(setMapModalOpen(true));\n        window.addEventListener('open-new-game-modal', handleOpenModalEvent);\n        return () => window.removeEventListener('open-new-game-modal', handleOpenModalEvent);\n    }, [dispatch]);\n\n    // Mirror current effective runtime settings for other components to read (like GameSettings)\n    useEffect(() => {\n        try {\n            const clouds = (runtimeSettings.weatherClouds ?? 0);\n            const fog = (runtimeSettings.weatherFog ?? 0);\n            const thunder = (runtimeSettings.weatherThunder ?? 0);\n            window.__GAME_RUNTIME_SETTINGS__ = {\n                ...(window.__GAME_RUNTIME_SETTINGS__ || {}),\n                backgroundParallaxFactor: (runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor ?? 0.3),\n                weatherRain: (runtimeSettings.weatherRain ?? 0),\n                weatherSnow: (runtimeSettings.weatherSnow ?? 0),\n                weatherClouds: clouds,\n                weatherFog: fog,\n                weatherThunder: thunder,\n                healthBarEnabled: (runtimeSettings.healthBarEnabled ?? true),\n                oxygenBarEnabled: (runtimeSettings.oxygenBarEnabled ?? true),\n                lavaBarEnabled: (runtimeSettings.lavaBarEnabled ?? true),\n                waterSplashesEnabled: (runtimeSettings.waterSplashesEnabled ?? true),\n                lavaEmbersEnabled: (runtimeSettings.lavaEmbersEnabled ?? true),\n                // legacy mirror for compatibility (e.g., older UI)\n                weatherFogLegacy: fog,\n            };\n        } catch {}\n    }, [runtimeSettings, activeMapData]);\n\n    const loadMapData = (mapData) => {\n        try {\n            if (!mapData) {\n                errorHandler.warn('loadMapData called with empty mapData', { component: 'Game' });\n                return;\n            }\n\n            const w = mapData.meta?.width || mapData.width || 20;\n            const h = mapData.meta?.height || mapData.height || 15;\n\n            let tileData = [];\n            let objData = [];\n            let secretData = [];\n\n            if (mapData.layers) {\n                const bgLayer = mapData.layers.find(l => l.name === 'background');\n                tileData = bgLayer ? bgLayer.data : Array(w * h).fill(null);\n\n                const objLayer = mapData.layers.find(l => l.name === 'entities');\n                objData = objLayer ? objLayer.data : Array(w * h).fill(null);\n\n                const secretLayer = mapData.layers.find(l => l.name === 'secrets');\n                secretData = secretLayer ? secretLayer.data : Array(w * h).fill(null);\n            } else {\n                tileData = mapData.tiles || Array(w * h).fill(null);\n                objData = Array(w * h).fill(null);\n                secretData = Array(w * h).fill(null);\n            }\n\n            // Debug logging\n            console.log('[DEBUG] Loading map with secrets:', {\n                hasSecretsLayer: !!mapData.layers?.find(l => l.name === 'secrets'),\n                secretDataLength: secretData?.length,\n                secretDataNonNull: secretData?.filter(s => s !== null).length,\n                secretDataSample: secretData?.filter(s => s !== null).slice(0, 5)\n            });\n\n            // Update Redux store\n            dispatch(setActiveMap({\n                mapData,\n                tileMapData: tileData,\n                objectMapData: objData,\n                secretMapData: secretData,\n                mapWidth: w,\n                mapHeight: h\n            }));\n            dispatch(setCameraScrollX(0));\n            dispatch(setMapModalOpen(false));\n\n            errorHandler.info('Map loaded successfully', {\n                component: 'Game',\n                mapName: mapData.meta?.name || 'Unknown',\n                dimensions: `${w}x${h}`\n            });\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'loadMapData',\n                mapData\n            });\n            alert('Error loading map. Check console for details.');\n        }\n    };\n\n    const handleCustomMapUpload = (event) => {\n        try {\n            const file = event.target.files[0];\n            if (!file) return;\n\n            const fileReader = new FileReader();\n            fileReader.readAsText(file, \"UTF-8\");\n            fileReader.onload = (e) => {\n                try {\n                    const loaded = JSON.parse(e.target.result);\n                    loadMapData(loaded);\n                } catch (error) {\n                    errorHandler.error(error, {\n                        component: 'Game',\n                        function: 'handleCustomMapUpload',\n                        fileName: file.name\n                    });\n                    alert(\"Invalid map file! Check console for details.\");\n                }\n            };\n            fileReader.onerror = (error) => {\n                errorHandler.error(error, {\n                    component: 'Game',\n                    function: 'handleCustomMapUpload',\n                    fileName: file.name,\n                    phase: 'fileReader'\n                });\n                alert(\"Error reading file!\");\n            };\n        } catch (error) {\n            errorHandler.error(error, {\n                component: 'Game',\n                function: 'handleCustomMapUpload'\n            });\n        }\n    };\n\n    return (\n        <GameContainer>\n        \n            {/* Game Header */}\n            <GameHeader health={playerState.health} ammo={playerState.ammo || 0} soundEnabled={soundEnabled} onToggleSound={() => {\n                const next = !soundEnabled;\n                dispatch(setSoundEnabled(next));\n                try { window.dispatchEvent(new CustomEvent('game-sound-toggle', { detail: { enabled: next } })); } catch {}\n                try { window.dispatchEvent(new CustomEvent('game-sound-user-gesture')); } catch {}\n            }} />\n\n\n            {isMapModalOpen && (\n                <ModalOverlay>\n                    <ModalContent>\n                        <ModalTitle>Select a Map</ModalTitle>\n                        <MapList>\n                            {BUILT_IN_MAPS.map((map, index) => (\n                                <MapCard key={index} onClick={() => loadMapData(map)}>\n                                    <div>\n                                        <MapTitle>{map.meta?.name || \"Unnamed Map\"}</MapTitle>\n                                        <MapAuthor>By: {map.meta?.author || \"Unknown\"}</MapAuthor>\n                                    </div>\n                                    <MapInfo>\n                                        <div>Size: {map.meta?.width}x{map.meta?.height}</div>\n                                    </MapInfo>\n                                </MapCard>\n                            ))}\n                        </MapList>\n                        <ModalDivider>\n                            <FileUploadLabel>\n                                 Load Custom Map from Computer\n                                <HiddenFileInput type=\"file\" accept=\".json\" onChange={handleCustomMapUpload} />\n                            </FileUploadLabel>\n                        </ModalDivider>\n                    </ModalContent>\n                </ModalOverlay>\n            )}\n\n            <Viewport\n                ref={viewportRef}\n                onScroll={(e) => dispatch(setCameraScrollX(e.currentTarget.scrollLeft || 0))}\n                $centered={shouldCenterMap}\n                $blurred={isMapModalOpen}\n            >\n                {activeMapData ? (\n                    <GameCanvas $width={mapWidth * 32} $height={mapHeight * 32}>\n                    \n                        {/* PIXI RENDERER */}\n                        <PixiStage\n                            mapWidth={mapWidth}\n                            mapHeight={mapHeight}\n                            tileSize={32}\n                            tileMapData={tileMapData}\n                            objectMapData={objectMapData}\n                            secretMapData={secretMapData}\n                            revealedSecrets={revealedSecrets}\n                            objectTextureIndices={objectTextureIndices}\n                            registryItems={registryItems}\n                            playerState={playerState}\n                            playerVisuals={playerVisuals}\n                            projectiles={playerState.projectiles || []}\n                            backgroundImage={activeMapData?.meta?.backgroundImage}\n                            backgroundColor={activeMapData?.meta?.backgroundColor}\n                            backgroundParallaxFactor={(runtimeSettings.backgroundParallaxFactor ?? activeMapData?.meta?.backgroundParallaxFactor)}\n                            cameraScrollX={cameraScrollX}\n                            weatherRain={runtimeSettings.weatherRain ?? 0}\n                            weatherSnow={runtimeSettings.weatherSnow ?? 0}\n                            weatherClouds={runtimeSettings.weatherClouds ?? 0}\n                            weatherFog={runtimeSettings.weatherFog ?? 0}\n                            weatherThunder={runtimeSettings.weatherThunder ?? 0}\n                            healthBarEnabled={runtimeSettings.healthBarEnabled ?? true}\n                            oxygenBarEnabled={runtimeSettings.oxygenBarEnabled ?? true}\n                            lavaBarEnabled={runtimeSettings.lavaBarEnabled ?? true}\n                            waterSplashesEnabled={runtimeSettings.waterSplashesEnabled ?? true}\n                            lavaEmbersEnabled={runtimeSettings.lavaEmbersEnabled ?? true}\n                        />\n\n                    </GameCanvas>\n                ) : (\n                    <PlaceholderMessage>Select a map to start playing</PlaceholderMessage>\n                )}\n            </Viewport>\n\n            {/* Background music runtime player */}\n            <BackgroundMusicPlayer metaPath={activeMapData?.meta?.backgroundMusic} enabled={soundEnabled} volume={0.6} />\n\n            {/* Overlays at root level so they sit above the canvas and slide from the footer area */}\n            <GameSettings />\n            <GameTerminal />\n        </GameContainer>\n    );\n}\n","// Progressive save utility for web: prefers File System Access API (Chromium)\n// Fallbacks to classic Blob download when not available or when permission denied.\n\n/**\n * Save a file, letting the user choose directory/filename when supported.\n * @param {string|Blob|Uint8Array} contents - Data to write\n * @param {string} suggestedName - Suggested filename, e.g., \"my_map.json\"\n * @param {string} mimeType - MIME type, e.g., \"application/json\"\n * @returns {Promise<boolean>} true if saved, false if cancelled or failed\n */\nexport async function saveFile(contents, suggestedName = 'file.txt', mimeType = 'application/octet-stream') {\n  try {\n    // Prefer native file picker if available (Chromium: Edge/Chrome/Opera/Brave)\n    const hasPicker = typeof window !== 'undefined' && typeof window.showSaveFilePicker === 'function';\n    if (hasPicker) {\n      const opts = {\n        suggestedName,\n        types: [\n          {\n            description: 'File',\n            accept: { [mimeType || 'application/octet-stream']: [`.${(suggestedName.split('.').pop() || 'dat')}`] }\n          }\n        ]\n      };\n      let handle;\n      try {\n        handle = await window.showSaveFilePicker(opts);\n      } catch (e) {\n        // User cancelled the dialog\n        if (e && (e.name === 'AbortError' || e.name === 'NotAllowedError')) return false;\n        throw e;\n      }\n\n      const writable = await handle.createWritable();\n      const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n      await writable.write(blob);\n      await writable.close();\n      return true;\n    }\n  } catch (e) {\n    // fall through to fallback\n    try { console.warn('Native save picker failed, using download fallback:', e); } catch {}\n  }\n\n  // Fallback: trigger a download to the browser default location\n  try {\n    const blob = contents instanceof Blob ? contents : new Blob([contents], { type: mimeType });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = suggestedName || 'file.dat';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    setTimeout(() => URL.revokeObjectURL(link.href), 0);\n    return true;\n  } catch (e) {\n    try { console.error('Download fallback failed:', e); } catch {}\n    return false;\n  }\n}\n\nexport default saveFile;\n","export const getFloodFillIndices = (startIndex, currentData, mapWidth, mapHeight) => {\n    const startId = currentData[startIndex];\n    const width = mapWidth;\n    const height = mapHeight;\n    const stack = [startIndex];\n    const visited = new Set();\n    const matchingIndices = [];\n\n    while (stack.length > 0) {\n        const idx = stack.pop();\n        if (visited.has(idx)) continue;\n        visited.add(idx);\n        if (idx < 0 || idx >= currentData.length) continue;\n        if (currentData[idx] !== startId) continue;\n        matchingIndices.push(idx);\n\n        const x = idx % width;\n        const y = Math.floor(idx / width);\n        if (x > 0) stack.push(idx - 1);\n        if (x < width - 1) stack.push(idx + 1);\n        if (y > 0) stack.push(idx - width);\n        if (y < height - 1) stack.push(idx + width);\n    }\n    return matchingIndices;\n};\n\nexport const floodFill = (startIndex, targetId, getCurrentData, setCurrentData, mapWidth, mapHeight) => {\n    const currentData = getCurrentData();\n    const startId = currentData[startIndex];\n    if (startId === targetId) return;\n\n    const indices = getFloodFillIndices(startIndex, currentData, mapWidth, mapHeight);\n    const newData = [...currentData];\n    indices.forEach(idx => newData[idx] = targetId);\n    setCurrentData(newData);\n};\n\nexport const paintTile = (index, selectedTile, brushSize, mapWidth, mapHeight, getCurrentData, setCurrentData) => {\n    const currentData = getCurrentData();\n    const newData = [...currentData];\n    const x = index % mapWidth;\n    const y = Math.floor(index / mapWidth);\n\n    for (let dy = 0; dy < brushSize; dy++) {\n        for (let dx = 0; dx < brushSize; dx++) {\n            const targetX = x + dx;\n            const targetY = y + dy;\n            if (targetX < mapWidth && targetY < mapHeight) {\n                const targetIndex = targetY * mapWidth + targetX;\n                newData[targetIndex] = selectedTile ? selectedTile.id : null;\n            }\n        }\n    }\n    setCurrentData(newData);\n};\n","import React, { useState, useEffect } from 'react';\n\nconst AnimatedItem = ({ textures, texture, speed, style, alt, className }) => {\n    const [index, setIndex] = useState(0);\n\n    useEffect(() => {\n        // Ja ir vairkas tekstras, skam animciju\n        if (textures && textures.length > 1) {\n            const interval = setInterval(() => {\n                setIndex((prevIndex) => (prevIndex + 1) % textures.length);\n            }, speed || 500); // Noklusjuma trums 500ms\n\n            return () => clearInterval(interval);\n        }\n    }, [textures, speed]);\n\n    // Izvlamies ko rendert: animcijas kadru, viengo tekstru vai statisko bildi\n    let imgSrc = null;\n    if (textures && textures.length > 0) {\n        imgSrc = textures[index % textures.length];\n    } else if (texture) {\n        imgSrc = texture;\n    }\n\n    if (!imgSrc) return null;\n\n    return (\n        <img\n            src={imgSrc}\n            alt={alt || ''}\n            style={style}\n            className={className}\n            draggable={false} // Biei nodergi spls/editoros\n        />\n    );\n};\n\nexport default AnimatedItem;","import React from 'react';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\n\nexport const Viewport = ({\n    mapWidth,\n    mapHeight,\n    selectedBackgroundUrl,\n    selectedBackgroundColor,\n    selectedBackgroundImage,\n    showGrid,\n    activeLayer,\n    activeTool,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    registryItems,\n    hoverIndex,\n    brushSize,\n    bucketPreviewIndices,\n    selection,\n    previewPosition,\n    dragStart,\n    isDragging,\n    handleGridMouseDown,\n    handleGridMouseEnter,\n    handleGridMouseUp,\n    handleGridMouseLeave,\n    setIsDragging\n}) => {\n    return (\n        <div className=\"viewport\"\n            style={{\n                flex: 1, padding: '40px', backgroundColor: '#555',\n                overflow: 'auto', position: 'relative', userSelect: 'none'\n            }}\n            onMouseUp={() => setIsDragging(false)}>\n            <div style={{ position: 'relative', width: 'fit-content' }} onMouseLeave={handleGridMouseLeave}>\n                {/* Background preview layer */}\n                <div\n                    style={{\n                        position: 'absolute',\n                        top: 0,\n                        left: 0,\n                        width: mapWidth * 32,\n                        height: mapHeight * 32,\n                        backgroundImage: selectedBackgroundUrl ? `url(${selectedBackgroundUrl})` : 'none',\n                        backgroundColor: !selectedBackgroundUrl ? selectedBackgroundColor : 'transparent',\n                        backgroundRepeat: 'repeat-x',\n                        backgroundSize: 'auto 100%',\n                        zIndex: 0,\n                        pointerEvents: 'none'\n                    }}\n                />\n                <div className=\"grid\"\n                    style={{\n                        display: 'grid',\n                        gridTemplateColumns: `repeat(${mapWidth}, 32px)`,\n                        gridTemplateRows: `repeat(${mapHeight}, 32px)`,\n                        gap: '0px',\n                        border: '1px solid #444',\n                        backgroundColor: 'transparent',\n                        position: 'relative',\n                        cursor: activeTool === 'bucket' ? 'cell' : 'default',\n                        zIndex: 1\n                    }}>\n                    {Array(mapWidth * mapHeight).fill(0).map((_, index) => {\n                        const x = index % mapWidth;\n                        const y = Math.floor(index / mapWidth);\n\n                        // Check if this tile is in preview selection area\n                        let displayTileId = tileMapData[index];\n                        let displayObjectId = objectMapData[index];\n                        let displaySecretId = secretMapData?.[index];\n\n                        // If we have a preview position, check if this tile should show selection content\n                        if (selection && previewPosition) {\n                            const selX = previewPosition.x;\n                            const selY = previewPosition.y;\n\n                            if (x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                                // This tile is in the preview selection area\n                                const offsetX = x - selX;\n                                const offsetY = y - selY;\n                                const selectionIndex = offsetY * selection.w + offsetX;\n\n                                displayTileId = selection.tileData[selectionIndex];\n                                displayObjectId = selection.objectData[selectionIndex];\n                                displaySecretId = selection.secretData?.[selectionIndex];\n                            }\n                        }\n\n                        const tileObj = displayTileId ? registryItems.find(r => r.id === displayTileId) : null;\n                        const objObj = displayObjectId ? registryItems.find(r => r.id === displayObjectId) : null;\n                        const secretObj = displaySecretId ? registryItems.find(r => r.id === displaySecretId) : null;\n\n                        let isSelected = false;\n                        let isPreviewSelection = false;\n\n                        // Use previewPosition if available, otherwise use selection.x/y\n                        const selX = previewPosition ? previewPosition.x : (selection ? selection.x : 0);\n                        const selY = previewPosition ? previewPosition.y : (selection ? selection.y : 0);\n\n                        if (selection && x >= selX && x < selX + selection.w && y >= selY && y < selY + selection.h) {\n                            isSelected = true;\n                            if (previewPosition && (previewPosition.x !== selection.originalX || previewPosition.y !== selection.originalY)) {\n                                isPreviewSelection = true;\n                            }\n                        }\n\n                        let isMoveSelecting = false;\n                        let isMoveHover = false;\n                        if (activeTool === 'move') {\n                            if (isDragging && dragStart && hoverIndex !== null) {\n                                const hx = hoverIndex % mapWidth;\n                                const hy = Math.floor(hoverIndex / mapWidth);\n                                const sx = dragStart.x;\n                                const sy = dragStart.y;\n                                const minX = Math.min(sx, hx);\n                                const minY = Math.min(sy, hy);\n                                const maxX = Math.max(sx, hx);\n                                const maxY = Math.max(sy, hy);\n                                if (x >= minX && x <= maxX && y >= minY && y <= maxY) isMoveSelecting = true;\n                            } else if (!isDragging && hoverIndex === index) {\n                                isMoveHover = true;\n                            }\n                        }\n\n                        let isBrushTarget = false;\n                        if ((activeTool === 'brush') && hoverIndex !== null) {\n                            const hx = hoverIndex % mapWidth;\n                            const hy = Math.floor(hoverIndex / mapWidth);\n                            if (x >= hx && x < hx + brushSize && y >= hy && y < hy + brushSize) isBrushTarget = true;\n                        }\n\n                        let isBucketTarget = false;\n                        let isBucketPreview = false;\n                        if (activeTool === 'bucket') {\n                            if (bucketPreviewIndices.has(index)) isBucketPreview = true;\n                            else if (hoverIndex === index) isBucketTarget = true;\n                        }\n\n                        let borderStyle = showGrid ? '0.5px solid rgba(128,128,128,0.5)' : 'none';\n                        let bgStyle = 'transparent';\n\n                        const isLiquidTile = !!(tileObj && tileObj.flags && tileObj.flags.liquid);\n                        const isWaterTile = !!(tileObj && tileObj.flags && tileObj.flags.water);\n                        const isLavaTile = !!(tileObj && tileObj.flags && tileObj.flags.lava);\n\n                        if (isBrushTarget) borderStyle = '2px solid red';\n                        else if (isBucketPreview) { borderStyle = '1px dashed orange'; bgStyle = 'rgb(168,187,220)'; }\n                        else if (isBucketTarget) borderStyle = '2px solid orange';\n                        else if (isMoveHover) borderStyle = '2px solid blue';\n                        else if (isMoveSelecting) { borderStyle = '1px dashed blue'; bgStyle = 'rgba(0, 0, 255, 0.1)'; }\n                        else if (isSelected) {\n                            if (isPreviewSelection) {\n                                borderStyle = '2px solid cyan';\n                                bgStyle = 'rgba(0, 255, 255, 0.2)';\n                            } else {\n                                borderStyle = '1px dashed red';\n                                bgStyle = 'rgba(255, 255, 0, 0.3)';\n                            }\n                        }\n                        else if (!showGrid) borderStyle = 'none';\n\n                        let backgroundStyleObj = {};\n                        if (bgStyle !== 'transparent') {\n                            backgroundStyleObj.backgroundColor = bgStyle;\n                        } else if (isLiquidTile) {\n                            if (isWaterTile) {\n                                backgroundStyleObj.background = 'linear-gradient(180deg, #2a5d8f, #174369)';\n                            } else if (isLavaTile) {\n                                backgroundStyleObj.background = 'linear-gradient(180deg, #6b1a07, #c43f0f)';\n                            } else {\n                                backgroundStyleObj.background = 'linear-gradient(180deg, #3a3a3a, #1e1e1e)';\n                            }\n                        }\n\n                        return (\n                            <div key={index}\n                                onMouseDown={(e) => handleGridMouseDown(index, e)}\n                                onMouseEnter={() => handleGridMouseEnter(index)}\n                                onMouseUp={() => handleGridMouseUp(index)}\n                                style={{\n                                    width: '32px', height: '32px', border: borderStyle,\n                                    zIndex: (isBrushTarget || isBucketTarget || isBucketPreview || isMoveHover || isMoveSelecting) ? 20 : (isSelected ? 15 : 1),\n                                    boxSizing: 'border-box', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative',\n                                    ...backgroundStyleObj\n                                }}>\n                                {/* Background Layer (Tiles) */}\n                                {tileObj && <AnimatedItem\n                                    textures={tileObj.textures}\n                                    texture={tileObj.texture}\n                                    speed={tileObj.animationSpeed}\n                                    style={{ position: 'absolute', width: '100%', height: '100%', objectFit: 'contain', zIndex: 2 }}\n                                />}\n\n                                {/* Foreground Layer (Objects) */}\n                                {objObj && <AnimatedItem\n                                    textures={objObj.textures}\n                                    texture={objObj.texture}\n                                    speed={objObj.animationSpeed}\n                                    style={{ position: 'absolute', width: '100%', height: '100%', objectFit: 'contain', zIndex: 3 }}\n                                />}\n\n                                {/* Secret Layer (Dark Filter) */}\n                                {secretObj && (\n                                    <div style={{\n                                        position: 'absolute',\n                                        width: '100%',\n                                        height: '100%',\n                                        background: secretObj.filterColor || 'rgba(0, 0, 0, 0.5)',\n                                        zIndex: 4,\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center',\n                                        fontSize: '8px',\n                                        color: 'rgba(255, 255, 255, 0.6)',\n                                        fontWeight: 'bold',\n                                        pointerEvents: 'none'\n                                    }}>\n                                        {secretObj.subtype === 'above' ? 'A' : 'B'}\n                                    </div>\n                                )}\n\n                                <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', zIndex: 10 }} />\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n        </div>\n    );\n};\n","export const baseButtonStyle = {\n    display: 'inline-flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    border: '1px solid #333',\n    padding: '0 10px',\n    height: '28px',\n    backgroundColor: '#e0e0e0',\n    marginRight: '5px',\n    marginBottom: '5px',\n    fontSize: '13px',\n    color: '#000',\n    borderRadius: '3px',\n    userSelect: 'none',\n    minWidth: '30px',\n    boxSizing: 'border-box',\n    textDecoration: 'none',\n    lineHeight: 'normal'\n};\n\nexport const buttonStyle = { ...baseButtonStyle };\n\nexport const activeButtonStyle = {\n    ...baseButtonStyle,\n    backgroundColor: '#aaa',\n    borderColor: '#000',\n    fontWeight: 'bold'\n};\n","import React from 'react';\nimport { buttonStyle } from './constants';\n\nexport const NewMapModal = ({\n    isOpen,\n    tempMapName,\n    setTempMapName,\n    tempCreatorName,\n    setTempCreatorName,\n    confirmNewMap,\n    onClose\n}) => {\n    if (!isOpen) return null;\n\n    return (\n        <div style={{\n            position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\n            backgroundColor: 'rgba(0, 0, 0, 0.5)', zIndex: 1000,\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\n        }}>\n            <div style={{\n                backgroundColor: '#fff', padding: '20px', borderRadius: '8px',\n                boxShadow: '0 4px 6px rgba(0,0,0,0.1)', width: '300px',\n                display: 'flex', flexDirection: 'column', gap: '10px'\n            }}>\n                <h3 style={{ marginTop: 0 }}>Create New Map</h3>\n\n                <div>\n                    <label style={{ display: 'block', fontSize: '12px', marginBottom: '4px' }}>Map Name:</label>\n                    <input\n                        type=\"text\"\n                        value={tempMapName}\n                        onChange={(e) => setTempMapName(e.target.value)}\n                        style={{ width: '100%', padding: '5px', boxSizing: 'border-box' }}\n                    />\n                </div>\n\n                <div>\n                    <label style={{ display: 'block', fontSize: '12px', marginBottom: '4px' }}>Creator Nickname:</label>\n                    <input\n                        type=\"text\"\n                        value={tempCreatorName}\n                        onChange={(e) => setTempCreatorName(e.target.value)}\n                        style={{ width: '100%', padding: '5px', boxSizing: 'border-box' }}\n                    />\n                </div>\n\n                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '10px' }}>\n                    <button onClick={onClose} style={{ ...buttonStyle, backgroundColor: '#f0f0f0' }}>Cancel</button>\n                    <button onClick={confirmNewMap} style={{ ...buttonStyle, backgroundColor: '#4CAF50', color: 'white', borderColor: '#4CAF50' }}>Create</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\n\nexport const DraggableWindow = ({\n    title,\n    children,\n    defaultPosition = { x: 20, y: 20 },\n    defaultWidth = 280,\n    isOpenDefault = true,\n    onHeightChange\n}) => {\n    const [position] = useState(defaultPosition);\n    const [isDragging, setIsDragging] = useState(false);\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n    const [currentPosition, setCurrentPosition] = useState(defaultPosition);\n    const [isMinimized, setIsMinimized] = useState(!isOpenDefault);\n    const [isClosed, setIsClosed] = useState(false);\n    const [hasBeenDragged, setHasBeenDragged] = useState(false);\n    const windowRef = useRef(null);\n\n    // Update position from parent when not dragged\n    useEffect(() => {\n        if (!hasBeenDragged) {\n            setCurrentPosition(defaultPosition);\n        }\n    }, [defaultPosition, hasBeenDragged]);\n\n    // Notify parent about height changes\n    useEffect(() => {\n        if (windowRef.current && onHeightChange) {\n            const height = windowRef.current.offsetHeight;\n            onHeightChange(height);\n        }\n    }, [isMinimized, onHeightChange]);\n\n    useEffect(() => {\n        if (isDragging) {\n            const handleMouseMove = (e) => {\n                setCurrentPosition({\n                    x: e.clientX - dragOffset.x,\n                    y: e.clientY - dragOffset.y\n                });\n            };\n\n            const handleMouseUp = () => {\n                setIsDragging(false);\n            };\n\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isDragging, dragOffset]);\n\n    const handleMouseDown = (e) => {\n        if (windowRef.current) {\n            const rect = windowRef.current.getBoundingClientRect();\n            setDragOffset({\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            });\n            setIsDragging(true);\n            setHasBeenDragged(true);\n        }\n    };\n\n    if (isClosed) return null;\n\n    return (\n        <div\n            ref={windowRef}\n            style={{\n                position: 'fixed',\n                left: currentPosition.x,\n                top: currentPosition.y,\n                width: defaultWidth,\n                backgroundColor: '#f8f8f8',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n                zIndex: 10,\n                display: 'flex',\n                flexDirection: 'column',\n                maxHeight: '80vh'\n            }}\n        >\n            {/* Window Header */}\n            <div\n                onMouseDown={handleMouseDown}\n                style={{\n                    padding: '8px 10px',\n                    backgroundColor: '#e0e0e0',\n                    borderTopLeftRadius: '4px',\n                    borderTopRightRadius: '4px',\n                    cursor: isDragging ? 'grabbing' : 'grab',\n                    fontWeight: 'bold',\n                    fontSize: '13px',\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    userSelect: 'none',\n                    borderBottom: '1px solid #ccc'\n                }}\n            >\n                <span>{title}</span>\n                <div style={{ display: 'flex', gap: '4px' }}>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsMinimized(!isMinimized);\n                        }}\n                        style={{\n                            background: '#ffc107',\n                            border: 'none',\n                            borderRadius: '2px',\n                            width: '18px',\n                            height: '18px',\n                            cursor: 'pointer',\n                            fontSize: '12px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title={isMinimized ? \"Maximize\" : \"Minimize\"}\n                    >\n                        {isMinimized ? '' : ''}\n                    </button>\n                    <button\n                        onClick={(e) => {\n                            e.stopPropagation();\n                            setIsClosed(true);\n                        }}\n                        style={{\n                            background: '#f44336',\n                            border: 'none',\n                            borderRadius: '2px',\n                            width: '18px',\n                            height: '18px',\n                            cursor: 'pointer',\n                            color: '#fff',\n                            fontSize: '12px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            padding: 0\n                        }}\n                        title=\"Close\"\n                    >\n                        \n                    </button>\n                </div>\n            </div>\n\n            {/* Window Content */}\n            {!isMinimized && (\n                <div\n                    style={{\n                        padding: '10px',\n                        overflowY: 'auto',\n                        flex: 1\n                    }}\n                >\n                    {children}\n                </div>\n            )}\n        </div>\n    );\n};\n","import React, { useState } from 'react';\n\nexport const PaletteSection = ({ title, children, isOpenDefault = false }) => {\n    const [isOpen, setIsOpen] = useState(isOpenDefault);\n    return (\n        <div style={{ marginBottom: '5px', border: '1px solid #ddd', borderRadius: '4px', backgroundColor: '#fff' }}>\n            <div onClick={() => setIsOpen(!isOpen)} style={{ padding: '8px', cursor: 'pointer', backgroundColor: '#f0f0f0', fontWeight: 'bold', fontSize: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', userSelect: 'none' }}>\n                <span>{title}</span><span>{isOpen ? '' : ''}</span>\n            </div>\n            {isOpen && <div style={{ padding: '8px', maxHeight: '200px', overflowY: 'auto' }}>{children}</div>}\n        </div>\n    );\n};\n","import React, { useRef, useEffect } from 'react';\n\nexport const Minimap = ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    registryItems\n}) => {\n    const canvasRef = useRef(null);\n    const minimapWidth = 250;\n    const minimapHeight = 200;\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        const tileWidth = minimapWidth / mapWidth;\n        const tileHeight = minimapHeight / mapHeight;\n\n        // Clear canvas\n        ctx.fillStyle = '#87CEEB';\n        ctx.fillRect(0, 0, minimapWidth, minimapHeight);\n\n        // Draw tiles\n        for (let y = 0; y < mapHeight; y++) {\n            for (let x = 0; x < mapWidth; x++) {\n                const index = y * mapWidth + x;\n                const tileId = tileMapData[index];\n                const objectId = objectMapData[index];\n\n                const px = x * tileWidth;\n                const py = y * tileHeight;\n\n                // Draw tile\n                if (tileId !== null) {\n                    const tile = registryItems.find(item => item.id === tileId);\n                    if (tile) {\n                        if (tile.flags?.liquid) {\n                            if (tile.flags.water) {\n                                ctx.fillStyle = '#2a5d8f';\n                            } else if (tile.flags.lava) {\n                                ctx.fillStyle = '#c43f0f';\n                            } else {\n                                ctx.fillStyle = '#888';\n                            }\n                        } else {\n                            // Solid block - darker color\n                            ctx.fillStyle = '#654321';\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n\n                // Draw object on top\n                if (objectId !== null) {\n                    const obj = registryItems.find(item => item.id === objectId);\n                    if (obj) {\n                        // Objects in bright colors\n                        if (obj.name?.startsWith('entities.')) {\n                            ctx.fillStyle = '#ff0000'; // Red for entities\n                        } else if (obj.name?.startsWith('item.')) {\n                            ctx.fillStyle = '#00ff00'; // Green for items\n                        } else if (obj.name?.startsWith('interactable.')) {\n                            ctx.fillStyle = '#ff00ff'; // Magenta for interactables\n                        } else if (obj.type === 'hazard') {\n                            ctx.fillStyle = '#ff8800'; // Orange for hazards\n                        } else {\n                            ctx.fillStyle = '#ffff00'; // Yellow for others\n                        }\n                        ctx.fillRect(px, py, Math.ceil(tileWidth), Math.ceil(tileHeight));\n                    }\n                }\n            }\n        }\n\n        // Draw grid\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';\n        ctx.lineWidth = 0.5;\n        for (let x = 0; x <= mapWidth; x++) {\n            ctx.beginPath();\n            ctx.moveTo(x * tileWidth, 0);\n            ctx.lineTo(x * tileWidth, minimapHeight);\n            ctx.stroke();\n        }\n        for (let y = 0; y <= mapHeight; y++) {\n            ctx.beginPath();\n            ctx.moveTo(0, y * tileHeight);\n            ctx.lineTo(minimapWidth, y * tileHeight);\n            ctx.stroke();\n        }\n\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, registryItems]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={minimapWidth}\n            height={minimapHeight}\n            style={{\n                width: '100%',\n                height: 'auto',\n                border: '1px solid #ccc',\n                borderRadius: '4px',\n                backgroundColor: '#87CEEB',\n                imageRendering: 'pixelated'\n            }}\n        />\n    );\n};\n","import React, { useState, useRef, useEffect } from 'react';\n\nexport const MapResizer = ({\n    mapWidth,\n    mapHeight,\n    onResize\n}) => {\n    const containerRef = useRef(null);\n    const [isDragging, setIsDragging] = useState(false);\n    const [startSize, setStartSize] = useState({ width: mapWidth, height: mapHeight });\n    const [startMousePos, setStartMousePos] = useState({ x: 0, y: 0 });\n\n    // Calculate display size (each block is represented by 10px)\n    const displayWidth = mapWidth * 10;\n    const displayHeight = mapHeight * 10;\n\n    const handleCornerMouseDown = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(true);\n        setStartSize({ width: mapWidth, height: mapHeight });\n        setStartMousePos({ x: e.clientX, y: e.clientY });\n    };\n\n    useEffect(() => {\n        if (!isDragging) return;\n\n        const handleMouseMove = (e) => {\n            const dx = e.clientX - startMousePos.x;\n            const dy = e.clientY - startMousePos.y;\n\n            // Each 10px of drag = 1 block\n            const blocksX = Math.round(dx / 10);\n            const blocksY = Math.round(dy / 10);\n\n            const newWidth = Math.max(5, Math.min(100, startSize.width + blocksX));\n            const newHeight = Math.max(5, Math.min(100, startSize.height + blocksY));\n\n            if (newWidth !== mapWidth || newHeight !== mapHeight) {\n                onResize(newWidth, newHeight);\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, startMousePos, startSize, mapWidth, mapHeight, onResize]);\n\n    return (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 'bold', textAlign: 'center' }}>\n                Map Size: <span style={{ color: '#4CAF50' }}>{mapWidth}  {mapHeight}</span> blocks\n            </div>\n\n            <div\n                ref={containerRef}\n                style={{\n                    position: 'relative',\n                    width: displayWidth + 'px',\n                    height: displayHeight + 'px',\n                    border: '2px solid #4CAF50',\n                    backgroundColor: '#e8f5e9',\n                    borderRadius: '4px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '12px',\n                    color: '#2e7d32',\n                    fontWeight: 'bold',\n                    userSelect: 'none',\n                    minWidth: '50px',\n                    minHeight: '50px'\n                }}\n            >\n                {mapWidth}  {mapHeight}\n\n                {/* Resize handle - bottom right corner */}\n                <div\n                    onMouseDown={handleCornerMouseDown}\n                    style={{\n                        position: 'absolute',\n                        bottom: -5,\n                        right: -5,\n                        width: '15px',\n                        height: '15px',\n                        backgroundColor: '#4CAF50',\n                        cursor: 'nwse-resize',\n                        borderRadius: '50%',\n                        border: '2px solid #fff',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n                        zIndex: 10\n                    }}\n                />\n            </div>\n\n            <div style={{ fontSize: '11px', color: '#666', textAlign: 'center' }}>\n                 Drag the corner to resize the map<br/>\n                (Min: 55, Max: 100100)\n            </div>\n        </div>\n    );\n};\n","import React, { useState, useEffect } from 'react';\nimport { DraggableWindow } from './DraggableWindow';\nimport { PaletteSection } from './PaletteSection';\nimport { Minimap } from './Minimap';\nimport { MapResizer } from './MapResizer';\nimport AnimatedItem from '../../../utilities/AnimatedItem';\nimport BackgroundMusicPlayer from '../../../utilities/BackgroundMusicPlayer';\nimport { buttonStyle, activeButtonStyle } from './constants';\n\nexport const ToolbarWindows = ({\n    mapName,\n    creatorName,\n    openNewMapModal,\n    saveMap,\n    loadMap,\n    showGrid,\n    setShowGrid,\n    clearMap,\n    activeTool,\n    setActiveTool,\n    brushSize,\n    setBrushSize,\n    activeLayer,\n    selection,\n    moveSelection,\n    setSelection,\n    selectionMode,\n    setSelectionMode,\n    commitSelection,\n    cancelSelection,\n    selectedTile,\n    handlePaletteSelect,\n    blocks,\n    liquids,\n    entities,\n    items,\n    interactables,\n    hazards,\n    secrets,\n    backgroundOptions,\n    selectedBackgroundImage,\n    setSelectedBackgroundImage,\n    selectedBackgroundColor,\n    setSelectedBackgroundColor,\n    backgroundParallaxFactor,\n    setBackgroundParallaxFactor,\n    musicOptions,\n    selectedBackgroundMusic,\n    setSelectedBackgroundMusic,\n    totalTiles,\n    filledBlocks,\n    emptyBlocks,\n    objectsCount,\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    registryItems,\n    onMapResize\n}) => {\n    const [isResizeWindowOpen, setIsResizeWindowOpen] = useState(false);\n    const renderPaletteItem = (item, color, layer) => {\n        const hasImage = !!(item.texture || (Array.isArray(item.textures) && item.textures.length > 0));\n        const isLiquid = !!(item.flags && item.flags.liquid);\n        const isWater = !!(item.flags && item.flags.water);\n        const isLava = !!(item.flags && item.flags.lava);\n        const isSecret = item.type === 'secret';\n        const swatchStyle = isWater\n            ? { background: 'linear-gradient(180deg,#2a5d8f,#174369)' }\n            : (isLava ? { background: 'linear-gradient(180deg,#6b1a07,#c43f0f)' } : { background: '#eee' });\n\n        return (\n            <div\n                key={item.id}\n                onClick={() => handlePaletteSelect(item, layer)}\n                title={item.name}\n                style={{\n                    border: selectedTile?.id === item.id ? `2px solid ${color}` : '1px solid #ccc',\n                    cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', backgroundColor: '#fff',\n                    position: 'relative'\n                }}\n            >\n                {isSecret ? (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\n                        background: item.filterColor || 'rgba(0, 0, 0, 0.5)',\n                        color: '#fff', fontSize: 8, textAlign: 'center', lineHeight: 1.1, fontWeight: 'bold'\n                    }}>\n                        {item.subtype === 'above' ? 'ABOVE' : 'BELOW'}\n                    </div>\n                ) : hasImage ? (\n                    <AnimatedItem\n                        textures={item.textures}\n                        texture={item.texture}\n                        speed={item.animationSpeed}\n                        style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }}\n                        alt={item.name}\n                    />\n                ) : (\n                    <div style={{\n                        width: '100%', height: '100%', borderRadius: 2,\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff',\n                        fontSize: 10, textAlign: 'center', lineHeight: 1.1,\n                        ...swatchStyle\n                    }}>\n                        {isLiquid ? (isWater ? 'WATER' : (isLava ? 'LAVA' : 'LIQ')) : (item.name || '')}\n                    </div>\n                )}\n            </div>\n        );\n    };\n\n    const BlockEraser = () => (\n        <div onClick={() => { handlePaletteSelect(null, 'tile'); }} title=\"Erase Blocks (Background)\"\n            style={{\n                border: (selectedTile === null && activeLayer === 'tile') ? `2px solid blue` : '1px solid #ccc',\n                cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\n                backgroundColor: '#f0f8ff', fontSize: '16px', color: 'blue'\n            }}>\n            B\n        </div>\n    );\n\n    const ObjectEraser = () => (\n        <div onClick={() => { handlePaletteSelect(null, 'object'); }} title=\"Erase Objects (Entities/Items)\"\n            style={{\n                border: (selectedTile === null && activeLayer === 'object') ? `2px solid red` : '1px solid #ccc',\n                cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\n                backgroundColor: '#fff0f0', fontSize: '16px', color: 'red'\n            }}>\n            O\n        </div>\n    );\n\n    const SecretEraser = () => (\n        <div onClick={() => { handlePaletteSelect(null, 'secret'); }} title=\"Erase Secrets\"\n            style={{\n                border: (selectedTile === null && activeLayer === 'secret') ? `2px solid purple` : '1px solid #ccc',\n                cursor: 'pointer', padding: '2px', width: '36px', height: '36px',\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\n                backgroundColor: '#f8f0ff', fontSize: '16px', color: 'purple'\n            }}>\n            S\n        </div>\n    );\n\n    // State to track window heights\n    const [heights, setHeights] = useState([37, 37, 37, 37, 37]); // Default header height\n    const baseY = 60;\n    const startX = 20;\n\n    // Calculate Y positions based on accumulated heights\n    const positions = heights.reduce((acc, height, index) => {\n        const y = index === 0 ? baseY : acc[index - 1].y + heights[index - 1];\n        acc.push({ x: startX, y });\n        return acc;\n    }, []);\n\n    return (\n        <>\n            {/* Window 1: Map Controls */}\n            <DraggableWindow\n                title=\"Map Controls\"\n                defaultPosition={positions[0]}\n                defaultWidth={300}\n                isOpenDefault={false}\n                onHeightChange={(h) => setHeights(prev => {\n                    const newHeights = [...prev];\n                    newHeights[0] = h;\n                    return newHeights;\n                })}\n            >\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <div style={{ fontSize: '12px' }}>Map Name: <strong>{mapName}</strong></div>\n                    <div style={{ fontSize: '12px' }}>Creator: <strong>{creatorName}</strong></div>\n\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '5px' }}>\n                        <button onClick={openNewMapModal} style={{ ...buttonStyle, backgroundColor: '#4CAF50', color: '#fff', borderColor: '#388E3C' }}>New</button>\n                        <button onClick={saveMap} style={buttonStyle}>Save</button>\n                        <label style={buttonStyle}>Load <input type=\"file\" accept=\".json,.txt\" onChange={loadMap} style={{ display: 'none' }} /></label>\n                        <button onClick={() => setIsResizeWindowOpen(!isResizeWindowOpen)} style={isResizeWindowOpen ? activeButtonStyle : buttonStyle} title=\"Resize Map\"></button>\n                        <button onClick={() => setShowGrid(!showGrid)} style={showGrid ? activeButtonStyle : buttonStyle}>#</button>\n                        <button onClick={clearMap} style={{ ...buttonStyle, color: 'red' }} title=\"Clear Map\"></button>\n                    </div>\n                </div>\n            </DraggableWindow>\n\n            {/* Window 2: Tools */}\n            <DraggableWindow\n                title=\"Tools & Erase\"\n                defaultPosition={positions[1]}\n                defaultWidth={300}\n                isOpenDefault={false}\n                onHeightChange={(h) => setHeights(prev => {\n                    const newHeights = [...prev];\n                    newHeights[1] = h;\n                    return newHeights;\n                })}\n            >\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <div>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '5px' }}>TOOLS</span>\n                        <button onClick={() => setActiveTool('brush')} style={activeTool === 'brush' ? activeButtonStyle : buttonStyle}></button>\n                        <button onClick={() => setActiveTool('bucket')} style={activeTool === 'bucket' ? activeButtonStyle : buttonStyle}></button>\n                        <button onClick={() => setActiveTool('move')} style={activeTool === 'move' ? activeButtonStyle : buttonStyle}></button>\n\n                        {(activeTool === 'brush') && (\n                            <div style={{ marginTop: '5px' }}>\n                                <span style={{ fontSize: '11px', marginRight: '5px' }}>Size:</span>\n                                {[1, 2, 3, 4, 5].map(size => (\n                                    <button key={size} onClick={() => setBrushSize(size)}\n                                        style={{ ...(brushSize === size ? activeButtonStyle : buttonStyle), padding: '0 6px', minWidth: '20px' }}>\n                                        {size}\n                                    </button>\n                                ))}\n                            </div>\n                        )}\n\n                        <div style={{ marginTop: '10px', padding: '5px', backgroundColor: activeLayer === 'tile' ? '#e6f7ff' : (activeLayer === 'object' ? '#fff1f0' : '#f8f0ff'), borderRadius: '4px', border: '1px solid #ccc' }}>\n                            <span style={{ fontSize: '11px' }}>Active: <strong>{activeLayer === 'tile' ? ' Background' : (activeLayer === 'object' ? ' Objects' : ' Secrets')}</strong></span>\n                        </div>\n\n                        {activeTool === 'move' && (\n                            <div style={{ marginTop: '10px' }}>\n                                <span style={{ fontSize: '11px', display: 'block', marginBottom: '5px' }}>Selection Mode:</span>\n                                <button\n                                    onClick={() => setSelectionMode('cut')}\n                                    style={selectionMode === 'cut' ? activeButtonStyle : buttonStyle}\n                                    title=\"Cut (move)\"\n                                >\n                                     Cut\n                                </button>\n                                <button\n                                    onClick={() => setSelectionMode('copy')}\n                                    style={selectionMode === 'copy' ? activeButtonStyle : buttonStyle}\n                                    title=\"Copy (duplicate)\"\n                                >\n                                     Copy\n                                </button>\n                            </div>\n                        )}\n\n                        {activeTool === 'move' && selection && (\n                            <div style={{ marginTop: '10px', padding: '8px', backgroundColor: '#fff3cd', borderRadius: '4px', border: '1px solid #ffc107' }}>\n                                <span style={{ fontSize: '11px', display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Selection Active</span>\n                                <div style={{ fontSize: '10px', marginBottom: '5px' }}>\n                                     Drag with mouse or use arrows<br/>\n                                     Press <strong>Enter</strong> to confirm<br/>\n                                     Press <strong>Esc</strong> to cancel\n                                </div>\n                                <div style={{ marginTop: '5px' }}>\n                                    <button onClick={() => moveSelection(0, -1)} style={buttonStyle}></button>\n                                    <div style={{ display: 'inline-block' }}>\n                                        <button onClick={() => moveSelection(-1, 0)} style={buttonStyle}></button>\n                                        <button onClick={() => moveSelection(1, 0)} style={buttonStyle}></button>\n                                    </div>\n                                    <button onClick={() => moveSelection(0, 1)} style={buttonStyle}></button>\n                                </div>\n                                <div style={{ marginTop: '5px' }}>\n                                    <button onClick={commitSelection} style={{ ...buttonStyle, backgroundColor: '#28a745', color: '#fff' }}> Confirm</button>\n                                    <button onClick={cancelSelection} style={{ ...buttonStyle, backgroundColor: '#dc3545', color: '#fff' }}> Cancel</button>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    <div style={{ borderTop: '1px solid #ddd', paddingTop: '10px' }}>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '5px' }}>ERASERS</span>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            <BlockEraser />\n                            <ObjectEraser />\n                            <SecretEraser />\n                        </div>\n                    </div>\n                </div>\n            </DraggableWindow>\n\n            {/* Window 3: Blocks/Liquids/Entities */}\n            <DraggableWindow\n                title=\"Blocks / Liquids / Entities\"\n                defaultPosition={positions[2]}\n                defaultWidth={300}\n                isOpenDefault={false}\n                onHeightChange={(h) => setHeights(prev => {\n                    const newHeights = [...prev];\n                    newHeights[2] = h;\n                    return newHeights;\n                })}\n            >\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '5px' }}>\n                    <PaletteSection title=\"Blocks (Background)\" isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {blocks.map(b => renderPaletteItem(b, 'blue', 'tile'))}\n                        </div>\n                    </PaletteSection>\n\n                    <PaletteSection title=\"Liquids (Blocks)\" isOpenDefault={true}>\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {liquids.map(li => renderPaletteItem(li, 'blue', 'tile'))}\n                        </div>\n                    </PaletteSection>\n\n                    <PaletteSection title=\"Entities (Objects)\">\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {entities.map(e => renderPaletteItem(e, 'red', 'object'))}\n                        </div>\n                    </PaletteSection>\n\n                    <PaletteSection title=\"Items (Objects)\">\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {items.map(i => renderPaletteItem(i, 'green', 'object'))}\n                        </div>\n                    </PaletteSection>\n\n                    <PaletteSection title=\"interactables (Objects)\">\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {interactables.map(i => renderPaletteItem(i, 'purple', 'object'))}\n                        </div>\n                    </PaletteSection>\n\n                    <PaletteSection title=\"Hazards (Objects)\">\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {hazards.map(h => renderPaletteItem(h, 'orange', 'object'))}\n                        </div>\n                    </PaletteSection>\n\n                    <PaletteSection title=\"Secrets\">\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>\n                            {secrets && secrets.map(s => renderPaletteItem(s, 'purple', 'secret'))}\n                        </div>\n                    </PaletteSection>\n                </div>\n            </DraggableWindow>\n\n            {/* Window 4: Background & Music */}\n            <DraggableWindow\n                title=\"Background & Music\"\n                defaultPosition={positions[3]}\n                defaultWidth={300}\n                isOpenDefault={false}\n                onHeightChange={(h) => setHeights(prev => {\n                    const newHeights = [...prev];\n                    newHeights[3] = h;\n                    return newHeights;\n                })}\n            >\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                    <div>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>Background Image</span>\n                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '6px' }}>\n                            <div onClick={() => setSelectedBackgroundImage(null)}\n                                style={{\n                                    border: selectedBackgroundImage ? '1px solid #ccc' : '2px solid #4CAF50',\n                                    borderRadius: '4px', padding: '2px', cursor: 'pointer', background: '#fff'\n                                }}\n                                title=\"Solid Color\">\n                                <div style={{ width: '100%', height: '48px', background: selectedBackgroundColor, display: 'block', borderRadius: '2px' }} />\n                                <div style={{ fontSize: '10px', textAlign: 'center', paddingTop: '2px' }}>Solid Color</div>\n                            </div>\n                            {backgroundOptions.map((bg) => (\n                                <div key={bg.name} onClick={() => setSelectedBackgroundImage(bg.metaPath)}\n                                    style={{\n                                        border: selectedBackgroundImage === bg.metaPath ? '2px solid #4CAF50' : '1px solid #ccc',\n                                        borderRadius: '4px', padding: '2px', cursor: 'pointer', background: '#fff'\n                                    }}\n                                    title={bg.name}>\n                                    <img src={bg.src} alt={bg.name} style={{ width: '100%', height: '48px', objectFit: 'cover', display: 'block' }} />\n                                    <div style={{ fontSize: '10px', textAlign: 'center', paddingTop: '2px' }}>{bg.name}</div>\n                                </div>\n                            ))}\n                        </div>\n                        <div style={{ marginTop: '8px', display: 'flex', alignItems: 'center', gap: '8px' }}>\n                            <label style={{ fontSize: '12px' }}>Parallax: </label>\n                            <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={backgroundParallaxFactor}\n                                onChange={(e) => setBackgroundParallaxFactor(parseFloat(e.target.value))} />\n                            <span style={{ fontSize: '12px' }}>{backgroundParallaxFactor.toFixed(2)}</span>\n                        </div>\n                        <div style={{ marginTop: '8px', display: 'flex', alignItems: 'center', gap: '8px' }}>\n                            <label style={{ fontSize: '12px' }}>Background Color:</label>\n                            <input type=\"color\" value={selectedBackgroundColor}\n                                onChange={(e) => setSelectedBackgroundColor(e.target.value)} />\n                        </div>\n                    </div>\n\n                    <div style={{ borderTop: '1px solid #ddd', paddingTop: '10px' }}>\n                        <span style={{ fontSize: '12px', fontWeight: 'bold', display: 'block', marginBottom: '8px' }}>Background Music</span>\n                        <select\n                            value={selectedBackgroundMusic || ''}\n                            onChange={(e) => setSelectedBackgroundMusic(e.target.value || null)}\n                            style={{ width: '100%', padding: '6px', fontSize: '12px', marginBottom: '8px' }}>\n                            <option value=\"\"> None </option>\n                            {musicOptions.map(m => (\n                                <option key={m.name} value={m.metaPath}>{m.name}</option>\n                            ))}\n                        </select>\n                        <BackgroundMusicPlayer metaPath={selectedBackgroundMusic} enabled={true} volume={0.4} />\n                        <div style={{ fontSize: '11px', color: '#555', marginTop: '5px' }}>\n                            Selected: {selectedBackgroundMusic ? selectedBackgroundMusic.split('/').pop() : 'None'}\n                        </div>\n                    </div>\n                </div>\n            </DraggableWindow>\n\n            {/* Window 5: Statistics */}\n            <DraggableWindow\n                title=\"Statistics\"\n                defaultPosition={positions[4]}\n                defaultWidth={300}\n                isOpenDefault={false}\n                onHeightChange={(h) => setHeights(prev => {\n                    const newHeights = [...prev];\n                    newHeights[4] = h;\n                    return newHeights;\n                })}\n            >\n                <div style={{ fontSize: '11px' }}>\n                    <div style={{ marginBottom: '4px' }}>Size: <strong>{totalTiles}</strong> tiles</div>\n                    <div style={{ marginBottom: '4px', color: 'blue' }}> Filled Blocks: <strong>{filledBlocks}</strong></div>\n                    <div style={{ marginBottom: '4px', color: '#666' }}> Empty Blocks: <strong>{emptyBlocks}</strong></div>\n                    <div style={{ marginBottom: '4px', color: 'red' }}> Objects Count: <strong>{objectsCount}</strong></div>\n                </div>\n            </DraggableWindow>\n\n            {/* Window 6: Minimap - Right side */}\n            <DraggableWindow\n                title=\"Minimap\"\n                defaultPosition={{ x: window.innerWidth - 320, y: 60 }}\n                defaultWidth={300}\n                isOpenDefault={false}\n            >\n                <Minimap\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    tileMapData={tileMapData}\n                    objectMapData={objectMapData}\n                    registryItems={registryItems}\n                />\n            </DraggableWindow>\n\n            {/* Window 7: Map Resizer - Right side, only when open */}\n            {isResizeWindowOpen && (\n                <DraggableWindow\n                    title=\"Resize Map\"\n                    defaultPosition={{ x: window.innerWidth - 320, y: 280 }}\n                    defaultWidth={300}\n                    isOpenDefault={true}\n                >\n                    <MapResizer\n                        mapWidth={mapWidth}\n                        mapHeight={mapHeight}\n                        onResize={onMapResize}\n                    />\n                </DraggableWindow>\n            )}\n        </>\n    );\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport { getRegistry } from '../../../engine/registry';\nimport { TILE_SIZE } from '../../../constants/gameConstants';\nimport { saveMap, loadMap, clearMap, resizeMapData } from './mapOperations';\nimport { getFloodFillIndices, floodFill, paintTile } from './paintingTools';\nimport { loadBackgroundOptions, loadMusicOptions } from './assetLoaders';\nimport { Viewport } from './Viewport';\nimport { NewMapModal } from './NewMapModal';\nimport { ToolbarWindows } from './ToolbarWindows';\n\nexport const Editor = () => {\n    // Editor state: map dimensions, tile/object data, selected tile, tools\n    const [mapWidth, setMapWidth] = useState(20);\n    const [mapHeight, setMapHeight] = useState(15);\n    const [tileMapData, setTileMapData] = useState([]);\n    const [objectMapData, setObjectMapData] = useState([]);\n    const [secretMapData, setSecretMapData] = useState([]);\n    const [selectedTile, setSelectedTile] = useState(null);\n    const [showGrid, setShowGrid] = useState(true);\n\n    const [isDragging, setIsDragging] = useState(false);\n    const [brushSize, setBrushSize] = useState(1);\n    const [activeTool, setActiveTool] = useState('brush');\n\n    const [selection, setSelection] = useState(null);\n    const [hoverIndex, setHoverIndex] = useState(null);\n    const [activeLayer, setActiveLayer] = useState('tile');\n    const [dragStart, setDragStart] = useState(null);\n    const [bucketPreviewIndices, setBucketPreviewIndices] = useState(new Set());\n    const [selectionMode, setSelectionMode] = useState('cut'); // 'cut' or 'copy'\n    const [isMovingSelection, setIsMovingSelection] = useState(false);\n    const [previewPosition, setPreviewPosition] = useState(null);\n    const [originalMapData, setOriginalMapData] = useState(null);\n    const bucketTimerRef = useRef(null);\n    const stateRef = useRef({ mapWidth, mapHeight, tileMapData, objectMapData, secretMapData });\n\n    // Map metadata\n    const [mapName, setMapName] = useState(\"New Map\");\n    const [creatorName, setCreatorName] = useState(\"Anonymous\");\n    const [createdAt, setCreatedAt] = useState(null);\n    const [isNewMapModalOpen, setIsNewMapModalOpen] = useState(false);\n    const [tempMapName, setTempMapName] = useState(\"\");\n    const [tempCreatorName, setTempCreatorName] = useState(\"\");\n\n    useEffect(() => {\n        stateRef.current = { mapWidth, mapHeight, tileMapData, objectMapData, secretMapData };\n    }, [mapWidth, mapHeight, tileMapData, objectMapData, secretMapData]);\n\n    useEffect(() => {\n        const size = 15 * 20;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }, []);\n\n    // Keyboard handler for Enter (commit) and Escape (cancel)\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if (selection) {\n                if (e.key === 'Enter') {\n                    e.preventDefault();\n                    commitSelection();\n                } else if (e.key === 'Escape') {\n                    e.preventDefault();\n                    cancelSelection();\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection, previewPosition, originalMapData, selectionMode]);\n\n    const registryItems = getRegistry() || [];\n    const blocks = registryItems.filter(item => item.name && item.name.startsWith('block.') && !(item.flags && item.flags.liquid));\n    const liquids = registryItems.filter(item => item.flags && item.flags.liquid);\n    const entities = registryItems.filter(item => {\n        if (!item.name || !item.name.startsWith('entities.')) return false;\n        if (item.isHiddenInEditor) return false;\n        return !item.type || item.type === 'default';\n    });\n    const items = registryItems.filter(item => item.name && item.name.startsWith('item.'));\n    const interactables = registryItems.filter(item => item.name && item.name.startsWith('interactable.'));\n    const hazards = registryItems.filter(item => item.type === 'hazard');\n    const secrets = registryItems.filter(item => item.type === 'secret');\n\n    const backgroundOptions = loadBackgroundOptions();\n    const musicOptions = loadMusicOptions();\n\n    const [selectedBackgroundImage, setSelectedBackgroundImage] = useState(backgroundOptions[0]?.metaPath || null);\n    const [backgroundParallaxFactor, setBackgroundParallaxFactor] = useState(0.3);\n    const [selectedBackgroundColor, setSelectedBackgroundColor] = useState('#87CEEB');\n    const [selectedBackgroundMusic, setSelectedBackgroundMusic] = useState(null);\n\n    const selectedBgOption = backgroundOptions.find((bg) => bg.metaPath === selectedBackgroundImage) || backgroundOptions[0];\n    const selectedBackgroundUrl = selectedBgOption && selectedBackgroundImage ? selectedBgOption.src : null;\n\n    const openNewMapModal = () => {\n        setTempMapName(\"New Map\");\n        setTempCreatorName(creatorName);\n        setIsNewMapModalOpen(true);\n    };\n\n    const confirmNewMap = () => {\n        if (window.confirm(\"Are you sure you want to create a new map? Unsaved changes will be lost.\")) {\n            const size = 20 * 15;\n            setMapWidth(20);\n            setMapHeight(15);\n            setTileMapData(Array(size).fill(null));\n            setObjectMapData(Array(size).fill(null));\n            setSecretMapData(Array(size).fill(null));\n\n            setMapName(tempMapName || \"New Map\");\n            setCreatorName(tempCreatorName || \"Anonymous\");\n            setCreatedAt(null);\n            setSelectedBackgroundImage(backgroundOptions[0]?.metaPath || null);\n            setBackgroundParallaxFactor(0.3);\n            setSelectedBackgroundColor('#87CEEB');\n            setSelectedBackgroundMusic(null);\n\n            setIsNewMapModalOpen(false);\n        }\n    };\n\n    const getCurrentData = () => {\n        if (activeLayer === 'tile') return tileMapData;\n        if (activeLayer === 'object') return objectMapData;\n        if (activeLayer === 'secret') return secretMapData;\n        return tileMapData;\n    };\n    const setCurrentData = (newData) => {\n        if (activeLayer === 'tile') setTileMapData(newData);\n        else if (activeLayer === 'object') setObjectMapData(newData);\n        else if (activeLayer === 'secret') setSecretMapData(newData);\n    };\n\n    const handleGridMouseDown = (index, e) => {\n        e.preventDefault();\n\n        // Check if clicking on existing selection to move it\n        if (selection && previewPosition) {\n            const x = index % mapWidth;\n            const y = Math.floor(index / mapWidth);\n\n            // Check if click is inside selection\n            if (x >= previewPosition.x && x < previewPosition.x + selection.w &&\n                y >= previewPosition.y && y < previewPosition.y + selection.h) {\n                setIsMovingSelection(true);\n                setIsDragging(true);\n                return;\n            }\n        }\n\n        if (activeTool === 'brush') {\n            setIsDragging(true);\n            paintTile(index, selectedTile, brushSize, mapWidth, mapHeight, getCurrentData, setCurrentData);\n        }\n        else if (activeTool === 'bucket') {\n            const targetId = selectedTile ? selectedTile.id : null;\n            floodFill(index, targetId, getCurrentData, setCurrentData, mapWidth, mapHeight);\n            setBucketPreviewIndices(new Set());\n        } else if (activeTool === 'move') {\n            const x = index % mapWidth;\n            const y = Math.floor(index / mapWidth);\n            setDragStart({ x, y });\n            setSelection(null);\n            setPreviewPosition(null);\n            setOriginalMapData(null);\n            setIsDragging(true);\n        }\n    };\n\n    const handleGridMouseEnter = (index) => {\n        setHoverIndex(index);\n\n        // If moving selection, update preview position\n        if (isMovingSelection && isDragging && previewPosition) {\n            const x = index % mapWidth;\n            const y = Math.floor(index / mapWidth);\n            setPreviewPosition({ x, y });\n            return;\n        }\n\n        if (bucketTimerRef.current) {\n            clearTimeout(bucketTimerRef.current);\n            bucketTimerRef.current = null;\n        }\n        setBucketPreviewIndices(new Set());\n        if (activeTool === 'brush' && isDragging) {\n            paintTile(index, selectedTile, brushSize, mapWidth, mapHeight, getCurrentData, setCurrentData);\n        }\n        else if (activeTool === 'bucket' && !isDragging) {\n            bucketTimerRef.current = setTimeout(() => {\n                const currentData = getCurrentData();\n                const indices = getFloodFillIndices(index, currentData, mapWidth, mapHeight);\n                setBucketPreviewIndices(new Set(indices));\n            }, 600);\n        }\n    };\n\n    const handleGridMouseLeave = () => {\n        setHoverIndex(null);\n        if (bucketTimerRef.current) clearTimeout(bucketTimerRef.current);\n        setBucketPreviewIndices(new Set());\n    };\n\n    const handleGridMouseUp = (index) => {\n        if (isMovingSelection) {\n            // Just stop moving, don't commit yet (wait for Enter)\n            setIsMovingSelection(false);\n            return;\n        }\n\n        setIsDragging(false);\n        if (activeTool === 'move' && dragStart) {\n            const endX = index % mapWidth;\n            const endY = Math.floor(index / mapWidth);\n            const x1 = Math.min(dragStart.x, endX);\n            const y1 = Math.min(dragStart.y, endY);\n            const x2 = Math.max(dragStart.x, endX);\n            const y2 = Math.max(dragStart.y, endY);\n            const w = x2 - x1 + 1;\n            const h = y2 - y1 + 1;\n\n            const selTileData = [];\n            const selObjectData = [];\n            const selSecretData = [];\n\n            for (let py = 0; py < h; py++) {\n                for (let px = 0; px < w; px++) {\n                    const idx = (y1 + py) * mapWidth + (x1 + px);\n                    selTileData.push(tileMapData[idx]);\n                    selObjectData.push(objectMapData[idx]);\n                    selSecretData.push(secretMapData[idx]);\n                }\n            }\n\n            // Save original map state\n            setOriginalMapData({\n                tileMap: [...tileMapData],\n                objectMap: [...objectMapData],\n                secretMap: [...secretMapData]\n            });\n\n            setSelection({ x: x1, y: y1, w, h, tileData: selTileData, objectData: selObjectData, secretData: selSecretData, originalX: x1, originalY: y1 });\n            setPreviewPosition({ x: x1, y: y1 });\n            setDragStart(null);\n        }\n    };\n\n    const moveSelection = (dx, dy) => {\n        if (!selection || !previewPosition) return;\n\n        const newX = previewPosition.x + dx;\n        const newY = previewPosition.y + dy;\n\n        // Just update preview position\n        setPreviewPosition({ x: newX, y: newY });\n    };\n\n    const commitSelection = () => {\n        if (!selection || !previewPosition || !originalMapData) return;\n\n        const newTileMap = [...originalMapData.tileMap];\n        const newObjectMap = [...originalMapData.objectMap];\n        const newSecretMap = [...originalMapData.secretMap];\n\n        // If cut mode, clear original position\n        if (selectionMode === 'cut') {\n            for (let py = 0; py < selection.h; py++) {\n                for (let px = 0; px < selection.w; px++) {\n                    const idx = (selection.originalY + py) * mapWidth + (selection.originalX + px);\n                    if (idx >= 0 && idx < newTileMap.length) {\n                        newTileMap[idx] = null;\n                        newObjectMap[idx] = null;\n                        newSecretMap[idx] = null;\n                    }\n                }\n            }\n        }\n\n        // Place selection at new position\n        for (let py = 0; py < selection.h; py++) {\n            for (let px = 0; px < selection.w; px++) {\n                const destX = previewPosition.x + px;\n                const destY = previewPosition.y + py;\n                if (destX >= 0 && destX < mapWidth && destY >= 0 && destY < mapHeight) {\n                    const destIdx = destY * mapWidth + destX;\n                    const srcDataIdx = py * selection.w + px;\n\n                    newTileMap[destIdx] = selection.tileData[srcDataIdx];\n                    newObjectMap[destIdx] = selection.objectData[srcDataIdx];\n                    newSecretMap[destIdx] = selection.secretData?.[srcDataIdx] || null;\n                }\n            }\n        }\n\n        setTileMapData(newTileMap);\n        setObjectMapData(newObjectMap);\n        setSecretMapData(newSecretMap);\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n    };\n\n    const cancelSelection = () => {\n        setSelection(null);\n        setPreviewPosition(null);\n        setOriginalMapData(null);\n        setIsMovingSelection(false);\n    };\n\n    const handleMapResize = (newWidth, newHeight) => {\n        if (newWidth === mapWidth && newHeight === mapHeight) return;\n\n        resizeMapData({\n            newWidth,\n            newHeight,\n            stateRef,\n            setMapWidth,\n            setMapHeight,\n            setTileMapData,\n            setObjectMapData,\n            setSecretMapData\n        });\n    };\n\n    const handlePaletteSelect = (item, layer) => {\n        setSelectedTile(item);\n        setActiveLayer(layer);\n        setActiveTool('brush');\n        setSelection(null);\n    };\n\n    const totalTiles = mapWidth * mapHeight;\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const emptyBlocks = totalTiles - filledBlocks;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n\n    return (\n        <div className=\"editor-wrapper\" style={{ position: 'relative', height: '100%', overflow: 'hidden' }}>\n            <NewMapModal\n                isOpen={isNewMapModalOpen}\n                tempMapName={tempMapName}\n                setTempMapName={setTempMapName}\n                tempCreatorName={tempCreatorName}\n                setTempCreatorName={setTempCreatorName}\n                confirmNewMap={confirmNewMap}\n                onClose={() => setIsNewMapModalOpen(false)}\n            />\n\n            <div className=\"editor-container\" style={{\n                display: 'flex', height: '100%', flexDirection: 'row',\n                filter: isNewMapModalOpen ? 'blur(4px) brightness(0.7)' : 'none',\n                transition: 'filter 0.2s ease',\n                pointerEvents: isNewMapModalOpen ? 'none' : 'auto'\n            }}>\n                <ToolbarWindows\n                    mapName={mapName}\n                    creatorName={creatorName}\n                    openNewMapModal={openNewMapModal}\n                    saveMap={() => saveMap({\n                        mapWidth, mapHeight, tileMapData, objectMapData, secretMapData,\n                        mapName, creatorName, createdAt,\n                        selectedBackgroundImage, selectedBackgroundColor,\n                        backgroundParallaxFactor, selectedBackgroundMusic,\n                        registryItems, setCreatedAt\n                    })}\n                    loadMap={(event) => loadMap({\n                        event, setMapWidth, setMapHeight, setMapName, setCreatorName,\n                        setCreatedAt, setSelectedBackgroundImage, setSelectedBackgroundColor,\n                        setBackgroundParallaxFactor, setSelectedBackgroundMusic,\n                        setTileMapData, setObjectMapData, setSecretMapData\n                    })}\n                    showGrid={showGrid}\n                    setShowGrid={setShowGrid}\n                    clearMap={() => clearMap({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData })}\n                    activeTool={activeTool}\n                    setActiveTool={setActiveTool}\n                    brushSize={brushSize}\n                    setBrushSize={setBrushSize}\n                    activeLayer={activeLayer}\n                    selection={selection}\n                    moveSelection={moveSelection}\n                    setSelection={setSelection}\n                    selectionMode={selectionMode}\n                    setSelectionMode={setSelectionMode}\n                    commitSelection={commitSelection}\n                    cancelSelection={cancelSelection}\n                    selectedTile={selectedTile}\n                    handlePaletteSelect={handlePaletteSelect}\n                    blocks={blocks}\n                    liquids={liquids}\n                    entities={entities}\n                    items={items}\n                    interactables={interactables}\n                    hazards={hazards}\n                    secrets={secrets}\n                    backgroundOptions={backgroundOptions}\n                    selectedBackgroundImage={selectedBackgroundImage}\n                    setSelectedBackgroundImage={setSelectedBackgroundImage}\n                    selectedBackgroundColor={selectedBackgroundColor}\n                    setSelectedBackgroundColor={setSelectedBackgroundColor}\n                    backgroundParallaxFactor={backgroundParallaxFactor}\n                    setBackgroundParallaxFactor={setBackgroundParallaxFactor}\n                    musicOptions={musicOptions}\n                    selectedBackgroundMusic={selectedBackgroundMusic}\n                    setSelectedBackgroundMusic={setSelectedBackgroundMusic}\n                    totalTiles={totalTiles}\n                    filledBlocks={filledBlocks}\n                    emptyBlocks={emptyBlocks}\n                    objectsCount={objectsCount}\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    tileMapData={tileMapData}\n                    objectMapData={objectMapData}\n                    registryItems={registryItems}\n                    onMapResize={handleMapResize}\n                />\n\n                <Viewport\n                    mapWidth={mapWidth}\n                    mapHeight={mapHeight}\n                    selectedBackgroundUrl={selectedBackgroundUrl}\n                    selectedBackgroundColor={selectedBackgroundColor}\n                    selectedBackgroundImage={selectedBackgroundImage}\n                    showGrid={showGrid}\n                    activeLayer={activeLayer}\n                    activeTool={activeTool}\n                    tileMapData={tileMapData}\n                    objectMapData={objectMapData}\n                    secretMapData={secretMapData}\n                    registryItems={registryItems}\n                    hoverIndex={hoverIndex}\n                    brushSize={brushSize}\n                    bucketPreviewIndices={bucketPreviewIndices}\n                    selection={selection}\n                    previewPosition={previewPosition}\n                    dragStart={dragStart}\n                    isDragging={isDragging}\n                    handleGridMouseDown={handleGridMouseDown}\n                    handleGridMouseEnter={handleGridMouseEnter}\n                    handleGridMouseUp={handleGridMouseUp}\n                    handleGridMouseLeave={handleGridMouseLeave}\n                    setIsDragging={setIsDragging}\n                />\n            </div>\n        </div>\n    );\n};\n","export const loadBackgroundOptions = () => {\n    const bgContext = require.context('../../../assets/background', false, /\\.(png|jpe?g|svg)$/);\n    return bgContext.keys().map((key) => {\n        const mod = bgContext(key);\n        const url = mod.default || mod;\n        const name = key.replace('./', '');\n        return { key, name, src: url, metaPath: `/assets/background/${name}` };\n    });\n};\n\nexport const loadMusicOptions = () => {\n    const musicContext = require.context('../../../assets/sound/background', false, /\\.ogg$/);\n    return musicContext.keys().map((key) => {\n        const mod = musicContext(key);\n        const name = key.replace('./', '');\n        return { key, name, src: (mod.default || mod), metaPath: `/assets/sound/background/${name}` };\n    });\n};\n","import saveFile from '../../../utilities/saveFile';\nimport errorHandler from '../../../services/errorHandler';\n\nexport const saveMap = async ({\n    mapWidth,\n    mapHeight,\n    tileMapData,\n    objectMapData,\n    secretMapData,\n    mapName,\n    creatorName,\n    createdAt,\n    selectedBackgroundImage,\n    selectedBackgroundColor,\n    backgroundParallaxFactor,\n    selectedBackgroundMusic,\n    registryItems,\n    setCreatedAt\n}) => {\n    const currentDate = new Date().toISOString();\n    const createdDate = createdAt || currentDate;\n\n    // Statistics calculation\n    const filledBlocks = tileMapData.filter(t => t !== null).length;\n    const objectsCount = objectMapData.filter(o => o !== null).length;\n    const itemsCount = objectMapData.filter(o => {\n        if (!o) return false;\n        const item = registryItems.find(r => r.id === o);\n        return item && item.name && item.name.startsWith('item.');\n    }).length;\n\n    const mapData = {\n        meta: {\n            width: mapWidth,\n            height: mapHeight,\n            tileSize: 32,\n            version: \"1.0\",\n            name: mapName,\n            author: creatorName,\n            date_map_created_at: createdDate,\n            date_map_last_updated: currentDate,\n            backgroundImage: selectedBackgroundImage || null,\n            backgroundColor: selectedBackgroundImage ? null : selectedBackgroundColor,\n            backgroundParallaxFactor: backgroundParallaxFactor,\n            backgroundMusic: selectedBackgroundMusic || null\n        },\n        statistics: {\n            total_tiles: mapWidth * mapHeight,\n            filled_tiles: filledBlocks,\n            total_objects: objectsCount,\n            total_items: itemsCount\n        },\n        layers: [\n            { type: \"tile\", name: \"background\", data: tileMapData },\n            { type: \"object\", name: \"entities\", data: objectMapData },\n            { type: \"secret\", name: \"secrets\", data: secretMapData || Array(mapWidth * mapHeight).fill(null) }\n        ]\n    };\n\n    const fileName = `${mapName.replace(/\\s+/g, '_')}.json`;\n    const json = JSON.stringify(mapData, null, 2);\n\n    try {\n        const saved = await saveFile(json, fileName, 'application/json');\n        if (saved) {\n            if (!createdAt) setCreatedAt(currentDate);\n            errorHandler.info('Map saved successfully', {\n                component: 'Editor',\n                mapName,\n                fileName,\n                dimensions: `${mapWidth}x${mapHeight}`\n            });\n        }\n    } catch (error) {\n        errorHandler.error(error, {\n            component: 'Editor',\n            function: 'saveMap',\n            mapName,\n            fileName\n        });\n        alert('Failed to save map. Check console for details.');\n    }\n};\n\nexport const loadMap = ({\n    event,\n    setMapWidth,\n    setMapHeight,\n    setMapName,\n    setCreatorName,\n    setCreatedAt,\n    setSelectedBackgroundImage,\n    setSelectedBackgroundColor,\n    setBackgroundParallaxFactor,\n    setSelectedBackgroundMusic,\n    setTileMapData,\n    setObjectMapData,\n    setSecretMapData\n}) => {\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    if (file) {\n        fileReader.readAsText(file, \"UTF-8\");\n        fileReader.onload = (e) => {\n            try {\n                const loaded = JSON.parse(e.target.result);\n                if (loaded.meta) {\n                    setMapWidth(loaded.meta.width);\n                    setMapHeight(loaded.meta.height);\n\n                    if (loaded.meta.name) setMapName(loaded.meta.name);\n                    if (loaded.meta.author) setCreatorName(loaded.meta.author);\n                    if (loaded.meta.date_map_created_at) setCreatedAt(loaded.meta.date_map_created_at);\n\n                    if (typeof loaded.meta.backgroundImage !== 'undefined' && loaded.meta.backgroundImage) {\n                        setSelectedBackgroundImage(loaded.meta.backgroundImage);\n                    } else {\n                        setSelectedBackgroundImage(null);\n                    }\n                    if (typeof loaded.meta.backgroundColor !== 'undefined' && loaded.meta.backgroundColor) {\n                        setSelectedBackgroundColor(loaded.meta.backgroundColor);\n                    }\n                    if (typeof loaded.meta.backgroundParallaxFactor !== 'undefined') {\n                        setBackgroundParallaxFactor(loaded.meta.backgroundParallaxFactor);\n                    } else {\n                        setBackgroundParallaxFactor(0.3);\n                    }\n                    if (typeof loaded.meta.backgroundMusic !== 'undefined' && loaded.meta.backgroundMusic) {\n                        const m = loaded.meta.backgroundMusic;\n                        const normalized = typeof m === 'string' ? m.replace('/sound/background/', '/assets/sound/background/') : m;\n                        setSelectedBackgroundMusic(normalized);\n                    } else {\n                        setSelectedBackgroundMusic(null);\n                    }\n\n                    const bgLayer = loaded.layers.find(l => l.name === 'background');\n                    const objLayer = loaded.layers.find(l => l.name === 'entities');\n                    const secretLayer = loaded.layers.find(l => l.name === 'secrets');\n                    if (bgLayer) setTileMapData(bgLayer.data);\n                    if (objLayer) setObjectMapData(objLayer.data);\n                    if (secretLayer) {\n                        setSecretMapData(secretLayer.data);\n                    } else {\n                        setSecretMapData(Array(loaded.meta.width * loaded.meta.height).fill(null));\n                    }\n\n                    errorHandler.info('Map loaded successfully', {\n                        component: 'Editor',\n                        mapName: loaded.meta.name,\n                        dimensions: `${loaded.meta.width}x${loaded.meta.height}`\n                    });\n                } else {\n                    // Old format\n                    if (loaded.width) setMapWidth(loaded.width);\n                    if (loaded.height) setMapHeight(loaded.height);\n                    if (loaded.tiles) setTileMapData(loaded.tiles);\n                    setObjectMapData(Array(loaded.width * loaded.height).fill(null));\n\n                    errorHandler.warn('Loaded map in legacy format', {\n                        component: 'Editor',\n                        fileName: file.name\n                    });\n                }\n            } catch (error) {\n                errorHandler.error(error, {\n                    component: 'Editor',\n                    function: 'loadMap',\n                    fileName: file.name\n                });\n                alert('Error loading map. Check console for details.');\n            }\n        };\n        fileReader.onerror = (error) => {\n            errorHandler.error(error, {\n                component: 'Editor',\n                function: 'loadMap',\n                fileName: file.name,\n                phase: 'fileReader'\n            });\n            alert('Error reading file!');\n        };\n    }\n};\n\nexport const clearMap = ({ mapWidth, mapHeight, setTileMapData, setObjectMapData, setSecretMapData }) => {\n    if (window.confirm(\"Are you sure you want to clear the map?\")) {\n        const size = mapWidth * mapHeight;\n        setTileMapData(Array(size).fill(null));\n        setObjectMapData(Array(size).fill(null));\n        setSecretMapData(Array(size).fill(null));\n    }\n};\n\nexport const resizeMapData = ({ newWidth, newHeight, stateRef, setMapWidth, setMapHeight, setTileMapData, setObjectMapData, setSecretMapData }) => {\n    const { mapWidth: oldW, mapHeight: oldH, tileMapData: oldTiles, objectMapData: oldObjs, secretMapData: oldSecrets } = stateRef.current;\n    if (newWidth < 1 || newHeight < 1) return;\n    if (newWidth === oldW && newHeight === oldH) return;\n\n    const resizeArray = (oldArr) => {\n        const newArr = Array(newWidth * newHeight).fill(null);\n        for (let y = 0; y < Math.min(oldH, newHeight); y++) {\n            for (let x = 0; x < Math.min(oldW, newWidth); x++) {\n                newArr[y * newWidth + x] = oldArr[y * oldW + x];\n            }\n        }\n        return newArr;\n    };\n\n    setMapWidth(newWidth);\n    setMapHeight(newHeight);\n    setTileMapData(resizeArray(oldTiles));\n    setObjectMapData(resizeArray(oldObjs));\n    setSecretMapData(resizeArray(oldSecrets || []));\n};\n","\n\nexport default function Crystals() {\n\n    return (\n        <>\n            <p>Crystals</p>\n        </>\n    )\n}","import React, { useState, useEffect } from 'react';\nimport { getRegistry } from '../../engine/registry';\nimport AnimatedItem from '../../utilities/AnimatedItem';\n\nexport default function Repository() {\n    const registryItems = getRegistry();\n\n    // Container style for grid layout\n    const containerStyle = {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px',\n        padding: '20px'\n    };\n\n    // Style for each card\n    const cardStyle = {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        padding: '10px',\n        width: '200px',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        backgroundColor: '#f9f9f9'\n    };\n\n    // Image style (64x64)\n    const imageStyle = {\n        width: '64px',\n        height: '64px',\n        objectFit: 'contain', // Prevent image stretching if proportions aren't perfect\n        imageRendering: 'pixelated', // Important for pixel graphics (2D games)\n        marginBottom: '10px',\n        border: '1px dashed #aaa'\n    };\n\n    const fieldsContainerStyle = {\n        width: '100%',\n        fontSize: '12px',\n        textAlign: 'left'\n    };\n\n    return (\n        <div style={containerStyle}>\n            {registryItems.map((item, index) => (\n                <div key={item.id || index} style={cardStyle}>\n                    \n                    {/* Choose: Animation or Static image */}\n                    {item.textures && item.textures.length > 0 ? (\n                        <AnimatedItem\n                            textures={item.textures}\n                            texture={item.texture}\n                            speed={item.animationSpeed}\n                            style={imageStyle}\n                            alt={item.name}\n                        />\n                    ) : (\n                        <img \n                            src={item.texture} \n                            alt={item.name} \n                            style={imageStyle}\n                            onError={(e) => { e.target.style.display = 'none'; }} \n                        />\n                    )}\n\n                    {/* Filter out 'texture', 'textures', and 'animationSpeed' from text list */}\n                    <div style={fieldsContainerStyle}>\n                        {Object.entries(item)\n                            .filter(([key]) => !['texture', 'textures', 'animationSpeed'].includes(key))\n                            .map(([key, value]) => (\n                                <div key={key} style={{ marginBottom: '4px', wordBreak: 'break-all' }}>\n                                    <strong>{key}:</strong> \n                                    <span style={{ marginLeft: '5px', color: '#555' }}>\n                                        {typeof value === 'object' ? JSON.stringify(value) : String(value)}\n                                    </span>\n                                </div>\n                        ))}\n                    </div>\n                </div>\n            ))}\n            \n            {registryItems.length === 0 && <p>No items found in registry.</p>}\n        </div>\n    );\n}","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\"\nimport { Provider } from 'react-redux'\nimport { ThemeProvider } from 'styled-components'\nimport store from './store'\nimport theme from './styles/theme'\nimport GlobalStyles from './styles/GlobalStyles'\nimport './i18n/i18n'\nimport './index.css'\nimport App from './App'\nimport Home from \"./sections/chapters/home\"\nimport Game from \"./sections/chapters/game\"\nimport {Editor} from \"./sections/chapters/editor/index\"\nimport Crystals from \"./sections/chapters/crystals\"\nimport Repository from \"./sections/chapters/repository\"\n\nconst root = ReactDOM.createRoot(document.getElementById('root'))\nroot.render(\n    <Provider store={store}>\n        <ThemeProvider theme={theme}>\n            <GlobalStyles />\n            <BrowserRouter basename={process.env.PUBLIC_URL}>\n                <Routes>\n\n                <Route path=\"/\" element={<App />}>\n                    <Route index element={<Home />} />\n                    <Route path=\"game\" element={<Game />} />\n                    <Route path=\"editor\" element={<Editor />} />\n                    <Route path=\"crystals\" element={<Crystals />} />\n                    <Route path=\"repository\" element={<Repository />} />\n                </Route>\n\n                </Routes>\n            </BrowserRouter>\n        </ThemeProvider>\n    </Provider>\n)\n","var map = {\n\t\"./seamless_01.jpg\": 2436,\n\t\"./seamless_02.jpg\": 2147,\n\t\"./seamless_03.jpg\": 2038,\n\t\"./seamless_04.jpg\": 8237,\n\t\"./seamless_05.jpg\": 3344,\n\t\"./seamless_06.jpg\": 719\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8870;"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","activeMapData","tileMapData","objectMapData","secretMapData","revealedSecrets","objectTextureIndices","mapWidth","mapHeight","isLoading","error","isPaused","isGameOver","gameSlice","createSlice","name","reducers","setActiveMap","state","action","mapData","payload","updateObjectMap","removeObjectAtIndex","index","undefined","updateObjectAtIndex","newId","setObjectTextureIndex","textureIndex","revealSecretZone","forEach","idx","includes","push","setLoading","setError","setPaused","setGameOver","resetGame","actions","TILE_SIZE","MAX_HEALTH","MAX_OXYGEN","MAX_LAVA_RESIST","x","y","width","height","vx","vy","isGrounded","direction","animation","health","maxHealth","ammo","oxygen","maxOxygen","lavaResist","maxLavaResist","projectiles","inWater","headUnderWater","atSurface","liquidType","hitTimerMs","playerSlice","updateState","setPosition","setVelocity","setHealth","Math","max","min","addHealth","takeDamage","setAmmo","addAmmo","setOxygen","setLavaResist","setProjectiles","addProjectile","removeProjectile","filter","p","setDirection","setAnimation","setGrounded","setInWater","setLiquidType","resetPlayer","sound","enabled","masterVolume","sfxVolume","musicVolume","graphics","backgroundParallaxFactor","weatherRain","weatherSnow","weatherClouds","weatherFog","weatherThunder","ui","healthBarEnabled","oxygenBarEnabled","lavaBarEnabled","waterSplashesEnabled","lavaEmbersEnabled","controls","keyUp","keyDown","keyLeft","keyRight","keyJump","keyShoot","settingsSlice","loadSettings","saved","localStorage","getItem","parsed","JSON","parse","console","updateSettings","newState","setItem","stringify","setSoundEnabled","setSoundVolume","type","volume","setGraphicsSetting","key","value","setUISetting","setControlBinding","resetSettings","removeItem","isMapModalOpen","isSettingsOpen","isTerminalOpen","isPauseMenuOpen","notifications","cameraScrollX","shouldCenterMap","uiSlice","setMapModalOpen","setSettingsOpen","setTerminalOpen","window","__GAME_TERMINAL_OPEN__","setPauseMenuOpen","addNotification","Date","now","timestamp","toISOString","removeNotification","n","clearNotifications","setCameraScrollX","setShouldCenterMap","resetUI","configureStore","reducer","game","gameReducer","player","playerReducer","settings","settingsReducer","uiReducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredActionPaths","ignoredPaths","devTools","process","colors","primary","secondary","danger","warning","success","info","dark","darkGray","mediumGray","lightGray","background","surface","overlay","text","textLight","textDark","border","borderLight","spacing","xs","sm","md","lg","xl","xxl","borderRadius","round","shadows","fontSize","base","fontWeight","light","normal","medium","semibold","bold","transitions","fast","slow","zIndex","dropdown","modal","tooltip","notification","breakpoints","mobile","tablet","desktop","wide","createGlobalStyle","lv_navigation","no_navigation","en_navigation","ru_navigation","ja_navigation","i18n","initReactI18next","init","lng","fallbackLng","supportedLngs","ns","defaultNS","interpolation","escapeValue","resources","lv","navigation","no","en","ru","ja","NavLinkButton","styled","NavLink","withConfig","componentId","SectionHeaderNavigationChapters","t","useTranslation","chapter_home","chapter_game","chapter_editor","chapter_crystals","chapter_repository","_jsxs","style","display","gap","children","_jsx","to","className","isActive","onClick","handleNewGameClick","dispatchEvent","Event","NavButton","button","SectionHeaderNavigationLanguages","currentLang","language","handleLanguageChange","newLang","changeLanguage","StyledLogo","SectionHeaderNavigationLogo","StyledSectionHeaderNavigation","div","StyledSectionHeaderFooter","StyledSectionContent","_registry","initRegistry","time","jsonContext","require","imageContext","soundContext","warn","resolvePath","rawPath","cleanPath","replace","relativePath","startsWith","imageModule","default","_warnedUnresolvedSound","resolveSound","rel","out","normalize","mod","data","item","resolvedTexture","texture","resolvedTextures","textures","Array","isArray","path","sfx","sfxResolved","defaultAnimation","animItem","find","r","length","animationSpeed","isHiddenInEditor","deadAnimation","deadItem","targetAnimation","targetItem","log","timeEnd","getRegistry","findItemById","useEffect","items","flexDirection","justifyContent","alignItems","overflow","flexShrink","SectionHeader","SectionContent","flexGrow","Outlet","SectionFooter","Home","_Fragment","TextureCache","constructor","this","_map","Map","get","url","m","has","tex","Texture","from","set","dispose","delete","clear","WeatherRain","container","api","getIntensity","tileSize","particles","intensity","area","maxParticles","floor","setIntensity","v","Number","spawnOne","g","Graphics","lineStyle","beginFill","drawRect","endFill","random","speed","rotation","addChild","bounces","alive","update","dtMs","norm","scaled","pow","target","deficit","maxPerFrame","smooth","ceil","toSpawn","i","surplus","toCull","pop","parent","removeChild","destroy","dt","toRemove","nx","ny","getLiquidSurfaceY","syWater","isFinite","strength","onWaterImpact","syLava","onLavaImpact","isSolidAt","guard","abs","j","splice","WeatherSnow","flakes","maxFlakes","drawCircle","drift","settled","life","phase","restMs","f","sin","sYwater","sYlava","gAcc","alpha","WeatherClouds","bandHeight","patches","filters","BlurFilter","quality","rebuild","nv","count","w","h","rx","ry","circles","baseR","k","PI","dist","cx","cos","cy","cur","W","bandBottom","osc","WeatherFog","noiseTex","_createNoiseTexture","layer1","TilingSprite","layer2","tileScale","_recalcParams","_draw","_alphaFromIntensity","_applyAlphas","resize","baseAlpha","pulse","tilePosition","speed1","speed2","pulseFactor","noiseAlpha","lerp","a","b","u","canvas","document","createElement","ctx","getContext","img","createImageData","putImageData","WeatherThunder","nextStrikeMs","Infinity","flashAlpha","flashDecay","boltAlive","boltTime","boltDuration","flashG","boltG","_scheduleNextStrike","_redrawFlash","_clearBolt","H","curInt","_triggerFlash","_createBolt","decayPerMs","remain","initial","minDelay","_lerp","maxDelay","delay","_rand","topY","targetY","_findGroundY","endY","segments","jitterX","points","thickness","color","alignment","cap","join","moveTo","lineTo","branchCount","len","ang","bx","by","worldX","maxH","isSolid","WaterSplashFX","node","Container","droplets","rings","maxDroplets","maxRings","trigger","upward","s","vr","spd","d","size","LavaEmbers","spawnAcc","embers","maxEmbers","surfaces","rebuildSurfaces","registryItems","getDef","isLava","def","flags","lava","TS","spans","gy","runStart","gx","aboveLava","_spawnOne","trail","baseRate","mult","shift","emberAlpha","emberSize","p0","p1","LavaSteamFX","puffs","maxPuffs","radius","LiquidRegionSystem","opts","_regions","_waterTex","_lavaTex","_time","_noiseTex","_playerState","setPlayerState","playerState","_checkPlayerInRegion","region","px","py","pw","ph","getBounds","getSurfaceY","X","topEdges","mw","mh","ts","changed","waterDrift","lavaDrift","sprite","playerInRegion","noise1","noise2","waves","lifeMsWater","lifeMsLava","startRadius","decay","exp","ampNow","amp","capG","dy","centerX","dx","sigma","gauss","maxDisp","build","typeAt","liquid","water","visited","Uint8Array","dirs","regionTiles","queue","_addRegion","tileIndices","mask","worldW","worldH","bleed","_createLavaTexture","_createWaterTexture","tiling","_computeTopEdgeSpans","createLinearGradient","addColorStop","fillStyle","fillRect","noise","scale","imageData","getImageData","brightness","globalAlpha","shimmer","n1","n2","glow","surfaceGlow","Set","tilesByRow","above","rowList","cols","entries","sort","start","prev","addWave","HealthBar","options","super","offsetX","offsetY","thresholds","ok","trackColor","borderColor","borderAlpha","_w","_h","_pct","_color","_thresholds","_colors","_trackColor","_borderColor","_borderAlpha","_track","_fill","_redrawAll","current","visible","c","pct","_redrawFill","drawRoundedRect","innerW","freeze","parallax","objBehind","secretsBelow","objFront","secretsAbove","weather","fog","liquids","liquidFx","tiles","tilesAnim","textureCacheMap","getTexture","msToSpeed","ms","getRegItem","isWaterDef","isLavaDef","ParallaxBackground","textureCache","cache","bgSprite","imgSprite","_worldW","_worldH","_lastCameraX","_currentUrl","worldWidth","worldHeight","factor","hex","parseInt","slice","solid","Sprite","WHITE","tint","setupImage","baseTexture","wrapMode","WRAP_MODES","REPEAT","source","addressMode","texH","scaleY","setScroll","Assets","valid","load","then","loadedTex","catch","err","cameraX","buildSpriteFromDef","spr","frames","Boolean","AnimatedSprite","play","anchor","rebuildLayers","refs","bgRef","objBehindRef","objFrontRef","secretLayerRef","removeChildren","below","secretLayerCount","normalLayerCount","secretId","secretDef","secretSubtype","subtype","isInOpenArea","isInSecretArea","isSecretRevealed","renderOnSecretLayer","secretLayerTiles","normalLayerTiles","revealedSecretsCount","renderAbovePlayer","setPreferences","skipCacheIdWarning","PixiStage","playerVisuals","backgroundImage","backgroundColor","mountRef","useRef","appRef","parallaxRef","parallaxManagerRef","cameraScrollRef","parallaxFactorRef","bgAnimRef","bgImageRef","bgColorRef","playerRef","playerSpriteRefs","hit","playerHealthBarRef","playerStateRef","weatherLayerRef","liquidLayerRef","liquidSystemRef","fogLayerRef","weatherSystemsRef","rain","snow","clouds","thunder","projectilesLayerRef","projectileSpritesRef","projectilesPropRef","pixiTextureCacheRef","hbEnabledRef","oxyEnabledRef","lavaEnabledRef","overlayLayerRef","underwaterRef","overlayHBRef","oxygenBarRef","lavaBarRef","waterFxRef","lavaEmbersRef","lavaSteamRef","splashesEnabledRef","embersEnabledRef","waterStateRef","headUnder","resolveBackgroundUrl","useMemo","createBackgroundResolver","bgContext","metaPath","split","createSolidChecker","wx","wy","collision","top","bottom","left","right","rebuildParallax","useCallback","layer","createParallaxManager","parallaxLayer","textureCacheRef","parallaxHelper","parallaxSprite","resolvedUrl","helper","bgUrl","bgColor","destroyed","async","app","Application","backgroundAlpha","antialias","autoDensity","stage","sortableChildren","bg","bgAnim","secretBelowLayer","secretAboveLayer","playerLayer","weatherLayer","liquidLayer","liquidFxLayer","fogLayer","projLayer","overlayLayer","LAYERS","urlSet","addUrl","add","urls","playerComponents","createPlayerContainer","playerContainer","defaultDef","targetDef","defSprite","hitSprite","healthBar","sprites","innerHTML","appendChild","hbOverlay","oxyBar","lvBar","addEventListener","preventDefault","ticker","updatePlayerSprite","inLava","effectiveWidth","isHit","dir","mag","camX","deltaMS","systems","sNow","nowInWater","nowLiquid","sy","s2","effW","effH","baseYOffset","baseX","baseY","hbO","show","nextBarY","maxOxy","curOxy","maxLv","curLv","syncProjectiles","projectilesLayer","projectileSpritesMap","projectilesList","list","seen","defId","values","cleanupProjectiles","yy","getRainIntensity","getSnowIntensity","getCloudsIntensity","getThunderIntensity","ref","propTypes","PropTypes","isRequired","floodFillSecretZone","startIndex","startSecretId","startDef","result","checkSecretDetection","currentX","currentY","playerLeft","playerRight","playerTop","playerBottom","minGX","maxGX","minGY","maxGY","revealOnEnter","connectedIndices","newIndices","triggerIndex","triggerSecretId","triggerSubtype","totalConnected","newToReveal","firstFiveNew","connectedSecretIds","beepFallback","vol","AC","AudioContext","webkitAudioContext","audioCtxRef","audioCtx","resume","currentTime","createOscillator","gain","createGain","frequency","setValueAtTime","exponentialRampToValueAtTime","connect","destination","stop","getLiquidAtPixel","mapWidthTiles","mapHeightTiles","tileData","params","buoyancy","dragX","drag","dragY","swimmable","dps","damagePerSecond","drainPerSecond","regenPerSecond","damagePerSecondWhenDepleted","resistance","sampleLiquidForAABB","headY","chestY","feet","chest","head","candidate","inLiquid","tickLiquidDamage","env","deltaMs","accRef","gameState","HIT_FLASH_MS","updateFrame","objectData","input","constants","helpers","isInitialized","lastTimeRef","projectilesRef","shootCooldownRef","liquidDamageAccumulatorRef","oxygenDepleteAccRef","lavaDepleteAccRef","GRAVITY","TERMINAL_VELOCITY","MOVE_SPEED","JUMP_FORCE","checkCollision","isWaterAt","getLiquidSample","collectItem","checkInteractables","checkHazardDamage","checkSecrets","spawnProjectile","updateProjectiles","setPlayer","onGameOver","continue","meta","proposedX","moveHorizontal","vp","prevInWater","LIQ_TERMINAL","space","swimImpulse","applyVerticalPhysics","liquidParams","sample","maxLava","oxy","lavaRes","oxyParams","lavaParams","tickDepleteDps","dpsValue","currentAmmo","mouseLeft","maxX","isSolidAtPixel","secretData","tileId","tileDef","newX","newY","gridX","gridY","errorListeners","logLevel","setLogLevel","level","addListener","callback","removeListener","cb","notifyListeners","context","handle","errorObj","String","logData","message","stack","shouldLog","toUpperCase","sendToLoggingService","levels","debug","currentLevel","wrapAsync","fn","args","wrapSync","parseBool","trim","toLowerCase","useGameEngine","onStateUpdate","onRevealSecret","useInput","clearKeys","handleKeyDown","tag","tagName","typing","isContentEditable","repeat","CustomEvent","handleMouseDown","handleMouseUp","handleKeyUp","onToggleTerminal","passive","removeEventListener","useState","requestRef","hazardDamageAccumulatorRef","lastHazardIndexRef","triggeredHazardsRef","projectileIdRef","soundEnabledRef","audioCtxUnlockedRef","onToggle","detail","onUserGesture","playShotSfx","audio","Audio","pause","once","playSfx","checkHazardDamageWrapper","objectLayerData","candidates","pushCandidate","touch","damageDirections","objId","tileLeft","tileRight","tileTop","tileBottom","touchMargin","touchingTop","touchingBottom","touchingLeft","touchingRight","distTop","distBottom","distLeft","distRight","sideScore","chosen","objDef","prevIndex","damageOnce","baseDamage","damage","immediate","TICK_MS","errorHandler","component","function","playerPosition","damageType","localRevealedRef","layers","mapW","mapH","objLayer","l","findIndex","startX","startY","playerId","registryPlayer","maxXAtStart","mapHeightParam","checkCollisionExternal","isSolidAtPixelExternal","originX","originY","pDef","lifespan","ricochetFlag","ricochetOnTiles","collisionWithPenetration","proj","cwt","collisionWithTiles","hbs","hitboxScale","ric","spawnProjectileExternal","isWaterAtPixel","liq","sampleLiquid","aabb","objectLayer","centerY","itemId","itemDef","pickup","effect","healthBonus","newHealth","fireball","ammoBonus","usedInteractables","checkSecretsWrapper","mergedRevealed","indicesToReveal","dtProj","isSolidRect","hw","hh","pts","pt","maxBounces","bounceDamp","bounceDamping","ricRand","ricochetRandom","maxDelta","steps","stepTime","removed","nextX","sp","hypot","jitter","nextY","sign","next","res","requestAnimationFrame","cancelAnimationFrame","HeaderContainer","AmmoDisplay","RightSection","HealthDisplay","SoundButton","props","$enabled","GameHeader","soundEnabled","onToggleSound","title","commands","register","cmd","listCommands","description","executeCommand","raw","handler","panelStyleBase","position","fontFamily","borderTop","boxShadow","transition","GameTerminal","open","setOpen","lines","setLines","setInput","scrollRef","inputRef","suppressUntilRef","onClear","onClose","performance","setTimeout","focus","onKey","scrollTop","scrollHeight","transform","padding","borderBottom","flex","overflowY","whiteSpace","lineHeight","onSubmit","onKeyDown","stopPropagation","onChange","placeholder","outline","cursor","GameSettings","activeTab","setActiveTab","setParallax","__GAME_RUNTIME_SETTINGS__","setRain","ls","setSnow","setClouds","lsNew","lsOld","setThunder","setFog","setHealthBarEnabled","setOxygenBarEnabled","setLavaBarEnabled","setWaterSplashesEnabled","setLavaEmbersEnabled","minimized","setMinimized","pos","setPos","setSize","draggingRef","active","clampPos","sz","isMin","vw","innerWidth","vh","innerHeight","maxL","maxT","onOpen","onMove","clientX","clientY","onUp","onResize","emitUpdate","patch","panelStyle","userSelect","contentStyle","buttonStyle","marginLeft","tabsBarStyle","overflowX","onMouseDown","onMinToggle","tab","marginBottom","step","defaultValue","parseFloat","textAlign","toFixed","defaultChecked","marginTop","checked","startW","startH","move","ev","dw","dh","nw","nh","up","BackgroundMusicPlayer","audioRef","currentSrcRef","musicContext","cleanup","src","resolveUrl","loop","onGesture","val","BUILT_IN_MAPS","GameContainer","ModalOverlay","ModalContent","ModalTitle","h2","MapList","MapCard","MapTitle","MapAuthor","MapInfo","ModalDivider","FileUploadLabel","label","HiddenFileInput","Viewport","$centered","$blurred","GameCanvas","$width","$height","PlaceholderMessage","Game","dispatch","useDispatch","viewportRef","useSelector","runtimeSettings","setRuntimeSettings","handleGameOver","loadMapData","handleStateUpdate","currentId","indices","recalc","clientWidth","clientHeight","fits","scrollLeft","scrollTo","behavior","contentWidth","maxScrollLeft","playerCenter","currentLeft","targetLeft","onSettingsUpdate","handleOpenModalEvent","weatherFogLegacy","objData","bgLayer","fill","secretLayer","hasSecretsLayer","secretDataLength","secretDataNonNull","secretDataSample","mapName","dimensions","alert","author","accept","event","file","files","fileReader","FileReader","readAsText","onload","loaded","fileName","onerror","onScroll","currentTarget","backgroundMusic","contents","suggestedName","mimeType","showSaveFilePicker","types","writable","createWritable","blob","Blob","write","close","link","href","URL","createObjectURL","download","body","click","revokeObjectURL","getFloodFillIndices","currentData","startId","matchingIndices","paintTile","selectedTile","brushSize","getCurrentData","setCurrentData","newData","targetX","AnimatedItem","alt","setIndex","interval","setInterval","clearInterval","imgSrc","draggable","selectedBackgroundUrl","selectedBackgroundColor","selectedBackgroundImage","showGrid","activeLayer","activeTool","hoverIndex","bucketPreviewIndices","selection","previewPosition","dragStart","isDragging","handleGridMouseDown","handleGridMouseEnter","handleGridMouseUp","handleGridMouseLeave","setIsDragging","onMouseUp","onMouseLeave","backgroundRepeat","backgroundSize","pointerEvents","gridTemplateColumns","gridTemplateRows","_","displayTileId","displayObjectId","displaySecretId","selX","selY","selectionIndex","tileObj","objObj","secretObj","isSelected","isPreviewSelection","originalX","originalY","isMoveSelecting","isMoveHover","hx","hy","sx","minX","minY","maxY","isBrushTarget","isBucketTarget","isBucketPreview","borderStyle","bgStyle","isLiquidTile","isWaterTile","isLavaTile","backgroundStyleObj","onMouseEnter","boxSizing","objectFit","filterColor","baseButtonStyle","marginRight","minWidth","textDecoration","activeButtonStyle","NewMapModal","isOpen","tempMapName","setTempMapName","tempCreatorName","setTempCreatorName","confirmNewMap","DraggableWindow","defaultPosition","defaultWidth","isOpenDefault","onHeightChange","dragOffset","setDragOffset","currentPosition","setCurrentPosition","isMinimized","setIsMinimized","isClosed","setIsClosed","hasBeenDragged","setHasBeenDragged","windowRef","offsetHeight","handleMouseMove","maxHeight","rect","getBoundingClientRect","borderTopLeftRadius","borderTopRightRadius","PaletteSection","setIsOpen","Minimap","canvasRef","minimapWidth","minimapHeight","tileWidth","tileHeight","objectId","tile","obj","strokeStyle","lineWidth","beginPath","stroke","imageRendering","MapResizer","containerRef","startSize","setStartSize","startMousePos","setStartMousePos","displayWidth","displayHeight","blocksX","blocksY","newWidth","newHeight","minHeight","ToolbarWindows","creatorName","openNewMapModal","saveMap","loadMap","setShowGrid","clearMap","setActiveTool","setBrushSize","moveSelection","setSelection","selectionMode","setSelectionMode","commitSelection","cancelSelection","handlePaletteSelect","blocks","entities","interactables","hazards","secrets","backgroundOptions","setSelectedBackgroundImage","setSelectedBackgroundColor","setBackgroundParallaxFactor","musicOptions","selectedBackgroundMusic","setSelectedBackgroundMusic","totalTiles","filledBlocks","emptyBlocks","objectsCount","onMapResize","isResizeWindowOpen","setIsResizeWindowOpen","renderPaletteItem","hasImage","isLiquid","isWater","isSecret","swatchStyle","maxWidth","BlockEraser","ObjectEraser","SecretEraser","heights","setHeights","positions","reduce","acc","newHeights","flexWrap","paddingTop","li","Editor","setMapWidth","setMapHeight","setTileMapData","setObjectMapData","setSecretMapData","setSelectedTile","setHoverIndex","setActiveLayer","setDragStart","setBucketPreviewIndices","isMovingSelection","setIsMovingSelection","setPreviewPosition","originalMapData","setOriginalMapData","bucketTimerRef","stateRef","setMapName","setCreatorName","createdAt","setCreatedAt","isNewMapModalOpen","setIsNewMapModalOpen","loadBackgroundOptions","loadMusicOptions","selectedBgOption","newTileMap","tileMap","newObjectMap","objectMap","newSecretMap","secretMap","destX","destY","destIdx","srcDataIdx","confirm","currentDate","version","date_map_created_at","date_map_last_updated","statistics","total_tiles","filled_tiles","total_objects","total_items","json","saveFile","normalized","handleMapResize","resizeMapData","oldW","oldH","oldTiles","oldObjs","oldSecrets","resizeArray","oldArr","newArr","floodFill","targetId","clearTimeout","endX","x1","y1","selTileData","selObjectData","selSecretData","Crystals","Repository","cardStyle","imageStyle","fieldsContainerStyle","onError","wordBreak","ReactDOM","getElementById","render","Provider","store","ThemeProvider","theme","GlobalStyles","BrowserRouter","basename","Routes","Route","element","App"],"ignoreList":[],"sourceRoot":""}